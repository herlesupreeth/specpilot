#### 7.1.1.3 Uplink Data Transfer

##### 7.1.1.3.1 Correct Handling of UL MAC PDU / Assignment / HARQ process

##### 7.1.1.3.1.1 Test Purpose (TP) {#test-purpose-tp .H6}

##### (1) {#section .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE receives for a Slot an uplink grant with valid C-RNTI }

**then** { UE transmits data and associated HARQ information to the HARQ
entity for this Slot }

}

##### (2) {#section-1 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { SS transmits for a Slot an uplink grant with not allocated
C-RNTI }

**then** { UE does not transmit data and associated HARQ information to
the HARQ entity for this Slot }

}

##### (3) {#section-2 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE receives an UL Grant with toggled NDI and has data
available for transmission }

**then** { UE transmits a new MAC PDU }

}

##### (4) {#section-3 .H6}

**with** { UE in RRC\_CONNECTED state and having transmitted a MAC PDU
on a HARQ process }

**ensure that** {

**when** { UE receives an uplink grant on PDCCH for the next Slot
corresponding to the HARQ process with old NDI not toggled }

**then** { UE performs an adaptive retransmission of the MAC PDU with
redundancy version as received on PDCCH }

}

##### (5) {#section-4 .H6}

**with** { UE in E-UTRA RRC\_CONNECTED state }

**ensure that** {

**when** { UE receives an uplink grant on PDCCH for the next Slot
corresponding to the HARQ process with toggled NDI, and data is not
available for transmission }

**then** { UE transmits any MAC Padding PDU }

}

##### (6) {#section-5 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE has a MAC SDU to be transmitted that is smaller or equal
to 256 bytes }

**then** { UE sets F field to 0 and includes 8 bit L field in the MAC
sub PDU }

}

##### (7) {#section-6 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE has a MAC SDU to be transmitted that is larger than 256
bytes }

**then** { UE sets F field to 1 and includes 16 bit L field in the MAC
sub PDU }

}

##### (8) {#section-7 .H6}

**with** { UE in E-UTRA RRC\_CONNECTED state }

**ensure that** {

**when** { UE has to insert padding in a MAC PDU }

**then** { UE inserts the last MAC sub PDU as a padding sub PDU }

}

##### (9) {#section-8 .H6}

**with** { UE inÂ  RRC\_CONNECTED state and configured with a specific
*TDD-UL-DL-ConfigCommon* including configuration of *pattern2* }

**ensure that** {

**when** { UE receives for a Slot an uplink grant associated with
*pattern2* with valid C-RNTI }

**then** { UE transmits data and associated HARQ information to the HARQ
entity for this Slot }

}

##### 7.1.1.3.1.2 Conformance requirements {#conformance-requirements .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.321, clauses 5.4.1, 5.4.2.1, 5.4.2.2 and 6.1.2.
Unless otherwise stated these are Rel-15 requirements.

\[TS 38.321, clause 5.4.1\]

Uplink grant is either received dynamically on the PDCCH, in a Random
Access Response, or configured semi-persistently by RRC. The MAC entity
shall have an uplink grant to transmit on the UL-SCH. To perform the
requested transmissions, the MAC layer receives HARQ information from
lower layers.

If the MAC entity has a C-RNTI, a Temporary C-RNTI or CS-RNTI, the MAC
entity shall for each PDCCH occasion and for each Serving Cell belonging
to a TAG that has a running *timeAlignmentTimer* and for each grant
received for this PDCCH occasion:

1\> if an uplink grant for this Serving Cell has been received on the
PDCCH for the MAC entity's C-RNTI or Temporary C-RNTI; or

1\> if an uplink grant has been received in a Random Access Response:

2\> if the uplink grant is for MAC entity's C-RNTI and if the previous
uplink grant delivered to the HARQ entity for the same HARQ process was
either an uplink grant received for the MAC entity's CS-RNTI or a
configured uplink grant:

3\> consider the NDI to have been toggled for the corresponding HARQ
process regardless of the value of the NDI.

2\> deliver the uplink grant and the associated HARQ information to the
HARQ entity.

1\> else if an uplink grant for this PDCCH occasion has been received
for this serving cell on the PDCCH for the MAC entity's CS-RNTI:

2\> if the NDI in the received HARQ information is 1:

3\> consider the NDI for the corresponding HARQ process not to have been
toggled;

3\> stop the *ConfiguredGrantTimer* for the corresponding HARQ process,
if running;

3\> deliver the uplink grant and the associated HARQ information to the
HARQ entity.

2\> else if the NDI in the received HARQ information is 0:

3\> if PDCCH contents indicate configured grant Type 2 deactivation:

4\> trigger configured grant confirmation.

3\> else if PDCCH contents indicate configured grant Type 2 activation:

4\> trigger configured grant confirmation;

4\> store the uplink grant for this serving cell and the associated HARQ
information as configured uplink grant;

4\> initialise or re-initialise the configured uplink grant for this
serving cell to start in the associated PUSCH duration and to recur
according to rules in subclause 5.8.2;

4\> set the HARQ Process ID to the HARQ Process ID associated with this
PUSCH duration;

4\> consider the NDI bit for the corresponding HARQ process to have been
toggled;

4\> stop the *ConfiguredGrantTimer* for the corresponding HARQ process,
if running;

4\> deliver the configured uplink grant and the associated HARQ
information to the HARQ entity.

For each Serving Cell and each configured uplink grant, if configured
and activated, the MAC entity shall:

1\> set the HARQ Process ID to the HARQ Process ID associated with this
PUSCH duration;

1\> if the *ConfiguredGrantTimer* for the corresponding HARQ process is
not running:

2\> consider the NDI bit for the corresponding HARQ process to have been
toggled;

2\> deliver the configured uplink grant and the associated HARQ
information to the HARQ entity.

NOTE 1: For the same serving cell, an uplink grant addressed to C-RNTI
shall override a configured uplink grant in case of overlap in time
domain.

For configured uplink grants, the HARQ Process ID associated with this
symbol is derived from the following equation:

HARQ Process ID = \[floor(CURRENT\_symbol/*periodicity*)\] modulo
*numberOfConfGrant-Processes*

where CURRENT\_symbol=(SFN \* *numberOfSlotsPerFrame* \*
*numberOfSymbolsPerSlot* + slot number in the frame \*
*numberOfSymbolsPerSlot* + symbol number in the slot), and
*numberOfSlotsPerFrame* and *numberOfSymbolsPerSlot* refer to the number
of consecutive slots per frame and the number of consecutive symbols per
slot, respectively as specified in TS 38.211 \[8\].

NOTE 2: CURRENT\_symbol refers to the symbol index of the first
transmission of a repetition bundle that takes place. \[TS 36.322,
clause 5.4.2.1\]

The MAC entity includes a HARQ entity for each Serving Cell with
configured uplink (including the case when it is configured with
*supplementaryUplink*),which maintains a number of parallel HARQ
processes.

The number of parallel UL HARQ processes per HARQ entity is specified in
TS 38.214 \[7\].

Each HARQ process supports one TB.

Each HARQ process is associated with a HARQ process identifier. For UL
transmission with UL grant in RA Response, HARQ process identifier 0 is
used.

When repetition is configured with *repK* \>1, the parameter *repK*
provides the number of repetitions of a TB within a bundle. Repetition
operation relies on the HARQ entity for invoking the same HARQ process
for each transmission that is part of the same bundle. Within a bundle
HARQ retransmissions are non-adaptive and triggered without waiting for
feedback from previous transmissions according to *repK*.

For each uplink grant, the HARQ entity shall:

1\> identify the HARQ process(es) associated with this grant, and for
each identified HARQ process:

2\> if the received grant was not addressed to a Temporary C-RNTI on
PDCCH, and the NDI provided in the associated HARQ information has been
toggled compared to the value in the previous transmission of this TB of
this HARQ process; or

2\> if the uplink grant was received on PDCCH for the C-RNTI and the
HARQ buffer of the identified process is empty; or

2\> if the uplink grant was received in a Random Access Response:

3\> if there is a MAC PDU in the Msg3 buffer and the uplink grant was
received in a Random Access Response:

4\> obtain the MAC PDU to transmit from the Msg3 buffer.

3\> else:

4\> obtain the MAC PDU to transmit from the \"Multiplexing and
assembly\" entity, if any;

3\> if a MAC PDU to transmit has been obtained:

4\> deliver the MAC PDU and the uplink grant and the HARQ information of
the TB to the identified HARQ process;

4\> instruct the identified HARQ process to trigger a new transmission.

4\> if the uplink grant is addressed to CS-RNTI or the uplink grant is a
configured uplink grant:

5\> start or restart the *ConfiguredGrantTimer*, if configured, for the
corresponding HARQ process when the transmission is performed.

2\> else:

3\> if the uplink grant received on PDCCH was addressed to CS-RNTI and
if the HARQ buffer of the identified process is empty:

4\> ignore the uplink grant.

3\> else:

4\> deliver the uplink grant and the HARQ information (redundancy
version) of the TB to the identified HARQ process;

4\> instruct the identified HARQ process to trigger a retransmission;

4\> if the uplink grant is addressed to CS-RNTI or the uplink grant is a
configured uplink grant:

5\> start or restart the *ConfiguredGrantTimer*, if configured, for the
corresponding HARQ process when the transmission is performed.

When determining if NDI has been toggled compared to the value in the
previous transmission the MAC entity shall ignore NDI received in all
uplink grants on PDCCH for its Temporary C-RNTI.

\[TS 38.321, clause 5.4.2.2\]

Each HARQ process is associated with a HARQ buffer.

New transmissions are performed on the resource and with the MCS
indicated on either PDCCH, Random Access Response, or RRC.
Retransmissions are performed on the resource and, if provided, with the
MCS indicated on PDCCH.

If the HARQ entity requests a new transmission for a TB, the HARQ
process shall:

1\> store the MAC PDU in the associated HARQ buffer;

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

If the HARQ entity requests a retransmission for a TB, the HARQ process
shall:

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

To generate a transmission for a TB, the HARQ process shall:

1\> if the MAC PDU was obtained from the Msg3 buffer; or

1\> if there is no measurement gap at the time of the transmission and,
in case of retransmission, the retransmission does not collide with a
transmission for a MAC PDU obtained from the Msg3 buffer:

2\> instruct the physical layer to generate a transmission according to
the stored uplink grant.

\[TS 38.321, clause 6.1.2\]

A MAC PDU consists of one or more MAC subPDUs. Each MAC subPDU consists
of one of the following:

\- A MAC subheader only (including padding);

\- A MAC subheader and a MAC SDU;

\- A MAC subheader and a MAC CE;

\- A MAC subheader and padding.

The MAC SDUs are of variable sizes.

Each MAC subheader corresponds to either a MAC SDU, a MAC CE, or
padding.

A MAC subheader except for fixed sized MAC CE and padding consists of
the four header fields R/F/LCID/L. A MAC subheader for fixed sized MAC
CE and padding consists of the two header fields R/LCID.

![](./media/image1.emf)

Figure 6.1.2-1: R/F/LCID/L MAC subheader with 8-bit L field

![](./media/image2.emf)

Figure 6.1.2-2: R/F/LCID/L MAC subheader with 16-bit L field

![](./media/image3.emf)

Figure 6.1.2-3: R/LCID MAC subheader

MAC CEs are placed together. DL MAC subPDU(s) with MAC CE(s) is placed
before any MAC subPDU with MAC SDU and MAC subPDU with padding as
depicted in Figure 6.1.2-4. UL MAC subPDU(s) with MAC CE(s) is placed
after all the MAC subPDU(s) with MAC SDU and before the MAC subPDU with
padding in the MAC PDU as depicted in Figure 6.1.2-5. The size of
padding can be zero.

![](./media/image4.emf)

Figure 6.1.2-4: Example of a DL MAC PDU

![](./media/image5.emf)

Figure 6.1.2-5: Example of a UL MAC PDU

A maximum of one MAC PDU can be transmitted per TB per MAC entity.

##### 7.1.1.3.1.3 Test description {#test-description .H6}

##### 7.1.1.3.1.3.1 Pre-test conditions {#pre-test-conditions .H6}

Same Pre-test conditions as in clause 7.1.1.0.

##### 7.1.1.3.1.3.2 Test procedure sequence {#test-procedure-sequence .H6}

Table 7.1.1.3.1.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \-        | \-        | \-      | \- |
|           | ignores   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | requests  |           |           |         |    |
|           | and does  |           |           |         |    |
|           | not       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | any       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | a RLC SDU |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Step 3    |           |           |         |    |
|           | runs in   |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | with      |           |           |         |    |
|           | behaviour |           |           |         |    |
|           | in table  |           |           |         |    |
|           | 7.1.1.    |           |           |         |    |
|           | 3.1.3.2-2 |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | For 100   | \<\--     | (UL Grant | \-      | \- |
|           | ms SS     |           | (unknown  |         |    |
|           | transmits |           | C-RNTI))  |         |    |
|           | an UL     |           |           |         |    |
|           | Grant     |           |           |         |    |
|           | every 10  |           |           |         |    |
|           | ms ,      |           |           |         |    |
|           | allowing  |           |           |         |    |
|           | the UE to |           |           |         |    |
|           | return    |           |           |         |    |
|           | the RLC   |           |           |         |    |
|           | SDU as    |           |           |         |    |
|           | received  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 2, on     |           |           |         |    |
|           | PDCCH,    |           |           |         |    |
|           | but with  |           |           |         |    |
|           | the       |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | different |           |           |         |    |
|           | from the  |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | assigned  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | UE.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | Check:    | \--\>     | MAC PDU   | 2       | F  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to grant  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 3?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | SS        | \<\--     | (UL Grant | \-      | \- |
|           | transmits |           | (C-RNTI)) |         |    |
|           | an UL     |           |           |         |    |
|           | Grant,    |           |           |         |    |
|           | allowing  |           |           |         |    |
|           | the UE to |           |           |         |    |
|           | return    |           |           |         |    |
|           | the RLC   |           |           |         |    |
|           | SDU as    |           |           |         |    |
|           | received  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 2, on     |           |           |         |    |
|           | PDCCH     |           |           |         |    |
|           | with the  |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | assigned  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | UE.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to grant  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 6?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6A        | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC      |         |    |
|           | a MAC PDU |           | STATUS    |         |    |
|           | c         |           | PDU)      |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of the    |           |           |         |    |
|           | AMD PDUs  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 6.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | Transmits |           |           |         |    |
|           | a valid   |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | RLC PDU   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | The SS    | \<\--     | Uplink    | \-      | \- |
|           | allocates |           | Grant     |         |    |
|           | an UL     |           |           |         |    |
|           | Grant for |           |           |         |    |
|           | one HARQ  |           |           |         |    |
|           | process   |           |           |         |    |
|           | X,        |           |           |         |    |
|           | s         |           |           |         |    |
|           | ufficient |           |           |         |    |
|           | for one   |           |           |         |    |
|           | RLC SDU   |           |           |         |    |
|           | to be     |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back in a |           |           |         |    |
|           | Slot, and |           |           |         |    |
|           | NDI       |           |           |         |    |
|           | indicates |           |           |         |    |
|           | new       |           |           |         |    |
|           | tra       |           |           |         |    |
|           | nsmission |           |           |         |    |
|           | r         |           |           |         |    |
|           | edundancy |           |           |         |    |
|           | version   |           |           |         |    |
|           | to be     |           |           |         |    |
|           | used as 0 |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | Check:    | \--\>     | MAC PDU   | 3       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | one RLC   |           |           |         |    |
|           | SDU, in   |           |           |         |    |
|           | HARQ      |           |           |         |    |
|           | process   |           |           |         |    |
|           | X?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | The SS    | \<\--     | Uplink    | \-      | \- |
|           | transmits |           | Grant     |         |    |
|           | an UL     |           |           |         |    |
|           | grant     |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to slot   |           |           |         |    |
|           | for HARQ  |           |           |         |    |
|           | process   |           |           |         |    |
|           | X, with   |           |           |         |    |
|           | NDI not   |           |           |         |    |
|           | toggled   |           |           |         |    |
|           | and       |           |           |         |    |
|           | r         |           |           |         |    |
|           | edundancy |           |           |         |    |
|           | version   |           |           |         |    |
|           | to be     |           |           |         |    |
|           | used as 1 |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | Check:    | \--\>     | MAC PDU   | 4       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | r         |           |           |         |    |
|           | etransmit |           |           |         |    |
|           | the MAC   |           |           |         |    |
|           | PDU in    |           |           |         |    |
|           | for HARQ  |           |           |         |    |
|           | process   |           |           |         |    |
|           | X, using  |           |           |         |    |
|           | r         |           |           |         |    |
|           | edundancy |           |           |         |    |
|           | version1? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11A       | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC      |         |    |
|           | a MAC PDU |           | STATUS    |         |    |
|           | c         |           | PDU)      |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of the    |           |           |         |    |
|           | AMD PDUs  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 11.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | The SS    | \<\--     | Uplink    | \-      | \- |
|           | transmits |           | Grant     |         |    |
|           | an UL     |           |           |         |    |
|           | grant     |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to SLOT   |           |           |         |    |
|           | for HARQ  |           |           |         |    |
|           | process   |           |           |         |    |
|           | X, with   |           |           |         |    |
|           | NDI       |           |           |         |    |
|           | toggled   |           |           |         |    |
|           | and       |           |           |         |    |
|           | r         |           |           |         |    |
|           | edundancy |           |           |         |    |
|           | version   |           |           |         |    |
|           | to be     |           |           |         |    |
|           | used as 0 |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | Check:    | \--\>     | MAC PDU   | 5       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | r         |           |           |         |    |
|           | etransmit |           |           |         |    |
|           | the MAC   |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | padding   |           |           |         |    |
|           | for HARQ  |           |           |         |    |
|           | process   |           |           |         |    |
|           | X, using  |           |           |         |    |
|           | r         |           |           |         |    |
|           | edundancy |           |           |         |    |
|           | version   |           |           |         |    |
|           | 0?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | a RLC PDU |           |           |         |    |
|           | of size   |           |           |         |    |
|           | 128 bytes |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | The SS    | \<\--     | (UL Grant | \-      | \- |
|           | transmits |           | (C-RNTI)) |         |    |
|           | an UL     |           |           |         |    |
|           | Grant,    |           |           |         |    |
|           | allowing  |           |           |         |    |
|           | the UE to |           |           |         |    |
|           | return    |           |           |         |    |
|           | the RLC   |           |           |         |    |
|           | SDU as    |           |           |         |    |
|           | received  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 14 and    |           |           |         |    |
|           | padding.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 16        | Check:    | \--\>     | MAC PDU   | 6,8     | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to grant  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 14 with F |           |           |         |    |
|           | field set |           |           |         |    |
|           | to 0 and  |           |           |         |    |
|           | includes  |           |           |         |    |
|           | 8 bit L   |           |           |         |    |
|           | field in  |           |           |         |    |
|           | the MAC   |           |           |         |    |
|           | sub PDU   |           |           |         |    |
|           | and       |           |           |         |    |
|           | includes  |           |           |         |    |
|           | a padding |           |           |         |    |
|           | sub PDU   |           |           |         |    |
|           | at end?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 16A       | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC      |         |    |
|           | a MAC PDU |           | STATUS    |         |    |
|           | c         |           | PDU)      |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of the    |           |           |         |    |
|           | AMD PDUs  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 16.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17        | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | a RLC PDU |           |           |         |    |
|           | of size   |           |           |         |    |
|           | 512 bytes |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 18        | The SS    | \<\--     | (UL Grant | \-      | \- |
|           | transmits |           | (C-RNTI)) |         |    |
|           | an UL     |           |           |         |    |
|           | Grant,    |           |           |         |    |
|           | allowing  |           |           |         |    |
|           | the UE to |           |           |         |    |
|           | return    |           |           |         |    |
|           | the RLC   |           |           |         |    |
|           | SDU as    |           |           |         |    |
|           | received  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 17 and    |           |           |         |    |
|           | padding.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19        | Check:    | \--\>     | MAC PDU   | 7,8     | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to grant  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 17 with F |           |           |         |    |
|           | field set |           |           |         |    |
|           | to 1 and  |           |           |         |    |
|           | includes  |           |           |         |    |
|           | 16 bit L  |           |           |         |    |
|           | field in  |           |           |         |    |
|           | the MAC   |           |           |         |    |
|           | sub PDU   |           |           |         |    |
|           | and       |           |           |         |    |
|           | includes  |           |           |         |    |
|           | a padding |           |           |         |    |
|           | sub PDU   |           |           |         |    |
|           | at end?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19A       | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC      |         |    |
|           | a MAC PDU |           | STATUS    |         |    |
|           | c         |           | PDU)      |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of the    |           |           |         |    |
|           | AMD PDUs  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 19.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | EXCEPTION | \-        | *-*       | \-      | \- |
|           | : Steps   |           |           |         |    |
|           | 20a0 to   |           |           |         |    |
|           | 20a6 are  |           |           |         |    |
|           | executed  |           |           |         |    |
|           | for       |           |           |         |    |
|           | operation |           |           |         |    |
|           | on NR TDD |           |           |         |    |
|           | band only |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 20a0      | The SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | an        |           |           |         |    |
|           | updated   |           |           |         |    |
|           | system    |           |           |         |    |
|           | in        |           |           |         |    |
|           | formation |           |           |         |    |
|           | as        |           |           |         |    |
|           | specified |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.3.  |           |           |         |    |
|           | 1.3.3-14. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 20a1      | The SS    | \<\--     | *(RR      | \-      | \- |
|           | transmits |           | CReconfig |         |    |
|           | a NR      |           | uration)* |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | message   |           |           |         |    |
|           | including |           |           |         |    |
|           | *TDD-U    |           |           |         |    |
|           | L-DL-Conf |           |           |         |    |
|           | igCommon* |           |           |         |    |
|           | with      |           |           |         |    |
|           | *pattern1 |           |           |         |    |
|           | and       |           |           |         |    |
|           | pattern   |           |           |         |    |
|           | 2*        |           |           |         |    |
|           | specified |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.    |           |           |         |    |
|           | 3.1.3.3-6 |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 20a2      | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmit  |           | RCReconfi |         |    |
|           | a NR      |           | gurationC |         |    |
|           | *         |           | omplete)* |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message.  |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 20a3      | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | a RLC SDU |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 20a4      | SS        | \<\--     | (UL Grant | \-      | \- |
|           | transmits |           | (C-RNTI)) |         |    |
|           | an UL     |           |           |         |    |
|           | Grant,    |           |           |         |    |
|           | allowing  |           |           |         |    |
|           | the UE to |           |           |         |    |
|           | return    |           |           |         |    |
|           | the RLC   |           |           |         |    |
|           | SDU as    |           |           |         |    |
|           | received  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 20a3, on  |           |           |         |    |
|           | PDCCH     |           |           |         |    |
|           | with the  |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | assigned  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | UE.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 20a5      | Check:    | \--\>     | MAC PDU   | 9       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to grant  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 20a4?     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 20a6      | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC      |         |    |
|           | a MAC PDU |           | STATUS    |         |    |
|           | c         |           | PDU)      |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of the    |           |           |         |    |
|           | AMD PDUs  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 20a5.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| 36.508    |           |           |           |         |    |
| \[7\],    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 4.6.1-8   |           |           |           |         |    |
| using     |           |           |           |         |    |
| condition |           |           |           |         |    |
| EN-DC\_   |           |           |           |         |    |
| EmbedNR\_ |           |           |           |         |    |
| RRCRecon. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete. |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

Table 7.1.1.3.1.3.2-2: Parallel behaviour

  St   Procedure                            Message Sequence   TP        Verdict   
  ---- ------------------------------------ ------------------ --------- --------- ----
                                            U - S              Message             
  1    UE transmits a Scheduling Request.   \--\>              (SR)      \-        \-

##### 7.1.1.3.1.3.3 Specific message contents {#specific-message-contents .H6}

Table 7.1.1.3.1.3.3-1: *Void*

Table 7.1.1.3.1.3.3-2: *Void*

Table 7.1.1.3.1.3.3-3: *RRCReconfiguration* (step 20a1, Table
7.1.1.3.1.3.2-1)

  ---------------------------------------------------- ----------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                               
  Information Element                                  Value/remark      Comment   Condition
  RRCReconfiguration ::= SEQUENCE {                                                
  criticalExtensions CHOICE {                                                      
  rrcReconfiguration SEQUENCE {                                                    
  secondaryCellGroup                                   CellGroupConfig             EN-DC
  nonCriticalExtension SEQUENCE {                                                  NR
  masterCellGroup                                      CellGroupConfig             
  }                                                                                
  }                                                                                
  }                                                                                
  ---------------------------------------------------- ----------------- --------- -----------

Table 7.1.1.3.1.3.3-4: *CellGroupConfig (*Table 7.1.1.3.1.3.3-3)

  ---------------------------------------------------- ------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19                                       
  Information Element                                  Value/remark              Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                           
  spCellConfig SEQUENCE {                                                                  
  reconfigurationWithSync SEQUENCE {                                                       
  spCellConfigCommon                                   ServingCellConfigCommon             
  }                                                                                        
  spCellConfigDedicated                                ServingCellConfig                   
  }                                                                                        
  }                                                                                        
  ---------------------------------------------------- ------------------------- --------- -----------

Table 7.1.1.3.1.3.3-5: *ServingCellConfigCommon (*Table 7.1.1.3.1.3.3-4,
Table 7.1.1.3.1.3.3-14)

  ----------------------------------------------------- ------------------------ --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                      
  Information Element                                   Value/remark             Comment   Condition
  ServingCellConfigCommon ::= SEQUENCE {                                                   
  uplinkConfigCommon SEQUENCE {                                                            
  initialUplinkBWP                                      BWP-UplinkCommon                   
  }                                                                                        
  tdd-UL-DL-ConfigurationCommon                         TDD-UL-DL-ConfigCommon             
  }                                                                                        
  ----------------------------------------------------- ------------------------ --------- -----------

Table 7.1.1.3.1.3.3-6: *TDD-UL-DL-ConfigCommon (*Table 7.1.1.3.1.3.3-5)

  ----------------------------------------------------- ------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-192                                 
  Information Element                                   Value/remark        Comment   Condition
  TDD-UL-DL-ConfigCommon ::= SEQUENCE {                                               
  referenceSubcarrierSpacing                            SubcarrierSpacing             
  pattern1 SEQUENCE {                                                                 
  dl-UL-TransmissionPeriodicity                         ms5                           FR1
                                                        ms0p625                       FR2
  nrofDownlinkSlots                                     3                             FR1
                                                        2                             FR2
  nrofDownlinkSymbols                                   6                             FR1
                                                        6                             FR2
  nrofUplinkSlots                                       2                             FR1
                                                        2                             FR2
  nrofUplinkSymbols                                     4                             FR1
                                                        2                             FR2
  dl-UL-TransmissionPeriodicity-v1530                   ms3                           FR1
  }                                                                                   
  pattern2 SEQUENCE {                                                                 
  dl-UL-TransmissionPeriodicity                         ms2                           FR1
                                                        ms0p625                       FR2
  nrofDownlinkSlots                                     4                             FR1
                                                        3                             FR2
  nrofDownlinkSymbols                                   0                             FR1
                                                        6                             FR2
  nrofUplinkSlots                                       0                             FR1
                                                        1                             FR2
  nrofUplinkSymbols                                     0                             FR1
                                                        2                             FR2
  }                                                                                   
  }                                                                                   
  ----------------------------------------------------- ------------------- --------- -----------

Table 7.1.1.3.1.3.3-7: *BWP-UplinkCommon (*Table 7.1.1.3.1.3.3-5)

  ---------------------------------------------------- ------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-14                                 
  Information Element                                  Value/remark        Comment   Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                    
  rach-ConfigCommon CHOICE {                                                         
  setup                                                RACH-ConfigCommon             
  }                                                                                  
  }                                                                                  
  ---------------------------------------------------- ------------------- --------- -----------

Table 7.1.1.3.1.3.3-8: *RACH-ConfigCommon (*Table 7.1.1.3.1.3.3-7)

  ----------------------------------------------------- -------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128                                  
  Information Element                                   Value/remark         Comment   Condition
  RACH-ConfigCommon ::= SEQUENCE {                                                     
  rach-ConfigGeneric                                    RACH-ConfigGeneric             
  }                                                                                    
  ----------------------------------------------------- -------------------- --------- -----------

Table 7.1.1.3.1.3.3-9: *RACH-ConfigGeneric (*Table 7.1.1.3.1.3.3-8)

  ----------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-130                            
  Information Element                                   Value/remark   Comment   Condition
  RACH-ConfigGeneric ::= SEQUENCE {                                              
  prach-configurationIndex                              156                      
  }                                                                              
  ----------------------------------------------------- -------------- --------- -----------

Table 7.1.1.3.1.3.3-10: *ServingCellConfig* (Table 7.1.1.3.1.3.3-4)

  ----------------------------------------------------- --------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167                                   
  Information Element                                   Value/remark          Comment   Condition
  ServingCellConfig ::= SEQUENCE {                                                      
  uplinkConfig SEQUENCE {                                                               
  initialUplinkBWP                                      BWP-UplinkDedicated             
  }                                                                                     
  }                                                                                     
  ----------------------------------------------------- --------------------- --------- -----------

Table 7.1.1.3.1.3.3-11: *BWP-UplinkDedicated (*Table 7.1.1.3.1.3.3-10)

  ---------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-15                            
  Information Element                                  Value/remark   Comment   Condition
  BWP-UplinkDedicated ::= SEQUENCE {                                            
  pucch-Config CHOICE {                                                         
  setup                                                PUCCH-Config             
  }                                                                             
  }                                                                             
  ---------------------------------------------------- -------------- --------- -----------

Table 7.1.1.3.1.3.3-12: *PUCCH-Config (*Table 7.1.1.3.1.3.3-11)

  --------------------------------------------------------------------------------------------------------------------- --------------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-112                                                                                                               
  Information Element                                                                                                   Value/remark                      Comment   Condition
  PUCCH-Config ::= SEQUENCE {                                                                                                                                       
  schedulingRequestResourceToAddModList SEQUENCE (SIZE (1..maxNrofSR-Resources)) OF SchedulingRequestResourceConfig {   1 entry                                     
  SchedulingRequestResourceConfig\[1\]                                                                                  SchedulingRequestResourceConfig   entry 1   
  }                                                                                                                                                                 
  }                                                                                                                                                                 
  --------------------------------------------------------------------------------------------------------------------- --------------------------------- --------- -----------

Table 7.1.1.3.1.3.3-13: *SchedulingRequestResourceConfig (*Table
7.1.1.3.1.3.3-12)

  ----------------------------------------------------- -------------- ----------------------------------------------------- -------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-112                                                                        
  Information Element                                   Value/remark   Comment                                               Condition
  SchedulingRequestResourceConfig ::= SEQUENCE {                                                                             
  periodicityAndOffset CHOICE {                                                                                              
  sl10                                                  5              With SCS = kHz15 results in repetition every 10 ms    SCS\_15kHz
  sl20                                                  5              With SCS = kHz30 results in repetition every 10 ms    SCS\_30kHz
  sl80                                                  4              With SCS = kHz120 results in repetition every 10 ms   SCS\_120kHz
  }                                                                                                                          
  }                                                                                                                          
  ----------------------------------------------------- -------------- ----------------------------------------------------- -------------

Table 7.1.1.3.1.3.3-14: *SIB1* (step 20a0, Table 7.1.1.3.1.3.2-1)

  ------------------------------------------------ ------------------------- ------------------------------------------- -----------
  Derivation path: 38.508-1 \[4\] table 4.6.1-28                                                                         
  Information Element                              Value/Remark              Comment                                     Condition
  SIB1 ::= SEQUENCE {                                                                                                    
  servingCellConfigCommon                          ServingCellConfigCommon   Same contents as in Table 7.1.1.3.1.3.3-5   
  }                                                                                                                      
  ------------------------------------------------ ------------------------- ------------------------------------------- -----------

##### 7.1.1.3.2 Logical channel prioritization handling

##### 7.1.1.3.2.1 Test Purpose (TP) {#test-purpose-tp-1 .H6}

##### (1) {#section-9 .H6}

**with** {UE in RRC\_CONNECTED state}

**ensure that** {

**when** { UE is sending data on the uplink }

**then** { UE serves the logical channels according to their priority
and configured PBR }

}

##### 7.1.1.3.1.2 Conformance requirements {#conformance-requirements-1 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.321, clause 5.4.3.1.1, 5.4.3.1.2, 5.4.3.1.3. Unless
otherwise stated these are Rel-15 requirements.

\[TS 38.321, clause 5.4.3.1.1\]

The Logical Channel Prioritization procedure is applied whenever a new
transmission is performed.

RRC controls the scheduling of uplink data by signalling for each
logical channel per MAC entity:

\- *priority* where an increasing priority value indicates a lower
priority level;

\- *prioritisedBitRate* which sets the Prioritized Bit Rate (PBR);

\- *bucketSizeDuration* which sets the Bucket Size Duration (BSD).

RRC additionally controls the LCP procedure by configuring mapping
restrictions for each logical channel:

\- *allowedSCS-List* which sets the allowed Subcarrier Spacing(s) for
transmission;

\- *maxPUSCH-Duration* which sets the maximum PUSCH duration allowed for
transmission;

\- *configuredGrantType1Allowed* which sets whether a Configured Grant
Type 1 can be used for transmission;

\- *allowedServingCells* which sets the allowed cell(s) for
transmission.

The following UE variable is used for the Logical channel prioritization
procedure:

\- *Bj* which is maintained for each logical channel j.

The MAC entity shall initialize Bj of the logical channel to zero when
the logical channel is established.

For each logical channel j, the MAC entity shall:

1\> increment *Bj* by the product PBR Ã T before every instance of the
LCP procedure, where T is the time elapsed since *Bj* was last updated;

1\> if the value of *Bj* is greater than the bucket size (i.e. PBR Ã
BSD):

2\> set *Bj* to the bucket size.

NOTE: The exact moment(s) when the UE updates *Bj* between LCP
procedures is up to UE implementation, as long as *Bj* is up to date at
the time when a grant is processed by LCP.

\[TS 38.321, clause 5.4.3.1.2\]

The MAC entity shall, when a new transmission is performed:

1\> select the logical channels for each UL grant that satisfy all the
following conditions:

2\> the set of allowed Subcarrier Spacing index values in
*allowedSCS-List*, if configured, includes the Subcarrier Spacing index
associated to the UL grant; and

2\> *maxPUSCH-Duration*, if configured, is larger than or equal to the
PUSCH transmission duration associated to the UL grant; and

2\> *configuredGrantType1Allowed*, if configured, is set to TRUE in case
the UL grant is a Configured Grant Type 1; and

2\> *allowedServingCells*, if configured, includes the Cell information
associated to the UL grant.

NOTE: The Subcarrier Spacing index, PUSCH transmission duration and Cell
information are included in Uplink transmission information received
from lower layers for the corresponding scheduled uplink transmission.

\[TS 38.321, clause 5.4.3.1.3\]

The MAC entity shall, when a new transmission is performed:

1\> allocate resources to the logical channels as follows:

2\> logical channels selected in subclause 5.4.3.1.2 for the UL grant
with Bj \> 0 are allocated resources in a decreasing priority order. If
the PBR of a logical channel is set to \"infinity\", the MAC entity
shall allocate resources for all the data that is available for
transmission on the logical channel before meeting the PBR of the lower
priority logical channel(s);

2\> decrement Bj by the total size of MAC SDUs served to logical channel
j above;

NOTE: The value of Bj can be negative.

2\> if any resources remain, all the logical channels selected in
subclause 5.4.3.1.2 are served in a strict decreasing priority order
(regardless of the value of Bj) until either the data for that logical
channel or the UL grant is exhausted, whichever comes first. Logical
channels configured with equal priority should be served equally.

The UE shall also follow the rules below during the scheduling
procedures above:

\- the UE should not segment an RLC SDU (or partially transmitted SDU or
retransmitted RLC PDU) if the whole SDU (or partially transmitted SDU or
retransmitted RLC PDU) fits into the remaining resources of the
associated MAC entity;

\- if the UE segments an RLC SDU from the logical channel, it shall
maximize the size of the segment to fill the grant of the associated MAC
entity as much as possible;

\- the UE should maximise the transmission of data;

\- if the MAC entity is given an UL grant size that is equal to or
larger than 8 bytes while having data available for transmission, the
MAC entity shall not transmit only padding BSR and/or padding.

The MAC entity shall not generate a MAC PDU for the HARQ entity if the
following conditions are satisfied:

\- the MAC entity is configured with *skipUplinkTxDynamic* and the grant
indicated to the HARQ entity was addressed to a C-RNTI, or the grant
indicated to the HARQ entity is a configured uplink grant; and

\- the MAC PDU includes zero MAC SDUs; and

\- the MAC PDU includes only the periodic BSR and there is no data
available for any LCG, or the MAC PDU includes only the padding BSR.

Logical channels shall be prioritised in accordance with the following
order (highest priority listed first):

\- MAC CE for C-RNTI or data from UL-CCCH;

\- MAC CE for SPS confirmation;

\- MAC CE for BSR, with exception of BSR included for padding;

\- MAC CE for single entry PHR or multiple entry PHR;

\- data from any Logical Channel, except data from UL-CCCH;

\- MAC CE for BSR included for padding.

##### 7.1.1.3.2.3 Test description {#test-description-1 .H6}

##### 7.1.1.3.2.3.1 Pre-test conditions {#pre-test-conditions-1 .H6}

Same Pre-test conditions as in clause 7.1.1.0 with the exception of 3 UM
SN terminated SCG bearers configured according to Table 7.1.1.3.2.3.1-1.

Table 7.1.1.3.2.3.1-1: Priority, PBR and Bucket Delay settings

  DRB    priority   prioritizedBitRate (kbytes/s)   bucketSizeDuration (ms)
  ------ ---------- ------------------------------- -------------------------
  DRB1   6          8                               100
  DRB2   7          16                              100
  DRB3   8          32                              100

Table 7.1.1.3.2.3.1-2: PDCP Settings

  Parameter        Value
  ---------------- --------
  Discard\_Timer   ms1500

##### 7.1.1.3.2.3.2 Test procedure sequence {#test-procedure-sequence-1 .H6}

Table 7.1.1.3.2.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Steps 1   |           |           |         |    |
|           | to 3 are  |           |           |         |    |
|           | run 4     |           |           |         |    |
|           | times     |           |           |         |    |
|           | using the |           |           |         |    |
|           | p         |           |           |         |    |
|           | arameters |           |           |         |    |
|           | specified |           |           |         |    |
|           | for each  |           |           |         |    |
|           | run in    |           |           |         |    |
|           | table     |           |           |         |    |
|           | 7.1.1.3   |           |           |         |    |
|           | .2.3.2-3. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\--     | (RLC      | \-      | \- |
|           | transmits |           | SDUs)     |         |    |
|           | N1        |           |           |         |    |
|           | 320-octet |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | on DRB1,  |           |           |         |    |
|           | N2        |           |           |         |    |
|           | 320-octet |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | on DRB2,  |           |           |         |    |
|           | and N3    |           |           |         |    |
|           | 320-octet |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | on DRB3.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1A        | Start     | \-        | \-        | \-      | \- |
|           | WatchD    |           |           |         |    |
|           | og\_Timer |           |           |         |    |
|           | set to 5  |           |           |         |    |
|           | seconds   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | In        |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | event     |           |           |         |    |
|           | described |           |           |         |    |
|           | in step 2 |           |           |         |    |
|           | the       |           |           |         |    |
|           | events    |           |           |         |    |
|           | specified |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.    |           |           |         |    |
|           | 3.2.3.2-2 |           |           |         |    |
|           | shall     |           |           |         |    |
|           | take      |           |           |         |    |
|           | place.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The SS is | \<\--     | (UL       | \-      | \- |
|           | c         |           | grants)   |         |    |
|           | onfigured |           |           |         |    |
|           | for       |           |           |         |    |
|           | Uplink    |           |           |         |    |
|           | Grant     |           |           |         |    |
|           | A         |           |           |         |    |
|           | llocation |           |           |         |    |
|           | Type 2 as |           |           |         |    |
|           | defined   |           |           |         |    |
|           | in TS     |           |           |         |    |
|           | 38.523-3  |           |           |         |    |
|           | \[3\].    |           |           |         |    |
|           | 150 ms    |           |           |         |    |
|           | after     |           |           |         |    |
|           | Step 1    |           |           |         |    |
|           | (Note1),  |           |           |         |    |
|           | for a     |           |           |         |    |
|           | duration  |           |           |         |    |
|           | of T2,    |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | an UL     |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | D octets  |           |           |         |    |
|           | every T1. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | Check:    | \-        | \-        | 1       | P  |
|           | Are the   |           |           |         |    |
|           | total     |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets of |           |           |         |    |
|           | the UL    |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | received  |           |           |         |    |
|           | at the SS |           |           |         |    |
|           | for each  |           |           |         |    |
|           | DRB as    |           |           |         |    |
|           | follows:  |           |           |         |    |
|           |           |           |           |         |    |
|           | \- total  |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets    |           |           |         |    |
|           | received  |           |           |         |    |
|           | for DRB1  |           |           |         |    |
|           | is D1     |           |           |         |    |
|           | octets    |           |           |         |    |
|           | +/- 10%   |           |           |         |    |
|           |           |           |           |         |    |
|           | \- total  |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets    |           |           |         |    |
|           | received  |           |           |         |    |
|           | for DRB2  |           |           |         |    |
|           | is D2     |           |           |         |    |
|           | octets    |           |           |         |    |
|           | +/- 10%   |           |           |         |    |
|           |           |           |           |         |    |
|           | \- total  |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets    |           |           |         |    |
|           | received  |           |           |         |    |
|           | for DRB3  |           |           |         |    |
|           | is D3     |           |           |         |    |
|           | octets    |           |           |         |    |
|           | +/- 10% ? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | Wait for  | \-        | \-        | \-      | \- |
|           | WatchD    |           |           |         |    |
|           | og\_Timer |           |           |         |    |
|           | expi      |           |           |         |    |
|           | ry(Note2) |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| This wait |           |           |           |         |    |
| time will |           |           |           |         |    |
| ensure    |           |           |           |         |    |
| that a)   |           |           |           |         |    |
| all       |           |           |           |         |    |
| octets    |           |           |           |         |    |
| have been |           |           |           |         |    |
| c         |           |           |           |         |    |
| ompletely |           |           |           |         |    |
| received  |           |           |           |         |    |
| by the UE |           |           |           |         |    |
| on all 3  |           |           |           |         |    |
| DRBs      |           |           |           |         |    |
| before    |           |           |           |         |    |
| the first |           |           |           |         |    |
| UL grant  |           |           |           |         |    |
| is        |           |           |           |         |    |
| received  |           |           |           |         |    |
| and b)    |           |           |           |         |    |
| the Bjs   |           |           |           |         |    |
| for each  |           |           |           |         |    |
| logical   |           |           |           |         |    |
| channel   |           |           |           |         |    |
| have      |           |           |           |         |    |
| reached   |           |           |           |         |    |
| their     |           |           |           |         |    |
| maximum   |           |           |           |         |    |
| value     |           |           |           |         |    |
| i.e. the  |           |           |           |         |    |
| bucket    |           |           |           |         |    |
| size of   |           |           |           |         |    |
| the       |           |           |           |         |    |
| corr      |           |           |           |         |    |
| esponding |           |           |           |         |    |
| logical   |           |           |           |         |    |
| channel   |           |           |           |         |    |
| before    |           |           |           |         |    |
| the first |           |           |           |         |    |
| UL grant  |           |           |           |         |    |
| is        |           |           |           |         |    |
| received. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| Several   |           |           |           |         |    |
| PDUs on   |           |           |           |         |    |
| DRB3      |           |           |           |         |    |
| after     |           |           |           |         |    |
| second    |           |           |           |         |    |
| run and   |           |           |           |         |    |
| on DRB2   |           |           |           |         |    |
| after     |           |           |           |         |    |
| third run |           |           |           |         |    |
| and on    |           |           |           |         |    |
| DRB1      |           |           |           |         |    |
| after     |           |           |           |         |    |
| fourth    |           |           |           |         |    |
| run would |           |           |           |         |    |
| be        |           |           |           |         |    |
| awaiting  |           |           |           |         |    |
| on PDCP   |           |           |           |         |    |
| Tx        |           |           |           |         |    |
| Buffer.   |           |           |           |         |    |
| Timer 5   |           |           |           |         |    |
| seconds   |           |           |           |         |    |
| ensures   |           |           |           |         |    |
| the PDCP  |           |           |           |         |    |
| Data PDUs |           |           |           |         |    |
| are       |           |           |           |         |    |
| discarded |           |           |           |         |    |
| after     |           |           |           |         |    |
| expiry of |           |           |           |         |    |
| Disca     |           |           |           |         |    |
| rd\_timer |           |           |           |         |    |
| (1500ms). |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

Table 7.1.1.3.2.3.2-2: Parallel behaviour

  St   Procedure                                                  Message Sequence   TP        Verdict   
  ---- ---------------------------------------------------------- ------------------ --------- --------- ---
                                                                  U - S              Message             
  1    Check: Does the UE transmit the RLC SDUs back to the SS?   \--\>              \-        1         P

Table 7.1.1.3.2.3.2-3: Test parameter values

  -------------------------------------------------------------------------------------------------------------------------------------------------------
  Parameter                                                                                 First run   Second run      Third run        Fourth run
  ----------------------------------------------------------------------------------------- ----------- --------------- ---------------- ----------------
  N1 (SDUs)                                                                                 13          13              7                104

  N2 (SDUs)                                                                                 25          25              50               25

  N3 (SDUs)                                                                                 50          50              50               50

  D (octets)                                                                                1153        576             1153             1153

  T1 (ms)                                                                                   20          20              20               10

  T2 (ms)                                                                                   500         700             500              500

  D1 (octets)                                                                               4160        4160            2240             33350 (Note 1)

  D2 (octets)                                                                               8000        8000            10435 (Note 1)   8000

  D3 (octets)                                                                               16000       7790 (Note 1)   16000            16000

  Note 1: Calculated using the following equation for the case of the least header size:\                                                
  (D1 + D2 + D3) = (D - 6) \* T2 / T1                                                                                                    
  -------------------------------------------------------------------------------------------------------------------------------------------------------

NOTE: The Test parameter values above and the test procedure assume that
the UE has a loopback buffer of at least 57280 octets.

##### 7.1.1.3.2.3.3 Specific message contents {#specific-message-contents-1 .H6}

Table 7.1.1.3.2.3.3-1: SchedulingRequest-Config (Preamble)

  -------------------------------------------------- -------------- --------- -----------
  Derivation Path: 38.508-1 \[4\], Table 4.6.3-155                            
  Information Element                                Value/remark   Comment   Condition
  sr-TransMax                                        n64                      
  -------------------------------------------------- -------------- --------- -----------

##### 7.1.1.3.2b Logical channel prioritization handling with Mapping restrictions

##### 7.1.1.3.2b.1 Test Purpose (TP) {#b.1-test-purpose-tp .H6}

##### (1) {#section-10 .H6}

**with** {UE in RRC\_CONNECTED state with allowedSCS-List configured }

**ensure that** {

**when** { UE is sending data on the uplink }

**then** { UE serves the logical channels according to their priority
and configured PBR and respecting allowedSCS-List }

}

##### (2) {#section-11 .H6}

**with** {UE in RRC\_CONNECTED state with maxPUSCH-Duration configured }

**ensure that** {

**when** { UE is sending data on the uplink }

**then** { UE serves the logical channels according to their priority
and configured PBR and respecting maxPUSCH-Duration }

}

##### (3) {#section-12 .H6}

**with** { UE in RRC\_CONNECTED state with configuredGrantType1Allowed
configured and supporting Type 1 PUSCH transmissions with configured
grant }

**ensure that** {

**when** { UE is sending data on the uplink }

**then** { UE serves the logical channels according to their priority
and configured PBR and respecting configuredGrantType1Allowed }

}

##### 7.1.1.3.2b.2 Conformance requirements {#b.2-conformance-requirements .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.321, clause 5.4.3.1.1, 5.4.3.1.2, 5.4.3.1.3. Unless
otherwise stated these are Rel-15 requirements.

\[TS 38.321, clause 5.4.3.1.1\]

The Logical Channel Prioritization (LCP) procedure is applied whenever a
new transmission is performed.

RRC controls the scheduling of uplink data by signalling for each
logical channel per MAC entity:

\- *priority* where an increasing priority value indicates a lower
priority level;

\- *prioritisedBitRate* which sets the Prioritized Bit Rate (PBR);

\- *bucketSizeDuration* which sets the Bucket Size Duration (BSD).

RRC additionally controls the LCP procedure by configuring mapping
restrictions for each logical channel:

\- *allowedSCS-List* which sets the allowed Subcarrier Spacing(s) for
transmission;

\- *maxPUSCH-Duration* which sets the maximum PUSCH duration allowed for
transmission;

\- *configuredGrantType1Allowed* which sets whether a configured grant
Type 1 can be used for transmission;

\- *allowedServingCells* which sets the allowed cell(s) for
transmission.

The following UE variable is used for the Logical channel prioritization
procedure:

\- *Bj* which is maintained for each logical channel *j*.

The MAC entity shall initialize *Bj* of the logical channel to zero when
the logical channel is established.

For each logical channel *j*, the MAC entity shall:

1\> increment *Bj* by the product PBR Ã T before every instance of the
LCP procedure, where T is the time elapsed since *Bj* was last
incremented;

1\> if the value of *Bj* is greater than the bucket size (i.e. PBR Ã
BSD):

2\> set *Bj* to the bucket size.

NOTE: The exact moment(s) when the UE updates *Bj* between LCP
procedures is up to UE implementation, as long as *Bj* is up to date at
the time when a grant is processed by LCP.

\[TS 38.321, clause 5.4.3.1.2\]

The MAC entity shall, when a new transmission is performed:

1\> select the logical channels for each UL grant that satisfy all the
following conditions:

2\> the set of allowed Subcarrier Spacing index values in
*allowedSCS-List*, if configured, includes the Subcarrier Spacing index
associated to the UL grant; and

2\> *maxPUSCH-Duration*, if configured, is larger than or equal to the
PUSCH transmission duration associated to the UL grant; and

2\> *configuredGrantType1Allowed*, if configured, is set to *true* in
case the UL grant is a Configured Grant Type 1; and

2\> *allowedServingCells*, if configured, includes the Cell information
associated to the UL grant. Does not apply to logical channels
associated with a DRB configured with PDCP duplication within the same
MAC entity (i.e. CA duplication) for which PDCP duplication is
deactivated.

NOTE: The Subcarrier Spacing index, PUSCH transmission duration and Cell
information are included in Uplink transmission information received
from lower layers for the corresponding scheduled uplink transmission.

\[TS 38.321, clause 5.4.3.1.3\]

The MAC entity shall, when a new transmission is performed:

1\> allocate resources to the logical channels as follows:

2\> logical channels selected in subclause 5.4.3.1.2 for the UL grant
with *Bj* \> 0 are allocated resources in a decreasing priority order.
If the PBR of a logical channel is set to *infinity*, the MAC entity
shall allocate resources for all the data that is available for
transmission on the logical channel before meeting the PBR of the lower
priority logical channel(s);

2\> decrement *Bj* by the total size of MAC SDUs served to logical
channel *j* above;

2\> if any resources remain, all the logical channels selected in
subclause 5.4.3.1.2 are served in a strict decreasing priority order
(regardless of the value of *Bj*) until either the data for that logical
channel or the UL grant is exhausted, whichever comes first. Logical
channels configured with equal priority should be served equally.

NOTE: The value of *Bj* can be negative.

If the MAC entity is requested to simultaneously transmit multiple MAC
PDUs, or if the MAC entity receives the multiple UL grants within one or
more coinciding PDCCH occasions (i.e. on different Serving Cells), it is
up to UE implementation in which order the grants are processed.

The UE shall also follow the rules below during the scheduling
procedures above:

\- the UE should not segment an RLC SDU (or partially transmitted SDU or
retransmitted RLC PDU) if the whole SDU (or partially transmitted SDU or
retransmitted RLC PDU) fits into the remaining resources of the
associated MAC entity;

\- if the UE segments an RLC SDU from the logical channel, it shall
maximize the size of the segment to fill the grant of the associated MAC
entity as much as possible;

\- the UE should maximise the transmission of data;

\- if the MAC entity is given a UL grant size that is equal to or larger
than 8 bytes while having data available and allowed (according to
subclause 5.4.3.1) for transmission, the MAC entity shall not transmit
only padding BSR and/or padding.

The MAC entity shall not generate a MAC PDU for the HARQ entity if the
following conditions are satisfied:

\- the MAC entity is configured with *skipUplinkTxDynamic* with value
*true* and the grant indicated to the HARQ entity was addressed to a
C-RNTI, or the grant indicated to the HARQ entity is a configured uplink
grant; and

\- there is no aperiodic CSI requested for this PUSCH transmission as
specified in TS 38.212 \[9\]; and

\- the MAC PDU includes zero MAC SDUs; and

\- the MAC PDU includes only the periodic BSR and there is no data
available for any LCG, or the MAC PDU includes only the padding BSR.

Logical channels shall be prioritised in accordance with the following
order (highest priority listed first):

\- C-RNTI MAC CE or data from UL-CCCH;

\- Configured Grant Confirmation MAC CE;

\- MAC CE for BSR, with exception of BSR included for padding;

\- Single Entry PHR MAC CE or Multiple Entry PHR MAC CE;

\- data from any Logical Channel, except data from UL-CCCH;

\- MAC CE for Recommended bit rate query;

\- MAC CE for BSR included for padding.

##### 7.1.1.3.2b.3 Test description {#b.3-test-description .H6}

##### 7.1.1.3.2b.3.1 Pre-test conditions {#b.3.1-pre-test-conditions .H6}

Same Pre-test conditions as in clause 7.1.1.0 with the exception of 3 UM
NR DRBs configured according to Table 7.1.1.3.2b.3.1-1.

Table 7.1.1.3.2b.3.1-1: Priority, PBR, Bucket Delay allowed-SCSList
settings

  DRB    priority   prioritizedBitRate (kbytes/s)   bucketSizeDuration (ms)   allowed-SCSList        
  ------ ---------- ------------------------------- ------------------------- ---------------------- -----------------
                                                                              FR1                    FR2
  DRB1   6          8                               100                       {15KHz, 30KHz}         {60KHz, 120KHz}
  DRB2   7          16                              100                       {60KHz}                {60KHz}
  DRB3   8          32                              100                       {15KHz, 30KHz,60KHz}   {120KHz}

Table 7.1.1.3.2b.3.1-2: allowed-SCSList and maxPUSCH-Duration settings

  DRB    allowed-SCSList   maxPUSCH-Duration
  ------ ----------------- -------------------
  DRB1   Not Present       ms0p02
  DRB2   Not Present       ms0p5
  DRB3   Not Present       ms0p5

Table 7.1.1.3.2b.3.1-2a: PUSCH-TimeDomainResourceAllocationList

  ------------------------------------------------------------------------------------------------------------------------------ -------------- --------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], table 4.6.3-122                                                                                                                             
  Information Element                                                                                                            Value/remark   Comment                           Condition
  PUSCH-TimeDomainResourceAllocationList ::= SEQUENCE (SIZE(1..maxNrofUL-Allocations)) OF PUSCH-TimeDomainResourceAllocation {   2 entry                                          
  PUSCH-TimeDomainResourceAllocation\[1\] SEQUENCE {                                                                                            entry 1                           
  k2                                                                                                                             n4                                               FR1
                                                                                                                                 n8                                               FR2
  mappingType                                                                                                                    typeB                                            
  startSymbolAndLength                                                                                                           52             Start symbol(S)=10, Length(L)=4   FR1
  startSymbolAndLength                                                                                                           42             Start symbol(S)=0, Length(L)=4    FR2
  }                                                                                                                                                                               
  PUSCH-TimeDomainResourceAllocation\[2\] SEQUENCE {                                                                                            entry 2                           
  k2                                                                                                                             n4                                               FR1
                                                                                                                                 n8                                               FR2
  mappingType                                                                                                                    typeB                                            
  startSymbolAndLength                                                                                                           27             Start symbol(S)=0, Length(L)=14   
  }                                                                                                                                                                               
  }                                                                                                                                                                               
  ------------------------------------------------------------------------------------------------------------------------------ -------------- --------------------------------- -----------

Table 7.1.1.3.2b.3.1-3: maxPUSCH-Duration and
configuredGrantType1Allowed settings

  RB     maxPUSCH-Duration   configuredGrantType1Allowed
  ------ ------------------- -----------------------------
  SRB1   Not Present         true
  DRB1   Not Present         true
  DRB2   Not Present         false
  DRB3   Not Present         true

Table 7.1.1.3.2b.3.1-4: PDCP Settings

  Parameter        Value
  ---------------- --------
  Discard\_Timer   ms1500

##### 7.1.1.3.2b.3.2 Test procedure sequence {#b.3.2-test-procedure-sequence .H6}

Table 7.1.1.3.2b.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Steps 1   |           |           |         |    |
|           | to 3 are  |           |           |         |    |
|           | run using |           |           |         |    |
|           | the       |           |           |         |    |
|           | p         |           |           |         |    |
|           | arameters |           |           |         |    |
|           | specified |           |           |         |    |
|           | for first |           |           |         |    |
|           | run in    |           |           |         |    |
|           | table     |           |           |         |    |
|           | 7.1.1.3.  |           |           |         |    |
|           | 2b.3.2-3. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\--     | (RLC      | \-      | \- |
|           | transmits |           | SDUs)     |         |    |
|           | N1        |           |           |         |    |
|           | 320-octet |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | on DRB1,  |           |           |         |    |
|           | N2        |           |           |         |    |
|           | 320-octet |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | on DRB2,  |           |           |         |    |
|           | and N3    |           |           |         |    |
|           | 320-octet |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | on DRB3.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | In        |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | event     |           |           |         |    |
|           | described |           |           |         |    |
|           | in step 2 |           |           |         |    |
|           | the       |           |           |         |    |
|           | events    |           |           |         |    |
|           | specified |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.3   |           |           |         |    |
|           | .2b.3.2-2 |           |           |         |    |
|           | shall     |           |           |         |    |
|           | take      |           |           |         |    |
|           | place.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The SS is | \<\--     | (UL       | \-      | \- |
|           | c         |           | grants)   |         |    |
|           | onfigured |           |           |         |    |
|           | for       |           |           |         |    |
|           | Uplink    |           |           |         |    |
|           | Grant     |           |           |         |    |
|           | A         |           |           |         |    |
|           | llocation |           |           |         |    |
|           | Type 2 as |           |           |         |    |
|           | defined   |           |           |         |    |
|           | in TS     |           |           |         |    |
|           | 38.523-3  |           |           |         |    |
|           | \[3\].    |           |           |         |    |
|           | 150 ms    |           |           |         |    |
|           | after     |           |           |         |    |
|           | Step 1    |           |           |         |    |
|           | (Note 1), |           |           |         |    |
|           | for a     |           |           |         |    |
|           | duration  |           |           |         |    |
|           | of T2,    |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | an UL     |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | D octets  |           |           |         |    |
|           | every T1. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | Check:    | \-        | \-        | 1       | P  |
|           | Are the   |           |           |         |    |
|           | total     |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets of |           |           |         |    |
|           | the UL    |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | received  |           |           |         |    |
|           | at the SS |           |           |         |    |
|           | for each  |           |           |         |    |
|           | DRB as    |           |           |         |    |
|           | follows:  |           |           |         |    |
|           |           |           |           |         |    |
|           | \- total  |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets    |           |           |         |    |
|           | received  |           |           |         |    |
|           | for DRB1  |           |           |         |    |
|           | is D1     |           |           |         |    |
|           | octets    |           |           |         |    |
|           | +/- 10%   |           |           |         |    |
|           |           |           |           |         |    |
|           | \- total  |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets    |           |           |         |    |
|           | received  |           |           |         |    |
|           | for DRB2  |           |           |         |    |
|           | is 0      |           |           |         |    |
|           |           |           |           |         |    |
|           | \- total  |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets    |           |           |         |    |
|           | received  |           |           |         |    |
|           | for DRB3  |           |           |         |    |
|           | is        |           |           |         |    |
|           |           |           |           |         |    |
|           | D3 octets |           |           |         |    |
|           | +/- 10%   |           |           |         |    |
|           | o         |           |           |         |    |
|           | therwise? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | SS        | \<\--     | (NR RRC:  | \-      | \- |
|           | transmits |           | *RR       |         |    |
|           | NR        |           | CReconfig |         |    |
|           | *R        |           | uration*) |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | configure |           |           |         |    |
|           | allowe    |           |           |         |    |
|           | d-SCSList |           |           |         |    |
|           | and       |           |           |         |    |
|           | maxPUSCH  |           |           |         |    |
|           | -Duration |           |           |         |    |
|           | as per    |           |           |         |    |
|           | Table     |           |           |         |    |
|           | 7.1.1.3.  |           |           |         |    |
|           | 2b.3.1-2. |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | In        |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | event     |           |           |         |    |
|           | described |           |           |         |    |
|           | in step 5 |           |           |         |    |
|           | the       |           |           |         |    |
|           | events    |           |           |         |    |
|           | specified |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.3.  |           |           |         |    |
|           | 2b.3.2-2a |           |           |         |    |
|           | shall     |           |           |         |    |
|           | take      |           |           |         |    |
|           | place on  |           |           |         |    |
|           | DRB2      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | The UE    | \--\>     | (NR RRC:  | \-      | \- |
|           | transmits |           | *R        |         |    |
|           | NR        |           | RCReconfi |         |    |
|           | *         |           | gurationC |         |    |
|           | RRCReconf |           | omplete*) |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message.  |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Steps 6   |           |           |         |    |
|           | to 8 are  |           |           |         |    |
|           | run using |           |           |         |    |
|           | the       |           |           |         |    |
|           | p         |           |           |         |    |
|           | arameters |           |           |         |    |
|           | specified |           |           |         |    |
|           | for       |           |           |         |    |
|           | second    |           |           |         |    |
|           | run in    |           |           |         |    |
|           | table     |           |           |         |    |
|           | 7.1.1.3.  |           |           |         |    |
|           | 2b.3.1-2. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The SS    | \<\--     | (RLC      | \-      | \- |
|           | transmits |           | SDUs)     |         |    |
|           | N1        |           |           |         |    |
|           | 320-octet |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | on DRB1,  |           |           |         |    |
|           | N2        |           |           |         |    |
|           | 320-octet |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | on DRB2,  |           |           |         |    |
|           | and N3    |           |           |         |    |
|           | 320-octet |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | on DRB3.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | In        |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | event     |           |           |         |    |
|           | described |           |           |         |    |
|           | in step 7 |           |           |         |    |
|           | the       |           |           |         |    |
|           | events    |           |           |         |    |
|           | specified |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.3   |           |           |         |    |
|           | .2b.3.2-2 |           |           |         |    |
|           | shall     |           |           |         |    |
|           | take      |           |           |         |    |
|           | place.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The SS is | \<\--     | (UL       | \-      | \- |
|           | c         |           | grants)   |         |    |
|           | onfigured |           |           |         |    |
|           | for       |           |           |         |    |
|           | Uplink    |           |           |         |    |
|           | Grant     |           |           |         |    |
|           | A         |           |           |         |    |
|           | llocation |           |           |         |    |
|           | Type 2 as |           |           |         |    |
|           | defined   |           |           |         |    |
|           | in TS     |           |           |         |    |
|           | 38.523-3  |           |           |         |    |
|           | \[3\].    |           |           |         |    |
|           | 150 ms    |           |           |         |    |
|           | after     |           |           |         |    |
|           | Step 6    |           |           |         |    |
|           | (Note 1), |           |           |         |    |
|           | for a     |           |           |         |    |
|           | duration  |           |           |         |    |
|           | of T2,    |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | an UL     |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | D octets  |           |           |         |    |
|           | every T1. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | Check:    | \-        | \-        | 2       | P  |
|           | Are the   |           |           |         |    |
|           | total     |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets of |           |           |         |    |
|           | the UL    |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | received  |           |           |         |    |
|           | at the SS |           |           |         |    |
|           | for each  |           |           |         |    |
|           | DRB as    |           |           |         |    |
|           | follows:  |           |           |         |    |
|           |           |           |           |         |    |
|           | \- total  |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets    |           |           |         |    |
|           | received  |           |           |         |    |
|           | for DRB1  |           |           |         |    |
|           | are 0     |           |           |         |    |
|           |           |           |           |         |    |
|           | \- total  |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets    |           |           |         |    |
|           | received  |           |           |         |    |
|           | for DRB2  |           |           |         |    |
|           | are D2    |           |           |         |    |
|           | octets    |           |           |         |    |
|           | +/- 10%   |           |           |         |    |
|           |           |           |           |         |    |
|           | \- total  |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets    |           |           |         |    |
|           | received  |           |           |         |    |
|           | for DRB3  |           |           |         |    |
|           | are D3    |           |           |         |    |
|           | octets    |           |           |         |    |
|           | +/- 10%?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Steps 9   |           |           |         |    |
|           | to 16     |           |           |         |    |
|           | describe  |           |           |         |    |
|           | behaviour |           |           |         |    |
|           | that      |           |           |         |    |
|           | depends   |           |           |         |    |
|           | on the UE |           |           |         |    |
|           | ca        |           |           |         |    |
|           | pability. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | IF        | \<\--     | (NR RRC:  | \-      | \- |
|           | p         |           | *RR       |         |    |
|           | c\_config |           | CReconfig |         |    |
|           | uredUL\_G |           | uration*) |         |    |
|           | rantType1 |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | NR        |           |           |         |    |
|           | *R        |           |           |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | configure |           |           |         |    |
|           | UL        |           |           |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | grant     |           |           |         |    |
|           | type 1    |           |           |         |    |
|           | for a     |           |           |         |    |
|           | duration  |           |           |         |    |
|           | of T2 and |           |           |         |    |
|           | an UL     |           |           |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | grant     |           |           |         |    |
|           | type1 of  |           |           |         |    |
|           | D octets  |           |           |         |    |
|           | every T1. |           |           |         |    |
|           | It also   |           |           |         |    |
|           | configure |           |           |         |    |
|           | smaxPUSCH |           |           |         |    |
|           | -Duration |           |           |         |    |
|           | and       |           |           |         |    |
|           | configure |           |           |         |    |
|           | dGrantTyp |           |           |         |    |
|           | e1Allowed |           |           |         |    |
|           | as per    |           |           |         |    |
|           | Table     |           |           |         |    |
|           | 7.1.1.3   |           |           |         |    |
|           | .2b.3.1-3 |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | In        |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | event     |           |           |         |    |
|           | described |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 10 the    |           |           |         |    |
|           | events    |           |           |         |    |
|           | specified |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.3.  |           |           |         |    |
|           | 2b.3.2-2a |           |           |         |    |
|           | shall     |           |           |         |    |
|           | take      |           |           |         |    |
|           | place on  |           |           |         |    |
|           | DRB1      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | The UE    | \--\>     | (NR RRC:  | \-      | \- |
|           | transmits |           | *R        |         |    |
|           | NR        |           | RCReconfi |         |    |
|           | *         |           | gurationC |         |    |
|           | RRCReconf |           | omplete*) |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message.  |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Steps 11  |           |           |         |    |
|           | to 13 are |           |           |         |    |
|           | run using |           |           |         |    |
|           | the       |           |           |         |    |
|           | p         |           |           |         |    |
|           | arameters |           |           |         |    |
|           | specified |           |           |         |    |
|           | for third |           |           |         |    |
|           | run in    |           |           |         |    |
|           | table     |           |           |         |    |
|           | 7.1.1.3.  |           |           |         |    |
|           | 2b.3.1-3. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | The SS    | \<\--     | (RLC      | \-      | \- |
|           | transmits |           | SDUs)     |         |    |
|           | in SFN    |           |           |         |    |
|           | 1022, N1  |           |           |         |    |
|           | 320-octet |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | on DRB1,  |           |           |         |    |
|           | N2        |           |           |         |    |
|           | 320-octet |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | on DRB2,  |           |           |         |    |
|           | and N3    |           |           |         |    |
|           | 320-octet |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | on DRB3.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | In        |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | event     |           |           |         |    |
|           | described |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 12 the    |           |           |         |    |
|           | events    |           |           |         |    |
|           | specified |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.3   |           |           |         |    |
|           | .2b.3.2-2 |           |           |         |    |
|           | shall     |           |           |         |    |
|           | take      |           |           |         |    |
|           | place.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | Check:    | \-        | \-        | 3       | P  |
|           | Are the   |           |           |         |    |
|           | total     |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets of |           |           |         |    |
|           | the UL    |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | received  |           |           |         |    |
|           | at the SS |           |           |         |    |
|           | for each  |           |           |         |    |
|           | DRB as    |           |           |         |    |
|           | follows:  |           |           |         |    |
|           |           |           |           |         |    |
|           | \- total  |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets    |           |           |         |    |
|           | received  |           |           |         |    |
|           | for DRB1  |           |           |         |    |
|           | are D1    |           |           |         |    |
|           | octets    |           |           |         |    |
|           | +/- 10%   |           |           |         |    |
|           |           |           |           |         |    |
|           | \- total  |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets    |           |           |         |    |
|           | received  |           |           |         |    |
|           | for DRB2  |           |           |         |    |
|           | are 0     |           |           |         |    |
|           |           |           |           |         |    |
|           | \- total  |           |           |         |    |
|           | number of |           |           |         |    |
|           | octets    |           |           |         |    |
|           | received  |           |           |         |    |
|           | for DRB3  |           |           |         |    |
|           | are D3    |           |           |         |    |
|           | octets    |           |           |         |    |
|           | +/- 10%?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | The SS    | \<\--     | (UL       | \-      | \- |
|           | sends one |           | grants)   |         |    |
|           | Uplink    |           |           |         |    |
|           | Grant to  |           |           |         |    |
|           | send loop |           |           |         |    |
|           | back PDU  |           |           |         |    |
|           | on DRB 2. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | The UE    | \--\>     | \-        | \-      | \- |
|           | transmits |           |           |         |    |
|           | the RLC   |           |           |         |    |
|           | SDU back  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | SS.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | SS        | \<\--     | (NR RRC:  | \-      | \- |
|           | transmits |           | *RR       |         |    |
|           | NR        |           | CReconfig |         |    |
|           | *R        |           | uration)* |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | release   |           |           |         |    |
|           | UL        |           |           |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | grant     |           |           |         |    |
|           | type 1*.* |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 16        | The UE    | \--\>     | (NR RRC:  | \-      | \- |
|           | transmits |           | *R        |         |    |
|           | NR        |           | RCReconfi |         |    |
|           | *         |           | gurationC |         |    |
|           | RRCReconf |           | omplete)* |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | m         |           |           |         |    |
|           | essage*.* |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| This wait |           |           |           |         |    |
| time will |           |           |           |         |    |
| ensure    |           |           |           |         |    |
| that a)   |           |           |           |         |    |
| all       |           |           |           |         |    |
| octets    |           |           |           |         |    |
| have been |           |           |           |         |    |
| c         |           |           |           |         |    |
| ompletely |           |           |           |         |    |
| received  |           |           |           |         |    |
| by the UE |           |           |           |         |    |
| on all 3  |           |           |           |         |    |
| DRBs      |           |           |           |         |    |
| before    |           |           |           |         |    |
| the first |           |           |           |         |    |
| UL grant  |           |           |           |         |    |
| is        |           |           |           |         |    |
| received  |           |           |           |         |    |
| and b)    |           |           |           |         |    |
| the Bjs   |           |           |           |         |    |
| for each  |           |           |           |         |    |
| logical   |           |           |           |         |    |
| channel   |           |           |           |         |    |
| have      |           |           |           |         |    |
| reached   |           |           |           |         |    |
| their     |           |           |           |         |    |
| maximum   |           |           |           |         |    |
| value     |           |           |           |         |    |
| i.e. the  |           |           |           |         |    |
| bucket    |           |           |           |         |    |
| size of   |           |           |           |         |    |
| the       |           |           |           |         |    |
| corr      |           |           |           |         |    |
| esponding |           |           |           |         |    |
| logical   |           |           |           |         |    |
| channel   |           |           |           |         |    |
| before    |           |           |           |         |    |
| the first |           |           |           |         |    |
| UL grant  |           |           |           |         |    |
| is        |           |           |           |         |    |
| received. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| 36.508    |           |           |           |         |    |
| \[7\],    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 4.6.1-8   |           |           |           |         |    |
| using     |           |           |           |         |    |
| condition |           |           |           |         |    |
| EN-DC\_   |           |           |           |         |    |
| EmbedNR\_ |           |           |           |         |    |
| RRCRecon. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *         |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *R        |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete* |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

Table 7.1.1.3.2b.3.2-2: Parallel behaviour

  St   Procedure                                                  Message Sequence   TP        Verdict   
  ---- ---------------------------------------------------------- ------------------ --------- --------- ---
                                                                  U -- S             Message             
  1    Check: Does the UE transmit the RLC SDUs back to the SS?   \--\>              \-        1,2,3     P

Table 7.1.1.3.2b.3.2-2a: Parallel behaviour

  St   Procedure                                                           Message Sequence   TP        Verdict   
  ---- ------------------------------------------------------------------- ------------------ --------- --------- ----
                                                                           U -- S             Message             
  1    The UE may transmit the RLC SDU back to the SS within one second.   \--\>              \-        \-        \-

Table 7.1.1.3.2b.3.2-3: Test parameter values

  Parameter                                                                                                                    First run   Second run   Third run
  ---------------------------------------------------------------------------------------------------------------------------- ----------- ------------ -----------
  N1 (SDUs)                                                                                                                    13          1            13
  N2 (SDUs)                                                                                                                    1           25           1
  N3 (SDUs)                                                                                                                    50          50           50
  D (octets)                                                                                                                   1153        576          1153
  T1 (ms)                                                                                                                      20          20           40
  T2 (ms)                                                                                                                      360         860          720
  D1 (octets)                                                                                                                  4160        0            4160
  D2 (octets)                                                                                                                  0           8000         0
  D3 (octets)                                                                                                                  16000       16000        16000
  Note 1: Calculated using the following equation for the case of the least header size:(D1 + D2 + D3) = (D - 6) \* T2 / T1.                            

##### 7.1.1.3.2b.3.3 Specific message contents {#b.3.3-specific-message-contents .H6}

Table 7.1.1.3.2b.3.3-1: SchedulingRequestConfig (Preamble)

  ---------------------------------------------------------------------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-155                                                                                       
  Information Element                                                                                              Value/remark   Comment   Condition
  SchedulingRequestConfig ::= CHOICE {                                                                                                      
  schedulingRequestToAddModList SEQUENCE (SIZE(1..maxNrofSR-ConfigPerCellGroup)) OF SSchedulingRequestToAddMod {   1 entry                  
  SchedulingRequestToAddMod\[1\] SEQUENCE {                                                                                       entry 1   
  sr-TransMax                                                                                                      n64                      
  }                                                                                                                                         
  }                                                                                                                                         
  }                                                                                                                                         
  ---------------------------------------------------------------------------------------------------------------- -------------- --------- -----------

Table 7.1.1.3.2b.3.3-2: *RRCReconfiguration* (step 9, Table
7.1.1.3.2b.3.2-1)

  Derivation path: TS 38.508-1 \[4\], Table 4.6.1-13                                                                 
  ---------------------------------------------------- ----------------- ------------------------------------------- -----------
  Information Element                                  Value/remark      Comment                                     Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                  
  criticalExtensions CHOICE {                                                                                        
  rrcReconfiguration SEQUENCE {                                                                                      
  radioBearerConfig                                    Not present                                                   
  secondaryCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   EN-DC
  nonCriticalExtension                                 Not present                                                   EN-DC
  nonCriticalExtension SEQUENCE{                                                                                     NR
  masterCellGroup                                      CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   
  dedicatedNAS-MessageList                             Not present                                                   
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  

Table 7.1.1.3.2b.3.3-3: *CellGroupConfig* (Table 7.1.1.3.2b.3.3-2:
*RRCReconfiguration*)

+-----------------+-----------------+-----------------+-----------+
| Derivation      |                 |                 |           |
| path: TS        |                 |                 |           |
| 38.508-1 \[4\], |                 |                 |           |
| Table 4.6.3-19  |                 |                 |           |
+=================+=================+=================+===========+
| Information     | Value/remark    | Comment         | Condition |
| Element         |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| CellGroupConfig |                 |                 |           |
| ::= SEQUENCE {  |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| rlc-Bea         | Not present     |                 |           |
| rerToAddModList |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| mac-            | Not present     |                 |           |
| CellGroupConfig |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| physical        |                 |                 |           |
| CellGroupConfig |                 |                 |           |
| SEQUENCE {      |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| cs-RNTI CHOICE  |                 |                 |           |
| {               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| setup SEQUENCE{ |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| RNTI-Value      | 'FFE0'H         |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| spCellConfig    |                 |                 |           |
| SEQUENCE{       |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| servCellIndex   | Not present     |                 | NR        |
+-----------------+-----------------+-----------------+-----------+
|                 | 1               |                 | EN-DC     |
+-----------------+-----------------+-----------------+-----------+
| reconfig        | Not present     |                 |           |
| urationWithSync |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| spCell          |                 |                 |           |
| ConfigDedicated |                 |                 |           |
| SEQUENCE{       |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| uplinkConfig    |                 |                 |           |
| SEQUENCE {      |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| i               |                 |                 |           |
| nitialUplinkBWP |                 |                 |           |
| SEQUENCE {      |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| pucch-Config    |                 |                 |           |
| CHOICE {        |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| setup SEQUENCE  |                 |                 |           |
| {               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| schedul         |                 |                 |           |
| ingRequestResou |                 |                 |           |
| rceToAddModList |                 |                 |           |
| {               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| schedulingRe    | 1               |                 |           |
| questResourceId |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| sche            | 0               |                 |           |
| dulingRequestID |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| perio           |                 |                 |           |
| dicityAndOffset |                 |                 |           |
| CHOICE {        |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| sl20            | 9               |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| config          |                 |                 |           |
| uredGrantConfig |                 |                 |           |
| CHOICE {        |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| setup SEQUENCE  |                 |                 |           |
| {               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| cg-DMR          | DM              | Reference TS    |           |
| S-Configuration | RS-UplinkConfig | 38.508-1\[4\],  |           |
|                 |                 | Table 4.6.3-51  |           |
+-----------------+-----------------+-----------------+-----------+
| uci-OnPUSCH     |                 |                 |           |
| CHOICE {        |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| setup SEQUENCE  |                 |                 |           |
| {               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| semiStatic      | BetaOffsets     |                 |           |
| SEQUENCE {      |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| betaO           | 9               |                 |           |
| ffsetACK-Index1 |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| betaO           | 9               |                 |           |
| ffsetACK-Index2 |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| betaO           | 9               |                 |           |
| ffsetACK-Index3 |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| betaOffsetC     | 6               |                 |           |
| SI-Part1-Index1 |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| betaOffsetC     | 6               |                 |           |
| SI-Part1-Index2 |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| betaOffsetC     | 6               |                 |           |
| SI-Part2-Index1 |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| betaOffsetC     | 6               |                 |           |
| SI-Part2-Index2 |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| res             | Resource        |                 |           |
| ourceAllocation | AllocationType1 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| powerC          | n0              |                 |           |
| ontrolLoopToUse |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| p0-PUSCH-Alpha  | 1               |                 |           |
+-----------------+-----------------+-----------------+-----------+
| nro             | 16              |                 |           |
| fHARQ-Processes |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| repK            | n1              |                 |           |
+-----------------+-----------------+-----------------+-----------+
| periodicity     | Sym40x14        | 40ms            | 15kHz     |
+-----------------+-----------------+-----------------+-----------+
| periodicity     | Sym80x14        | 40ms            | 30kHz     |
+-----------------+-----------------+-----------------+-----------+
| periodicity     | Sym160x14       | 40ms            | 60kHz     |
+-----------------+-----------------+-----------------+-----------+
| periodicity     | Sym320x14       | 40ms            | 120kHz    |
+-----------------+-----------------+-----------------+-----------+
| rrc-Config      |                 |                 |           |
| uredUplinkGrant |                 |                 |           |
| SEQUENCE{       |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| t               | 9               |                 |           |
| imeDomainOffset |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| timeD           | 0               | Reference TS    |           |
| omainAllocation |                 | 38.508-1 \[4\], |           |
|                 |                 | Table 4.6.3-122 |           |
+-----------------+-----------------+-----------------+-----------+
| frequencyD      | BIT STRING      | BIT STRING      |           |
| omainAllocation | (SIZE(18)       | (SIZE(18),      |           |
|                 |                 | Equal to        |           |
|                 |                 |                 |           |
|                 |                 | NBWPsize \*     |           |
|                 |                 | (LRB-1) +       |           |
|                 |                 | RBstart), where |           |
|                 |                 |                 |           |
|                 |                 | LRB = 23 PRB,   |           |
|                 |                 |                 |           |
|                 |                 | RBstart = 0,    |           |
|                 |                 |                 |           |
|                 |                 | NBWPsize is the |           |
|                 |                 | size \[PRBs\]   |           |
|                 |                 | of the active   |           |
|                 |                 | carrier         |           |
|                 |                 | bandwidth part  |           |
|                 |                 | and ontained in |           |
|                 |                 | TS.38.508-1     |           |
|                 |                 | \[4\] clause    |           |
|                 |                 | 4.3.1.1.        |           |
+-----------------+-----------------+-----------------+-----------+
| antennaPort     | 0               |                 |           |
+-----------------+-----------------+-----------------+-----------+
| precodingAn     | 0               |                 |           |
| dNumberOfLayers |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| srs-Re          | Not present     |                 |           |
| sourceIndicator |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| mcsAndTBS       | 16              |                 |           |
+-----------------+-----------------+-----------------+-----------+
| pathlos         | 0               |                 |           |
| sReferenceIndex |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+

Table 7.1.1.3.2b.3.3-4: *RRCReconfiguration* (step 15, Table
7.1.1.3.2b.3.2-1)

  Derivation path: TS 38.508-1 \[4\], Table 4.6.1-13                                                                 
  ---------------------------------------------------- ----------------- ------------------------------------------- -----------
  Information Element                                  Value/remark      Comment                                     Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                  
  criticalExtensions CHOICE {                                                                                        
  rrcReconfiguration SEQUENCE {                                                                                      
  radioBearerConfig                                    Not present                                                   
  secondaryCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   EN-DC
                                                       Not present                                                   NR
  nonCriticalExtension                                 Not present                                                   EN-DC
  nonCriticalExtension SEQUENCE {                                                                                    NR
  masterCellGroup                                      CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   
  dedicatedNAS-MessageList                             Not present                                                   
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  

Table 7.1.1.3.2b.3.3-5: *CellGroupConfig* (Table 7.1.1.3.2b.3.3-4)

  Derivation path: TS 38.508-1 \[4\], Table 4.6.3-19                            
  ---------------------------------------------------- -------------- --------- -----------
  Information Element                                  Value/remark   Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                
  spCellConfig SEQUENCE {                                                       
  spCellConfigDedicated SEQUENCE {                                              
  uplinkConfig SEQUENCE {                                                       
  initialUplinkBWP SEQUENCE {                                                   
  configuredGrantConfig CHOICE {                                                
  release                                              Null                     
  }                                                                             
  }                                                                             
  }                                                                             
  }                                                                             
  }                                                                             
  }                                                                             

##### 7.1.1.3.3 Correct handling of MAC control information / Scheduling requests

##### 7.1.1.3.3.1 Test Purpose (TP) {#test-purpose-tp-2 .H6}

##### (1) {#section-13 .H6}

**with** { UE in RRC\_CONNECTED state with SR resource on PUCCH is
configured }

**ensure that** {

**when** { UE has UL data available for transmission and UE has no
UL-SCH resources available and SR\_COUNTER is less than sr-TransMax }

**then** { the UE transmits a SR on every available PUCCH until
resources are granted }

}

##### (2) {#section-14 .H6}

**with** { UE in RRC\_CONNECTED state with SR resource on PUCCH is
configured }

**ensure that** {

**when** { UE receives an UL grant for a new transmission }

**then** { UE cancels all pending SR(s) }

}

##### (3) {#section-15 .H6}

**with** { UE in RRC\_CONNECTED state with SR resource on PUCCH is
configured }

**ensure that** {

**when** { UE has UL data available for transmission and UE has no
UL-SCH resources available and SR\_COUNTER becomes equal to sr-TransMax
}

**then** { the UE transmits a PRACH Preamble to initiate a Random Access
procedure }

}

##### (4) {#section-16 .H6}

**with** { UE in RRC\_CONNECTED state with SR resource on PUCCH is
configured and logicalChannelSR-DelayTimer is configured }

**ensure that** {

**when** { UE has UL data available for transmission on LCH for which
logicalChannelSR-DelayTimer is configured and UE has no UL-SCH resources
available and SR\_COUNTER is less than sr-TransMax }

**then** { the UE delays transmission of SR until
logicalChannelSR-DelayTimer expires }

}

##### (5) {#section-17 .H6}

**with** { UE in RRC\_CONNECTED state with SR resource on PUCCH is
configured }

**ensure that** {

**when** { UE has UL data available for transmission on LCH for which
logicalChannelSR-DelayTimer is not configured and UE has no UL-SCH
resources available and SR\_COUNTER is less than sr-TransMax }

**then** { the UE transmits a SR on every available PUCCH until
resources are granted }

}

##### 7.1.1.3.3.2 Conformance requirements {#conformance-requirements-2 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.321, clauses 5.4.4 and 5.4.5. Unless otherwise
stated these are Rel-15 requirements.

\[TS 38.321, clause 5.4.4\]

The Scheduling Request (SR) is used for requesting UL-SCH resources for
new transmission.

The MAC entity may be configured with zero, one, or more SR
configurations. An SR configuration consists of a set of PUCCH resources
for SR across different BWPs and cells. For a logical channel, at most
one PUCCH resource for SR is configured per BWP.

Each SR configuration corresponds to one or more logical channels. Each
logical channel may be mapped to zero or one SR configuration, which is
configured by RRC. The SR configuration of the LCH that triggered the
BSR (subclause 5.4.5) (if such a configuration exists) is considered as
corresponding SR configuration for the triggered SR. For BSR triggered
by *retxBSR-Timer* expiry, the corresponding SR configuration for the
triggered SR is that of the highest priority LCH (if such a
configuration exists) that has data available for transmission at the
time the BSR is triggered.

RRC configures the following parameters for the scheduling request
procedure:

\- *sr-ProhibitTimer* (per SR configuration);

\- *sr-TransMax* (per SR configuration);

\- *sr-ConfigIndex*.

The following UE variables are used for the scheduling request
procedure:

\- *SR\_COUNTER* (per SR configuration).

If an SR is triggered and there are no other SRs pending corresponding
to the same SR configuration, the MAC entity shall set the *SR\_COUNTER*
of the corresponding SR configuration to 0.

When an SR is triggered, it shall be considered as pending until it is
cancelled. All pending SR(s) shall be cancelled and each respective
*sr-ProhibitTimer* shall be stopped when a MAC PDU is assembled and this
PDU includes a BSR which contains buffer status up to (and including)
the last event that triggered a BSR (see subclause 5.4.5), or when the
UL grant(s) can accommodate all pending data available for transmission.

Only PUCCH resources on a BWP which is active at the time of SR
transmission occasion are considered valid.

As long as at least one SR is pending, the MAC entity shall for each
pending SR:

1\> if the MAC entity has no valid PUCCH resource configured for the
pending SR:

2\> initiate a Random Access procedure (see subclause 5.1) on the SpCell
and cancel the pending SR.

1\> else, for the SR configuration corresponding to the pending SR:

2\> when the MAC entity has an SR transmission occasion on the valid
PUCCH resource for SR configured; and

2\> if *sr-ProhibitTimer* is not running at the time of the SR
transmission occasion; and

2\> if the PUCCH resource for the SR transmission occasion does not
overlap with a measurement gap; and

2\> if the PUCCH resource for the SR transmission occasion does not
overlap with a UL-SCH resource:

3\> if *SR\_COUNTER* \< *sr-TransMax*:

4\> increment *SR\_COUNTER* by 1;

4\> instruct the physical layer to signal the SR on one valid PUCCH
resource for SR;

4\> start the *sr-ProhibitTimer*.

3\> else:

4\> notify RRC to release PUCCH for all serving cells;

4\> notify RRC to release SRS for all serving cells;

4\> clear any configured downlink assignments and uplink grants;

4\> initiate a Random Access procedure (see subclause 5.1) on the SpCell
and cancel all pending SRs.

NOTE: The selection of which valid PUCCH resource for SR to signal SR on
when the MAC entity has more than one overlapping valid PUCCH resource
for the SR transmission occasion is left to UE implementation.

\[TS 38.321, clause 5.4.5\]

For Regular BSR, the MAC entity shall:

1\> if the BSR is triggered for a logical channel for which
*logicalChannelSR-Delay* is configured by upper layers:

2\> start or restart the *logicalChannelSR-DelayTimer*.

1\> else:

2\> if running, stop the *logicalChannelSR-DelayTimer*.

...

The MAC entity shall:

1\> if the Buffer Status reporting procedure determines that at least
one BSR has been triggered and not cancelled:

2\> if UL-SCH resources are available for a new immediate transmission:

3\> instruct the Multiplexing and Assembly procedure to generate the BSR
MAC CE(s);

3\> start or restart *periodicBSR-Timer* except when all the generated
BSRs are long or short Truncated BSRs;

3\> start or restart *retxBSR-Timer*.

2\> else if a Regular BSR has been triggered and
*logicalChannelSR-DelayTimer* is not running:

3\> if an uplink grant is not a configured grant; or

3\> if the Regular BSR was not triggered for a logical channel for which
logical channel SR masking (*logicalChannelSR-Mask*) is setup by upper
layers:

4\> trigger a Scheduling Request.

##### 7.1.1.3.3.3 Test description {#test-description-2 .H6}

##### 7.1.1.3.3.3.1 Pre-test conditions {#pre-test-conditions-2 .H6}

Same Pre-test conditions as in clause 7.1.1.0 with the exception of 2 AM
DRBs configured according to Table 7.1.1.3.3.3.1-1 and Table
7.1.1.3.3.3.1-2 and with MAC-CellGroupConfig configured according to
Table 7.1.1.3.3.3.1-3 and Short\_DCI condition is applied in NR Serving
cell configuration.

Table 7.1.1.3.3.3.1-1: Logical Channel Configuration Settings

  Parameter                            DRB1                    DRB2
  ------------------------------------ ----------------------- -----------------------
  LogicalChannelIdentity               LCH4(DRB-Identity +3)   LCH5(DRB-Identity +3)
  Priority                             7                       6
  prioritizedBitRate                   0kbs                    0kbs
  logicalChannelGroup                  2 (LCG ID\#2)           1 (LCG ID\#1)
  logicalChannelSR-DelayTimerApplied   False                   True
  logicalChannelSR-DelayTimer          Not Present             sf512

Table 7.1.1.3.3.3.1-2: RLC parameters

  -------------------- ------
  *t-PollRetransmit*   ms80
  -------------------- ------

Table 7.1.1.3.3.3.1-3: MAC-CellGroupConfig

  --------------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.308 \[6\], clause Table 4.6.3-49                            
  Information Element                                       Value/remark   Comment   Condition
  MAC-CellGroupConfig ::= SEQUENCE {                                                 
  bsr-Config SEQUENCE {                                                              
  periodicBSR-Timer                                         infinity                 
  retxBSR-Timer                                             sf2560                   
  }                                                                                  
  phr-Config CHOICE {                                                                
  release                                                   NULL                     
  }                                                                                  
  }                                                                                  
  --------------------------------------------------------- -------------- --------- -----------

##### 7.1.1.3.3.3.2 Test procedure sequence {#test-procedure-sequence-2 .H6}

Table 7.1.1.3.3.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (c        |         |    |
|           | a MAC PDU |           | ontaining |         |    |
|           | c         |           | 1 MAC sub |         |    |
|           | ontaining |           | PDU)      |         |    |
|           | A MAC Sub |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a RLC SDU |           |           |         |    |
|           | on LCH 5  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | Check:    | \--\>     | (SR)      | 4       | F  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | S         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | Requests  |           |           |         |    |
|           | for       |           |           |         |    |
|           | logicalCh |           |           |         |    |
|           | annelSR-D |           |           |         |    |
|           | elayTimer |           |           |         |    |
|           | (sf512)   |           |           |         |    |
|           | from step |           |           |         |    |
|           | 1?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | Check:    | \--\>     | (SR)      | 1,4     | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | \[x\]     |           |           |         |    |
|           | S         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | Requests  |           |           |         |    |
|           | s         |           |           |         |    |
|           | eparately |           |           |         |    |
|           | on \[x\]  |           |           |         |    |
|           | cons      |           |           |         |    |
|           | ecutively |           |           |         |    |
|           | available |           |           |         |    |
|           | PUCCHs    |           |           |         |    |
|           | after     |           |           |         |    |
|           | logicalCh |           |           |         |    |
|           | annelSR-D |           |           |         |    |
|           | elayTimer |           |           |         |    |
|           | expiry?   |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | The SS    | \<\--     | (UL       | \-      | \- |
|           | transmits |           | Grant)    |         |    |
|           | an UL     |           |           |         |    |
|           | grant to  |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | UL-SCH    |           |           |         |    |
|           | resources |           |           |         |    |
|           | that are  |           |           |         |    |
|           | enough to |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back PDU  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           | (c        |         |    |
|           | UE        |           | ontaining |         |    |
|           | transmit  |           | 1 MAC sub |         |    |
|           | a MAC PDU |           | PDU       |         |    |
|           | c         |           | c         |         |    |
|           | ontaining |           | ontaining |         |    |
|           | MAC Sub   |           | RLC SDU)  |         |    |
|           | PDU       |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a RLC SDU |           |           |         |    |
|           | on LCH5?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (c        |         |    |
|           | a MAC PDU |           | ontaining |         |    |
|           | c         |           | 1 MAC sub |         |    |
|           | ontaining |           | PDU)      |         |    |
|           | A MAC Sub |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a RLC SDU |           |           |         |    |
|           | on LCH 4  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | Check:    | \--\>     | (SR)      | 1,5     | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | S         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | Requests  |           |           |         |    |
|           | s         |           |           |         |    |
|           | eparately |           |           |         |    |
|           | on \[x\]  |           |           |         |    |
|           | cons      |           |           |         |    |
|           | ecutively |           |           |         |    |
|           | available |           |           |         |    |
|           | PUCCHs?   |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | The SS    | \<\--     | (UL Grant | \-      | \- |
|           | transmits |           | )         |         |    |
|           | an UL     |           |           |         |    |
|           | grant to  |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | UL-SCH    |           |           |         |    |
|           | resources |           |           |         |    |
|           | that are  |           |           |         |    |
|           | enough to |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back PDU  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           | (c        |         |    |
|           | UE        |           | ontaining |         |    |
|           | transmit  |           | 1 MAC sub |         |    |
|           | a MAC PDU |           | PDU       |         |    |
|           | c         |           | c         |         |    |
|           | ontaining |           | ontaining |         |    |
|           | MAC Sub   |           | RLC SDU)  |         |    |
|           | PDU       |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a RLC SDU |           |           |         |    |
|           | on LCH4?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | Check:    | \--\>     | (SR)      | 1,2     | F  |
|           | For 1     |           |           |         |    |
|           | second,   |           |           |         |    |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a         |           |           |         |    |
|           | S         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | Request?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (Timing   |         |    |
|           | a MAC PDU |           | Advance   |         |    |
|           | c         |           | Command)  |         |    |
|           | ontaining |           |           |         |    |
|           | a Timing  |           |           |         |    |
|           | Advance   |           |           |         |    |
|           | Command   |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | Control   |           |           |         |    |
|           | Element,  |           |           |         |    |
|           | but does  |           |           |         |    |
|           | not send  |           |           |         |    |
|           | any       |           |           |         |    |
|           | s         |           |           |         |    |
|           | ubsequent |           |           |         |    |
|           | al        |           |           |         |    |
|           | ignments. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (MAC SDU) |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a MAC SDU |           |           |         |    |
|           | on LCH 4  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Step 13   |           |           |         |    |
|           | is        |           |           |         |    |
|           | repeated  |           |           |         |    |
|           | less than |           |           |         |    |
|           | sr        |           |           |         |    |
|           | -TransMax |           |           |         |    |
|           | times     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | The UE    | \--\>     | (SR)      | \-      | \- |
|           | may       |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | S         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | Requests  |           |           |         |    |
|           | before    |           |           |         |    |
|           | time      |           |           |         |    |
|           | alignment |           |           |         |    |
|           | timer     |           |           |         |    |
|           | expires.  |           |           |         |    |
|           | The SS    |           |           |         |    |
|           | shall not |           |           |         |    |
|           | respond   |           |           |         |    |
|           | to the    |           |           |         |    |
|           | S         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | Requests  |           |           |         |    |
|           | in this   |           |           |         |    |
|           | step.     |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | Check:    | \--\>     | (PRACH    | 3       | P  |
|           | does the  |           | Preamble) |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | a Random  |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | including |           |           |         |    |
|           | an UL     |           |           |         |    |
|           | grant to  |           |           |         |    |
|           | enable UE |           |           |         |    |
|           | to        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | Control   |           |           |         |    |
|           | Element   |           |           |         |    |
|           | and the   |           |           |         |    |
|           | MAC SDU   |           |           |         |    |
|           | as        |           |           |         |    |
|           | received  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 14.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 16        | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmit  |           | (MAC Sub  |         |    |
|           | a MAC PDU |           | PDU       |         |    |
|           | including |           | c         |         |    |
|           | a C-RNTI  |           | ontaining |         |    |
|           | MAC       |           | C-RNTI    |         |    |
|           | Control   |           | control   |         |    |
|           | Element   |           | element,  |         |    |
|           | and a MAC |           | MAC sub   |         |    |
|           | SDU.      |           | PDU       |         |    |
|           | (Note 3)  |           | c         |         |    |
|           |           |           | ontaining |         |    |
|           |           |           | MAC SDU)  |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17        | The SS    | \<\--     | \-        | \-      | \- |
|           | sends     |           |           |         |    |
|           | PDCCH     |           |           |         |    |
|           | tra       |           |           |         |    |
|           | nsmission |           |           |         |    |
|           | for UE    |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| The UE    |           |           |           |         |    |
| repeats   |           |           |           |         |    |
| the       |           |           |           |         |    |
| s         |           |           |           |         |    |
| cheduling |           |           |           |         |    |
| requests  |           |           |           |         |    |
| on every  |           |           |           |         |    |
| available |           |           |           |         |    |
| PUCCH as  |           |           |           |         |    |
| long as   |           |           |           |         |    |
| SR        |           |           |           |         |    |
| \_COUNTER |           |           |           |         |    |
| \<        |           |           |           |         |    |
| dsr       |           |           |           |         |    |
| -TransMax |           |           |           |         |    |
| and there |           |           |           |         |    |
| is UL     |           |           |           |         |    |
| data      |           |           |           |         |    |
| available |           |           |           |         |    |
| for       |           |           |           |         |    |
| tra       |           |           |           |         |    |
| nsmission |           |           |           |         |    |
| and there |           |           |           |         |    |
| are no    |           |           |           |         |    |
| resources |           |           |           |         |    |
| available |           |           |           |         |    |
| to        |           |           |           |         |    |
| transmit  |           |           |           |         |    |
| it. At    |           |           |           |         |    |
| the       |           |           |           |         |    |
| reception |           |           |           |         |    |
| of first  |           |           |           |         |    |
| S         |           |           |           |         |    |
| cheduling |           |           |           |         |    |
| Request   |           |           |           |         |    |
| from the  |           |           |           |         |    |
| UE, SS    |           |           |           |         |    |
| will be   |           |           |           |         |    |
| scheduled |           |           |           |         |    |
| to        |           |           |           |         |    |
| transmit  |           |           |           |         |    |
| a grant   |           |           |           |         |    |
| after     |           |           |           |         |    |
| 100ms.    |           |           |           |         |    |
| Hence SS  |           |           |           |         |    |
| will      |           |           |           |         |    |
| receive   |           |           |           |         |    |
| 10        |           |           |           |         |    |
| S         |           |           |           |         |    |
| cheduling |           |           |           |         |    |
| Requests. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| In step   |           |           |           |         |    |
| 8, SR     |           |           |           |         |    |
| r         |           |           |           |         |    |
| epetition |           |           |           |         |    |
| of \[63\] |           |           |           |         |    |
| times     |           |           |           |         |    |
| (*sr-     |           |           |           |         |    |
| TransMax* |           |           |           |         |    |
| (64))     |           |           |           |         |    |
| will take |           |           |           |         |    |
| at least  |           |           |           |         |    |
| \[63\*10  |           |           |           |         |    |
| = 630\]   |           |           |           |         |    |
| ms which  |           |           |           |         |    |
| is        |           |           |           |         |    |
| smaller   |           |           |           |         |    |
| than TA   |           |           |           |         |    |
| timer     |           |           |           |         |    |
| \[in      |           |           |           |         |    |
| finity\]. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| The UE    |           |           |           |         |    |
| tra       |           |           |           |         |    |
| nsmission |           |           |           |         |    |
| of the    |           |           |           |         |    |
| MAC PDU   |           |           |           |         |    |
| ensures   |           |           |           |         |    |
| that the  |           |           |           |         |    |
| random    |           |           |           |         |    |
| access    |           |           |           |         |    |
| procedure |           |           |           |         |    |
| was       |           |           |           |         |    |
| su        |           |           |           |         |    |
| ccessful. |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.3.3.3.3 Specific message contents {#specific-message-contents-2 .H6}

Table 7.1.1.3.3.3.3-1: SchedulingRequestConfig (Preamble)

  ---------------------------------------------------------------------------------------------------------------------------------------------- -------------- ----------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-155                                                                                                                       
  Information Element                                                                                                                            Value/remark   Comment     Condition
  SchedulingRequestConfig ::= SEQUENCE { schedulingRequestToAddModList (SIZE(1..maxNrofSR-ConfigPerCellGroup)) OF SSchedulingRequestToAddMod {   1 entry                    
  SchedulingRequestToAddMod\[1\] SEQUENCE {                                                                                                                     entry 1     
  sr-TransMax                                                                                                                                    n64            MAX Value   
  }                                                                                                                                                                         
  }                                                                                                                                                                         
  ---------------------------------------------------------------------------------------------------------------------------------------------- -------------- ----------- -----------

##### 7.1.1.3.4 Correct handling of MAC control information / Buffer status / UL data arrive in the UE Tx buffer / Regular BSR

##### 7.1.1.3.4.1 Test Purpose (TP) {#test-purpose-tp-3 .H6}

##### (1) {#section-18 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UL data arrives in the UE transmission buffer and the data
belongs to a logical channel with higher priority than those for which
data is already available for transmission and the new logical channel
and the existing logical channels belongs to the different LCG }

**then** { UE Reports a Long Buffer Status Reporting (BSR) }

}

##### (2) {#section-19 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UL data arrives in the UE transmission buffer and there is no
data available for transmission for any of the logical channels which
belong to a LCG }

**then** { UE Reports a Short Buffer Status Reporting (BSR) }

}

##### (3) {#section-20 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UL data arrives in the UE transmission buffer and the data
belongs to a logical channel with higher priority than those for which
data is already available for transmission and the new logical channel
and existing logical channels belong to the same LCG }

**then** { UE Reports a Short Buffer Status Reporting (BSR) }

}

##### (4) {#section-21 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { retxBSR-Timer expires and only one LCG has data available for
transmission }

**then** { UE triggers a regular BSR and Reports a Short Buffer Status
Reporting (BSR) }

}

##### (5) {#section-22 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { a Regular BSR has been triggered and UE has pending data for
transmission and UE has only resources to send either BSR report or data
}

**then** { UE transmits the BSR report }

}

##### (6) {#section-23 .H6}

**with** { UE in E-UTRA RRC\_CONNECTED state }

**ensure that** {

**when** { UE determines that a BSR has been triggered since the last
transmission of a BSR and UE has no UL resources allocated for new
transmission for this TTI }

**then** { UE transmits a scheduling request }

}

##### (7) {#section-24 .H6}

Void.

##### (8) {#section-25 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { a Regular BSR has been triggered and UE has pending data on
several logical channels for transmission and UE has UL resources to
send all pending data including BSR }

**then** { UE transmits the UL data and reports buffer status reporting
(BSR) that indicates there is no more data in the buffer }

}

##### 7.1.1.3.4.2 Conformance requirements {#conformance-requirements-3 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.321, clauses 5.4.5, 6.1.3.1, 6.2.1 and TS 38.323
clause 5.6. Unless otherwise stated these are Rel-15 requirements.

\[TS 38.321, clause 5.4.3.1.3\]

Logical channels shall be prioritised in accordance with the following
order (highest priority listed first):

\- C-RNTI MAC CE or data from UL-CCCH;

\- Configured Grant Confirmation MAC CE;

\- MAC CE for BSR, with exception of BSR included for padding;

\- Single Entry PHR MAC CE or Multiple Entry PHR MAC CE;

\- data from any Logical Channel, except data from UL-CCCH;

\- MAC CE for Recommended bit rate query;

\- MAC CE for BSR included for padding.

\[TS 38.321, clause 5.4.5\]

The Buffer Status reporting (BSR) procedure is used to provide the
serving gNB with information about UL data volume in the MAC entity.

RRC configures the following parameters to control the BSR:

\- *periodicBSR-Timer*;

\- *retxBSR-Timer*;

\- *logicalChannelSR-Delay*;

\- *logicalChannelSR-DelayTimer*;

\- *logicalChannelGroup*.

Each logical channel may be allocated to an LCG using the
*logicalChannelGroup*. The maximum number of LCGs is eight.

The MAC entity determines the amount of UL data available for a logical
channel according to the data volume calculation procedure in TSs 38.322
and 38.323 \[3\] \[4\].

A BSR shall be triggered if any of the following events occur:

\- the MAC entity has new UL data available for a logical channel which
belongs to an LCG; and either

\- the new UL data belongs to a logical channel with higher priority
than the priority of any logical channel containing available UL data
which belong to any LCG; or

\- none of the logical channels which belong to an LCG contains any
available UL data.

in which case the BSR is referred below to as \'Regular BSR\';

\- UL resources are allocated and number of padding bits is equal to or
larger than the size of the Buffer Status Report MAC CE plus its
subheader, in which case the BSR is referred below to as \'Padding
BSR\';

\- *retxBSR-Timer* expires, and at least one of the logical channels
which belong to an LCG contains UL data, in which case the BSR is
referred below to as \'Regular BSR\';

\- *periodicBSR-Timer* expires, in which case the BSR is referred below
to as \'Periodic BSR\'.

For Regular BSR, the MAC entity shall:

1\> if the BSR is triggered for a logical channel for which
*logicalChannelSR-Delay* is configured by upper layers:

2\> start or restart the *logicalChannelSR-DelayTimer*.

1\> else:

2\> if running, stop the *logicalChannelSR-DelayTimer*.

For Regular and Periodic BSR, the MAC entity shall:

1\> if more than one LCG has data available for transmission when the
BSR is to be transmitted:

2\> report Long BSR for all LCGs which have data available for
transmission.

1\> else:

2\> report Short BSR.

For Padding BSR:

1\> if the number of padding bits is equal to or larger than the size of
the Short BSR plus its subheader but smaller than the size of the Long
BSR plus its subheader:

2\> if more than one LCG has data available for transmission when the
BSR is to be transmitted:

3\> if the number of padding bits is equal to the size of the Short BSR
plus its subheader:

4\> report Short Truncated BSR of the LCG with the highest priority
logical channel with data available for transmission.

3\> else:

4\> report Long Truncated BSR of the LCG(s) with the logical channels
having data available for transmission following a decreasing order of
priority, and in case of equal priority, in increasing order of LCGID.

2\> else:

3\> report Short BSR;

1\> else if the number of padding bits is equal to or larger than the
size of the Long BSR plus its subheader:

2\> report Long BSR for all LCGs which have data available for
transmission.

The MAC entity shall:

1\> if the Buffer Status reporting procedure determines that at least
one BSR has been triggered and not cancelled:

2\> if UL-SCH resources are available for a new immediate transmission:

3\> instruct the Multiplexing and Assembly procedure to generate the BSR
MAC CE(s);

3\> start or restart *periodicBSR-Timer* except when all the generated
BSRs are long or short Truncated BSRs;

3\> start or restart *retxBSR-Timer*.

2\> else if a Regular BSR has been triggered and
*logicalChannelSR-DelayTimer* is not running:

3\> if an uplink grant is not a configured grant; or

3\> if the Regular BSR was not triggered for a logical channel for which
logical channel SR masking (*logicalChannelSR-Mask*) is setup by upper
layers:

4\> trigger a Scheduling Request.

A MAC PDU shall contain at most one BSR MAC CE, even when multiple
events have triggered a BSR by the time. The Regular BSR and the
Periodic BSR shall have precedence over the padding BSR.

The MAC entity shall restart *retxBSR-Timer* upon reception of a grant
for transmission of new data on any UL-SCH.

All triggered BSRs may be cancelled when the UL grant(s) can accommodate
all pending data available for transmission but is not sufficient to
additionally accommodate the BSR MAC control element plus its subheader.
All triggered BSRs shall be cancelled when a BSR is included in a MAC
PDU for transmission.

The MAC entity shall transmit at most one BSR in one MAC PDU. Padding
BSR shall not be included when the MAC PDU contains a Regular or
Periodic BSR.

\[TS 38.321, clause 6.1.3.1\]

Buffer Status Report (BSR) MAC CEs consist of either:

\- Short BSR format (fixed size); or

\- Long BSR format (variable size); or

\- Short Truncated BSR format (fixed size); or

\- Long Truncated BSR format (variable size).

The BSR formats are identified by MAC PDU subheaders with LCIDs as
specified in Table 6.2.1-2.

The fields in the BSR MAC CE are defined as follows:

\- LCG ID: The Logical Channel Group ID field identifies the group of
logical channel(s) whose buffer status is being reported. The length of
the field is 3 bits;

\- LCG~i~: For the Long BSR format, this field indicates the presence of
the Buffer Size field for the logical channel group i. The LCG~i~ field
set to \"1\" indicates that the Buffer Size field for the logical
channel group i is reported. The LCG~i~ field set to \"0\" indicates
that the Buffer Size field for the logical channel group i is not
reported. For the Long Truncated BSR format, this field indicates
whether logical channel group i has data available. The LCG~i~ field set
to \"1\" indicates that logical channel group i has data available. The
LCG~i~ field set to \"0\" indicates that logical channel group i does
not have data available;

\- Buffer Size: The Buffer Size field identifies the total amount of
data available according to the data volume calculation procedure in TSs
38.322 and 38.323 \[3\] \[4\] across all logical channels of a logical
channel group after the MAC PDU has been built (i.e. after the logical
channel prioritization procedure, which may result the value of the
Buffer Size field to zero). The amount of data is indicated in number of
bytes. The size of the RLC and MAC headers are not considered in the
buffer size computation. The length of this field for the Short BSR
format and the Short Truncated BSR format is 5 bits. The length of this
field for the Long BSR format and the Long Truncated BSR format is 8
bits. The values for the 5-bit and 8-bit Buffer Size fields are shown in
Tables 6.1.3.1-1 and 6.1.3.1-2, respectively. For the Long BSR format
and the Long Truncated BSR format, the Buffer Size fields are included
in ascending order based on the LCG~i~. For the Long Truncated BSR
format the number of Buffer Size fields included is maximised, while not
exceeding the number of padding bits.

NOTE: The number of the Buffer Size fields in the Long Truncated BSR
format can be zero.

![](./media/image6.emf)

Figure 6.1.3.1-1: Short BSR and Short Truncated BSR MAC CE

![](./media/image7.emf)

Figure 6.1.3.1-2: Long BSR and Long Truncated BSR MAC CE

Table 6.1.3.1-1: Buffer size levels (in bytes) for 5-bit Buffer Size
field

  Index   BS value   Index   BS value   Index   BS value   Index   BS value
  ------- ---------- ------- ---------- ------- ---------- ------- -----------
  0       0          8       â¤ 102      16      â¤ 1446     24      â¤ 20516
  1       â¤ 10       9       â¤ 142      17      â¤ 2014     25      â¤ 28581
  2       â¤ 14       10      â¤ 198      18      â¤ 2806     26      â¤ 39818
  3       â¤ 20       11      â¤ 276      19      â¤ 3909     27      â¤ 55474
  4       â¤ 28       12      â¤ 384      20      â¤ 5446     28      â¤ 77284
  5       â¤ 38       13      â¤ 535      21      â¤ 7587     29      â¤ 107669
  6       â¤ 53       14      â¤ 745      22      â¤ 10570    30      â¤ 150000
  7       â¤ 74       15      â¤ 1038     23      â¤ 14726    31      \> 150000

Table 6.1.3.1-2: Buffer size levels (in bytes) for 8-bit Buffer Size
field

  ------- ---------- ------- ---------- ------- ----------- ------- -------------
  Index   BS value   Index   BS value   Index   BS value    Index   BS value
  0       0          64      â¤ 560      128     â¤ 31342     192     â¤ 1754595
  1       â¤ 10       65      â¤ 597      129     â¤ 33376     193     â¤ 1868488
  2       â¤ 11       66      â¤ 635      130     â¤ 35543     194     â¤ 1989774
  3       â¤ 12       67      â¤ 677      131     â¤ 37850     195     â¤ 2118933
  4       â¤ 13       68      â¤ 720      132     â¤ 40307     196     â¤ 2256475
  5       â¤ 14       69      â¤ 767      133     â¤ 42923     197     â¤ 2402946
  6       â¤ 15       70      â¤ 817      134     â¤ 45709     198     â¤ 2558924
  7       â¤ 16       71      â¤ 870      135     â¤ 48676     199     â¤ 2725027
  8       â¤ 17       72      â¤ 926      136     â¤ 51836     200     â¤ 2901912
  9       â¤ 18       73      â¤ 987      137     â¤ 55200     201     â¤ 3090279
  10      â¤ 19       74      â¤ 1051     138     â¤ 58784     202     â¤ 3290873
  11      â¤ 20       75      â¤ 1119     139     â¤ 62599     203     â¤ 3504487
  12      â¤ 22       76      â¤ 1191     140     â¤ 66663     204     â¤ 3731968
  13      â¤ 23       77      â¤ 1269     141     â¤ 70990     205     â¤ 3974215
  14      â¤ 25       78      â¤ 1351     142     â¤ 75598     206     â¤ 4232186
  15      â¤ 26       79      â¤ 1439     143     â¤ 80505     207     â¤ 4506902
  16      â¤ 28       80      â¤ 1532     144     â¤ 85730     208     â¤ 4799451
  17      â¤ 30       81      â¤ 1631     145     â¤ 91295     209     â¤ 5110989
  18      â¤ 32       82      â¤ 1737     146     â¤ 97221     210     â¤ 5442750
  19      â¤ 34       83      â¤ 1850     147     â¤ 103532    211     â¤ 5796046
  20      â¤ 36       84      â¤ 1970     148     â¤ 110252    212     â¤ 6172275
  21      â¤ 38       85      â¤ 2098     149     â¤ 117409    213     â¤ 6572925
  22      â¤ 40       86      â¤ 2234     150     â¤ 125030    214     â¤ 6999582
  23      â¤ 43       87      â¤ 2379     151     â¤ 133146    215     â¤ 7453933
  24      â¤ 46       88      â¤ 2533     152     â¤ 141789    216     â¤ 7937777
  25      â¤ 49       89      â¤ 2698     153     â¤ 150992    217     â¤ 8453028
  26      â¤ 52       90      â¤ 2873     154     â¤ 160793    218     â¤ 9001725
  27      â¤ 55       91      â¤ 3059     155     â¤ 171231    219     â¤ 9586039
  28      â¤ 59       92      â¤ 3258     156     â¤ 182345    220     â¤ 10208280
  29      â¤ 62       93      â¤ 3469     157     â¤ 194182    221     â¤ 10870913
  30      â¤ 66       94      â¤ 3694     158     â¤ 206786    222     â¤ 11576557
  31      â¤ 71       95      â¤ 3934     159     â¤ 220209    223     â¤ 12328006
  32      â¤ 75       96      â¤ 4189     160     â¤ 234503    224     â¤ 13128233
  33      â¤ 80       97      â¤ 4461     161     â¤ 249725    225     â¤ 13980403
  34      â¤ 85       98      â¤ 4751     162     â¤ 265935    226     â¤ 14887889
  35      â¤ 91       99      â¤ 5059     163     â¤ 283197    227     â¤ 15854280
  36      â¤ 97       100     â¤ 5387     164     â¤ 301579    228     â¤ 16883401
  37      â¤ 103      101     â¤ 5737     165     â¤ 321155    229     â¤ 17979324
  38      â¤ 110      102     â¤ 6109     166     â¤ 342002    230     â¤ 19146385
  39      â¤ 117      103     â¤ 6506     167     â¤ 364202    231     â¤ 20389201
  40      â¤ 124      104     â¤ 6928     168     â¤ 387842    232     â¤ 21712690
  41      â¤ 132      105     â¤ 7378     169     â¤ 413018    233     â¤ 23122088
  42      â¤ 141      106     â¤ 7857     170     â¤ 439827    234     â¤ 24622972
  43      â¤ 150      107     â¤ 8367     171     â¤ 468377    235     â¤ 26221280
  44      â¤ 160      108     â¤ 8910     172     â¤ 498780    236     â¤ 27923336
  45      â¤ 170      109     â¤ 9488     173     â¤ 531156    237     â¤ 29735875
  46      â¤ 181      110     â¤ 10104    174     â¤ 565634    238     â¤ 31666069
  47      â¤ 193      111     â¤ 10760    175     â¤ 602350    239     â¤ 33721553
  48      â¤ 205      112     â¤ 11458    176     â¤ 641449    240     â¤ 35910462
  49      â¤ 218      113     â¤ 12202    177     â¤ 683087    241     â¤ 38241455
  50      â¤ 233      114     â¤ 12994    178     â¤ 727427    242     â¤ 40723756
  51      â¤ 248      115     â¤ 13838    179     â¤ 774645    243     â¤ 43367187
  52      â¤ 264      116     â¤ 14736    180     â¤ 824928    244     â¤ 46182206
  53      â¤ 281      117     â¤ 15692    181     â¤ 878475    245     â¤ 49179951
  54      â¤ 299      118     â¤ 16711    182     â¤ 935498    246     â¤ 52372284
  55      â¤ 318      119     â¤ 17795    183     â¤ 996222    247     â¤ 55771835
  56      â¤ 339      120     â¤ 18951    184     â¤ 1060888   248     â¤ 59392055
  57      â¤ 361      121     â¤ 20181    185     â¤ 1129752   249     â¤ 63247269
  58      â¤ 384      122     â¤ 21491    186     â¤ 1203085   250     â¤ 67352729
  59      â¤ 409      123     â¤ 22885    187     â¤ 1281179   251     â¤ 71724679
  60      â¤ 436      124     â¤ 24371    188     â¤ 1364342   252     â¤ 76380419
  61      â¤ 464      125     â¤ 25953    189     â¤ 1452903   253     â¤ 81338368
  62      â¤ 494      126     â¤ 27638    190     â¤ 1547213   254     \> 81338368
  63      â¤ 526      127     â¤ 29431    191     â¤ 1647644   255     Reserved
  ------- ---------- ------- ---------- ------- ----------- ------- -------------

\[TS 38.321, clause 6.2.1\]

Table 6.2.1-2 Values of LCID for UL-SCH

  Index            LCID values
  ---------------- ---------------------------------
  000000           CCCH
  000001--100000   Identity of the logical channel
  100001--110110   Reserved
  110111           Configured Grant Confirmation
  111000           Multiple Entry PHR
  111001           Single Entry PHR
  111010           C-RNTI
  111011           Short Truncated BSR
  111100           Long Truncated BSR
  111101           Short BSR
  111110           Long BSR
  111111           Padding

\[TS 38.323, clause 5.6\]

For the purpose of MAC buffer status reporting, the transmitting PDCP
entity shall consider the following as PDCP data volume:

\- the PDCP SDUs for which no PDCP Data PDUs have been constructed;

\- the PDCP Data PDUs that have not been submitted to lower layers;

\- the PDCP Control PDUs;

\- for AM DRBs, the PDCP SDUs to be retransmitted according to subclause
5.1.2;

\- for AM DRBs, the PDCP Data PDUs to be retransmitted according to
subclause 5.5.

\[TS 38.322, clause 5.5\]For the purpose of MAC buffer status reporting,
the UE shall consider the following as RLC data volume:

\- RLC SDUs and RLC SDU segments that have not yet been included in an
RLC data PDU;

\- RLC data PDUs that are pending for initial transmission;

\- RLC data PDUs that are pending for retransmission (RLC AM).

In addition, if a STATUS PDU has been triggered and *t-StatusProhibit*
is not running or has expired, the UE shall estimate the size of the
STATUS PDU that will be transmitted in the next transmission
opportunity, and consider this as part of RLC data volume.

##### 7.1.1.3.4.3 Test description {#test-description-3 .H6}

##### 7.1.1.3.4.3.1 Pre-test conditions {#pre-test-conditions-3 .H6}

Same Pre-test conditions as in clause 7.1.1.0 with the exception of 3 AM
DRBs on NR cell configured according to Table 7.1.1.3.4.3.1-1.

Table 7.1.1.3.4.3.1-1: Logical Channel Configuration Settings

  Parameter                Value DRB1               Value DRB2              Value DRB3
  ------------------------ ------------------------ ----------------------- -----------------------
  LogicalChannelIdentity   LCH4((DRB-Identity +3)   LCH5(DRB-Identity +3)   LCH6(DRB-Identity +3)
  Priority                 8                        7                       6
  prioritizedBitRate       0 kB/s                   0 kB/s                  0 kB/s
  logicalChannelGroup      2 (LCG ID\#2)            2 (LCG ID\#2)           1 (LCG ID\#1)

##### 7.1.1.3.4.3.2 Test procedure sequence {#test-procedure-sequence-3 .H6}

Table 7.1.1.3.4.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \-        | \-        | \-      | \- |
|           | ignores   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | requests  |           |           |         |    |
|           | and does  |           |           |         |    |
|           | not       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | any       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (2 RLC    |         |    |
|           | a MAC PDU |           | SDUs on   |         |    |
|           | c         |           | LCH4)     |         |    |
|           | ontaining |           |           |         |    |
|           | two RLC   |           |           |         |    |
|           | SDUs of   |           |           |         |    |
|           | size 12   |           |           |         |    |
|           | bytes on  |           |           |         |    |
|           | LCH4      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | SS        | \<\--     | (UL       | \-      | \- |
|           | allocates |           | Grant, 40 |         |    |
|           | an UL     |           | bits)     |         |    |
|           | Grant of  |           |           |         |    |
|           | 40 bits.  |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | Check:    | \--\>     | MAC PDU   | 2,5     | P  |
|           | Does the  |           | (MAC      |         |    |
|           | UE        |           | Short BSR |         |    |
|           | transmit  |           | (LCG      |         |    |
|           | a Short   |           | ID='2',   |         |    |
|           | BSR with  |           | Buffer    |         |    |
|           | 'LCG ID'  |           | Size='4'  |         |    |
|           | field set |           | or        |         |    |
|           | to '2'    |           | bigger))  |         |    |
|           | and       |           |           |         |    |
|           | 'Buffer   |           |           |         |    |
|           | size'     |           |           |         |    |
|           | field set |           |           |         |    |
|           | to value  |           |           |         |    |
|           | '4' or    |           |           |         |    |
|           | bigger?   |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Wait for  | \-        | \-        | \-      | \- |
|           | retx      |           |           |         |    |
|           | BSR-Timer |           |           |         |    |
|           | expiry on |           |           |         |    |
|           | UE side.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | Check:    | \--\>     | (SR)      | 6       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a         |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | request?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The SS    | \<\--     | (UL       | \-      | \- |
|           | responds  |           | Grant, 40 |         |    |
|           | to the    |           | bits)     |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | request   |           |           |         |    |
|           | in step 6 |           |           |         |    |
|           | by an UL  |           |           |         |    |
|           | Grant of  |           |           |         |    |
|           | 40 bits.  |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | Check:    | \--\>     | MAC PDU   | 4,5     | P  |
|           | Does the  |           | (MAC      |         |    |
|           | UE        |           | Short BSR |         |    |
|           | transmit  |           | (LCG      |         |    |
|           | a Short   |           | ID='2',   |         |    |
|           | BSR with  |           | Buffer    |         |    |
|           | 'LCG ID'  |           | Size='4'  |         |    |
|           | field set |           | or        |         |    |
|           | to '2'    |           | bigger))  |         |    |
|           | and       |           |           |         |    |
|           | 'Buffer   |           |           |         |    |
|           | size'     |           |           |         |    |
|           | field set |           |           |         |    |
|           | to value  |           |           |         |    |
|           | '4' or    |           |           |         |    |
|           | bigger?   |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (1 RLC    |         |    |
|           | a MAC PDU |           | SDU on    |         |    |
|           | c         |           | LCH5)     |         |    |
|           | ontaining |           |           |         |    |
|           | one RLC   |           |           |         |    |
|           | SDU of    |           |           |         |    |
|           | size 12   |           |           |         |    |
|           | bytes on  |           |           |         |    |
|           | LCH5      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | Check:    | \--\>     | (SR)      | 6       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a         |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | request?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | The SS    | \<\--     | (UL       | \-      | \- |
|           | respond   |           | Grant, 40 |         |    |
|           | to the    |           | bits)     |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | request   |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 10 by an  |           |           |         |    |
|           | UL Grant  |           |           |         |    |
|           | of 40     |           |           |         |    |
|           | bits.     |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | Check:    | \--\>     | MAC PDU   | 3,5     | P  |
|           | Does the  |           | (MAC      |         |    |
|           | UE        |           | Short BSR |         |    |
|           | transmit  |           | (LCG      |         |    |
|           | a Short   |           | ID='2',   |         |    |
|           | BSR with  |           | Buffer    |         |    |
|           | 'LCG ID'  |           | Size='5'  |         |    |
|           | field set |           | or        |         |    |
|           | to '2'    |           | bigger))  |         |    |
|           | and       |           |           |         |    |
|           | 'Buffer   |           |           |         |    |
|           | size\#1'  |           |           |         |    |
|           | field set |           |           |         |    |
|           | to value  |           |           |         |    |
|           | '5' or    |           |           |         |    |
|           | bigger?   |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (2 RLC    |         |    |
|           | a MAC PDU |           | SDUs on   |         |    |
|           | c         |           | LCH6)     |         |    |
|           | ontaining |           |           |         |    |
|           | two RLC   |           |           |         |    |
|           | SDUs of   |           |           |         |    |
|           | size 5    |           |           |         |    |
|           | bytes on  |           |           |         |    |
|           | LCH6      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | Check:    | \--\>     | (SR)      | 6       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a         |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | request?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | The SS    | \<\--     | (UL       | \-      | \- |
|           | responds  |           | Grant, 40 |         |    |
|           | to the    |           | bits)     |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | request   |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 14 by one |           |           |         |    |
|           | UL Grant  |           |           |         |    |
|           | of 40     |           |           |         |    |
|           | bits.     |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 16        | Check:    | \--\>     | MAC PDU   | 1,5     | P  |
|           | Does the  |           | (MAC Long |         |    |
|           | UE        |           | BSR       |         |    |
|           | transmit  |           | (Buffer   |         |    |
|           | a Long    |           | si        |         |    |
|           | BSR with  |           | ze\#1='1' |         |    |
|           | 'Buffer   |           | or        |         |    |
|           | size\#1'  |           | bigger,   |         |    |
|           | field set |           | Buffer    |         |    |
|           | to value  |           | siz       |         |    |
|           | '1',      |           | e\#2='20' |         |    |
|           | 'Buffer   |           | or        |         |    |
|           | size\#2'  |           | bigger)   |         |    |
|           | field set |           |           |         |    |
|           | to value  |           |           |         |    |
|           | '20' or   |           |           |         |    |
|           | bigger?   |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17        | Wait for  | \-        |           | \-      | \- |
|           | retx      |           |           |         |    |
|           | BSR-Timer |           |           |         |    |
|           | expiry on |           |           |         |    |
|           | the UE    |           |           |         |    |
|           | side.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 18        | Check:    | \--\>     | (SR)      | 6       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a         |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | request?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19        | SS        | \<\--     | (UL       | \-      | \- |
|           | allocates |           | Grant,    |         |    |
|           | an UL     |           | 608 bits) |         |    |
|           | Grant of  |           |           |         |    |
|           | 608 bits. |           |           |         |    |
|           | (Note 4)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Steps     |           |           |         |    |
|           | 20a1 to   |           |           |         |    |
|           | 20b1      |           |           |         |    |
|           | describe  |           |           |         |    |
|           | behaviour |           |           |         |    |
|           | that      |           |           |         |    |
|           | depends   |           |           |         |    |
|           | on the UE |           |           |         |    |
|           | ca        |           |           |         |    |
|           | pability; |           |           |         |    |
|           | the       |           |           |         |    |
|           | \'lower   |           |           |         |    |
|           | case      |           |           |         |    |
|           | letter\'  |           |           |         |    |
|           | i         |           |           |         |    |
|           | dentifies |           |           |         |    |
|           | a step    |           |           |         |    |
|           | sequence  |           |           |         |    |
|           | that take |           |           |         |    |
|           | place if  |           |           |         |    |
|           | a         |           |           |         |    |
|           | c         |           |           |         |    |
|           | apability |           |           |         |    |
|           | is        |           |           |         |    |
|           | supported |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 20a1      | IF NOT    | \--\>     | MAC PDU   | \-      | \- |
|           | pc\_su    |           | (17-Byte  |         |    |
|           | pportOfRe |           | 2 MAC sub |         |    |
|           | dCap\_r17 |           | PDUs from |         |    |
|           | THEN      |           | LCH4,     |         |    |
|           |           |           | 17-Byte 1 |         |    |
|           | Check:    |           | MAC sub   |         |    |
|           | Does the  |           | PDU from  |         |    |
|           | UE        |           | LCH5 and  |         |    |
|           | transmit  |           | 10-Byte 2 |         |    |
|           | a MAC PDU |           | MAC Sub   |         |    |
|           | including |           | PDUs from |         |    |
|           | five RLC  |           | LCH6)     |         |    |
|           | SDUs and  |           |           |         |    |
|           | BSR?      |           |           |         |    |
|           | (Note 5)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 20b1      | ELSE IF   | \--\>     | MAC PDU   | \-      | \- |
|           | pc\_su    |           | (16-Byte  |         |    |
|           | pportOfRe |           | 2 MAC sub |         |    |
|           | dCap\_r17 |           | PDUs from |         |    |
|           | THEN      |           | LCH4,     |         |    |
|           |           |           | 16-Byte 1 |         |    |
|           | Check:    |           | MAC sub   |         |    |
|           | Does the  |           | PDU from  |         |    |
|           | UE        |           | LCH5 and  |         |    |
|           | transmit  |           | 9-Byte 2  |         |    |
|           | a MAC PDU |           | MAC Sub   |         |    |
|           | including |           | PDUs from |         |    |
|           | five RLC  |           | LCH6)     |         |    |
|           | SDUs and  |           |           |         |    |
|           | BSR?      |           |           |         |    |
|           | (Note 5)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 21        | SS        | \<\--     | RLC       | \-      | \- |
|           | transmits |           | STATUS    |         |    |
|           | an RLC    |           | PDU       |         |    |
|           | STATUS    |           | (A        |         |    |
|           | PDU to    |           | CK\_SN=2) |         |    |
|           | ac        |           |           |         |    |
|           | knowledge |           |           |         |    |
|           | correctly |           |           |         |    |
|           | received  |           |           |         |    |
|           | d         |           |           |         |    |
|           | ata(LCID= |           |           |         |    |
|           | '000100') |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 22        | SS        | \<\--     | RLC       | \-      | \- |
|           | transmits |           | STATUS    |         |    |
|           | an RLC    |           | PDU       |         |    |
|           | STATUS    |           | (A        |         |    |
|           | PDU to    |           | CK\_SN=1) |         |    |
|           | ac        |           |           |         |    |
|           | knowledge |           |           |         |    |
|           | correctly |           |           |         |    |
|           | received  |           |           |         |    |
|           | d         |           |           |         |    |
|           | ata(LCID= |           |           |         |    |
|           | '000101') |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 23        | SS        | \<\--     | RLC       | \-      | \- |
|           | transmits |           | STATUS    |         |    |
|           | an RLC    |           | PDU       |         |    |
|           | STATUS    |           | (A        |         |    |
|           | PDU to    |           | CK\_SN=2) |         |    |
|           | ac        |           |           |         |    |
|           | knowledge |           |           |         |    |
|           | correctly |           |           |         |    |
|           | received  |           |           |         |    |
|           | d         |           |           |         |    |
|           | ata(LCID= |           |           |         |    |
|           | '000110') |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 24        | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | two MAC   |           |           |         |    |
|           | SDUs, the |           |           |         |    |
|           | first     |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a 8 byte  |           |           |         |    |
|           | RLC SDU   |           |           |         |    |
|           | with LCID |           |           |         |    |
|           | set to    |           |           |         |    |
|           | LCH4 and  |           |           |         |    |
|           | the       |           |           |         |    |
|           | second    |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a 7 byte  |           |           |         |    |
|           | RLC SDU   |           |           |         |    |
|           | with LCID |           |           |         |    |
|           | set to    |           |           |         |    |
|           | LCH6.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 25        | The UE    | \--\>     | (SR)      | \-      | \- |
|           | sends     |           |           |         |    |
|           | S         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | Request   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 26        | The SS    | \<\--     | (UL       | \-      | \- |
|           | transmits |           | grant,    |         |    |
|           | an uplink |           | 256 bits) |         |    |
|           | grant of  |           |           |         |    |
|           | size 256  |           |           |         |    |
|           | bits.     |           |           |         |    |
|           | (Note 6)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Steps     |           |           |         |    |
|           | 27a1 to   |           |           |         |    |
|           | 27b1      |           |           |         |    |
|           | describe  |           |           |         |    |
|           | behaviour |           |           |         |    |
|           | that      |           |           |         |    |
|           | depends   |           |           |         |    |
|           | on the UE |           |           |         |    |
|           | ca        |           |           |         |    |
|           | pability; |           |           |         |    |
|           | the       |           |           |         |    |
|           | \'lower   |           |           |         |    |
|           | case      |           |           |         |    |
|           | letter\'  |           |           |         |    |
|           | i         |           |           |         |    |
|           | dentifies |           |           |         |    |
|           | a step    |           |           |         |    |
|           | sequence  |           |           |         |    |
|           | that take |           |           |         |    |
|           | place if  |           |           |         |    |
|           | a         |           |           |         |    |
|           | c         |           |           |         |    |
|           | apability |           |           |         |    |
|           | is        |           |           |         |    |
|           | supported |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 27a1      | IF NOT    | \--\>     | MAC PDU   | 8       | P  |
|           | pc\_su    |           | (13-Byte  |         |    |
|           | pportOfRe |           | MAC Sub   |         |    |
|           | dCap\_r17 |           | PDU from  |         |    |
|           | THEN      |           | LC 4 and  |         |    |
|           |           |           | 12-Byte   |         |    |
|           | Check:    |           | MAC Sub   |         |    |
|           | Does the  |           | PDU from  |         |    |
|           | UE return |           | LCH6 and  |         |    |
|           | a MAC PDU |           | 5-Byte    |         |    |
|           | of length |           | MAC Sub   |         |    |
|           | 256 bits  |           | PDU       |         |    |
|           | including |           | c         |         |    |
|           | RLC SDUs, |           | ontaining |         |    |
|           | Padding   |           | Long BSR  |         |    |
|           | and Short |           | and       |         |    |
|           | BSR or    |           | 2-Byte    |         |    |
|           | LongBSR   |           | MAC Sub   |         |    |
|           | with      |           | PDU       |         |    |
|           | Buffer    |           | c         |         |    |
|           | size(s)   |           | ontaining |         |    |
|           | set to    |           | Padding)  |         |    |
|           | '0'?      |           |           |         |    |
|           | (Note 5)  |           | Or        |         |    |
|           |           |           |           |         |    |
|           |           |           | MAC PDU   |         |    |
|           |           |           | (13-Byte  |         |    |
|           |           |           | MAC Sub   |         |    |
|           |           |           | PDU from  |         |    |
|           |           |           | LCH4 and  |         |    |
|           |           |           | 12-Byte   |         |    |
|           |           |           | MAC Sub   |         |    |
|           |           |           | PDU from  |         |    |
|           |           |           | LCH6 and  |         |    |
|           |           |           | 2-Byte    |         |    |
|           |           |           | MAC Sub   |         |    |
|           |           |           | PDU       |         |    |
|           |           |           | c         |         |    |
|           |           |           | ontaining |         |    |
|           |           |           | short BSR |         |    |
|           |           |           | and       |         |    |
|           |           |           | 5-Byte    |         |    |
|           |           |           | MAC Sub   |         |    |
|           |           |           | PDU       |         |    |
|           |           |           | c         |         |    |
|           |           |           | ontaining |         |    |
|           |           |           | Padding)  |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 27b1      | ELSE IF   | \--\>     | MAC PDU   | 8       | P  |
|           | pc\_su    |           | (12-Byte  |         |    |
|           | pportOfRe |           | MAC Sub   |         |    |
|           | dCap\_r17 |           | PDU from  |         |    |
|           | THEN      |           | LC 4 and  |         |    |
|           |           |           | 11-Byte   |         |    |
|           | Check:    |           | MAC Sub   |         |    |
|           | Does the  |           | PDU from  |         |    |
|           | UE return |           | LCH6 and  |         |    |
|           | a MAC PDU |           | 5-Byte    |         |    |
|           | of length |           | MAC Sub   |         |    |
|           | 256 bits  |           | PDU       |         |    |
|           | including |           | c         |         |    |
|           | RLC SDUs, |           | ontaining |         |    |
|           | Padding   |           | Long BSR  |         |    |
|           | and Short |           | and       |         |    |
|           | BSR or    |           | 4-Byte    |         |    |
|           | LongBSR   |           | MAC Sub   |         |    |
|           | with      |           | PDU       |         |    |
|           | Buffer    |           | c         |         |    |
|           | size(s)   |           | ontaining |         |    |
|           | set to    |           | Padding)  |         |    |
|           | '0'?      |           |           |         |    |
|           | (Note 5)  |           | Or        |         |    |
|           |           |           |           |         |    |
|           |           |           | MAC PDU   |         |    |
|           |           |           | (12-Byte  |         |    |
|           |           |           | MAC Sub   |         |    |
|           |           |           | PDU from  |         |    |
|           |           |           | LCH4 and  |         |    |
|           |           |           | 11-Byte   |         |    |
|           |           |           | MAC Sub   |         |    |
|           |           |           | PDU from  |         |    |
|           |           |           | LCH6 and  |         |    |
|           |           |           | 2-Byte    |         |    |
|           |           |           | MAC Sub   |         |    |
|           |           |           | PDU       |         |    |
|           |           |           | c         |         |    |
|           |           |           | ontaining |         |    |
|           |           |           | short BSR |         |    |
|           |           |           | and       |         |    |
|           |           |           | 7-Byte    |         |    |
|           |           |           | MAC Sub   |         |    |
|           |           |           | PDU       |         |    |
|           |           |           | c         |         |    |
|           |           |           | ontaining |         |    |
|           |           |           | Padding)  |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 28        | SS        | \<\--     | RLC       | \-      | \- |
|           | transmits |           | STATUS    |         |    |
|           | an RLC    |           | PDU       |         |    |
|           | STATUS    |           | (A        |         |    |
|           | PDU to    |           | CK\_SN=3) |         |    |
|           | ac        |           |           |         |    |
|           | knowledge |           |           |         |    |
|           | correctly |           |           |         |    |
|           | received  |           |           |         |    |
|           | data(L    |           |           |         |    |
|           | CID=LCH4) |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 29        | SS        | \<\--     | RLC       | \-      | \- |
|           | transmits |           | STATUS    |         |    |
|           | an RLC    |           | PDU       |         |    |
|           | STATUS    |           | (A        |         |    |
|           | PDU to    |           | CK\_SN=3) |         |    |
|           | ac        |           |           |         |    |
|           | knowledge |           |           |         |    |
|           | correctly |           |           |         |    |
|           | received  |           |           |         |    |
|           | data(L    |           |           |         |    |
|           | CID=LCH6) |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| 40 bits   |           |           |           |         |    |
| enables   |           |           |           |         |    |
| UE to     |           |           |           |         |    |
| transmit  |           |           |           |         |    |
| a MAC PDU |           |           |           |         |    |
| with a 1  |           |           |           |         |    |
| byte MAC  |           |           |           |         |    |
| BSR       |           |           |           |         |    |
| header    |           |           |           |         |    |
| and a     |           |           |           |         |    |
| Short BSR |           |           |           |         |    |
| (1 byte)  |           |           |           |         |    |
| or a 2    |           |           |           |         |    |
| bytes MAC |           |           |           |         |    |
| BSR       |           |           |           |         |    |
| header    |           |           |           |         |    |
| and a     |           |           |           |         |    |
| Long BSR  |           |           |           |         |    |
| (3 bytes  |           |           |           |         |    |
| with 2    |           |           |           |         |    |
| LCG       |           |           |           |         |    |
| con       |           |           |           |         |    |
| figured). |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| UE        |           |           |           |         |    |
| triggers  |           |           |           |         |    |
| a Short   |           |           |           |         |    |
| BSR of    |           |           |           |         |    |
| type      |           |           |           |         |    |
| \"Regular |           |           |           |         |    |
| BSR\" to  |           |           |           |         |    |
| report    |           |           |           |         |    |
| buffer    |           |           |           |         |    |
| status    |           |           |           |         |    |
| for one   |           |           |           |         |    |
| LCG for   |           |           |           |         |    |
| that TTI. |           |           |           |         |    |
| The UE    |           |           |           |         |    |
| should    |           |           |           |         |    |
| not send  |           |           |           |         |    |
| any of    |           |           |           |         |    |
| the       |           |           |           |         |    |
| received  |           |           |           |         |    |
| RLC SDUs  |           |           |           |         |    |
| (s        |           |           |           |         |    |
| egmented) |           |           |           |         |    |
| due to    |           |           |           |         |    |
| Regular   |           |           |           |         |    |
| BSR has   |           |           |           |         |    |
| higher    |           |           |           |         |    |
| priority  |           |           |           |         |    |
| than      |           |           |           |         |    |
| U-plane   |           |           |           |         |    |
| logical   |           |           |           |         |    |
| channels. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| UE        |           |           |           |         |    |
| triggers  |           |           |           |         |    |
| and       |           |           |           |         |    |
| transmit  |           |           |           |         |    |
| a Long    |           |           |           |         |    |
| BSR of    |           |           |           |         |    |
| type      |           |           |           |         |    |
| \"Regular |           |           |           |         |    |
| BSR\".    |           |           |           |         |    |
| The UL    |           |           |           |         |    |
| grant     |           |           |           |         |    |
| would be  |           |           |           |         |    |
| enough    |           |           |           |         |    |
| for UE to |           |           |           |         |    |
| transmit  |           |           |           |         |    |
| one RLC   |           |           |           |         |    |
| SDU as    |           |           |           |         |    |
| received  |           |           |           |         |    |
| in step   |           |           |           |         |    |
| 8, but    |           |           |           |         |    |
| Regular   |           |           |           |         |    |
| BSR has   |           |           |           |         |    |
| higher    |           |           |           |         |    |
| priority  |           |           |           |         |    |
| than      |           |           |           |         |    |
| U-plane   |           |           |           |         |    |
| logical   |           |           |           |         |    |
| channels. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 4:   |           |           |           |         |    |
| If        |           |           |           |         |    |
| pc\_      |           |           |           |         |    |
| supportOf |           |           |           |         |    |
| RedCap\_r |           |           |           |         |    |
| 17=false, |           |           |           |         |    |
| the UE    |           |           |           |         |    |
| has 46    |           |           |           |         |    |
| bytes of  |           |           |           |         |    |
| RLC SDU   |           |           |           |         |    |
| data      |           |           |           |         |    |
| (received |           |           |           |         |    |
| in steps  |           |           |           |         |    |
| 2, 9 and  |           |           |           |         |    |
| 13) in    |           |           |           |         |    |
| the       |           |           |           |         |    |
| tra       |           |           |           |         |    |
| nsmission |           |           |           |         |    |
| b         |           |           |           |         |    |
| uffer.608 |           |           |           |         |    |
| bits      |           |           |           |         |    |
| enables   |           |           |           |         |    |
| UE to     |           |           |           |         |    |
| transmit  |           |           |           |         |    |
| user data |           |           |           |         |    |
| in MAC    |           |           |           |         |    |
| PDU 2 RLC |           |           |           |         |    |
| SDUs of   |           |           |           |         |    |
| 12 bytes  |           |           |           |         |    |
| on LCH4,  |           |           |           |         |    |
| each 3    |           |           |           |         |    |
| Bytes RLC |           |           |           |         |    |
| Header    |           |           |           |         |    |
| and 2     |           |           |           |         |    |
| Bytes MAC |           |           |           |         |    |
| Header    |           |           |           |         |    |
| resulting |           |           |           |         |    |
| in 2 MAC  |           |           |           |         |    |
| Sub PDUs  |           |           |           |         |    |
| of 17     |           |           |           |         |    |
| Bytes     |           |           |           |         |    |
| Each.     |           |           |           |         |    |
| Similarly |           |           |           |         |    |
| one 17    |           |           |           |         |    |
| Bytes MAC |           |           |           |         |    |
| Sub PDU   |           |           |           |         |    |
| for 12    |           |           |           |         |    |
| Bytes RLC |           |           |           |         |    |
| SDU on    |           |           |           |         |    |
| LCH5. Two |           |           |           |         |    |
| 5 Bytes   |           |           |           |         |    |
| RLC SDUs  |           |           |           |         |    |
| on LCH6   |           |           |           |         |    |
| with 3    |           |           |           |         |    |
| Bytes RLC |           |           |           |         |    |
| header    |           |           |           |         |    |
| each and  |           |           |           |         |    |
| 2 Bytes   |           |           |           |         |    |
| MAC       |           |           |           |         |    |
| header    |           |           |           |         |    |
| each,     |           |           |           |         |    |
| will      |           |           |           |         |    |
| result in |           |           |           |         |    |
| 2 MAC sub |           |           |           |         |    |
| PDUs of   |           |           |           |         |    |
| 10 bytes  |           |           |           |         |    |
| each.     |           |           |           |         |    |
| Total     |           |           |           |         |    |
| comes to  |           |           |           |         |    |
| 17+17     |           |           |           |         |    |
| +17+10+10 |           |           |           |         |    |
| +3 B      |           |           |           |         |    |
| LongBSR(2 |           |           |           |         |    |
| Bytes     |           |           |           |         |    |
| LongBSR   |           |           |           |         |    |
| header +  |           |           |           |         |    |
| 1 Byte    |           |           |           |         |    |
| LongBSR)  |           |           |           |         |    |
| + 2 B     |           |           |           |         |    |
| padding   |           |           |           |         |    |
| =76       |           |           |           |         |    |
| Bytes.\   |           |           |           |         |    |
| If        |           |           |           |         |    |
| pc\       |           |           |           |         |    |
| _supportO |           |           |           |         |    |
| fRedCap\_ |           |           |           |         |    |
| r17=true, |           |           |           |         |    |
| the UE    |           |           |           |         |    |
| has 46    |           |           |           |         |    |
| bytes of  |           |           |           |         |    |
| RLC SDU   |           |           |           |         |    |
| data      |           |           |           |         |    |
| (received |           |           |           |         |    |
| in steps  |           |           |           |         |    |
| 2, 9 and  |           |           |           |         |    |
| 13) in    |           |           |           |         |    |
| the       |           |           |           |         |    |
| tra       |           |           |           |         |    |
| nsmission |           |           |           |         |    |
| b         |           |           |           |         |    |
| uffer.608 |           |           |           |         |    |
| bits      |           |           |           |         |    |
| enables   |           |           |           |         |    |
| UE to     |           |           |           |         |    |
| transmit  |           |           |           |         |    |
| user data |           |           |           |         |    |
| in MAC    |           |           |           |         |    |
| PDU 2 RLC |           |           |           |         |    |
| SDUs of   |           |           |           |         |    |
| 12 bytes  |           |           |           |         |    |
| on LCH4,  |           |           |           |         |    |
| each      |           |           |           |         |    |
| 2Bytes    |           |           |           |         |    |
| RLC       |           |           |           |         |    |
| Header    |           |           |           |         |    |
| and 2     |           |           |           |         |    |
| Bytes MAC |           |           |           |         |    |
| Header    |           |           |           |         |    |
| resulting |           |           |           |         |    |
| in 2 MAC  |           |           |           |         |    |
| Sub PDUs  |           |           |           |         |    |
| of 16     |           |           |           |         |    |
| Bytes     |           |           |           |         |    |
| Each.     |           |           |           |         |    |
| Similarly |           |           |           |         |    |
| one 16    |           |           |           |         |    |
| Bytes MAC |           |           |           |         |    |
| Sub PDU   |           |           |           |         |    |
| for 12    |           |           |           |         |    |
| Bytes RLC |           |           |           |         |    |
| SDU on    |           |           |           |         |    |
| LCH5. Two |           |           |           |         |    |
| 5 Bytes   |           |           |           |         |    |
| RLC SDUs  |           |           |           |         |    |
| on LCH6   |           |           |           |         |    |
| with 2    |           |           |           |         |    |
| Bytes RLC |           |           |           |         |    |
| header    |           |           |           |         |    |
| each and  |           |           |           |         |    |
| 2 Bytes   |           |           |           |         |    |
| MAC       |           |           |           |         |    |
| header    |           |           |           |         |    |
| each,     |           |           |           |         |    |
| will      |           |           |           |         |    |
| result in |           |           |           |         |    |
| 2 MAC sub |           |           |           |         |    |
| PDUs of 9 |           |           |           |         |    |
| bytes     |           |           |           |         |    |
| each.     |           |           |           |         |    |
| Total     |           |           |           |         |    |
| comes to  |           |           |           |         |    |
| 16 + 16 + |           |           |           |         |    |
| 16 + 9 +  |           |           |           |         |    |
| 9 + (3 B  |           |           |           |         |    |
| LongBSR + |           |           |           |         |    |
| 7 B       |           |           |           |         |    |
| padding)  |           |           |           |         |    |
| or (2 B   |           |           |           |         |    |
| ShortBSR  |           |           |           |         |    |
| + 8 B     |           |           |           |         |    |
| padding)  |           |           |           |         |    |
| =76       |           |           |           |         |    |
| Bytes.    |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 5:   |           |           |           |         |    |
| The MAC   |           |           |           |         |    |
| SDUs for  |           |           |           |         |    |
| the       |           |           |           |         |    |
| different |           |           |           |         |    |
| logical   |           |           |           |         |    |
| channels  |           |           |           |         |    |
| may be in |           |           |           |         |    |
| any order |           |           |           |         |    |
| in the    |           |           |           |         |    |
| MAC PDU.  |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 6:   |           |           |           |         |    |
| If        |           |           |           |         |    |
| pc\_      |           |           |           |         |    |
| supportOf |           |           |           |         |    |
| RedCap\_r |           |           |           |         |    |
| 17=false, |           |           |           |         |    |
| UL grant  |           |           |           |         |    |
| of 256    |           |           |           |         |    |
| bits      |           |           |           |         |    |
| (L~RBs~ & |           |           |           |         |    |
| I~MCS~ as |           |           |           |         |    |
| per       |           |           |           |         |    |
| 38.5      |           |           |           |         |    |
| 23-3\[3\] |           |           |           |         |    |
| annex B)  |           |           |           |         |    |
| is chosen |           |           |           |         |    |
| to enable |           |           |           |         |    |
| UE to     |           |           |           |         |    |
| transmit  |           |           |           |         |    |
| two MAC   |           |           |           |         |    |
| SDUs of   |           |           |           |         |    |
| size 11   |           |           |           |         |    |
| and 10    |           |           |           |         |    |
| bytes in  |           |           |           |         |    |
| a MAC PDU |           |           |           |         |    |
| (8 bytes  |           |           |           |         |    |
| RLC SDU + |           |           |           |         |    |
| 3 bytes   |           |           |           |         |    |
| AMD PDU   |           |           |           |         |    |
| header +2 |           |           |           |         |    |
| Bytes MAC |           |           |           |         |    |
| sub       |           |           |           |         |    |
| Header +  |           |           |           |         |    |
| 7 bytes   |           |           |           |         |    |
| RLC SDU+  |           |           |           |         |    |
| 3 bytes   |           |           |           |         |    |
| AMD PDU   |           |           |           |         |    |
| header+2  |           |           |           |         |    |
| Bytes MAC |           |           |           |         |    |
| sub       |           |           |           |         |    |
| Header +  |           |           |           |         |    |
| 2 Bytes   |           |           |           |         |    |
| Long BSR  |           |           |           |         |    |
| MAC Sub   |           |           |           |         |    |
| Header +  |           |           |           |         |    |
| 3 Bytes   |           |           |           |         |    |
| Long BSR  |           |           |           |         |    |
| + 2 Bytes |           |           |           |         |    |
| MAC       |           |           |           |         |    |
| Padding   |           |           |           |         |    |
| Sub PDU)  |           |           |           |         |    |
| or (8     |           |           |           |         |    |
| bytes RLC |           |           |           |         |    |
| SDU + 3   |           |           |           |         |    |
| bytes AMD |           |           |           |         |    |
| PDU       |           |           |           |         |    |
| header +2 |           |           |           |         |    |
| Bytes MAC |           |           |           |         |    |
| sub       |           |           |           |         |    |
| Header +  |           |           |           |         |    |
| 7 bytes   |           |           |           |         |    |
| RLC SDU+  |           |           |           |         |    |
| 3 bytes   |           |           |           |         |    |
| AMD PDU   |           |           |           |         |    |
| header+2  |           |           |           |         |    |
| Bytes MAC |           |           |           |         |    |
| sub       |           |           |           |         |    |
| Header +  |           |           |           |         |    |
| 1 Byte    |           |           |           |         |    |
| Short BSR |           |           |           |         |    |
| MAC Sub   |           |           |           |         |    |
| Header +  |           |           |           |         |    |
| 1 Byte    |           |           |           |         |    |
| Short BSR |           |           |           |         |    |
| + 7 Bytes |           |           |           |         |    |
| MAC       |           |           |           |         |    |
| Padding   |           |           |           |         |    |
| Sub PDU)  |           |           |           |         |    |
| = 32      |           |           |           |         |    |
| Bytes.\   |           |           |           |         |    |
| If        |           |           |           |         |    |
| pc\       |           |           |           |         |    |
| _supportO |           |           |           |         |    |
| fRedCap\_ |           |           |           |         |    |
| r17=true, |           |           |           |         |    |
| UL grant  |           |           |           |         |    |
| of 256    |           |           |           |         |    |
| bits      |           |           |           |         |    |
| (LRBs &   |           |           |           |         |    |
| IMCS as   |           |           |           |         |    |
| per       |           |           |           |         |    |
| 38.52     |           |           |           |         |    |
| 3-3Â \[3\] |           |           |           |         |    |
| annex B)  |           |           |           |         |    |
| is chosen |           |           |           |         |    |
| to enable |           |           |           |         |    |
| UE to     |           |           |           |         |    |
| transmit  |           |           |           |         |    |
| two MAC   |           |           |           |         |    |
| SDUs of   |           |           |           |         |    |
| size 10   |           |           |           |         |    |
| and 9     |           |           |           |         |    |
| bytes in  |           |           |           |         |    |
| a MAC PDU |           |           |           |         |    |
| (8 bytes  |           |           |           |         |    |
| RLC SDU + |           |           |           |         |    |
| 2 bytes   |           |           |           |         |    |
| AMD PDU   |           |           |           |         |    |
| header +2 |           |           |           |         |    |
| Bytes MAC |           |           |           |         |    |
| sub       |           |           |           |         |    |
| Header +  |           |           |           |         |    |
| 7 bytes   |           |           |           |         |    |
| RLC SDU+  |           |           |           |         |    |
| 2 bytes   |           |           |           |         |    |
| AMD PDU   |           |           |           |         |    |
| header+2  |           |           |           |         |    |
| Bytes MAC |           |           |           |         |    |
| sub       |           |           |           |         |    |
| Header +  |           |           |           |         |    |
| 2 Bytes   |           |           |           |         |    |
| Long BSR  |           |           |           |         |    |
| MAC Sub   |           |           |           |         |    |
| Header +  |           |           |           |         |    |
| 3 Bytes   |           |           |           |         |    |
| Long BSR  |           |           |           |         |    |
| + 4 Bytes |           |           |           |         |    |
| MAC       |           |           |           |         |    |
| Padding   |           |           |           |         |    |
| Sub PDU)  |           |           |           |         |    |
| or (8     |           |           |           |         |    |
| bytes RLC |           |           |           |         |    |
| SDU + 2   |           |           |           |         |    |
| bytes AMD |           |           |           |         |    |
| PDU       |           |           |           |         |    |
| header +2 |           |           |           |         |    |
| Bytes MAC |           |           |           |         |    |
| sub       |           |           |           |         |    |
| Header +  |           |           |           |         |    |
| 7 bytes   |           |           |           |         |    |
| RLC SDU+  |           |           |           |         |    |
| 2 bytes   |           |           |           |         |    |
| AMD PDU   |           |           |           |         |    |
| header+2  |           |           |           |         |    |
| Bytes MAC |           |           |           |         |    |
| sub       |           |           |           |         |    |
| Header +  |           |           |           |         |    |
| 1 Byte    |           |           |           |         |    |
| Short BSR |           |           |           |         |    |
| MAC Sub   |           |           |           |         |    |
| Header +  |           |           |           |         |    |
| 1 Byte    |           |           |           |         |    |
| Short BSR |           |           |           |         |    |
| + 7 Bytes |           |           |           |         |    |
| MAC       |           |           |           |         |    |
| Padding   |           |           |           |         |    |
| Sub PDU)  |           |           |           |         |    |
| = 32      |           |           |           |         |    |
| Bytes.    |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.3.4.3.3 Specific message contents {#specific-message-contents-3 .H6}

Table 7.1.1.3.4.3.3: MAC-CellGroupConfig (preamble)

  ----------------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], clause Table 4.6.3-68                            
  Information Element                                         Value/remark   Comment   Condition
  MAC-CellGroupConfig ::= SEQUENCE {                                                   
  bsr-Config SEQUENCE {                                                                
  periodicBSR-Timer                                           infinity                 
  retxBSR-Timer                                               sf320                    
  }                                                                                    
  phr-Config CHOICE {                                                                  
  release                                                     NULL                     
  }                                                                                    
  }                                                                                    
  ----------------------------------------------------------- -------------- --------- -----------

##### 7.1.1.3.5 Correct handling of MAC control information / Buffer Status / UL resources are allocated / Padding BSR

##### 7.1.1.3.5.1 Test Purpose (TP) {#test-purpose-tp-4 .H6}

##### (1) {#section-26 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE transmits a MAC PDU and the number of padding bits is
equal to the size of a Short BSR plus its subheader and the UE has
available data for transmission from more than one LCG in the TTI where
the BSR is transmitted }

**then** { UE reports a Truncated short BSR of the LCG with the highest
priority logical channel with data available for transmission }

}

##### (2) {#section-27 .H6}

**with** { UE in E-UTRA RRC\_CONNECTED state }

**ensure that** {

**when** { UE transmits a MAC PDU and the number of padding bits is
larger than the size of a Short BSR plus its subheader but smaller than
the size of a Long BSR plus its subheader and the UE has available data
for transmission from more than one LCG in the TTI where the BSR is
transmitted }

**then** { UE reports a Truncated long BSR }

}

##### (3) {#section-28 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE transmits a MAC PDU and the number of padding bits is
equal to or larger than the size of a Short BSR plus its subheader but
smaller than the size of a Long BSR plus its subheader and the UE has
available data for transmission from only one LCG in the TTI where the
BSR is transmitted }

**then** { UE reports a Short BSR }

}

##### (4) {#section-29 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE transmits a MAC PDU and the number of padding bits is
equal to or larger than the size of a Long BSR plus its subheader }

**then** { UE reports a long BSR }

}

##### 7.1.1.3.5.2 Conformance requirements {#conformance-requirements-4 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.321, clauses 5.4.5, 6.1.3.1 and 6.2.1. Unless
otherwise stated these are Rel-15 requirements.

\[TS 38.321, clause 5.4.5\]

The Buffer Status reporting (BSR) procedure is used to provide the
serving gNB with information about UL data volume in the MAC entity.

RRC configures the following parameters to control the BSR:

\- *periodicBSR-Timer*;

\- *retxBSR-Timer*;

\- *logicalChannelSR-Delay*;

\- *logicalChannelSR-DelayTimer*;

\- *logicalChannelGroup*.

Each logical channel may be allocated to an LCG using the
*logicalChannelGroup*. The maximum number of LCGs is eight.

The MAC entity determines the amount of UL data available for a logical
channel according to the data volume calculation procedure in TSs 38.322
and 38.323 \[3\] \[4\].

A BSR shall be triggered if any of the following events occur:

\- the MAC entity has new UL data available for a logical channel which
belongs to an LCG; and either

\- the new UL data belongs to a logical channel with higher priority
than the priority of any logical channel containing available UL data
which belong to any LCG; or

\- none of the logical channels which belong to an LCG contains any
available UL data.

in which case the BSR is referred below to as \'Regular BSR\';

\- UL resources are allocated and number of padding bits is equal to or
larger than the size of the Buffer Status Report MAC CE plus its
subheader, in which case the BSR is referred below to as \'Padding
BSR\';

\- *retxBSR-Timer* expires, and at least one of the logical channels
which belong to an LCG contains UL data, in which case the BSR is
referred below to as \'Regular BSR\';

\- *periodicBSR-Timer* expires, in which case the BSR is referred below
to as \'Periodic BSR\'.

For Regular BSR, the MAC entity shall:

1\> if the BSR is triggered for a logical channel for which
*logicalChannelSR-Delay* is configured by upper layers:

2\> start or restart the *logicalChannelSR-DelayTimer*.

1\> else:

2\> if running, stop the *logicalChannelSR-DelayTimer*.

For Regular and Periodic BSR, the MAC entity shall:

1\> if more than one LCG has data available for transmission when the
BSR is to be transmitted:

2\> report Long BSR for all LCGs which have data available for
transmission.

1\> else:

2\> report Short BSR.

For Padding BSR:

1\> if the number of padding bits is equal to or larger than the size of
the Short BSR plus its subheader but smaller than the size of the Long
BSR plus its subheader:

2\> if more than one LCG has data available for transmission when the
BSR is to be transmitted:

3\> if the number of padding bits is equal to the size of the Short BSR
plus its subheader:

4\> report Short Truncated BSR of the LCG with the highest priority
logical channel with data available for transmission.

3\> else:

4\> report Long Truncated BSR of the LCG(s) with the logical channels
having data available for transmission following a decreasing order of
priority, and in case of equal priority, in increasing order of LCGID.

2\> else:

3\> report Short BSR;

1\> else if the number of padding bits is equal to or larger than the
size of the Long BSR plus its subheader:

2\> report Long BSR for all LCGs which have data available for
transmission.

The MAC entity shall:

1\> if the Buffer Status reporting procedure determines that at least
one BSR has been triggered and not cancelled:

2\> if UL-SCH resources are available for a new immediate transmission:

3\> instruct the Multiplexing and Assembly procedure to generate the BSR
MAC CE(s);

3\> start or restart *periodicBSR-Timer* except when all the generated
BSRs are long or short Truncated BSRs;

3\> start or restart *retxBSR-Timer*.

2\> else if a Regular BSR has been triggered and
*logicalChannelSR-DelayTimer* is not running:

3\> if an uplink grant is not a configured grant; or

3\> if the Regular BSR was not triggered for a logical channel for which
logical channel SR masking (*logicalChannelSR-Mask*) is setup by upper
layers:

4\> trigger a Scheduling Request.

A MAC PDU shall contain at most one BSR MAC CE, even when multiple
events have triggered a BSR by the time. The Regular BSR and the
Periodic BSR shall have precedence over the padding BSR.

The MAC entity shall restart *retxBSR-Timer* upon reception of a grant
for transmission of new data on any UL-SCH.

All triggered BSRs may be cancelled when the UL grant(s) can accommodate
all pending data available for transmission but is not sufficient to
additionally accommodate the BSR MAC control element plus its subheader.
All triggered BSRs shall be cancelled when a BSR is included in a MAC
PDU for transmission.

The MAC entity shall transmit at most one BSR in one MAC PDU. Padding
BSR shall not be included when the MAC PDU contains a Regular or
Periodic BSR.

\[TS 38.321, clause 6.1.3.1\]

Buffer Status Report (BSR) MAC CEs consist of either:

\- Short BSR format (fixed size); or

\- Long BSR format (variable size); or

\- Short Truncated BSR format (fixed size); or

\- Long Truncated BSR format (variable size).

The BSR formats are identified by MAC PDU subheaders with LCIDs as
specified in Table 6.2.1-2.

The fields in the BSR MAC CE are defined as follows:

\- LCG ID: The Logical Channel Group ID field identifies the group of
logical channel(s) whose buffer status is being reported. The length of
the field is 3 bits;

\- LCG~i~: For the Long BSR format, this field indicates the presence of
the Buffer Size field for the logical channel group i. The LCG~i~ field
set to \"1\" indicates that the Buffer Size field for the logical
channel group i is reported. The LCG~i~ field set to \"0\" indicates
that the Buffer Size field for the logical channel group i is not
reported. For the Long Truncated BSR format, this field indicates
whether logical channel group i has data available. The LCG~i~ field set
to \"1\" indicates that logical channel group i has data available. The
LCG~i~ field set to \"0\" indicates that logical channel group i does
not have data available;

\- Buffer Size: The Buffer Size field identifies the total amount of
data available according to the data volume calculation procedure in TSs
38.322 and 38.323 \[3\] \[4\] across all logical channels of a logical
channel group after the MAC PDU has been built (i.e. after the logical
channel prioritization procedure, which may result the value of the
Buffer Size field to zero). The amount of data is indicated in number of
bytes. The size of the RLC and MAC headers are not considered in the
buffer size computation. The length of this field for the Short BSR
format and the Short Truncated BSR format is 5 bits. The length of this
field for the Long BSR format and the Long Truncated BSR format is 8
bits. The values for the 5-bit and 8-bit Buffer Size fields are shown in
Tables 6.1.3.1-1 and 6.1.3.1-2, respectively. For the Long BSR format
and the Long Truncated BSR format, the Buffer Size fields are included
in ascending order based on the LCG~i~. For the Long Truncated BSR
format the number of Buffer Size fields included is maximised, while not
exceeding the number of padding bits.

NOTE: The number of the Buffer Size fields in the Long Truncated BSR
format can be zero.

![](./media/image6.emf)

Figure 6.1.3.1-1: Short BSR and Short Truncated BSR MAC CE

![](./media/image7.emf)

Figure 6.1.3.1-2: Long BSR and Long Truncated BSR MAC CE

Table 6.1.3.1-1: Buffer size levels (in bytes) for 5-bit Buffer Size
field

  Index   BS value   Index   BS value   Index   BS value   Index   BS value
  ------- ---------- ------- ---------- ------- ---------- ------- -----------
  0       0          8       â¤ 102      16      â¤ 1446     24      â¤ 20516
  1       â¤ 10       9       â¤ 142      17      â¤ 2014     25      â¤ 28581
  2       â¤ 14       10      â¤ 198      18      â¤ 2806     26      â¤ 39818
  3       â¤ 20       11      â¤ 276      19      â¤ 3909     27      â¤ 55474
  4       â¤ 28       12      â¤ 384      20      â¤ 5446     28      â¤ 77284
  5       â¤ 38       13      â¤ 535      21      â¤ 7587     29      â¤ 107669
  6       â¤ 53       14      â¤ 745      22      â¤ 10570    30      â¤ 150000
  7       â¤ 74       15      â¤ 1038     23      â¤ 14726    31      \> 150000

Table 6.1.3.1-2: Buffer size levels (in bytes) for 8-bit Buffer Size
field

  ------- ---------- ------- ---------- ------- ----------- ------- -------------
  Index   BS value   Index   BS value   Index   BS value    Index   BS value
  0       0          64      â¤ 560      128     â¤ 31342     192     â¤ 1754595
  1       â¤ 10       65      â¤ 597      129     â¤ 33376     193     â¤ 1868488
  2       â¤ 11       66      â¤ 635      130     â¤ 35543     194     â¤ 1989774
  3       â¤ 12       67      â¤ 677      131     â¤ 37850     195     â¤ 2118933
  4       â¤ 13       68      â¤ 720      132     â¤ 40307     196     â¤ 2256475
  5       â¤ 14       69      â¤ 767      133     â¤ 42923     197     â¤ 2402946
  6       â¤ 15       70      â¤ 817      134     â¤ 45709     198     â¤ 2558924
  7       â¤ 16       71      â¤ 870      135     â¤ 48676     199     â¤ 2725027
  8       â¤ 17       72      â¤ 926      136     â¤ 51836     200     â¤ 2901912
  9       â¤ 18       73      â¤ 987      137     â¤ 55200     201     â¤ 3090279
  10      â¤ 19       74      â¤ 1051     138     â¤ 58784     202     â¤ 3290873
  11      â¤ 20       75      â¤ 1119     139     â¤ 62599     203     â¤ 3504487
  12      â¤ 22       76      â¤ 1191     140     â¤ 66663     204     â¤ 3731968
  13      â¤ 23       77      â¤ 1269     141     â¤ 70990     205     â¤ 3974215
  14      â¤ 25       78      â¤ 1351     142     â¤ 75598     206     â¤ 4232186
  15      â¤ 26       79      â¤ 1439     143     â¤ 80505     207     â¤ 4506902
  16      â¤ 28       80      â¤ 1532     144     â¤ 85730     208     â¤ 4799451
  17      â¤ 30       81      â¤ 1631     145     â¤ 91295     209     â¤ 5110989
  18      â¤ 32       82      â¤ 1737     146     â¤ 97221     210     â¤ 5442750
  19      â¤ 34       83      â¤ 1850     147     â¤ 103532    211     â¤ 5796046
  20      â¤ 36       84      â¤ 1970     148     â¤ 110252    212     â¤ 6172275
  21      â¤ 38       85      â¤ 2098     149     â¤ 117409    213     â¤ 6572925
  22      â¤ 40       86      â¤ 2234     150     â¤ 125030    214     â¤ 6999582
  23      â¤ 43       87      â¤ 2379     151     â¤ 133146    215     â¤ 7453933
  24      â¤ 46       88      â¤ 2533     152     â¤ 141789    216     â¤ 7937777
  25      â¤ 49       89      â¤ 2698     153     â¤ 150992    217     â¤ 8453028
  26      â¤ 52       90      â¤ 2873     154     â¤ 160793    218     â¤ 9001725
  27      â¤ 55       91      â¤ 3059     155     â¤ 171231    219     â¤ 9586039
  28      â¤ 59       92      â¤ 3258     156     â¤ 182345    220     â¤ 10208280
  29      â¤ 62       93      â¤ 3469     157     â¤ 194182    221     â¤ 10870913
  30      â¤ 66       94      â¤ 3694     158     â¤ 206786    222     â¤ 11576557
  31      â¤ 71       95      â¤ 3934     159     â¤ 220209    223     â¤ 12328006
  32      â¤ 75       96      â¤ 4189     160     â¤ 234503    224     â¤ 13128233
  33      â¤ 80       97      â¤ 4461     161     â¤ 249725    225     â¤ 13980403
  34      â¤ 85       98      â¤ 4751     162     â¤ 265935    226     â¤ 14887889
  35      â¤ 91       99      â¤ 5059     163     â¤ 283197    227     â¤ 15854280
  36      â¤ 97       100     â¤ 5387     164     â¤ 301579    228     â¤ 16883401
  37      â¤ 103      101     â¤ 5737     165     â¤ 321155    229     â¤ 17979324
  38      â¤ 110      102     â¤ 6109     166     â¤ 342002    230     â¤ 19146385
  39      â¤ 117      103     â¤ 6506     167     â¤ 364202    231     â¤ 20389201
  40      â¤ 124      104     â¤ 6928     168     â¤ 387842    232     â¤ 21712690
  41      â¤ 132      105     â¤ 7378     169     â¤ 413018    233     â¤ 23122088
  42      â¤ 141      106     â¤ 7857     170     â¤ 439827    234     â¤ 24622972
  43      â¤ 150      107     â¤ 8367     171     â¤ 468377    235     â¤ 26221280
  44      â¤ 160      108     â¤ 8910     172     â¤ 498780    236     â¤ 27923336
  45      â¤ 170      109     â¤ 9488     173     â¤ 531156    237     â¤ 29735875
  46      â¤ 181      110     â¤ 10104    174     â¤ 565634    238     â¤ 31666069
  47      â¤ 193      111     â¤ 10760    175     â¤ 602350    239     â¤ 33721553
  48      â¤ 205      112     â¤ 11458    176     â¤ 641449    240     â¤ 35910462
  49      â¤ 218      113     â¤ 12202    177     â¤ 683087    241     â¤ 38241455
  50      â¤ 233      114     â¤ 12994    178     â¤ 727427    242     â¤ 40723756
  51      â¤ 248      115     â¤ 13838    179     â¤ 774645    243     â¤ 43367187
  52      â¤ 264      116     â¤ 14736    180     â¤ 824928    244     â¤ 46182206
  53      â¤ 281      117     â¤ 15692    181     â¤ 878475    245     â¤ 49179951
  54      â¤ 299      118     â¤ 16711    182     â¤ 935498    246     â¤ 52372284
  55      â¤ 318      119     â¤ 17795    183     â¤ 996222    247     â¤ 55771835
  56      â¤ 339      120     â¤ 18951    184     â¤ 1060888   248     â¤ 59392055
  57      â¤ 361      121     â¤ 20181    185     â¤ 1129752   249     â¤ 63247269
  58      â¤ 384      122     â¤ 21491    186     â¤ 1203085   250     â¤ 67352729
  59      â¤ 409      123     â¤ 22885    187     â¤ 1281179   251     â¤ 71724679
  60      â¤ 436      124     â¤ 24371    188     â¤ 1364342   252     â¤ 76380419
  61      â¤ 464      125     â¤ 25953    189     â¤ 1452903   253     â¤ 81338368
  62      â¤ 494      126     â¤ 27638    190     â¤ 1547213   254     \> 81338368
  63      â¤ 526      127     â¤ 29431    191     â¤ 1647644   255     Reserved
  ------- ---------- ------- ---------- ------- ----------- ------- -------------

\[TS 38.321, clause 6.2.1\]

Table 6.2.1-2: Values of LCID for UL-SCH

  Index            LCID values
  ---------------- ---------------------------------
  000000           CCCH
  000001--100000   Identity of the logical channel
  100001--110110   Reserved
  110111           Configured Grant Confirmation
  111000           Multiple Entry PHR
  111001           Single Entry PHR
  111010           C-RNTI
  111011           Short Truncated BSR
  111100           Long Truncated BSR
  111101           Short BSR
  111110           Long BSR
  111111           Padding

##### 7.1.1.3.5.3 Test description {#test-description-4 .H6}

##### 7.1.1.3.5.3.1 Pre-test conditions {#pre-test-conditions-4 .H6}

Same Pre-test conditions as in clause 7.1.1.0 with the exception of 2 AM
DRBs on NR cell configured according to Table 7.1.1.3.5.3.1-1.

Table 7.1.1.3.5.3.1-1: Logical Channel Configuration Settings

  Parameter                DRB1                    DRB2
  ------------------------ ----------------------- -----------------------
  LogicalChannelIdentity   LCH4(DRB-Identity +3)   LCH5(DRB-Identity +3)
  Priority                 7                       6
  prioritizedBitRate       0kbs                    0kbs
  logicalChannelGroup      2 (LCG ID\#2)           1 (LCG ID\#1)

##### 7.1.1.3.5.3.2 Test procedure sequence {#test-procedure-sequence-4 .H6}

Table 7.1.1.3.5.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \-        | \-        | \-      | \- |
|           | ignores   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | requests  |           |           |         |    |
|           | and does  |           |           |         |    |
|           | not       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | any       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Step 2    |           |           |         |    |
|           | shall be  |           |           |         |    |
|           | repeated  |           |           |         |    |
|           | for 3     |           |           |         |    |
|           | times     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC SDU  |         |    |
|           | a MAC PDU |           | on LCH5)  |         |    |
|           | including |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | PDU of    |           |           |         |    |
|           | size 13   |           |           |         |    |
|           | bytes on  |           |           |         |    |
|           | LCH5.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC SDU  |         |    |
|           | a MAC PDU |           | on LCH4)  |         |    |
|           | including |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | PDU of    |           |           |         |    |
|           | size 12   |           |           |         |    |
|           | bytes on  |           |           |         |    |
|           | LCH4.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | UE        | \--\>     | (SR)      | \-      | \- |
|           | transmits |           |           |         |    |
|           | a         |           |           |         |    |
|           | S         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | Request   |           |           |         |    |
|           | on PUCCH. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | The SS    | \<\--     | (UL       | \-      | \- |
|           | sends an  |           | grant)    |         |    |
|           | uplink    |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | size 40   |           |           |         |    |
|           | bits.     |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmit  |           | (Long BSR |         |    |
|           | a Long    |           | header    |         |    |
|           | BSR       |           | (LCID='   |         |    |
|           | report.   |           | 111110'), |         |    |
|           |           |           | Long BSR) |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The SS    | \<\--     | (UL       | \-      | \- |
|           | sends an  |           | grant)    |         |    |
|           | uplink    |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | size 136  |           |           |         |    |
|           | bits.     |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does UE   |           | (MAC sub  |         |    |
|           | transmit  |           | PDU       |         |    |
|           | a MAC PDU |           | header    |         |    |
|           | c         |           | for RLC   |         |    |
|           | ontaining |           | PDU, RLC  |         |    |
|           | an RLC    |           | PDU,      |         |    |
|           | SDU and a |           | short     |         |    |
|           | short     |           | truncated |         |    |
|           | truncated |           | BSR       |         |    |
|           | BSR       |           | header    |         |    |
|           | i         |           | (LCID='   |         |    |
|           | ndicating |           | 111011'), |         |    |
|           | pending   |           | short     |         |    |
|           | data      |           | truncat   |         |    |
|           | ('Buffer  |           | edBSR(LCG |         |    |
|           | size'     |           | ID ='01', |         |    |
|           | field \>  |           | Buffer    |         |    |
|           | '0') for  |           | si        |         |    |
|           | l         |           | ze\>'0')) |         |    |
|           | ogicalCha |           |           |         |    |
|           | nnelGroup |           |           |         |    |
|           | 1 ('LCG   |           |           |         |    |
|           | ID' field |           |           |         |    |
|           | set to    |           |           |         |    |
|           | '01')?    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | The SS    | \<\--     | (UL       | \-      | \- |
|           | sends an  |           | grant)    |         |    |
|           | uplink    |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | size 152  |           |           |         |    |
|           | bits.     |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | Does UE   |           | (MAC sub  |         |    |
|           | transmit  |           | PDU       |         |    |
|           | a MAC PDU |           | header    |         |    |
|           | c         |           | for RLC   |         |    |
|           | ontaining |           | PDU, RLC  |         |    |
|           | an RLC    |           | PDU, long |         |    |
|           | SDU and a |           | truncated |         |    |
|           | long      |           | BSR       |         |    |
|           | truncated |           | header    |         |    |
|           | BSR       |           | (LCID='   |         |    |
|           | i         |           | 111100'), |         |    |
|           | ndicating |           | long      |         |    |
|           | pending   |           | trun      |         |    |
|           | data      |           | catedBSR( |         |    |
|           | available |           | LCG~1~=1, |         |    |
|           | for       |           | LCG~2~=1, |         |    |
|           | LCG~1~    |           | Buffer    |         |    |
|           | and       |           | siz       |         |    |
|           | LCG~2~    |           | e1\>'0')) |         |    |
|           | and       |           |           |         |    |
|           | 'Buffer   |           |           |         |    |
|           | size'     |           |           |         |    |
|           | field \>  |           |           |         |    |
|           | '0' for   |           |           |         |    |
|           | l         |           |           |         |    |
|           | ogicalCha |           |           |         |    |
|           | nnelGroup |           |           |         |    |
|           | 1?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | The SS    | \<\--     | (UL       | \-      | \- |
|           | sends an  |           | grant)    |         |    |
|           | uplink    |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | size 136  |           |           |         |    |
|           | bits.     |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note 4)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | Check:    | \--\>     | MAC PDU   | 3       | P  |
|           | Does UE   |           | (MAC sub  |         |    |
|           | transmit  |           | PDU       |         |    |
|           | a MAC PDU |           | header    |         |    |
|           | c         |           | for RLC   |         |    |
|           | ontaining |           | PDU, RLC  |         |    |
|           | an RLC    |           | PDU,      |         |    |
|           | SDU and   |           | Short BSR |         |    |
|           | with a    |           | hea       |         |    |
|           | Short BSR |           | der(LCID= |         |    |
|           | i         |           | '11101'), |         |    |
|           | ndicating |           | Short     |         |    |
|           | pending   |           | BSR(LCG   |         |    |
|           | data      |           | ID        |         |    |
|           | ('Buffer  |           | ='1       |         |    |
|           | size'     |           | 0',Buffer |         |    |
|           | field \>  |           | si        |         |    |
|           | '0') for  |           | ze\>'0')) |         |    |
|           | l         |           |           |         |    |
|           | ogicalCha |           |           |         |    |
|           | nnelGroup |           |           |         |    |
|           | 2 ('LCG   |           |           |         |    |
|           | ID' field |           |           |         |    |
|           | ='10')?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12A       | SS        | \<\--     | RLC       | \-      | \- |
|           | transmits |           | STATUS    |         |    |
|           | an RLC    |           | PDU       |         |    |
|           | STATUS    |           | (A        |         |    |
|           | PDU to    |           | CK\_SN=3) |         |    |
|           | ac        |           |           |         |    |
|           | knowledge |           |           |         |    |
|           | correctly |           |           |         |    |
|           | received  |           |           |         |    |
|           | data      |           |           |         |    |
|           | (L        |           |           |         |    |
|           | CID=LCH5) |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | The SS    | \<\--     | (UL       | \-      | \- |
|           | sends an  |           | grant)    |         |    |
|           | uplink    |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | size 160  |           |           |         |    |
|           | bits.     |           |           |         |    |
|           | (Note 5)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | Check:    | \--\>     | MAC PDU   | 4       | P  |
|           | Does UE   |           | (MAC sub  |         |    |
|           | transmit  |           | PDU       |         |    |
|           | a MAC PDU |           | header    |         |    |
|           | c         |           | for RLC   |         |    |
|           | ontaining |           | PDU, RLC  |         |    |
|           | a RLC SDU |           | PDU, Long |         |    |
|           | and a     |           | BSR       |         |    |
|           | Long BSR? |           | header    |         |    |
|           |           |           | (LCID=    |         |    |
|           |           |           | '11110'), |         |    |
|           |           |           | Long      |         |    |
|           |           |           | BSR))     |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | SS        | \<\--     | RLC       | \-      | \- |
|           | transmits |           | STATUS    |         |    |
|           | an RLC    |           | PDU       |         |    |
|           | STATUS    |           | (A        |         |    |
|           | PDU to    |           | CK\_SN=1) |         |    |
|           | ac        |           |           |         |    |
|           | knowledge |           |           |         |    |
|           | correctly |           |           |         |    |
|           | received  |           |           |         |    |
|           | data      |           |           |         |    |
|           | (L        |           |           |         |    |
|           | CID=LCH4) |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| 40 bits   |           |           |           |         |    |
| (L~RBs~ & |           |           |           |         |    |
| I~MCS~ as |           |           |           |         |    |
| per       |           |           |           |         |    |
| 38.5      |           |           |           |         |    |
| 23-3\[3\] |           |           |           |         |    |
| annex B)  |           |           |           |         |    |
| enables   |           |           |           |         |    |
| UE to     |           |           |           |         |    |
| transmit  |           |           |           |         |    |
| a MAC PDU |           |           |           |         |    |
| with a    |           |           |           |         |    |
| MAC BSR   |           |           |           |         |    |
| header (1 |           |           |           |         |    |
| byte) and |           |           |           |         |    |
| a Short   |           |           |           |         |    |
| BSR (1    |           |           |           |         |    |
| byte) or  |           |           |           |         |    |
| a MAC BSR |           |           |           |         |    |
| header (2 |           |           |           |         |    |
| bytes) a  |           |           |           |         |    |
| Long BSR  |           |           |           |         |    |
| (3 bytes  |           |           |           |         |    |
| when 2    |           |           |           |         |    |
| LCG       |           |           |           |         |    |
| con       |           |           |           |         |    |
| figured). |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| UE        |           |           |           |         |    |
| triggers  |           |           |           |         |    |
| a         |           |           |           |         |    |
| truncated |           |           |           |         |    |
| Short BSR |           |           |           |         |    |
| of type   |           |           |           |         |    |
| \"Padding |           |           |           |         |    |
| BSR\" to  |           |           |           |         |    |
| report    |           |           |           |         |    |
| buffer    |           |           |           |         |    |
| status    |           |           |           |         |    |
| for one   |           |           |           |         |    |
| LCG for   |           |           |           |         |    |
| that TTI. |           |           |           |         |    |
| (2 Bytes  |           |           |           |         |    |
| MAC Data  |           |           |           |         |    |
| sub PDU   |           |           |           |         |    |
| header +  |           |           |           |         |    |
| 13 Bytes  |           |           |           |         |    |
| MAC SDU + |           |           |           |         |    |
| 1 Byte    |           |           |           |         |    |
| Short     |           |           |           |         |    |
| truncated |           |           |           |         |    |
| BSR sub   |           |           |           |         |    |
| header +  |           |           |           |         |    |
| 1 Byte    |           |           |           |         |    |
| Short     |           |           |           |         |    |
| truncated |           |           |           |         |    |
| BSR = 17  |           |           |           |         |    |
| bytes)    |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| UE        |           |           |           |         |    |
| triggers  |           |           |           |         |    |
| a         |           |           |           |         |    |
| truncated |           |           |           |         |    |
| Long BSR  |           |           |           |         |    |
| of type   |           |           |           |         |    |
| \"Padding |           |           |           |         |    |
| BSR\" to  |           |           |           |         |    |
| report    |           |           |           |         |    |
| buffer    |           |           |           |         |    |
| status    |           |           |           |         |    |
| for one   |           |           |           |         |    |
| LCG for   |           |           |           |         |    |
| that TTI. |           |           |           |         |    |
| (2 Bytes  |           |           |           |         |    |
| MAC Data  |           |           |           |         |    |
| sub PDU   |           |           |           |         |    |
| header +  |           |           |           |         |    |
| 13 Bytes  |           |           |           |         |    |
| MAC SDU + |           |           |           |         |    |
| 2 Bytes   |           |           |           |         |    |
| Long      |           |           |           |         |    |
| truncated |           |           |           |         |    |
| BSR sub   |           |           |           |         |    |
| header +  |           |           |           |         |    |
| 2 Bytes   |           |           |           |         |    |
| Long      |           |           |           |         |    |
| truncated |           |           |           |         |    |
| BSR = 19  |           |           |           |         |    |
| bytes)    |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 4:   |           |           |           |         |    |
| UE        |           |           |           |         |    |
| triggers  |           |           |           |         |    |
| a Short   |           |           |           |         |    |
| BSR of    |           |           |           |         |    |
| type      |           |           |           |         |    |
| \"Padding |           |           |           |         |    |
| BSR\" to  |           |           |           |         |    |
| report    |           |           |           |         |    |
| buffer    |           |           |           |         |    |
| status    |           |           |           |         |    |
| for one   |           |           |           |         |    |
| LCG for   |           |           |           |         |    |
| that TTI. |           |           |           |         |    |
| (2 Bytes  |           |           |           |         |    |
| MAC Data  |           |           |           |         |    |
| sub PDU   |           |           |           |         |    |
| header +  |           |           |           |         |    |
| 13 Bytes  |           |           |           |         |    |
| MAC SDU + |           |           |           |         |    |
| 1 Byte    |           |           |           |         |    |
| Short BSR |           |           |           |         |    |
| sub       |           |           |           |         |    |
| header +  |           |           |           |         |    |
| 1 Byte    |           |           |           |         |    |
| short BSR |           |           |           |         |    |
| = 17      |           |           |           |         |    |
| bytes)    |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 5:   |           |           |           |         |    |
| UE        |           |           |           |         |    |
| triggers  |           |           |           |         |    |
| a long    |           |           |           |         |    |
| BSR of    |           |           |           |         |    |
| type      |           |           |           |         |    |
| \"Padding |           |           |           |         |    |
| BSR\" to  |           |           |           |         |    |
| report    |           |           |           |         |    |
| buffer    |           |           |           |         |    |
| status    |           |           |           |         |    |
| for one   |           |           |           |         |    |
| LCG for   |           |           |           |         |    |
| that TTI. |           |           |           |         |    |
| (2 Bytes  |           |           |           |         |    |
| MAC Data  |           |           |           |         |    |
| sub PDU   |           |           |           |         |    |
| header +  |           |           |           |         |    |
| 12 Bytes  |           |           |           |         |    |
| MAC SDU + |           |           |           |         |    |
| 2 Bytes   |           |           |           |         |    |
| long BSR  |           |           |           |         |    |
| sub       |           |           |           |         |    |
| header +  |           |           |           |         |    |
| 1 Byte    |           |           |           |         |    |
| long BSR  |           |           |           |         |    |
| + 1 byte  |           |           |           |         |    |
| Padding   |           |           |           |         |    |
| sub       |           |           |           |         |    |
| header +  |           |           |           |         |    |
| 2 bytes   |           |           |           |         |    |
| Padding = |           |           |           |         |    |
| 20 bytes) |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.3.5.3.3 Specific message contents {#specific-message-contents-4 .H6}

None

##### 7.1.1.3.6 Correct handling of MAC control information / Buffer status / Periodic BSR timer expires

##### 7.1.1.3.6.1 Test Purpose (TP) {#test-purpose-tp-5 .H6}

##### (1) {#section-30 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { periodicBSR-Timer expires and more than one LCG has buffered
data }

**then** { UE triggers a Periodic BSR and reports Long BSR and restarts
the periodicBSR-Timer }

}

##### (2) {#section-31 .H6}

**with** { UE in E-UTRA RRC\_CONNECTED state }

**ensure that** {

**when** { periodicBSR-Timer expires and one LCG has buffered data }

**then** { UE triggers a Periodic BSR and reports Short BSR and restarts
the periodicBSR-Timer }

}

##### 7.1.1.3.6.2 Conformance requirements {#conformance-requirements-5 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.321, clauses 5.4.5, 6.1.3.1 and 6.2.1. Unless
otherwise stated these are Rel-15 requirements.

\[TS 38.321, clause 5.4.5\]

The Buffer Status reporting (BSR) procedure is used to provide the
serving gNB with information about UL data volume in the MAC entity.

RRC configures the following parameters to control the BSR:

\- *periodicBSR-Timer*;

\- *retxBSR-Timer*;

\- *logicalChannelSR-Delay*;

\- *logicalChannelSR-DelayTimer*;

\- *logicalChannelGroup*.

Each logical channel may be allocated to an LCG using the
*logicalChannelGroup*. The maximum number of LCGs is eight.

The MAC entity determines the amount of UL data available for a logical
channel according to the data volume calculation procedure in TSs 38.322
and 38.323 \[3\] \[4\].

A BSR shall be triggered if any of the following events occur:

\- the MAC entity has new UL data available for a logical channel which
belongs to an LCG; and either

\- the new UL data belongs to a logical channel with higher priority
than the priority of any logical channel containing available UL data
which belong to any LCG; or

\- none of the logical channels which belong to an LCG contains any
available UL data.

in which case the BSR is referred below to as \'Regular BSR\';

\- UL resources are allocated and number of padding bits is equal to or
larger than the size of the Buffer Status Report MAC CE plus its
subheader, in which case the BSR is referred below to as \'Padding
BSR\';

\- *retxBSR-Timer* expires, and at least one of the logical channels
which belong to an LCG contains UL data, in which case the BSR is
referred below to as \'Regular BSR\';

\- *periodicBSR-Timer* expires, in which case the BSR is referred below
to as \'Periodic BSR\'.

For Regular BSR, the MAC entity shall:

1\> if the BSR is triggered for a logical channel for which
*logicalChannelSR-Delay* is configured by upper layers:

2\> start or restart the *logicalChannelSR-DelayTimer*.

1\> else:

2\> if running, stop the *logicalChannelSR-DelayTimer*.

For Regular and Periodic BSR, the MAC entity shall:

1\> if more than one LCG has data available for transmission when the
BSR is to be transmitted:

2\> report Long BSR for all LCGs which have data available for
transmission.

1\> else:

2\> report Short BSR.

For Padding BSR:

1\> if the number of padding bits is equal to or larger than the size of
the Short BSR plus its subheader but smaller than the size of the Long
BSR plus its subheader:

2\> if more than one LCG has data available for transmission when the
BSR is to be transmitted:

3\> if the number of padding bits is equal to the size of the Short BSR
plus its subheader:

4\> report Short Truncated BSR of the LCG with the highest priority
logical channel with data available for transmission.

3\> else:

4\> report Long Truncated BSR of the LCG(s) with the logical channels
having data available for transmission following a decreasing order of
priority, and in case of equal priority, in increasing order of LCGID.

2\> else:

3\> report Short BSR;

1\> else if the number of padding bits is equal to or larger than the
size of the Long BSR plus its subheader:

2\> report Long BSR for all LCGs which have data available for
transmission.

The MAC entity shall:

1\> if the Buffer Status reporting procedure determines that at least
one BSR has been triggered and not cancelled:

2\> if UL-SCH resources are available for a new immediate transmission:

3\> instruct the Multiplexing and Assembly procedure to generate the BSR
MAC CE(s);

3\> start or restart *periodicBSR-Timer* except when all the generated
BSRs are long or short Truncated BSRs;

3\> start or restart *retxBSR-Timer*.

2\> else if a Regular BSR has been triggered and
*logicalChannelSR-DelayTimer* is not running:

3\> if an uplink grant is not a configured grant; or

3\> if the Regular BSR was not triggered for a logical channel for which
logical channel SR masking (*logicalChannelSR-Mask*) is setup by upper
layers:

4\> trigger a Scheduling Request.

A MAC PDU shall contain at most one BSR MAC CE, even when multiple
events have triggered a BSR by the time. The Regular BSR and the
Periodic BSR shall have precedence over the padding BSR.

The MAC entity shall restart *retxBSR-Timer* upon reception of a grant
for transmission of new data on any UL-SCH.

All triggered BSRs may be cancelled when the UL grant(s) can accommodate
all pending data available for transmission but is not sufficient to
additionally accommodate the BSR MAC control element plus its subheader.
All triggered BSRs shall be cancelled when a BSR is included in a MAC
PDU for transmission.

The MAC entity shall transmit at most one BSR in one MAC PDU. Padding
BSR shall not be included when the MAC PDU contains a Regular or
Periodic BSR.

\[TS 38.321, clause 6.1.3.1\]

Buffer Status Report (BSR) MAC CEs consist of either:

\- Short BSR format (fixed size); or

\- Long BSR format (variable size); or

\- Short Truncated BSR format (fixed size); or

\- Long Truncated BSR format (variable size).

The BSR formats are identified by MAC PDU subheaders with LCIDs as
specified in Table 6.2.1-2.

The fields in the BSR MAC CE are defined as follows:

\- LCG ID: The Logical Channel Group ID field identifies the group of
logical channel(s) whose buffer status is being reported. The length of
the field is 3 bits;

\- LCG~i~: For the Long BSR format, this field indicates the presence of
the Buffer Size field for the logical channel group i. The LCG~i~ field
set to \"1\" indicates that the Buffer Size field for the logical
channel group i is reported. The LCG~i~ field set to \"0\" indicates
that the Buffer Size field for the logical channel group i is not
reported. For the Long Truncated BSR format, this field indicates
whether logical channel group i has data available. The LCG~i~ field set
to \"1\" indicates that logical channel group i has data available. The
LCG~i~ field set to \"0\" indicates that logical channel group i does
not have data available;

\- Buffer Size: The Buffer Size field identifies the total amount of
data available according to the data volume calculation procedure in TSs
38.322 and 38.323 \[3\] \[4\] across all logical channels of a logical
channel group after the MAC PDU has been built (i.e. after the logical
channel prioritization procedure, which may result the value of the
Buffer Size field to zero). The amount of data is indicated in number of
bytes. The size of the RLC and MAC headers are not considered in the
buffer size computation. The length of this field for the Short BSR
format and the Short Truncated BSR format is 5 bits. The length of this
field for the Long BSR format and the Long Truncated BSR format is 8
bits. The values for the 5-bit and 8-bit Buffer Size fields are shown in
Tables 6.1.3.1-1 and 6.1.3.1-2, respectively. For the Long BSR format
and the Long Truncated BSR format, the Buffer Size fields are included
in ascending order based on the LCG~i~. For the Long Truncated BSR
format the number of Buffer Size fields included is maximised, while not
exceeding the number of padding bits.

NOTE: The number of the Buffer Size fields in the Long Truncated BSR
format can be zero.

![](./media/image6.emf)

Figure 6.1.3.1-1: Short BSR and Short Truncated BSR MAC CE

![](./media/image7.emf)

Figure 6.1.3.1-2: Long BSR and Long Truncated BSR MAC CE

Table 6.1.3.1-1: Buffer size levels (in bytes) for 5-bit Buffer Size
field

  Index   BS value   Index   BS value   Index   BS value   Index   BS value
  ------- ---------- ------- ---------- ------- ---------- ------- -----------
  0       0          8       â¤ 102      16      â¤ 1446     24      â¤ 20516
  1       â¤ 10       9       â¤ 142      17      â¤ 2014     25      â¤ 28581
  2       â¤ 14       10      â¤ 198      18      â¤ 2806     26      â¤ 39818
  3       â¤ 20       11      â¤ 276      19      â¤ 3909     27      â¤ 55474
  4       â¤ 28       12      â¤ 384      20      â¤ 5446     28      â¤ 77284
  5       â¤ 38       13      â¤ 535      21      â¤ 7587     29      â¤ 107669
  6       â¤ 53       14      â¤ 745      22      â¤ 10570    30      â¤ 150000
  7       â¤ 74       15      â¤ 1038     23      â¤ 14726    31      \> 150000

Table 6.1.3.1-2: Buffer size levels (in bytes) for 8-bit Buffer Size
field

  Index   BS value   Index   BS value   Index   BS value    Index   BS value
  ------- ---------- ------- ---------- ------- ----------- ------- -------------
  0       0          64      â¤ 526      128     â¤ 29431     192     â¤ 1647644
  1       â¤ 10       65      â¤ 560      129     â¤ 31342     193     â¤ 1754595
  2       â¤ 11       66      â¤ 597      130     â¤ 33376     194     â¤ 1868488
  3       â¤ 12       67      â¤ 635      131     â¤ 35543     195     â¤ 1989774
  4       â¤ 13       68      â¤ 677      132     â¤ 37850     196     â¤ 2118933
  5       â¤ 13       69      â¤ 720      133     â¤ 40307     197     â¤ 2256475
  6       â¤ 14       70      â¤ 767      134     â¤ 42923     198     â¤ 2402946
  7       â¤ 15       71      â¤ 817      135     â¤ 45709     199     â¤ 2558924
  8       â¤ 16       72      â¤ 870      136     â¤ 48676     200     â¤ 2725027
  9       â¤ 17       73      â¤ 926      137     â¤ 51836     201     â¤ 2901912
  10      â¤ 18       74      â¤ 987      138     â¤ 55200     202     â¤ 3090279
  11      â¤ 19       75      â¤ 1051     139     â¤ 58784     203     â¤ 3290873
  12      â¤ 20       76      â¤ 1119     140     â¤ 62599     204     â¤ 3504487
  13      â¤ 22       77      â¤ 1191     141     â¤ 66663     205     â¤ 3731968
  14      â¤ 23       78      â¤ 1269     142     â¤ 70990     206     â¤ 3974215
  15      â¤ 25       79      â¤ 1351     143     â¤ 75598     207     â¤ 4232186
  16      â¤ 26       80      â¤ 1439     144     â¤ 80505     208     â¤ 4506902
  17      â¤ 28       81      â¤ 1532     145     â¤ 85730     209     â¤ 4799451
  18      â¤ 30       82      â¤ 1631     146     â¤ 91295     210     â¤ 5110989
  19      â¤ 32       83      â¤ 1737     147     â¤ 97221     211     â¤ 5442750
  20      â¤ 34       84      â¤ 1850     148     â¤ 103532    212     â¤ 5796046
  21      â¤ 36       85      â¤ 1970     149     â¤ 110252    213     â¤ 6172275
  22      â¤ 38       86      â¤ 2098     150     â¤ 117409    214     â¤ 6572925
  23      â¤ 40       87      â¤ 2234     151     â¤ 125030    215     â¤ 6999582
  24      â¤ 43       88      â¤ 2379     152     â¤ 133146    216     â¤ 7453933
  25      â¤ 46       89      â¤ 2533     153     â¤ 141789    217     â¤ 7937777
  26      â¤ 49       90      â¤ 2698     154     â¤ 150992    218     â¤ 8453028
  27      â¤ 52       91      â¤ 2873     155     â¤ 160793    219     â¤ 9001725
  28      â¤ 55       92      â¤ 3059     156     â¤ 171231    220     â¤ 9586039
  29      â¤ 59       93      â¤ 3258     157     â¤ 182345    221     â¤ 10208280
  30      â¤ 62       94      â¤ 3469     158     â¤ 194182    222     â¤ 10870913
  31      â¤ 66       95      â¤ 3694     159     â¤ 206786    223     â¤ 11576557
  32      â¤ 71       96      â¤ 3934     160     â¤ 220209    224     â¤ 12328006
  33      â¤ 75       97      â¤ 4189     161     â¤ 234503    225     â¤ 13128233
  34      â¤ 80       98      â¤ 4461     162     â¤ 249725    226     â¤ 13980403
  35      â¤ 85       99      â¤ 4751     163     â¤ 265935    227     â¤ 14887889
  36      â¤ 91       100     â¤ 5059     164     â¤ 283197    228     â¤ 15854280
  37      â¤ 97       101     â¤ 5387     165     â¤ 301579    229     â¤ 16883401
  38      â¤ 103      102     â¤ 5737     166     â¤ 321155    230     â¤ 17979324
  39      â¤ 110      103     â¤ 6109     167     â¤ 342002    231     â¤ 19146385
  40      â¤ 117      104     â¤ 6506     168     â¤ 364202    232     â¤ 20389201
  41      â¤ 124      105     â¤ 6928     169     â¤ 387842    233     â¤ 21712690
  42      â¤ 132      106     â¤ 7378     170     â¤ 413018    234     â¤ 23122088
  43      â¤ 141      107     â¤ 7857     171     â¤ 439827    235     â¤ 24622972
  44      â¤ 150      108     â¤ 8367     172     â¤ 468377    236     â¤ 26221280
  45      â¤ 160      109     â¤ 8910     173     â¤ 498780    237     â¤ 27923336
  46      â¤ 170      110     â¤ 9488     174     â¤ 531156    238     â¤ 29735875
  47      â¤ 181      111     â¤ 10104    175     â¤ 565634    239     â¤ 31666069
  48      â¤ 193      112     â¤ 10760    176     â¤ 602350    240     â¤ 33721553
  49      â¤ 205      113     â¤ 11458    177     â¤ 641449    241     â¤ 35910462
  50      â¤ 218      114     â¤ 12202    178     â¤ 683087    242     â¤ 38241455
  51      â¤ 233      115     â¤ 12994    179     â¤ 727427    243     â¤ 40723756
  52      â¤ 248      116     â¤ 13838    180     â¤ 774645    244     â¤ 43367187
  53      â¤ 264      117     â¤ 14736    181     â¤ 824928    245     â¤ 46182206
  54      â¤ 281      118     â¤ 15692    182     â¤ 878475    246     â¤ 49179951
  55      â¤ 299      119     â¤ 16711    183     â¤ 935498    247     â¤ 52372284
  56      â¤ 318      120     â¤ 17795    184     â¤ 996222    248     â¤ 55771835
  57      â¤ 339      121     â¤ 18951    185     â¤ 1060888   249     â¤ 59392055
  58      â¤ 361      122     â¤ 20181    186     â¤ 1129752   250     â¤ 63247269
  59      â¤ 384      123     â¤ 21491    187     â¤ 1203085   251     â¤ 67352729
  60      â¤ 409      124     â¤ 22885    188     â¤ 1281179   252     â¤ 71724679
  61      â¤ 436      125     â¤ 24371    189     â¤ 1364342   253     â¤ 76380419
  62      â¤ 464      126     â¤ 25953    190     â¤ 1452903   254     â¤ 81338368
  63      â¤ 494      127     â¤ 27638    191     â¤ 1547213   255     \> 81338368

\[TS 38.321, clause 6.2.1\]

Table 6.2.1-2: Values of LCID for UL-SCH

  Index            LCID values
  ---------------- ---------------------------------
  000000           CCCH
  000001--100000   Identity of the logical channel
  100001--110110   Reserved
  110111           Configured Grant Confirmation
  111000           Multiple Entry PHR
  111001           Single Entry PHR
  111010           C-RNTI
  111011           Short Truncated BSR
  111100           Long Truncated BSR
  111101           Short BSR
  111110           Long BSR
  111111           Padding

##### 7.1.1.3.6.3 Test description {#test-description-5 .H6}

##### 7.1.1.3.6.3.1 Pre-test conditions {#pre-test-conditions-5 .H6}

Same Pre-test conditions as in clause 7.1.1.0 with the exception of 2 SN
terminated SCG bearers configured according to Table 7.1.1.3.6.3.1-1.

Table 7.1.1.3.6.3.1-1: Logical Channel Configuration Settings

  Parameter                DRB1                    DRB2
  ------------------------ ----------------------- -----------------------
  LogicalChannelIdentity   LCH4(DRB-Identity +3)   LCH5(DRB-Identity +3)
  Priority                 7                       6
  prioritizedBitRate       0kbs                    0kbs
  logicalChannelGroup      2 (LCG ID\#2)           1 (LCG ID\#1)

##### 7.1.1.3.6.3.2 Test procedure sequence {#test-procedure-sequence-5 .H6}

Table 7.1.1.3.6.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \-        | \-        | \-      | \- |
|           | ignores   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | requests  |           |           |         |    |
|           | and does  |           |           |         |    |
|           | not       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | any       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The SS    | \<\--     | MAC PDU   |         |    |
|           | transmits |           | (RLC PDU) |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | PDU on    |           |           |         |    |
|           | LCH4 (LCG |           |           |         |    |
|           | ID 2),    |           |           |         |    |
|           | which     |           |           |         |    |
|           | contains  |           |           |         |    |
|           | 1 RLC SDU |           |           |         |    |
|           | of size   |           |           |         |    |
|           | 14 bytes. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \<\--     | (UL       | \-      | \- |
|           | sends an  |           | grant)    |         |    |
|           | uplink    |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | size 32   |           |           |         |    |
|           | bits.     |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           | ((LCID='  |         |    |
|           | a short   |           | 111101',  |         |    |
|           | BSR       |           | LCG       |         |    |
|           | report    |           | I         |         |    |
|           | and       |           | D=\'10\', |         |    |
|           | restarts  |           | Buffer    |         |    |
|           | *         |           | size      |         |    |
|           | periodicB |           | index \>  |         |    |
|           | SR-Timer* |           | 0)        |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Steps 5   |           |           |         |    |
|           | to 7      |           |           |         |    |
|           | shall be  |           |           |         |    |
|           | repeated  |           |           |         |    |
|           | two times |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Wait for  | \-        | \-        | \-      | \- |
|           | periodic  |           |           |         |    |
|           | BSR-Timer |           |           |         |    |
|           | expiry.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The SS    | \-        | \-        | \-      | \- |
|           | sends an  |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | size 32   |           |           |         |    |
|           | bits      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | Does UE   |           | (LCID=    |         |    |
|           | transmit  |           | '111101', |         |    |
|           | a MAC PDU |           | LCG       |         |    |
|           | c         |           | ID='10',  |         |    |
|           | ontaining |           | Buffer    |         |    |
|           | a Short   |           | Size      |         |    |
|           | BSR with  |           | index \>  |         |    |
|           | 'LCG ID'  |           | 0)        |         |    |
|           | field set |           |           |         |    |
|           | to '10'   |           |           |         |    |
|           | (l        |           |           |         |    |
|           | ogicalCha |           |           |         |    |
|           | nnelGroup |           |           |         |    |
|           | 2) and    |           |           |         |    |
|           | Buffer    |           |           |         |    |
|           | Size      |           |           |         |    |
|           | Index \>  |           |           |         |    |
|           | 0?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC PDU) |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | PDU on    |           |           |         |    |
|           | LCH5 (LCG |           |           |         |    |
|           | ID 1),    |           |           |         |    |
|           | which     |           |           |         |    |
|           | contains  |           |           |         |    |
|           | 1 RLC SDU |           |           |         |    |
|           | of size   |           |           |         |    |
|           | 14 bytes. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | The SS    | \<\--     | (UL       | \-      | \- |
|           | sends an  |           | grant)    |         |    |
|           | uplink    |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | size 40   |           |           |         |    |
|           | bits      |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           | ((        |         |    |
|           | a long    |           | 'Buffer   |         |    |
|           | BSR       |           | size\#1   |         |    |
|           | report    |           | index' \> |         |    |
|           | with      |           | 0,        |         |    |
|           | 'Buffer   |           | 'Buffer   |         |    |
|           | size\#1'  |           | size\#2   |         |    |
|           | (LCG      |           | index='   |         |    |
|           | ID=1) and |           | \>0')     |         |    |
|           | 'Buffer   |           |           |         |    |
|           | size\#2'  |           |           |         |    |
|           | (LCG      |           |           |         |    |
|           | ID=2)     |           |           |         |    |
|           | fields    |           |           |         |    |
|           | set to    |           |           |         |    |
|           | value \>  |           |           |         |    |
|           | '0'       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Step 11   |           |           |         |    |
|           | to 13     |           |           |         |    |
|           | shall be  |           |           |         |    |
|           | repeated  |           |           |         |    |
|           | twice.    |           |           |         |    |
|           | (Note 4)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | Wait for  | \-        | \-        | \-      | \- |
|           | periodic  |           |           |         |    |
|           | BSR-Timer |           |           |         |    |
|           | expiry.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | The SS    | \-        | \-        | \-      | \- |
|           | sends an  |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | size 40   |           |           |         |    |
|           | bits      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does UE   |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a Long    |           |           |         |    |
|           | BSR with  |           |           |         |    |
|           | 'Buffer   |           |           |         |    |
|           | size\#1'  |           |           |         |    |
|           | (LCG      |           |           |         |    |
|           | ID=1) and |           |           |         |    |
|           | 'Buffer   |           |           |         |    |
|           | size\#2'  |           |           |         |    |
|           | (LCG      |           |           |         |    |
|           | ID=2)     |           |           |         |    |
|           | fields    |           |           |         |    |
|           | set to    |           |           |         |    |
|           | value \>  |           |           |         |    |
|           | '0'?      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | The SS    |           |           | \-      | \- |
|           | transmits |           |           |         |    |
|           | 1 UL      |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | size 320  |           |           |         |    |
|           | bits to   |           |           |         |    |
|           | enable    |           |           |         |    |
|           | the UE to |           |           |         |    |
|           | loopback  |           |           |         |    |
|           | RLC SDU   |           |           |         |    |
|           | on LCH4   |           |           |         |    |
|           | and LCH5. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | the       |           |           |         |    |
|           | remaining |           |           |         |    |
|           | RLC SDUs  |           |           |         |    |
|           | as sent   |           |           |         |    |
|           | by the SS |           |           |         |    |
|           | in steps  |           |           |         |    |
|           | 2 and 8.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| SS        |           |           |           |         |    |
| transmits |           |           |           |         |    |
| an UL     |           |           |           |         |    |
| grant of  |           |           |           |         |    |
| 32        |           |           |           |         |    |
| bi        |           |           |           |         |    |
| ts(L~RBs~ |           |           |           |         |    |
| & I~MCS~  |           |           |           |         |    |
| as per    |           |           |           |         |    |
| 38.5      |           |           |           |         |    |
| 23-3\[3\] |           |           |           |         |    |
| annex B)  |           |           |           |         |    |
| to allow  |           |           |           |         |    |
| UE to     |           |           |           |         |    |
| transmit  |           |           |           |         |    |
| a Regular |           |           |           |         |    |
| BSR       |           |           |           |         |    |
| triggered |           |           |           |         |    |
| by the    |           |           |           |         |    |
| new data  |           |           |           |         |    |
| received  |           |           |           |         |    |
| l         |           |           |           |         |    |
| ogicalCha |           |           |           |         |    |
| nnelGroup |           |           |           |         |    |
| 1 in step |           |           |           |         |    |
| 2.        |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| One short |           |           |           |         |    |
| BSR due   |           |           |           |         |    |
| to first  |           |           |           |         |    |
| expiry of |           |           |           |         |    |
| *         |           |           |           |         |    |
| periodicB |           |           |           |         |    |
| SR-Timer* |           |           |           |         |    |
| and one   |           |           |           |         |    |
| short BSR |           |           |           |         |    |
| due to    |           |           |           |         |    |
| second    |           |           |           |         |    |
| expire of |           |           |           |         |    |
| *p        |           |           |           |         |    |
| eriodicBS |           |           |           |         |    |
| R-Timer*. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| SS        |           |           |           |         |    |
| transmits |           |           |           |         |    |
| an UL     |           |           |           |         |    |
| grant of  |           |           |           |         |    |
| 40        |           |           |           |         |    |
| bi        |           |           |           |         |    |
| ts(L~RBs~ |           |           |           |         |    |
| & I~MCS~  |           |           |           |         |    |
| as per    |           |           |           |         |    |
| 38.5      |           |           |           |         |    |
| 23-3\[3\] |           |           |           |         |    |
| annex B)  |           |           |           |         |    |
| to allow  |           |           |           |         |    |
| UE to     |           |           |           |         |    |
| transmit  |           |           |           |         |    |
| a Regular |           |           |           |         |    |
| BSR       |           |           |           |         |    |
| triggered |           |           |           |         |    |
| by the    |           |           |           |         |    |
| new data  |           |           |           |         |    |
| received  |           |           |           |         |    |
| on higher |           |           |           |         |    |
| priority  |           |           |           |         |    |
| l         |           |           |           |         |    |
| ogicalCha |           |           |           |         |    |
| nnelGroup |           |           |           |         |    |
| 1 in step |           |           |           |         |    |
| 8.        |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 4:   |           |           |           |         |    |
| One long  |           |           |           |         |    |
| BSR due   |           |           |           |         |    |
| to expire |           |           |           |         |    |
| of        |           |           |           |         |    |
| *         |           |           |           |         |    |
| periodicB |           |           |           |         |    |
| SR-Timer* |           |           |           |         |    |
| and one   |           |           |           |         |    |
| long BSR  |           |           |           |         |    |
| due to    |           |           |           |         |    |
| second    |           |           |           |         |    |
| expiry of |           |           |           |         |    |
| *p        |           |           |           |         |    |
| eriodicBS |           |           |           |         |    |
| R-Timer.* |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.3.6.3.3 Specific message contents {#specific-message-contents-5 .H6}

Table 7.1.1.3.6.3.3: MAC-CellGroupConfig (preamble)

  --------------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.308 \[6\], clause Table 4.6.3-49                            
  Information Element                                       Value/remark   Comment   Condition
  MAC-CellGroupConfig ::= SEQUENCE {                                                 
  bsr-Config SEQUENCE {                                                              
  periodicBSR-Timer                                         sf160                    
  retxBSR-Timer                                             sf10240                  
  }                                                                                  
  phr-Config CHOICE {                                                                
  release                                                   NULL                     
  }                                                                                  
  }                                                                                  
  --------------------------------------------------------- -------------- --------- -----------

##### 7.1.1.3.7 UE power headroom reporting / Periodic reporting / DL pathloss change reporting

##### 7.1.1.3.7.1 Test Purpose (TP) {#test-purpose-tp-6 .H6}

##### (1) {#section-32 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { *phr-PeriodicTimer* is configured in UE }

**then** { UE transmits a MAC PDU containing Power Headroom MAC Control
Element }

}

##### (2) {#section-33 .H6}

**with** { UE in RRC\_CONNECTED state with periodic power headroom
reporting configured }

**ensure that** {

**when** { *phr-PeriodicTimer* expires **and** UL resources allocated
for new transmission }

**then** { UE transmits a MAC PDU containing Power Headroom MAC Control
Element }

}

##### (3) {#section-34 .H6}

**with** { UE in RRC\_CONNECTED state with periodic power headroom
reporting configured }

**ensure that** {

**when** { power headroom reporting is disabled }

**then** { UE stops transmitting Power Headroom MAC Control Element }

}

##### (4) {#section-35 .H6}

**with** { UE in RRC\_Connected state with Power headroom reporting for
*phr-Tx-PowerFactorChange* configured }

**ensure that** {

**when** { the DL Pathloss has changed more than
*phr-Tx-PowerFactorChange* dB **and** *phr-ProhibitTimer* is running }

**then** { UE does not transmit a MAC PDU containing Power Headroom MAC
Control Element }

}

##### (5) {#section-36 .H6}

**with** { UE in RRC\_Connected state with Power headroom reporting for
*phr-Tx-PowerFactorChange* configured }

**ensure that** {

**when** { *phr-ProhibitTimer* expires **and** power headroom report is
triggered due to DL Pathloss change }

**then** { UE transmits a MAC PDU containing Power Headroom MAC Control
Element }

}

##### 7.1.1.3.7.2 Conformance requirements {#conformance-requirements-6 .H6}

References: The conformance requirements covered in the current TC are
specified in: TS 38.321 clause 5.4.6 and 6.1.3.8. Unless otherwise
stated these are Rel-15 requirements.

\[TS 38.321, clause 5.4.6\]

The Power Headroom reporting procedure is used to provide the serving
gNB with the following information:

\- Type 1 power headroom: the difference between the nominal UE maximum
transmit power and the estimated power for UL-SCH transmission per
activated Serving Cell;

\- Type 2 power headroom: the difference between the nominal UE maximum
transmit power and the estimated power for UL-SCH and PUCCH transmission
on SpCell of the other MAC entity (i.e. E-UTRA MAC entity in EN-DC case
only);

\- Type 3 power headroom: the difference between the nominal UE maximum
transmit power and the estimated power for SRS transmission per
activated Serving Cell.

RRC controls Power Headroom reporting by configuring the following
parameters:

\- *phr-PeriodicTimer*;

\- *phr-ProhibitTimer*;

\- *phr-Tx-PowerFactorChange*;

\- *phr-Type2PCell*;

\- *phr-Type2OtherCell*;

\- *phr-ModeOtherCG*;

\- *multiplePHR*.

A Power Headroom Report (PHR) shall be triggered if any of the following
events occur:

\- *phr-ProhibitTimer* expires or has expired and the path loss has
changed more than *phr-Tx-PowerFactorChange* dB for at least one
activated Serving Cell of any MAC entity which is used as a pathloss
reference since the last transmission of a PHR in this MAC entity when
the MAC entity has UL resources for new transmission;

NOTE 1: The path loss variation for one cell assessed above is between
the pathloss measured at present time on the current pathloss reference
and the pathloss measured at the transmission time of the last
transmission of PHR on the pathloss reference in use at that time,
irrespective of whether the pathloss reference has changed in between.

\- *phr-PeriodicTimer* expires;

\- upon configuration or reconfiguration of the power headroom reporting
functionality by upper layers, which is not used to disable the
function;

\- activation of an SCell of any MAC entity with configured uplink;

\- addition of the PSCell (i.e. PSCell is newly added or changed);

\- *phr-ProhibitTimer* expires or has expired, when the MAC entity has
UL resources for new transmission, and the following is true for any of
the activated Serving Cells of any MAC entity with configured uplink:

\- there are UL resources allocated for transmission or there is a PUCCH
transmission on this cell, and the required power backoff due to power
management (as allowed by P-MPR~c~ as specified in TS 38.101-1 \[14\],
TS 38.101-2 \[15\], and TS 38.101-3 \[16\]) for this cell has changed
more than *phr-Tx-PowerFactorChange* dB since the last transmission of a
PHR when the MAC entity had UL resources allocated for transmission or
PUCCH transmission on this cell.

NOTE 2: The MAC entity should avoid triggering a PHR when the required
power backoff due to power management decreases only temporarily (e.g.
for up to a few tens of milliseconds) and it should avoid reflecting
such temporary decrease in the values of P~CMAX,f,c~/PH when a PHR is
triggered by other triggering conditions.

If the MAC entity has UL resources allocated for a new transmission the
MAC entity shall:

1\> if it is the first UL resource allocated for a new transmission
since the last MAC reset:

2\> start *phr-PeriodicTimer*;

1\> if the Power Headroom reporting procedure determines that at least
one PHR has been triggered and not cancelled; and

1\> if the allocated UL resources can accommodate the MAC CE for PHR
which the MAC entity is configured to transmit, plus its subheader, as a
result of LCP as defined in subclause 5.4.3.1:

2\> if *multiplePHR* is configured:

3\> for each activated Serving Cell with configured uplink associated
with any MAC entity:

4\> obtain the value of the Type 1 or Type 3 power headroom for the
corresponding uplink carrier as specified in subclause 7.7 of TS 38.213
\[6\];

4\> if this MAC entity has UL resources allocated for transmission on
this Serving Cell; or

4\> if the other MAC entity, if configured, has UL resources allocated
for transmission on this Serving Cell and *phr-ModeOtherCG* is set to
real by upper layers:

5\> obtain the value for the corresponding P~CMAX,f,c~ field from the
physical layer.

3\> if *phr-Type2OtherCell* is configured:

4\> if the other MAC entity is E-UTRA MAC entity:

5\> obtain the value of the Type 2 power headroom for the SpCell of the
other MAC entity (i.e. E-UTRA MAC entity);

5\> if *phr-ModeOtherCG* is set to real by upper layers:

6\> obtain the value for the corresponding P~CMAX,f,c~ field for the
SpCell of the other MAC entity (i.e. E-UTRA MAC entity) from the
physical layer.

3\> instruct the Multiplexing and Assembly procedure to generate and
transmit the Multiple Entry PHR MAC CE as defined in subclause 6.1.3.9
based on the values reported by the physical layer.

2\> else (i.e. Single Entry PHR format is used):

3\> obtain the value of the Type 1 power headroom from the physical
layer for the corresponding uplink carrier of the PCell;

3\> obtain the value for the corresponding P~CMAX,f,c~ field from the
physical layer;

3\> instruct the Multiplexing and Assembly procedure to generate and
transmit the Single Entry PHR MAC CE as defined in subclause 6.1.3.8
based on the values reported by the physical layer.

2\> start or restart *phr-PeriodicTimer*;

2\> start or restart *phr-ProhibitTimer*;

2\> cancel all triggered PHR(s).

\[TS 38.321, clause 6.1.3.8\]

The Single Entry PHR MAC CE is identified by a MAC PDU subheader with
LCID as specified in Table 6.2.1-2.

It has a fixed size and consists of two octet defined as follows (figure
6.1.3.8-1):

\- R: Reserved bit, set to \"0\";

\- Power Headroom (PH): This field indicates the power headroom level.
The length of the field is 6 bits. The reported PH and the corresponding
power headroom levels are shown in Table 6.1.3.8-1 below (the
corresponding measured values in dB are specified in TS 38.133 \[11\]);

\- P~CMAX,f,c~: This field indicates the P~CMAX,f,c~ (as specified in TS
38.213 \[6\]) used for calculation of the preceding PH field. The
reported P~CMAX,f,c~ and the corresponding nominal UE transmit power
levels are shown in Table 6.1.3.8-2 (the corresponding measured values
in dBm are specified in TS 38.133 \[11\]).

Figure 6.1.3.8-1: Single Entry PHR MAC CE

Table 6.1.3.8-1: Power Headroom levels for PHR

  ----- ----------------------
  PH    Power Headroom Level
  0     POWER\_HEADROOM\_0
  1     POWER\_HEADROOM\_1
  2     POWER\_HEADROOM\_2
  3     POWER\_HEADROOM\_3
  ...   ...
  60    POWER\_HEADROOM\_60
  61    POWER\_HEADROOM\_61
  62    POWER\_HEADROOM\_62
  63    POWER\_HEADROOM\_63
  ----- ----------------------

Table 6.1.3.8-2: Nominal UE transmit power level for PHR

+-------------+---------------------------------+
| P~CMAXf,,c~ | Nominal UE transmit power level |
+-------------+---------------------------------+
| 0           | > PCMAX\_C\_00                  |
+-------------+---------------------------------+
| 1           | > PCMAX\_C\_01                  |
+-------------+---------------------------------+
| 2           | > PCMAX\_C\_02                  |
+-------------+---------------------------------+
| ...         | ...                             |
+-------------+---------------------------------+
| 61          | > PCMAX\_C\_61                  |
+-------------+---------------------------------+
| 62          | > PCMAX\_C\_62                  |
+-------------+---------------------------------+
| 63          | > PCMAX\_C\_63                  |
+-------------+---------------------------------+

##### 7.1.1.3.7.3 Test description {#test-description-6 .H6}

##### 7.1.1.3.7.3.1 Pre-test conditions {#pre-test-conditions-6 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that set to return
no data in uplink.

##### 7.1.1.3.7.3.2 Test procedure sequence {#test-procedure-sequence-6 .H6}

Table 7.1.1.3.7.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\--     | \-        | \-      | \- |
|           | transmits |           |           |         |    |
|           | UL grant  |           |           |         |    |
|           | to the UE |           |           |         |    |
|           | at every  |           |           |         |    |
|           | 10ms in   |           |           |         |    |
|           | PDCCH     |           |           |         |    |
|           | occasion. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | SS        | \<\--     | *(RR      | \-      | \- |
|           | transmits |           | CReconfig |         |    |
|           | NR        |           | uration)* |         |    |
|           | *RRCRecon |           |           |         |    |
|           | figuratio |           |           |         |    |
|           | n*message |           |           |         |    |
|           | to        |           |           |         |    |
|           | configure |           |           |         |    |
|           | specific  |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | p         |           |           |         |    |
|           | arameters |           |           |         |    |
|           | for NR    |           |           |         |    |
|           | Cell(Note |           |           |         |    |
|           | 1).       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | Control   |           |           |         |    |
|           | Element?  |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note 2,  |           |           |         |    |
|           | 5)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an NR     |           | gurationC |         |    |
|           | *         |           | omplete)* |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | confirm   |           |           |         |    |
|           | the setup |           |           |         |    |
|           | of Power  |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | pa        |           |           |         |    |
|           | rameters. |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note     |           |           |         |    |
|           | 2,3)      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | Control   |           |           |         |    |
|           | Element   |           |           |         |    |
|           | 500ms     |           |           |         |    |
|           | after     |           |           |         |    |
|           | step 3?   |           |           |         |    |
|           | (Note 5)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The SS    | \<\--     | *(RR      | \-      | \- |
|           | transmits |           | CReconfig |         |    |
|           | an NR     |           | uration)* |         |    |
|           | *R        |           |           |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | disable   |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | report    |           |           |         |    |
|           | ing.(Note |           |           |         |    |
|           | 1)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an NR     |           | gurationC |         |    |
|           | *         |           | omplete)* |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | confirm   |           |           |         |    |
|           | the       |           |           |         |    |
|           | disabling |           |           |         |    |
|           | of Power  |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | paramet   |           |           |         |    |
|           | ers.(Note |           |           |         |    |
|           | 3)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | Check:    | \--\>     | MAC PDU   | 3       | F  |
|           | for 2     |           |           |         |    |
|           | seconds,  |           |           |         |    |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | Control   |           |           |         |    |
|           | Element?  |           |           |         |    |
|           | (Note 5)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | SS        | \<\--     | *(RR      | \-      | \- |
|           | transmits |           | CReconfig |         |    |
|           | NR        |           | uration)* |         |    |
|           | *RRCRecon |           |           |         |    |
|           | figuratio |           |           |         |    |
|           | n*message |           |           |         |    |
|           | to        |           |           |         |    |
|           | configure |           |           |         |    |
|           | specific  |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | p         |           |           |         |    |
|           | arameters |           |           |         |    |
|           | for NR    |           |           |         |    |
|           | C         |           |           |         |    |
|           | ell.(Note |           |           |         |    |
|           | 1)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | Control   |           |           |         |    |
|           | Element?  |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note 4,  |           |           |         |    |
|           | 5)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an NR     |           | gurationC |         |    |
|           | *         |           | omplete)* |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | confirm   |           |           |         |    |
|           | the setup |           |           |         |    |
|           | of Power  |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | pa        |           |           |         |    |
|           | rameters. |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note     |           |           |         |    |
|           | 3,4)      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | Wait for  | \-        | \-        | \-      | \- |
|           | T1= 20%   |           |           |         |    |
|           | of        |           |           |         |    |
|           | *p        |           |           |         |    |
|           | rohibitPH |           |           |         |    |
|           | R-Timer*. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | Reduce SS | \-        | \-        | \-      | \- |
|           | power     |           |           |         |    |
|           | level for |           |           |         |    |
|           | NR Cell   |           |           |         |    |
|           | so as to  |           |           |         |    |
|           | cause a   |           |           |         |    |
|           | DL\       |           |           |         |    |
|           | _Pathloss |           |           |         |    |
|           | change at |           |           |         |    |
|           | UE by     |           |           |         |    |
|           | 5dB.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | Check:    | \--\>     | MAC PDU   | 4       | F  |
|           | for 80%   |           |           |         |    |
|           | of        |           |           |         |    |
|           | *         |           |           |         |    |
|           | prohibitP |           |           |         |    |
|           | HR-Timer* |           |           |         |    |
|           | since     |           |           |         |    |
|           | step 10,  |           |           |         |    |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | Control   |           |           |         |    |
|           | Element?  |           |           |         |    |
|           | (Note 5)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | Check:    | \--\>     | MAC PDU   | 5       | P  |
|           | after     |           |           |         |    |
|           | *         |           |           |         |    |
|           | prohibitP |           |           |         |    |
|           | HR-Timer* |           |           |         |    |
|           | after     |           |           |         |    |
|           | step 10,  |           |           |         |    |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | Control   |           |           |         |    |
|           | Element?  |           |           |         |    |
|           | (Note 5)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 16        | Increase  | \-        | \-        | \-      | \- |
|           | SS power  |           |           |         |    |
|           | level for |           |           |         |    |
|           | NR Cell   |           |           |         |    |
|           | so as to  |           |           |         |    |
|           | cause a   |           |           |         |    |
|           | DL\       |           |           |         |    |
|           | _Pathloss |           |           |         |    |
|           | change at |           |           |         |    |
|           | UE by     |           |           |         |    |
|           | 5dB.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17        | Check:    | \--\>     | MAC PDU   | 4       | F  |
|           | for 80%   |           |           |         |    |
|           | of        |           |           |         |    |
|           | *         |           |           |         |    |
|           | prohibitP |           |           |         |    |
|           | HR-Timer* |           |           |         |    |
|           | since     |           |           |         |    |
|           | step 15,  |           |           |         |    |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | Control   |           |           |         |    |
|           | Element?  |           |           |         |    |
|           | (Note 5)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 18        | Check:    | \--\>     | MAC PDU   | 5       | P  |
|           | after     |           |           |         |    |
|           | *         |           |           |         |    |
|           | prohibitP |           |           |         |    |
|           | HR-Timer* |           |           |         |    |
|           | after     |           |           |         |    |
|           | step 15,  |           |           |         |    |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | Control   |           |           |         |    |
|           | Element?  |           |           |         |    |
|           | (Note 5)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19        | The SS    | \<\--     | *(RR      | \-      | \- |
|           | transmits |           | CReconfig |         |    |
|           | an NR     |           | uration)* |         |    |
|           | *R        |           |           |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | disable   |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | report    |           |           |         |    |
|           | ing.(Note |           |           |         |    |
|           | 1)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 20        | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an NR     |           | gurationC |         |    |
|           | *         |           | omplete)* |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | confirm   |           |           |         |    |
|           | the       |           |           |         |    |
|           | disabling |           |           |         |    |
|           | of Power  |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | paramet   |           |           |         |    |
|           | ers.(Note |           |           |         |    |
|           | 3)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *R        |           |           |           |         |    |
| RCReconfi |           |           |           |         |    |
| guration* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RR       |           |           |           |         |    |
| CConnecti |           |           |           |         |    |
| onReconfi |           |           |           |         |    |
| guration* |           |           |           |         |    |
| 36.508    |           |           |           |         |    |
| \[7\],    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 4.6.1-8   |           |           |           |         |    |
| using     |           |           |           |         |    |
| condition |           |           |           |         |    |
| EN-DC\_   |           |           |           |         |    |
| EmbedNR\_ |           |           |           |         |    |
| RRCRecon. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| Steps 3   |           |           |           |         |    |
| and 4 can |           |           |           |         |    |
| happen in |           |           |           |         |    |
| any       |           |           |           |         |    |
| order.    |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *         |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RR       |           |           |           |         |    |
| CConnecti |           |           |           |         |    |
| onReconfi |           |           |           |         |    |
| gurationC |           |           |           |         |    |
| omplete.* |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 4:   |           |           |           |         |    |
| Steps 10  |           |           |           |         |    |
| and 11    |           |           |           |         |    |
| can       |           |           |           |         |    |
| happen in |           |           |           |         |    |
| any       |           |           |           |         |    |
| order.    |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 5:   |           |           |           |         |    |
| For NR5GC |           |           |           |         |    |
| the       |           |           |           |         |    |
| received  |           |           |           |         |    |
| MAC PDU   |           |           |           |         |    |
| will      |           |           |           |         |    |
| contain   |           |           |           |         |    |
| Sin       |           |           |           |         |    |
| gle-entry |           |           |           |         |    |
| PHR MAC   |           |           |           |         |    |
| CE. For   |           |           |           |         |    |
| EN        |           |           |           |         |    |
| -DC/NE-DC |           |           |           |         |    |
| the       |           |           |           |         |    |
| received  |           |           |           |         |    |
| MAC PDU   |           |           |           |         |    |
| will      |           |           |           |         |    |
| contain   |           |           |           |         |    |
| Multi     |           |           |           |         |    |
| ple-Entry |           |           |           |         |    |
| PHR MAC   |           |           |           |         |    |
| CE.       |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.3.7.3.3 Specific message contents {#specific-message-contents-6 .H6}

Table 7.1.1.3.7.3.3-1: RRCReconfiguration (step 2 Table 7.1.1.3.7.3.2-1)

+-----------------+-----------------+-----------------+-----------+
| Derivation      |                 |                 |           |
| Path: 38.508-1  |                 |                 |           |
| \[4\], Table    |                 |                 |           |
| 4.6.1-13        |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| Information     | Value/remark    | Comment         | Condition |
| Element         |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| RRC             |                 |                 |           |
| Reconfiguration |                 |                 |           |
| ::= SEQUENCE {  |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| cri             |                 |                 |           |
| ticalExtensions |                 |                 |           |
| CHOICE {        |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| rrc             |                 |                 |           |
| Reconfiguration |                 |                 |           |
| SEQUENCE {      |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| sec             | CellGroupConfig | OCTET STRING    | EN-DC     |
| ondaryCellGroup |                 | (CONTAINING     |           |
|                 |                 | C               |           |
|                 |                 | ellGroupConfig) |           |
+-----------------+-----------------+-----------------+-----------+
| nonCr           |                 |                 | NR        |
| iticalExtension |                 |                 |           |
| SEQUENCE {      |                 |                 | NE-DC     |
+-----------------+-----------------+-----------------+-----------+
| masterCellGroup | CellGroupConfig | OCTET STRING    |           |
|                 |                 | (CONTAINING     |           |
|                 |                 | C               |           |
|                 |                 | ellGroupConfig) |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+

Table 7.1.1.3.7.3.3-2: CellGroupConfig (Table 7.1.1.3.7.3.3-1)

+------------------------------+--------------+---------+-----------+
| Derivation Path: 38.508-1    |              |         |           |
| \[4\], Table 4.6.3-19        |              |         |           |
+------------------------------+--------------+---------+-----------+
| Information Element          | Value/remark | Comment | Condition |
+------------------------------+--------------+---------+-----------+
| cellGroupConfig::= SEQUENCE  |              |         |           |
| {                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| mac-CellGroupConfig SEQUENCE |              |         |           |
| {                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| phr-Config CHOICE {          |              |         |           |
+------------------------------+--------------+---------+-----------+
| setup SEQUENCE {             |              |         |           |
+------------------------------+--------------+---------+-----------+
| phr-PeriodicTimer            | sf500        |         |           |
+------------------------------+--------------+---------+-----------+
| phr-ProhibitTimer            | sf1000       |         |           |
+------------------------------+--------------+---------+-----------+
| phr-Tx-PowerFactorChange     | infinity     |         |           |
+------------------------------+--------------+---------+-----------+
| multiplePHR                  | false        |         |           |
+------------------------------+--------------+---------+-----------+
| multiplePHR                  | true         |         | EN-DC     |
|                              |              |         |           |
|                              |              |         | NE-DC     |
+------------------------------+--------------+---------+-----------+
| phr-Type2PCell               | false        |         |           |
+------------------------------+--------------+---------+-----------+
| phr-Type2OtherCell           | false        |         |           |
+------------------------------+--------------+---------+-----------+
| phr-ModeOtherCG              | real         |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+

Table 7.1.1.3.7.3.3-3: RRCReconfiguration (step 6,19 Table
7.1.1.3.7.3.2-1)

+-----------------+-----------------+-----------------+-----------+
| Derivation      |                 |                 |           |
| Path: 38.508-1  |                 |                 |           |
| \[4\], Table    |                 |                 |           |
| 4.6.1-13        |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| Information     | Value/remark    | Comment         | Condition |
| Element         |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| RRC             |                 |                 |           |
| Reconfiguration |                 |                 |           |
| ::= SEQUENCE {  |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| cri             |                 |                 |           |
| ticalExtensions |                 |                 |           |
| CHOICE {        |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| rrc             |                 |                 |           |
| Reconfiguration |                 |                 |           |
| SEQUENCE {      |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| sec             | CellGroupConfig | OCTET STRING    | EN-DC     |
| ondaryCellGroup |                 | (CONTAINING     |           |
|                 |                 | C               |           |
|                 |                 | ellGroupConfig) |           |
+-----------------+-----------------+-----------------+-----------+
| nonCr           |                 |                 | NR        |
| iticalExtension |                 |                 |           |
| SEQUENCE {      |                 |                 | NE-DC     |
+-----------------+-----------------+-----------------+-----------+
| masterCellGroup | CellGroupConfig | OCTET STRING    |           |
|                 |                 | (CONTAINING     |           |
|                 |                 | C               |           |
|                 |                 | ellGroupConfig) |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+

Table 7.1.1.3.7.3.3-4: CellGroupConfig (Table 7.1.1.3.7.3.3-3)

  ------------------------------------------------- -------------- --------- -----------
  Derivation Path: 38.508-1 \[4\], Table 4.6.3-19                            
  Information Element                               Value/remark   Comment   Condition
  cellGroupConfig::= SEQUENCE {                                              
  mac-CellGroupConfig SEQUENCE {                                             
  phr-Config CHOICE {                                                        
  release                                           NULL                     
  }                                                                          
  }                                                                          
  }                                                                          
  ------------------------------------------------- -------------- --------- -----------

Table 7.1.1.3.7.3.3-5: RRCReconfiguration (step 9 Table 7.1.1.3.7.3.2-1)

+-----------------+-----------------+-----------------+-----------+
| Derivation      |                 |                 |           |
| Path: 38.508-1  |                 |                 |           |
| \[4\], Table    |                 |                 |           |
| 4.6.1-13        |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| Information     | Value/remark    | Comment         | Condition |
| Element         |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| RRC             |                 |                 |           |
| Reconfiguration |                 |                 |           |
| ::= SEQUENCE {  |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| cri             |                 |                 |           |
| ticalExtensions |                 |                 |           |
| CHOICE {        |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| rrc             |                 |                 |           |
| Reconfiguration |                 |                 |           |
| SEQUENCE {      |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| sec             | CellGroupConfig | OCTET STRING    | EN-DC     |
| ondaryCellGroup |                 | (CONTAINING     |           |
|                 |                 | C               |           |
|                 |                 | ellGroupConfig) |           |
+-----------------+-----------------+-----------------+-----------+
| nonCr           |                 |                 | NR        |
| iticalExtension |                 |                 |           |
| SEQUENCE {      |                 |                 | NE-DC     |
+-----------------+-----------------+-----------------+-----------+
| masterCellGroup | CellGroupConfig | OCTET STRING    |           |
|                 |                 | (CONTAINING     |           |
|                 |                 | C               |           |
|                 |                 | ellGroupConfig) |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+

Table 7.1.1.3.7.3.3-6: CellGroupConfig (Table 7.1.1.3.7.3.3-5)

+------------------------------+--------------+---------+-----------+
| Derivation Path: 38.508-1    |              |         |           |
| \[4\], Table 4.6.3-19        |              |         |           |
+------------------------------+--------------+---------+-----------+
| Information Element          | Value/remark | Comment | Condition |
+------------------------------+--------------+---------+-----------+
| cellGroupConfig::= SEQUENCE  |              |         |           |
| {                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| mac-CellGroupConfig SEQUENCE |              |         |           |
| {                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| phr-Config CHOICE {          |              |         |           |
+------------------------------+--------------+---------+-----------+
| setup SEQUENCE {             |              |         |           |
+------------------------------+--------------+---------+-----------+
| phr-PeriodicTimer            | infinity     |         |           |
+------------------------------+--------------+---------+-----------+
| phr-ProhibitTimer            | sf1000       |         |           |
+------------------------------+--------------+---------+-----------+
| phr-Tx-PowerFactorChange     | 3dB          |         |           |
+------------------------------+--------------+---------+-----------+
| multiplePHR                  | false        |         |           |
+------------------------------+--------------+---------+-----------+
| multiplePHR                  | true         |         | EN-DC     |
|                              |              |         |           |
|                              |              |         | NE-DC     |
+------------------------------+--------------+---------+-----------+
| phr-Type2PCell               | false        |         |           |
+------------------------------+--------------+---------+-----------+
| phr-Type2OtherCell           | false        |         |           |
+------------------------------+--------------+---------+-----------+
| phr-ModeOtherCG              | real         |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+

##### 7.1.1.3.8 UE power headroom reporting / SCell activation / DL pathloss change reporting

###### 7.1.1.3.8.1 UE power headroom reporting / SCell activation / DL pathloss change reporting/ Intra-band Contiguous CA

##### 7.1.1.3.8.1.1 Test Purpose (TP) {#test-purpose-tp-7 .H6}

##### (1) {#section-37 .H6}

**with** { UE in RRC\_Connected state with multiple Power headroom
reporting and an SCell with uplink is configured }

**ensure that** {

**when** { *UE receives an Activation MAC Control Element activating the
SCell* }

**then** { UE transmits a MAC PDU containing Power Headroom Report MAC
Control Element including PH type1 for SpCell and Scell }

}

##### (2) {#section-38 .H6}

**with** { UE in RRC\_Connected state with multiple Power headroom
reporting for phr-dl-PathlossChange configured }

**ensure that** {

**when** { *the DL Pathloss changes and phr-ProhibitTimer is running* }

**then** { UE does not transmit a MAC PDU containing Power Headroom
Report MAC Control Element including PH type1 for SpCell and Scell }

}

##### (3) {#section-39 .H6}

**with** { UE in RRC\_Connected state with Power headroom reporting for
phr-dl-PathlossChange configured }

**ensure that** {

**when** { phr-ProhibitTimer expires and power headroom report is
triggered due to DL Pathloss change }

**then** { UE transmits a MAC PDU containing Power Headroom Report MAC
Control Element including PH type1 for SpCell and Scell }

}

##### 7.1.1.3.8.1.2 Conformance requirements {#conformance-requirements-7 .H6}

References: The conformance requirements covered in the current TC are
specified in: TS 38.321 clause 5.4.6 and 6.1.3.8. Unless otherwise
stated these are Rel-15 requirements.

\[TS 38.321, clause 5.4.6\]

The Power Headroom reporting procedure is used to provide the serving
gNB with the following information:

\- Type 1 power headroom: the difference between the nominal UE maximum
transmit power and the estimated power for UL-SCH transmission per
activated Serving Cell;

\- Type 2 power headroom: the difference between the nominal UE maximum
transmit power and the estimated power for UL-SCH and PUCCH transmission
on SpCell of the other MAC entity (i.e. E-UTRA MAC entity in EN-DC,
NE-DC, and NGEN-DC cases);

\- Type 3 power headroom: the difference between the nominal UE maximum
transmit power and the estimated power for SRS transmission per
activated Serving Cell.

RRC controls Power Headroom reporting by configuring the following
parameters:

\- *phr-PeriodicTimer*;

\- *phr-ProhibitTimer*;

\- *phr-Tx-PowerFactorChange*;

\- *phr-Type2OtherCell*;

\- *phr-ModeOtherCG*;

\- *multiplePHR*.

A Power Headroom Report (PHR) shall be triggered if any of the following
events occur:

\- *phr-ProhibitTimer* expires or has expired and the path loss has
changed more than *phr-Tx-PowerFactorChange* dB for at least one
activated Serving Cell of any MAC entity which is used as a pathloss
reference since the last transmission of a PHR in this MAC entity when
the MAC entity has UL resources for new transmission;

NOTE 1: The path loss variation for one cell assessed above is between
the pathloss measured at present time on the current pathloss reference
and the pathloss measured at the transmission time of the last
transmission of PHR on the pathloss reference in use at that time,
irrespective of whether the pathloss reference has changed in between.

\- *phr-PeriodicTimer* expires;

\- upon configuration or reconfiguration of the power headroom reporting
functionality by upper layers, which is not used to disable the
function;

\- activation of an SCell of any MAC entity with configured uplink;

\- addition of the PSCell (i.e. PSCell is newly added or changed);

\- *phr-ProhibitTimer* expires or has expired, when the MAC entity has
UL resources for new transmission, and the following is true for any of
the activated Serving Cells of any MAC entity with configured uplink:

\- there are UL resources allocated for transmission or there is a PUCCH
transmission on this cell, and the required power backoff due to power
management (as allowed by P-MPR~c~ as specified in TS 38.101-1 \[14\],
TS 38.101-2 \[15\], and TS 38.101-3 \[16\]) for this cell has changed
more than *phr-Tx-PowerFactorChange* dB since the last transmission of a
PHR when the MAC entity had UL resources allocated for transmission or
PUCCH transmission on this cell.

NOTE 2: The MAC entity should avoid triggering a PHR when the required
power backoff due to power management decreases only temporarily (e.g.
for up to a few tens of milliseconds) and it should avoid reflecting
such temporary decrease in the values of P~CMAX,f,c~/PH when a PHR is
triggered by other triggering conditions.

If the MAC entity has UL resources allocated for a new transmission the
MAC entity shall:

1\> if it is the first UL resource allocated for a new transmission
since the last MAC reset:

2\> start *phr-PeriodicTimer*;

1\> if the Power Headroom reporting procedure determines that at least
one PHR has been triggered and not cancelled; and

1\> if the allocated UL resources can accommodate the MAC CE for PHR
which the MAC entity is configured to transmit, plus its subheader, as a
result of LCP as defined in clause 5.4.3.1:

2\> if *multiplePHR* with value *true* is configured:

3\> for each activated Serving Cell with configured uplink associated
with any MAC entity:

4\> obtain the value of the Type 1 or Type 3 power headroom for the
corresponding uplink carrier as specified in clause 7.7 of TS 38.213
\[6\] for NR Serving Cell and clause 5.1.1.2 of TS 36.213 \[17\] for
E-UTRA Serving Cell;

4\> if this MAC entity has UL resources allocated for transmission on
this Serving Cell; or

4\> if the other MAC entity, if configured, has UL resources allocated
for transmission on this Serving Cell and *phr-ModeOtherCG* is set to
*real* by upper layers:

5\> obtain the value for the corresponding P~CMAX,f,c~ field from the
physical layer.

3\> if *phr-Type2OtherCell* with value *true* is configured:

4\> if the other MAC entity is E-UTRA MAC entity:

5\> obtain the value of the Type 2 power headroom for the SpCell of the
other MAC entity (i.e. E-UTRA MAC entity);

5\> if *phr-ModeOtherCG* is set to *real* by upper layers:

6\> obtain the value for the corresponding P~CMAX,f,c~ field for the
SpCell of the other MAC entity (i.e. E-UTRA MAC entity) from the
physical layer.

3\> instruct the Multiplexing and Assembly procedure to generate and
transmit the Multiple Entry PHR MAC CE as defined in clause 6.1.3.9
based on the values reported by the physical layer.

2\> else (i.e. Single Entry PHR format is used):

3\> obtain the value of the Type 1 power headroom from the physical
layer for the corresponding uplink carrier of the PCell;

3\> obtain the value for the corresponding P~CMAX,f,c~ field from the
physical layer;

3\> instruct the Multiplexing and Assembly procedure to generate and
transmit the Single Entry PHR MAC CE as defined in clause 6.1.3.8 based
on the values reported by the physical layer.

2\> start or restart *phr-PeriodicTimer*;

2\> start or restart *phr-ProhibitTimer*;

2\> cancel all triggered PHR(s).

\[TS 38.321, clause 6.1.3.9\]

The Multiple Entry PHR MAC CE is identified by a MAC subheader with LCID
as specified in Table 6.2.1-2.

It has a variable size, and includes the bitmap, a Type 2 PH field and
an octet containing the associated P~CMAX,f,c~ field (if reported) for
SpCell of the other MAC entity, a Type 1 PH field and an octet
containing the associated P~CMAX,f,c~ field (if reported) for the PCell.
It further includes, in ascending order based on the *ServCellIndex*,
one or multiple of Type X PH fields and octets containing the associated
P~CMAX,f,c~ fields (if reported) for Serving Cells other than PCell
indicated in the bitmap. X is either 1 or 3 according to TS 38.213 \[6\]
and TS 36.213 \[17\].

The presence of Type 2 PH field for SpCell of the other MAC entity is
configured by *phr-Type2OtherCell* with value *true*.

A single octet bitmap is used for indicating the presence of PH per
Serving Cell when the highest *ServCellIndex* of Serving Cell with
configured uplink is less than 8, otherwise four octets are used.

The MAC entity determines whether PH value for an activated Serving Cell
is based on real transmission or a reference format by considering the
configured grant(s) and downlink control information which has been
received until and including the PDCCH occasion in which the first UL
grant for a new transmission that can accommodate the MAC CE for PHR as
a result of LCP as defined in clause 5.4.3.1 is received since a PHR has
been triggered if the PHR MAC CE is reported on an uplink grant received
on the PDCCH or until the first uplink symbol of PUSCH transmission
minus PUSCH preparation time as defined in clause 7.7 of TS 38.213 \[6\]
if the PHR MAC CE is reported on a configured grant.

For a band combination in which the UE does not support dynamic power
sharing, the UE may omit the octets containing Power Headroom field and
P~CMAX,f,c~ field for Serving Cells in the other MAC entity except for
the PCell in the other MAC entity and the reported values of Power
Headroom and P~CMAX,f,c~ for the PCell are up to UE implementation.

The PHR MAC CEs are defined as follows:

\- C~i~: This field indicates the presence of a PH field for the Serving
Cell with *ServCellIndex* i as specified in TS 38.331 \[5\]. The C~i~
field set to 1 indicates that a PH field for the Serving Cell with
*ServCellIndex* i is reported. The C~i~ field set to 0 indicates that a
PH field for the Serving Cell with *ServCellIndex* i is not reported;

\- R: Reserved bit, set to 0;

\- V: This field indicates if the PH value is based on a real
transmission or a reference format. For Type 1 PH, the V field set to 0
indicates real transmission on PUSCH and the V field set to 1 indicates
that a PUSCH reference format is used. For Type 2 PH, the V field set to
0 indicates real transmission on PUCCH and the V field set to 1
indicates that a PUCCH reference format is used. For Type 3 PH, the V
field set to 0 indicates real transmission on SRS and the V field set to
1 indicates that an SRS reference format is used. Furthermore, for Type
1, Type 2, and Type 3 PH, the V field set to 0 indicates the presence of
the octet containing the associated P~CMAX,f,c~ field, and the V field
set to 1 indicates that the octet containing the associated P~CMAX,f,c~
field is omitted;

\- Power Headroom (PH): This field indicates the power headroom level.
The length of the field is 6 bits. The reported PH and the corresponding
power headroom levels are shown in Table 6.1.3.8-1 (the corresponding
measured values in dB for the NR Serving Cell are specified in TS 38.133
\[11\] while the corresponding measured values in dB for the E-UTRA
Serving Cell are specified in TS 36.133 \[12\]);

\- P: This field indicates whether the MAC entity applies power backoff
due to power management (as allowed by P-MPR~c~ as specified in TS
38.101-1 \[14\], TS 38.101-2 \[15\], and TS 38.101-3 \[16\]). The MAC
entity shall set the P field to 1 if the corresponding P~CMAX,f,c~ field
would have had a different value if no power backoff due to power
management had been applied;

\- P~CMAX,f,c~: If present, this field indicates the P~CMAX,f,c~ (as
specified in TS 38.213 \[6\]) for the NR Serving Cell and the P~CMAX,c~
or PÌ~CMAX,c~ (as specified in TS 36.213 \[17\]) for the E-UTRA Serving
Cell used for calculation of the preceding PH field. The reported
P~CMAX,f,c~ and the corresponding nominal UE transmit power levels are
shown in Table 6.1.3.8-2 (the corresponding measured values in dBm for
the NR Serving Cell are specified in TS 38.133 \[11\] while the
corresponding measured values in dBm for the E-UTRA Serving Cell are
specified in TS 36.133 \[12\]).

Figure 6.1.3.9-1: Multiple Entry PHR MAC CE with the highest
*ServCellIndex* of Serving Cell with configured uplink is less than 8

##### 7.1.1.3.8.1.3 Test description {#test-description-7 .H6}

##### 7.1.1.3.8.1.3.1 Pre-test conditions {#pre-test-conditions-7 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that Test loop
function(*Off*) System information combination NR-4 and in addition NR
Cell 3 is configured as NR Active Scell.

##### 7.1.1.3.8.1.3.2 Test procedure sequence {#test-procedure-sequence-7 .H6}

Table 7.1.1.3.8.1.3.2-0: Cell configuration power level changes over
time for conducted test environment

+--------+-----------+---------+-----------+-----------+---------+
|        | Parameter | Unit    | NR Cell 1 | NR Cell 3 | Remarks |
+========+===========+=========+===========+===========+=========+
| **T0** | SS/PBCH   | dBm/SCS | -88       | -88       |         |
|        |           |         |           |           |         |
|        | SSS EPRE  |         |           |           |         |
+--------+-----------+---------+-----------+-----------+---------+
| **T1** | SS/PBCH   | dBm/SCS | -99       | -88       |         |
|        |           |         |           |           |         |
|        | SSS EPRE  |         |           |           |         |
+--------+-----------+---------+-----------+-----------+---------+
| **T2** | SS/PBCH   | dBm/SCS | -88       | -88       |         |
|        |           |         |           |           |         |
|        | SSS EPRE  |         |           |           |         |
+--------+-----------+---------+-----------+-----------+---------+
| **T3** | SS/PBCH   | dBm/SCS | -88       | -99       |         |
|        |           |         |           |           |         |
|        | SSS EPRE  |         |           |           |         |
+--------+-----------+---------+-----------+-----------+---------+
| **T4** | SS/PBCH   | dBm/SCS | -88       | -88       |         |
|        |           |         |           |           |         |
|        | SSS EPRE  |         |           |           |         |
+--------+-----------+---------+-----------+-----------+---------+

Table 7.1.1.3.8.1.3.2-0A: Cell configuration power level changes over
time for OTA test environment

+--------+-----------+---------+-----------+-----------+---------+
|        | Parameter | Unit    | NR Cell 1 | NR Cell 3 | Remarks |
+========+===========+=========+===========+===========+=========+
| **T0** | SS/PBCH   | dBm/SCS | -82       | -82       |         |
|        |           |         |           |           |         |
|        | SSS EPRE  |         |           |           |         |
+--------+-----------+---------+-----------+-----------+---------+
| **T1** | SS/PBCH   | dBm/SCS | -91       | -82       |         |
|        |           |         |           |           |         |
|        | SSS EPRE  |         |           |           |         |
+--------+-----------+---------+-----------+-----------+---------+
| **T2** | SS/PBCH   | dBm/SCS | -82       | -82       |         |
|        |           |         |           |           |         |
|        | SSS EPRE  |         |           |           |         |
+--------+-----------+---------+-----------+-----------+---------+
| **T3** | SS/PBCH   | dBm/SCS | -82       | -91       |         |
|        |           |         |           |           |         |
|        | SSS EPRE  |         |           |           |         |
+--------+-----------+---------+-----------+-----------+---------+
| **T4** | SS/PBCH   | dBm/SCS | -82       | -82       |         |
|        |           |         |           |           |         |
|        | SSS EPRE  |         |           |           |         |
+--------+-----------+---------+-----------+-----------+---------+

Table 7.1.1.3.8.1.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | SS        | \<\--     | (R        | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an        |           | guration) |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | *         |           |           |         |    |
|           | configure |           |           |         |    |
|           | SCell (NR |           |           |         |    |
|           | Cell 3).  |           |           |         |    |
|           | Note 1*   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | RRCRecon  |           | gurationC |         |    |
|           | figuratio |           | omplete)* |         |    |
|           | nComplete |           |           |         |    |
|           | message.  |           |           |         |    |
|           | *Note 2*  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS is | \-        | \-        | \-      | \- |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | for       |           |           |         |    |
|           | Uplink    |           |           |         |    |
|           | Grant     |           |           |         |    |
|           | A         |           |           |         |    |
|           | llocation |           |           |         |    |
|           | Type 2.   |           |           |         |    |
|           | SS is     |           |           |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | to        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | UL grant  |           |           |         |    |
|           | for UE at |           |           |         |    |
|           | every 10  |           |           |         |    |
|           | ms.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | SS        | \<\--     | (R        | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an        |           | guration) |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | provide   |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | pa        |           |           |         |    |
|           | rameters. |           |           |         |    |
|           | *Note 1*  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
|           | E         | \-        | *-*       | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | In        |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | with step |           |           |         |    |
|           | 5, UE     |           |           |         |    |
|           | executes  |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | behaviour |           |           |         |    |
|           | defined   |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.3.  |           |           |         |    |
|           | 8.1.3.2-2 |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | RRCRecon  |           | gurationC |         |    |
|           | figuratio |           | omplete)* |         |    |
|           | nComplete |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | confirm   |           |           |         |    |
|           | the setup |           |           |         |    |
|           | of Power  |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | pa        |           |           |         |    |
|           | rameters. |           |           |         |    |
|           | Note 2    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (SCell    |         |    |
|           | an        |           | Activ     |         |    |
|           | A         |           | ation/Dea |         |    |
|           | ctivation |           | ctivation |         |    |
|           | MAC       |           | MAC CE of |         |    |
|           | control   |           | one octet |         |    |
|           | element   |           | (C~1~=1)) |         |    |
|           | to        |           |           |         |    |
|           | activate  |           |           |         |    |
|           | SCell.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Multiple  |           |           |         |    |
|           | Entry PHR |           |           |         |    |
|           | MAC CE    |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Type 1 PH |           |           |         |    |
|           | of NR     |           |           |         |    |
|           | SpCell    |           |           |         |    |
|           | and       |           |           |         |    |
|           | Scell?    |           |           |         |    |
|           | Note 3    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | Void      | \-        | \-        | \-      | \- |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | SS        | \-        | \-        | \-      | \- |
|           | adjusts   |           |           |         |    |
|           | cell      |           |           |         |    |
|           | levels    |           |           |         |    |
|           | according |           |           |         |    |
|           | to row T1 |           |           |         |    |
|           | of Table  |           |           |         |    |
|           | 7.1       |           |           |         |    |
|           | .1.3.8.3. |           |           |         |    |
|           | 1.2-0/0A. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | Check:    | \--\>     | MAC PDU   | 2       | F  |
|           | For 80%   |           |           |         |    |
|           | of        |           |           |         |    |
|           | *         |           |           |         |    |
|           | prohibitP |           |           |         |    |
|           | HR-Timer* |           |           |         |    |
|           | since     |           |           |         |    |
|           | step 7,   |           |           |         |    |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Multiple  |           |           |         |    |
|           | Entry PHR |           |           |         |    |
|           | MAC CE?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | Check:    | \--\>     | MAC PDU   | 3       | P  |
|           | After     |           |           |         |    |
|           | *         |           |           |         |    |
|           | prohibitP |           |           |         |    |
|           | HR-Timer* |           |           |         |    |
|           | after     |           |           |         |    |
|           | step 7,   |           |           |         |    |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Multiple  |           |           |         |    |
|           | Entry PHR |           |           |         |    |
|           | MAC CE    |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Type 1 PH |           |           |         |    |
|           | of NR     |           |           |         |    |
|           | SpCell    |           |           |         |    |
|           | and       |           |           |         |    |
|           | Scell?    |           |           |         |    |
|           | Note 3    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | SS        | \-        | \-        | \-      | \- |
|           | adjusts   |           |           |         |    |
|           | cell      |           |           |         |    |
|           | levels    |           |           |         |    |
|           | according |           |           |         |    |
|           | to row T2 |           |           |         |    |
|           | of Table  |           |           |         |    |
|           | 7.1       |           |           |         |    |
|           | .1.3.8.1. |           |           |         |    |
|           | 3.2-0/0A. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | Check:    | \--\>     | MAC PDU   | 2       | F  |
|           | For 80%   |           |           |         |    |
|           | of        |           |           |         |    |
|           | *         |           |           |         |    |
|           | prohibitP |           |           |         |    |
|           | HR-Timer* |           |           |         |    |
|           | since     |           |           |         |    |
|           | step 11,  |           |           |         |    |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Multiple  |           |           |         |    |
|           | Entry PHR |           |           |         |    |
|           | MAC CE ?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | Check:    | \--\>     | MAC PDU   | 3       | P  |
|           | After     |           |           |         |    |
|           | *         |           |           |         |    |
|           | prohibitP |           |           |         |    |
|           | HR-Timer* |           |           |         |    |
|           | after     |           |           |         |    |
|           | step 11,  |           |           |         |    |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Multiple  |           |           |         |    |
|           | Entry PHR |           |           |         |    |
|           | MAC CE    |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Type 1PH  |           |           |         |    |
|           | of NR     |           |           |         |    |
|           | SpCell    |           |           |         |    |
|           | and       |           |           |         |    |
|           | Scell?    |           |           |         |    |
|           | Note 3    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | SS        | \-        | \-        | \-      | \- |
|           | adjusts   |           |           |         |    |
|           | cell      |           |           |         |    |
|           | levels    |           |           |         |    |
|           | according |           |           |         |    |
|           | to row T3 |           |           |         |    |
|           | of Table  |           |           |         |    |
|           | 7.1       |           |           |         |    |
|           | .1.3.8.1. |           |           |         |    |
|           | 3.2-0/0A. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 16        | Check:    | \--\>     | MAC PDU   | 2       | F  |
|           | For 80%   |           |           |         |    |
|           | of        |           |           |         |    |
|           | *         |           |           |         |    |
|           | prohibitP |           |           |         |    |
|           | HR-Timer* |           |           |         |    |
|           | since     |           |           |         |    |
|           | step 14,  |           |           |         |    |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Multiple  |           |           |         |    |
|           | Entry PHR |           |           |         |    |
|           | MAC CE    |           |           |         |    |
|           | co        |           |           |         |    |
|           | ntaining? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17        | Check:    | \--\>     | MAC PDU   | 3       | P  |
|           | After     |           |           |         |    |
|           | *         |           |           |         |    |
|           | prohibitP |           |           |         |    |
|           | HR-Timer* |           |           |         |    |
|           | after     |           |           |         |    |
|           | step 14,  |           |           |         |    |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Multiple  |           |           |         |    |
|           | Entry PHR |           |           |         |    |
|           | MAC CE    |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Type 1 PH |           |           |         |    |
|           | of NR     |           |           |         |    |
|           | SpCell    |           |           |         |    |
|           | and       |           |           |         |    |
|           | Scell?    |           |           |         |    |
|           | Note 3    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 18        | SS        | \-        | \-        | \-      | \- |
|           | adjusts   |           |           |         |    |
|           | cell      |           |           |         |    |
|           | levels    |           |           |         |    |
|           | according |           |           |         |    |
|           | to row T4 |           |           |         |    |
|           | of Table  |           |           |         |    |
|           | 7.1       |           |           |         |    |
|           | .1.3.8.1. |           |           |         |    |
|           | 3.2-0/0A. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19        | Check:    | \--\>     | MAC PDU   | 2       | F  |
|           | For 80%   |           |           |         |    |
|           | of        |           |           |         |    |
|           | *         |           |           |         |    |
|           | prohibitP |           |           |         |    |
|           | HR-Timer* |           |           |         |    |
|           | since     |           |           |         |    |
|           | step 17,  |           |           |         |    |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Multiple  |           |           |         |    |
|           | Entry PHR |           |           |         |    |
|           | MAC CE?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 20        | Check:    | \--\>     | MAC PDU   | 3       | P  |
|           | After     |           |           |         |    |
|           | *         |           |           |         |    |
|           | prohibitP |           |           |         |    |
|           | HR-Timer* |           |           |         |    |
|           | after     |           |           |         |    |
|           | step 17,  |           |           |         |    |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Multiple  |           |           |         |    |
|           | Entry PHR |           |           |         |    |
|           | MAC CE    |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Type 1 PH |           |           |         |    |
|           | of NR     |           |           |         |    |
|           | SpCell    |           |           |         |    |
|           | and       |           |           |         |    |
|           | Scell?    |           |           |         |    |
|           | Note 3    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 21        | The SS    | \<\--     | *(RR      | \-      | \- |
|           | transmits |           | CReconfig |         |    |
|           | an NR     |           | uration)* |         |    |
|           | *R        |           |           |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | disable   |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | report    |           |           |         |    |
|           | ing.(Note |           |           |         |    |
|           | 1)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 22        | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an NR     |           | gurationC |         |    |
|           | *         |           | omplete)* |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | confirm   |           |           |         |    |
|           | the       |           |           |         |    |
|           | disabling |           |           |         |    |
|           | of Power  |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | paramet   |           |           |         |    |
|           | ers.(Note |           |           |         |    |
|           | 3)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *R        |           |           |           |         |    |
| RCReconfi |           |           |           |         |    |
| guration* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RRC      |           |           |           |         |    |
| Connectio |           |           |           |         |    |
| nReconfig |           |           |           |         |    |
| uration.* |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *         |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RR       |           |           |           |         |    |
| CConnecti |           |           |           |         |    |
| onReconfi |           |           |           |         |    |
| gurationC |           |           |           |         |    |
| omplete.* |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the Type  |           |           |           |         |    |
| 1 PHR     |           |           |           |         |    |
| report    |           |           |           |         |    |
| for EUTRA |           |           |           |         |    |
| Pcell is  |           |           |           |         |    |
| also      |           |           |           |         |    |
| included. |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

Table 7.1.1.3.8.1.3.2-2: Parallel behaviour

  St   Procedure                                                                                            Message Sequence   TP        Verdict   
  ---- ---------------------------------------------------------------------------------------------------- ------------------ --------- --------- ----
                                                                                                            U - S              Message             
  1    The UE transmits a MAC PDU containing Multiple Entry PHR MAC CE containing Type 1 PH of NR SpCell.   \--\>              MAC PDU   \-        \-

##### 7.1.1.3.8.1.3.3 Specific message contents {#specific-message-contents-7 .H6}

Table 7.1.1.3.8.1.3.3-1: *RRCReconfiguration* (step 1, Table
7.1.1.3.8.1.3.2-1)

  ----------------------------------------------------- ----------------- ------------------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13.                                                                 
  Information Element                                   Value/remark      Comment                                     Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                   
  criticalExtensions CHOICE {                                                                                         
  rrcReconfiguration SEQUENCE {                                                                                       
  secondaryCellGroup                                    CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   EN-DC
  nonCriticalExtension SEQUENCE {                                                                                     NR
  masterCellGroup                                       CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   
  }                                                                                                                   
  }                                                                                                                   
  }                                                                                                                   
  }                                                                                                                   
  ----------------------------------------------------- ----------------- ------------------------------------------- -----------

Table 7.1.1.3.8.1.3.3-2: CellGroupConfig (Table 7.1.1.3.8.1.3.3-1)

  ------------------------------------------------------------------- ------------------------------------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19.                                                                                   
  Information Element                                                 Value/remark                                            Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                                                                        
  sCellToAddModList SEQUENCE (SIZE (1..maxMeasId)) OF SCellConfig {   1 entry                                                           
  SCellConfig\[1\] SEQUENCE {                                                                                                 entry 1   
  sCellIndex                                                          *SCellIndex as per* TS 38.508-1 \[4\] table 4.6.3-154             
  sCellConfigCommon                                                   ServingCellConfigCommon                                           
  sCellConfigDedicated                                                ServingCellConfig                                                 
  }                                                                                                                                     
  }                                                                                                                                     
  }                                                                                                                                     
  ------------------------------------------------------------------- ------------------------------------------------------- --------- -----------

Table 7.1.1.3.8.1.3.3-3: Void

Table 7.1.1.3.8.1.3.3-3A: Void

Table 7.1.1.3.8.1.3.3-4: *RRCReconfiguration* ( Step 4, Table
7.1.1.3.8.1.3.2-1)

  ---------------------------------------------------- ----------------- ------------------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                                                                 
  Information Element                                  Value/remark      Comment                                     Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                  
  criticalExtensions CHOICE {                                                                                        
  rrcReconfiguration SEQUENCE {                                                                                      
  secondaryCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   EN-DC
  nonCriticalExtension SEQUENCE {                                                                                    NR
  masterCellGroup                                      CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  ---------------------------------------------------- ----------------- ------------------------------------------- -----------

Table 7.1.1.3.8.1.3.3-5: CellGroupConfig (Table 7.1.1.3.8.1.3.3-4)

  ---------------------------------------------------- ------------------------------------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19                                                                     
  Information Element                                  Value/remark                                            Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                                                         
  cellGroupId                                          CellGroupId *as per* TS 38.508-1 \[4\] table 4.6.3-20             
  mac-CellGroupConfig SEQUENCE {                                                                                         
  phr-Config CHOICE {                                                                                                    
  setup SEQUENCE {                                                                                                       
  phr-PeriodicTimer                                    infinity                                                          
  phr-ProhibitTimer                                    sf1000                                                            
  phr-Tx-PowerFactorChange                             3db                                                               
  multiplePHR                                          true                                                              
  dummy                                                true                                                              
  phr-Type2OtherCell                                   false                                                             
  phr-ModeOtherCG                                      real                                                              
  }                                                                                                                      
  }                                                                                                                      
  }                                                                                                                      
  }                                                                                                                      
  ---------------------------------------------------- ------------------------------------------------------- --------- -----------

Table 7.1.1.3.8.1.3.3-6: ServingCellConfig (Table 7.1.1.3.8.1.3.3-2)

  ------------------------------------------------------ --------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167.                                   
  Information Element                                    Value/remark          Comment   Condition
  ServingCellConfig ::= SEQUENCE {                                                       
  uplinkConfig SEQUENCE {                                                                
  initialUplinkBWP                                       BWP-UplinkDedicated             
  }                                                                                      
  }                                                                                      
  ------------------------------------------------------ --------------------- --------- -----------

Table 7.1.1.3.8.1.3.3-7: *BWP-UplinkDedicated* (Table 7.1.1.3.8.1.3.3-6)

  ---------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-15                            
  Information Element                                  Value/remark   Comment   Condition
  BWP-UplinkDedicated ::= SEQUENCE {                                            
  pucch-Config                                         Not present              
  }                                                                             
  ---------------------------------------------------- -------------- --------- -----------

Table 7.1.1.3.8.1.3.3-8: ServingCellConfigCommon (Table
7.1.1.3.8.1.3.3-2)

  ------------------------------------------------------ ------------------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168.                                                   
  Information Element                                    Value/remark                          Comment   Condition
  ServingCellConfigCommon ::= SEQUENCE {                                                                 
  physCellId                                             Physical Cell Identity of NR Cell 3             
  uplinkConfigCommon                                     UplinkConfigCommon                              
  }                                                                                                      
  ------------------------------------------------------ ------------------------------------- --------- -----------

Table 7.1.1.3.8.1.3.3-9: UplinkConfigCommon (Table 7.1.1.3.8.1.3.3-8)

  ------------------------------------------------ ------------------ --------- -----------
  Derivation Path: TS 38.331 \[6\], clause 6.3.2                                
  Information Element                              Value/remark       Comment   Condition
  UplinkConfigCommon ::= SEQUENCE {                                             
  initialUplinkBWP                                 BWP-UplinkCommon             
  }                                                                             
  ------------------------------------------------ ------------------ --------- -----------

Table 7.1.1.3.8.1.3.3-10: BWP-UplinkCommon (Table 7.1.1.3.8.1.3.3-9)

  ------------------------------------------------ -------------- --------- -----------
  Derivation Path: TS 38.331 \[6\], clause 6.3.2                            
  Information Element                              Value/remark   Comment   Condition
  BWP-UplinkCommon ::= SEQUENCE {                                           
  pucch-ConfigCommon                               Not present              
  }                                                                         
  ------------------------------------------------ -------------- --------- -----------

###### 7.1.1.3.8.2 UE power headroom reporting / SCell activation / DL pathloss change reporting / Inter-band CA

The scope and description of the present TC is the same as test case
7.1.1.3.8.1 with the following differences:

\- CA configuration: Inter-band CA replaces Intra-band Contiguous CA

\- Cells configuration: NR Cell 10 replaces NR Cell 3

###### 7.1.1.3.8.3 UE power headroom reporting / SCell activation / DL pathloss change reporting / Intra-band non-Contiguous CA

The scope and description of the present TC is the same as test case
7.1.1.3.8.1 with the following differences:

\- CA configuration: Intra-band non-Contiguous CA replaces Intra-band
Contiguous CA.

##### 7.1.1.3.9 Correct Handling of UL HARQ process / PUSCH Repetition Type A / PUSCH Aggregation

##### 7.1.1.3.9.1 Test Purpose (TP) {#test-purpose-tp-8 .H6}

##### (1) {#section-40 .H6}

**with** { UE in RRC\_CONNECTED state and PUSCH Aggregation \> 1 }

**ensure that** {

**when** { UE receives an UL Grant with toggled NDI and has data
available for transmission }

**then** { UE transmits a new MAC PDU and repeats the MAC PDU
*pusch-AggregationFactor*-1 times after first transmission and selects
the redundancy version correctly }

}

##### 7.1.1.3.9.2 Conformance requirements {#conformance-requirements-8 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.214 clauses 6.1.2.1 and 6.1.4, TS 38.321 clauses
5.4.1, 5.4.2.1 and 5.4.2.2. Unless otherwise stated these are Rel-15
requirements.

\[TS 38.214, clause 6.1.2.1\]

When the UE is scheduled to transmit a transport block and no CSI
report, or the UE is scheduled to transmit a transport block and a CSI
report on PUSCH by a DCI, the *Time domain resource assignment* field
value *m* of the DCI provides a row index *m* + 1 to an allocated table.
The determination of the used resource allocation table is defined in
sub-clause 6.1.2.1.1. The indexed row defines the slot offset *K~2~*,
the start and length indicator *SLIV*, or directly the start symbol *S*
and the allocation length *L*, and the PUSCH mapping type to be applied
in the PUSCH transmission.

When the UE is scheduled to transmit a PUSCH with no transport block and
with a CSI report by a *CSI request* field on a DCI, the *Time-domain
resource assignment* field value *m* of the DCI provides a row index *m*
+ 1 to an allocated table. The determination of the applied resource
allocation table is defined in sub-clause 6.1.2.1.1. The indexed row
defines the start and length indicator SLIV, or directly the start
symbol *S* and the allocation length *L*, and the PUSCH mapping type to
be applied in the PUSCH transmission and *K~2~* is determined based on
the corresponding list entries ![](./media/image10.wmf)of the higher
layer parameter *reportSlotConfig* in *CSI-ReportConfig* for the
![](./media/image11.wmf)triggered CSI Reporting Settings. The *i*th
codepoint of *K~2~* s determined as ![](./media/image12.wmf) where
![](./media/image13.wmf) is the *i*th codepoint of
![](./media/image14.wmf).

\- The slot where the UE shall transmit the PUSCH is determined by
*K~2~* as ![](./media/image15.wmf) where *n* is the slot with the
scheduling DCI, K*~2~* is based on the numerology of PUSCH, and
![](./media/image16.wmf) and ![](./media/image17.wmf) are the subcarrier
spacing configurations for PUSCH and PDCCH, respectively, and

\- The starting symbol *S* relative to the start of the slot, and the
number of consecutive symbols *L* counting from the symbol *S* allocated
for the PUSCH are determined from the start and length indicator *SLIV*
of the indexed row:

> if ![](./media/image18.wmf) then
>
> ![](./media/image19.wmf)
>
> else
>
> ![](./media/image20.wmf)
>
> where![](./media/image21.wmf), and

\- The PUSCH mapping type is set to Type A or Type B as defined in
Subclause 6.4.1.1.3 of \[4, TS 38.211\] as given by the indexed row.

The UE shall consider the *S* and *L* combinations defined in table
6.1.2.1-1 as valid PUSCH allocations

Table 6.1.2.1-1: Valid *S* and *L* combinations

  **PUSCH mapping type**   **Normal cyclic prefix**   **Extended cyclic prefix**                                          
  ------------------------ -------------------------- ---------------------------- ------------ ------------ ------------ ------------
                           ***S***                    ***L***                      ***S+L***    ***S***      ***L***      ***S+L***
  Type A                   0                          {4,...,14}                   {4,...,14}   0            {4,...,12}   {4,...,12}
  Type B                   {0,...,13}                 {1,...,14}                   {1,...,14}   {0,...,12}   {1,...,12}   {1,...,12}

When the UE is configured with *aggregationFactorUL* \> 1, the same
symbol allocation is applied across the *aggregationFactorUL*
consecutive slots and the PUSCH is limited to a single transmission
layer. The UE shall repeat the TB across the *aggregationFactorUL*
consecutive slots applying the same symbol allocation in each slot. The
redundancy version to be applied on the *n*^th^ transmission occasion of
the TB is determined according to table 6.1.2.1-2.

Table 6.1.2.1-2: Redundancy version when *aggregationFactorUL* \> 1

  *rv~id\ ~*indicated by the DCI scheduling the PUSCH   *rv~id~* to be applied to *n*^th^ transmission occasion                                   
  ----------------------------------------------------- --------------------------------------------------------- --------------- --------------- ---------------
                                                        *n* mod 4 = 0                                             *n* mod 4 = 1   *n* mod 4 = 2   *n* mod 4 = 3
  0                                                     0                                                         2               3               1
  2                                                     2                                                         3               1               0
  3                                                     3                                                         1               0               2
  1                                                     1                                                         0               2               3

If the UE procedure for determining slot configuration, as defined in
subclause 11.1 of \[6, TS 38.213\], determines symbols of a slot
allocated for PUSCH as downlink symbols, the transmission on that slot
is omitted for multi-slot PUSCH transmission.

\[TS 38.214, clause 6.1.4\]

To determine the modulation order, target code rate, redundancy version
and transport block size for the physical uplink shared channel, the UE
shall first

\- read the 5-bit modulation and coding scheme field
![](./media/image22.wmf)in the DCI to determine the modulation order
![](./media/image23.wmf) and target code rate (*R*) based on the
procedure defined in Subclause 6.1.4.1

\- read redundancy version field (*rv*) in the DCI to determine the
redundancy version, and

\- \[check the \"CSI request\" bit field\]

and second

\- the UE shall use the number of layers ![](./media/image24.wmf), the
total number of allocated PRBs ![](./media/image25.wmf) to determine the
transport block size based on the procedure defined in Subclause
6.1.4.2.

\[TS 38.321, clause 5.4.1\]

Uplink grant is either received dynamically on the PDCCH, in a Random
Access Response, or configured semi-persistently by RRC. The MAC entity
shall have an uplink grant to transmit on the UL-SCH. To perform the
requested transmissions, the MAC layer receives HARQ information from
lower layers.

If the MAC entity has a C-RNTI, a Temporary C-RNTI, or CS-RNTI, the MAC
entity shall for each PDCCH occasion and for each Serving Cell belonging
to a TAG that has a running *timeAlignmentTimer* and for each grant
received for this PDCCH occasion:

1\> if an uplink grant for this Serving Cell has been received on the
PDCCH for the MAC entity\'s C-RNTI or Temporary C-RNTI; or

1\> if an uplink grant has been received in a Random Access Response:

2\> if the uplink grant is for MAC entity\'s C-RNTI and if the previous
uplink grant delivered to the HARQ entity for the same HARQ process was
either an uplink grant received for the MAC entity\'s CS-RNTI or a
configured uplink grant:

3\> consider the NDI to have been toggled for the corresponding HARQ
process regardless of the value of the NDI.

2\> if the uplink grant is for MAC entity\'s C-RNTI, and the identified
HARQ process is configured for a configured uplink grant:

3\> start or restart the *configuredGrantTimer* for the correponding
HARQ process, if configured.

2\> deliver the uplink grant and the associated HARQ information to the
HARQ entity.

1\> else if an uplink grant for this PDCCH occasion has been received
for this Serving Cell on the PDCCH for the MAC entity\'s CS-RNTI:

2\> if the NDI in the received HARQ information is 1:

3\> consider the NDI for the corresponding HARQ process not to have been
toggled;

3\> start or restart the *configuredGrantTimer* for the corresponding
HARQ process, if configured;

3\> deliver the uplink grant and the associated HARQ information to the
HARQ entity.

2\> else if the NDI in the received HARQ information is 0:

3\> if PDCCH contents indicate configured grant Type 2 deactivation:

4\> trigger configured uplink grant confirmation.

3\> else if PDCCH contents indicate configured grant Type 2 activation:

4\> trigger configured uplink grant confirmation;

4\> store the uplink grant for this Serving Cell and the associated HARQ
information as configured uplink grant;

4\> initialise or re-initialise the configured uplink grant for this
Serving Cell to start in the associated PUSCH duration and to recur
according to rules in subclause 5.8.2;

4\> set the HARQ Process ID to the HARQ Process ID associated with this
PUSCH duration;

4\> consider the NDI bit for the corresponding HARQ process to have been
toggled;

4\> stop the *configuredGrantTimer* for the corresponding HARQ process,
if running;

4\> deliver the configured uplink grant and the associated HARQ
information to the HARQ entity.

For each Serving Cell and each configured uplink grant, if configured
and activated, the MAC entity shall:

1\> if the PUSCH duration of the configured uplink grant does not
overlap with the PUSCH duration of an uplink grant received on the PDCCH
for this Serving Cell:

2\> set the HARQ Process ID to the HARQ Process ID associated with this
PUSCH duration;

2\> if the *configuredGrantTimer* for the corresponding HARQ process is
not running:

3\> consider the NDI bit for the corresponding HARQ process to have been
toggled;

3\> deliver the configured uplink grant and the associated HARQ
information to the HARQ entity.

For configured uplink grants, the HARQ Process ID associated with the
first symbol of a UL transmission is derived from the following
equation:

HARQ Process ID = \[floor(CURRENT\_symbol/*periodicity*)\] modulo
*nrofHARQ-Processes*

where CURRENT\_symbol=(SFN Ã *numberOfSlotsPerFrame* Ã
*numberOfSymbolsPerSlot* + slot number in the frame Ã
*numberOfSymbolsPerSlot* + symbol number in the slot), and
*numberOfSlotsPerFrame* and *numberOfSymbolsPerSlot* refer to the number
of consecutive slots per frame and the number of consecutive symbols per
slot, respectively as specified in TS 38.211 \[8\].

NOTE 1: CURRENT\_symbol refers to the symbol index of the first
transmission occasion of a repetition bundle that takes place.

NOTE 2: A HARQ process is configured for a configured uplink grant if
the configured uplink grant is activated and the associated HARQ process
ID is less than *nrofHARQ-Processes*.

\[TS 38.321, clause 5.4.2.1\]

The MAC entity includes a HARQ entity for each Serving Cell with
configured uplink (including the case when it is configured with
*supplementaryUplink*), which maintains a number of parallel HARQ
processes.

The number of parallel UL HARQ processes per HARQ entity is specified in
TS 38.214 \[7\].

Each HARQ process supports one TB.

Each HARQ process is associated with a HARQ process identifier. For UL
transmission with UL grant in RA Response, HARQ process identifier 0 is
used.

When the MAC entity is configured with *pusch-AggregationFactor* \> 1,
the parameter *pusch-AggregationFactor* provides the number of
transmissions of a TB within a bundle of the dynamic grant. After the
initial transmission, *pusch-AggregationFactor* -- 1 HARQ
retransmissions follow within a bundle. When the MAC entity is
configured with *repK* \> 1, the parameter *repK* provides the number of
transmissions of a TB within a bundle of the configured uplink grant.
After the initial transmission, HARQ retransmissions follow within a
bundle. For both dynamic grant and configured uplink grant, bundling
operation relies on the HARQ entity for invoking the same HARQ process
for each transmission that is part of the same bundle. Within a bundle,
HARQ retransmissions are triggered without waiting for feedback from
previous transmission according to *pusch-AggregationFactor* for a
dynamic grant and *repK* for a configured uplink grant, respectively.
Each transmission within a bundle is a separate uplink grant after the
initial uplink grant within a bundle is delivered to the HARQ entity.

For each transmission within a bundle of the dynamic grant, the sequence
of redundancy versions is determined according to subclause 6.1.4 of TS
38.214 \[7\]. For each transmission within a bundle of the configured
uplink grant, the sequence of redundancy versions is determined
according to subclause 6.1.2.3 of TS 38.214 \[7\].

For each uplink grant, the HARQ entity shall:

1\> identify the HARQ process associated with this grant, and for each
identified HARQ process:

2\> if the received grant was not addressed to a Temporary C-RNTI on
PDCCH, and the NDI provided in the associated HARQ information has been
toggled compared to the value in the previous transmission of this TB of
this HARQ process; or

2\> if the uplink grant was received on PDCCH for the C-RNTI and the
HARQ buffer of the identified process is empty; or

2\> if the uplink grant was received in a Random Access Response; or

2\> if the uplink grant is part of a bundle of the configured uplink
grant, and may be used for initial transmission according to subclause
6.1.2.3 of TS 38.214 \[7\], and if no MAC PDU has been obtained for this
bundle:

3\> if there is a MAC PDU in the Msg3 buffer and the uplink grant was
received in a Random Access Response:

4\> obtain the MAC PDU to transmit from the Msg3 buffer.

3\> else:

4\> obtain the MAC PDU to transmit from the Multiplexing and assembly
entity, if any;

3\> if a MAC PDU to transmit has been obtained:

4\> deliver the MAC PDU and the uplink grant and the HARQ information of
the TB to the identified HARQ process;

4\> instruct the identified HARQ process to trigger a new transmission;

4\> if the uplink grant is addressed to CS-RNTI; or

4\> if the uplink grant is a configured uplink grant; or

4\> if the uplink grant is addressed to C-RNTI, and the identified HARQ
process is configured for a configured uplink grant:

5\> start or restart the *configuredGrantTimer*, if configured, for the
corresponding HARQ process when the transmission is performed.

3\> else:

4\> flush the HARQ buffer of the identified HARQ process.

2\> else (i.e. retransmission):

3\> if the uplink grant received on PDCCH was addressed to CS-RNTI and
if the HARQ buffer of the identified process is empty; or

3\> if the uplink grant is part of a bundle and if no MAC PDU has been
obtained for this bundle; or

3\> if the uplink grant is part of a bundle of the configured uplink
grant, and the PUSCH of the uplink grant overlaps with a PUSCH of
another uplink grant received on the PDCCH for this Serving Cell:

4\> ignore the uplink grant.

3\> else:

4\> deliver the uplink grant and the HARQ information (redundancy
version) of the TB to the identified HARQ process;

4\> instruct the identified HARQ process to trigger a retransmission;

4\> if the uplink grant is addressed to CS-RNTI; or

4\> if the uplink grant is addressed to C-RNTI, and the identified HARQ
process is configured for a configured uplink grant:

5\> start or restart the *configuredGrantTimer*, if configured, for the
corresponding HARQ process when the transmission is performed.

When determining if NDI has been toggled compared to the value in the
previous transmission the MAC entity shall ignore NDI received in all
uplink grants on PDCCH for its Temporary C-RNTI.

\[TS 38.321, clause 5.4.2.2\]

Each HARQ process is associated with a HARQ buffer.

New transmissions are performed on the resource and with the MCS
indicated on either PDCCH, Random Access Response, or RRC.
Retransmissions are performed on the resource and, if provided, with the
MCS indicated on PDCCH, or on the same resource and with the same MCS as
was used for last made transmission attempt within a bundle.

If the HARQ entity requests a new transmission for a TB, the HARQ
process shall:

1\> store the MAC PDU in the associated HARQ buffer;

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

If the HARQ entity requests a retransmission for a TB, the HARQ process
shall:

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

To generate a transmission for a TB, the HARQ process shall:

1\> if the MAC PDU was obtained from the Msg3 buffer; or

1\> if there is no measurement gap at the time of the transmission and,
in case of retransmission, the retransmission does not collide with a
transmission for a MAC PDU obtained from the Msg3 buffer:

2\> instruct the physical layer to generate a transmission according to
the stored uplink grant.

##### 7.1.1.3.9.3 Test description {#test-description-8 .H6}

##### 7.1.1.3.9.3.1 Pre-test conditions {#pre-test-conditions-8 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that DRB is
configured in RLC AM mode according to Table 7.1.1.3.9.3.1-1.

Table 7.1.1.3.9.3.1-1: RLC parameters

  -------------------- ------
  *t-PollRetransmit*   ms80
  -------------------- ------

##### 7.1.1.3.9.3.2 Test procedure sequence {#test-procedure-sequence-8 .H6}

Table 7.1.1.3.9.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 0A        | SS        | \<\-\--   | (         | \-      | \- |
|           | transmits |           | RRCReconf |         |    |
|           | in the    |           | iguration |         |    |
|           | indicated |           | )         |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | an NR     |           |           |         |    |
|           | R         |           |           |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration. |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 0B        | UE        | \--\>     | (RRCRecon | \-      | \- |
|           | transmits |           | figuratio |         |    |
|           | NR        |           | nComplete |         |    |
|           | RRCRecon  |           | )         |         |    |
|           | figuratio |           |           |         |    |
|           | nComplete |           |           |         |    |
|           | message   |           |           |         |    |
|           | to the    |           |           |         |    |
|           | SS. (Note |           |           |         |    |
|           | 2)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\-\--   | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a valid   |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | one RLC   |           |           |         |    |
|           | PDU.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The UE    | \--\>     | (SR)      | \-      | \- |
|           | transmits |           |           |         |    |
|           | a         |           |           |         |    |
|           | S         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | Request.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \<\--     | UL Grant  | \-      | \- |
|           | allocates |           |           |         |    |
|           | an UL     |           |           |         |    |
|           | Grant for |           |           |         |    |
|           | HARQ      |           |           |         |    |
|           | process   |           |           |         |    |
|           | 1,        |           |           |         |    |
|           | s         |           |           |         |    |
|           | ufficient |           |           |         |    |
|           | for one   |           |           |         |    |
|           | RLC SDU   |           |           |         |    |
|           | to be     |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back in a |           |           |         |    |
|           | slot n,   |           |           |         |    |
|           | and NDI   |           |           |         |    |
|           | indicates |           |           |         |    |
|           | new       |           |           |         |    |
|           | tra       |           |           |         |    |
|           | nsmission |           |           |         |    |
|           | and DCI   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | the PUSCH |           |           |         |    |
|           | indicates |           |           |         |    |
|           | rv^ID^ =  |           |           |         |    |
|           | 0.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | one RLC   |           |           |         |    |
|           | SDU, in   |           |           |         |    |
|           | HARQ      |           |           |         |    |
|           | process 1 |           |           |         |    |
|           | and in    |           |           |         |    |
|           | slot n+4  |           |           |         |    |
|           | and       |           |           |         |    |
|           | repeats   |           |           |         |    |
|           | in        |           |           |         |    |
|           | following |           |           |         |    |
|           | pusch-A   |           |           |         |    |
|           | ggregatio |           |           |         |    |
|           | nFactor-1 |           |           |         |    |
|           | slots     |           |           |         |    |
|           | with same |           |           |         |    |
|           | resource  |           |           |         |    |
|           | a         |           |           |         |    |
|           | llocation |           |           |         |    |
|           | but       |           |           |         |    |
|           | different |           |           |         |    |
|           | r         |           |           |         |    |
|           | edundancy |           |           |         |    |
|           | version   |           |           |         |    |
|           | (Note 3), |           |           |         |    |
|           | if the    |           |           |         |    |
|           | slot can  |           |           |         |    |
|           | be used   |           |           |         |    |
|           | for       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | tran      |           |           |         |    |
|           | smission? |           |           |         |    |
|           | (Note 4)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC      |         |    |
|           | a MAC PDU |           | STATUS    |         |    |
|           | c         |           | PDU)      |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of the    |           |           |         |    |
|           | AMD PDU   |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 4.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| 36.508    |           |           |           |         |    |
| \[7\],    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 4.6.1-8   |           |           |           |         |    |
| using     |           |           |           |         |    |
| condition |           |           |           |         |    |
| EN-DC\_   |           |           |           |         |    |
| EmbedNR\_ |           |           |           |         |    |
| RRCRecon. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| The       |           |           |           |         |    |
| r         |           |           |           |         |    |
| edundancy |           |           |           |         |    |
| version   |           |           |           |         |    |
| for the   |           |           |           |         |    |
| first     |           |           |           |         |    |
| tra       |           |           |           |         |    |
| nsmission |           |           |           |         |    |
| and all   |           |           |           |         |    |
| possible  |           |           |           |         |    |
| re        |           |           |           |         |    |
| petitions |           |           |           |         |    |
| are set   |           |           |           |         |    |
| in the    |           |           |           |         |    |
| following |           |           |           |         |    |
| order {0, |           |           |           |         |    |
| 2, 3, 1}  |           |           |           |         |    |
| according |           |           |           |         |    |
| to TS     |           |           |           |         |    |
| 38.214    |           |           |           |         |    |
| \[15\]    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 6         |           |           |           |         |    |
| .1.2.1-2, |           |           |           |         |    |
| first     |           |           |           |         |    |
| row.      |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 4:   |           |           |           |         |    |
| Usage of  |           |           |           |         |    |
| correct   |           |           |           |         |    |
| r         |           |           |           |         |    |
| edundancy |           |           |           |         |    |
| version   |           |           |           |         |    |
| is        |           |           |           |         |    |
| i         |           |           |           |         |    |
| mplicitly |           |           |           |         |    |
| checked   |           |           |           |         |    |
| upon      |           |           |           |         |    |
| correct   |           |           |           |         |    |
| decoding  |           |           |           |         |    |
| by the SS |           |           |           |         |    |
| of the UE |           |           |           |         |    |
| UL        |           |           |           |         |    |
| rep       |           |           |           |         |    |
| etitions. |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.3.9.3.3 Specific message contents {#specific-message-contents-8 .H6}

Table 7.1.1.3.9.3.3-0A: *RRCReconfiguration* (step 0A, Table
7.1.1.3.9.3.2-1)

  ---------------------------------------------------- ----------------- ------------------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                                                                 
  Information Element                                  Value/remark      Comment                                     Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                  
  criticalExtensions CHOICE {                                                                                        
  rrcReconfiguration SEQUENCE {                                                                                      
  secondaryCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   EN-DC
  nonCriticalExtension SEQUENCE {                                                                                    NR
  masterCellGroup                                      CellGroupConfig                                               
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  ---------------------------------------------------- ----------------- ------------------------------------------- -----------

Table 7.1.1.3.9.3.3-0B: *CellGroupConfig* (Table 7.1.1.3.9.3.3-0A)

  ---------------------------------------------------- --------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19                                   
  Information Element                                  Value/remark          Comment   Condition
  cellGroupConfig ::= SEQUENCE {                                                       
  cellGroupId                                          0                               
                                                       1                               EN-DC
  spCellConfig SEQUENCE {                                                              
  spCellConfigDedicated SEQUENCE {                                                     
  servingCellConfig                                    *ServingCellConfig*             
  }                                                                                    
  }                                                                                    
  }                                                                                    
  ---------------------------------------------------- --------------------- --------- -----------

Table 7.1.1.3.9.3.3-1: *ServingCellConfig* (Table 7.1.1.3.9.3.3-0B)

  ----------------------------------------------------- --------------------- ------------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167                                       
  **Information Element**                               **Value/remark**      **Comment**   **Condition**
  ServingCellConfig ::= SEQUENCE {                                                          
  uplinkConfig SEQUENCE {                                                                   
  initialUplinkBWP                                      BWP-UplinkDedicated                 
  }                                                                                         
  }                                                                                         
  ----------------------------------------------------- --------------------- ------------- ---------------

Table 7.1.1.3.9.3.3-2: *BWP-UplinkDedicated* (Table 7.1.1.3.9.3.3-1)

  ---------------------------------------------------- ------------------ ------------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-11                                    
  **Information Element**                              **Value/remark**   **Comment**   **Condition**
  BWP-UplinkDedicated ::= SEQUENCE {                                                    
  pusch-Config CHOICE {                                                                 
  Setup                                                PUSCH-Config                     
  }                                                                                     
  }                                                                                     
  ---------------------------------------------------- ------------------ ------------- ---------------

Table 7.1.1.3.9.3.3-3: *PUSCH-Config* (Table 7.1.1.3.9.3.3-2)

  ----------------------------------------------------- -------------- --------- ------------------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-118                            
  Information Element                                   Value/remark   Comment   Condition
  PUSCH-Config ::= SEQUENCE {                                                    
  pusch-AggregationFactor                               n4                       
                                                        n8                       (TDD AND SCS15) OR FR2
  }                                                                              
  ----------------------------------------------------- -------------- --------- ------------------------

##### 7.1.1.3.10 Correct Handling of HARQ process / Multiple CORESETPoolIndex

##### 7.1.1.3.10.1. Test Purpose (TP) {#test-purpose-tp-9 .H6}

##### (1) {#section-41 .H6}

**with** { UE in RRC\_CONNECTED state and is configured with
PDCCH-Config that contains two different values of CORESETPoolIndex in
ControlResourceSet }

**ensure that** {

**when** { UE receives PDCCHs that schedule two PUSCHs non-overlapping
in time domain, and the PDCCHs are associated to different
ControlResourceSets having different values of CORESETPoolIndex }

**then** { UE sends PUSCHs following the scheduling information of
PDCCHs }

}

##### (2) {#section-42 .H6}

**with**(UE in RRC\_CONNECTED state and is configured with PDCCH-Config
that contains two different values of CORESETPoolIndex in
ControlResourceSet)

**ensure that** {

**when**{ UE receives PDCCHs that schedule two overlapping in time
domain PDSCHs and non-overlapping in frequency domain, and the PDCCHs
are associated to different ControlResourceSets having different values
of CORESETPoolIndex }

**then** { UE Receives PDSCHs following the scheduling information of
PDCCHs }

}

##### 7.1.1.3.10.2 Conformance requirements {#conformance-requirements-9 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.214, clauses 5.18.10 and 6.1.20. Unless otherwise
stated these are Rel-16 requirements.

\[TS 38.214, clause 5.11\]

If a UE is configured by higher layer parameter *PDCCH-Config* that
contains two different values of *CORESETPoolIndex* in
*ControlResourceSet*, the UE may expect to receive multiple PDCCHs
scheduling fully/partially/non-overlapped PDSCHs in time and frequency
domain. The UE may expect the reception of full/partially-overlapped
PDSCHs in time only when PDCCHs that schedule two PDSCHs are associated
to different *ControlResourceSets* having different values of
*CORESETPoolIndex*. For a *ControlResourceSet* without
*CORESETPoolIndex*, the UE may assume that the *ControlResourceSet* is
assigned with *CORESETPoolIndex* as 0. When the UE is scheduled with
full/partially/non-overlapped PDSCHs in time and frequency domain, the
full scheduling information for receiving a PDSCH is indicated and
carried only by the corresponding PDCCH, the UE is expected to be
scheduled with the same active BWP and the same SCS. When the UE is
scheduled with full/partially-overlapped PDSCHs in time and frequency
domain, the UE can be scheduled with at most two codewords
simultaneously. When PDCCHs that schedule two PDSCHs are associated to
different *ControlResourceSets* having different values of
*CORESETPoolIndex,* the following operations are allowed:

\- For any two HARQ process IDs in a given scheduled cell, if the UE is
scheduled to start receiving a first PDSCH starting in symbol *j* by a
PDCCH associated with a value of *CORESETpoolIndex* ending in symbol
*i*, the UE can be scheduled to receive a PDSCH starting earlier than
the end of the first PDSCH with a PDCCH associated with a different
value of *CORESETpoolIndex* that ends later than symbol *i*.

\- In a given scheduled cell, the UE can receive a first PDSCH in slot
*i*, with the corresponding HARQ-ACK assigned to be transmitted in slot
*j*, and a second PDSCH associated with a value of *CORESETpoolindex*
different from that of the first PDSCH starting later than the first
PDSCH with its corresponding HARQ-ACK assigned to be transmitted in a
slot before slot *j*.

If PDCCHs that schedule corresponding PDSCHs are associated to the same
or different *ControlResourceSets* having the same value of
*CORESETPoolIndex*, the UE procedure for receiving the PDSCH upon
detection of a PDCCH follows Clause 5.1.

\[TS 38.214, clause 6.1\]

If a UE is configured by higher layer parameter *PDCCH-Config* that
contains two different values of *CORESETPoolIndex* in
*ControlResourceSet* for the active BWP of a serving cell and PDCCHs
that schedule two non-overlapping in time domain PUSCHs are associated
to different *ControlResourceSets* having different values of
*CORESETPoolIndex,* for any two HARQ process IDs in a given scheduled
cell, if the UE is scheduled to start a first PUSCH transmission
starting in symbol *j* by a PDCCH associated with a value of
*CORESETpoolIndex* ending in symbol *i*, the UE can be scheduled to
transmit a PUSCH starting earlier than the end of the first PUSCH by a
PDCCH associated with a different value of *CORESETpoolIndex* that ends
later than symbol *i*.

##### 7.1.1.3.10.3 Test description {#test-description-9 .H6}

##### 7.1.1.3.10.3.1 Pre-test conditions {#pre-test-conditions-9 .H6}

Same Pre-test conditions as in clause 7.1.1.0.

##### 7.1.1.3.10.3.2 Test procedure sequence {#test-procedure-sequence-9 .H6}

Table 7.1.1.3.10.3.2-2: Main behaviour

+-----------+-----------+-----------+-----------+-----------+----+
| **St**    | **Pr      | **Message | **TP**    | **        |    |
|           | ocedure** | S         |           | Verdict** |    |
|           |           | equence** |           |           |    |
+===========+===========+===========+===========+===========+====+
|           |           | **U - S** | **        |           |    |
|           |           |           | Message** |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 1         | SS        | \<\--     | \-        | \-        | \- |
|           | transmits |           |           |           |    |
|           | NR        |           |           |           |    |
|           | *R        |           |           |           |    |
|           | RCReconfi |           |           |           |    |
|           | guration* |           |           |           |    |
|           | message   |           |           |           |    |
|           | to        |           |           |           |    |
|           | configure |           |           |           |    |
|           | two       |           |           |           |    |
|           | different |           |           |           |    |
|           | values of |           |           |           |    |
|           | *CORESETP |           |           |           |    |
|           | oolIndex* |           |           |           |    |
|           | in        |           |           |           |    |
|           | *Co       |           |           |           |    |
|           | ntrolReso |           |           |           |    |
|           | urceSet*, |           |           |           |    |
|           | (Note1)   |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 2         | The UE    | \--\>     | \-        | \-        | \- |
|           | transmits |           |           |           |    |
|           | NR        |           |           |           |    |
|           | *         |           |           |           |    |
|           | RRCReconf |           |           |           |    |
|           | iguration |           |           |           |    |
|           | Complete* |           |           |           |    |
|           | message   |           |           |           |    |
|           | (Note 2)  |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 3         | The SS    | \<\--     | MAC PDU   | \-        | \- |
|           | transmits |           | 1, MAC    |           |    |
|           | 2 MAC     |           | PDU 2     |           |    |
|           | PDU's on  |           |           |           |    |
|           | PDSCH's   |           |           |           |    |
|           | scheduled |           |           |           |    |
|           | by two    |           |           |           |    |
|           | different |           |           |           |    |
|           | values of |           |           |           |    |
|           | CORESET   |           |           |           |    |
|           | PoolIndex |           |           |           |    |
|           | in        |           |           |           |    |
|           | C         |           |           |           |    |
|           | ontrolRes |           |           |           |    |
|           | ourceSet. |           |           |           |    |
|           | The       |           |           |           |    |
|           | PDSCHs    |           |           |           |    |
|           | are       |           |           |           |    |
|           | scheduled |           |           |           |    |
|           | as        |           |           |           |    |
|           | ov        |           |           |           |    |
|           | erlapping |           |           |           |    |
|           | in time   |           |           |           |    |
|           | domain,   |           |           |           |    |
|           | but       |           |           |           |    |
|           | non-ov    |           |           |           |    |
|           | erlapping |           |           |           |    |
|           | in        |           |           |           |    |
|           | frequency |           |           |           |    |
|           | domain.   |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 4         | 100 ms    | \<\--     | (UL Grant | \-        | \- |
|           | after     |           | 1, UL     |           |    |
|           | step 4,   |           | Grant 2)  |           |    |
|           | the SS    |           |           |           |    |
|           | transmits |           |           |           |    |
|           | two UL    |           |           |           |    |
|           | grants    |           |           |           |    |
|           | s         |           |           |           |    |
|           | cheduling |           |           |           |    |
|           | two       |           |           |           |    |
|           | non-ov    |           |           |           |    |
|           | erlapping |           |           |           |    |
|           | in time   |           |           |           |    |
|           | domain    |           |           |           |    |
|           | but       |           |           |           |    |
|           | ov        |           |           |           |    |
|           | erlapping |           |           |           |    |
|           | in        |           |           |           |    |
|           | frequency |           |           |           |    |
|           | domain    |           |           |           |    |
|           | PUSCHs    |           |           |           |    |
|           | a         |           |           |           |    |
|           | ssociated |           |           |           |    |
|           | to        |           |           |           |    |
|           | different |           |           |           |    |
|           | C         |           |           |           |    |
|           | ontrolRes |           |           |           |    |
|           | ourceSets |           |           |           |    |
|           | having    |           |           |           |    |
|           | different |           |           |           |    |
|           | values of |           |           |           |    |
|           | CORESET   |           |           |           |    |
|           | PoolIndex |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 5         | Check:    | \--\>     | MAC PDU   | 1,2       | P  |
|           | Does the  |           | 1, MAC    |           |    |
|           | UE        |           | PDU 2     |           |    |
|           | transmit  |           |           |           |    |
|           | 2 MAC     |           |           |           |    |
|           | PDU's     |           |           |           |    |
|           | loop      |           |           |           |    |
|           | backed    |           |           |           |    |
|           | from step |           |           |           |    |
|           | 3?        |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| Note 1:   |           |           |           |           |    |
| For EN-DC |           |           |           |           |    |
| the NR    |           |           |           |           |    |
| RRCReconf |           |           |           |           |    |
| iguration |           |           |           |           |    |
| message   |           |           |           |           |    |
| is        |           |           |           |           |    |
| contained |           |           |           |           |    |
| in        |           |           |           |           |    |
| R         |           |           |           |           |    |
| RCConnect |           |           |           |           |    |
| ionReconf |           |           |           |           |    |
| iguration |           |           |           |           |    |
| TS 36.508 |           |           |           |           |    |
| \[7\],    |           |           |           |           |    |
| Table     |           |           |           |           |    |
| 4.6.1-8   |           |           |           |           |    |
| using     |           |           |           |           |    |
| condition |           |           |           |           |    |
| EN-DC\_   |           |           |           |           |    |
| EmbedNR\_ |           |           |           |           |    |
| RRCRecon. |           |           |           |           |    |
|           |           |           |           |           |    |
| Note 2:   |           |           |           |           |    |
| For EN-DC |           |           |           |           |    |
| the NR    |           |           |           |           |    |
| RRCRecon  |           |           |           |           |    |
| figuratio |           |           |           |           |    |
| nComplete |           |           |           |           |    |
| message   |           |           |           |           |    |
| is        |           |           |           |           |    |
| contained |           |           |           |           |    |
| in        |           |           |           |           |    |
| R         |           |           |           |           |    |
| RCConnect |           |           |           |           |    |
| ionReconf |           |           |           |           |    |
| iguration |           |           |           |           |    |
| Complete. |           |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+

##### 7.1.1.3.10.3.3 Specific message contents {#specific-message-contents-9 .H6}

Table 7.1.1.3.10.3.3-1: *PDCCH-Config* (Preamble)

  Derivation Path: TS 38.508-1 \[4\],Table 4.6.3-95                                                                                                       
  --------------------------------------------------------------------------------------- ----------------------------------------------------- --------- -----------
  Information Element                                                                     Value/remark                                          Comment   Condition
  PDCCH-Config::= SEQUENCE {                                                                                                                              
  controlResourceSetToAddModList SEQUENCE(SEQUENCE(SIZE (1..3)) OF ControlResourceSet {   2 entries                                                       
  ControlResourceSet\[1\]                                                                 ControlResourceSetid1                                 entry 1   
  ControlResourceSet\[2\]                                                                 ControlResourceSetid2                                 entry 2   
  }                                                                                                                                                       
  searchSpacesToAddModList SEQUENCE(SIZE (1..10)) OF SearchSpace {                        2 entries                                                       
  SearchSpace\[1\]                                                                        SearchSpace with condition USS                        entry 1   
  SearchSpace\[2\]                                                                        SearchSpace with condition USS and searchSpaceId =3   entry 2   
  }                                                                                                                                                       

Table 7.1.1.3.10.3.3-2: *ControlResourceSetId1* (Table 7.1.1.3.10.3.3-1:
*PDCCH-Config*)

  ---------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-28                            
  Information Element                                  Value/remark   Comment   Condition
  ControlResourceSet ::= SEQUENCE {                                             
  controlResourceSetId                                 1                        
  coresetPoolIndex-r16                                 0                        
  }                                                                             
  ---------------------------------------------------- -------------- --------- -----------

Table 7.1.1.3.10.3.3-3: *ControlResourceSetId2* (Table 7.1.1.3.10.3.3-1:
*PDCCH-Config*)

  ---------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-28                            
  Information Element                                  Value/remark   Comment   Condition
  ControlResourceSet ::= SEQUENCE {                                             
  controlResourceSetId                                 2                        
  coresetPoolIndex-r16                                 1                        
  }                                                                             
  ---------------------------------------------------- -------------- --------- -----------

Table 7.1.1.3.10.3.3-4: *PDSCH-Config* (Preamble)

  ----------------------------------------------------- -------------- ------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-100                                      
  Information Element                                   Value/remark   Comment             Condition
  PDSCH-Config ::= SEQUENCE {                                                              
  *dataScramblingIdentityPDSCH2-r16*                    7              Randomly selected   
  }                                                                                        
  ----------------------------------------------------- -------------- ------------------- -----------

Table 7.1.1.3.10.3.3-5: *PhysicalCellGroupConfig* (Preamble)

  ----------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-106                            
  Information Element                                   Value/remark   Comment   Condition
  PhysicalCellGroupConfig ::= SEQUENCE {                                         
  ackNackFeedbackMode-r16                               joint                    
  }                                                                              
  ----------------------------------------------------- -------------- --------- -----------

##### 7.1.1.3.11 Correct Handling of UL grant prioritization

##### 7.1.1.3.11.1 Test Purpose (TP) {#test-purpose-tp-10 .H6}

##### (1) {#section-43 .H6}

**with** { UE in RRC\_CONNECTED and configured with
*lch-basedPrioritizationï¼*and a resource conflict happened when the UE
is sending data based on a UL grant which is addressed to CS-RNTI with
NDI = 1 or C-RNTI }

**ensure that** {

**when** { the data causes the resource conflict is based on a
configured UL grant whose priority is lower than or equal to the UL
grant's }

**then** { UE determines the UL grant to be prioritized and sends the
corresponding MAC PDU.}

}

##### (2) {#section-44 .H6}

**with** { UE in RRC\_CONNECTED and configured with
*lch-basedPrioritizationï¼*a resource conflict happened when the UE is
sending data based on a UL grant which is addressed to CS-RNTI with NDI
= 1 or C-RNTI, and UE determines the UL grant to be prioritized }

**ensure that** {

**when** { UE sends out the MAC PDU associated with the prioritized
grant }

**then** { autonomously re-transmit the MAC PDU associated with the
de-prioritized grant.}

}

##### 7.1.1.3.11.2 Conformance requirements {#conformance-requirements-10 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.321, clauses 5.4.1 and 5.4.2.1. Unless otherwise
stated these are Rel-16 requirements.

\[TS 38.321, clause 5.4.1\]

...

For the MAC entity configured with *lch-basedPrioritization*, priority
of an uplink grant is determined by the highest priority among
priorities of the logical channels with data available that are
multiplexed or can be multiplexed in the MAC PDU, according to the
mapping restrictions as described in clause 5.4.3.1.2. The priority of
an uplink grant for which no data for logical channels is multiplexed or
can be multiplexed in the MAC PDU is lower than either the priority of
an uplink grant for which data for any logical channels is multiplexed
or can be multiplexed in the MAC PDU or the priority of the logical
channel triggering an SR.

If the corresponding PUSCH transmission of a configured uplink grant is
cancelled by CI-RNTI as specified in clause 11.2A of TS 38.213 \[6\] or
cancelled by a high PHY-priority PUCCH transmission as specified in
clause 9 of TS 38.213 \[6\], this uplink grant is considered as a
de-prioritized uplink grant.

When the MAC entity is configured with *lch-basedPrioritization*, for
each uplink grant whose associated PUSCH can be transmitted by lower
layers, the MAC entity shall:

1\> if this uplink grant is addressed to CS-RNTI with NDI = 1 or C-RNTI:

2\> if there is no overlapping PUSCH duration of a configured uplink
grant which was not already de-prioritized, in the same BWP whose
priority is higher than the priority of the uplink grant; and

2\> if there is no overlapping PUCCH resource with an SR transmission
which was not already de-prioritized and the priority of the logical
channel that triggered the SR is higher than the priority of the uplink
grant:

3\> consider this uplink grant as a prioritized uplink grant;

3\> consider the other overlapping uplink grant(s), if any, as a
de-prioritized uplink grant(s);

3\> consider the other overlapping SR transmission(s), if any, as a
de-prioritized SR transmission(s).

1\> else if this uplink grant is a configured uplink grant:

2\> if there is no overlapping PUSCH duration of another configured
uplink grant which was not already de-prioritized, in the same BWP,
whose priority is higher than the priority of the uplink grant; and

2\> if there is no overlapping PUSCH duration of an uplink grant
addressed to CS-RNTI with NDI = 1 or C-RNTI which was not already
de-prioritized, in the same BWP, whose priority is higher than or equal
to the priority of the uplink grant; and

2\> if there is no overlapping PUCCH resource with an SR transmission
which was not already de-prioritized and the priority of the logical
channel that triggered the SR is higher than the priority of the uplink
grant:

3\> consider this uplink grant as a prioritized uplink grant;

3\> consider the other overlapping uplink grant(s), if any, as a
de-prioritized uplink grant(s);

3\> consider the other overlapping SR transmission(s), if any, as a
de-prioritized SR transmission(s).

NOTE 6: If the MAC entity is configured with *lch-basedPrioritization*
and if there is overlapping PUSCH duration of at least two configured
uplink grants whose priorities are equal, the prioritized uplink grant
is determined by UE implementation.

NOTE 7: If the MAC entity is not configured with
*lch-basedPrioritzation* and if there is overlapping PUSCH duration of
at least two configured uplink grants, it is up to UE implementation to
choose one of the configured uplink grants.

\[TS 38.321, clause 5.4.2.1\]

The MAC entity includes a HARQ entity for each Serving Cell with
configured uplink (including the case when it is configured with
*supplementaryUplink*), which maintains a number of parallel HARQ
processes.

The number of parallel UL HARQ processes per HARQ entity is specified in
TS 38.214 \[7\].

Each HARQ process supports one TB.

Each HARQ process is associated with a HARQ process identifier. For UL
transmission with UL grant in RA Response or for UL transmission for
MSGA payload, HARQ process identifier 0 is used.

NOTE: When a single DCI is used to schedule multiple PUSCH, the UE is
allowed to map generated TB(s) internally to different HARQ processes in
case of LBT failure(s), i.e. UE may transmit a new TB on any HARQ
process in the grants that have the same TBS, the same RV and the NDIs
indicate new transmission.

The number of transmissions of a TB within a bundle of the dynamic grant
or configured grant is given by *REPETITION\_NUMBER* as follows:

\- For a dynamic grant, *REPETITION\_NUMBER* is set to a value provided
by lower layers, as specified in clause 6.1.2.1 of TS 38.214 \[7\];

\- For a configured grant, *REPETITION\_NUMBER* is set to a value
provided by lower layers, as specified in clause 6.1.2.3 of TS 38.214
\[7\].

If *REPETITION\_NUMBER* \> 1, after the first transmission within a
bundle, *REPETITION\_NUMBER* -- 1 HARQ retransmissions follow within the
bundle. For both dynamic grant and configured uplink grant, bundling
operation relies on the HARQ entity for invoking the same HARQ process
for each transmission that is part of the same bundle. Within a bundle,
HARQ retransmissions are triggered without waiting for feedback from
previous transmission according to *REPETITION\_NUMBER* for a dynamic
grant or configured uplink grant. Each transmission within a bundle is a
separate uplink grant delivered to the HARQ entity.

For each transmission within a bundle of the dynamic grant, the sequence
of redundancy versions is determined according to clause 6.1.2.1 of TS
38.214 \[7\]. For each transmission within a bundle of the configured
uplink grant, the sequence of redundancy versions is determined
according to clause 6.1.2.3 of TS 38.214 \[7\].

For each uplink grant, the HARQ entity shall:

1\> identify the HARQ process associated with this grant, and for each
identified HARQ process:

2\> if the received grant was not addressed to a Temporary C-RNTI on
PDCCH, and the NDI provided in the associated HARQ information has been
toggled compared to the value in the previous transmission of this TB of
this HARQ process; or

2\> if the uplink grant was received on PDCCH for the C-RNTI and the
HARQ buffer of the identified process is empty; or

2\> if the uplink grant was received in a Random Access Response (i.e.
in a MAC RAR or a fallback RAR); or

2\> if the uplink grant was determined as specified in clause 5.1.2a for
the transmission of the MSGA payload; or

2\> if the uplink grant was received on PDCCH for the C-RNTI in
*ra-ResponseWindow* and this PDCCH successfully completed the Random
Access procedure initiated for beam failure recovery; or

2\> if the uplink grant is part of a bundle of the configured uplink
grant, and may be used for initial transmission according to clause
6.1.2.3 of TS 38.214 \[7\], and if no MAC PDU has been obtained for this
bundle:

3\> if there is a MAC PDU in the MSGA buffer and the uplink grant
determined as specified in clause 5.1.2a for the transmission of the
MSGA payload was selected; or

3\> if there is a MAC PDU in the MSGA buffer and the uplink grant was
received in a fallbackRAR and this fallbackRAR successfully completed
the Random Access procedure:

4\> obtain the MAC PDU to transmit from the MSGA buffer.

3\> else if there is a MAC PDU in the Msg3 buffer and the uplink grant
was received in a fallbackRAR:

4\> obtain the MAC PDU to transmit from the Msg3 buffer.

3\> else if there is a MAC PDU in the Msg3 buffer and the uplink grant
was received in a MAC RAR; or:

3\> if there is a MAC PDU in the Msg3 buffer and the uplink grant was
received on PDCCH for the C-RNTI in *ra-ResponseWindow* and this PDCCH
successfully completed the Random Access procedure initiated for beam
failure recovery:

4\> obtain the MAC PDU to transmit from the Msg3 buffer.

4\> if the uplink grant size does not match with size of the obtained
MAC PDU; and

4\> if the Random Access procedure was successfully completed upon
receiving the uplink grant:

5\> indicate to the Multiplexing and assembly entity to include MAC
subPDU(s) carrying MAC SDU from the obtained MAC PDU in the subsequent
uplink transmission;

5\> obtain the MAC PDU to transmit from the Multiplexing and assembly
entity.

3\> else if this uplink grant is a configured grant configured with
*autonomousTx*; and

3\> if the previous configured uplink grant, in the BWP, for this HARQ
process was not prioritized; and

3\> if a MAC PDU had already been obtained for this HARQ process; and

3\> if the uplink grant size matches with size of the obtained MAC PDU;
and

3\> if a transmission of the obtained MAC PDU has not been performed:

4\> consider the MAC PDU has been obtained.

3\> else if the MAC entity is not configured with
*lch-basedPrioritization*; or

3\> if this uplink grant is a prioritized uplink grant:

4\> obtain the MAC PDU to transmit from the Multiplexing and assembly
entity, if any;

3\> if a MAC PDU to transmit has been obtained:

4\> if the uplink grant is not a configured grant configured with
*autonomousTx*; or

4\> if the uplink grant is a prioritized uplink grant:

5\> deliver the MAC PDU and the uplink grant and the HARQ information of
the TB to the identified HARQ process;

5\> instruct the identified HARQ process to trigger a new transmission;

5\> if the uplink grant is a configured uplink grant:

6\> start or restart the *configuredGrantTimer*, if configured, for the
corresponding HARQ process when the transmission is performed if LBT
failure indication is not received from lower layers;

6\> start or restart the *cg-RetransmissionTimer*, if configured, for
the corresponding HARQ process when the transmission is performed if LBT
failure indication is not received from lower layers.

5\> if the uplink grant is addressed to C-RNTI, and the identified HARQ
process is configured for a configured uplink grant:

6\> start or restart the *configuredGrantTimer*, if configured, for the
corresponding HARQ process when the transmission is performed if LBT
failure indication is not received from lower layers.

5\> if *cg-RetransmissionTimer* is configured for the identified HARQ
process; and

5\> if the transmission is performed and LBT failure indication is
received from lower layers:

6\> consider the identified HARQ process as pending.

3\> else:

4\> flush the HARQ buffer of the identified HARQ process.

2\> else (i.e. retransmission):

3\> if the uplink grant received on PDCCH was addressed to CS-RNTI and
if the HARQ buffer of the identified process is empty; or

3\> if the uplink grant is part of a bundle and if no MAC PDU has been
obtained for this bundle; or

3\> if the uplink grant is part of a bundle of the configured uplink
grant, and the PUSCH duration of the uplink grant overlaps with a PUSCH
duration of another uplink grant received on the PDCCH or an uplink
grant received in a Random Access Response (i.e. MAC RAR or fallbackRAR)
or an uplink grant determined as specified in clause 5.1.2a for MSGA
payload for this Serving Cell; or:

3\> if the MAC entity is configured with *lch-basedPrioritization* and
this uplink grant is not a prioritized uplink grant:

4\> ignore the uplink grant.

3\> else:

4\> deliver the uplink grant and the HARQ information (redundancy
version) of the TB to the identified HARQ process;

4\> instruct the identified HARQ process to trigger a retransmission;

4\> if the uplink grant is addressed to CS-RNTI; or

4\> if the uplink grant is addressed to C-RNTI, and the identified HARQ
process is configured for a configured uplink grant:

5\> start or restart the *configuredGrantTimer*, if configured, for the
corresponding HARQ process when the transmission is performed if LBT
failure indication is not received from lower layers.

4\> if the uplink grant is a configured uplink grant:

5\> if the identified HARQ process is pending:

> 6\> start or restart the *configuredGrantTimer, if configured,* for
> the corresponding HARQ process when the transmission is performed if
> LBT failure indication is not received from lower layers;

5\> start or restart the *cg-RetransmissionTimer*, if configured, for
the corresponding HARQ process when the transmission is performed if LBT
failure indication is not received from lower layers.

4\> if the identified HARQ process is pending and the transmission is
performed and LBT failure indication is not received from lower layers:

5\> consider the identified HARQ process as not pending.

When determining if NDI has been toggled compared to the value in the
previous transmission the MAC entity shall ignore NDI received in all
uplink grants on PDCCH for its Temporary C-RNTI.

When *configuredGrantTimer* or *cg-RetransmissionTimer* is started or
restarted by a PUSCH transmission, it shall be started at the beginning
of the first symbol of the PUSCH transmission.

##### 7.1.1.3.11.3 Test description {#test-description-10 .H6}

##### 7.1.1.3.11.3.1 Pre-test conditions {#pre-test-conditions-10 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that the UM DRB is
configured and the logical channels are configured according to
7.1.1.3.11.3.1-1.

Table 7.1.1.3.11.3.1-2: Logical Channel Configuration Settings

  Parameter                DRB1                    DRB2
  ------------------------ ----------------------- -----------------------
  LogicalChannelIdentity   LCH4(DRB-Identity +3)   LCH5(DRB-Identity +3)
  Priority                 6                       7
  logicalChannelGroup      2 (LCG ID\#2)           1 (LCG ID\#1)

##### 7.1.1.3.11.3.2 Test procedure sequence {#test-procedure-sequence-10 .H6}

Table 7.1.1.3.11.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | SS        | \<\--     | RRCReconf | \-      | \- |
|           | transmits |           | iguration |         |    |
|           | NR        |           |           |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | configure |           |           |         |    |
|           | type 2    |           |           |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The UE    | \--\>     | RRCRecon  | \-      | \- |
|           | transmits |           | figuratio |         |    |
|           | NR        |           | nComplete |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | Complete. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \-        | \-        | \-      | \- |
|           | ignores   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | requests  |           |           |         |    |
|           | and does  |           |           |         |    |
|           | not       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | any       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (1 RLC    |         |    |
|           | a MAC PDU |           | SDU of 40 |         |    |
|           | including |           | bytes on  |         |    |
|           | a RLC     |           | DRB)      |         |    |
|           | SDU-1 on  |           |           |         |    |
|           | LCH 4.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | The SS    | \<\--     | (UL Grant | \-      | \- |
|           | allocates |           | (C-RNTI)) |         |    |
|           | an UL     |           |           |         |    |
|           | Grant     |           |           |         |    |
|           | (with     |           |           |         |    |
|           | size 384  |           |           |         |    |
|           | bits that |           |           |         |    |
|           | only      |           |           |         |    |
|           | s         |           |           |         |    |
|           | ufficient |           |           |         |    |
|           | for one   |           |           |         |    |
|           | RLC SDU   |           |           |         |    |
|           | to be     |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back in a |           |           |         |    |
|           | Slot) for |           |           |         |    |
|           | one HARQ  |           |           |         |    |
|           | process X |           |           |         |    |
|           | and NDI   |           |           |         |    |
|           | indicates |           |           |         |    |
|           | new       |           |           |         |    |
|           | tra       |           |           |         |    |
|           | nsmission |           |           |         |    |
|           | r         |           |           |         |    |
|           | edundancy |           |           |         |    |
|           | version   |           |           |         |    |
|           | to be     |           |           |         |    |
|           | used as   |           |           |         |    |
|           | 0.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | the RLC   |           |           |         |    |
|           | SDU-1, in |           |           |         |    |
|           | HARQ      |           |           |         |    |
|           | process   |           |           |         |    |
|           | X.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (1 RLC    |         |    |
|           | a MAC PDU |           | SDU of 40 |         |    |
|           | including |           | bytes on  |         |    |
|           | a RLC     |           | DRB)      |         |    |
|           | SDU-2 on  |           |           |         |    |
|           | LCH 5.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | SS        | \<\--     | (UL Grant | \-      | \- |
|           | transmits |           | (         |         |    |
|           | a         |           | CS-RNTI)) |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | UL Grant  |           |           |         |    |
|           | (with     |           |           |         |    |
|           | size 384  |           |           |         |    |
|           | bits that |           |           |         |    |
|           | only      |           |           |         |    |
|           | s         |           |           |         |    |
|           | ufficient |           |           |         |    |
|           | for one   |           |           |         |    |
|           | RLC SDU   |           |           |         |    |
|           | to be     |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back in a |           |           |         |    |
|           | Slot), on |           |           |         |    |
|           | PDCCH     |           |           |         |    |
|           | with the  |           |           |         |    |
|           | CS-RNTI   |           |           |         |    |
|           | assigned  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | UE,       |           |           |         |    |
|           | allowing  |           |           |         |    |
|           | the UE to |           |           |         |    |
|           | return    |           |           |         |    |
|           | the RLC   |           |           |         |    |
|           | SDU-2 (as |           |           |         |    |
|           | received  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 5) in     |           |           |         |    |
|           | Slot P.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | The SS    | \<\--     | (UL Grant | \-      | \- |
|           | transmits |           | (C-RNTI)) |         |    |
|           | an UL     |           |           |         |    |
|           | grant     |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to slot   |           |           |         |    |
|           | for HARQ  |           |           |         |    |
|           | process   |           |           |         |    |
|           | X, with   |           |           |         |    |
|           | NDI not   |           |           |         |    |
|           | toggled   |           |           |         |    |
|           | and       |           |           |         |    |
|           | r         |           |           |         |    |
|           | edundancy |           |           |         |    |
|           | version   |           |           |         |    |
|           | to be     |           |           |         |    |
|           | used as   |           |           |         |    |
|           | 1. (Note  |           |           |         |    |
|           | 3)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | r         |           |           |         |    |
|           | etransmit |           |           |         |    |
|           | the MAC   |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | including |           |           |         |    |
|           | RLC SDU-1 |           |           |         |    |
|           | in slot   |           |           |         |    |
|           | P?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | the MAC   |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | including |           |           |         |    |
|           | RLC SDU-2 |           |           |         |    |
|           | after     |           |           |         |    |
|           | slot P?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | The SS    | \<\--     | PDCCH     | \-      | \- |
|           | transmits |           | \[for UL  |         |    |
|           | a PDCCH   |           | c         |         |    |
|           | \[for UL  |           | onfigured |         |    |
|           | c         |           | grant     |         |    |
|           | onfigured |           | type 2    |         |    |
|           | grant     |           | explicit  |         |    |
|           | type 2    |           | release\] |         |    |
|           | explicit  |           |           |         |    |
|           | release\] |           |           |         |    |
|           | using     |           |           |         |    |
|           | UE's      |           |           |         |    |
|           | CS-RNTI   |           |           |         |    |
|           | in Symbol |           |           |         |    |
|           | 'S' of    |           |           |         |    |
|           | slot 'p'  |           |           |         |    |
|           | with      |           |           |         |    |
|           | NDI=0.    |           |           |         |    |
|           | Where     |           |           |         |    |
|           | (z+5x\< p |           |           |         |    |
|           | \<z+6x).  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| Void.     |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| Void*.*   |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| The UL    |           |           |           |         |    |
| grant     |           |           |           |         |    |
| slot is   |           |           |           |         |    |
| equal to  |           |           |           |         |    |
| the       |           |           |           |         |    |
| c         |           |           |           |         |    |
| onfigured |           |           |           |         |    |
| slot in   |           |           |           |         |    |
| step 8*.* |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.3.11.3.3 Specific message contents {#specific-message-contents-10 .H6}

Table 7.1.1.3.11.3.3-1: *RRCReconfiguration* (step 1, Table
7.1.1.3.11.3.2-1)

  ------------------------------------------------- ----------------- ------------------------------------------- -----------
  Derivation path: 38.508-1 \[4\], Table 4.6.1-13                                                                 
  Information Element                               Value/remark      Comment                                     Condition
  RRCReconfiguration ::= SEQUENCE {                                                                               
  criticalExtensions CHOICE {                                                                                     
  rrcReconfiguration SEQUENCE {                                                                                   
  nonCriticalExtension := SEQUENCE{                                                                               NR
  masterCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   
  }                                                                                                               
  }                                                                                                               
  }                                                                                                               
  }                                                                                                               
  ------------------------------------------------- ----------------- ------------------------------------------- -----------

Table 7.1.1.3.11.3.3-2: *CellGroupConfig* (Table 7.1.1.3.11.3.3-1)

  --------------------------------------------------- ------------------------- --------------------------------------------- -------------
  Derivation path: 38.508-1 \[4\], Table 4.6.3-19                                                                             
  Information Element                                 Value/remark              Comment                                       Condition
  CellGroupConfig ::= SEQUENCE {                                                                                              
  mac-CellGroupConfig                                 MAC-CellGroupConfig       Table 7.1.1.3.11.3.3-3                        
  physicalCellGroupConfig                             PhysicalCellGroupConfig   Table 7.1.1.3.11.3.3-4                        
  spCellConfig SEQUENCE{                                                                                                      
  spCellConfigDedicated SEQUENCE{                                                                                             
  uplinkConfig SEQUENCE {                                                                                                     
  initialUplinkBWP SEQUENCE {                                                                                                 
  pucch-Config CHOICE {                                                                                                       
  setup SEQUENCE {                                                                                                            
  schedulingRequestResourceToAddModList {                                                                                     
  schedulingRequestResourceId                         1                                                                       
  schedulingRequestID                                 0                                                                       
  periodicityAndOffset CHOICE {                                                                                               
  sl20                                                10                                                                      
  }                                                                                                                           
  }                                                                                                                           
  }                                                                                                                           
  }                                                                                                                           
  configuredGrantConfig CHOICE {                                                                                              
  setup SEQUENCE {                                                                                                            
  cg-DMRS-Configuration                               DMRS-UplinkConfig         Reference TS 38.508-1 \[4\], Table 4.6.3-51   
  uci-OnPUSCH CHOICE {                                                                                                        
  setup SEQUENCE {                                                                                                            
  semiStatic SEQUENCE {                               BetaOffsets                                                             
  betaOffsetACK-Index1                                9                                                                       
  betaOffsetACK-Index2                                9                                                                       
  betaOffsetACK-Index3                                9                                                                       
  betaOffsetCSI-Part1-Index1                          6                                                                       
  betaOffsetCSI-Part1-Index2                          6                                                                       
  betaOffsetCSI-Part2-Index1                          6                                                                       
  betaOffsetCSI-Part2-Index2                          6                                                                       
  }                                                                                                                           
  }                                                                                                                           
  }                                                                                                                           
  resourceAllocation                                  ResourceAllocationType1                                                 
  powerControlLoopToUse                               n0                                                                      
  p0-PUSCH-Alpha                                      1                                                                       
  nrofHARQ-Processes                                  16                                                                      
  repK                                                n1                                                                      
  periodicity                                         Sym80x14                                                                15kHz
  periodicity                                         Sym160x14                                                               30kHz
  periodicity                                         Sym320x14                                                               60kHz
  periodicity                                         Sym640x14                                                               120kHz
  autonomousTx-r16                                    enabled                                                                 
  }                                                                                                                           
  }                                                                                                                           
  pusch-Config CHOICE {                                                                                                       
  setup SEQUENCE {                                                                                                            
  PUSCH-TimeDomainResourceAllocationList SEQUENCE {                                                                           
  k2                                                  n8                                                                      FR1 and FR2
  mappingType                                         typeB                                                                   
  startSymbolAndLength                                0011011                                                                 FR1
  startSymbolAndLength                                0001110                                                                 FR2
  }                                                                                                                           
  }                                                                                                                           
  }                                                                                                                           
  }                                                                                                                           
  }                                                                                                                           
  }                                                                                                                           
  }                                                                                                                           
  --------------------------------------------------- ------------------------- --------------------------------------------- -------------

Table 7.1.1.3.11.3.3-3: MAC-CellGroupConfig (Table 7.1.1.3.11.3.3-2)

  ---------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-68                            
  Information Element                                  Value/remark   Comment   Condition
  MAC-CellGroupConfig ::= SEQUENCE {                                            
  lch-BasedPrioritization-r16                          enabled                  
  }                                                                             
  ---------------------------------------------------- -------------- --------- -----------

Table 7.1.1.3.11.3.3-4: PhysicalCellGroupConfig (Table 7.1.1.3.11.3.3-2)

  ----------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-106                            
  Information Element                                   Value/remark   Comment   Condition
  PhysicalCellGroupConfig ::= SEQUENCE {                                         
  cs-RNTI                                               'FFE0'H                  
  }                                                                              
  ----------------------------------------------------- -------------- --------- -----------

##### 7.1.1.3.12 Correct Handling of UL HARQ process / PUSCH Repetition Type B

##### 7.1.1.3.12.1 Test Purpose (TP) {#test-purpose-tp-11 .H6}

##### (1) {#section-45 .H6}

**with** { UE in RRC\_CONNECTED state and is configured with PUSCH
repetition type B }

**ensure that** {

**when** { UE receives an UL Grant with toggled NDI and has data
available for transmission }

**then** { UE transmits a new MAC PDU and repeats the MAC PDU in proper
actual transmission times after first transmission and selects the
redundancy version correctly }

}

##### 7.1.1.3.12.2 Conformance requirements {#conformance-requirements-11 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.214 clauses 6.1.2.1 and 6.1.4, TS 38.321 clause
5.4.2.1. Unless otherwise stated these are Rel-16 requirements.

\[TS 38.214, clause 6.1.2.1\]

\- for PUSCH scheduled by DCI format 0\_1, if
*pusch-RepTypeIndicatorDCI-0-1* is set to \'*pusch-RepTypeB*\', the UE
applies PUSCH repetition Type B procedure when determining the time
domain resource allocation. For PUSCH scheduled by DCI format 0\_2, if
*pusch-RepTypeIndicatorDCI-0-2* is set to \'*pusch-RepTypeB*\', the UE
applies PUSCH repetition Type B procedure when determining the time
domain resource allocation. Otherwise, the UE applies PUSCH repetition
Type A procedure when determining the time domain resource allocation
for PUSCH scheduled by PDCCH.

\- For PUSCH repetition Type A, the starting symbol *S* relative to the
start of the slot, and the number of consecutive symbols *L* counting
from the symbol *S* allocated for the PUSCH are determined from the
start and length indicator *SLIV* of the indexed row:

> if then
>
> else
>
> where, and

\- For PUSCH repetition Type B, the starting symbol *S* relative to the
start of the slot, and the number of consecutive symbols *L* counting
from the symbol *S* allocated for the PUSCH are provided by
*startSymbol* and *length* of the indexed row of the resource allocation
table, respectively.

\- For PUSCH repetition Type A, the PUSCH mapping type is set to Type A
or Type B as defined in Clause 6.4.1.1.3 of \[4, TS 38.211\] as given by
the indexed row.

\- For PUSCH repetition Type B, the PUSCH mapping type is set to Type B.

The UE shall consider the *S* and *L* combinations defined in table
6.1.2.1-1 as valid PUSCH allocations

Table 6.1.2.1-1: Valid *S* and *L* combinations

  PUSCH mapping type                Normal cyclic prefix   Extended cyclic prefix                                                                                                   
  --------------------------------- ---------------------- ------------------------ -------------------------------------------------------------------- ------------- ------------ --------------------------------------------------------------------
                                    *S*                    *L*                      *S+L*                                                                *S*           *L*          *S+L*
  Type A (repetition Type A only)   0                      {4,...,14}               {4,...,14}                                                           0             {4,...,12}   {4,...,12}
  Type B                            {0,...,13}             {1,...,14}               {1,...,14} for repetition Type A, {1,...,27} for repetition Type B   {0,..., 11}   {1,...,12}   {1,...,12} for repetition Type A, {1,...,23} for repetition Type B

For PUSCH repetition Type A, when transmitting PUSCH scheduled by DCI
format 0\_1 or 0\_2 in PDCCH with CRC scrambled with C-RNTI, MCS-C-RNTI,
or CS-RNTI with NDI=1, the number of repetitions *K* is determined as

\- if *numberOfRepetitions* is present in the resource allocation table,
the number of repetitions K is equal to *numberOfRepetitions*;

\- elseif the UE is configured with *pusch-AggregationFactor*, the
number of repetitions *K* is equal to *pusch-AggregationFactor*;

\- otherwise *K=1*.

If a UE is configured with higher layer parameter
*pusch-TimeDomainAllocationListForMultiPUSCH*, the UE does not expect to
be configured with *pusch-AggregationFactor.*

For PUSCH repetition Type A, in case *K\>1,* the same symbol allocation
is applied across the *K* consecutive slots and the PUSCH is limited to
a single transmission layer. The UE shall repeat the TB across the *K*
consecutive slots applying the same symbol allocation in each slot. The
redundancy version to be applied on the *n*th transmission occasion of
the TB, where n = 0, 1, ... *K*-1, is determined according to table
6.1.2.1-2.

Table 6.1.2.1-2: Redundancy version for PUSCH transmission

  *rv~id\ ~*indicated by the DCI scheduling the PUSCH   *rv~id~* to be applied to *n*^th^ transmission occasion (repetition Type A) or *n*^th^ actual repetition (repetition Type B)                                   
  ----------------------------------------------------- ------------------------------------------------------------------------------------------------------------------------------ --------------- --------------- ---------------
                                                        *n* mod 4 = 0                                                                                                                  *n* mod 4 = 1   *n* mod 4 = 2   *n* mod 4 = 3
  0                                                     0                                                                                                                              2               3               1
  2                                                     2                                                                                                                              3               1               0
  3                                                     3                                                                                                                              1               0               2
  1                                                     1                                                                                                                              0               2               3

When transmitting MsgA PUSCH on a non-initial UL BWP, if the UE is
configured with *startSymbolAndLengthMsgA-PO*, the UE shall determine
the *S* and *L* from *startSymbolAndLengthMsgA-PO*.

When transmitting MsgA PUSCH, if the UE is not configured with
*startSymbolAndLengthMsgA-PO*, and if the TDRA list
*PUSCH-TimeDomainResourceAllocationList* is provided in
*PUSCH-ConfigCommon*, the UE shall use *msgA-PUSCH-TimeDomainAllocation*
to indicate which values are used in the list. If
*PUSCH-TimeDomainResourceAllocationList* is not provided in
*PUSCH-ConfigCommon*, the UE shall use parameters *S* and *L* from table
6.1.2.1.1-2 or table 6.1.2.1.1-3 where *msgA-PUSCH-TimeDomainAllocation*
indicates which values are used in the list. The time offset for PUSCH
transmission is described in \[6, TS38.213\].

For PUSCH repetition Type A, a PUSCH transmission in a slot of a
multi-slot PUSCH transmission is omitted according to the conditions in
Clause 9, Clause 11.1 and Clause 11.2A of \[6, TS38.213\].

For PUSCH repetition Type B, except for PUSCH transmitting CSI report(s)
with no transport block, the number of nominal repetitions is given by
*numberOfRepetitions*. For the *n*-th nominal repetition, *n* = *0*,
..., *numberOfRepetitions* - 1,

\- The slot where the nominal repetition starts is given by , and the
starting symbol relative to the start of the slot is given by .

\- The slot where the nominal repetition ends is given by , and the
ending symbol relative to the start of the slot is given by .

Here is the slot where the PUSCH transmission starts, and is the number
of symbols per slot as defined in Clause 4.3.2 of \[4, TS38.211\].

For PUSCH repetition Type B, the UE determines invalid symbol(s) for
PUSCH repetition Type B transmission as follows:

\- A symbol that is indicated as downlink by
*tdd-UL-DL-ConfigurationCommon* or *tdd-UL-DL-ConfigurationDedicated* is
considered as an invalid symbol for PUSCH repetition Type B
transmission.

\- For operation in unpaired spectrum, symbols indicated by
*ssb-PositionsInBurst* in SIB1 or *ssb-PositionsInBurst* in
*ServingCellConfigCommon* for reception of SS/PBCH blocks are considered
as invalid symbols for PUSCH repetition Type B transmission.

\- For operation in unpaired spectrum, symbol(s) indicated by
*pdcch-ConfigSIB1* in *MIB* for a CORESET for Type0-PDCCH CSS set are
considered as invalid symbol(s) for PUSCH repetition Type B
transmission.

\- For operation in unpaired spectrum, if
*numberOfInvalidSymbolsForDL-UL-Switching* is configured,
*numberOfInvalidSymbolsForDL-UL-Switching* symbol(s) after the last
symbol that is indicated as downlink in each consecutive set of all
symbols that are indicated as downlink by
*tdd-UL-DL-ConfigurationCommon* or *tdd-UL-DL-ConfigurationDedicated*
are considered as invalid symbol(s) for PUSCH repetition Type B
transmission. The symbol(s) given by
*numberOfInvalidSymbolsForDL-UL-Switching* are defined using the
reference SCS configuration *referenceSubcarrierSpacing* provided in
*tdd-UL-DL-ConfigurationCommon*.

\- The UE may be configured with the higher layer parameter
*invalidSymbolPattern*, which provides a symbol level bitmap spanning
one or two slots (higher layer parameter *symbols* given by
*invalidSymbolPattern*). A bit value equal to 1 in the symbol level
bitmap *symbols* indicates that the corresponding symbol is an invalid
symbol for PUSCH repetition Type B transmission. The UE may be
additionally configured with a time-domain pattern (higher layer
parameter *periodicityAndPattern* given by *invalidSymbolPattern*),
where each bit of *periodicityAndPattern* corresponds to a unit equal to
a duration of the symbol level bitmap *symbols*, and a bit value equal
to 1 indicates that the symbol level bitmap *symbols* is present in the
unit. The *periodicityAndPattern* can be {1, 2, 4, 5, 8, 10, 20 or 40}
units long, but maximum of 40 msec. The first symbol of
*periodicityAndPattern* every 40 msec/P periods is a first symbol in
frame ðð mod 4 = 0, where P is the duration of
*periodicityAndPattern-r16* in units of msec. When
*periodicityAndPattern* is not configured, for a symbol level bitmap
spanning two slots, the bits of the first and second slots correspond
respectively to even and odd slots of a radio frame, and for a symbol
level bitmap spanning one slot, the bits of the slot correspond to every
slot of a radio frame. If *invalidSymbolPattern* is configured, when the
UE applies the invalid symbol pattern is determined as follows:

\- if the PUSCH is scheduled by DCI format 0\_1, or corresponds to a
Type 2 configured grant activated by DCI format 0\_1, and if
*invalidSymbolPatternIndicatorDCI-0-1* is configured,

\- if invalid symbol pattern indicator field is set 1, the UE applies
the invalid symbol pattern;

\- otherwise, the UE does not apply the invalid symbol pattern;

\- if the PUSCH is scheduled by DCI format 0\_2, or corresponds to a
Type 2 configured grant activated by DCI format 0\_2, and if
*invalidSymbolPatternIndicatorDCI-0-2* is configured,

\- if invalid symbol pattern indicator field is set 1, the UE applies
the invalid symbol pattern;

\- otherwise, the UE does not apply the invalid symbol pattern;

\- otherwise, the UE applies the invalid symbol pattern.

\- If the UE

\- is configured with multiple serving cells and is provided
*half-duplex-behavior* = \'enable\', and

\- is not capable of simultaneous transmission and reception on any of
the multiple serving cells, and

\- indicates support of capability for half-duplex operation in CA with
unpaired spectrum, and

\- is not configured to monitor PDCCH for detection of DCI format 2-0 on
any of the multiple serving cells,

\- a symbol is considered as an invalid symbol in any of the multiple
serving cells for PUSCH repetition Type B transmission if the symbol is
indicated to the UE for reception of SS/PBCH blocks in any of the
multiple serving cells by *ssb-PositionsInBurst* in *SIB1* or
*ssb-PositionsInBurst* in *ServingCellConfigCommon*, and

a symbol is considered as an invalid symbol in any of the multiple
serving cells for PUSCH repetition Type B transmission with Type 1 or
Type 2 configured grant except for the first Type 2 PUSCH transmission
(including all repetitions) after activation if the symbol is indicated
as downlink by *tdd-UL-DL-ConfigurationCommon* or
*tdd-UL-DL-ConfigurationDedicated* on the reference cell, or the UE is
configured by higher layers to receive PDCCH, PDSCH, or CSI-RS on the
reference cell in the symbol.

For PUSCH repetition Type B, after determining the invalid symbol(s) for
PUSCH repetition type B transmission for each of the *K* nominal
repetitions, the remaining symbols are considered as potentially valid
symbols for PUSCH repetition Type B transmission. If the number of
potentially valid symbols for PUSCH repetition type B transmission is
greater than zero for a nominal repetition, the nominal repetition
consists of one or more actual repetitions, where each actual repetition
consists of a consecutive set of all potentially valid symbols that can
be used for PUSCH repetition Type B transmission within a slot. An
actual repetition with a single symbol is omitted except for the case of
*L*=1. An actual repetition is omitted according to the conditions in
Clause 9, Clause 11.1 and Clause 11.2A of \[6, TS38.213\]. The
redundancy version to be applied on the *n*th actual repetition (with
the counting including the actual repetitions that are omitted) is
determined according to table 6.1.2.1-2.

For PUSCH repetition Type B, when a UE receives a DCI that schedules
aperiodic CSI report(s) or activates semi-persistent CSI report(s) on
PUSCH with no transport block by a \'*CSI request\'* field on a DCI, the
number of nominal repetitions is always assumed to be 1, regardless of
the value of *numberOfRepetitions*. When the UE is scheduled to transmit
a PUSCH repetition Type B with no transport block and with aperiodic or
semi-persistent CSI report(s) by a \'*CSI request\'* field on a DCI, the
first nominal repetition is expected to be the same as the first actual
repetition. For PUSCH repetition Type B carrying semi-persistent CSI
report(s) without a corresponding PDCCH after being activated on PUSCH
by a \'*CSI request\'* field on a DCI, if the first nominal repetition
is not the same as the first actual repetition, the first nominal
repetition is omitted; otherwise, the first nominal repetition is
omitted according to the conditions in Clause 9, Clause 11.1 and Clause
11.2A of \[6, TS38.213\].

For PUSCH repetition Type B, when a UE is scheduled to transmit a
transport block and aperiodic CSI report(s) on PUSCH by a \'*CSI
request\'* field on a DCI, the CSI report(s) is multiplexed only on the
first actual repetition. The UE does not expect that the first actual
repetition has a single symbol duration.

\[TS 38.214, clause 6.1.4\]

To determine the modulation order, target code rate, redundancy version
and transport block size for the physical uplink shared channel, the UE
shall first

\- read the 5-bit modulation and coding scheme field in the DCI
scheduling PUSCH or provided in a DCI activating a configured grant Type
2 PUSCH, or as provided by *mcsAndTBS* as described in Clause 6.1.2.3
for a configured grant Type 1 PUSCH to determine the modulation order
and target code rate (*R*) based on the procedure defined in Clause
6.1.4.1

\- read redundancy version field (*rv*) in the DCI to determine the
redundancy version for PUSCH scheduled by DCI, or determine the
redundancy version according to Clause 6.1.2.3.1 for configured grant
Type 1 and Type 2 PUSCH,

and second

\- use the number of layers , the total number of allocated PRBs to
determine the transport block size based on the procedure defined in
Clause 6.1.4.2.

When the UE is scheduled with multiple PUSCHs by a DCI, as described in
clause 6.1.2.1, the bits of *rv* field and NDI field, respectively, in
the DCI are one to one mapped to the scheduled PUSCH(s) with the
corresponding transport block(s) in the scheduled order where the LSB
bits of the *rv* field and NDI field, respectively, correspond to the
last scheduled PUSCH.

Within a cell group, a UE is not required to handle PUSCH(s)
transmissions in slot *s~j~* in serving cell-*j*, and for *j* = 0,1,2..
*J-1*, slot *s~j~* overlapping with any given point in time, if the
following condition is not satisfied at that point in time:

![](./media/image32.png)![](./media/image32.png),

where

*- J* is the number of configured serving cells belong to a frequency
range

\- for the *j-th* serving cell,

*- M* is the number of TB(s) transmitted in slot-*s~j~*. For PUSCH
repetition Type B, each actual repetition is counted separately.

*- T~slot~^Î¼(j)^* =10^-3^/2^*Î¼(j*)^, where *Î¼(j)* is the numerology for
PUSCH(s) in slot *s~j~* of the *j*-th serving cell.

\- for the *m*-th TB, ![](./media/image33.png)![](./media/image33.png)

*- A* is the number of bits in the transport block as defined in Clause
6.2.1 \[5, TS 38.212\]

*- C* *is the total number of code blocks for the transport block*
defined in Clause 5.2.2 \[5, TS
38.212\].![](./media/image34.png)![](./media/image34.png)

\- ![](./media/image35.png)![](./media/image35.png)is the number of
scheduled code blocks for the transport block as defined in Clause
5.4.2.1 \[5,38.212\]

\- ![](./media/image36.png)![](./media/image36.png) \[Mbps\] is computed
as the maximum data rate summed over all the carriers in the frequency
range for any signalled band combination and feature set consistent with
the configured servings cells, where the data rate value is given by the
formula in Clause 4.1.2 in \[13, TS 38.306\], including the scaling
factor *f(i).*

For a *j*-th serving cell, if higher layer parameter
*processingType2Enabled* of *PUSCH-ServingCellConfig* is configured for
the serving cell and set to \'*enable\',* or if at least one *I~MCS~ \>
W* for [ ]{.underline} a PUSCH, where *W* = 28 for MCS tables 5.1.3.1-1
and 5.1.3.1-3, and *W* = 27 for MCS tables 5.1.3.1-2, 6.1.4.1-1, and
6.1.4.1-2, or if it is an actual repetition for PUSCH repetition Type B,
the UE is not required to handle PUSCH transmissions, if the following
condition is not satisfied:

![](./media/image37.png)

*where*

\- ![](./media/image38.png)![](./media/image38.png)is the number of
symbols assigned to the PUSCH

\- *M* is the number of TB in the PUSCH

\- ![](./media/image39.png)![](./media/image39.png) where Î¼ is the
numerology of the PUSCH

\- for the *m*-th TB, ![](./media/image33.png)![](./media/image33.png)

\- *A* is the number of bits in the transport block as defined in Clause
6.2.1 \[5, TS 38.212\]

\- *C* is the total number of code blocks for the transport block
defined in Clause 5.2.2 \[5, TS 38.212\]

\- ![](./media/image35.png)![](./media/image35.png) is the number of
scheduled code blocks for the transport block as defined in Clause
5.4.2.1 \[5, TS 38.212\]

\- ![](./media/image40.png)![](./media/image40.png) \[Mbps\] is computed
as the maximum data rate for a carrier in the frequency band of the
serving cell for any signalled band combination and feature set
consistent with the serving cell, where the data rate value is given by
the formula in Clause 4.1.2 in \[13, TS 38.306\], including the scaling
factor *f(i)*

\- *each actual repetition for PUSCH repetition type B is treated as one
PUSCH.*

\[TS 38.321, clause 5.4.2.1\]

The MAC entity includes a HARQ entity for each Serving Cell with
configured uplink (including the case when it is configured with
*supplementaryUplink*), which maintains a number of parallel HARQ
processes.

The number of parallel UL HARQ processes per HARQ entity is specified in
TS 38.214 \[7\].

Each HARQ process supports one TB.

Each HARQ process is associated with a HARQ process identifier. For UL
transmission with UL grant in RA Response or for UL transmission for
MSGA payload, HARQ process identifier 0 is used.

NOTE: When a single DCI is used to schedule multiple PUSCH, the UE is
allowed to map generated TB(s) internally to different HARQ processes in
case of LBT failure(s), i.e. UE may transmit a new TB on any HARQ
process in the grants that have the same TBS, the same RV and the NDIs
indicate new transmission.

The maximum number of transmissions of a TB within a bundle of the
dynamic grant or configured grant is given by *REPETITION\_NUMBER* as
follows:

\- For a dynamic grant, *REPETITION\_NUMBER* is set to a value provided
by lower layers, as specified in clause 6.1.2.1 of TS 38.214 \[7\];

\- For a configured grant, *REPETITION\_NUMBER* is set to a value
provided by lower layers, as specified in clause 6.1.2.3 of TS 38.214
\[7\].

If *REPETITION\_NUMBER* \> 1, after the first transmission within a
bundle, at most *REPETITION\_NUMBER* -- 1 HARQ retransmissions follow
within the bundle. For both dynamic grant and configured uplink grant,
bundling operation relies on the HARQ entity for invoking the same HARQ
process for each transmission that is part of the same bundle. Within a
bundle, HARQ retransmissions are triggered without waiting for feedback
from previous transmission according to *REPETITION\_NUMBER* for a
dynamic grant or configured uplink grant unless they are terminated as
specified in clause 6.1 of TS 38.214 \[7\]. Each transmission within a
bundle is a separate uplink grant delivered to the HARQ entity.

For each transmission within a bundle of the dynamic grant, the sequence
of redundancy versions is determined according to clause 6.1.2.1 of TS
38.214 \[7\]. For each transmission within a bundle of the configured
uplink grant, the sequence of redundancy versions is determined
according to clause 6.1.2.3 of TS 38.214 \[7\].

For each uplink grant, the HARQ entity shall:

1\> identify the HARQ process associated with this grant, and for each
identified HARQ process:

2\> if the received grant was not addressed to a Temporary C-RNTI on
PDCCH, and the NDI provided in the associated HARQ information has been
toggled compared to the value in the previous transmission of this TB of
this HARQ process; or

2\> if the uplink grant was received on PDCCH for the C-RNTI and the
HARQ buffer of the identified process is empty; or

2\> if the uplink grant was received in a Random Access Response (i.e.
in a MAC RAR or a fallback RAR); or

2\> if the uplink grant was determined as specified in clause 5.1.2a for
the transmission of the MSGA payload; or

2\> if the uplink grant was received on PDCCH for the C-RNTI in
*ra-ResponseWindow* and this PDCCH successfully completed the Random
Access procedure initiated for beam failure recovery; or

2\> if the uplink grant is part of a bundle of the configured uplink
grant, and may be used for initial transmission according to clause
6.1.2.3 of TS 38.214 \[7\], and if no MAC PDU has been obtained for this
bundle:

3\> if there is a MAC PDU in the MSGA buffer and the uplink grant
determined as specified in clause 5.1.2a for the transmission of the
MSGA payload was selected; or

3\> if there is a MAC PDU in the MSGA buffer and the uplink grant was
received in a fallbackRAR and this fallbackRAR successfully completed
the Random Access procedure:

4\> obtain the MAC PDU to transmit from the MSGA buffer.

3\> else if there is a MAC PDU in the Msg3 buffer and the uplink grant
was received in a fallbackRAR:

4\> obtain the MAC PDU to transmit from the Msg3 buffer.

3\> else if there is a MAC PDU in the Msg3 buffer and the uplink grant
was received in a MAC RAR; or:

3\> if there is a MAC PDU in the Msg3 buffer and the uplink grant was
received on PDCCH for the C-RNTI in *ra-ResponseWindow* and this PDCCH
successfully completed the Random Access procedure initiated for beam
failure recovery:

4\> obtain the MAC PDU to transmit from the Msg3 buffer.

4\> if the uplink grant size does not match with size of the obtained
MAC PDU; and

4\> if the Random Access procedure was successfully completed upon
receiving the uplink grant:

5\> indicate to the Multiplexing and assembly entity to include MAC
subPDU(s) carrying MAC SDU from the obtained MAC PDU in the subsequent
uplink transmission;

5\> obtain the MAC PDU to transmit from the Multiplexing and assembly
entity.

3\> else if this uplink grant is a configured grant configured with
*autonomousTx*; and

3\> if the previous configured uplink grant, in the BWP, for this HARQ
process was not prioritized; and

3\> if a MAC PDU had already been obtained for this HARQ process; and

3\> if the uplink grant size matches with size of the obtained MAC PDU;
and

3\> if none of PUSCH transmission(s) of the obtained MAC PDU has been
completely performed:

4\> consider the MAC PDU has been obtained.

3\> else if the MAC entity is not configured with
*lch-basedPrioritization*; or

3\> if this uplink grant is a prioritized uplink grant:

4\> obtain the MAC PDU to transmit from the Multiplexing and assembly
entity, if any;

3\> if a MAC PDU to transmit has been obtained:

4\> if the uplink grant is not a configured grant configured with
*autonomousTx*; or

4\> if the uplink grant is a prioritized uplink grant:

5\> deliver the MAC PDU and the uplink grant and the HARQ information of
the TB to the identified HARQ process;

5\> instruct the identified HARQ process to trigger a new transmission;

5\> if the uplink grant is a configured uplink grant:

6\> start or restart the *configuredGrantTimer*, if configured, for the
corresponding HARQ process when the transmission is performed if LBT
failure indication is not received from lower layers;

6\> start or restart the *cg-RetransmissionTimer*, if configured, for
the corresponding HARQ process when the transmission is performed if LBT
failure indication is not received from lower layers.

5\> if the uplink grant is addressed to C-RNTI, and the identified HARQ
process is configured for a configured uplink grant:

6\> start or restart the *configuredGrantTimer*, if configured, for the
corresponding HARQ process when the transmission is performed if LBT
failure indication is not received from lower layers.

5\> if *cg-RetransmissionTimer* is configured for the identified HARQ
process; and

5\> if the transmission is performed and LBT failure indication is
received from lower layers:

6\> consider the identified HARQ process as pending.

3\> else:

4\> flush the HARQ buffer of the identified HARQ process.

2\> else (i.e. retransmission):

3\> if the uplink grant received on PDCCH was addressed to CS-RNTI and
if the HARQ buffer of the identified process is empty; or

3\> if the uplink grant is part of a bundle and if no MAC PDU has been
obtained for this bundle; or

3\> if the uplink grant is part of a bundle of the configured uplink
grant, and the PUSCH duration of the uplink grant overlaps with a PUSCH
duration of another uplink grant received on the PDCCH or an uplink
grant received in a Random Access Response (i.e. MAC RAR or fallbackRAR)
or an uplink grant determined as specified in clause 5.1.2a for MSGA
payload for this Serving Cell; or:

3\> if the MAC entity is configured with *lch-basedPrioritization* and
this uplink grant is not a prioritized uplink grant:

4\> ignore the uplink grant.

3\> else:

4\> deliver the uplink grant and the HARQ information (redundancy
version) of the TB to the identified HARQ process;

4\> instruct the identified HARQ process to trigger a retransmission;

4\> if the uplink grant is addressed to CS-RNTI; or

4\> if the uplink grant is addressed to C-RNTI, and the identified HARQ
process is configured for a configured uplink grant:

5\> start or restart the *configuredGrantTimer*, if configured, for the
corresponding HARQ process when the transmission is performed if LBT
failure indication is not received from lower layers.

4\> if the uplink grant is a configured uplink grant:

5\> if the identified HARQ process is pending:

6\> start or restart the *configuredGrantTimer, if configured,* for the
corresponding HARQ process when the transmission is performed if LBT
failure indication is not received from lower layers;

5\> start or restart the *cg-RetransmissionTimer*, if configured, for
the corresponding HARQ process when the transmission is performed if LBT
failure indication is not received from lower layers.

4\> if the identified HARQ process is pending and the transmission is
performed and LBT failure indication is not received from lower layers:

5\> consider the identified HARQ process as not pending.

When determining if NDI has been toggled compared to the value in the
previous transmission the MAC entity shall ignore NDI received in all
uplink grants on PDCCH for its Temporary C-RNTI.

When *configuredGrantTimer* or *cg-RetransmissionTimer* is started or
restarted by a PUSCH transmission, it shall be started at the beginning
of the first symbol of the PUSCH transmission.

##### 7.1.1.3.12.3 Test description {#test-description-11 .H6}

##### 7.1.1.3.12.3.1 Pre-test conditions {#pre-test-conditions-11 .H6}

Same Pre-test conditions as in clause 7.1.1.0.

##### 7.1.1.3.12.3.2 Test procedure sequence {#test-procedure-sequence-11 .H6}

Table 7.1.1.3.12.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 0A        | SS        | \<\-\--   | *(RR      | \-      | \- |
|           | transmits |           | CReconfig |         |    |
|           | in the    |           | uration)* |         |    |
|           | indicated |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | an NR     |           |           |         |    |
|           | R         |           |           |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration. |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 0B        | UE        | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | NR        |           | gurationC |         |    |
|           | RRCRecon  |           | omplete)* |         |    |
|           | figuratio |           |           |         |    |
|           | nComplete |           |           |         |    |
|           | message   |           |           |         |    |
|           | to the    |           |           |         |    |
|           | SS. (Note |           |           |         |    |
|           | 2)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\-\--   | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a valid   |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | one RLC   |           |           |         |    |
|           | PDU.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The UE    | \--\>     | (SR)      | \-      | \- |
|           | transmits |           |           |         |    |
|           | a         |           |           |         |    |
|           | S         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | Request.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \<\--     | UL Grant  | \-      | \- |
|           | allocates |           |           |         |    |
|           | an UL     |           |           |         |    |
|           | Grant for |           |           |         |    |
|           | HARQ      |           |           |         |    |
|           | process   |           |           |         |    |
|           | 1,        |           |           |         |    |
|           | s         |           |           |         |    |
|           | ufficient |           |           |         |    |
|           | for one   |           |           |         |    |
|           | RLC SDU   |           |           |         |    |
|           | to be     |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back in a |           |           |         |    |
|           | slot n,   |           |           |         |    |
|           | NDI       |           |           |         |    |
|           | indicates |           |           |         |    |
|           | new       |           |           |         |    |
|           | tran      |           |           |         |    |
|           | smission, |           |           |         |    |
|           | DCI       |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | the PUSCH |           |           |         |    |
|           | indicates |           |           |         |    |
|           | rv^ID^ =  |           |           |         |    |
|           | 0 and     |           |           |         |    |
|           | invalid   |           |           |         |    |
|           | symbol    |           |           |         |    |
|           | pattern   |           |           |         |    |
|           | indicator |           |           |         |    |
|           | set to 1. |           |           |         |    |
|           | The slot  |           |           |         |    |
|           | n is      |           |           |         |    |
|           | selected  |           |           |         |    |
|           | such that |           |           |         |    |
|           | slot      |           |           |         |    |
|           | n+k2-r16  |           |           |         |    |
|           | is the    |           |           |         |    |
|           | first UL  |           |           |         |    |
|           | slot in   |           |           |         |    |
|           | subframe  |           |           |         |    |
|           | m         |           |           |         |    |
|           | s         |           |           |         |    |
|           | atisfying |           |           |         |    |
|           | (m mod    |           |           |         |    |
|           | 20) = 9   |           |           |         |    |
|           | for       |           |           |         |    |
|           | SCS=15kHz |           |           |         |    |
|           | (except   |           |           |         |    |
|           | for       |           |           |         |    |
|           | HD\_FDD)  |           |           |         |    |
|           | and       |           |           |         |    |
|           | S         |           |           |         |    |
|           | CS=120kHz |           |           |         |    |
|           | and       |           |           |         |    |
|           |           |           |           |         |    |
|           | (m mod    |           |           |         |    |
|           | 20) = 8   |           |           |         |    |
|           | for       |           |           |         |    |
|           | SCS=30kHz |           |           |         |    |
|           | and       |           |           |         |    |
|           | HD\_FDD.  |           |           |         |    |
|           | (Note 5)  |           |           |         |    |
|           | (Note 6)  |           |           |         |    |
|           | (Note 7)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | one RLC   |           |           |         |    |
|           | SDU, in   |           |           |         |    |
|           | HARQ      |           |           |         |    |
|           | process 1 |           |           |         |    |
|           | and in    |           |           |         |    |
|           | slot n+4  |           |           |         |    |
|           | and       |           |           |         |    |
|           | repeats   |           |           |         |    |
|           | in actual |           |           |         |    |
|           | re        |           |           |         |    |
|           | petitions |           |           |         |    |
|           | according |           |           |         |    |
|           | to Table  |           |           |         |    |
|           | 7.1.1.3   |           |           |         |    |
|           | .12.3.2-2 |           |           |         |    |
|           | with same |           |           |         |    |
|           | resource  |           |           |         |    |
|           | a         |           |           |         |    |
|           | llocation |           |           |         |    |
|           | but       |           |           |         |    |
|           | different |           |           |         |    |
|           | r         |           |           |         |    |
|           | edundancy |           |           |         |    |
|           | version   |           |           |         |    |
|           | (Note 3), |           |           |         |    |
|           | if the    |           |           |         |    |
|           | slot can  |           |           |         |    |
|           | be used   |           |           |         |    |
|           | for       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | tran      |           |           |         |    |
|           | smission? |           |           |         |    |
|           | (Note 4)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC      |         |    |
|           | a MAC PDU |           | STATUS    |         |    |
|           | c         |           | PDU)      |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of the    |           |           |         |    |
|           | AMD PDU   |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 4.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| 36.508    |           |           |           |         |    |
| \[7\],    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 4.6.1-8   |           |           |           |         |    |
| using     |           |           |           |         |    |
| condition |           |           |           |         |    |
| EN-DC\_   |           |           |           |         |    |
| EmbedNR\_ |           |           |           |         |    |
| RRCRecon. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| The       |           |           |           |         |    |
| r         |           |           |           |         |    |
| edundancy |           |           |           |         |    |
| version   |           |           |           |         |    |
| for the   |           |           |           |         |    |
| first     |           |           |           |         |    |
| tra       |           |           |           |         |    |
| nsmission |           |           |           |         |    |
| and all   |           |           |           |         |    |
| possible  |           |           |           |         |    |
| actual    |           |           |           |         |    |
| re        |           |           |           |         |    |
| petitions |           |           |           |         |    |
| (         |           |           |           |         |    |
| including |           |           |           |         |    |
| skipped   |           |           |           |         |    |
| ones) are |           |           |           |         |    |
| set in    |           |           |           |         |    |
| the       |           |           |           |         |    |
| following |           |           |           |         |    |
| order {0, |           |           |           |         |    |
| 2, 3, 1}  |           |           |           |         |    |
| according |           |           |           |         |    |
| to TS     |           |           |           |         |    |
| 38.214    |           |           |           |         |    |
| \[15\]    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 6         |           |           |           |         |    |
| .1.2.1-2, |           |           |           |         |    |
| first     |           |           |           |         |    |
| row.      |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 4:   |           |           |           |         |    |
| Usage of  |           |           |           |         |    |
| correct   |           |           |           |         |    |
| r         |           |           |           |         |    |
| edundancy |           |           |           |         |    |
| version   |           |           |           |         |    |
| is        |           |           |           |         |    |
| i         |           |           |           |         |    |
| mplicitly |           |           |           |         |    |
| checked   |           |           |           |         |    |
| upon      |           |           |           |         |    |
| correct   |           |           |           |         |    |
| decoding  |           |           |           |         |    |
| by the SS |           |           |           |         |    |
| of the UE |           |           |           |         |    |
| UL        |           |           |           |         |    |
| rep       |           |           |           |         |    |
| etitions. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 5:   |           |           |           |         |    |
| The UL    |           |           |           |         |    |
| grant is  |           |           |           |         |    |
| set to    |           |           |           |         |    |
| 384 bits: |           |           |           |         |    |
| L~RBs~ =  |           |           |           |         |    |
| 24 &      |           |           |           |         |    |
| I~MCS~ =  |           |           |           |         |    |
| 2 (with   |           |           |           |         |    |
| PUSCH-d   |           |           |           |         |    |
| uration=4 |           |           |           |         |    |
| and PUSCH |           |           |           |         |    |
| mapping   |           |           |           |         |    |
| Type B).  |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 6:   |           |           |           |         |    |
| HD\_FDD   |           |           |           |         |    |
| means     |           |           |           |         |    |
| pc\_ha    |           |           |           |         |    |
| lfDuplexF |           |           |           |         |    |
| DD\_TypeA |           |           |           |         |    |
| \_RedCap\ |           |           |           |         |    |
| _r17=true |           |           |           |         |    |
| (i.e      |           |           |           |         |    |
| HD\_FDD   |           |           |           |         |    |
| UE are    |           |           |           |         |    |
| p         |           |           |           |         |    |
| erforming |           |           |           |         |    |
| test on   |           |           |           |         |    |
| FDD       |           |           |           |         |    |
| band).    |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 7:   |           |           |           |         |    |
| k2-r16 is |           |           |           |         |    |
| c         |           |           |           |         |    |
| onfigured |           |           |           |         |    |
| in Table  |           |           |           |         |    |
| 7.1.1.3.  |           |           |           |         |    |
| 12.3.3-3. |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

Table 7.1.1.3.12.3.2-2: Transmitted actual repetition in each nominal
repetition

+-------------+-------------+-------------+-------------+-------------+
|             | Nominal     | Nominal     | Nominal     | Nominal     |
|             | repetition  | repetition  | repetition  | repetition  |
|             | 0           | 1           | 2           | 3           |
|             |             |             |             |             |
|             | (NOTE 1)    | (NOTE 1)    | (NOTE 2)    | (NOTE 3)    |
+=============+=============+=============+=============+=============+
| FR1 TDD     | Actual      | Actual      | N/A (NOTE   | N/A (NOTE   |
| SCS=15kHz   | repetition  | repetition  | 4, 5)       | 6)          |
|             | 0           | 0           |             |             |
+-------------+-------------+-------------+-------------+-------------+
| FR1 FDD     | Actual      | Actual      | Actual      | Actual      |
| SCS=15kHz   | repetition  | repetition  | repetition  | repetition  |
|             | 0           | 0           | 1 (NOTE 4,  | 0           |
|             |             |             | 7)          |             |
+-------------+-------------+-------------+-------------+-------------+
| FR1 TDD     | Actual      | Actual      | Actual      | Actual      |
| SCS=30kHz   | repetition  | repetition  | repetition  | repetition  |
|             | 0           | 0           | 1 (NOTE 4)  | 0           |
+-------------+-------------+-------------+-------------+-------------+
| FR2         | Actual      | Actual      | N/A (NOTE   | N/A (NOTE   |
| SCS=120kHz  | repetition  | repetition  | 4, 5)       | 6)          |
|             | 0           | 0           |             |             |
+-------------+-------------+-------------+-------------+-------------+
| NOTE 1: The |             |             |             |             |
| nominal     |             |             |             |             |
| repetition  |             |             |             |             |
| is in slot  |             |             |             |             |
| n+k2-r16    |             |             |             |             |
| and only    |             |             |             |             |
| one actual  |             |             |             |             |
| repetition  |             |             |             |             |
| expected.   |             |             |             |             |
|             |             |             |             |             |
| NOTE 2: The |             |             |             |             |
| nominal     |             |             |             |             |
| repetition  |             |             |             |             |
| is split    |             |             |             |             |
| into two    |             |             |             |             |
| actual      |             |             |             |             |
| repetitions |             |             |             |             |
| in slot n+  |             |             |             |             |
| k2-r16 and  |             |             |             |             |
| n+ k2-r16+1 |             |             |             |             |
| re          |             |             |             |             |
| spectively. |             |             |             |             |
|             |             |             |             |             |
| NOTE 3: The |             |             |             |             |
| nominal     |             |             |             |             |
| repetition  |             |             |             |             |
| is in slot  |             |             |             |             |
| n+ k2-r16+1 |             |             |             |             |
| and only    |             |             |             |             |
| one actual  |             |             |             |             |
| repetition  |             |             |             |             |
| expected.   |             |             |             |             |
|             |             |             |             |             |
| NOTE 4: The |             |             |             |             |
| actual      |             |             |             |             |
| repetition  |             |             |             |             |
| 0 is        |             |             |             |             |
| skipped due |             |             |             |             |
| to only 1   |             |             |             |             |
| valid       |             |             |             |             |
| symbol left |             |             |             |             |
| according   |             |             |             |             |
| to          |             |             |             |             |
| inv         |             |             |             |             |
| alidSymbolP |             |             |             |             |
| attern-r16. |             |             |             |             |
|             |             |             |             |             |
| NOTE 5: The |             |             |             |             |
| actual      |             |             |             |             |
| repetition  |             |             |             |             |
| 1 is        |             |             |             |             |
| skipped due |             |             |             |             |
| to being    |             |             |             |             |
| located in  |             |             |             |             |
| DL symbols  |             |             |             |             |
|             |             |             |             |             |
| NOTE 6: The |             |             |             |             |
| actual      |             |             |             |             |
| repetition  |             |             |             |             |
| 0 is        |             |             |             |             |
| skipped due |             |             |             |             |
| to being    |             |             |             |             |
| located in  |             |             |             |             |
| DL symbols  |             |             |             |             |
|             |             |             |             |             |
| NOTE 7: The |             |             |             |             |
| SS may not  |             |             |             |             |
| be able to  |             |             |             |             |
| decode the  |             |             |             |             |
| MAC PDU and |             |             |             |             |
| may only    |             |             |             |             |
| detect a    |             |             |             |             |
| CRC error   |             |             |             |             |
| as there    |             |             |             |             |
| are less    |             |             |             |             |
| symbols     |             |             |             |             |
| available   |             |             |             |             |
| for         |             |             |             |             |
| t           |             |             |             |             |
| ransmission |             |             |             |             |
| of the TBS  |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+

##### 7.1.1.3.12.3.3 Specific message contents {#specific-message-contents-11 .H6}

Table 7.1.1.3.12.3.3-0A: *RRCReconfiguration* (step 0A, Table
7.1.1.3.12.3.2-1)

  ---------------------------------------------------- ----------------- ------------------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                                                                 
  Information Element                                  Value/remark      Comment                                     Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                  
  criticalExtensions CHOICE {                                                                                        
  rrcReconfiguration SEQUENCE {                                                                                      
  secondaryCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   EN-DC
  nonCriticalExtension := SEQUENCE{                                                                                  NR
  masterCellGroup                                      CellGroupConfig                                               
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  ---------------------------------------------------- ----------------- ------------------------------------------- -----------

Table 7.1.1.3.12.3.3-0B: *CellGroupConfig* (Table 7.1.1.3.12.3.3-0A)

  ------------------------------------------------- ------------------- --------- -----------
  Derivation Path: 38.508-1 \[4\], Table 4.6.3-19                                 
  Information Element                               Value/remark        Comment   Condition
  CellGroupConfig::= SEQUENCE {                                                   
  cellGroupId                                       0                             
                                                    1                             EN-DC
  spCellConfig SEQUENCE {                                                         
  spCellConfigDedicated                             ServingCellConfig             
  }                                                                               
  }                                                                               
  ------------------------------------------------- ------------------- --------- -----------

Table 7.1.1.3.12.3.3-1: *ServingCellConfig* (Table 7.1.1.3.12.3.3-0B)

  ----------------------------------------------------- --------------------- ------------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167                                       
  **Information Element**                               **Value/remark**      **Comment**   **Condition**
  ServingCellConfig ::= SEQUENCE {                                                          
  uplinkConfig SEQUENCE {                                                                   
  initialUplinkBWP                                      BWP-UplinkDedicated                 
  }                                                                                         
  }                                                                                         
  ----------------------------------------------------- --------------------- ------------- ---------------

Table 7.1.1.3.12.3.3-2: *BWP-UplinkDedicated* (Table 7.1.1.3.12.3.3-1)

  ---------------------------------------------------- ------------------ ------------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-11                                    
  **Information Element**                              **Value/remark**   **Comment**   **Condition**
  BWP-UplinkDedicated ::= SEQUENCE {                                                    
  pusch-Config CHOICE {                                                                 
  setup                                                PUSCH-Config                     
  }                                                                                     
  }                                                                                     
  ---------------------------------------------------- ------------------ ------------- ---------------

Table 7.1.1.3.12.3.3-3: *PUSCH-Config* (Table 7.1.1.3.12.3.3-2)

  ------------------------------------------------------------------------------------------ ------------------- ------------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-118                                                                          
  **Information Element**                                                                    **Value/remark**    **Comment**   **Condition**
  PUSCH-Config ::= SEQUENCE {                                                                                                  
  dmrs-UplinkForPUSCH-MappingTypeB CHOICE {                                                                                    
  setup                                                                                      DMRS-UplinkConfig                 
  }                                                                                                                            
  pusch-TimeDomainAllocationListDCI-0-1-r16 CHOICE {                                                                           
  setup SEQUENCE (SIZE(1..maxNrofUL-Allocations-r16)) OF SEQUENCE {                          1 entry                           
  k2-r16\[1\]                                                                                4                                 
                                                                                             3                                 HD\_FDD
  puschAllocationList-r16\[1\] SEQUENCE (SIZE(1..maxNrofMultiplePUSCHs-r16)) OF SEQUENCE {   1 entry                           
  mappingType-r16\[1\]                                                                       Not present                       
  startSymbolAndLength-r16\[1\]                                                              Not present                       
  startSymbol-r16\[1\]                                                                       4                                 
  length-r16\[1\]                                                                            4                                 
  numberOfRepetitions-r16\[1\]                                                               n4                                
  }                                                                                                                            
  }                                                                                                                            
  }                                                                                                                            
  invalidSymbolPatternIndicatorDCI-0-1-r16                                                   enabled                           
  pusch-RepTypeIndicatorDCI-0-1-r16                                                          pusch-RepTypeB                    
  invalidSymbolPattern-r16 SEQUENCE {                                                                                          
  symbols-r16 CHOICE {                                                                                                         
  oneSlot                                                                                    00000000000001                    
  }                                                                                                                            
  periodicityAndPattern-r16                                                                  Not present                       
  }                                                                                                                            
  }                                                                                                                            
  ------------------------------------------------------------------------------------------ ------------------- ------------- ---------------

  ----------- ----------------------------------------------------------------------------------------
  Condition   Explanation
  HD\_FDD     pc\_halfDuplexFDD\_TypeA\_RedCap\_r17 (i.e HD\_FDD UE are performing test on FDD band)
  ----------- ----------------------------------------------------------------------------------------

Table 7.1.1.3.12.3.3-4: *DMRS-UplinkConfig (Table 7.1.1.3.12.3.3-3)*

  --------------------------------------------------------
  Derivation Path: TS 38.**508-1 \[4\],** Table 4.6.3-51
  --------------------------------------------------------

##### 7.1.1.3.13 Logical channel prioritization handling with Mapping restrictions / physical layer priority

##### 7.1.1.3.13.1 Test Purpose (TP) {#test-purpose-tp-12 .H6}

##### (1) {#section-46 .H6}

**with** {UE in RRC\_CONNECTED state with allowedPHY-PriorityIndex
configured}

**ensure that** {

**when** { UE is scheduled by DCI including priority indicator}

**then** { UE serves the logical channels according to their priority
and configured PHY priority}

}

##### 7.1.1.3.1.2 Conformance requirements {#conformance-requirements-12 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.331, clause 6.3.2, TS 38.321, clause 5.4.3.1.2,
5.4.3.1.3, TS 38.213 clause 9, TS 38.212 clause 7.3.1.1.3. Unless
otherwise stated these are Rel-16 requirements.

\[TS 38.331, clause 6.3.2\]

+----------------------------------------------------------------------+
| ***allowedPHY-PriorityIndex***                                       |
|                                                                      |
| This restriction applies only when the UL grant is a dynamic grant.  |
| If the field is present and the dynamic grant has a PHY-priority     |
| index, UL MAC SDUs from this logical channel can only be mapped to   |
| the dynamic grants indicating PHY-priority index equal to the values |
| configured by this field. If the field is present and the dynamic    |
| grant does not have a PHY-priority index, UL MAC SDUs from this      |
| logical channel can only be mapped to this dynamic grant if the      |
| value of the field is *p0*, see TS 38.213 \[13\], clause 9. If the   |
| field is not present, UL MAC SDUs from this logical channel can be   |
| mapped to any dynamic grants. Corresponds to                         |
| \"allowedPHY-PriorityIndex\" as specified in TS 38.321 \[3\].        |
+----------------------------------------------------------------------+

\[TS 38.321, clause 5.4.3.1.2\]

The MAC entity shall, when a new transmission is performed:

1\> select the logical channels for each UL grant that satisfy all the
following conditions:

2\> the set of allowed Subcarrier Spacing index values in
*allowedSCS-List*, if configured, includes the Subcarrier Spacing index
associated to the UL grant; and

2\> *maxPUSCH-Duration*, if configured, is larger than or equal to the
PUSCH transmission duration associated to the UL grant; and

2\> *configuredGrantType1Allowed*, if configured, is set to *true* in
case the UL grant is a Configured Grant Type 1; and

2\> *allowedServingCells*, if configured, includes the Cell information
associated to the UL grant. Does not apply to logical channels
associated with a DRB configured with PDCP duplication within the same
MAC entity (i.e. CA duplication) when CA duplication is deactivated for
this DRB in this MAC entity; and

2\> *allowedCG-List*, if configured, includes the configured grant index
associated to the UL grant; and

2\> *allowedPHY-PriorityIndex*, if configured, includes the priority
index (as specified in clause 9 of TS 38.213 \[6\]) associated to the
dynamic UL grant.

NOTE: The Subcarrier Spacing index, PUSCH transmission duration, Cell
information, and priority index are included in Uplink transmission
information received from lower layers for the corresponding scheduled
uplink transmission.

\[TS 38.321, clause 5.4.3.1.3\]

Before the successful completion of the Random Access procedure
initiated for DAPS handover, the target MAC entity shall not select the
logical channel(s) corresponding to non-DAPS DRB(s) for the uplink grant
received in a Random Access Response or the uplink grant for the
transmission of the MSGA payload.

The MAC entity shall, when a new transmission is performed:

1\> allocate resources to the logical channels as follows:

2\> logical channels selected in clause 5.4.3.1.2 for the UL grant with
*Bj* \> 0 are allocated resources in a decreasing priority order. If the
PBR of a logical channel is set to *infinity*, the MAC entity shall
allocate resources for all the data that is available for transmission
on the logical channel before meeting the PBR of the lower priority
logical channel(s);

2\> decrement *Bj* by the total size of MAC SDUs served to logical
channel *j* above;

2\> if any resources remain, all the logical channels selected in clause
5.4.3.1.2 are served in a strict decreasing priority order (regardless
of the value of *Bj*) until either the data for that logical channel or
the UL grant is exhausted, whichever comes first. Logical channels
configured with equal priority should be served equally.

NOTE 1: The value of *Bj* can be negative.

If the MAC entity is requested to simultaneously transmit multiple MAC
PDUs, or if the MAC entity receives the multiple UL grants within one or
more coinciding PDCCH occasions (i.e. on different Serving Cells), it is
up to UE implementation in which order the grants are processed.

The UE shall also follow the rules below during the scheduling
procedures above:

\- the UE should not segment an RLC SDU (or partially transmitted SDU or
retransmitted RLC PDU) if the whole SDU (or partially transmitted SDU or
retransmitted RLC PDU) fits into the remaining resources of the
associated MAC entity;

\- if the UE segments an RLC SDU from the logical channel, it shall
maximize the size of the segment to fill the grant of the associated MAC
entity as much as possible;

\- the UE should maximise the transmission of data;

\- if the MAC entity is given a UL grant size that is equal to or larger
than 8 bytes while having data available and allowed (according to
clause 5.4.3.1) for transmission, the MAC entity shall not transmit only
padding BSR and/or padding.

The MAC entity shall:

1\> if the MAC entity is configured with *enhancedSkipUplinkTxDynamic*
with value *true* and the grant indicated to the HARQ entity was
addressed to a C-RNTI, or if the MAC entity is configured with
*enhancedSkipUplinkTxConfigured* with value *true* and the grant
indicated to the HARQ entity is a configured uplink grant; and

1\> if the MAC entity is not configured with *lch-basedPrioritization*;
and

1\> if there is no UCI to be multiplexed on this PUSCH transmission as
specified in TS 38.213 \[6\]; and

1\> if there is no aperiodic CSI requested for this PUSCH transmission
as specified in TS 38.212 \[9\]; and

1\> if the MAC PDU includes zero MAC SDUs; and

1\> if the MAC PDU includes only the periodic BSR and there is no data
available for any LCG, or the MAC PDU includes only the padding BSR:

2\> not generate a MAC PDU for the HARQ entity.

1\> else if the MAC entity is configured with *skipUplinkTxDynamic* with
value *true* and the grant indicated to the HARQ entity was addressed to
a C-RNTI, or the grant indicated to the HARQ entity is a configured
uplink grant; and

1\> if there is no aperiodic CSI requested for this PUSCH transmission
as specified in TS 38.212 \[9\]; and

1\> if the MAC PDU includes zero MAC SDUs; and

1\> if the MAC PDU includes only the periodic BSR and there is no data
available for any LCG, or the MAC PDU includes only the padding BSR:

2\> not generate a MAC PDU for the HARQ entity.

Logical channels shall be prioritised in accordance with the following
order (highest priority listed first):

\- C-RNTI MAC CE or data from UL-CCCH;

\- Configured Grant Confirmation MAC CE or BFR MAC CE or Multiple Entry
Configured Grant Confirmation MAC CE;

\- Sidelink Configured Grant Confirmation MAC CE;

\- LBT failure MAC CE;

\- MAC CE for SL-BSR prioritized according to clause 5.22.1.6;

\- MAC CE for BSR, with exception of BSR included for padding;

\- Single Entry PHR MAC CE or Multiple Entry PHR MAC CE;

\- MAC CE for the number of Desired Guard Symbols;

\- MAC CE for Pre-emptive BSR;

\- MAC CE for SL-BSR, with exception of SL-BSR prioritized according to
clause 5.22.1.6 and SL-BSR included for padding;

\- data from any Logical Channel, except data from UL-CCCH;

\- MAC CE for Recommended bit rate query;

\- MAC CE for BSR included for padding;

\- MAC CE for SL-BSR included for padding.

NOTE 2: Prioritization among Configured Grant Confirmation MAC CE,
Multiple Entry Configured Grant Confirmation MAC CE, and BFR MAC CE is
up to UE implementation.

The MAC entity shall prioritize any MAC CE listed in a higher order than
\'data from any Logical Channel, except data from UL-CCCH\' over
transmission of NR sidelink communication.

\[TS 38.213, clause 9\]

A PUSCH or a PUCCH transmission, including repetitions if any, can be of
priority index 0 or of priority index 1. For a configured grant PUSCH
transmission, a UE determines a priority index from *phy-PriorityIndex*,
if provided. For a PUCCH transmission with HARQ-ACK information
corresponding to a SPS PDSCH reception or a SPS PDSCH release, a UE
determines a priority index from *harq-CodebookID*, if provided. For a
PUCCH transmission with SR, a UE determines the corresponding priority
as described in Clause 9.2.4. For a PUSCH transmission with
semi-persistent CSI report, a UE determines a priority index from a
priority indicator field, if provided, inÂ a DCI format that activates
the semi-persistent CSIÂ report. If a priority index is not provided to a
UE for a PUSCH or a PUCCH transmission, the priority index is 0.

##### 7.1.1.3.13.3 Test description {#test-description-12 .H6}

##### 7.1.1.3.13.3.1 Pre-test conditions {#pre-test-conditions-12 .H6}

Same Pre-test conditions as in clause 7.1.1.0 with the exception of 3 UM
bearers configured according to Table 7.1.1.3.13.3.1-1.

Table 7.1.1.3.13.3.1-1: Priority, PBR and Bucket Delay settings

  DRB    priority   prioritisedBitRate (kbytes/s)   bucketSizeDuration (ms)   allowedPHY-PriorityIndex-r16
  ------ ---------- ------------------------------- ------------------------- ------------------------------
  DRB1   6          infinity                        100                       p0
  DRB2   7          infinity                        100                       p1
  DRB3   8          infinity                        100                       p1

##### 7.1.1.3.13.3.2 Test procedure sequence {#test-procedure-sequence-12 .H6}

Table 7.1.1.3.13.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
|           |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 0A        | SS        | \<\--     | (NR RRC:  | \-      | \- |
|           | transmits |           | *RR       |         |    |
|           | NR        |           | CReconfig |         |    |
|           | *R        |           | uration*) |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to enable |           |           |         |    |
|           | DCI       |           |           |         |    |
|           | priority  |           |           |         |    |
|           | indicator |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 0B        | The UE    | \--\>     | (NR RRC:  | \-      | \- |
|           | transmits |           | *R        |         |    |
|           | NR        |           | RCReconfi |         |    |
|           | *         |           | gurationC |         |    |
|           | RRCReconf |           | omplete*) |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message.  |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\--     | (RLC      | \-      | \- |
|           | transmits |           | SDUs)     |         |    |
|           | 2 equal   |           |           |         |    |
|           | size RLC  |           |           |         |    |
|           | SDUs each |           |           |         |    |
|           | on DRB1,  |           |           |         |    |
|           | DRB2,     |           |           |         |    |
|           | DRB3.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The SS is | \<\--     | (UL       | \-      | \- |
|           | c         |           | grants)   |         |    |
|           | onfigured |           |           |         |    |
|           | for       |           |           |         |    |
|           | Uplink    |           |           |         |    |
|           | Grant     |           |           |         |    |
|           | A         |           |           |         |    |
|           | llocation |           |           |         |    |
|           | Type 2 as |           |           |         |    |
|           | defined   |           |           |         |    |
|           | in TS     |           |           |         |    |
|           | 38.523-3  |           |           |         |    |
|           | \[3\].    |           |           |         |    |
|           | 100 ms    |           |           |         |    |
|           | after     |           |           |         |    |
|           | Step 1    |           |           |         |    |
|           | (Note1),  |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | 4 UL      |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | suitable  |           |           |         |    |
|           | size to   |           |           |         |    |
|           | receive   |           |           |         |    |
|           | one loop  |           |           |         |    |
|           | back RLC  |           |           |         |    |
|           | SDU on    |           |           |         |    |
|           | one       |           |           |         |    |
|           | logical   |           |           |         |    |
|           | channel   |           |           |         |    |
|           | every 20  |           |           |         |    |
|           | ms with   |           |           |         |    |
|           | Priority  |           |           |         |    |
|           | indicator |           |           |         |    |
|           | =1        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           | (c        |         |    |
|           | UE        |           | ontaining |         |    |
|           | transmit  |           | 1 MAC sub |         |    |
|           | a MAC PDU |           | PDU       |         |    |
|           | c         |           | c         |         |    |
|           | ontaining |           | ontaining |         |    |
|           | MAC Sub   |           | RLC SDU)  |         |    |
|           | PDU       |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a RLC SDU |           |           |         |    |
|           | on DRB2?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           | (c        |         |    |
|           | UE        |           | ontaining |         |    |
|           | transmit  |           | 1 MAC sub |         |    |
|           | a MAC PDU |           | PDU       |         |    |
|           | c         |           | c         |         |    |
|           | ontaining |           | ontaining |         |    |
|           | MAC Sub   |           | RLC SDU)  |         |    |
|           | PDU       |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a RLC SDU |           |           |         |    |
|           | on DRB2?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           | (c        |         |    |
|           | UE        |           | ontaining |         |    |
|           | transmit  |           | 1 MAC sub |         |    |
|           | a MAC PDU |           | PDU       |         |    |
|           | c         |           | c         |         |    |
|           | ontaining |           | ontaining |         |    |
|           | MAC Sub   |           | RLC SDU)  |         |    |
|           | PDU       |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a RLC SDU |           |           |         |    |
|           | on DRB1?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           | (c        |         |    |
|           | UE        |           | ontaining |         |    |
|           | transmit  |           | 1 MAC sub |         |    |
|           | a MAC PDU |           | PDU       |         |    |
|           | c         |           | c         |         |    |
|           | ontaining |           | ontaining |         |    |
|           | MAC Sub   |           | RLC SDU)  |         |    |
|           | PDU       |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a RLC SDU |           |           |         |    |
|           | on DRB1?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The SS is | \<\--     | (UL       | \-      | \- |
|           | c         |           | grants)   |         |    |
|           | onfigured |           |           |         |    |
|           | for       |           |           |         |    |
|           | Uplink    |           |           |         |    |
|           | Grant     |           |           |         |    |
|           | A         |           |           |         |    |
|           | llocation |           |           |         |    |
|           | Type 2 as |           |           |         |    |
|           | defined   |           |           |         |    |
|           | in TS     |           |           |         |    |
|           | 38.523-3  |           |           |         |    |
|           | \[3\].    |           |           |         |    |
|           | 100 ms    |           |           |         |    |
|           | after     |           |           |         |    |
|           | Step 2    |           |           |         |    |
|           | (Note1),  |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | 2 UL      |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | suitable  |           |           |         |    |
|           | size to   |           |           |         |    |
|           | receive   |           |           |         |    |
|           | one loop  |           |           |         |    |
|           | back RLC  |           |           |         |    |
|           | SDU on    |           |           |         |    |
|           | one       |           |           |         |    |
|           | logical   |           |           |         |    |
|           | channel   |           |           |         |    |
|           | every 20  |           |           |         |    |
|           | ms with   |           |           |         |    |
|           | Priority  |           |           |         |    |
|           | in        |           |           |         |    |
|           | dicator=0 |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           | (c        |         |    |
|           | UE        |           | ontaining |         |    |
|           | transmit  |           | 1 MAC sub |         |    |
|           | a MAC PDU |           | PDU       |         |    |
|           | c         |           | c         |         |    |
|           | ontaining |           | ontaining |         |    |
|           | MAC Sub   |           | RLC SDU)  |         |    |
|           | PDU       |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a RLC SDU |           |           |         |    |
|           | on DRB1?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           | (c        |         |    |
|           | UE        |           | ontaining |         |    |
|           | transmit  |           | 1 MAC sub |         |    |
|           | a MAC PDU |           | PDU       |         |    |
|           | c         |           | c         |         |    |
|           | ontaining |           | ontaining |         |    |
|           | MAC Sub   |           | RLC SDU)  |         |    |
|           | PDU       |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a RLC SDU |           |           |         |    |
|           | on DRB1?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| This wait |           |           |           |         |    |
| time will |           |           |           |         |    |
| ensure    |           |           |           |         |    |
| that a)   |           |           |           |         |    |
| all       |           |           |           |         |    |
| octets    |           |           |           |         |    |
| have been |           |           |           |         |    |
| c         |           |           |           |         |    |
| ompletely |           |           |           |         |    |
| received  |           |           |           |         |    |
| by the UE |           |           |           |         |    |
| on all 3  |           |           |           |         |    |
| DRBs      |           |           |           |         |    |
| before    |           |           |           |         |    |
| the first |           |           |           |         |    |
| UL grant  |           |           |           |         |    |
| is        |           |           |           |         |    |
| received  |           |           |           |         |    |
| and b)    |           |           |           |         |    |
| the Bjs   |           |           |           |         |    |
| for each  |           |           |           |         |    |
| logical   |           |           |           |         |    |
| channel   |           |           |           |         |    |
| have      |           |           |           |         |    |
| reached   |           |           |           |         |    |
| their     |           |           |           |         |    |
| maximum   |           |           |           |         |    |
| value     |           |           |           |         |    |
| i.e. the  |           |           |           |         |    |
| bucket    |           |           |           |         |    |
| size of   |           |           |           |         |    |
| the       |           |           |           |         |    |
| corr      |           |           |           |         |    |
| esponding |           |           |           |         |    |
| logical   |           |           |           |         |    |
| channel   |           |           |           |         |    |
| before    |           |           |           |         |    |
| the first |           |           |           |         |    |
| UL grant  |           |           |           |         |    |
| is        |           |           |           |         |    |
| received. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| 36.508    |           |           |           |         |    |
| \[7\],    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 4.6.1-8   |           |           |           |         |    |
| using     |           |           |           |         |    |
| condition |           |           |           |         |    |
| EN-DC\_   |           |           |           |         |    |
| EmbedNR\_ |           |           |           |         |    |
| RRCRecon. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *         |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RR       |           |           |           |         |    |
| CConnecti |           |           |           |         |    |
| onReconfi |           |           |           |         |    |
| gurationC |           |           |           |         |    |
| omplete.* |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.3.13.3.3 Specific message contents {#specific-message-contents-12 .H6}

Table 7.1.1.3.13.3.3-1: SchedulingRequest-Config (Preamble)

  -------------------------------------------------- -------------- --------- -----------
  Derivation Path: 38.508-1 \[4\], Table 4.6.3-155                            
  Information Element                                Value/remark   Comment   Condition
  sr-TransMax                                        n64                      
  -------------------------------------------------- -------------- --------- -----------

##### 7.1.1.3.14 Correct Handling of UL HARQ process / PUSCH Repetition Type A enhancement

###### 7.1.1.3.14.1 Correct Handling of UL HARQ process / PUSCH Repetition Type A enhancement / Increased maximum repetition number / dynamic grant

7.1.1.3.14.1.1 Test Purpose (TP)

##### (1) {#section-47 .H6}

**with** { UE in RRC\_CONNECTED state and supporting dynamic indication
of increased maximum number of PUSCH Type A repetitions.}

**ensure that** {

**when** { UE has data available for transmission, UE receives an UL
Grant with toggled NDI which also indicates numberOfRepetitionsExt-r17
\> 16 }

**then** { UE transmits a new MAC PDU and repeats sending the MAC PDU in
the next *numberOfRepetitionsExt-r17*-1 slots after first transmission
and selects the redundancy version correctly }

}

7.1.1.3.14.1.2 Conformance requirements

References: The conformance requirements covered in the present TC are
specified in: TS 38.214 clauses 6.1.2.1 and 6.1.4, TS 38.321 clauses
5.4.1, 5.4.2.1 and 5.4.2.2. Unless otherwise stated these are Rel-17
requirements.

\[TS 38.214, clause 6.1.2.1\]

When the UE is scheduled to transmit a transport block and no CSI report
by a DCI or by a RAR UL grant or fallbackRAR UL grant, or the UE is
scheduled to transmit a transport block and a CSI report(s) on PUSCH by
a DCI, the \'*Time domain resource assignment\'* field value *m* of the
DCI or the *PUSCH time resource allocation* field value *m* of the RAR
UL grant or of the fallbackRAR UL grant provides a row index *m* + 1 to
an allocated table. The determination of the used resource allocation
table is defined in Clause 6.1.2.1.1. The indexed row defines the slot
offset *K~2~*, the start and length indicator *SLIV*, or directly the
start symbol *S* and the allocation length *L*, the PUSCH mapping type,
the number of slots used for TBS determination (if *numberOfSlotsTBoMS*
is present in the resource allocation table), and the number of
repetitions (if *numberOfRepetitions* is present in the resource
allocation table) to be applied in the PUSCH transmission.

...

The UE shall consider the *S* and *L* combinations defined in table
6.1.2.1-1 as valid PUSCH allocations

Table 6.1.2.1-1: Valid *S* and *L* combinations

  PUSCH mapping type                Normal cyclic prefix   Extended cyclic prefix                                                                                                   
  --------------------------------- ---------------------- ------------------------ -------------------------------------------------------------------- ------------- ------------ --------------------------------------------------------------------
                                    *S*                    *L*                      *S+L*                                                                *S*           *L*          *S+L*
  Type A (repetition Type A only)   0                      {4,...,14}               {4,...,14}                                                           0             {4,...,12}   {4,...,12}
  Type B                            {0,...,13}             {1,...,14}               {1,...,14} for repetition Type A, {1,...,27} for repetition Type B   {0,..., 11}   {1,...,12}   {1,...,12} for repetition Type A, {1,...,23} for repetition Type B

...

For PUSCH repetition Type A, when transmitting PUSCH scheduled by DCI
format 0\_1 or 0\_2 in PDCCH with CRC scrambled with C-RNTI, MCS-C-RNTI,
or CS-RNTI with NDI=1, the number of repetitions *K* is determined as

\- if *numberOfRepetitions* is present in the resource allocation table,
the number of repetitions K is equal to *numberOfRepetitions*;

\- elseif the UE is configured with *pusch-AggregationFactor*, the
number of repetitions *K* is equal to *pusch-AggregationFactor*;

\- otherwise *K=1*.

\- the number of slots used for TBS determination *N* is equal to 1.

...

For unpaired spectrum:

\- Otherwise, the UE determines
![](./media/image41.png)![](./media/image41.png) consecutive slots for a
PUSCH transmission of a PUSCH repetition type A scheduled by DCI format
0\_1 or 0\_2, based on the TDRA information field value in the DCI
format 0\_1 or 0\_2.

> ...

For paired spectrum and SUL band:

\- The UE determines ![](./media/image41.png)![](./media/image41.png)
consecutive slots for a PUSCH transmission of a PUSCH repetition type A
scheduled by DCI format 0\_1 or 0\_2, or for a PUSCH transmission of TB
processing over multiple slots scheduled by DCI format 0\_1 or 0\_2,
based on the TDRA information field value in the DCI format 0\_1 or
0\_2.

...

For PUSCH repetition Type A, in case *K\>1,*

\- If the PUSCH is scheduled by DCI format 0\_1 or 0\_2

...

\- Otherwise, *t*he same symbol allocation is applied across the
![](./media/image41.png)![](./media/image41.png) consecutive slots and
the PUSCH is limited to a single transmission layer. The UE shall repeat
the TB across the ![](./media/image41.png)![](./media/image41.png)
consecutive slots applying the same symbol allocation in each slot.

...

For a PUSCH transmission scheduled by DCI format 0\_1, or 0\_2, or 0\_0
with CRC scrambled by TC-RNTI, the redundancy version to be applied on
the *n*th transmission occasion of the TB, where n = 0, 1, ...
![](./media/image41.png)![](./media/image41.png) -1, is determined
according to table 6.1.2.1-2.

...

Table 6.1.2.1-2: Redundancy version for PUSCH transmission

  *rv~id\ ~*indicated by the DCI scheduling the PUSCH   *rv~id~* to be applied to *n*^th^ transmission occasion (repetition Type A) or TB processing over multiple slots) or *n*^th^ actual repetition (repetition Type B)                                                                   
  ----------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------------------------- ------------------------------- -------------------------------
                                                        *((n-(n mod N))/N)* mod 4 = 0                                                                                                                                        *((n-(n mod N))/N)* mod 4 = 1   *((n-(n mod N))/N)* mod 4 = 2   *((n-(n mod N))/N)* mod 4 = 3
  0                                                     0                                                                                                                                                                    2                               3                               1
  2                                                     2                                                                                                                                                                    3                               1                               0
  3                                                     3                                                                                                                                                                    1                               0                               2
  1                                                     1                                                                                                                                                                    0                               2                               3

For PUSCH repetition Type A and TB processing over multiple slots, a
PUSCH transmission in a slot of a multi-slot PUSCH transmission is
omitted according to the conditions in Clause 9, Clause 11.1, Clause
11.2A, Clause 15 and Clause 17.2 of \[6, TS 38.213\].

\[TS 38.214, clause 6.1.4\]

To determine the modulation order, target code rate, redundancy version
and transport block size for the physical uplink shared channel, the UE
shall first

> \- read the 5-bit modulation and coding scheme field
> ![](./media/image22.wmf)in the DCI to determine the modulation order
> ![](./media/image23.wmf) and target code rate (*R*) based on the
> procedure defined in Subclause 6.1.4.1
>
> \- read redundancy version field (*rv*) in the DCI to determine the
> redundancy version, and
>
> \- \[check the \"CSI request\" bit field\]

and second

> \- the UE shall use the number of layers ![](./media/image24.wmf), the
> total number of allocated PRBs ![](./media/image25.wmf) to determine
> the transport block size based on the procedure defined in Subclause
> 6.1.4.2.

\[TS 38.321, clause 5.4.1\]

Uplink grant is either received dynamically on the PDCCH, in a Random
Access Response, configured semi-persistently by RRC or determined to be
associated with the PUSCH resource of MSGA as specified in clause
5.1.2a. The MAC entity shall have an uplink grant to transmit on the
UL-SCH. To perform the requested transmissions, the MAC layer receives
HARQ information from lower layers. An uplink grant addressed to CS-RNTI
with NDI = 0 is considered as a configured uplink grant. An uplink grant
addressed to CS-RNTI with NDI = 1 is considered as a dynamic uplink
grant.

If the MAC entity has a C-RNTI, a Temporary C-RNTI, or CS-RNTI, the MAC
entity shall for each PDCCH occasion and for each Serving Cell belonging
to a TAG that has a running *timeAlignmentTimer* or a running
*cg-SDT-TimeAlignmentTimer* and for each grant received for this PDCCH
occasion:

1\> if an uplink grant for this Serving Cell has been received on the
PDCCH for the MAC entity\'s C-RNTI or Temporary C-RNTI; or

...

2\> if the uplink grant is for MAC entity\'s C-RNTI and if the previous
uplink grant delivered to the HARQ entity for the same HARQ process was
either an uplink grant received for the MAC entity\'s CS-RNTI or a
configured uplink grant:

3\> consider the NDI to have been toggled for the corresponding HARQ
process regardless of the value of the NDI.

...

2\> deliver the uplink grant and the associated HARQ information to the
HARQ entity.

...

\[TS 38.321, clause 5.4.2.1\]

The MAC entity includes a HARQ entity for each Serving Cell with
configured uplink (including the case when it is configured with
*supplementaryUplink*), which maintains a number of parallel HARQ
processes.

The number of parallel UL HARQ processes per HARQ entity is specified in
TS 38.214 \[7\].

Each HARQ process supports one TB.

Each HARQ process is associated with a HARQ process identifier. For UL
transmission with UL grant in RA Response or for UL transmission for
MSGA payload, HARQ process identifier 0 is used.

...

The maximum number of transmissions of a TB within a bundle of the
dynamic grant or configured grant or the uplink grant received in a MAC
RAR is given by *REPETITION\_NUMBER* as follows:

> \- For a dynamic grant, *REPETITION\_NUMBER* is set to a value
> provided by lower layers, as specified in clause 6.1.2.1 of TS 38.214
> \[7\];
>
> ...

If *REPETITION\_NUMBER* \> 1, after the first transmission within a
bundle, at most *REPETITION\_NUMBER* -- 1 HARQ retransmissions follow
within the bundle. For both dynamic grant and configured uplink grant,
and uplink grant received in a MAC RAR bundling operation relies on the
HARQ entity for invoking the same HARQ process for each transmission
that is part of the same bundle. Within a bundle, HARQ retransmissions
are triggered without waiting for feedback from previous transmission
according to *REPETITION\_NUMBER* for a dynamic grant or configured
uplink grant or uplink grant received in a MAC RAR unless they are
terminated as specified in clause 6.1 of TS 38.214 \[7\]. Each
transmission within a bundle is a separate uplink grant delivered to the
HARQ entity.

For each transmission within a bundle of the dynamic grant or uplink
grant received in a MAC RAR, the sequence of redundancy versions is
determined according to clause 6.1.2.1 of TS 38.214 \[7\]. For each
transmission within a bundle of the configured uplink grant, the
sequence of redundancy versions is determined according to clause
6.1.2.3 of TS 38.214 \[7\].

For each uplink grant, the HARQ entity shall:

> 1\> identify the HARQ process associated with this grant, and for each
> identified HARQ process:
>
> 2\> if the received grant was not addressed to a Temporary C-RNTI on
> PDCCH, and the NDI provided in the associated HARQ information has
> been toggled compared to the value in the previous transmission of
> this TB of this HARQ process; or
>
> ...
>
> 3\> if a MAC PDU to transmit has been obtained:
>
> 4\> if the uplink grant is not a configured grant configured with
> *autonomousTx*; or
>
> 4\> if the uplink grant is a prioritized uplink grant:
>
> 5\> deliver the MAC PDU and the uplink grant and the HARQ information
> of the TB to the identified HARQ process;
>
> 5\> instruct the identified HARQ process to trigger a new
> transmission;
>
> ...
>
> 2\> else (i.e. retransmission):
>
> ...
>
> 3\> else:
>
> 4\> deliver the uplink grant and the HARQ information (redundancy
> version) of the TB to the identified HARQ process;
>
> 4\> instruct the identified HARQ process to trigger a retransmission;
>
> ....

\[TS 38.321, clause 5.4.2.2\]

Each HARQ process is associated with a HARQ buffer.

New transmissions are performed on the resource and with the MCS
indicated on PDCCH or indicated in the Random Access Response (i.e. MAC
RAR or fallbackRAR), or signalled in RRC or determined as specified in
clause 5.1.2a for MSGA payload. Retransmissions are performed on the
resource and, if provided, with the MCS indicated on PDCCH, or on the
same resource and with the same MCS as was used for last made
transmission attempt within a bundle, or on stored configured uplink
grant resources and stored MCS when *cg-RetransmissionTimer* or
*cg-SDT-RetransmissionTimer* is configured. If *cg-RetransmissionTimer*
is configured, retransmissions with the same HARQ process may be
performed on any configured grant configuration if the configured grant
configurations have the same TBS. If *cg-SDT-RetransmissionTimer* is
configured, retransmission for the initial CG-SDT transmission with the
same HARQ process may be performed on any configured grant configuration
if the configured grant configurations have the same TBS.

...

If the HARQ entity requests a new transmission for a TB, the HARQ
process shall:

1\> store the MAC PDU in the associated HARQ buffer;

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

If the HARQ entity requests a retransmission for a TB, the HARQ process
shall:

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

To generate a transmission for a TB, the HARQ process shall:

...

1\> if there is no measurement gap at the time of the transmission and,
in case of retransmission, the retransmission does not collide with a
transmission for a MAC PDU obtained from the Msg3 buffer or the MSGA
buffer:

2\> if there are neither NR sidelink transmission nor transmission of
V2X sidelink communication at the time of the transmission; or

...

3\> instruct the physical layer to generate a transmission according to
the stored uplink grant.

...

7.1.1.3.14.1.3 Test description

7.1.1.3.14.1.3.1 Pre-test conditions

Same Pre-test conditions as in clause 7.1.1.0 except that DRB is
configured in RLC AM mode according to Table 7.1.1.3.14.1.3.1-1.

**Table 7.1.1.3.14.1.3.1-1: RLC parameters**

  -------------------- ------
  *t-PollRetransmit*   ms80
  -------------------- ------

7.1.1.3.14.1.3.2 Test procedure sequence

**Table 7.1.1.3.14.1.3.2-1: Main behaviour**

+--------+------------+------------+------------+------------+----+
| **St** | **P        | **Message  | **TP**     | *          |    |
|        | rocedure** | Sequence** |            | *Verdict** |    |
+========+============+============+============+============+====+
|        |            | **U - S**  | *          |            |    |
|        |            |            | *Message** |            |    |
+--------+------------+------------+------------+------------+----+
| 1      | SS         | \<\-\--    | NR RRC:    | \-         | \- |
|        | transmits  |            | *RRCReconf |            |    |
|        | an         |            | iguration* |            |    |
|        | RRCRecon   |            |            |            |    |
|        | figuration |            |            |            |    |
|        | message to |            |            |            |    |
|        | config     |            |            |            |    |
|        | PUSCH TDRA |            |            |            |    |
|        | table      |            |            |            |    |
|        | including  |            |            |            |    |
|        | numberO    |            |            |            |    |
|        | fRepetitio |            |            |            |    |
|        | nsExt-r17. |            |            |            |    |
|        |            |            |            |            |    |
|        | NOTE: For  |            |            |            |    |
|        | EN-DC. the |            |            |            |    |
|        | RRCRecon   |            |            |            |    |
|        | figuration |            |            |            |    |
|        | message is |            |            |            |    |
|        | embedded   |            |            |            |    |
|        | in         |            |            |            |    |
|        | RRCConne   |            |            |            |    |
|        | ctionRecon |            |            |            |    |
|        | figuration |            |            |            |    |
|        | specified  |            |            |            |    |
|        | in 36.508  |            |            |            |    |
|        | \[7\]      |            |            |            |    |
|        | Table      |            |            |            |    |
|        | 4.6.1-8    |            |            |            |    |
|        | with       |            |            |            |    |
|        | condition  |            |            |            |    |
|        | EN-DC      |            |            |            |    |
|        | \_EmbedNR\ |            |            |            |    |
|        | _RRCRecon. |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 2      | UE         | \--\>      | NR RRC:    | \-         | \- |
|        | transmits  |            | *RRCReco   |            |    |
|        | an         |            | nfiguratio |            |    |
|        | RRCRec     |            | nComplete* |            |    |
|        | onfigurati |            |            |            |    |
|        | onComplete |            |            |            |    |
|        | message.   |            |            |            |    |
|        |            |            |            |            |    |
|        | NOTE: For  |            |            |            |    |
|        | EN-DC, the |            |            |            |    |
|        | RRCRec     |            |            |            |    |
|        | onfigurati |            |            |            |    |
|        | onComplete |            |            |            |    |
|        | message is |            |            |            |    |
|        | embedded   |            |            |            |    |
|        | in         |            |            |            |    |
|        | RRCCon     |            |            |            |    |
|        | nectionRec |            |            |            |    |
|        | onfigurati |            |            |            |    |
|        | onComplete |            |            |            |    |
|        | specified  |            |            |            |    |
|        | in 36.508  |            |            |            |    |
|        | \[7\]      |            |            |            |    |
|        | Table      |            |            |            |    |
|        | 4.6.1-9    |            |            |            |    |
|        | with       |            |            |            |    |
|        | condition  |            |            |            |    |
|        | MCG        |            |            |            |    |
|        | \_and\_SCG |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 3      | The SS     | \<\-\--    | MAC PDU    | \-         | \- |
|        | transmits  |            |            |            |    |
|        | a valid    |            |            |            |    |
|        | MAC PDU    |            |            |            |    |
|        | containing |            |            |            |    |
|        | one RLC    |            |            |            |    |
|        | PDU.       |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 4      | The UE     | \--\>      | Scheduling | \-         | \- |
|        | transmits  |            | Request    |            |    |
|        | a          |            |            |            |    |
|        | Scheduling |            |            |            |    |
|        | Request.   |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 5      | The SS     | \<\--      | DCI format | \-         | \- |
|        | allocates  |            | 0\_1       |            |    |
|        | an UL      |            |            |            |    |
|        | Grant      |            |            |            |    |
|        | which      |            |            |            |    |
|        | satisfies  |            |            |            |    |
|        | following  |            |            |            |    |
|        | c          |            |            |            |    |
|        | onditions: |            |            |            |    |
|        |            |            |            |            |    |
|        | \-         |            |            |            |    |
|        | sufficient |            |            |            |    |
|        | to         |            |            |            |    |
|        | transmit   |            |            |            |    |
|        | the MAC    |            |            |            |    |
|        | SDU to     |            |            |            |    |
|        | loop back  |            |            |            |    |
|        | in a slot  |            |            |            |    |
|        | (denote as |            |            |            |    |
|        | slot       |            |            |            |    |
|        | n~1~);     |            |            |            |    |
|        |            |            |            |            |    |
|        | \- HARQ    |            |            |            |    |
|        | process    |            |            |            |    |
|        | number     |            |            |            |    |
|        | indicates  |            |            |            |    |
|        | HARQ       |            |            |            |    |
|        | process    |            |            |            |    |
|        | \#1;       |            |            |            |    |
|        |            |            |            |            |    |
|        | \- NDI     |            |            |            |    |
|        | indicates  |            |            |            |    |
|        | new        |            |            |            |    |
|        | tra        |            |            |            |    |
|        | nsmission; |            |            |            |    |
|        |            |            |            |            |    |
|        | \- RV      |            |            |            |    |
|        | indicates  |            |            |            |    |
|        | rv^ID^ =   |            |            |            |    |
|        | 0;         |            |            |            |    |
|        |            |            |            |            |    |
|        | \- TDRA    |            |            |            |    |
|        | indicates  |            |            |            |    |
|        | the 1st    |            |            |            |    |
|        | entry in   |            |            |            |    |
|        | pusch-Time |            |            |            |    |
|        | DomainAllo |            |            |            |    |
|        | cationList |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 6      | Check:     | \--\>      | MAC PDU    | 1          | P  |
|        | Does the   |            |            |            |    |
|        | UE         |            |            |            |    |
|        | transmit a |            |            |            |    |
|        | MAC PDU    |            |            |            |    |
|        | including  |            |            |            |    |
|        | one RLC    |            |            |            |    |
|        | SDU, in    |            |            |            |    |
|        | HARQ       |            |            |            |    |
|        | process 1  |            |            |            |    |
|        | and in     |            |            |            |    |
|        | slot       |            |            |            |    |
|        | n~1~+4 and |            |            |            |    |
|        | repeat     |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmitting |            |            |            |    |
|        | this MAC   |            |            |            |    |
|        | PDU in     |            |            |            |    |
|        | every slot |            |            |            |    |
|        | which is   |            |            |            |    |
|        | suitable   |            |            |            |    |
|        | for UL     |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmission |            |            |            |    |
|        | in the     |            |            |            |    |
|        | next       |            |            |            |    |
|        | c          |            |            |            |    |
|        | onsecutive |            |            |            |    |
|        | 19 slots   |            |            |            |    |
|        | with same  |            |            |            |    |
|        | resource   |            |            |            |    |
|        | allocation |            |            |            |    |
|        | but        |            |            |            |    |
|        | different  |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version?   |            |            |            |    |
|        |            |            |            |            |    |
|        | NOTE: The  |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version    |            |            |            |    |
|        | for the    |            |            |            |    |
|        | first      |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmission |            |            |            |    |
|        | and all    |            |            |            |    |
|        | possible   |            |            |            |    |
|        | r          |            |            |            |    |
|        | epetitions |            |            |            |    |
|        | are set in |            |            |            |    |
|        | the        |            |            |            |    |
|        | following  |            |            |            |    |
|        | order {0,  |            |            |            |    |
|        | 2, 3, 1}   |            |            |            |    |
|        | according  |            |            |            |    |
|        | to TS      |            |            |            |    |
|        | 38.214     |            |            |            |    |
|        | \[15\]     |            |            |            |    |
|        | Table      |            |            |            |    |
|        | 6.1.2.1-2, |            |            |            |    |
|        | first row. |            |            |            |    |
|        | Usage of   |            |            |            |    |
|        | correct    |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version is |            |            |            |    |
|        | implicitly |            |            |            |    |
|        | checked    |            |            |            |    |
|        | upon       |            |            |            |    |
|        | correct    |            |            |            |    |
|        | decoding   |            |            |            |    |
|        | by the SS  |            |            |            |    |
|        | of the UE  |            |            |            |    |
|        | UL         |            |            |            |    |
|        | r          |            |            |            |    |
|        | epetitions |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 7      | SS         | \<\--      | MAC PDU    | \-         |    |
|        | transmits  |            | (RLC       |            |    |
|        | a MAC PDU  |            | STATUS     |            |    |
|        | containing |            | PDU)       |            |    |
|        | an RLC     |            |            |            |    |
|        | STATUS PDU |            |            |            |    |
|        | ack        |            |            |            |    |
|        | nowledging |            |            |            |    |
|        | the        |            |            |            |    |
|        | reception  |            |            |            |    |
|        | of the AMD |            |            |            |    |
|        | PDU in     |            |            |            |    |
|        | step 3.    |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 8      | The SS     | \<\-\--    | MAC PDU    | \-         | \- |
|        | transmits  |            |            |            |    |
|        | a valid    |            |            |            |    |
|        | MAC PDU    |            |            |            |    |
|        | containing |            |            |            |    |
|        | one RLC    |            |            |            |    |
|        | PDU.       |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 9      | The UE     | \--\>      | Scheduling | \-         | \- |
|        | transmits  |            | Request    |            |    |
|        | a          |            |            |            |    |
|        | Scheduling |            |            |            |    |
|        | Request.   |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 10     | The SS     | \<\--      | DCI format | \-         | \- |
|        | allocates  |            | 0\_1       |            |    |
|        | an UL      |            |            |            |    |
|        | Grant      |            |            |            |    |
|        | which      |            |            |            |    |
|        | satisfies  |            |            |            |    |
|        | following  |            |            |            |    |
|        | c          |            |            |            |    |
|        | onditions: |            |            |            |    |
|        |            |            |            |            |    |
|        | \-         |            |            |            |    |
|        | sufficient |            |            |            |    |
|        | to         |            |            |            |    |
|        | transmit   |            |            |            |    |
|        | the MAC    |            |            |            |    |
|        | SDU to     |            |            |            |    |
|        | loop back  |            |            |            |    |
|        | in a slot  |            |            |            |    |
|        | (denote as |            |            |            |    |
|        | slot       |            |            |            |    |
|        | n~2~);     |            |            |            |    |
|        |            |            |            |            |    |
|        | \- HARQ    |            |            |            |    |
|        | process    |            |            |            |    |
|        | number     |            |            |            |    |
|        | indicates  |            |            |            |    |
|        | HARQ       |            |            |            |    |
|        | process    |            |            |            |    |
|        | \#1;       |            |            |            |    |
|        |            |            |            |            |    |
|        | \- NDI     |            |            |            |    |
|        | indicates  |            |            |            |    |
|        | new        |            |            |            |    |
|        | tra        |            |            |            |    |
|        | nsmission; |            |            |            |    |
|        |            |            |            |            |    |
|        | \- RV      |            |            |            |    |
|        | indicates  |            |            |            |    |
|        | rv^ID^ =   |            |            |            |    |
|        | 2;         |            |            |            |    |
|        |            |            |            |            |    |
|        | \- TDRA    |            |            |            |    |
|        | indicates  |            |            |            |    |
|        | the 2nd    |            |            |            |    |
|        | entry in   |            |            |            |    |
|        | pusch-Time |            |            |            |    |
|        | DomainAllo |            |            |            |    |
|        | cationList |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 11     | Check:     | \--\>      | MAC PDU    | 1          | P  |
|        | Does the   |            |            |            |    |
|        | UE         |            |            |            |    |
|        | transmit a |            |            |            |    |
|        | MAC PDU    |            |            |            |    |
|        | including  |            |            |            |    |
|        | one RLC    |            |            |            |    |
|        | SDU, in    |            |            |            |    |
|        | HARQ       |            |            |            |    |
|        | process 1  |            |            |            |    |
|        | and in     |            |            |            |    |
|        | slot       |            |            |            |    |
|        | n~2~+4 and |            |            |            |    |
|        | repeat     |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmitting |            |            |            |    |
|        | this MAC   |            |            |            |    |
|        | PDU in     |            |            |            |    |
|        | every slot |            |            |            |    |
|        | which is   |            |            |            |    |
|        | suitable   |            |            |            |    |
|        | for UL     |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmission |            |            |            |    |
|        | in the     |            |            |            |    |
|        | next       |            |            |            |    |
|        | c          |            |            |            |    |
|        | onsecutive |            |            |            |    |
|        | 31 slots   |            |            |            |    |
|        | with same  |            |            |            |    |
|        | resource   |            |            |            |    |
|        | allocation |            |            |            |    |
|        | but        |            |            |            |    |
|        | different  |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version?   |            |            |            |    |
|        |            |            |            |            |    |
|        | NOTE: The  |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version    |            |            |            |    |
|        | for the    |            |            |            |    |
|        | first      |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmission |            |            |            |    |
|        | and all    |            |            |            |    |
|        | possible   |            |            |            |    |
|        | r          |            |            |            |    |
|        | epetitions |            |            |            |    |
|        | are set in |            |            |            |    |
|        | the        |            |            |            |    |
|        | following  |            |            |            |    |
|        | order {2,  |            |            |            |    |
|        | 3, 1, 0}   |            |            |            |    |
|        | according  |            |            |            |    |
|        | to TS      |            |            |            |    |
|        | 38.214     |            |            |            |    |
|        | \[15\]     |            |            |            |    |
|        | Table      |            |            |            |    |
|        | 6.1.2.1-2, |            |            |            |    |
|        | second     |            |            |            |    |
|        | row. Usage |            |            |            |    |
|        | of correct |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version is |            |            |            |    |
|        | implicitly |            |            |            |    |
|        | checked    |            |            |            |    |
|        | upon       |            |            |            |    |
|        | correct    |            |            |            |    |
|        | decoding   |            |            |            |    |
|        | by the SS  |            |            |            |    |
|        | of the UE  |            |            |            |    |
|        | UL         |            |            |            |    |
|        | r          |            |            |            |    |
|        | epetitions |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 12     | SS         | \<\--      | MAC PDU    | \-         |    |
|        | transmits  |            | (RLC       |            |    |
|        | a MAC PDU  |            | STATUS     |            |    |
|        | containing |            | PDU)       |            |    |
|        | an RLC     |            |            |            |    |
|        | STATUS PDU |            |            |            |    |
|        | ack        |            |            |            |    |
|        | nowledging |            |            |            |    |
|        | the        |            |            |            |    |
|        | reception  |            |            |            |    |
|        | of the AMD |            |            |            |    |
|        | PDU in     |            |            |            |    |
|        | step 8.    |            |            |            |    |
+--------+------------+------------+------------+------------+----+

7.1.1.3.14.1.3.3 Specific message contents

**Table 7.1.1.3.14.1.3.3-1: *RRCReconfiguration* (Step 1, Table
7.1.1.3.14.1.3.2-1)**

  Derivation Path: 38.508-1 \[4\], Table 4.6.1-13                                                 
  ------------------------------------------------- ------------------ -------------------------- ---------------
  **Information Element**                           **Value/remark**   **Comment**                **Condition**
  RRCReconfiguration ::= SEQUENCE {                                                               
  criticalExtensions CHOICE {                                                                     
  rrcReconfiguration SEQUENCE {                                                                   
  secondaryCellGroup                                CellGroupConfig    Table 7.1.1.3.14.1.3.3-2   EN-DC
                                                    Not present                                   NR
  nonCriticalExtension                              Not present                                   EN-DC
  nonCriticalExtension SEQUENCE {                                                                 NR
  masterCellGroup                                   CellGroupConfig    Table 7.1.1.3.14.1.3.3-2   
  }                                                                                               
  }                                                                                               
  }                                                                                               
  }                                                                                               

**Table 7.1.1.3.14.1.3.3-2: *CellGroupConfig* (Table
7.1.1.3.14.1.3.3-1)**

  Derivation Path: 38.508-1 \[4\], Table 4.6.3-19                                                    
  ------------------------------------------------- --------------------- -------------------------- ---------------
  **Information Element**                           **Value/remark**      **Comment**                **Condition**
  cellGroupConfig::= SEQUENCE {                                                                      
  cellGroupId                                       0                                                NR
                                                    1                                                EN-DC
  spCellConfig SEQUENCE {                                                                            
  servCellIndex                                     Not present                                      NR
                                                    1                                                EN-DC
  spCellConfigDedicated SEQUENCE {                                                                   
  servingCellConfig                                 *ServingCellConfig*   Table 7.1.1.3.14.1.3.3-3   
  }                                                                                                  
  }                                                                                                  
  }                                                                                                  

**Table 7.1.1.3.14.1.3.3-3: *ServingCellConfig* (Table
7.1.1.3.14.1.3.3-2)**

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167                                                                       
  ----------------------------------------------------- ---------------------------------------- -------------------------- ---------------
  **Information Element**                               **Value/remark**                         **Comment**                **Condition**
  ServingCellConfig ::= SEQUENCE {                                                                                          
  uplinkConfig SEQUENCE {                                                                                                   
  initialUplinkBWP SEQUENCE {                                                                                               
  pusch-Config CHOICE {                                                                                                     
  setup SEQUENCE {                                                                                                          
  pusch-TimeDomainAllocationListDCI-0-1-r16 CHOICE {                                                                        
  setup                                                 PUSCH-TimeDomainResourceAllocationList   Table 7.1.1.3.14.1.3.3-4   
  }                                                                                                                         
  pusch-RepTypeIndicatorDCI-0-1-r16                     pusch-RepTypeA                                                      
  }                                                                                                                         
  }                                                                                                                         
  }                                                                                                                         
  }                                                                                                                         
  }                                                                                                                         

Table 7.1.1.3.14.1.3.3-4: *PUSCH-TimeDomainResourceAllocationList*
(Table 7.1.1.3.14.1.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-122A                                                                                                                
  ------------------------------------------------------------------------------------------------------------------------------------------ -------------- --------- -----------
  Information Element                                                                                                                        Value/remark   Comment   Condition
  PUSCH-TimeDomainResourceAllocationList-r16 ::= SEQUENCE (SIZE(1..maxNrofUL-Allocations-r16)) OF PUSCH-TimeDomainResourceAllocation-r16 {   2 entries                
  PUSCH-TimeDomainResourceAllocation-r16\[1\] SEQUENCE {                                                                                                    entry 1   
  puschAllocationList-r16 SEQUENCE (SIZE(1..maxNrofMultiplePUSCHs-r16)) OF PUSCH-Allocation-r16 {                                            1 entry                  
  PUSCH-Allocation-r16\[1\] SEQUENCE {                                                                                                                      entry 1   
  numberOfRepetitionsExt-r17                                                                                                                 n20                      
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  PUSCH-TimeDomainResourceAllocation-r16\[2\] SEQUENCE {                                                                                                    entry 2   
  puschAllocationList-r16 SEQUENCE (SIZE(1..maxNrofMultiplePUSCHs-r16)) OF PUSCH-Allocation-r16 {                                            1 entry                  
  PUSCH-Allocation-r16\[1\] SEQUENCE {                                                                                                                      entry 1   
  numberOfRepetitionsExt-r17                                                                                                                 n32                      
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  }                                                                                                                                                                   

Table 7.1.1.3.14.1.3.3-5: Physical layer parameters for DCI format 0\_1
(Step 5 & 10, Table 7.1.1.3.14.1.3.2-1)

  Derivation path: TS 38.508-1 \[4\] Table 4.3.6.1.1.2-1                                                                                                         
  -------------------------------------------------------- ----------------------------------------------------------------------------------- ----------------- -----------
  Parameter                                                Value                                                                               Value in binary   Condition
  Time domain resource assignment                          Indicating the 1st entry of pusch-TimeDomainAllocationListDCI-0-1-r16 to be used.   "0"               Step 5
                                                           Indicating the 2nd entry of pusch-TimeDomainAllocationListDCI-0-1-r16 to be used.   "1"               Step 10
  Redundancy version                                       RV \#0 to be used                                                                   "00"              Step 5
                                                           RV \#2 to be used                                                                   "10"              Step 10

###### 7.1.1.3.14.2 Correct Handling of UL HARQ process / PUSCH Repetition Type A enhancement / Increased maximum repetition number / configured grant

7.1.1.3.14.2.1 Test Purpose (TP)

\(1\)

**with** { UE in RRC\_CONNECTED state and supporting configured grant
based transmission with increased maximum number of PUSCH Type A
repetitions.}

**ensure that** {

**when** { UE has data available for transmission and is provided a UL
configured grant with repK-v1710 }

**then** { UE transmits a new MAC PDU and repeats sending the MAC PDU in
the next repK-v1710-1 slots after first transmission and selects the
redundancy version correctly }

}

7.1.1.3.14.2.2 Conformance requirements

References: The conformance requirements covered in the present TC are
specified in: TS 38.214 clauses 6.1.2.1 and 6.1.4, TS 38.321 clauses
5.4.1, 5.4.2.1 and 5.4.2.2. Unless otherwise stated these are Rel-17
requirements.

\[TS 38.214, clause 6.1.2.1\]

...

The UE shall consider the *S* and *L* combinations defined in table
6.1.2.1-1 as valid PUSCH allocations

Table 6.1.2.1-1: Valid *S* and *L* combinations

  PUSCH mapping type                Normal cyclic prefix   Extended cyclic prefix                                                                                                   
  --------------------------------- ---------------------- ------------------------ -------------------------------------------------------------------- ------------- ------------ --------------------------------------------------------------------
                                    *S*                    *L*                      *S+L*                                                                *S*           *L*          *S+L*
  Type A (repetition Type A only)   0                      {4,...,14}               {4,...,14}                                                           0             {4,...,12}   {4,...,12}
  Type B                            {0,...,13}             {1,...,14}               {1,...,14} for repetition Type A, {1,...,27} for repetition Type B   {0,..., 11}   {1,...,12}   {1,...,12} for repetition Type A, {1,...,23} for repetition Type B

...

For unpaired spectrum:

...

\- Otherwise, the UE determines
![](./media/image41.png)![](./media/image41.png) consecutive slots for a
PUSCH transmission of a PUSCH repetition type A scheduled by DCI format
0\_1 or 0\_2, based on the TDRA information field value in the DCI
format 0\_1 or 0\_2.

...

For paired spectrum and SUL band:

\- The UE determines ![](./media/image41.png)![](./media/image41.png)
consecutive slots for a PUSCH transmission of a PUSCH repetition type A
scheduled by DCI format 0\_1 or 0\_2, or for a PUSCH transmission of TB
processing over multiple slots scheduled by DCI format 0\_1 or 0\_2,
based on the TDRA information field value in the DCI format 0\_1 or
0\_2.

...

For PUSCH repetition Type A and TB processing over multiple slots, a
PUSCH transmission in a slot of a multi-slot PUSCH transmission is
omitted according to the conditions in Clause 9, Clause 11.1, Clause
11.2A, Clause 15 and Clause 17.2 of \[6, TS 38.213\].

\[TS 38.214, clause 6.1.2.3\]

When PUSCH resource allocation is semi-statically configured by higher
layer parameter *configuredGrantConfig in BWP-UplinkDedicated
information element*, and the PUSCH transmission corresponding to a
configured grant, the following higher layer parameters are applied in
the transmission:

\- For Type 1 PUSCH transmissions with a configured grant, the following
parameters are given in *configuredGrantConfig* unless mentioned
otherwise:

\- For the determination of the PUSCH repetition type, if the higher
layer parameter *pusch-RepTypeIndicator* in *rrc-ConfiguredUplinkGrant*
is configured and set to \'pusch-RepTypeB\', PUSCH repetition type B is
applied; otherwise, PUSCH repetition type A is applied;

\- For PUSCH repetition type A, the selection of the time domain
resource allocation table follows the rules for DCI format 0\_0 on UE
specific search space, as defined in Clause 6.1.2.1.1.

...

\- The higher layer parameter *timeDomainAllocation* value *m* provides
a row index *m*+1 pointing to the determined time domain resource
allocation table, where the start symbol and length are determined
following the procedure defined in Clause 6.1.2.1;

...

\- For Type 2 PUSCH transmissions with a configured grant: the resource
allocation follows the higher layer configuration according to \[10, TS
38.321\], and UL grant received on the DCI.

\- The PUSCH repetition type and the time domain resource allocation
table are determined by the PUSCH repetition type and the time domain
resource allocation table associated with the UL grant received on the
DCI, respectively, as defined in Clause 6.1.2.1. The value of K~offset~,
if configured, is applied when determining the first transmission
opportunity.

For PUSCH transmissions with a Type 1 or Type 2 configured grant, the
number of (nominal) repetitions *K* to be applied to the transmitted
transport block is provided by the indexed row in the time domain
resource allocation table if *numberOfRepetitions* is present in the
table; otherwise *K* is provided by the higher layer configured
parameters *repK.*

...

The UE shall not transmit anything on the resources configured by
*configuredGrantConfig* if the higher layers did not deliver a transport
block to transmit on the resources allocated for uplink transmission
without grant.

A set of allowed periodicities *P* are defined in \[12, TS 38.331\]. The
higher layer parameter *cg-nrofSlots*, provides the number of
consecutive slots allocated within a configured grant period. The higher
layer parameter *cg-nrofPUSCH-InSlot* provides the number of consecutive
PUSCH allocations within a slot, where the first PUSCH allocation
follows the higher layer parameter *timeDomainAllocation* for Type 1
PUSCH transmission or the higher layer configuration according to \[10,
TS 38.321\], and UL grant received on the DCI for Type 2 PUSCH
transmissions, and the remaining PUSCH allocations have the same length
and PUSCH mapping type, and are appended following the previous
allocations without any gaps. The same combination of start symbol and
length and PUSCH mapping type repeats over the consecutively allocated
slots.

,,,

\[TS 38.214, clause 6.1.2.3.1\]

The procedures described in this clause apply to PUSCH transmissions of
PUSCH repetition Type A with a Type 1 or Type 2 configured grant.

The higher layer parameter *repK-RV* defines the redundancy version
pattern to be applied to the repetitions. If *cg-RetransmissionTimer* is
provided, the redundancy version for uplink transmission with a
configured grant is determined by the UE. If the parameter *repK-RV* is
not provided in the *configuredGrantConfig* and *cg-RetransmissionTimer*
is not provided, the redundancy version for uplink transmissions with a
configured grant shall be set to 0. If the parameter *repK-RV* is
provided in the *configuredGrantConfig* and *cg-RetransmissionTimer* is
not provided, for the *n*th transmission occasion among *K* repetitions,
*n*=1, 2, ..., *K*, it is associated with *(mod(((n-mod(n,
N))/N)-1,4)+1)^th^* value in the configured RV sequence, where *N*=1. If
a configured grant configuration is configured with *startingFromRV0*
set to *\'off\'*, the initial transmission of a transport block may only
start at the first transmission occasion of the *K* repetitions.
Otherwise, the initial transmission of a transport block may start at

\- the first transmission occasion of the *K* repetitions if the
configured RV sequence is {0,2,3,1},

\- any of the transmission occasions of the *K* repetitions that are
associated with RV=0 if the configured RV sequence is {0,3,0,3},

\- any of the transmission occasions of the *K* repetitions if the
configured RV sequence is {0,0,0,0}, except the last transmission
occasion when *Kâ¥8*.

...

For any RV sequence, the repetitions shall be terminated after
transmitting *K* repetitions, or at the last transmission occasion among
the *K* repetitions within the period *P*, or from the starting symbol
of the repetition that overlaps with a PUSCH with the same HARQ process
scheduled by DCI format 0\_0, 0\_1 or 0\_2, whichever is reached first.
In addition, the UE shall terminate the repetition of a transport block
in a PUSCH transmission if the UE receives a DCI format 0\_1 with DFI
flag provided and set to \'1\', and if in this DCI the UE detects ACK
for the HARQ process corresponding to that transport block.

The UE is not expected to be configured with the time duration for the
transmission of *K* repetitions larger than the time duration derived by
the periodicity *P*. If the UE determines that, for a transmission
occasion, the number of symbols available for the PUSCH transmission in
a slot is smaller than transmission duration *L*, the UE does not
transmit the PUSCH in the transmission occasion.

For both Type 1 and Type 2 PUSCH transmissions with a configured grant,
when *K \> 1,*

\- For unpaired spectrum:

...

\- Otherwise, the UE shall repeat the TB across the
![](./media/image41.png)![](./media/image41.png) consecutive slots
applying the same symbol allocation in each slot, except if the UE is
provided with higher layer parameters *cg-nrofSlots* and
*cg-nrofPUSCH-InSlot*, in which case the UE repeats the TB in the *repK*
earliest consecutive transmission occasion candidates within the same
configuration.

\- For paired spectrum and SUL band:

\- The UE shall repeat the TB across the
![](./media/image41.png)![](./media/image41.png) consecutive slots
applying the same symbol allocation in each slot, except if the UE is
provided with higher layer parameters *cg-nrofSlots* and
*cg-nrofPUSCH-InSlot*, in which case the UE repeats the TB in the *repK*
earliest consecutive transmission occasion candidates within the same
configuration.

...

A Type 1 or Type 2 PUSCH transmission with a configured grant in a slot
is omitted according to the conditions in Clause 9, Clause 11.1, Clause
11.2A, Clause 15 and Clause 17.2 of \[6, TS 38.213\].

\[TS 38.214, clause 6.1.4\]

To determine the modulation order, target code rate, redundancy version
and transport block size for the physical uplink shared channel, the UE
shall first

> \- read the 5-bit modulation and coding scheme field
> ![](./media/image22.wmf)in the DCI to determine the modulation order
> ![](./media/image23.wmf) and target code rate (*R*) based on the
> procedure defined in Subclause 6.1.4.1
>
> \- read redundancy version field (*rv*) in the DCI to determine the
> redundancy version, and
>
> \- \[check the \"CSI request\" bit field\]

and second

> \- the UE shall use the number of layers ![](./media/image24.wmf), the
> total number of allocated PRBs ![](./media/image25.wmf) to determine
> the transport block size based on the procedure defined in Subclause
> 6.1.4.2.

\[TS 38.321, clause 5.4.1\]

Uplink grant is either received dynamically on the PDCCH, in a Random
Access Response, or configured semi-persistently by RRC. The MAC entity
shall have an uplink grant to transmit on the UL-SCH. To perform the
requested transmissions, the MAC layer receives HARQ information from
lower layers.

If the MAC entity has a C-RNTI, a Temporary C-RNTI, or CS-RNTI, the MAC
entity shall for each PDCCH occasion and for each Serving Cell belonging
to a TAG that has a running *timeAlignmentTimer* and for each grant
received for this PDCCH occasion:

> ...

1\> else if an uplink grant for this PDCCH occasion has been received
for this Serving Cell on the PDCCH for the MAC entity\'s CS-RNTI:

...

2\> else if the NDI in the received HARQ information is 0:

3\> if PDCCH contents indicate configured grant Type 2 deactivation:

4\> trigger configured uplink grant confirmation.

3\> else if PDCCH contents indicate configured grant Type 2 activation:

4\> trigger configured uplink grant confirmation;

4\> store the uplink grant for this Serving Cell and the associated HARQ
information as configured uplink grant;

4\> initialise or re-initialise the configured uplink grant for this
Serving Cell to start in the associated PUSCH duration and to recur
according to rules in clause 5.8.2;

4\> stop the *configuredGrantTimer* for the corresponding HARQ process,
if running;

For each Serving Cell and each configured uplink grant, if configured
and activated, the MAC entity shall:

1\> if the PUSCH duration of the configured uplink grant does not
overlap with the PUSCH duration of an uplink grant received on the PDCCH
or in a Random Access Response for this Serving Cell:

2\> set the HARQ Process ID to the HARQ Process ID associated with this
PUSCH duration;

2\> if the *configuredGrantTimer* for the corresponding HARQ process is
not running:

3\> consider the NDI bit for the corresponding HARQ process to have been
toggled;

3\> deliver the configured uplink grant and the associated HARQ
information to the HARQ entity.

For configured uplink grants, the HARQ Process ID associated with the
first symbol of a UL transmission is derived from the following
equation:

HARQ Process ID = \[floor(CURRENT\_symbol/*periodicity*)\] modulo
*nrofHARQ-Processes*

where CURRENT\_symbol = (SFN Ã *numberOfSlotsPerFrame* Ã
*numberOfSymbolsPerSlot* + slot number in the frame Ã
*numberOfSymbolsPerSlot* + symbol number in the slot), and
*numberOfSlotsPerFrame* and *numberOfSymbolsPerSlot* refer to the number
of consecutive slots per frame and the number of consecutive symbols per
slot, respectively as specified in TS 38.211 \[8\].

NOTE 1: CURRENT\_symbol refers to the symbol index of the first
transmission occasion of a bundle of configured uplink grant.

NOTE 2: A HARQ process is configured for a configured uplink grant if
the configured uplink grant is activated and the associated HARQ process
ID is less than *nrofHARQ-Processes*.

NOTE 3: If the MAC entity receives both a grant in a Random Access
Response and an overlapping grant for its C-RNTI or CS-RNTI, requiring
concurrent transmissions on the SpCell, the MAC entity may choose to
continue with either the grant for its RA-RNTI or the grant for its
C-RNTI or CS-RNTI.

\[TS 38.321, clause 5.4.2.1\]

The MAC entity includes a HARQ entity for each Serving Cell with
configured uplink (including the case when it is configured with
*supplementaryUplink*), which maintains a number of parallel HARQ
processes.

The number of parallel UL HARQ processes per HARQ entity is specified in
TS 38.214 \[7\].

Each HARQ process supports one TB.

Each HARQ process is associated with a HARQ process identifier. For UL
transmission with UL grant in RA Response or for UL transmission for
MSGA payload, HARQ process identifier 0 is used.

...

The maximum number of transmissions of a TB within a bundle of the
dynamic grant or configured grant or the uplink grant received in a MAC
RAR is given by *REPETITION\_NUMBER* as follows:

> \- For a dynamic grant, *REPETITION\_NUMBER* is set to a value
> provided by lower layers, as specified in clause 6.1.2.1 of TS 38.214
> \[7\];
>
> ...

If *REPETITION\_NUMBER* \> 1, after the first transmission within a
bundle, at most *REPETITION\_NUMBER* -- 1 HARQ retransmissions follow
within the bundle. For both dynamic grant and configured uplink grant,
and uplink grant received in a MAC RAR bundling operation relies on the
HARQ entity for invoking the same HARQ process for each transmission
that is part of the same bundle. Within a bundle, HARQ retransmissions
are triggered without waiting for feedback from previous transmission
according to *REPETITION\_NUMBER* for a dynamic grant or configured
uplink grant or uplink grant received in a MAC RAR unless they are
terminated as specified in clause 6.1 of TS 38.214 \[7\]. Each
transmission within a bundle is a separate uplink grant delivered to the
HARQ entity.

For each transmission within a bundle of the dynamic grant or uplink
grant received in a MAC RAR, the sequence of redundancy versions is
determined according to clause 6.1.2.1 of TS 38.214 \[7\]. For each
transmission within a bundle of the configured uplink grant, the
sequence of redundancy versions is determined according to clause
6.1.2.3 of TS 38.214 \[7\].

For each uplink grant, the HARQ entity shall:

> 1\> identify the HARQ process associated with this grant, and for each
> identified HARQ process:
>
> 2\> if the received grant was not addressed to a Temporary C-RNTI on
> PDCCH, and the NDI provided in the associated HARQ information has
> been toggled compared to the value in the previous transmission of
> this TB of this HARQ process; or
>
> ...
>
> 3\> if a MAC PDU to transmit has been obtained:
>
> 4\> if the uplink grant is not a configured grant configured with
> *autonomousTx*; or
>
> 4\> if the uplink grant is a prioritized uplink grant:
>
> 5\> deliver the MAC PDU and the uplink grant and the HARQ information
> of the TB to the identified HARQ process;
>
> 5\> instruct the identified HARQ process to trigger a new
> transmission;
>
> ...
>
> 2\> else (i.e. retransmission):
>
> ...
>
> 3\> else:
>
> 4\> deliver the uplink grant and the HARQ information (redundancy
> version) of the TB to the identified HARQ process;
>
> 4\> instruct the identified HARQ process to trigger a retransmission;
>
> ....

\[TS 38.321, clause 5.4.2.2\]

Each HARQ process is associated with a HARQ buffer.

New transmissions are performed on the resource and with the MCS
indicated on PDCCH or indicated in the Random Access Response (i.e. MAC
RAR or fallbackRAR), or signalled in RRC or determined as specified in
clause 5.1.2a for MSGA payload. Retransmissions are performed on the
resource and, if provided, with the MCS indicated on PDCCH, or on the
same resource and with the same MCS as was used for last made
transmission attempt within a bundle, or on stored configured uplink
grant resources and stored MCS when *cg-RetransmissionTimer* or
*cg-SDT-RetransmissionTimer* is configured. If *cg-RetransmissionTimer*
is configured, retransmissions with the same HARQ process may be
performed on any configured grant configuration if the configured grant
configurations have the same TBS. If *cg-SDT-RetransmissionTimer* is
configured, retransmission for the initial CG-SDT transmission with the
same HARQ process may be performed on any configured grant configuration
if the configured grant configurations have the same TBS.

...

If the HARQ entity requests a new transmission for a TB, the HARQ
process shall:

1\> store the MAC PDU in the associated HARQ buffer;

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

If the HARQ entity requests a retransmission for a TB, the HARQ process
shall:

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

To generate a transmission for a TB, the HARQ process shall:

...

1\> if there is no measurement gap at the time of the transmission and,
in case of retransmission, the retransmission does not collide with a
transmission for a MAC PDU obtained from the Msg3 buffer or the MSGA
buffer:

2\> if there are neither NR sidelink transmission nor transmission of
V2X sidelink communication at the time of the transmission; or

...

3\> instruct the physical layer to generate a transmission according to
the stored uplink grant.

...

\[38.321 clause 5.8.2\]

There are two types of transmission without dynamic grant:

\- configured grant Type 1 where an uplink grant is provided by RRC, and
stored as configured uplink grant;

\- configured grant Type 2 where an uplink grant is provided by PDCCH,
and stored or cleared as configured uplink grant based on L1 signalling
indicating configured uplink grant activation or deactivation.

Type 1 and Type 2 are configured by RRC for a Serving Cell per BWP.
Multiple configurations can be active simultaneously only on different
Serving Cells. For Type 2, activation and deactivation are independent
among the Serving Cells. For the same Serving Cell, the MAC entity is
configured with either Type 1 or Type 2.

RRC configures the following parameters when the configured grant Type 1
is configured:

\- *cs-RNTI*: CS-RNTI for retransmission;

\- *periodicity*: periodicity of the configured grant Type 1;

\- *timeDomainOffset*: Offset of a resource with respect to SFN = 0 in
time domain;

\- *timeDomainAllocation*: Allocation of configured uplink grant in time
domain which contains *startSymbolAndLength* (i.e. *SLIV* in TS 38.214
\[7\]);

\- *nrofHARQ-Processes*: the number of HARQ processes for configured
grant.

RRC configures the following parameters when the configured grant Type 2
is configured:

\- *cs-RNTI*: CS-RNTI for activation, deactivation, and retransmission;

\- *periodicity*: periodicity of the configured grant Type 2;

\- *nrofHARQ-Processes*: the number of HARQ processes for configured
grant.

Upon configuration of a configured grant Type 1 for a BWP of a Serving
Cell by upper layers, the MAC entity shall:

1\> store the uplink grant provided by upper layers as a configured
uplink grant for the indicated BWP of the Serving Cell;

1\> initialise or re-initialise the configured uplink grant to start in
the symbol according to *timeDomainOffset* and *S* (derived from *SLIV*
as specified in TS 38.214 \[7\]), and to reoccur with *periodicity*.

After an uplink grant is configured for a configured grant Type 1, the
MAC entity shall consider that the uplink grant recurs associated with
each symbol for which:

\[(SFN Ã *numberOfSlotsPerFrame* Ã *numberOfSymbolsPerSlot*) + (slot
number in the frame Ã *numberOfSymbolsPerSlot*) + symbol number in the
slot\] =\
(*timeDomainOffset* Ã *numberOfSymbolsPerSlot* + *S* + N Ã
*periodicity*) modulo (1024 Ã *numberOfSlotsPerFrame* Ã
*numberOfSymbolsPerSlot*), for all N \>= 0.

After an uplink grant is configured for a configured grant Type 2, the
MAC entity shall consider that the uplink grant recurs associated with
each symbol for which:

\[(SFN Ã *numberOfSlotsPerFrame* Ã *numberOfSymbolsPerSlot*) + (slot
number in the frame Ã *numberOfSymbolsPerSlot*) + symbol number in the
slot\] =\
\[(SFN~start\ time~ Ã *numberOfSlotsPerFrame* Ã *numberOfSymbolsPerSlot*
+ slot~start\ time~ Ã *numberOfSymbolsPerSlot* + symbol~start\ time~) +
N Ã *periodicity*\] modulo (1024 Ã *numberOfSlotsPerFrame* Ã
*numberOfSymbolsPerSlot*), for all N \>= 0.

where SFN~start\ time~, slot~start\ time~, and symbol~start\ time~ are
the SFN, slot, and symbol, respectively, of the first transmission
opportunity of PUSCH where the configured uplink grant was
(re-)initialised.

...

7.1.1.3.14.2.3 Test description

7.1.1.3.14.2.3.1 Pre-test conditions

Same Pre-test conditions as in clause 7.1.1.0 except that DRB is
configured in RLC AM mode according to Table 7.1.1.3.14.2.3.1-1.

**Table 7.1.1.3.14.2.3.1-1: RLC parameters**

  -------------------- ------
  *t-PollRetransmit*   ms80
  -------------------- ------

7.1.1.3.14.2.3.2 Test procedure sequence

**Table 7.1.1.3.14.2.3.2-1: Main behaviour**

+--------+------------+------------+------------+------------+----+
| **St** | **P        | **Message  | **TP**     | *          |    |
|        | rocedure** | Sequence** |            | *Verdict** |    |
+========+============+============+============+============+====+
|        |            | **U - S**  | *          |            |    |
|        |            |            | *Message** |            |    |
+--------+------------+------------+------------+------------+----+
| 1      | SS         | \<\-\--    | NR RRC:    | \-         | \- |
|        | transmits  |            | *RRCReconf |            |    |
|        | an         |            | iguration* |            |    |
|        | RRCRecon   |            |            |            |    |
|        | figuration |            |            |            |    |
|        | message    |            |            |            |    |
|        | including  |            |            |            |    |
|        | Co         |            |            |            |    |
|        | nfiguredGr |            |            |            |    |
|        | antConfig. |            |            |            |    |
|        |            |            |            |            |    |
|        | NOTE: For  |            |            |            |    |
|        | EN-DC. the |            |            |            |    |
|        | RRCRecon   |            |            |            |    |
|        | figuration |            |            |            |    |
|        | message is |            |            |            |    |
|        | embedded   |            |            |            |    |
|        | in         |            |            |            |    |
|        | RRCConne   |            |            |            |    |
|        | ctionRecon |            |            |            |    |
|        | figuration |            |            |            |    |
|        | specified  |            |            |            |    |
|        | in 36.508  |            |            |            |    |
|        | \[7\]      |            |            |            |    |
|        | Table      |            |            |            |    |
|        | 4.6.1-8    |            |            |            |    |
|        | with       |            |            |            |    |
|        | condition  |            |            |            |    |
|        | EN-DC      |            |            |            |    |
|        | \_EmbedNR\ |            |            |            |    |
|        | _RRCRecon. |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 2      | UE         | \--\>      | NR RRC:    | \-         | \- |
|        | transmits  |            | *RRCReco   |            |    |
|        | an         |            | nfiguratio |            |    |
|        | RRCRec     |            | nComplete* |            |    |
|        | onfigurati |            |            |            |    |
|        | onComplete |            |            |            |    |
|        | message.   |            |            |            |    |
|        |            |            |            |            |    |
|        | NOTE: For  |            |            |            |    |
|        | EN-DC, the |            |            |            |    |
|        | RRCRec     |            |            |            |    |
|        | onfigurati |            |            |            |    |
|        | onComplete |            |            |            |    |
|        | message is |            |            |            |    |
|        | embedded   |            |            |            |    |
|        | in         |            |            |            |    |
|        | RRCCon     |            |            |            |    |
|        | nectionRec |            |            |            |    |
|        | onfigurati |            |            |            |    |
|        | onComplete |            |            |            |    |
|        | specified  |            |            |            |    |
|        | in 36.508  |            |            |            |    |
|        | \[7\]      |            |            |            |    |
|        | Table      |            |            |            |    |
|        | 4.6.1-9    |            |            |            |    |
|        | with       |            |            |            |    |
|        | condition  |            |            |            |    |
|        | MCG        |            |            |            |    |
|        | \_and\_SCG |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 3      | IF         |            |            |            |    |
|        | pc\_type   |            |            |            |    |
|        | 1\_PUSCH\_ |            |            |            |    |
|        | Repetition |            |            |            |    |
|        | MultiSlots |            |            |            |    |
|        | = FALSE,   |            |            |            |    |
|        | the SS     |            |            |            |    |
|        | sends a    |            |            |            |    |
|        | DCI to     |            |            |            |    |
|        | activate   |            |            |            |    |
|        | the        |            |            |            |    |
|        | configured |            |            |            |    |
|        | grant      |            |            |            |    |
|        | which is   |            |            |            |    |
|        | sufficient |            |            |            |    |
|        | to         |            |            |            |    |
|        | transmit   |            |            |            |    |
|        | the MAC    |            |            |            |    |
|        | SDU to     |            |            |            |    |
|        | loop back  |            |            |            |    |
|        | in a slot. |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 4      | The SS     | \<\-\--    | MAC PDU    | \-         | \- |
|        | transmits  |            |            |            |    |
|        | a valid    |            |            |            |    |
|        | MAC PDU    |            |            |            |    |
|        | containing |            |            |            |    |
|        | one RLC    |            |            |            |    |
|        | PDU.       |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 5      | Check:     | \--\>      | MAC PDU    | 1          | P  |
|        | Does the   |            |            |            |    |
|        | UE         |            |            |            |    |
|        | transmit a |            |            |            |    |
|        | MAC PDU    |            |            |            |    |
|        | including  |            |            |            |    |
|        | one RLC    |            |            |            |    |
|        | SDU and    |            |            |            |    |
|        | repeat     |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmitting |            |            |            |    |
|        | this MAC   |            |            |            |    |
|        | PDU in     |            |            |            |    |
|        | every slot |            |            |            |    |
|        | which is   |            |            |            |    |
|        | suitable   |            |            |            |    |
|        | for UL     |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmission |            |            |            |    |
|        | in the     |            |            |            |    |
|        | next       |            |            |            |    |
|        | c          |            |            |            |    |
|        | onsecutive |            |            |            |    |
|        | 31 slots   |            |            |            |    |
|        | with same  |            |            |            |    |
|        | resource   |            |            |            |    |
|        | allocation |            |            |            |    |
|        | but        |            |            |            |    |
|        | different  |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version?   |            |            |            |    |
|        |            |            |            |            |    |
|        | NOTE: The  |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version    |            |            |            |    |
|        | for the    |            |            |            |    |
|        | first      |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmission |            |            |            |    |
|        | and all    |            |            |            |    |
|        | possible   |            |            |            |    |
|        | r          |            |            |            |    |
|        | epetitions |            |            |            |    |
|        | are set in |            |            |            |    |
|        | the        |            |            |            |    |
|        | following  |            |            |            |    |
|        | order {0,  |            |            |            |    |
|        | 2, 3, 1}   |            |            |            |    |
|        | according  |            |            |            |    |
|        | to         |            |            |            |    |
|        | repK-RV.   |            |            |            |    |
|        | Usage of   |            |            |            |    |
|        | correct    |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version is |            |            |            |    |
|        | implicitly |            |            |            |    |
|        | checked    |            |            |            |    |
|        | upon       |            |            |            |    |
|        | correct    |            |            |            |    |
|        | decoding   |            |            |            |    |
|        | by the SS  |            |            |            |    |
|        | of the UE  |            |            |            |    |
|        | UL         |            |            |            |    |
|        | r          |            |            |            |    |
|        | epetitions |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 6      | SS         | \<\--      | MAC PDU    | \-         |    |
|        | transmits  |            | (RLC       |            |    |
|        | a MAC PDU  |            | STATUS     |            |    |
|        | containing |            | PDU)       |            |    |
|        | an RLC     |            |            |            |    |
|        | STATUS PDU |            |            |            |    |
|        | ack        |            |            |            |    |
|        | nowledging |            |            |            |    |
|        | the        |            |            |            |    |
|        | reception  |            |            |            |    |
|        | of the AMD |            |            |            |    |
|        | PDU in     |            |            |            |    |
|        | step 4.    |            |            |            |    |
+--------+------------+------------+------------+------------+----+

7.1.1.3.14.2.3.3 Specific message contents

**Table 7.1.1.3.14.2.3.3-1: *RRCReconfiguration* (Step 1, Table
7.1.1.3.14.2.3.2-1)**

  Derivation Path: 38.508-1 \[4\], Table 4.6.1-13                                                 
  ------------------------------------------------- ------------------ -------------------------- ---------------
  **Information Element**                           **Value/remark**   **Comment**                **Condition**
  RRCReconfiguration ::= SEQUENCE {                                                               
  criticalExtensions CHOICE {                                                                     
  rrcReconfiguration SEQUENCE {                                                                   
  secondaryCellGroup                                CellGroupConfig    Table 7.1.1.3.14.2.3.3-2   EN-DC
                                                    Not present                                   NR
  nonCriticalExtension                              Not present                                   EN-DC
  nonCriticalExtension SEQUENCE {                                                                 NR
  masterCellGroup                                   CellGroupConfig    Table 7.1.1.3.14.2.3.3-2   
  }                                                                                               
  }                                                                                               
  }                                                                                               
  }                                                                                               

**Table 7.1.1.3.14.2.3.3-2: *CellGroupConfig* (Table
7.1.1.3.14.2.3.3-1)**

  Derivation Path: 38.508-1 \[4\], Table 4.6.3-19                                                    
  ------------------------------------------------- --------------------- -------------------------- ---------------
  **Information Element**                           **Value/remark**      **Comment**                **Condition**
  cellGroupConfig::= SEQUENCE {                                                                      
  cellGroupId                                       0                                                NR
                                                    1                                                EN-DC
  spCellConfig SEQUENCE {                                                                            
  servCellIndex                                     Not present                                      NR
                                                    1                                                EN-DC
  spCellConfigDedicated SEQUENCE {                                                                   
  servingCellConfig                                 *ServingCellConfig*   Table 7.1.1.3.14.2.3.3-3   
  }                                                                                                  
  }                                                                                                  
  }                                                                                                  

**Table 7.1.1.3.14.2.3.3-3: *ServingCellConfig* (Table
7.1.1.3.14.2.3.3-2)**

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167                                                      
  ----------------------------------------------------- ----------------------- -------------------------- ---------------
  **Information Element**                               **Value/remark**        **Comment**                **Condition**
  ServingCellConfig ::= SEQUENCE {                                                                         
  uplinkConfig SEQUENCE {                                                                                  
  initialUplinkBWP SEQUENCE {                                                                              
  configuredGrantConfig CHOICE {                                                                           
  setup                                                 ConfiguredGrantConfig   Table 7.1.1.3.14.2.3.3-4   
  }                                                                                                        
  }                                                                                                        
  }                                                                                                        
  }                                                                                                        

Table 7.1.1.3.14.2.3.3-5: *ConfiguredGrantConfig* (Table
7.1.1.3.14.2.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-26 with condition CG\_Config\_Type1                                    
  ------------------------------------------------------------------------------------- ------------------ ------------- --------------------------------------------
  **Information Element**                                                               **Value/remark**   **Comment**   **Condition**
  ConfiguredGrantConfig ::= SEQUENCE {                                                                                   
  repK-RV                                                                               s1-0231                          
  rrc-ConfiguredUplinkGrant                                                             Not present                      NOT pc\_type1\_PUSCH\_RepetitionMultiSlots
  repK-v1710                                                                            n32                              
  }                                                                                                                      

###### 7.1.1.3.14.3 Correct Handling of UL HARQ process / PUSCH Repetition Type A enhancement / repetition based on available slots / dynamic grant

7.1.1.3.14.3.1 Test Purpose (TP)

\(1\)

**with** { UE in RRC\_CONNECTED state and is configured with
availableSlotCounting-r17.}

**ensure that** {

**when** { UE has data available for transmission, UE receives an UL
Grant with toggled NDI which also indicates numberOfRepetitions \> 1 }

**then** { UE transmits repetitions of PUSCH on available UL slots and
selects the redundancy version correctly }

}

7.1.1.3.14.3.2 Conformance requirements

References: The conformance requirements covered in the present TC are
specified in: TS 38.214 clauses 6.1.2.1 and 6.1.4, TS 38.321 clauses
5.4.1, 5.4.2.1 and 5.4.2.2. Unless otherwise stated these are Rel-17
requirements.

\[TS 38.214, clause 6.1.2.1\]

When the UE is scheduled to transmit a transport block and no CSI report
by a DCI or by a RAR UL grant or fallbackRAR UL grant, or the UE is
scheduled to transmit a transport block and a CSI report(s) on PUSCH by
a DCI, the \'*Time domain resource assignment\'* field value *m* of the
DCI or the *PUSCH time resource allocation* field value *m* of the RAR
UL grant or of the fallbackRAR UL grant provides a row index *m* + 1 to
an allocated table. The determination of the used resource allocation
table is defined in Clause 6.1.2.1.1. The indexed row defines the slot
offset *K~2~*, the start and length indicator *SLIV*, or directly the
start symbol *S* and the allocation length *L*, the PUSCH mapping type,
the number of slots used for TBS determination (if *numberOfSlotsTBoMS*
is present in the resource allocation table), and the number of
repetitions (if *numberOfRepetitions* is present in the resource
allocation table) to be applied in the PUSCH transmission.

...

The UE shall consider the *S* and *L* combinations defined in table
6.1.2.1-1 as valid PUSCH allocations

Table 6.1.2.1-1: Valid *S* and *L* combinations

  PUSCH mapping type                Normal cyclic prefix   Extended cyclic prefix                                                                                                   
  --------------------------------- ---------------------- ------------------------ -------------------------------------------------------------------- ------------- ------------ --------------------------------------------------------------------
                                    *S*                    *L*                      *S+L*                                                                *S*           *L*          *S+L*
  Type A (repetition Type A only)   0                      {4,...,14}               {4,...,14}                                                           0             {4,...,12}   {4,...,12}
  Type B                            {0,...,13}             {1,...,14}               {1,...,14} for repetition Type A, {1,...,27} for repetition Type B   {0,..., 11}   {1,...,12}   {1,...,12} for repetition Type A, {1,...,23} for repetition Type B

...

For PUSCH repetition Type A, when transmitting PUSCH scheduled by DCI
format 0\_1 or 0\_2 in PDCCH with CRC scrambled with C-RNTI, MCS-C-RNTI,
or CS-RNTI with NDI=1, the number of repetitions *K* is determined as

\- if *numberOfRepetitions* is present in the resource allocation table,
the number of repetitions K is equal to *numberOfRepetitions*;

\- elseif the UE is configured with *pusch-AggregationFactor*, the
number of repetitions *K* is equal to *pusch-AggregationFactor*;

\- otherwise *K=1*.

\- the number of slots used for TBS determination *N* is equal to 1.

...

For unpaired spectrum:

\- When *AvailableSlotCounting* is enabled, and in case *K\>1,* the UE
determines ![](./media/image41.png)![](./media/image41.png) slots for a
PUSCH transmission of a PUSCH repetition type A scheduled by DCI format
0\_1 or 0\_2, based on *tdd-UL-DL-ConfigurationCommon*,
*tdd-UL-DL-ConfigurationDedicated* *and ssb-PositionsInBurst*, and the
TDRA information field value in the DCI format 0\_1 or 0\_2.

\- A slot is not counted in the number of
![](./media/image41.png)![](./media/image41.png) slots for PUSCH
transmission of a PUSCH repetition Type A scheduled by DCI format 0\_1
or 0\_2 if at least one of the symbols indicated by the indexed row of
the used resource allocation table in the slot overlaps with a DL symbol
indicated by *tdd-UL-DL-ConfigurationCommon* or
*tdd-UL-DL-ConfigurationDedicated* if provided, or a symbol of an
SS/PBCH block with index provided by *ssb-PositionsInBurst*.

> ...

For paired spectrum and SUL band:

\- The UE determines ![](./media/image41.png)![](./media/image41.png)
consecutive slots for a PUSCH transmission of a PUSCH repetition type A
scheduled by DCI format 0\_1 or 0\_2, or for a PUSCH transmission of TB
processing over multiple slots scheduled by DCI format 0\_1 or 0\_2,
based on the TDRA information field value in the DCI format 0\_1 or
0\_2.

...

For PUSCH repetition Type A, in case *K\>1,*

\- If the PUSCH is scheduled by DCI format 0\_1 or 0\_2

\- if *AvailableSlotCounting* is enabled, the same symbol allocation is
applied across the ![](./media/image41.png)![](./media/image41.png)
slots determined for the PUSCH transmission and the PUSCH is limited to
a single transmission layer. The UE shall repeat the TB across the
![](./media/image41.png)![](./media/image41.png) slots determined for
the PUSCH transmission, applying the same symbol allocation in each
slot.

...

For a PUSCH transmission scheduled by DCI format 0\_1, or 0\_2, or 0\_0
with CRC scrambled by TC-RNTI, the redundancy version to be applied on
the *n*th transmission occasion of the TB, where n = 0, 1, ...
![](./media/image41.png)![](./media/image41.png) -1, is determined
according to table 6.1.2.1-2.

...

Table 6.1.2.1-2: Redundancy version for PUSCH transmission

  *rv~id\ ~*indicated by the DCI scheduling the PUSCH   *rv~id~* to be applied to *n*^th^ transmission occasion (repetition Type A) or TB processing over multiple slots) or *n*^th^ actual repetition (repetition Type B)                                                                   
  ----------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------------------------- ------------------------------- -------------------------------
                                                        *((n-(n mod N))/N)* mod 4 = 0                                                                                                                                        *((n-(n mod N))/N)* mod 4 = 1   *((n-(n mod N))/N)* mod 4 = 2   *((n-(n mod N))/N)* mod 4 = 3
  0                                                     0                                                                                                                                                                    2                               3                               1
  2                                                     2                                                                                                                                                                    3                               1                               0
  3                                                     3                                                                                                                                                                    1                               0                               2
  1                                                     1                                                                                                                                                                    0                               2                               3

For PUSCH repetition Type A and TB processing over multiple slots, a
PUSCH transmission in a slot of a multi-slot PUSCH transmission is
omitted according to the conditions in Clause 9, Clause 11.1, Clause
11.2A, Clause 15 and Clause 17.2 of \[6, TS 38.213\].

\[TS 38.214, clause 6.1.4\]

To determine the modulation order, target code rate, redundancy version
and transport block size for the physical uplink shared channel, the UE
shall first

> \- read the 5-bit modulation and coding scheme field
> ![](./media/image22.wmf)in the DCI to determine the modulation order
> ![](./media/image23.wmf) and target code rate (*R*) based on the
> procedure defined in Subclause 6.1.4.1
>
> \- read redundancy version field (*rv*) in the DCI to determine the
> redundancy version, and
>
> \- \[check the \"CSI request\" bit field\]

and second

> \- the UE shall use the number of layers ![](./media/image24.wmf), the
> total number of allocated PRBs ![](./media/image25.wmf) to determine
> the transport block size based on the procedure defined in Subclause
> 6.1.4.2.

\[TS 38.321, clause 5.4.1\]

Uplink grant is either received dynamically on the PDCCH, in a Random
Access Response, configured semi-persistently by RRC or determined to be
associated with the PUSCH resource of MSGA as specified in clause
5.1.2a. The MAC entity shall have an uplink grant to transmit on the
UL-SCH. To perform the requested transmissions, the MAC layer receives
HARQ information from lower layers. An uplink grant addressed to CS-RNTI
with NDI = 0 is considered as a configured uplink grant. An uplink grant
addressed to CS-RNTI with NDI = 1 is considered as a dynamic uplink
grant.

If the MAC entity has a C-RNTI, a Temporary C-RNTI, or CS-RNTI, the MAC
entity shall for each PDCCH occasion and for each Serving Cell belonging
to a TAG that has a running *timeAlignmentTimer* or a running
*cg-SDT-TimeAlignmentTimer* and for each grant received for this PDCCH
occasion:

1\> if an uplink grant for this Serving Cell has been received on the
PDCCH for the MAC entity\'s C-RNTI or Temporary C-RNTI; or

...

2\> if the uplink grant is for MAC entity\'s C-RNTI and if the previous
uplink grant delivered to the HARQ entity for the same HARQ process was
either an uplink grant received for the MAC entity\'s CS-RNTI or a
configured uplink grant:

3\> consider the NDI to have been toggled for the corresponding HARQ
process regardless of the value of the NDI.

...

2\> deliver the uplink grant and the associated HARQ information to the
HARQ entity.

...

\[TS 38.321, clause 5.4.2.1\]

The MAC entity includes a HARQ entity for each Serving Cell with
configured uplink (including the case when it is configured with
*supplementaryUplink*), which maintains a number of parallel HARQ
processes.

The number of parallel UL HARQ processes per HARQ entity is specified in
TS 38.214 \[7\].

Each HARQ process supports one TB.

Each HARQ process is associated with a HARQ process identifier. For UL
transmission with UL grant in RA Response or for UL transmission for
MSGA payload, HARQ process identifier 0 is used.

...

The maximum number of transmissions of a TB within a bundle of the
dynamic grant or configured grant or the uplink grant received in a MAC
RAR is given by *REPETITION\_NUMBER* as follows:

> \- For a dynamic grant, *REPETITION\_NUMBER* is set to a value
> provided by lower layers, as specified in clause 6.1.2.1 of TS 38.214
> \[7\];
>
> ...

If *REPETITION\_NUMBER* \> 1, after the first transmission within a
bundle, at most *REPETITION\_NUMBER* -- 1 HARQ retransmissions follow
within the bundle. For both dynamic grant and configured uplink grant,
and uplink grant received in a MAC RAR bundling operation relies on the
HARQ entity for invoking the same HARQ process for each transmission
that is part of the same bundle. Within a bundle, HARQ retransmissions
are triggered without waiting for feedback from previous transmission
according to *REPETITION\_NUMBER* for a dynamic grant or configured
uplink grant or uplink grant received in a MAC RAR unless they are
terminated as specified in clause 6.1 of TS 38.214 \[7\]. Each
transmission within a bundle is a separate uplink grant delivered to the
HARQ entity.

For each transmission within a bundle of the dynamic grant or uplink
grant received in a MAC RAR, the sequence of redundancy versions is
determined according to clause 6.1.2.1 of TS 38.214 \[7\]. For each
transmission within a bundle of the configured uplink grant, the
sequence of redundancy versions is determined according to clause
6.1.2.3 of TS 38.214 \[7\].

For each uplink grant, the HARQ entity shall:

> 1\> identify the HARQ process associated with this grant, and for each
> identified HARQ process:
>
> 2\> if the received grant was not addressed to a Temporary C-RNTI on
> PDCCH, and the NDI provided in the associated HARQ information has
> been toggled compared to the value in the previous transmission of
> this TB of this HARQ process; or
>
> ...
>
> 3\> if a MAC PDU to transmit has been obtained:
>
> 4\> if the uplink grant is not a configured grant configured with
> *autonomousTx*; or
>
> 4\> if the uplink grant is a prioritized uplink grant:
>
> 5\> deliver the MAC PDU and the uplink grant and the HARQ information
> of the TB to the identified HARQ process;
>
> 5\> instruct the identified HARQ process to trigger a new
> transmission;
>
> ...
>
> 2\> else (i.e. retransmission):
>
> ...
>
> 3\> else:
>
> 4\> deliver the uplink grant and the HARQ information (redundancy
> version) of the TB to the identified HARQ process;
>
> 4\> instruct the identified HARQ process to trigger a retransmission;
>
> ....

\[TS 38.321, clause 5.4.2.2\]

Each HARQ process is associated with a HARQ buffer.

New transmissions are performed on the resource and with the MCS
indicated on PDCCH or indicated in the Random Access Response (i.e. MAC
RAR or fallbackRAR), or signalled in RRC or determined as specified in
clause 5.1.2a for MSGA payload. Retransmissions are performed on the
resource and, if provided, with the MCS indicated on PDCCH, or on the
same resource and with the same MCS as was used for last made
transmission attempt within a bundle, or on stored configured uplink
grant resources and stored MCS when *cg-RetransmissionTimer* or
*cg-SDT-RetransmissionTimer* is configured. If *cg-RetransmissionTimer*
is configured, retransmissions with the same HARQ process may be
performed on any configured grant configuration if the configured grant
configurations have the same TBS. If *cg-SDT-RetransmissionTimer* is
configured, retransmission for the initial CG-SDT transmission with the
same HARQ process may be performed on any configured grant configuration
if the configured grant configurations have the same TBS.

...

If the HARQ entity requests a new transmission for a TB, the HARQ
process shall:

1\> store the MAC PDU in the associated HARQ buffer;

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

If the HARQ entity requests a retransmission for a TB, the HARQ process
shall:

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

To generate a transmission for a TB, the HARQ process shall:

...

1\> if there is no measurement gap at the time of the transmission and,
in case of retransmission, the retransmission does not collide with a
transmission for a MAC PDU obtained from the Msg3 buffer or the MSGA
buffer:

2\> if there are neither NR sidelink transmission nor transmission of
V2X sidelink communication at the time of the transmission; or

...

3\> instruct the physical layer to generate a transmission according to
the stored uplink grant.

...

7.1.1.3.14.3.3 Test description

7.1.1.3.14.3.3.1 Pre-test conditions

Same Pre-test conditions as in clause 7.1.1.0 except that DRB is
configured in RLC AM mode according to Table 7.1.1.3.14.3.3.1-1.

**Table 7.1.1.3.14.3.3.1-1: RLC parameters**

  -------------------- ------
  *t-PollRetransmit*   ms80
  -------------------- ------

7.1.1.3.14.3.3.2 Test procedure sequence

**Table 7.1.1.3.14.3.3.2-1: Main behaviour**

+--------+------------+------------+------------+------------+----+
| **St** | **P        | **Message  | **TP**     | *          |    |
|        | rocedure** | Sequence** |            | *Verdict** |    |
+========+============+============+============+============+====+
|        |            | **U - S**  | *          |            |    |
|        |            |            | *Message** |            |    |
+--------+------------+------------+------------+------------+----+
| 1      | SS         | \<\-\--    | NR RRC:    | \-         | \- |
|        | transmits  |            | *RRCReconf |            |    |
|        | an         |            | iguration* |            |    |
|        | RRCRecon   |            |            |            |    |
|        | figuration |            |            |            |    |
|        | message to |            |            |            |    |
|        | config     |            |            |            |    |
|        | A          |            |            |            |    |
|        | vailableSl |            |            |            |    |
|        | otCounting |            |            |            |    |
|        | and PUSCH  |            |            |            |    |
|        | TDRA table |            |            |            |    |
|        | including  |            |            |            |    |
|        | numberO    |            |            |            |    |
|        | fRepetitio |            |            |            |    |
|        | nsExt-r17. |            |            |            |    |
|        |            |            |            |            |    |
|        | NOTE: For  |            |            |            |    |
|        | EN-DC. the |            |            |            |    |
|        | RRCRecon   |            |            |            |    |
|        | figuration |            |            |            |    |
|        | message is |            |            |            |    |
|        | embedded   |            |            |            |    |
|        | in         |            |            |            |    |
|        | RRCConne   |            |            |            |    |
|        | ctionRecon |            |            |            |    |
|        | figuration |            |            |            |    |
|        | specified  |            |            |            |    |
|        | in 36.508  |            |            |            |    |
|        | \[7\]      |            |            |            |    |
|        | Table      |            |            |            |    |
|        | 4.6.1-8    |            |            |            |    |
|        | with       |            |            |            |    |
|        | condition  |            |            |            |    |
|        | EN-DC      |            |            |            |    |
|        | \_EmbedNR\ |            |            |            |    |
|        | _RRCRecon. |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 2      | UE         | \--\>      | NR RRC:    | \-         | \- |
|        | transmits  |            | *RRCReco   |            |    |
|        | an         |            | nfiguratio |            |    |
|        | RRCRec     |            | nComplete* |            |    |
|        | onfigurati |            |            |            |    |
|        | onComplete |            |            |            |    |
|        | message.   |            |            |            |    |
|        |            |            |            |            |    |
|        | NOTE: For  |            |            |            |    |
|        | EN-DC, the |            |            |            |    |
|        | RRCRec     |            |            |            |    |
|        | onfigurati |            |            |            |    |
|        | onComplete |            |            |            |    |
|        | message is |            |            |            |    |
|        | embedded   |            |            |            |    |
|        | in         |            |            |            |    |
|        | RRCCon     |            |            |            |    |
|        | nectionRec |            |            |            |    |
|        | onfigurati |            |            |            |    |
|        | onComplete |            |            |            |    |
|        | specified  |            |            |            |    |
|        | in 36.508  |            |            |            |    |
|        | \[7\]      |            |            |            |    |
|        | Table      |            |            |            |    |
|        | 4.6.1-9    |            |            |            |    |
|        | with       |            |            |            |    |
|        | condition  |            |            |            |    |
|        | MCG        |            |            |            |    |
|        | \_and\_SCG |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 3      | The SS     | \<\-\--    | MAC PDU    | \-         | \- |
|        | transmits  |            |            |            |    |
|        | a valid    |            |            |            |    |
|        | MAC PDU    |            |            |            |    |
|        | containing |            |            |            |    |
|        | one RLC    |            |            |            |    |
|        | PDU.       |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 4      | The UE     | \--\>      | Scheduling | \-         | \- |
|        | transmits  |            | Request    |            |    |
|        | a          |            |            |            |    |
|        | Scheduling |            |            |            |    |
|        | Request.   |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 5      | The SS     | \<\--      | DCI format | \-         | \- |
|        | allocates  |            | 0\_1       |            |    |
|        | an UL      |            |            |            |    |
|        | Grant      |            |            |            |    |
|        | which      |            |            |            |    |
|        | satisfies  |            |            |            |    |
|        | following  |            |            |            |    |
|        | c          |            |            |            |    |
|        | onditions: |            |            |            |    |
|        |            |            |            |            |    |
|        | \-         |            |            |            |    |
|        | sufficient |            |            |            |    |
|        | to         |            |            |            |    |
|        | transmit   |            |            |            |    |
|        | the MAC    |            |            |            |    |
|        | SDU to     |            |            |            |    |
|        | loop back  |            |            |            |    |
|        | in a slot  |            |            |            |    |
|        | (denote as |            |            |            |    |
|        | slot       |            |            |            |    |
|        | n~1~);     |            |            |            |    |
|        |            |            |            |            |    |
|        | \- HARQ    |            |            |            |    |
|        | process    |            |            |            |    |
|        | number     |            |            |            |    |
|        | indicates  |            |            |            |    |
|        | HARQ       |            |            |            |    |
|        | process    |            |            |            |    |
|        | \#1;       |            |            |            |    |
|        |            |            |            |            |    |
|        | \- NDI     |            |            |            |    |
|        | indicates  |            |            |            |    |
|        | new        |            |            |            |    |
|        | tra        |            |            |            |    |
|        | nsmission; |            |            |            |    |
|        |            |            |            |            |    |
|        | \- RV      |            |            |            |    |
|        | indicates  |            |            |            |    |
|        | rv^ID^ =   |            |            |            |    |
|        | 0;         |            |            |            |    |
|        |            |            |            |            |    |
|        | \- TDRA    |            |            |            |    |
|        | indicates  |            |            |            |    |
|        | the 1st    |            |            |            |    |
|        | entry in   |            |            |            |    |
|        | pusch-Time |            |            |            |    |
|        | DomainAllo |            |            |            |    |
|        | cationList |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 6      | Check:     | \--\>      | MAC PDU    | 1          | P  |
|        | Does the   |            |            |            |    |
|        | UE         |            |            |            |    |
|        | transmit a |            |            |            |    |
|        | MAC PDU    |            |            |            |    |
|        | including  |            |            |            |    |
|        | one RLC    |            |            |            |    |
|        | SDU, in    |            |            |            |    |
|        | HARQ       |            |            |            |    |
|        | process 1  |            |            |            |    |
|        | and in     |            |            |            |    |
|        | slot       |            |            |            |    |
|        | n~1~+4 and |            |            |            |    |
|        | repeat     |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmitting |            |            |            |    |
|        | this MAC   |            |            |            |    |
|        | PDU in the |            |            |            |    |
|        | next 3     |            |            |            |    |
|        | slots      |            |            |            |    |
|        | which are  |            |            |            |    |
|        | suitable   |            |            |            |    |
|        | for UL     |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmission |            |            |            |    |
|        | with same  |            |            |            |    |
|        | resource   |            |            |            |    |
|        | allocation |            |            |            |    |
|        | but        |            |            |            |    |
|        | different  |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version?   |            |            |            |    |
|        |            |            |            |            |    |
|        | NOTE: The  |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version    |            |            |            |    |
|        | for the    |            |            |            |    |
|        | first      |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmission |            |            |            |    |
|        | and all    |            |            |            |    |
|        | possible   |            |            |            |    |
|        | r          |            |            |            |    |
|        | epetitions |            |            |            |    |
|        | are set in |            |            |            |    |
|        | the        |            |            |            |    |
|        | following  |            |            |            |    |
|        | order {0,  |            |            |            |    |
|        | 2, 3, 1}   |            |            |            |    |
|        | according  |            |            |            |    |
|        | to TS      |            |            |            |    |
|        | 38.214     |            |            |            |    |
|        | \[15\]     |            |            |            |    |
|        | Table      |            |            |            |    |
|        | 6.1.2.1-2, |            |            |            |    |
|        | first row. |            |            |            |    |
|        | Usage of   |            |            |            |    |
|        | correct    |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version is |            |            |            |    |
|        | implicitly |            |            |            |    |
|        | checked    |            |            |            |    |
|        | upon       |            |            |            |    |
|        | correct    |            |            |            |    |
|        | decoding   |            |            |            |    |
|        | by the SS  |            |            |            |    |
|        | of the UE  |            |            |            |    |
|        | UL         |            |            |            |    |
|        | r          |            |            |            |    |
|        | epetitions |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 7      | SS         | \<\--      | MAC PDU    | \-         |    |
|        | transmits  |            | (RLC       |            |    |
|        | a MAC PDU  |            | STATUS     |            |    |
|        | containing |            | PDU)       |            |    |
|        | an RLC     |            |            |            |    |
|        | STATUS PDU |            |            |            |    |
|        | ack        |            |            |            |    |
|        | nowledging |            |            |            |    |
|        | the        |            |            |            |    |
|        | reception  |            |            |            |    |
|        | of the AMD |            |            |            |    |
|        | PDU in     |            |            |            |    |
|        | step 3.    |            |            |            |    |
+--------+------------+------------+------------+------------+----+

7.1.1.3.14.3.3.3 Specific message contents

**Table 7.1.1.3.14.3.3.3-1: *RRCReconfiguration* (Step 1, Table
7.1.1.3.14.3.3.2-1)**

  Derivation Path: 38.508-1 \[4\], Table 4.6.1-13                                                 
  ------------------------------------------------- ------------------ -------------------------- ---------------
  **Information Element**                           **Value/remark**   **Comment**                **Condition**
  RRCReconfiguration ::= SEQUENCE {                                                               
  criticalExtensions CHOICE {                                                                     
  rrcReconfiguration SEQUENCE {                                                                   
  secondaryCellGroup                                CellGroupConfig    Table 7.1.1.3.14.3.3.3-2   EN-DC
                                                    Not present                                   NR
  nonCriticalExtension                              Not present                                   EN-DC
  nonCriticalExtension SEQUENCE {                                                                 NR
  masterCellGroup                                   CellGroupConfig    Table 7.1.1.3.14.3.3.3-2   
  }                                                                                               
  }                                                                                               
  }                                                                                               
  }                                                                                               

**Table 7.1.1.3.14.3.3.3-2: *CellGroupConfig* (Table
7.1.1.3.14.3.3.3-1)**

  Derivation Path: 38.508-1 \[4\], Table 4.6.3-19                                                    
  ------------------------------------------------- --------------------- -------------------------- ---------------
  **Information Element**                           **Value/remark**      **Comment**                **Condition**
  cellGroupConfig::= SEQUENCE {                                                                      
  cellGroupId                                       0                                                NR
                                                    1                                                EN-DC
  spCellConfig SEQUENCE {                                                                            
  servCellIndex                                     Not present                                      NR
                                                    1                                                EN-DC
  spCellConfigDedicated SEQUENCE {                                                                   
  servingCellConfig                                 *ServingCellConfig*   Table 7.1.1.3.14.3.3.3-3   
  }                                                                                                  
  }                                                                                                  
  }                                                                                                  

**Table 7.1.1.3.14.3.3.3-3: *ServingCellConfig* (Table
7.1.1.3.14.3.3.3-2)**

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167                                                                       
  ----------------------------------------------------- ---------------------------------------- -------------------------- ---------------
  **Information Element**                               **Value/remark**                         **Comment**                **Condition**
  ServingCellConfig ::= SEQUENCE {                                                                                          
  uplinkConfig SEQUENCE {                                                                                                   
  initialUplinkBWP SEQUENCE {                                                                                               
  pusch-Config CHOICE {                                                                                                     
  setup SEQUENCE {                                                                                                          
  pusch-TimeDomainAllocationListDCI-0-1-r16 CHOICE {                                                                        
  setup                                                 PUSCH-TimeDomainResourceAllocationList   Table 7.1.1.3.14.3.3.3-4   
  }                                                                                                                         
  pusch-RepTypeIndicatorDCI-0-1-r16                     pusch-RepTypeA                                                      
  availableSlotCounting-r17                             enabled                                                             
  }                                                                                                                         
  }                                                                                                                         
  }                                                                                                                         
  }                                                                                                                         
  }                                                                                                                         

Table 7.1.1.3.14.3.3.3-4: *PUSCH-TimeDomainResourceAllocationList*
(Table 7.1.1.3.14.3.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-122A                                                                                                                
  ------------------------------------------------------------------------------------------------------------------------------------------ -------------- --------- -----------
  Information Element                                                                                                                        Value/remark   Comment   Condition
  PUSCH-TimeDomainResourceAllocationList-r16 ::= SEQUENCE (SIZE(1..maxNrofUL-Allocations-r16)) OF PUSCH-TimeDomainResourceAllocation-r16 {   2 entries                
  PUSCH-TimeDomainResourceAllocation-r16\[1\] SEQUENCE {                                                                                                    entry 1   
  puschAllocationList-r16 SEQUENCE (SIZE(1..maxNrofMultiplePUSCHs-r16)) OF PUSCH-Allocation-r16 {                                            1 entry                  
  PUSCH-Allocation-r16\[1\] SEQUENCE {                                                                                                                      entry 1   
  numberOfRepetitionsExt-r17                                                                                                                 n4                       
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  PUSCH-TimeDomainResourceAllocation-r16\[2\] SEQUENCE {                                                                                                    entry 2   
  puschAllocationList-r16 SEQUENCE (SIZE(1..maxNrofMultiplePUSCHs-r16)) OF PUSCH-Allocation-r16 {                                            1 entry                  
  PUSCH-Allocation-r16\[1\] SEQUENCE {                                                                                                                      entry 1   
  numberOfRepetitionsExt-r17                                                                                                                 n8                       
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  }                                                                                                                                                                   

Table 7.1.1.3.14.3.3.3-5: Physical layer parameters for DCI format 0\_1
(Step 5, Table 7.1.1.3.14.3.3.2-1)

  Derivation path: TS 38.508-1 \[4\] Table 4.3.6.1.1.2-1                                                                                                         
  -------------------------------------------------------- ----------------------------------------------------------------------------------- ----------------- -----------
  Parameter                                                Value                                                                               Value in binary   Condition
  Time domain resource assignment                          Indicating the 1st entry of pusch-TimeDomainAllocationListDCI-0-1-r16 to be used.   "0"               
  Redundancy version                                       RV \#0 to be used                                                                   "00"              

###### 7.1.1.3.14.4 Correct Handling of UL HARQ process / PUSCH Repetition Type A enhancement / repetition based on available slots / configured grant

##### 7.1.1.3.14.4.1 Test Purpose (TP) {#test-purpose-tp-13 .H6}

##### (1) {#section-48 .H6}

**with** { UE in RRC\_CONNECTED state and is configured with
availableSlotCounting-r17.}

**ensure that** {

**when** { UE has data available for transmission, UE is provided a UL
configured grant with repK }

**then** { UE transmits repetitions of PUSCH on available UL slots and
selects the redundancy version correctly }

}

##### 7.1.1.3.14.4.2 Conformance requirements {#conformance-requirements-13 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.214 clauses 6.1.2.1 and 6.1.4, TS 38.321 clauses
5.4.1, 5.4.2.1 and 5.4.2.2. Unless otherwise stated these are Rel-17
requirements.

\[TS 38.214, clause 6.1.2.1\]

...

The UE shall consider the *S* and *L* combinations defined in table
6.1.2.1-1 as valid PUSCH allocations

Table 6.1.2.1-1: Valid *S* and *L* combinations

  PUSCH mapping type                Normal cyclic prefix   Extended cyclic prefix                                                                                                   
  --------------------------------- ---------------------- ------------------------ -------------------------------------------------------------------- ------------- ------------ --------------------------------------------------------------------
                                    *S*                    *L*                      *S+L*                                                                *S*           *L*          *S+L*
  Type A (repetition Type A only)   0                      {4,...,14}               {4,...,14}                                                           0             {4,...,12}   {4,...,12}
  Type B                            {0,...,13}             {1,...,14}               {1,...,14} for repetition Type A, {1,...,27} for repetition Type B   {0,..., 11}   {1,...,12}   {1,...,12} for repetition Type A, {1,...,23} for repetition Type B

...

For unpaired spectrum:

\- When *AvailableSlotCounting* is enabled, and in case *K\>1,* the UE
determines ![](./media/image41.png)![](./media/image41.png) slots for a
PUSCH transmission of a PUSCH repetition type A scheduled by DCI format
0\_1 or 0\_2, based on *tdd-UL-DL-ConfigurationCommon*,
*tdd-UL-DL-ConfigurationDedicated* *and ssb-PositionsInBurst*, and the
TDRA information field value in the DCI format 0\_1 or 0\_2.

\- A slot is not counted in the number of
![](./media/image41.png)![](./media/image41.png) slots for PUSCH
transmission of a PUSCH repetition Type A scheduled by DCI format 0\_1
or 0\_2 if at least one of the symbols indicated by the indexed row of
the used resource allocation table in the slot overlaps with a DL symbol
indicated by *tdd-UL-DL-ConfigurationCommon* or
*tdd-UL-DL-ConfigurationDedicated* if provided, or a symbol of an
SS/PBCH block with index provided by *ssb-PositionsInBurst*.

...

For paired spectrum and SUL band:

\- The UE determines ![](./media/image41.png)![](./media/image41.png)
consecutive slots for a PUSCH transmission of a PUSCH repetition type A
scheduled by DCI format 0\_1 or 0\_2, or for a PUSCH transmission of TB
processing over multiple slots scheduled by DCI format 0\_1 or 0\_2,
based on the TDRA information field value in the DCI format 0\_1 or
0\_2.

...

For PUSCH repetition Type A and TB processing over multiple slots, a
PUSCH transmission in a slot of a multi-slot PUSCH transmission is
omitted according to the conditions in Clause 9, Clause 11.1, Clause
11.2A, Clause 15 and Clause 17.2 of \[6, TS 38.213\].

\[TS 38.214, clause 6.1.2.3\]

When PUSCH resource allocation is semi-statically configured by higher
layer parameter *configuredGrantConfig in BWP-UplinkDedicated
information element*, and the PUSCH transmission corresponding to a
configured grant, the following higher layer parameters are applied in
the transmission:

\- For Type 1 PUSCH transmissions with a configured grant, the following
parameters are given in *configuredGrantConfig* unless mentioned
otherwise:

\- For the determination of the PUSCH repetition type, if the higher
layer parameter *pusch-RepTypeIndicator* in *rrc-ConfiguredUplinkGrant*
is configured and set to \'pusch-RepTypeB\', PUSCH repetition type B is
applied; otherwise, PUSCH repetition type A is applied.

\- For PUSCH repetition type A, the selection of the time domain
resource allocation table follows the rules for DCI format 0\_0 on UE
specific search space, as defined in Clause 6.1.2.1.1.

...

\- The higher layer parameter *timeDomainAllocation* value *m* provides
a row index *m*+1 pointing to the determined time domain resource
allocation table, where the start symbol and length are determined
following the procedure defined in Clause 6.1.2.1;

...

\- For Type 2 PUSCH transmissions with a configured grant: the resource
allocation follows the higher layer configuration according to \[10, TS
38.321\], and UL grant received on the DCI.

\- The PUSCH repetition type and the time domain resource allocation
table are determined by the PUSCH repetition type, and the time domain
resource allocation table associated with the UL grant received on the
DCI, respectively, as defined in Clause 6.1.2.1. The value of K~offset~,
if configured, is applied when determining the first transmission
opportunity.

For PUSCH transmissions with a Type 1 or Type 2 configured grant, the
number of (nominal) repetitions *K* to be applied to the transmitted
transport block is provided by the indexed row in the time domain
resource allocation table if *numberOfRepetitions* is present in the
table; otherwise, *K* is provided by the higher layer configured
parameters *repK.*

...

The UE shall not transmit anything on the resources configured by
*configuredGrantConfig* if the higher layers did not deliver a transport
block to transmit on the resources allocated for uplink transmission
without grant.

A set of allowed periodicities *P* are defined in \[12, TS 38.331\]. The
higher layer parameter *cg-nrofSlots*, provides the number of
consecutive slots allocated within a configured grant period. The higher
layer parameter *cg-nrofPUSCH-InSlot* provides the number of consecutive
PUSCH allocations within a slot, where the first PUSCH allocation
follows the higher layer parameter *timeDomainAllocation* for Type 1
PUSCH transmission or the higher layer configuration according to \[10,
TS 38.321\], and UL grant received on the DCI for Type 2 PUSCH
transmissions, and the remaining PUSCH allocations have the same length
and PUSCH mapping type, and are appended following the previous
allocations without any gaps. The same combination of start symbol and
length and PUSCH mapping type repeats over the consecutively allocated
slots.

,,,

\[TS 38.214, clause 6.1.2.3.1\]

The procedures described in this clause apply to PUSCH transmissions of
PUSCH repetition Type A with a Type 1 or Type 2 configured grant.

The higher layer parameter *repK-RV* defines the redundancy version
pattern to be applied to the repetitions. If *cg-RetransmissionTimer* is
provided, the redundancy version for uplink transmission with a
configured grant is determined by the UE. If the parameter *repK-RV* is
not provided in the *configuredGrantConfig* and *cg-RetransmissionTimer*
is not provided, the redundancy version for uplink transmissions with a
configured grant shall be set to 0. If the parameter *repK-RV* is
provided in the *configuredGrantConfig* and *cg-RetransmissionTimer* is
not provided, for the *n*th transmission occasion among *K* repetitions,
*n*=1, 2, ..., *K*, it is associated with *(mod(((n-mod(n,
N))/N)-1,4)+1)^th^* value in the configured RV sequence, where *N*=1. If
a configured grant configuration is configured with *startingFromRV0*
set to *\'off\'*, the initial transmission of a transport block may only
start at the first transmission occasion of the *K* repetitions.
Otherwise, the initial transmission of a transport block may start at

\- the first transmission occasion of the *K* repetitions if the
configured RV sequence is {0,2,3,1},

\- any of the transmission occasions of the *K* repetitions that are
associated with RV=0 if the configured RV sequence is {0,3,0,3},

\- any of the transmission occasions of the *K* repetitions if the
configured RV sequence is {0,0,0,0}, except the last transmission
occasion when *Kâ¥8*.

...

For any RV sequence, the repetitions shall be terminated after
transmitting *K* repetitions, or at the last transmission occasion among
the *K* repetitions within the period *P*, or from the starting symbol
of the repetition that overlaps with a PUSCH with the same HARQ process
scheduled by DCI format 0\_0, 0\_1 or 0\_2, whichever is reached first.
In addition, the UE shall terminate the repetition of a transport block
in a PUSCH transmission if the UE receives a DCI format 0\_1 with DFI
flag provided and set to \'1\', and if in this DCI the UE detects ACK
for the HARQ process corresponding to that transport block.

The UE is not expected to be configured with the time duration for the
transmission of *K* repetitions larger than the time duration derived by
the periodicity *P*. If the UE determines that, for a transmission
occasion, the number of symbols available for the PUSCH transmission in
a slot is smaller than transmission duration *L*, the UE does not
transmit the PUSCH in the transmission occasion.

For both Type 1 and Type 2 PUSCH transmissions with a configured grant,
when *K \> 1,*

\- For unpaired spectrum:

...

\- Otherwise, the UE shall repeat the TB across the
![](./media/image41.png)![](./media/image41.png) consecutive slots
applying the same symbol allocation in each slot, except if the UE is
provided with higher layer parameters *cg-nrofSlots* and
*cg-nrofPUSCH-InSlot*, in which case the UE repeats the TB in the *repK*
earliest consecutive transmission occasion candidates within the same
configuration.

\- For paired spectrum and SUL band:

\- The UE shall repeat the TB across the
![](./media/image41.png)![](./media/image41.png) consecutive slots
applying the same symbol allocation in each slot, except if the UE is
provided with higher layer parameters *cg-nrofSlots* and
*cg-nrofPUSCH-InSlot*, in which case the UE repeats the TB in the *repK*
earliest consecutive transmission occasion candidates within the same
configuration.

...

A Type 1 or Type 2 PUSCH transmission with a configured grant in a slot
is omitted according to the conditions in Clause 9, Clause 11.1, Clause
11.2A, Clause 15 and Clause 17.2 of \[6, TS 38.213\].

\[TS 38.214, clause 6.1.4\]

To determine the modulation order, target code rate, redundancy version
and transport block size for the physical uplink shared channel, the UE
shall first

> \- read the 5-bit modulation and coding scheme field
> ![](./media/image22.wmf)in the DCI to determine the modulation order
> ![](./media/image23.wmf) and target code rate (*R*) based on the
> procedure defined in Subclause 6.1.4.1
>
> \- read redundancy version field (*rv*) in the DCI to determine the
> redundancy version, and
>
> \- \[check the \"CSI request\" bit field\]

and second

> \- the UE shall use the number of layers ![](./media/image24.wmf), the
> total number of allocated PRBs ![](./media/image25.wmf) to determine
> the transport block size based on the procedure defined in Subclause
> 6.1.4.2.

\[TS 38.321, clause 5.4.1\]

Uplink grant is either received dynamically on the PDCCH, in a Random
Access Response, or configured semi-persistently by RRC. The MAC entity
shall have an uplink grant to transmit on the UL-SCH. To perform the
requested transmissions, the MAC layer receives HARQ information from
lower layers.

If the MAC entity has a C-RNTI, a Temporary C-RNTI, or CS-RNTI, the MAC
entity shall for each PDCCH occasion and for each Serving Cell belonging
to a TAG that has a running *timeAlignmentTimer* and for each grant
received for this PDCCH occasion:

> ...

1\> else if an uplink grant for this PDCCH occasion has been received
for this Serving Cell on the PDCCH for the MAC entity\'s CS-RNTI:

...

2\> else if the NDI in the received HARQ information is 0:

3\> if PDCCH contents indicate configured grant Type 2 deactivation:

4\> trigger configured uplink grant confirmation.

3\> else if PDCCH contents indicate configured grant Type 2 activation:

4\> trigger configured uplink grant confirmation;

4\> store the uplink grant for this Serving Cell and the associated HARQ
information as configured uplink grant;

4\> initialise or re-initialise the configured uplink grant for this
Serving Cell to start in the associated PUSCH duration and to recur
according to rules in clause 5.8.2;

4\> stop the *configuredGrantTimer* for the corresponding HARQ process,
if running;

For each Serving Cell and each configured uplink grant, if configured
and activated, the MAC entity shall:

1\> if the PUSCH duration of the configured uplink grant does not
overlap with the PUSCH duration of an uplink grant received on the PDCCH
or in a Random Access Response for this Serving Cell:

2\> set the HARQ Process ID to the HARQ Process ID associated with this
PUSCH duration;

2\> if the *configuredGrantTimer* for the corresponding HARQ process is
not running:

3\> consider the NDI bit for the corresponding HARQ process to have been
toggled;

3\> deliver the configured uplink grant and the associated HARQ
information to the HARQ entity.

For configured uplink grants, the HARQ Process ID associated with the
first symbol of a UL transmission is derived from the following
equation:

HARQ Process ID = \[floor(CURRENT\_symbol/*periodicity*)\] modulo
*nrofHARQ-Processes*

where CURRENT\_symbol = (SFN Ã *numberOfSlotsPerFrame* Ã
*numberOfSymbolsPerSlot* + slot number in the frame Ã
*numberOfSymbolsPerSlot* + symbol number in the slot), and
*numberOfSlotsPerFrame* and *numberOfSymbolsPerSlot* refer to the number
of consecutive slots per frame and the number of consecutive symbols per
slot, respectively as specified in TS 38.211 \[8\].

NOTE 1: CURRENT\_symbol refers to the symbol index of the first
transmission occasion of a bundle of configured uplink grant.

NOTE 2: A HARQ process is configured for a configured uplink grant if
the configured uplink grant is activated and the associated HARQ process
ID is less than *nrofHARQ-Processes*.

NOTE 3: If the MAC entity receives both a grant in a Random Access
Response and an overlapping grant for its C-RNTI or CS-RNTI, requiring
concurrent transmissions on the SpCell, the MAC entity may choose to
continue with either the grant for its RA-RNTI or the grant for its
C-RNTI or CS-RNTI.

\[TS 38.321, clause 5.4.2.1\]

The MAC entity includes a HARQ entity for each Serving Cell with
configured uplink (including the case when it is configured with
*supplementaryUplink*), which maintains a number of parallel HARQ
processes.

The number of parallel UL HARQ processes per HARQ entity is specified in
TS 38.214 \[7\].

Each HARQ process supports one TB.

Each HARQ process is associated with a HARQ process identifier. For UL
transmission with UL grant in RA Response or for UL transmission for
MSGA payload, HARQ process identifier 0 is used.

...

The maximum number of transmissions of a TB within a bundle of the
dynamic grant or configured grant or the uplink grant received in a MAC
RAR is given by *REPETITION\_NUMBER* as follows:

> \- For a dynamic grant, *REPETITION\_NUMBER* is set to a value
> provided by lower layers, as specified in clause 6.1.2.1 of TS 38.214
> \[7\];
>
> ...

If *REPETITION\_NUMBER* \> 1, after the first transmission within a
bundle, at most *REPETITION\_NUMBER* -- 1 HARQ retransmissions follow
within the bundle. For both dynamic grant and configured uplink grant,
and uplink grant received in a MAC RAR bundling operation relies on the
HARQ entity for invoking the same HARQ process for each transmission
that is part of the same bundle. Within a bundle, HARQ retransmissions
are triggered without waiting for feedback from previous transmission
according to *REPETITION\_NUMBER* for a dynamic grant or configured
uplink grant or uplink grant received in a MAC RAR unless they are
terminated as specified in clause 6.1 of TS 38.214 \[7\]. Each
transmission within a bundle is a separate uplink grant delivered to the
HARQ entity.

For each transmission within a bundle of the dynamic grant or uplink
grant received in a MAC RAR, the sequence of redundancy versions is
determined according to clause 6.1.2.1 of TS 38.214 \[7\]. For each
transmission within a bundle of the configured uplink grant, the
sequence of redundancy versions is determined according to clause
6.1.2.3 of TS 38.214 \[7\].

For each uplink grant, the HARQ entity shall:

> 1\> identify the HARQ process associated with this grant, and for each
> identified HARQ process:
>
> 2\> if the received grant was not addressed to a Temporary C-RNTI on
> PDCCH, and the NDI provided in the associated HARQ information has
> been toggled compared to the value in the previous transmission of
> this TB of this HARQ process; or
>
> ...
>
> 3\> if a MAC PDU to transmit has been obtained:
>
> 4\> if the uplink grant is not a configured grant configured with
> *autonomousTx*; or
>
> 4\> if the uplink grant is a prioritized uplink grant:
>
> 5\> deliver the MAC PDU and the uplink grant and the HARQ information
> of the TB to the identified HARQ process;
>
> 5\> instruct the identified HARQ process to trigger a new
> transmission;
>
> ...
>
> 2\> else (i.e. retransmission):
>
> ...
>
> 3\> else:
>
> 4\> deliver the uplink grant and the HARQ information (redundancy
> version) of the TB to the identified HARQ process;
>
> 4\> instruct the identified HARQ process to trigger a retransmission;
>
> ....

\[TS 38.321, clause 5.4.2.2\]

Each HARQ process is associated with a HARQ buffer.

New transmissions are performed on the resource and with the MCS
indicated on PDCCH or indicated in the Random Access Response (i.e. MAC
RAR or fallbackRAR), or signalled in RRC or determined as specified in
clause 5.1.2a for MSGA payload. Retransmissions are performed on the
resource and, if provided, with the MCS indicated on PDCCH, or on the
same resource and with the same MCS as was used for last made
transmission attempt within a bundle, or on stored configured uplink
grant resources and stored MCS when *cg-RetransmissionTimer* or
*cg-SDT-RetransmissionTimer* is configured. If *cg-RetransmissionTimer*
is configured, retransmissions with the same HARQ process may be
performed on any configured grant configuration if the configured grant
configurations have the same TBS. If *cg-SDT-RetransmissionTimer* is
configured, retransmission for the initial CG-SDT transmission with the
same HARQ process may be performed on any configured grant configuration
if the configured grant configurations have the same TBS.

...

If the HARQ entity requests a new transmission for a TB, the HARQ
process shall:

1\> store the MAC PDU in the associated HARQ buffer;

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

If the HARQ entity requests a retransmission for a TB, the HARQ process
shall:

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

To generate a transmission for a TB, the HARQ process shall:

...

1\> if there is no measurement gap at the time of the transmission and,
in case of retransmission, the retransmission does not collide with a
transmission for a MAC PDU obtained from the Msg3 buffer or the MSGA
buffer:

2\> if there are neither NR sidelink transmission nor transmission of
V2X sidelink communication at the time of the transmission; or

...

3\> instruct the physical layer to generate a transmission according to
the stored uplink grant.

...

\[38.321 clause 5.8.2\]

There are two types of transmission without dynamic grant:

\- configured grant Type 1 where an uplink grant is provided by RRC, and
stored as configured uplink grant;

\- configured grant Type 2 where an uplink grant is provided by PDCCH,
and stored or cleared as configured uplink grant based on L1 signalling
indicating configured uplink grant activation or deactivation.

Type 1 and Type 2 are configured by RRC for a Serving Cell per BWP.
Multiple configurations can be active simultaneously only on different
Serving Cells. For Type 2, activation and deactivation are independent
among the Serving Cells. For the same Serving Cell, the MAC entity is
configured with either Type 1 or Type 2.

RRC configures the following parameters when the configured grant Type 1
is configured:

\- *cs-RNTI*: CS-RNTI for retransmission;

\- *periodicity*: periodicity of the configured grant Type 1;

\- *timeDomainOffset*: Offset of a resource with respect to SFN = 0 in
time domain;

\- *timeDomainAllocation*: Allocation of configured uplink grant in time
domain which contains *startSymbolAndLength* (i.e. *SLIV* in TS 38.214
\[7\]);

\- *nrofHARQ-Processes*: the number of HARQ processes for configured
grant.

RRC configures the following parameters when the configured grant Type 2
is configured:

\- *cs-RNTI*: CS-RNTI for activation, deactivation, and retransmission;

\- *periodicity*: periodicity of the configured grant Type 2;

\- *nrofHARQ-Processes*: the number of HARQ processes for configured
grant.

Upon configuration of a configured grant Type 1 for a BWP of a Serving
Cell by upper layers, the MAC entity shall:

1\> store the uplink grant provided by upper layers as a configured
uplink grant for the indicated BWP of the Serving Cell;

1\> initialise or re-initialise the configured uplink grant to start in
the symbol according to *timeDomainOffset* and *S* (derived from *SLIV*
as specified in TS 38.214 \[7\]), and to reoccur with *periodicity*.

After an uplink grant is configured for a configured grant Type 1, the
MAC entity shall consider that the uplink grant recurs associated with
each symbol for which:

\[(SFN Ã *numberOfSlotsPerFrame* Ã *numberOfSymbolsPerSlot*) + (slot
number in the frame Ã *numberOfSymbolsPerSlot*) + symbol number in the
slot\] =\
(*timeDomainOffset* Ã *numberOfSymbolsPerSlot* + *S* + N Ã
*periodicity*) modulo (1024 Ã *numberOfSlotsPerFrame* Ã
*numberOfSymbolsPerSlot*), for all N \>= 0.

After an uplink grant is configured for a configured grant Type 2, the
MAC entity shall consider that the uplink grant recurs associated with
each symbol for which:

\[(SFN Ã *numberOfSlotsPerFrame* Ã *numberOfSymbolsPerSlot*) + (slot
number in the frame Ã *numberOfSymbolsPerSlot*) + symbol number in the
slot\] =\
\[(SFN~start\ time~ Ã *numberOfSlotsPerFrame* Ã *numberOfSymbolsPerSlot*
+ slot~start\ time~ Ã *numberOfSymbolsPerSlot* + symbol~start\ time~) +
N Ã *periodicity*\] modulo (1024 Ã *numberOfSlotsPerFrame* Ã
*numberOfSymbolsPerSlot*), for all N \>= 0.

where SFN~start\ time~, slot~start\ time~, and symbol~start\ time~ are
the SFN, slot, and symbol, respectively, of the first transmission
opportunity of PUSCH where the configured uplink grant was
(re-)initialised.

...

7.1.1.3.14.4.3 Test description

7.1.1.3.14.4.3.1 Pre-test conditions

Same Pre-test conditions as in clause 7.1.1.0 except that DRB is
configured in RLC AM mode according to Table 7.1.1.3.14.4.3.1-1.

**Table 7.1.1.3.14.4.3.1-1: RLC parameters**

  -------------------- ------
  *t-PollRetransmit*   ms80
  -------------------- ------

7.1.1.3.14.4.3.2 Test procedure sequence

**Table 7.1.1.3.14.4.3.2-1: Main behaviour**

+--------+------------+------------+------------+------------+----+
| **St** | **P        | **Message  | **TP**     | *          |    |
|        | rocedure** | Sequence** |            | *Verdict** |    |
+========+============+============+============+============+====+
|        |            | **U - S**  | *          |            |    |
|        |            |            | *Message** |            |    |
+--------+------------+------------+------------+------------+----+
| 1      | SS         | \<\-\--    | NR RRC:    | \-         | \- |
|        | transmits  |            | *RRCReconf |            |    |
|        | an         |            | iguration* |            |    |
|        | RRCRecon   |            |            |            |    |
|        | figuration |            |            |            |    |
|        | message    |            |            |            |    |
|        | including  |            |            |            |    |
|        | C          |            |            |            |    |
|        | onfiguredG |            |            |            |    |
|        | rantConfig |            |            |            |    |
|        | and        |            |            |            |    |
|        | availa     |            |            |            |    |
|        | bleSlotCou |            |            |            |    |
|        | nting-r17. |            |            |            |    |
|        |            |            |            |            |    |
|        | NOTE: For  |            |            |            |    |
|        | EN-DC. the |            |            |            |    |
|        | RRCRecon   |            |            |            |    |
|        | figuration |            |            |            |    |
|        | message is |            |            |            |    |
|        | embedded   |            |            |            |    |
|        | in         |            |            |            |    |
|        | RRCConne   |            |            |            |    |
|        | ctionRecon |            |            |            |    |
|        | figuration |            |            |            |    |
|        | specified  |            |            |            |    |
|        | in 36.508  |            |            |            |    |
|        | \[7\]      |            |            |            |    |
|        | Table      |            |            |            |    |
|        | 4.6.1-8    |            |            |            |    |
|        | with       |            |            |            |    |
|        | condition  |            |            |            |    |
|        | EN-DC      |            |            |            |    |
|        | \_EmbedNR\ |            |            |            |    |
|        | _RRCRecon. |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 2      | UE         | \--\>      | NR RRC:    | \-         | \- |
|        | transmits  |            | *RRCReco   |            |    |
|        | an         |            | nfiguratio |            |    |
|        | RRCRec     |            | nComplete* |            |    |
|        | onfigurati |            |            |            |    |
|        | onComplete |            |            |            |    |
|        | message.   |            |            |            |    |
|        |            |            |            |            |    |
|        | NOTE: For  |            |            |            |    |
|        | EN-DC, the |            |            |            |    |
|        | RRCRec     |            |            |            |    |
|        | onfigurati |            |            |            |    |
|        | onComplete |            |            |            |    |
|        | message is |            |            |            |    |
|        | embedded   |            |            |            |    |
|        | in         |            |            |            |    |
|        | RRCCon     |            |            |            |    |
|        | nectionRec |            |            |            |    |
|        | onfigurati |            |            |            |    |
|        | onComplete |            |            |            |    |
|        | specified  |            |            |            |    |
|        | in 36.508  |            |            |            |    |
|        | \[7\]      |            |            |            |    |
|        | Table      |            |            |            |    |
|        | 4.6.1-9    |            |            |            |    |
|        | with       |            |            |            |    |
|        | condition  |            |            |            |    |
|        | MCG        |            |            |            |    |
|        | \_and\_SCG |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 3      | IF         |            |            |            |    |
|        | pc\_type   |            |            |            |    |
|        | 1\_PUSCH\_ |            |            |            |    |
|        | Repetition |            |            |            |    |
|        | MultiSlots |            |            |            |    |
|        | = FALSE,   |            |            |            |    |
|        | the SS     |            |            |            |    |
|        | sends a    |            |            |            |    |
|        | DCI to     |            |            |            |    |
|        | activate   |            |            |            |    |
|        | the        |            |            |            |    |
|        | configured |            |            |            |    |
|        | grant      |            |            |            |    |
|        | which is   |            |            |            |    |
|        | sufficient |            |            |            |    |
|        | to         |            |            |            |    |
|        | transmit   |            |            |            |    |
|        | the MAC    |            |            |            |    |
|        | SDU to     |            |            |            |    |
|        | loop back  |            |            |            |    |
|        | in a slot. |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 4      | The SS     | \<\-\--    | MAC PDU    | \-         | \- |
|        | transmits  |            |            |            |    |
|        | a valid    |            |            |            |    |
|        | MAC PDU    |            |            |            |    |
|        | containing |            |            |            |    |
|        | one RLC    |            |            |            |    |
|        | PDU.       |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 5      | Check:     | \--\>      | MAC PDU    | 1          | P  |
|        | Does the   |            |            |            |    |
|        | UE         |            |            |            |    |
|        | transmit a |            |            |            |    |
|        | MAC PDU    |            |            |            |    |
|        | including  |            |            |            |    |
|        | one RLC    |            |            |            |    |
|        | SDU and    |            |            |            |    |
|        | repeat     |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmitting |            |            |            |    |
|        | this MAC   |            |            |            |    |
|        | PDU in the |            |            |            |    |
|        | next 3     |            |            |            |    |
|        | slots      |            |            |            |    |
|        | which are  |            |            |            |    |
|        | suitable   |            |            |            |    |
|        | for UL     |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmission |            |            |            |    |
|        | with same  |            |            |            |    |
|        | resource   |            |            |            |    |
|        | allocation |            |            |            |    |
|        | but        |            |            |            |    |
|        | different  |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version?   |            |            |            |    |
|        |            |            |            |            |    |
|        | NOTE: The  |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version    |            |            |            |    |
|        | for the    |            |            |            |    |
|        | first      |            |            |            |    |
|        | tr         |            |            |            |    |
|        | ansmission |            |            |            |    |
|        | and all    |            |            |            |    |
|        | possible   |            |            |            |    |
|        | r          |            |            |            |    |
|        | epetitions |            |            |            |    |
|        | are set in |            |            |            |    |
|        | the        |            |            |            |    |
|        | following  |            |            |            |    |
|        | order {0,  |            |            |            |    |
|        | 2, 3, 1}   |            |            |            |    |
|        | according  |            |            |            |    |
|        | to         |            |            |            |    |
|        | repK-RV.   |            |            |            |    |
|        | Usage of   |            |            |            |    |
|        | correct    |            |            |            |    |
|        | redundancy |            |            |            |    |
|        | version is |            |            |            |    |
|        | implicitly |            |            |            |    |
|        | checked    |            |            |            |    |
|        | upon       |            |            |            |    |
|        | correct    |            |            |            |    |
|        | decoding   |            |            |            |    |
|        | by the SS  |            |            |            |    |
|        | of the UE  |            |            |            |    |
|        | UL         |            |            |            |    |
|        | r          |            |            |            |    |
|        | epetitions |            |            |            |    |
+--------+------------+------------+------------+------------+----+
| 6      | SS         | \<\--      | MAC PDU    | \-         |    |
|        | transmits  |            | (RLC       |            |    |
|        | a MAC PDU  |            | STATUS     |            |    |
|        | containing |            | PDU)       |            |    |
|        | an RLC     |            |            |            |    |
|        | STATUS PDU |            |            |            |    |
|        | ack        |            |            |            |    |
|        | nowledging |            |            |            |    |
|        | the        |            |            |            |    |
|        | reception  |            |            |            |    |
|        | of the AMD |            |            |            |    |
|        | PDU in     |            |            |            |    |
|        | step 4.    |            |            |            |    |
+--------+------------+------------+------------+------------+----+

7.1.1.3.14.4.3.3 Specific message contents

**Table 7.1.1.3.14.4.3.3-1: *RRCReconfiguration* (Step 1, Table
7.1.1.3.14.4.3.2-1)**

  Derivation Path: 38.508-1 \[4\], Table 4.6.1-13                                                 
  ------------------------------------------------- ------------------ -------------------------- ---------------
  **Information Element**                           **Value/remark**   **Comment**                **Condition**
  RRCReconfiguration ::= SEQUENCE {                                                               
  criticalExtensions CHOICE {                                                                     
  rrcReconfiguration SEQUENCE {                                                                   
  secondaryCellGroup                                CellGroupConfig    Table 7.1.1.3.14.4.3.3-2   EN-DC
                                                    Not present                                   NR
  nonCriticalExtension                              Not present                                   EN-DC
  nonCriticalExtension SEQUENCE {                                                                 NR
  masterCellGroup                                   CellGroupConfig    Table 7.1.1.3.14.4.3.3-2   
  }                                                                                               
  }                                                                                               
  }                                                                                               
  }                                                                                               

**Table 7.1.1.3.14.4.3.3-2: *CellGroupConfig* (Table
7.1.1.3.14.4.3.3-1)**

  Derivation Path: 38.508-1 \[4\], Table 4.6.3-19                                                    
  ------------------------------------------------- --------------------- -------------------------- ---------------
  **Information Element**                           **Value/remark**      **Comment**                **Condition**
  cellGroupConfig::= SEQUENCE {                                                                      
  cellGroupId                                       0                                                NR
                                                    1                                                EN-DC
  spCellConfig SEQUENCE {                                                                            
  servCellIndex                                     Not present                                      NR
                                                    1                                                EN-DC
  spCellConfigDedicated SEQUENCE {                                                                   
  servingCellConfig                                 *ServingCellConfig*   Table 7.1.1.3.14.4.3.3-3   
  }                                                                                                  
  }                                                                                                  
  }                                                                                                  

**Table 7.1.1.3.14.4.3.3-3: *ServingCellConfig* (Table
7.1.1.3.14.4.3.3-2)**

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167                                                      
  ----------------------------------------------------- ----------------------- -------------------------- ---------------
  **Information Element**                               **Value/remark**        **Comment**                **Condition**
  ServingCellConfig ::= SEQUENCE {                                                                         
  uplinkConfig SEQUENCE {                                                                                  
  initialUplinkBWP SEQUENCE {                                                                              
  pusch-Config CHOICE {                                                                                    
  setup SEQUENCE {                                                                                         
  availableSlotCounting-r17                             true                                               
  }                                                                                                        
  }                                                                                                        
  configuredGrantConfig CHOICE {                                                                           
  setup                                                 ConfiguredGrantConfig   Table 7.1.1.3.14.4.3.3-4   
  }                                                                                                        
  }                                                                                                        
  }                                                                                                        
  }                                                                                                        

Table 7.1.1.3.14.4.3.3-5: *ConfiguredGrantConfig* (Table
7.1.1.3.14.4.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-26 with condition CG\_Config\_Type1                                    
  ------------------------------------------------------------------------------------- ------------------ ------------- --------------------------------------------
  **Information Element**                                                               **Value/remark**   **Comment**   **Condition**
  ConfiguredGrantConfig ::= SEQUENCE {                                                                                   
  repK                                                                                  n4                               
  repK-RV                                                                               s1-0231                          
  rrc-ConfiguredUplinkGrant                                                             Not present                      NOT pc\_type1\_PUSCH\_RepetitionMultiSlots
  }                                                                                                                      

##### 7.1.1.3.15 Correct Handling of UL HARQ process / TBoMS procedure

###### 7.1.1.3.15.1 Correct Handling of UL HARQ process / TBoMS procedure / DG and CG based transmission

##### 7.1.1.3.15.1.1 Test Purpose (TP) {#test-purpose-tp-14 .H6}

##### (1) {#section-49 .H6}

**with** { UE in RRC\_CONNECTED state and supporting TB processing over
multi-slot}

**ensure that** {

**when** { UE has data available for transmission and receives an UL
Grant with toggled NDI indicating TBoMS transmission }

**then** { UE transmits a new MAC PDU in numberOfSlotsTBoMS available
slots and selects the redundancy version correctly }

}

##### (2) {#section-50 .H6}

**with** { UE in RRC\_CONNECTED state and supporting TB processing over
multi-slot}

**ensure that** {

**when** { UE has data available for transmission and receives an DCI
activating Type 2 configured grant indicating TBoMS transmission }

**then** { UE transmits a new MAC PDU in numberOfSlotsTBoMS available
slots and selects the redundancy version correctly }

}

7.1.1.3.15.1.2 Conformance requirements

References: The conformance requirements covered in the present TC are
specified in: TS 38.214 clauses 6.1.2.1 and 6.1.4, TS 38.321 clauses
5.4.1, 5.4.2.1 and 5.4.2.2. Unless otherwise stated these are Rel-17
requirements.

\[TS 38.214, clause 6.1.2.1\]

When the UE is scheduled to transmit a transport block and no CSI report
by a DCI or by a RAR UL grant or fallbackRAR UL grant, or the UE is
scheduled to transmit a transport block and a CSI report(s) on PUSCH by
a DCI, the \'*Time domain resource assignment\'* field value *m* of the
DCI or the *PUSCH time resource allocation* field value *m* of the RAR
UL grant or of the fallbackRAR UL grant provides a row index *m* + 1 to
an allocated table. The determination of the used resource allocation
table is defined in Clause 6.1.2.1.1. The indexed row defines the slot
offset *K~2~*, the start and length indicator *SLIV*, or directly the
start symbol *S* and the allocation length *L*, the PUSCH mapping type,
the number of slots used for TBS determination (if *numberOfSlotsTBoMS*
is present in the resource allocation table), and the number of
repetitions (if *numberOfRepetitions* is present in the resource
allocation table) to be applied in the PUSCH transmission.

...

\- For PUSCH repetition Type A and TB processing over multiple slots,
the starting symbol *S* relative to the start of the slot, and the
number of consecutive symbols *L* counting from the symbol *S* allocated
for the PUSCH are determined from the start and length indicator *SLIV*
of the indexed row:

> if then
>
> else
>
> where, and

...

\- For PUSCH repetition Type A and TB processing over multiple slots,
the PUSCH mapping type is set to Type A or Type B as defined in Clause
6.4.1.1.3 of \[4, TS 38.211\] as given by the indexed row.

The UE shall consider the *S* and *L* combinations defined in table
6.1.2.1-1 as valid PUSCH allocations

Table 6.1.2.1-1: Valid *S* and *L* combinations

  PUSCH mapping type                Normal cyclic prefix   Extended cyclic prefix                                                                                                   
  --------------------------------- ---------------------- ------------------------ -------------------------------------------------------------------- ------------- ------------ --------------------------------------------------------------------
                                    *S*                    *L*                      *S+L*                                                                *S*           *L*          *S+L*
  Type A (repetition Type A only)   0                      {4,...,14}               {4,...,14}                                                           0             {4,...,12}   {4,...,12}
  Type B                            {0,...,13}             {1,...,14}               {1,...,14} for repetition Type A, {1,...,27} for repetition Type B   {0,..., 11}   {1,...,12}   {1,...,12} for repetition Type A, {1,...,23} for repetition Type B

For TB processing over multiple slots, when transmitting PUSCH scheduled
by DCI format 0\_1 or 0\_2 in PDCCH with CRC scrambled with C-RNTI,
MCS-C-RNTI, or CS-RNTI with NDI=1,

> \- the number of slots used for TBS determination *N* is indicated by
> *numberOfSlotsTBoMS.*
>
> \- the number of repetitions *K* of the number of slots *N* used for
> TBS determination is determined as
>
> \- if *numberOfRepetitions* is present in the resource allocation
> table, the number of repetitions *K* is equal to
> *numberOfRepetitions*;
>
> \- otherwise, *K=1*.
>
> \- when the UE supports repetition of TB processing over multiple
> slots, the UE does not expect that $N \bullet K$ is larger than 32.

...

For unpaired spectrum:

...

\- The UE determines $N \bullet K$ slots for a PUSCH transmission of TB
processing over multiple slots scheduled by DCI format 0\_1 or 0\_2,
based on *tdd-UL-DL-ConfigurationCommon*,
*tdd-UL-DL-ConfigurationDedicated* and *ssb-PositionsInBurst*, and the
TDRA information field value in the DCI format 0\_1 or 0\_2.

\- A slot is not counted in the number of $N \bullet K$ slots for a
PUSCH transmission of TB processing over multiple slots if at least one
of the symbols indicated by the indexed row of the used resource
allocation table in the slot overlaps with a DL symbol indicated by
*tdd-UL-DL-ConfigurationCommon* or *tdd-UL-DL-ConfigurationDedicated* if
provided, or a symbol of an SS/PBCH block with index provided by
*ssb-PositionsInBurst*.

> ...

For paired spectrum and SUL band:

\- The UE determines $N \bullet K$ consecutive slots for a PUSCH
transmission of a PUSCH repetition type A scheduled by DCI format 0\_1
or 0\_2, or for a PUSCH transmission of TB processing over multiple
slots scheduled by DCI format 0\_1 or 0\_2, based on the TDRA
information field value in the DCI format 0\_1 or 0\_2.

...

If a UE would transmit a PUSCH of PUSCH repetition Type A when
*AvailableSlotCounting* is enabled and K\>1 or a TB processing over
multiple slots over $N \bullet K$ slots, and the UE does not transmit
the PUSCH of a TB processing over multiple slots or the PUSCH repetition
Type A in a slot from the $N \bullet K$ slots, according to Clause 9,
Clause 11.1, Clause 11.2A, Clause 15 and Clause 17.2 of \[6, TS
38.213\], the UE counts the slots in the number of $N \bullet K$ slots.

For TB processing over multiple slots:

\- For unpaired spectrum, the same symbol allocation is applied across
the $N \bullet K$ slots determined for the PUSCH transmission and the
PUSCH is limited to a single transmission layer. The UE shall transmit
the TB across the $N \bullet K$ slots determined for the PUSCH
transmission, applying the same symbol allocation in each slot.

\- For paired spectrum or supplementary uplink band, the same symbol
allocation is applied across the $N \bullet K$ consecutive slots and the
PUSCH is limited to a single transmission layer. The UE shall transmit
the TB across the $N \bullet K$ consecutive slots applying the same
symbol allocation in each slot.

...

For a PUSCH transmission scheduled by DCI format 0\_1, or 0\_2, or 0\_0
with CRC scrambled by TC-RNTI, the redundancy version to be applied on
the *n*th transmission occasion of the TB, where n = 0, 1, ...
$N \bullet K$ -1, is determined according to table 6.1.2.1-2.

...

Table 6.1.2.1-2: Redundancy version for PUSCH transmission

  *rv~id\ ~*indicated by the DCI scheduling the PUSCH   *rv~id~* to be applied to *n*^th^ transmission occasion (repetition Type A) or TB processing over multiple slots) or *n*^th^ actual repetition (repetition Type B)                                                                   
  ----------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------------------------- ------------------------------- -------------------------------
                                                        *((n-(n mod N))/N)* mod 4 = 0                                                                                                                                        *((n-(n mod N))/N)* mod 4 = 1   *((n-(n mod N))/N)* mod 4 = 2   *((n-(n mod N))/N)* mod 4 = 3
  0                                                     0                                                                                                                                                                    2                               3                               1
  2                                                     2                                                                                                                                                                    3                               1                               0
  3                                                     3                                                                                                                                                                    1                               0                               2
  1                                                     1                                                                                                                                                                    0                               2                               3

For PUSCH repetition Type A and TB processing over multiple slots, a
PUSCH transmission in a slot of a multi-slot PUSCH transmission is
omitted according to the conditions in Clause 9, Clause 11.1, Clause
11.2A, Clause 15 and Clause 17.2 of \[6, TS 38.213\].

\[TS 38.214, clause 6.1.2.3\]

When PUSCH resource allocation is semi-statically configured by higher
layer parameter *configuredGrantConfig in BWP-UplinkDedicated
information element*, and the PUSCH transmission corresponding to a
configured grant, the following higher layer parameters are applied in
the transmission:

...

\- For Type 2 PUSCH transmissions with a configured grant: the resource
allocation follows the higher layer configuration according to \[10, TS
38.321\], and UL grant received on the DCI.

\- The PUSCH repetition type and the time domain resource allocation
table are determined by the PUSCH repetition type and the time domain
resource allocation table associated with the UL grant received on the
DCI, respectively, as defined in Clause 6.1.2.1. The value of K~offset~,
if configured, is applied when determining the first transmission
opportunity.

For PUSCH transmissions with a Type 1 or Type 2 configured grant, the
number of (nominal) repetitions *K* to be applied to the transmitted
transport block is provided by the indexed row in the time domain
resource allocation table if *numberOfRepetitions* is present in the
table; otherwise *K* is provided by the higher layer configured
parameters *repK.*

...

The UE shall not transmit anything on the resources configured by
*configuredGrantConfig* if the higher layers did not deliver a transport
block to transmit on the resources allocated for uplink transmission
without grant.

...

\[TS 38.214, clause 6.1.4\]

To determine the modulation order, target code rate, redundancy version
and transport block size for the physical uplink shared channel, the UE
shall first

> \- read the 5-bit modulation and coding scheme field
> ![](./media/image22.wmf)in the DCI to determine the modulation order
> ![](./media/image23.wmf) and target code rate (*R*) based on the
> procedure defined in Subclause 6.1.4.1
>
> \- read redundancy version field (*rv*) in the DCI to determine the
> redundancy version, and
>
> \- \[check the \"CSI request\" bit field\]

and second

> \- the UE shall use the number of layers ![](./media/image24.wmf), the
> total number of allocated PRBs ![](./media/image25.wmf) to determine
> the transport block size based on the procedure defined in Subclause
> 6.1.4.2.

\[TS 38.321, clause 5.4.1\]

Uplink grant is either received dynamically on the PDCCH, in a Random
Access Response, configured semi-persistently by RRC or determined to be
associated with the PUSCH resource of MSGA as specified in clause
5.1.2a. The MAC entity shall have an uplink grant to transmit on the
UL-SCH. To perform the requested transmissions, the MAC layer receives
HARQ information from lower layers. An uplink grant addressed to CS-RNTI
with NDI = 0 is considered as a configured uplink grant. An uplink grant
addressed to CS-RNTI with NDI = 1 is considered as a dynamic uplink
grant.

If the MAC entity has a C-RNTI, a Temporary C-RNTI, or CS-RNTI, the MAC
entity shall for each PDCCH occasion and for each Serving Cell belonging
to a TAG that has a running *timeAlignmentTimer* or a running
*cg-SDT-TimeAlignmentTimer* and for each grant received for this PDCCH
occasion:

1\> if an uplink grant for this Serving Cell has been received on the
PDCCH for the MAC entity\'s C-RNTI or Temporary C-RNTI; or

...

2\> if the uplink grant is for MAC entity\'s C-RNTI and if the previous
uplink grant delivered to the HARQ entity for the same HARQ process was
either an uplink grant received for the MAC entity\'s CS-RNTI or a
configured uplink grant:

3\> consider the NDI to have been toggled for the corresponding HARQ
process regardless of the value of the NDI.

...

2\> deliver the uplink grant and the associated HARQ information to the
HARQ entity.

...

\[TS 38.321, clause 5.4.2.1\]

The MAC entity includes a HARQ entity for each Serving Cell with
configured uplink (including the case when it is configured with
*supplementaryUplink*), which maintains a number of parallel HARQ
processes.

The number of parallel UL HARQ processes per HARQ entity is specified in
TS 38.214 \[7\].

Each HARQ process supports one TB.

Each HARQ process is associated with a HARQ process identifier. For UL
transmission with UL grant in RA Response or for UL transmission for
MSGA payload, HARQ process identifier 0 is used.

...

The maximum number of transmissions of a TB within a bundle of the
dynamic grant or configured grant or the uplink grant received in a MAC
RAR is given by *REPETITION\_NUMBER* as follows:

> \- For a dynamic grant, *REPETITION\_NUMBER* is set to a value
> provided by lower layers, as specified in clause 6.1.2.1 of TS 38.214
> \[7\];
>
> ...

If *REPETITION\_NUMBER* \> 1, after the first transmission within a
bundle, at most *REPETITION\_NUMBER* -- 1 HARQ retransmissions follow
within the bundle. For both dynamic grant and configured uplink grant,
and uplink grant received in a MAC RAR bundling operation relies on the
HARQ entity for invoking the same HARQ process for each transmission
that is part of the same bundle. Within a bundle, HARQ retransmissions
are triggered without waiting for feedback from previous transmission
according to *REPETITION\_NUMBER* for a dynamic grant or configured
uplink grant or uplink grant received in a MAC RAR unless they are
terminated as specified in clause 6.1 of TS 38.214 \[7\]. Each
transmission within a bundle is a separate uplink grant delivered to the
HARQ entity.

For each transmission within a bundle of the dynamic grant or uplink
grant received in a MAC RAR, the sequence of redundancy versions is
determined according to clause 6.1.2.1 of TS 38.214 \[7\]. For each
transmission within a bundle of the configured uplink grant, the
sequence of redundancy versions is determined according to clause
6.1.2.3 of TS 38.214 \[7\].

For each uplink grant, the HARQ entity shall:

> 1\> identify the HARQ process associated with this grant, and for each
> identified HARQ process:
>
> 2\> if the received grant was not addressed to a Temporary C-RNTI on
> PDCCH, and the NDI provided in the associated HARQ information has
> been toggled compared to the value in the previous transmission of
> this TB of this HARQ process; or
>
> ...
>
> 3\> if a MAC PDU to transmit has been obtained:
>
> 4\> if the uplink grant is not a configured grant configured with
> *autonomousTx*; or
>
> 4\> if the uplink grant is a prioritized uplink grant:
>
> 5\> deliver the MAC PDU and the uplink grant and the HARQ information
> of the TB to the identified HARQ process;
>
> 5\> instruct the identified HARQ process to trigger a new
> transmission;
>
> ...
>
> 2\> else (i.e. retransmission):
>
> ...
>
> 3\> else:
>
> 4\> deliver the uplink grant and the HARQ information (redundancy
> version) of the TB to the identified HARQ process;
>
> 4\> instruct the identified HARQ process to trigger a retransmission;
>
> ....

\[TS 38.321, clause 5.4.2.2\]

Each HARQ process is associated with a HARQ buffer.

New transmissions are performed on the resource and with the MCS
indicated on PDCCH or indicated in the Random Access Response (i.e. MAC
RAR or fallbackRAR), or signalled in RRC or determined as specified in
clause 5.1.2a for MSGA payload. Retransmissions are performed on the
resource and, if provided, with the MCS indicated on PDCCH, or on the
same resource and with the same MCS as was used for last made
transmission attempt within a bundle, or on stored configured uplink
grant resources and stored MCS when *cg-RetransmissionTimer* or
*cg-SDT-RetransmissionTimer* is configured. If *cg-RetransmissionTimer*
is configured, retransmissions with the same HARQ process may be
performed on any configured grant configuration if the configured grant
configurations have the same TBS. If *cg-SDT-RetransmissionTimer* is
configured, retransmission for the initial CG-SDT transmission with the
same HARQ process may be performed on any configured grant configuration
if the configured grant configurations have the same TBS.

...

If the HARQ entity requests a new transmission for a TB, the HARQ
process shall:

1\> store the MAC PDU in the associated HARQ buffer;

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

If the HARQ entity requests a retransmission for a TB, the HARQ process
shall:

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

To generate a transmission for a TB, the HARQ process shall:

...

1\> if there is no measurement gap at the time of the transmission and,
in case of retransmission, the retransmission does not collide with a
transmission for a MAC PDU obtained from the Msg3 buffer or the MSGA
buffer:

2\> if there are neither NR sidelink transmission nor transmission of
V2X sidelink communication at the time of the transmission; or

...

3\> instruct the physical layer to generate a transmission according to
the stored uplink grant.

...

##### 7.1.1.3.15.1.3 Test description {#test-description-13 .H6}

##### 7.1.1.3.15.1.3.1 Pre-test conditions {#pre-test-conditions-13 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that DRB is
configured in RLC AM mode according to Table 7.1.1.3.15.1.3.1-1.

Table 7.1.1.3.15.1.3.1-1: RLC parameters

  -------------------- ------
  *t-PollRetransmit*   ms80
  -------------------- ------

##### 7.1.1.3.15.1.3.2 Test procedure sequence {#test-procedure-sequence-13 .H6}

Table 7.1.1.3.15.1.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+-----------+----+
| **St**    | **Pr      | **Message | **TP**    | **        |    |
|           | ocedure** | S         |           | Verdict** |    |
|           |           | equence** |           |           |    |
+===========+===========+===========+===========+===========+====+
|           |           | **U - S** | **        |           |    |
|           |           |           | Message** |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 1         | SS        | \<\-\--   | NR RRC:   | \-        | \- |
|           | transmits |           | RRCReconf |           |    |
|           | an        |           | iguration |           |    |
|           | RRCReconf |           |           |           |    |
|           | iguration |           |           |           |    |
|           | message   |           |           |           |    |
|           | to config |           |           |           |    |
|           | Type 2    |           |           |           |    |
|           | c         |           |           |           |    |
|           | onfigured |           |           |           |    |
|           | grant and |           |           |           |    |
|           | PUSCH     |           |           |           |    |
|           | TDRA      |           |           |           |    |
|           | table     |           |           |           |    |
|           | including |           |           |           |    |
|           | numbe     |           |           |           |    |
|           | rOfSlotsT |           |           |           |    |
|           | BoMS-r17. |           |           |           |    |
|           | Note 1    |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 2         | UE        | \--\>     | NR RRC:   | \-        | \- |
|           | transmits |           | RRCRecon  |           |    |
|           | an        |           | figuratio |           |    |
|           | RRCRecon  |           | nComplete |           |    |
|           | figuratio |           |           |           |    |
|           | nComplete |           |           |           |    |
|           | message.  |           |           |           |    |
|           | Note 2    |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 3         | The SS    | \<\-\--   | MAC PDU   | \-        | \- |
|           | transmits |           |           |           |    |
|           | a valid   |           |           |           |    |
|           | MAC PDU   |           |           |           |    |
|           | c         |           |           |           |    |
|           | ontaining |           |           |           |    |
|           | one RLC   |           |           |           |    |
|           | PDU.      |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 4         | The UE    | \--\>     | S         | \-        | \- |
|           | transmits |           | cheduling |           |    |
|           | a         |           | Request   |           |    |
|           | S         |           |           |           |    |
|           | cheduling |           |           |           |    |
|           | Request.  |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 5         | The SS    | \<\--     | DCI       | \-        | \- |
|           | allocates |           | format    |           |    |
|           | an UL     |           | 0\_1      |           |    |
|           | Grant in  |           |           |           |    |
|           | slot n    |           |           |           |    |
|           | which     |           |           |           |    |
|           | satisfies |           |           |           |    |
|           | following |           |           |           |    |
|           | co        |           |           |           |    |
|           | nditions: |           |           |           |    |
|           |           |           |           |           |    |
|           | \-        |           |           |           |    |
|           | s         |           |           |           |    |
|           | ufficient |           |           |           |    |
|           | to        |           |           |           |    |
|           | transmit  |           |           |           |    |
|           | the MAC   |           |           |           |    |
|           | SDU to    |           |           |           |    |
|           | loop back |           |           |           |    |
|           | in 4      |           |           |           |    |
|           | slots;    |           |           |           |    |
|           |           |           |           |           |    |
|           | \- NDI    |           |           |           |    |
|           | indicates |           |           |           |    |
|           | new       |           |           |           |    |
|           | tran      |           |           |           |    |
|           | smission; |           |           |           |    |
|           |           |           |           |           |    |
|           | \- RV     |           |           |           |    |
|           | indicates |           |           |           |    |
|           | rv^ID^ =  |           |           |           |    |
|           | 0;        |           |           |           |    |
|           |           |           |           |           |    |
|           | \- TDRA   |           |           |           |    |
|           | set as    |           |           |           |    |
|           | per table |           |           |           |    |
|           | 7         |           |           |           |    |
|           | .1.1.3.15 |           |           |           |    |
|           | .1.3.3-6; |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 6         | Check:    | \--\>     | MAC PDU   | 1         | P  |
|           | Does the  |           |           |           |    |
|           | UE        |           |           |           |    |
|           | transmit  |           |           |           |    |
|           | a MAC PDU |           |           |           |    |
|           | including |           |           |           |    |
|           | one RLC   |           |           |           |    |
|           | SDU, RV   |           |           |           |    |
|           | 0, and in |           |           |           |    |
|           | 4 slots   |           |           |           |    |
|           | suitable  |           |           |           |    |
|           | for UL    |           |           |           |    |
|           | tra       |           |           |           |    |
|           | nsmission |           |           |           |    |
|           | which     |           |           |           |    |
|           | start     |           |           |           |    |
|           | from n+4? |           |           |           |    |
|           | Note 3    |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 7         | SS        | \<\--     | MAC PDU   | \-        | \- |
|           | transmits |           | (RLC      |           |    |
|           | a MAC PDU |           | STATUS    |           |    |
|           | c         |           | PDU)      |           |    |
|           | ontaining |           |           |           |    |
|           | an RLC    |           |           |           |    |
|           | STATUS    |           |           |           |    |
|           | PDU       |           |           |           |    |
|           | ackn      |           |           |           |    |
|           | owledging |           |           |           |    |
|           | the       |           |           |           |    |
|           | reception |           |           |           |    |
|           | of the    |           |           |           |    |
|           | AMD PDU   |           |           |           |    |
|           | in step   |           |           |           |    |
|           | 6.        |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 8         | The SS    | \<\--     | DCI       | \-        | \- |
|           | sends a   |           | format    |           |    |
|           | DCI to    |           | 0\_1      |           |    |
|           | activate  |           |           |           |    |
|           | the       |           |           |           |    |
|           | c         |           |           |           |    |
|           | onfigured |           |           |           |    |
|           | grant     |           |           |           |    |
|           | which     |           |           |           |    |
|           | satisfies |           |           |           |    |
|           | following |           |           |           |    |
|           | co        |           |           |           |    |
|           | nditions: |           |           |           |    |
|           |           |           |           |           |    |
|           | \-        |           |           |           |    |
|           | s         |           |           |           |    |
|           | ufficient |           |           |           |    |
|           | to        |           |           |           |    |
|           | transmit  |           |           |           |    |
|           | the MAC   |           |           |           |    |
|           | SDU to    |           |           |           |    |
|           | loop back |           |           |           |    |
|           | in 2      |           |           |           |    |
|           | slots.    |           |           |           |    |
|           |           |           |           |           |    |
|           | \- TDRA   |           |           |           |    |
|           | set as    |           |           |           |    |
|           | per table |           |           |           |    |
|           | 7         |           |           |           |    |
|           | .1.1.3.15 |           |           |           |    |
|           | .1.3.3-6; |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 9         | The SS    | \<\-\--   | MAC PDU   | \-        | \- |
|           | transmits |           |           |           |    |
|           | a valid   |           |           |           |    |
|           | MAC PDU   |           |           |           |    |
|           | c         |           |           |           |    |
|           | ontaining |           |           |           |    |
|           | one RLC   |           |           |           |    |
|           | PDU.      |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 10        | Check:    | \--\>     | MAC PDU   | 2         | P  |
|           | Does the  |           |           |           |    |
|           | UE        |           |           |           |    |
|           | transmit  |           |           |           |    |
|           | a MAC PDU |           |           |           |    |
|           | including |           |           |           |    |
|           | one RLC   |           |           |           |    |
|           | SDU, in   |           |           |           |    |
|           | RV 0, and |           |           |           |    |
|           | in 2      |           |           |           |    |
|           | slots     |           |           |           |    |
|           | a         |           |           |           |    |
|           | ssociated |           |           |           |    |
|           | with RV=0 |           |           |           |    |
|           | and       |           |           |           |    |
|           | suitable  |           |           |           |    |
|           | for UL    |           |           |           |    |
|           | tran      |           |           |           |    |
|           | smission? |           |           |           |    |
|           | Note 4    |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 11        | SS        | \<\--     | MAC PDU   | \-        | \- |
|           | transmits |           | (RLC      |           |    |
|           | a MAC PDU |           | STATUS    |           |    |
|           | c         |           | PDU)      |           |    |
|           | ontaining |           |           |           |    |
|           | an RLC    |           |           |           |    |
|           | STATUS    |           |           |           |    |
|           | PDU       |           |           |           |    |
|           | ackn      |           |           |           |    |
|           | owledging |           |           |           |    |
|           | the       |           |           |           |    |
|           | reception |           |           |           |    |
|           | of the    |           |           |           |    |
|           | AMD PDU   |           |           |           |    |
|           | in step   |           |           |           |    |
|           | 10.       |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| Note 1:   |           |           |           |           |    |
| For EN-DC |           |           |           |           |    |
| the NR    |           |           |           |           |    |
| RRCReconf |           |           |           |           |    |
| iguration |           |           |           |           |    |
| message   |           |           |           |           |    |
| is        |           |           |           |           |    |
| contained |           |           |           |           |    |
| in        |           |           |           |           |    |
| R         |           |           |           |           |    |
| RCConnect |           |           |           |           |    |
| ionReconf |           |           |           |           |    |
| iguration |           |           |           |           |    |
| 36.508    |           |           |           |           |    |
| \[7\],    |           |           |           |           |    |
| Table     |           |           |           |           |    |
| 4.6.1-8   |           |           |           |           |    |
| using     |           |           |           |           |    |
| condition |           |           |           |           |    |
| EN-DC\_P  |           |           |           |           |    |
| SCell\_HO |           |           |           |           |    |
| AND       |           |           |           |           |    |
| RBCo      |           |           |           |           |    |
| nfig\_NoK |           |           |           |           |    |
| eyChange. |           |           |           |           |    |
|           |           |           |           |           |    |
| Note 2:   |           |           |           |           |    |
| For EN-DC |           |           |           |           |    |
| the NR    |           |           |           |           |    |
| RRCRecon  |           |           |           |           |    |
| figuratio |           |           |           |           |    |
| nComplete |           |           |           |           |    |
| message   |           |           |           |           |    |
| is        |           |           |           |           |    |
| contained |           |           |           |           |    |
| in        |           |           |           |           |    |
| R         |           |           |           |           |    |
| RCConnect |           |           |           |           |    |
| ionReconf |           |           |           |           |    |
| iguration |           |           |           |           |    |
| Complete. |           |           |           |           |    |
|           |           |           |           |           |    |
| Note 3:   |           |           |           |           |    |
| Usage of  |           |           |           |           |    |
| correct   |           |           |           |           |    |
| r         |           |           |           |           |    |
| edundancy |           |           |           |           |    |
| version   |           |           |           |           |    |
| is        |           |           |           |           |    |
| i         |           |           |           |           |    |
| mplicitly |           |           |           |           |    |
| checked   |           |           |           |           |    |
| upon      |           |           |           |           |    |
| correct   |           |           |           |           |    |
| decoding  |           |           |           |           |    |
| by the SS |           |           |           |           |    |
| of the UE |           |           |           |           |    |
| UL        |           |           |           |           |    |
| tran      |           |           |           |           |    |
| smission. |           |           |           |           |    |
|           |           |           |           |           |    |
| Note 4:   |           |           |           |           |    |
| The       |           |           |           |           |    |
| r         |           |           |           |           |    |
| edundancy |           |           |           |           |    |
| version   |           |           |           |           |    |
| for the   |           |           |           |           |    |
| UL        |           |           |           |           |    |
| tra       |           |           |           |           |    |
| nsmission |           |           |           |           |    |
| is set in |           |           |           |           |    |
| the       |           |           |           |           |    |
| following |           |           |           |           |    |
| order {0, |           |           |           |           |    |
| 2, 3, 1}  |           |           |           |           |    |
| according |           |           |           |           |    |
| to        |           |           |           |           |    |
| repK-RV.  |           |           |           |           |    |
| Usage of  |           |           |           |           |    |
| correct   |           |           |           |           |    |
| r         |           |           |           |           |    |
| edundancy |           |           |           |           |    |
| version   |           |           |           |           |    |
| is        |           |           |           |           |    |
| i         |           |           |           |           |    |
| mplicitly |           |           |           |           |    |
| checked   |           |           |           |           |    |
| upon      |           |           |           |           |    |
| correct   |           |           |           |           |    |
| decoding  |           |           |           |           |    |
| by the SS |           |           |           |           |    |
| of the UE |           |           |           |           |    |
| UL        |           |           |           |           |    |
| tran      |           |           |           |           |    |
| smission. |           |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+

##### 7.1.1.3.15.1.3.3 Specific message contents {#specific-message-contents-13 .H6}

Table 7.1.1.3.15.1.3.3-1: *RRCReconfiguration* (Step 1, Table
7.1.1.3.15.1.3.2-1)

  Derivation Path: 38.508-1 \[4\], Table 4.6.1-13                                                 
  ------------------------------------------------- ------------------ -------------------------- ---------------
  **Information Element**                           **Value/remark**   **Comment**                **Condition**
  RRCReconfiguration ::= SEQUENCE {                                                               
  criticalExtensions CHOICE {                                                                     
  rrcReconfiguration SEQUENCE {                                                                   
  secondaryCellGroup                                CellGroupConfig    Table 7.1.1.3.15.1.3.3-2   EN-DC
                                                    Not present                                   NR
  nonCriticalExtension                              Not present                                   EN-DC
  nonCriticalExtension SEQUENCE {                                                                 NR
  masterCellGroup                                   CellGroupConfig    Table 7.1.1.3.15.1.3.3-2   
  }                                                                                               
  }                                                                                               
  }                                                                                               
  }                                                                                               

Table 7.1.1.3.15.1.3.3-2: *CellGroupConfig* (Table 7.1.1.3.15.1.3.3-1)

  Derivation Path: 38.508-1 \[4\], Table 4.6.3-19                                                    
  ------------------------------------------------- --------------------- -------------------------- ---------------
  **Information Element**                           **Value/remark**      **Comment**                **Condition**
  cellGroupConfig::= SEQUENCE {                                                                      
  cellGroupId                                       0                                                NR
                                                    1                                                EN-DC
  spCellConfig SEQUENCE {                                                                            
  servCellIndex                                     Not present                                      NR
                                                    1                                                EN-DC
  spCellConfigDedicated SEQUENCE {                                                                   
  servingCellConfig                                 *ServingCellConfig*   Table 7.1.1.3.15.1.3.3-3   
  }                                                                                                  
  }                                                                                                  
  }                                                                                                  

Table 7.1.1.3.15.1.3.3-3: *ServingCellConfig* (Table 7.1.1.3.15.1.3.3-2)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167                                                                       
  ----------------------------------------------------- ---------------------------------------- -------------------------- ---------------
  **Information Element**                               **Value/remark**                         **Comment**                **Condition**
  ServingCellConfig ::= SEQUENCE {                                                                                          
  uplinkConfig SEQUENCE {                                                                                                   
  initialUplinkBWP SEQUENCE {                                                                                               
  pusch-Config CHOICE {                                                                                                     
  setup SEQUENCE {                                                                                                          
  pusch-TimeDomainAllocationListDCI-0-1-r16 CHOICE {                                                                        
  setup                                                 PUSCH-TimeDomainResourceAllocationList   Table 7.1.1.3.15.1.3.3-4   
  }                                                                                                                         
  }                                                                                                                         
  }                                                                                                                         
  configuredGrantConfig CHOICE {                                                                                            
  setup                                                 ConfiguredGrantConfig                    Table 7.1.1.3.15.1.3.3-5   
  }                                                                                                                         
  }                                                                                                                         
  }                                                                                                                         
  }                                                                                                                         

Table 7.1.1.3.15.1.3.3-4: *PUSCH-TimeDomainResourceAllocationList*
(Table 7.1.1.3.15.1.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-122A                                                                                                                
  ------------------------------------------------------------------------------------------------------------------------------------------ -------------- --------- -----------
  Information Element                                                                                                                        Value/remark   Comment   Condition
  PUSCH-TimeDomainResourceAllocationList-r16 ::= SEQUENCE (SIZE(1..maxNrofUL-Allocations-r16)) OF PUSCH-TimeDomainResourceAllocation-r16 {   2 entries                
  PUSCH-TimeDomainResourceAllocation-r16\[1\] SEQUENCE {                                                                                                    entry 1   
  puschAllocationList-r16 SEQUENCE (SIZE(1..maxNrofMultiplePUSCHs-r16)) OF PUSCH-Allocation-r16 {                                            1 entry                  
  PUSCH-Allocation-r16\[1\] SEQUENCE {                                                                                                                      entry 1   
  numberOfSlotsTBoMS-r17                                                                                                                     n4                       
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  PUSCH-TimeDomainResourceAllocation-r16\[2\] SEQUENCE {                                                                                                    entry 2   
  puschAllocationList-r16 SEQUENCE (SIZE(1..maxNrofMultiplePUSCHs-r16)) OF PUSCH-Allocation-r16 {                                            1 entry                  
  PUSCH-Allocation-r16\[1\] SEQUENCE {                                                                                                                      entry 1   
  numberOfSlotsTBoMS-r17                                                                                                                     n2                       
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  }                                                                                                                                                                   

Table 7.1.1.3.15.1.3.3-5: *ConfiguredGrantConfig* (Table
7.1.1.3.15.1.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-26                                    
  ---------------------------------------------------- ------------------ ------------- ---------------
  **Information Element**                              **Value/remark**   **Comment**   **Condition**
  ConfiguredGrantConfig ::= SEQUENCE {                                                  
  repK-RV                                              s1-0231                          
  startingFromRV0                                      on                               
  }                                                                                     

Table 7.1.1.3.15.1.3.3-6: Physical layer parameters for DCI format 0\_1
(Steps 5 & 8, Table 7.1.1.3.15.1.3.2-1)

  Derivation path: TS 38.508-1 \[4\] Table 4.3.6.1.1.2-1                                                                                                         
  -------------------------------------------------------- ----------------------------------------------------------------------------------- ----------------- -----------
  Parameter                                                Value                                                                               Value in binary   Condition
  Time domain resource assignment                          Indicating the 1st entry of pusch-TimeDomainAllocationListDCI-0-1-r16 to be used.   "0"               Step 5
                                                           Indicating the 2nd entry of pusch-TimeDomainAllocationListDCI-0-1-r16 to be used.   "1"               Step 8

###### 7.1.1.3.15.2 Correct Handling of UL HARQ process / TBoMS procedure / Repetition of TBoMS

##### 7.1.1.3.15.2.1 Test Purpose (TP) {#test-purpose-tp-15 .H6}

##### (1) {#section-51 .H6}

**with** { UE in RRC\_CONNECTED state and supporting repetition of
TBoMS}

**ensure that** {

**when** { UE has data available for transmission and receives an UL
Grant with toggled NDI indicating TBoMS transmission and repetition }

**then** { UE transmits a new MAC PDU in numberOfSlotsTBoMS available
slots, and then repeats the MAC PDU in numberOfRepetitions-1 times after
first transmission and selects the redundancy version correctly. Each
transmission uses numberOfSlotsTBoMS available slots }

}

##### (2) {#section-52 .H6}

**with** { UE in RRC\_CONNECTED state and supporting repetition of
TBoMS}

**ensure that** {

**when** { UE has data available for transmission and receives an DCI
activating Type 2 configured grant which indicates TBoMS transmission
and repK }

**then** { UE transmits a new MAC PDU in numberOfSlotsTBoMS available
slots, and then repeats the MAC PDU in repK-1 times after first
transmission and selects the redundancy version correctly. Each
transmission uses numberOfSlotsTBoMS available slots }

}

##### 7.1.1.3.15.2.2 Conformance requirements {#conformance-requirements-14 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.214 clauses 6.1.2.1 and 6.1.4, TS 38.321 clauses
5.4.1, 5.4.2.1 and 5.4.2.2. Unless otherwise stated these are Rel-17
requirements.

\[TS 38.214, clause 6.1.2.1\]

When the UE is scheduled to transmit a transport block and no CSI report
by a DCI or by a RAR UL grant or fallbackRAR UL grant, or the UE is
scheduled to transmit a transport block and a CSI report(s) on PUSCH by
a DCI, the \'*Time domain resource assignment\'* field value *m* of the
DCI or the *PUSCH time resource allocation* field value *m* of the RAR
UL grant or of the fallbackRAR UL grant provides a row index *m* + 1 to
an allocated table. The determination of the used resource allocation
table is defined in Clause 6.1.2.1.1. The indexed row defines the slot
offset *K~2~*, the start and length indicator *SLIV*, or directly the
start symbol *S* and the allocation length *L*, the PUSCH mapping type,
the number of slots used for TBS determination (if *numberOfSlotsTBoMS*
is present in the resource allocation table), and the number of
repetitions (if *numberOfRepetitions* is present in the resource
allocation table) to be applied in the PUSCH transmission.

...

\- For PUSCH repetition Type A and TB processing over multiple slots,
the starting symbol *S* relative to the start of the slot, and the
number of consecutive symbols *L* counting from the symbol *S* allocated
for the PUSCH are determined from the start and length indicator *SLIV*
of the indexed row:

> if then
>
> else
>
> where, and

...

\- For PUSCH repetition Type A and TB processing over multiple slots,
the PUSCH mapping type is set to Type A or Type B as defined in Clause
6.4.1.1.3 of \[4, TS 38.211\] as given by the indexed row.

The UE shall consider the *S* and *L* combinations defined in table
6.1.2.1-1 as valid PUSCH allocations

Table 6.1.2.1-1: Valid *S* and *L* combinations

  PUSCH mapping type                Normal cyclic prefix   Extended cyclic prefix                                                                                                   
  --------------------------------- ---------------------- ------------------------ -------------------------------------------------------------------- ------------- ------------ --------------------------------------------------------------------
                                    *S*                    *L*                      *S+L*                                                                *S*           *L*          *S+L*
  Type A (repetition Type A only)   0                      {4,...,14}               {4,...,14}                                                           0             {4,...,12}   {4,...,12}
  Type B                            {0,...,13}             {1,...,14}               {1,...,14} for repetition Type A, {1,...,27} for repetition Type B   {0,..., 11}   {1,...,12}   {1,...,12} for repetition Type A, {1,...,23} for repetition Type B

For TB processing over multiple slots, when transmitting PUSCH scheduled
by DCI format 0\_1 or 0\_2 in PDCCH with CRC scrambled with C-RNTI,
MCS-C-RNTI, or CS-RNTI with NDI=1,

> \- the number of slots used for TBS determination *N* is indicated by
> *numberOfSlotsTBoMS.*
>
> \- the number of repetitions *K* of the number of slots *N* used for
> TBS determination is determined as
>
> \- if *numberOfRepetitions* is present in the resource allocation
> table, the number of repetitions *K* is equal to
> *numberOfRepetitions*;
>
> \- otherwise, *K=1*.
>
> \- when the UE supports repetition of TB processing over multiple
> slots, the UE does not expect that $N \bullet K$ is larger than 32.

...

For unpaired spectrum:

...

\- The UE determines $N \bullet K$ slots for a PUSCH transmission of TB
processing over multiple slots scheduled by DCI format 0\_1 or 0\_2,
based on *tdd-UL-DL-ConfigurationCommon*,
*tdd-UL-DL-ConfigurationDedicated* and *ssb-PositionsInBurst*, and the
TDRA information field value in the DCI format 0\_1 or 0\_2.

\- A slot is not counted in the number of $N \bullet K$ slots for a
PUSCH transmission of TB processing over multiple slots if at least one
of the symbols indicated by the indexed row of the used resource
allocation table in the slot overlaps with a DL symbol indicated by
*tdd-UL-DL-ConfigurationCommon* or *tdd-UL-DL-ConfigurationDedicated* if
provided, or a symbol of an SS/PBCH block with index provided by
*ssb-PositionsInBurst*.

> ...

For paired spectrum and SUL band:

\- The UE determines $N \bullet K$ consecutive slots for a PUSCH
transmission of a PUSCH repetition type A scheduled by DCI format 0\_1
or 0\_2, or for a PUSCH transmission of TB processing over multiple
slots scheduled by DCI format 0\_1 or 0\_2, based on the TDRA
information field value in the DCI format 0\_1 or 0\_2.

...

If a UE would transmit a PUSCH of PUSCH repetition Type A when
*AvailableSlotCounting* is enabled and K\>1 or a TB processing over
multiple slots over $N \bullet K$ slots, and the UE does not transmit
the PUSCH of a TB processing over multiple slots or the PUSCH repetition
Type A in a slot from the $N \bullet K$ slots, according to Clause 9,
Clause 11.1, Clause 11.2A, Clause 15 and Clause 17.2 of \[6, TS
38.213\], the UE counts the slots in the number of $N \bullet K$ slots.

For TB processing over multiple slots:

\- For unpaired spectrum, the same symbol allocation is applied across
the $N \bullet K$ slots determined for the PUSCH transmission and the
PUSCH is limited to a single transmission layer. The UE shall transmit
the TB across the $N \bullet K$ slots determined for the PUSCH
transmission, applying the same symbol allocation in each slot.

\- For paired spectrum or supplementary uplink band, the same symbol
allocation is applied across the $N \bullet K$ consecutive slots and the
PUSCH is limited to a single transmission layer. The UE shall transmit
the TB across the $N \bullet K$ consecutive slots applying the same
symbol allocation in each slot.

...

For a PUSCH transmission scheduled by DCI format 0\_1, or 0\_2, or 0\_0
with CRC scrambled by TC-RNTI, the redundancy version to be applied on
the *n*th transmission occasion of the TB, where n = 0, 1, ...
$N \bullet K$ -1, is determined according to table 6.1.2.1-2.

...

Table 6.1.2.1-2: Redundancy version for PUSCH transmission

  *rv~id\ ~*indicated by the DCI scheduling the PUSCH   *rv~id~* to be applied to *n*^th^ transmission occasion (repetition Type A) or TB processing over multiple slots) or *n*^th^ actual repetition (repetition Type B)                                                                   
  ----------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------------------------- ------------------------------- -------------------------------
                                                        *((n-(n mod N))/N)* mod 4 = 0                                                                                                                                        *((n-(n mod N))/N)* mod 4 = 1   *((n-(n mod N))/N)* mod 4 = 2   *((n-(n mod N))/N)* mod 4 = 3
  0                                                     0                                                                                                                                                                    2                               3                               1
  2                                                     2                                                                                                                                                                    3                               1                               0
  3                                                     3                                                                                                                                                                    1                               0                               2
  1                                                     1                                                                                                                                                                    0                               2                               3

For PUSCH repetition Type A and TB processing over multiple slots, a
PUSCH transmission in a slot of a multi-slot PUSCH transmission is
omitted according to the conditions in Clause 9, Clause 11.1, Clause
11.2A, Clause 15 and Clause 17.2 of \[6, TS 38.213\].

\[TS 38.214, clause 6.1.2.3\]

When PUSCH resource allocation is semi-statically configured by higher
layer parameter *configuredGrantConfig in BWP-UplinkDedicated
information element*, and the PUSCH transmission corresponding to a
configured grant, the following higher layer parameters are applied in
the transmission:

...

\- For Type 2 PUSCH transmissions with a configured grant: the resource
allocation follows the higher layer configuration according to \[10, TS
38.321\], and UL grant received on the DCI.

\- The PUSCH repetition type and the time domain resource allocation
table are determined by the PUSCH repetition type and the time domain
resource allocation table associated with the UL grant received on the
DCI, respectively, as defined in Clause 6.1.2.1. The value of K~offset~,
if configured, is applied when determining the first transmission
opportunity.

For PUSCH transmissions with a Type 1 or Type 2 configured grant, the
number of (nominal) repetitions *K* to be applied to the transmitted
transport block is provided by the indexed row in the time domain
resource allocation table if *numberOfRepetitions* is present in the
table; otherwise *K* is provided by the higher layer configured
parameters *repK.*

...

The UE shall not transmit anything on the resources configured by
*configuredGrantConfig* if the higher layers did not deliver a transport
block to transmit on the resources allocated for uplink transmission
without grant.

...

\[TS 38.214, clause 6.1.2.3.3\]

The procedures described in this clause apply to PUSCH transmissions of
TB processing over multiple slots with a Type 2 configured grant.

The higher layer parameter *repK-RV* defines the redundancy version
pattern to be applied to the repetitions. If the parameter *repK-RV* is
not provided in the *configuredGrantConfig*, the redundancy version for
uplink transmissions with a configured grant shall be set to 0. If the
parameter *repK-RV* is provided in the *configuredGrantConfig*, the
*n*th transmission occasion among $N \bullet K$ transmissions occasions,
*n*=0,1, ..., $N \bullet K$ *-1*, is associated with *(mod((n-mod(n,
N))/N,4)+1)^th^* value in the configured RV sequence. When *K*=1, or
when *K*\>1 and the configured grant configuration is configured with
startingFromRV0 set to \'off\', the initial transmission of the
transport block may only start at the first transmission occasion of the
$N \bullet K$ transmission occasions. Otherwise, the initial
transmission of the transport block may start at

\- The first transmission occasion of the $N \bullet K$ transmission
occasions if the configured RV sequence is {0,2,3,1}.

\- Any transmission occasion n associated with RV=0, and for which n mod
N =0, if the configured RV sequence is {0,3,0,3} or {0,0,0,0}.

The UE is not expected to be configured with the time duration for
$N \bullet K$ transmissions larger than the time duration derived by the
periodicity *P*. If the UE determines that, for a transmission occasion,
the number of symbols available in a slot for the PUSCH transmission of
TB processing over multiple slots is smaller than transmission duration
*L*, the UE does not transmit the PUSCH in the transmission occasion.

For unpaired spectrum:

\- The UE determines $N \bullet K$ slots for a PUSCH transmission of TB
processing over multiple slots with a Type 2 configured grant activated
by DCI format 0\_1 or 0\_2, based on *tdd-UL-DL-ConfigurationCommon*,
*tdd-UL-DL-ConfigurationDedicated* and *ssb-PositionsInBurst*, and the
TDRA information field value in the DCI format 0\_1 or 0\_2.

\- A slot is not counted in the number of $N \bullet K$ slots for a
PUSCH transmission of TB processing over multiple slots with a Type 2
configured grant activated by DCI format 0\_1 or 0\_2 if at least one of
the symbols indicated by the indexed row of the used resource allocation
table in the slot overlaps with a DL symbol indicated by
*tdd-UL-DL-ConfigurationCommon* or *tdd-UL-DL-ConfigurationDedicated* if
provided, or a symbol of an SS/PBCH block with index provided by
*ssb-PositionsInBurst*.

For paired spectrum and SUL band:

\- The UE determines $N \bullet K$ consecutive slots for a PUSCH
transmission of TB processing over multiple slots with a Type 2
configured grant activated by DCI format 0\_1 or 0\_2, based on the TDRA
information field value in the DCI format 0\_1 or 0\_2.

\- For the case of a reduced capability half-duplex UE, the UE
determines $N \bullet K$ slots for a PUSCH transmission of TB processing
over multiple slots with a Type 2 configured grant activated by DCI
format 0\_1 or 0\_2, based on the TDRA information field value in the
DCI format 0\_1 or 0\_2. A slot is not counted in the number of
$N \bullet K$ slots if at least one of the symbols indicated by the
indexed row of the used resource allocation table in the slot does not
start or end at least $N_{Rx - Tx} \cdot T_{c}$ or
$N_{Tx - Rx} \cdot T_{c}$, respectively, from the last or first symbol
of an SS/PBCH block with index provided by *ssb-PositionsInBurst*.

For Type 2 PUSCH transmission with a configured grant of TB processing
over multiple slots*,* the UE shall transmit the TB across the
$N \bullet K$ slots determined for the PUSCH transmission applying the
same symbol allocation in each slot. A Type 2 PUSCH transmission with a
configured grant of TB processing over multiple slots is omitted in a
slot according to the conditions in Clause 9, Clause 11.1, Clause 11.2A,
Clause 15 and Clause 17.2 of \[6, TS 38.213\].

\[TS 38.214, clause 6.1.4\]

To determine the modulation order, target code rate, redundancy version
and transport block size for the physical uplink shared channel, the UE
shall first

> \- read the 5-bit modulation and coding scheme field
> ![](./media/image22.wmf)in the DCI to determine the modulation order
> ![](./media/image23.wmf) and target code rate (*R*) based on the
> procedure defined in Subclause 6.1.4.1
>
> \- read redundancy version field (*rv*) in the DCI to determine the
> redundancy version, and
>
> \- \[check the \"CSI request\" bit field\]

and second

> \- the UE shall use the number of layers ![](./media/image24.wmf), the
> total number of allocated PRBs ![](./media/image25.wmf) to determine
> the transport block size based on the procedure defined in Subclause
> 6.1.4.2.

\[TS 38.321, clause 5.4.1\]

Uplink grant is either received dynamically on the PDCCH, in a Random
Access Response, configured semi-persistently by RRC or determined to be
associated with the PUSCH resource of MSGA as specified in clause
5.1.2a. The MAC entity shall have an uplink grant to transmit on the
UL-SCH. To perform the requested transmissions, the MAC layer receives
HARQ information from lower layers. An uplink grant addressed to CS-RNTI
with NDI = 0 is considered as a configured uplink grant. An uplink grant
addressed to CS-RNTI with NDI = 1 is considered as a dynamic uplink
grant.

If the MAC entity has a C-RNTI, a Temporary C-RNTI, or CS-RNTI, the MAC
entity shall for each PDCCH occasion and for each Serving Cell belonging
to a TAG that has a running *timeAlignmentTimer* or a running
*cg-SDT-TimeAlignmentTimer* and for each grant received for this PDCCH
occasion:

1\> if an uplink grant for this Serving Cell has been received on the
PDCCH for the MAC entity\'s C-RNTI or Temporary C-RNTI; or

...

2\> if the uplink grant is for MAC entity\'s C-RNTI and if the previous
uplink grant delivered to the HARQ entity for the same HARQ process was
either an uplink grant received for the MAC entity\'s CS-RNTI or a
configured uplink grant:

3\> consider the NDI to have been toggled for the corresponding HARQ
process regardless of the value of the NDI.

...

2\> deliver the uplink grant and the associated HARQ information to the
HARQ entity.

...

\[TS 38.321, clause 5.4.2.1\]

The MAC entity includes a HARQ entity for each Serving Cell with
configured uplink (including the case when it is configured with
*supplementaryUplink*), which maintains a number of parallel HARQ
processes.

The number of parallel UL HARQ processes per HARQ entity is specified in
TS 38.214 \[7\].

Each HARQ process supports one TB.

Each HARQ process is associated with a HARQ process identifier. For UL
transmission with UL grant in RA Response or for UL transmission for
MSGA payload, HARQ process identifier 0 is used.

...

The maximum number of transmissions of a TB within a bundle of the
dynamic grant or configured grant or the uplink grant received in a MAC
RAR is given by *REPETITION\_NUMBER* as follows:

> \- For a dynamic grant, *REPETITION\_NUMBER* is set to a value
> provided by lower layers, as specified in clause 6.1.2.1 of TS 38.214
> \[7\];
>
> ...

If *REPETITION\_NUMBER* \> 1, after the first transmission within a
bundle, at most *REPETITION\_NUMBER* -- 1 HARQ retransmissions follow
within the bundle. For both dynamic grant and configured uplink grant,
and uplink grant received in a MAC RAR bundling operation relies on the
HARQ entity for invoking the same HARQ process for each transmission
that is part of the same bundle. Within a bundle, HARQ retransmissions
are triggered without waiting for feedback from previous transmission
according to *REPETITION\_NUMBER* for a dynamic grant or configured
uplink grant or uplink grant received in a MAC RAR unless they are
terminated as specified in clause 6.1 of TS 38.214 \[7\]. Each
transmission within a bundle is a separate uplink grant delivered to the
HARQ entity.

For each transmission within a bundle of the dynamic grant or uplink
grant received in a MAC RAR, the sequence of redundancy versions is
determined according to clause 6.1.2.1 of TS 38.214 \[7\]. For each
transmission within a bundle of the configured uplink grant, the
sequence of redundancy versions is determined according to clause
6.1.2.3 of TS 38.214 \[7\].

For each uplink grant, the HARQ entity shall:

> 1\> identify the HARQ process associated with this grant, and for each
> identified HARQ process:
>
> 2\> if the received grant was not addressed to a Temporary C-RNTI on
> PDCCH, and the NDI provided in the associated HARQ information has
> been toggled compared to the value in the previous transmission of
> this TB of this HARQ process; or
>
> ...
>
> 3\> if a MAC PDU to transmit has been obtained:
>
> 4\> if the uplink grant is not a configured grant configured with
> *autonomousTx*; or
>
> 4\> if the uplink grant is a prioritized uplink grant:
>
> 5\> deliver the MAC PDU and the uplink grant and the HARQ information
> of the TB to the identified HARQ process;
>
> 5\> instruct the identified HARQ process to trigger a new
> transmission;
>
> ...
>
> 2\> else (i.e. retransmission):
>
> ...
>
> 3\> else:
>
> 4\> deliver the uplink grant and the HARQ information (redundancy
> version) of the TB to the identified HARQ process;
>
> 4\> instruct the identified HARQ process to trigger a retransmission;
>
> ....

\[TS 38.321, clause 5.4.2.2\]

Each HARQ process is associated with a HARQ buffer.

New transmissions are performed on the resource and with the MCS
indicated on PDCCH or indicated in the Random Access Response (i.e. MAC
RAR or fallbackRAR), or signalled in RRC or determined as specified in
clause 5.1.2a for MSGA payload. Retransmissions are performed on the
resource and, if provided, with the MCS indicated on PDCCH, or on the
same resource and with the same MCS as was used for last made
transmission attempt within a bundle, or on stored configured uplink
grant resources and stored MCS when *cg-RetransmissionTimer* or
*cg-SDT-RetransmissionTimer* is configured. If *cg-RetransmissionTimer*
is configured, retransmissions with the same HARQ process may be
performed on any configured grant configuration if the configured grant
configurations have the same TBS. If *cg-SDT-RetransmissionTimer* is
configured, retransmission for the initial CG-SDT transmission with the
same HARQ process may be performed on any configured grant configuration
if the configured grant configurations have the same TBS.

...

If the HARQ entity requests a new transmission for a TB, the HARQ
process shall:

1\> store the MAC PDU in the associated HARQ buffer;

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

If the HARQ entity requests a retransmission for a TB, the HARQ process
shall:

1\> store the uplink grant received from the HARQ entity;

1\> generate a transmission as described below.

To generate a transmission for a TB, the HARQ process shall:

...

1\> if there is no measurement gap at the time of the transmission and,
in case of retransmission, the retransmission does not collide with a
transmission for a MAC PDU obtained from the Msg3 buffer or the MSGA
buffer:

2\> if there are neither NR sidelink transmission nor transmission of
V2X sidelink communication at the time of the transmission; or

...

3\> instruct the physical layer to generate a transmission according to
the stored uplink grant.

...

##### 7.1.1.3.15.2.3 Test description {#test-description-14 .H6}

##### 7.1.1.3.15.2.3.1 Pre-test conditions {#pre-test-conditions-14 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that DRB is
configured in RLC AM mode according to Table 7.1.1.3.15.2.3.1-1.

Table 7.1.1.3.15.2.3.1-1: RLC parameters

  -------------------- ------
  *t-PollRetransmit*   ms80
  -------------------- ------

##### 7.1.1.3.15.2.3.2 Test procedure sequence {#test-procedure-sequence-14 .H6}

Table 7.1.1.3.15.2.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+-----------+----+
| **St**    | **Pr      | **Message | **TP**    | **        |    |
|           | ocedure** | S         |           | Verdict** |    |
|           |           | equence** |           |           |    |
+===========+===========+===========+===========+===========+====+
|           |           | **U - S** | **        |           |    |
|           |           |           | Message** |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 1         | SS        | \<\-\--   | NR RRC:   | \-        | \- |
|           | transmits |           | RRCReconf |           |    |
|           | an        |           | iguration |           |    |
|           | RRCReconf |           |           |           |    |
|           | iguration |           |           |           |    |
|           | message   |           |           |           |    |
|           | to config |           |           |           |    |
|           | Type 2    |           |           |           |    |
|           | c         |           |           |           |    |
|           | onfigured |           |           |           |    |
|           | grant     |           |           |           |    |
|           | with repK |           |           |           |    |
|           | and PUSCH |           |           |           |    |
|           | TDRA      |           |           |           |    |
|           | table     |           |           |           |    |
|           | including |           |           |           |    |
|           | numb      |           |           |           |    |
|           | erOfSlots |           |           |           |    |
|           | TBoMS-r17 |           |           |           |    |
|           | and       |           |           |           |    |
|           | nu        |           |           |           |    |
|           | mberOfRep |           |           |           |    |
|           | etitions. |           |           |           |    |
|           |           |           |           |           |    |
|           | Note 1    |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 2         | UE        | \--\>     | NR RRC:   | \-        | \- |
|           | transmits |           | RRCRecon  |           |    |
|           | an        |           | figuratio |           |    |
|           | RRCRecon  |           | nComplete |           |    |
|           | figuratio |           |           |           |    |
|           | nComplete |           |           |           |    |
|           | message.  |           |           |           |    |
|           | Note 2    |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 3         | The SS    | \<\-\--   | MAC PDU   | \-        | \- |
|           | transmits |           |           |           |    |
|           | a valid   |           |           |           |    |
|           | MAC PDU   |           |           |           |    |
|           | c         |           |           |           |    |
|           | ontaining |           |           |           |    |
|           | one RLC   |           |           |           |    |
|           | PDU.      |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 4         | The UE    | \--\>     | S         | \-        | \- |
|           | transmits |           | cheduling |           |    |
|           | a         |           | Request   |           |    |
|           | S         |           |           |           |    |
|           | cheduling |           |           |           |    |
|           | Request.  |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 5         | The SS    | \<\--     | DCI       | \-        | \- |
|           | allocates |           | format    |           |    |
|           | an UL     |           | 0\_1      |           |    |
|           | Grant in  |           |           |           |    |
|           | slot n    |           |           |           |    |
|           | which     |           |           |           |    |
|           | satisfies |           |           |           |    |
|           | following |           |           |           |    |
|           | co        |           |           |           |    |
|           | nditions: |           |           |           |    |
|           |           |           |           |           |    |
|           | \-        |           |           |           |    |
|           | s         |           |           |           |    |
|           | ufficient |           |           |           |    |
|           | to        |           |           |           |    |
|           | transmit  |           |           |           |    |
|           | the MAC   |           |           |           |    |
|           | SDU to    |           |           |           |    |
|           | loop back |           |           |           |    |
|           | in 4      |           |           |           |    |
|           | slots;    |           |           |           |    |
|           |           |           |           |           |    |
|           | \- NDI    |           |           |           |    |
|           | indicates |           |           |           |    |
|           | new       |           |           |           |    |
|           | tran      |           |           |           |    |
|           | smission; |           |           |           |    |
|           |           |           |           |           |    |
|           | \- RV     |           |           |           |    |
|           | indicates |           |           |           |    |
|           | rv^ID^ =  |           |           |           |    |
|           | 0;        |           |           |           |    |
|           |           |           |           |           |    |
|           | \- TDRA   |           |           |           |    |
|           | set as    |           |           |           |    |
|           | per Table |           |           |           |    |
|           | 7         |           |           |           |    |
|           | .1.1.3.15 |           |           |           |    |
|           | .2.3.3-6. |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 6         | Check:    | \--\>     | MAC PDU   | 1         | P  |
|           | Does the  |           |           |           |    |
|           | UE        |           |           |           |    |
|           | transmit  |           |           |           |    |
|           | a MAC PDU |           |           |           |    |
|           | including |           |           |           |    |
|           | one RLC   |           |           |           |    |
|           | SDU, in   |           |           |           |    |
|           | HARQ      |           |           |           |    |
|           | process   |           |           |           |    |
|           | 1, RV 0,  |           |           |           |    |
|           | and in 4  |           |           |           |    |
|           | slots     |           |           |           |    |
|           | suitable  |           |           |           |    |
|           | for UL    |           |           |           |    |
|           | tra       |           |           |           |    |
|           | nsmission |           |           |           |    |
|           | which     |           |           |           |    |
|           | start     |           |           |           |    |
|           | from n+4, |           |           |           |    |
|           | and       |           |           |           |    |
|           | repeat    |           |           |           |    |
|           | tra       |           |           |           |    |
|           | nsmitting |           |           |           |    |
|           | this MAC  |           |           |           |    |
|           | PDU 7     |           |           |           |    |
|           | times,    |           |           |           |    |
|           | each on 4 |           |           |           |    |
|           | slots     |           |           |           |    |
|           | suitable  |           |           |           |    |
|           | for UL    |           |           |           |    |
|           | tra       |           |           |           |    |
|           | nsmission |           |           |           |    |
|           | and with  |           |           |           |    |
|           | same      |           |           |           |    |
|           | resource  |           |           |           |    |
|           | a         |           |           |           |    |
|           | llocation |           |           |           |    |
|           | but       |           |           |           |    |
|           | different |           |           |           |    |
|           | r         |           |           |           |    |
|           | edundancy |           |           |           |    |
|           | version?  |           |           |           |    |
|           |           |           |           |           |    |
|           | Note 3    |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 7         | SS        | \<\--     | MAC PDU   | \-        |    |
|           | transmits |           | (RLC      |           |    |
|           | a MAC PDU |           | STATUS    |           |    |
|           | c         |           | PDU)      |           |    |
|           | ontaining |           |           |           |    |
|           | an RLC    |           |           |           |    |
|           | STATUS    |           |           |           |    |
|           | PDU       |           |           |           |    |
|           | ackn      |           |           |           |    |
|           | owledging |           |           |           |    |
|           | the       |           |           |           |    |
|           | reception |           |           |           |    |
|           | of the    |           |           |           |    |
|           | AMD PDU   |           |           |           |    |
|           | in step   |           |           |           |    |
|           | 6.        |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 8         | The SS    | \<\--     | DCI       | \-        | \- |
|           | sends a   |           | format    |           |    |
|           | DCI to    |           | 0\_1      |           |    |
|           | activate  |           |           |           |    |
|           | the       |           |           |           |    |
|           | c         |           |           |           |    |
|           | onfigured |           |           |           |    |
|           | grant     |           |           |           |    |
|           | which     |           |           |           |    |
|           | satisfies |           |           |           |    |
|           | following |           |           |           |    |
|           | co        |           |           |           |    |
|           | nditions: |           |           |           |    |
|           |           |           |           |           |    |
|           | \-        |           |           |           |    |
|           | s         |           |           |           |    |
|           | ufficient |           |           |           |    |
|           | to        |           |           |           |    |
|           | transmit  |           |           |           |    |
|           | the MAC   |           |           |           |    |
|           | SDU to    |           |           |           |    |
|           | loop back |           |           |           |    |
|           | in 2      |           |           |           |    |
|           | slots.    |           |           |           |    |
|           |           |           |           |           |    |
|           | \- TDRA   |           |           |           |    |
|           | set as    |           |           |           |    |
|           | per Table |           |           |           |    |
|           | 7         |           |           |           |    |
|           | .1.1.3.15 |           |           |           |    |
|           | .2.3.3-6. |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 9         | The SS    | \<\-\--   | MAC PDU   | \-        | \- |
|           | transmits |           |           |           |    |
|           | a valid   |           |           |           |    |
|           | MAC PDU   |           |           |           |    |
|           | c         |           |           |           |    |
|           | ontaining |           |           |           |    |
|           | one RLC   |           |           |           |    |
|           | PDU.      |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 10        | Check:    | \--\>     | MAC PDU   | 2         | P  |
|           | Does the  |           |           |           |    |
|           | UE        |           |           |           |    |
|           | transmit  |           |           |           |    |
|           | a MAC PDU |           |           |           |    |
|           | including |           |           |           |    |
|           | one RLC   |           |           |           |    |
|           | SDU in 2  |           |           |           |    |
|           | slots     |           |           |           |    |
|           | a         |           |           |           |    |
|           | ssociated |           |           |           |    |
|           | with RV0  |           |           |           |    |
|           | and       |           |           |           |    |
|           | suitable  |           |           |           |    |
|           | for UL    |           |           |           |    |
|           | tran      |           |           |           |    |
|           | smission? |           |           |           |    |
|           | and       |           |           |           |    |
|           | repeat    |           |           |           |    |
|           | tra       |           |           |           |    |
|           | nsmitting |           |           |           |    |
|           | this MAC  |           |           |           |    |
|           | PDU 15    |           |           |           |    |
|           | times,    |           |           |           |    |
|           | each on 2 |           |           |           |    |
|           | slots     |           |           |           |    |
|           | suitable  |           |           |           |    |
|           | for UL    |           |           |           |    |
|           | tra       |           |           |           |    |
|           | nsmission |           |           |           |    |
|           | and with  |           |           |           |    |
|           | same      |           |           |           |    |
|           | resource  |           |           |           |    |
|           | a         |           |           |           |    |
|           | llocation |           |           |           |    |
|           | but       |           |           |           |    |
|           | different |           |           |           |    |
|           | r         |           |           |           |    |
|           | edundancy |           |           |           |    |
|           | version?  |           |           |           |    |
|           | Note 4    |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| 11        | SS        | \<\--     | MAC PDU   | \-        |    |
|           | transmits |           | (RLC      |           |    |
|           | a MAC PDU |           | STATUS    |           |    |
|           | c         |           | PDU)      |           |    |
|           | ontaining |           |           |           |    |
|           | an RLC    |           |           |           |    |
|           | STATUS    |           |           |           |    |
|           | PDU       |           |           |           |    |
|           | ackn      |           |           |           |    |
|           | owledging |           |           |           |    |
|           | the       |           |           |           |    |
|           | reception |           |           |           |    |
|           | of the    |           |           |           |    |
|           | AMD PDU   |           |           |           |    |
|           | in step   |           |           |           |    |
|           | 10.       |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+
| Note 1:   |           |           |           |           |    |
| For EN-DC |           |           |           |           |    |
| the NR    |           |           |           |           |    |
| RRCReconf |           |           |           |           |    |
| iguration |           |           |           |           |    |
| message   |           |           |           |           |    |
| is        |           |           |           |           |    |
| contained |           |           |           |           |    |
| in        |           |           |           |           |    |
| R         |           |           |           |           |    |
| RCConnect |           |           |           |           |    |
| ionReconf |           |           |           |           |    |
| iguration |           |           |           |           |    |
| 36.508    |           |           |           |           |    |
| \[7\],    |           |           |           |           |    |
| Table     |           |           |           |           |    |
| 4.6.1-8   |           |           |           |           |    |
| using     |           |           |           |           |    |
| condition |           |           |           |           |    |
| EN-DC\_P  |           |           |           |           |    |
| SCell\_HO |           |           |           |           |    |
| AND       |           |           |           |           |    |
| RBCo      |           |           |           |           |    |
| nfig\_NoK |           |           |           |           |    |
| eyChange. |           |           |           |           |    |
|           |           |           |           |           |    |
| Note 2:   |           |           |           |           |    |
| For EN-DC |           |           |           |           |    |
| the NR    |           |           |           |           |    |
| RRCRecon  |           |           |           |           |    |
| figuratio |           |           |           |           |    |
| nComplete |           |           |           |           |    |
| message   |           |           |           |           |    |
| is        |           |           |           |           |    |
| contained |           |           |           |           |    |
| in        |           |           |           |           |    |
| R         |           |           |           |           |    |
| RCConnect |           |           |           |           |    |
| ionReconf |           |           |           |           |    |
| iguration |           |           |           |           |    |
| Complete. |           |           |           |           |    |
|           |           |           |           |           |    |
| Note 3:   |           |           |           |           |    |
| The       |           |           |           |           |    |
| r         |           |           |           |           |    |
| edundancy |           |           |           |           |    |
| version   |           |           |           |           |    |
| for the   |           |           |           |           |    |
| first     |           |           |           |           |    |
| tra       |           |           |           |           |    |
| nsmission |           |           |           |           |    |
| and all   |           |           |           |           |    |
| possible  |           |           |           |           |    |
| re        |           |           |           |           |    |
| petitions |           |           |           |           |    |
| are set   |           |           |           |           |    |
| in the    |           |           |           |           |    |
| following |           |           |           |           |    |
| order {0, |           |           |           |           |    |
| 2, 3, 1}  |           |           |           |           |    |
| according |           |           |           |           |    |
| to TS     |           |           |           |           |    |
| 38.214    |           |           |           |           |    |
| \[15\]    |           |           |           |           |    |
| Table     |           |           |           |           |    |
| 6         |           |           |           |           |    |
| .1.2.1-2, |           |           |           |           |    |
| first     |           |           |           |           |    |
| row.      |           |           |           |           |    |
| Usage of  |           |           |           |           |    |
| correct   |           |           |           |           |    |
| r         |           |           |           |           |    |
| edundancy |           |           |           |           |    |
| version   |           |           |           |           |    |
| is        |           |           |           |           |    |
| i         |           |           |           |           |    |
| mplicitly |           |           |           |           |    |
| checked   |           |           |           |           |    |
| upon      |           |           |           |           |    |
| correct   |           |           |           |           |    |
| decoding  |           |           |           |           |    |
| by the SS |           |           |           |           |    |
| of the UE |           |           |           |           |    |
| UL        |           |           |           |           |    |
| rep       |           |           |           |           |    |
| etitions. |           |           |           |           |    |
|           |           |           |           |           |    |
| Note 4:   |           |           |           |           |    |
| The       |           |           |           |           |    |
| r         |           |           |           |           |    |
| edundancy |           |           |           |           |    |
| version   |           |           |           |           |    |
| for the   |           |           |           |           |    |
| UL        |           |           |           |           |    |
| tra       |           |           |           |           |    |
| nsmission |           |           |           |           |    |
| is set in |           |           |           |           |    |
| the       |           |           |           |           |    |
| following |           |           |           |           |    |
| order {0, |           |           |           |           |    |
| 2, 3, 1}  |           |           |           |           |    |
| according |           |           |           |           |    |
| to        |           |           |           |           |    |
| repK-RV.  |           |           |           |           |    |
| Usage of  |           |           |           |           |    |
| correct   |           |           |           |           |    |
| r         |           |           |           |           |    |
| edundancy |           |           |           |           |    |
| version   |           |           |           |           |    |
| is        |           |           |           |           |    |
| i         |           |           |           |           |    |
| mplicitly |           |           |           |           |    |
| checked   |           |           |           |           |    |
| upon      |           |           |           |           |    |
| correct   |           |           |           |           |    |
| decoding  |           |           |           |           |    |
| by the SS |           |           |           |           |    |
| of the UE |           |           |           |           |    |
| UL        |           |           |           |           |    |
| tran      |           |           |           |           |    |
| smission. |           |           |           |           |    |
+-----------+-----------+-----------+-----------+-----------+----+

##### 7.1.1.3.15.2.3.3 Specific message contents {#specific-message-contents-14 .H6}

Table 7.1.1.3.15.2.3.3-1: *RRCReconfiguration* (Step 1, Table
7.1.1.3.15.2.3.2-1)

  Derivation Path: 38.508-1 \[4\], Table 4.6.1-13                                                 
  ------------------------------------------------- ------------------ -------------------------- ---------------
  **Information Element**                           **Value/remark**   **Comment**                **Condition**
  RRCReconfiguration ::= SEQUENCE {                                                               
  criticalExtensions CHOICE {                                                                     
  rrcReconfiguration SEQUENCE {                                                                   
  secondaryCellGroup                                CellGroupConfig    Table 7.1.1.3.15.2.3.3-2   EN-DC
                                                    Not present                                   NR
  nonCriticalExtension                              Not present                                   EN-DC
  nonCriticalExtension SEQUENCE {                                                                 NR
  masterCellGroup                                   CellGroupConfig    Table 7.1.1.3.15.2.3.3-2   
  }                                                                                               
  }                                                                                               
  }                                                                                               
  }                                                                                               

Table 7.1.1.3.15.2.3.3-2: *CellGroupConfig* (Table 7.1.1.3.15.2.3.3-1)

  Derivation Path: 38.508-1 \[4\], Table 4.6.3-19                                                    
  ------------------------------------------------- --------------------- -------------------------- ---------------
  **Information Element**                           **Value/remark**      **Comment**                **Condition**
  cellGroupConfig::= SEQUENCE {                                                                      
  cellGroupId                                       0                                                NR
                                                    1                                                EN-DC
  spCellConfig SEQUENCE {                                                                            
  servCellIndex                                     Not present                                      NR
                                                    1                                                EN-DC
  spCellConfigDedicated SEQUENCE {                                                                   
  servingCellConfig                                 *ServingCellConfig*   Table 7.1.1.3.15.2.3.3-3   
  }                                                                                                  
  }                                                                                                  
  }                                                                                                  

Table 7.1.1.3.15.2.3.3-3: *ServingCellConfig* (Table 7.1.1.3.15.2.3.3-2)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167                                                                       
  ----------------------------------------------------- ---------------------------------------- -------------------------- ---------------
  **Information Element**                               **Value/remark**                         **Comment**                **Condition**
  ServingCellConfig ::= SEQUENCE {                                                                                          
  uplinkConfig SEQUENCE {                                                                                                   
  initialUplinkBWP SEQUENCE {                                                                                               
  pusch-Config CHOICE {                                                                                                     
  setup SEQUENCE {                                                                                                          
  pusch-TimeDomainAllocationListDCI-0-1-r16 CHOICE {                                                                        
  setup                                                 PUSCH-TimeDomainResourceAllocationList   Table 7.1.1.3.15.2.3.3-4   
  }                                                                                                                         
  }                                                                                                                         
  }                                                                                                                         
  configuredGrantConfig CHOICE {                                                                                            
  setup                                                 ConfiguredGrantConfig                    Table 7.1.1.3.15.2.3.3-5   
  }                                                                                                                         
  }                                                                                                                         
  }                                                                                                                         
  }                                                                                                                         

Table 7.1.1.3.15.2.3.3-4: *PUSCH-TimeDomainResourceAllocationList*
(Table 7.1.1.3.15.2.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-122A                                                                                                                
  ------------------------------------------------------------------------------------------------------------------------------------------ -------------- --------- -----------
  Information Element                                                                                                                        Value/remark   Comment   Condition
  PUSCH-TimeDomainResourceAllocationList-r16 ::= SEQUENCE (SIZE(1..maxNrofUL-Allocations-r16)) OF PUSCH-TimeDomainResourceAllocation-r16 {   2 entries                
  PUSCH-TimeDomainResourceAllocation-r16\[1\] SEQUENCE {                                                                                                    entry 1   
  puschAllocationList-r16 SEQUENCE (SIZE(1..maxNrofMultiplePUSCHs-r16)) OF PUSCH-Allocation-r16 {                                            1 entry                  
  PUSCH-Allocation-r16\[1\] SEQUENCE {                                                                                                                      entry 1   
  numberOfRepetitions-r16                                                                                                                    n8                       
  numberOfSlotsTBoMS-r17                                                                                                                     n4                       
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  PUSCH-TimeDomainResourceAllocation-r16\[2\] SEQUENCE {                                                                                                    entry 2   
  puschAllocationList-r16 SEQUENCE (SIZE(1..maxNrofMultiplePUSCHs-r16)) OF PUSCH-Allocation-r16 {                                            1 entry                  
  PUSCH-Allocation-r16\[1\] SEQUENCE {                                                                                                                      entry 1   
  numberOfSlotsTBoMS-r17                                                                                                                     n2                       
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  }                                                                                                                                                                   
  }                                                                                                                                                                   

Table 7.1.1.3.15.2.3.3-5: *ConfiguredGrantConfig* (Table
7.1.1.3.15.2.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-26                                    
  ---------------------------------------------------- ------------------ ------------- ---------------
  **Information Element**                              **Value/remark**   **Comment**   **Condition**
  ConfiguredGrantConfig ::= SEQUENCE {                                                  
  repK-RV                                              s1-0231                          
  startingFromRV0                                      on                               
  repK-v1710                                           n16                              
  }                                                                                     

Table 7.1.1.3.15.2.3.3-6: Physical layer parameters for DCI format 0\_1
(Steps 5 & 8, Table 7.1.1.3.15.2.3.2-1)

  Derivation path: TS 38.508-1 \[4\] Table 4.3.6.1.1.2-1                                                                                                         
  -------------------------------------------------------- ----------------------------------------------------------------------------------- ----------------- -----------
  Parameter                                                Value                                                                               Value in binary   Condition
  Time domain resource assignment                          Indicating the 1st entry of pusch-TimeDomainAllocationListDCI-0-1-r16 to be used.   "0"               Step 5
                                                           Indicating the 2nd entry of pusch-TimeDomainAllocationListDCI-0-1-r16 to be used.   "1"               Step 8

##### 7.1.1.3.16 Correct Handling of UL grant / DRB configured with survival time

###### 7.1.1.3.16.1 Correct Handling of UL grant / DRB configured with survival time / Split DRB

##### 7.1.1.3.16.1.1 Test Purpose (TP) {#test-purpose-tp-16 .H6}

##### (1) {#section-53 .H6}

**with** { UE in NR RRC\_CONNECTED state to a serving cell with running
*timeAlignmentTimer* and having split DRB configured with
*survivalTimeStateSupport* and PDCP duplication configured }

**ensure that** {

**when** { UE receives uplink grant addressed to CS-RNTI with NDI=1 for
a logical channel associated with the split DRB }

**then** { UE activates PDCP duplication for all RLC entities of the
split DRB }

}

##### 7.1.1.3.16.1.2 Conformance requirements {#conformance-requirements-15 .H6}

References: The conformance requirements covered in the current TC is
specified in: TS 38.321 clause 5.4.1 and 5.10. Unless otherwise stated,
these are Rel-17 features.

\[TS 38.321, clause 5.4.1\]

If the MAC entity has a C-RNTI, a Temporary C-RNTI, or CS-RNTI, the MAC
entity shall for each PDCCH occasion and for each Serving Cell belonging
to a TAG that has a running *timeAlignmentTimer* or a running
*cg-SDT-TimeAlignmentTimer* and for each grant received for this PDCCH
occasion:

1\> else if an uplink grant for this PDCCH occasion has been received
for this Serving Cell on the PDCCH for the MAC entity\'s CS-RNTI:

2\> if the NDI in the received HARQ information is 1:

3\> if a logical channel associated with a DRB configured with
*survivalTimeStateSupport* is multiplexed in the MAC PDU stored in the
HARQ buffer for the corresponding HARQ process:

4\> trigger activation of PDCP duplication for all configured RLC
entities of the DRB.

\[TS 38.321, clause 5.10\]

If one or more DRBs are configured with PDCP duplication, the network
may activate and deactivate the PDCP duplication for all or a subset of
associated RLC entities for the configured DRB(s).

The PDCP duplication for all associated RLC entities for the configured
DRB(s) is activated by:

\- receiving an uplink grant addressed to CS-RNTI with NDI=1 for a
logical channel associated with the DRB configured with
*survivalTimeStateSupport*, described in clause 5.4.1.

The MAC entity shall for each DRB configured with PDCP duplication:

1\> if activation of a PDCP duplication for all configured RLC entities
is triggered for the DRB as specified in clause 5.4.1:

2\> indicate the activation of PDCP duplication for all configured RLC
entities of the DRB to upper layers.

##### 7.1.1.3.16.1.3 Test Description {#test-description-15 .H6}

##### 7.1.1.3.16.1.3.1 Pre-test conditions {#pre-test-conditions-15 .H6}

Pre-test conditions as in clause 7.1.3.0 with execution conditions
pc\_NG\_RAN\_NR and Connectivity (NR-DC) with following exceptions.

##### System Simulator: {#system-simulator .H6}

\- None.

##### UE: {#ue .H6}

\- None.

##### Preamble: {#preamble .H6}

\- Generic procedure parameters: Bearers (MCG(s) and split).

##### 7.1.1.3.16.1.3.2 Test procedure sequence {#test-procedure-sequence-15 .H6}

Table 7.1.1.3.16.1.3.2-1: Main behaviour

  St   Procedure                                                                                                                                                                            Message Sequence   TP                               Verdict   
  ---- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ ------------------ -------------------------------- --------- ----
                                                                                                                                                                                            U - S              Message                                    
  1    The SS sends a PDCP Data PDU on the split DRB on the AM RLC primary entity.                                                                                                          \<\--              PDCP DATA PDU                    \-        \-
  2    SS allocates an UL Grant with the CS-RNTI assigned to the UE with NDI=1 for the AM RLC primary entity. The SS UL grant allocation for the AM RLC secondary entity is not impacted.   \<\--              (UL Grant (CS-RNTI and NDI=1))   \-        \-
  \-   EXCEPTION: Steps 3 and 4 below may occur in any sequence                                                                                                                             \-                 \-                               \-        \-
  3    Check: Does UE transmit a PDCP Data PDU on the AM RLC primary entity?                                                                                                                \--\>              PDCP DATA PDU                    1         P
  4    Check: Does UE transmit a PDCP Data PDU on the AM RLC secondary entity?                                                                                                              \--\>              PDCP DATA PDU                    1         P

##### 7.1.1.3.16.1.3.3 Specific message contents {#specific-message-contents-15 .H6}

Table 7.1.1.3.16.1.3.3-1: *PDCP-Config* (Preamble)

  Derivation Path: 38.508-1 \[4\], Table 4.6.3-99 with condition NR\_split                            
  -------------------------------------------------------------------------- -------------- --------- -----------
  Information Element                                                        Value/remark   Comment   Condition
  PDCP-Config ::= SEQUENCE {                                                                          
  survivalTimeStateSupport-r17                                               true                     
  }                                                                                                   

###### 7.1.1.3.16.2 Correct Handling of UL grant / DRB configured with survival time / MCG or SCG DRB / Intra-band contiguous CA

##### 7.1.1.3.16.2.1 Test Purpose (TP) {#test-purpose-tp-17 .H6}

##### (1) {#section-54 .H6}

**with** { UE in NR RRC\_CONNECTED state to a serving cell with running
*timeAlignmentTimer* and having DRB configured with
*survivalTimeStateSupport* and PDCP CA duplication configured }

**ensure that** {

**when** { UE receives uplink grant addressed to CS-RNTI with NDI=1 for
a logical channel associated with the DRB }

**then** { UE activates PDCP duplication for all RLC entities of the DRB
}

}

##### 7.1.1.3.16.2.2 Conformance requirements {#conformance-requirements-16 .H6}

References: The conformance requirements covered in the current TC is
specified in: TS 38.321 clause 5.4.1 and 5.10. Unless otherwise stated,
these are Rel-17 features.

\[TS 38.321, clause 5.4.1\]

If the MAC entity has a C-RNTI, a Temporary C-RNTI, or CS-RNTI, the MAC
entity shall for each PDCCH occasion and for each Serving Cell belonging
to a TAG that has a running *timeAlignmentTimer* or a running
*cg-SDT-TimeAlignmentTimer* and for each grant received for this PDCCH
occasion:

1\> else if an uplink grant for this PDCCH occasion has been received
for this Serving Cell on the PDCCH for the MAC entity\'s CS-RNTI:

2\> if the NDI in the received HARQ information is 1:

3\> if a logical channel associated with a DRB configured with
*survivalTimeStateSupport* is multiplexed in the MAC PDU stored in the
HARQ buffer for the corresponding HARQ process:

4\> trigger activation of PDCP duplication for all configured RLC
entities of the DRB.

\[TS 38.321, clause 5.10\]

If one or more DRBs are configured with PDCP duplication, the network
may activate and deactivate the PDCP duplication for all or a subset of
associated RLC entities for the configured DRB(s).

The PDCP duplication for all associated RLC entities for the configured
DRB(s) is activated by:

\- receiving an uplink grant addressed to CS-RNTI with NDI=1 for a
logical channel associated with the DRB configured with
*survivalTimeStateSupport*, described in clause 5.4.1.

The MAC entity shall for each DRB configured with PDCP duplication:

1\> if activation of a PDCP duplication for all configured RLC entities
is triggered for the DRB as specified in clause 5.4.1:

2\> indicate the activation of PDCP duplication for all configured RLC
entities of the DRB to upper layers.

##### 7.1.1.3.16.2.3 Test Description {#test-description-16 .H6}

##### 7.1.1.3.16.2.3.1 Pre-test conditions {#pre-test-conditions-16 .H6}

Pre test conditions as in clause 7.1.3.0 with execution conditions
pc\_NG\_RAN\_NR with following exceptions.

##### System Simulator: {#system-simulator-1 .H6}

\- NR Cell 3, SCell suitable for intra band contiguous CA.

##### UE: {#ue-1 .H6}

\- None.

##### Preamble: {#preamble-1 .H6}

\- None.

##### 7.1.1.3.16.2.3.2 Test procedure sequence {#test-procedure-sequence-16 .H6}

Table 7.1.1.3.16.2.3.2-1: Main behaviour

  St   Procedure                                                                                                                                                                           Message Sequence   TP                                                                     Verdict   
  ---- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------------ ---------------------------------------------------------------------- --------- ----
                                                                                                                                                                                           U - S              Message                                                                          
  1    The SS transmits an NR *RRCReconfiguration* message to add SCells, to configure parameters for PDCP CA duplication and configure DRB with survival time                             \<\--              *RRCReconfiguration*                                                   \-        \-
  2    UE transmits NR *RRCReconfigurationComplete* message.                                                                                                                               \--\>              *RRCReconfigurationComplete*                                           \-        \-
  3    The SS transmits a SCell Activation MAC-CE on PCell (NR Cell 1) to activate NR SCell (NR Cell 3).                                                                                   \<\--              MAC PDU (SCell Activation/Deactivation MAC CE of one octet (C~1~=1))   \-        \-
  4    The SS sends a PDCP Data PDU on the DRB on the AM RLC primary entity.                                                                                                               \<\--              PDCP DATA PDU                                                          \-        \-
  5    SS transmits an UL Grant with the CS-RNTI assigned to the UE with NDI=1 on the AM RLC primary entity. The SS UL grant allocation for the AM RLC secondary entity is not impacted.   \<\--              (UL Grant (CS-RNTI and NDI=1))                                         \-        \-
  \-   EXCEPTION: Steps 6 and 7 below may occur in any sequence                                                                                                                            \-                 \-                                                                     \-        \-
  6    Check: Does UE transmit a PDCP Data PDU on the AM RLC primary entity?                                                                                                               \--\>              PDCP DATA PDU                                                          1         P
  7    Check: Does UE transmit a PDCP Data PDU on the AM RLC secondary entity?                                                                                                             \--\>              PDCP DATA PDU                                                          1         P

##### 7.1.1.3.16.2.3.3 Specific message contents {#specific-message-contents-16 .H6}

Table 7.1.1.3.16.2.3.3-1: *RRCReconfiguration* (Step1, Table
7.1.1.3.16.2.3.2-1)

  Derivation Path: 38.508-1 \[4\], Table 4.6.1-13: RRCReconfiguration with condition SCell\_add                                 
  ----------------------------------------------------------------------------------------------- ------------------- --------- -----------
  Information Element                                                                             Value/remark        Comment   Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                             
  criticalExtensions CHOICE {                                                                                                   
  rrcReconfiguration SEQUENCE {                                                                                                 
  radioBearerConfig                                                                               RadioBearerConfig             
  }                                                                                                                             
  }                                                                                                                             
  }                                                                                                                             

Table 7.1.1.3.16.2.3.3-2: *RadioBearerConfig* (Table 7.1.1.3.16.2.3.3-1)

  Derivation Path: 38.508-1 \[4\], Table 4.6.3-132: *RadioBearerConfig*                                                
  ----------------------------------------------------------------------- ---------------------------------- --------- -----------
  Information Element                                                     Value/remark                       Comment   Condition
  RadioBearerConfig ::= SEQUENCE {                                                                                     
  drb-ToAddModList SEQUENCE (SIZE (1..maxDRB)) OF DRB-ToAddMod {          1 entry                                      
  DRB-ToAddMod\[1\] SEQUENCE {                                                                               entry 1   
  drb-Identity                                                            DRB-Identity with condition DRBn             
  pdcp-Config                                                             PDCP-Config                                  
  }                                                                                                                    
  }                                                                                                                    
  }                                                                                                                    

Table 7.1.1.3.16.2.3.3-3: *PDCP-Config* (Table 7.1.1.3.16.2.3.3-2)

  Derivation Path: 38.508-1 \[4\], Table 4.6.3-99                                      
  ------------------------------------------------- ------------------------ --------- -----------
  Information Element                               Value/remark             Comment   Condition
  PDCP-Config ::= SEQUENCE {                                                           
  moreThanOneRLC SEQUENCE {                                                            
  primaryPath SEQUENCE {                                                               
  cellGroup                                         0                                  
  logicalChannel                                    LogicalChannelIdentity             
  }                                                                                    
  pdcp-Duplication                                  false                              
  }                                                                                    
  survivalTimeStateSupport-r17                      true                               
  }                                                                                    

Table 7.1.1.3.16.2.3.3-4: *CellGroupConfig* (Table 7.1.1.3.16.2.3.3-1)

  Derivation Path: 38.508-1 \[4\], Table 4.6.3-19: *CellGroupConfig* with condition SCell\_add                                  
  ---------------------------------------------------------------------------------------------- -------------------- --------- -----------
  Information Element                                                                            Value/remark         Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                                                                
  rlc-BearerToAddModList SEQUENCE (SIZE(1..maxLCH)) OF RLC-BearerConfig {                        2 entries                      
  RLC-BearerConfig\[1\]                                                                          RLC-BearerConfig-1   entry 1   
  RLC-BearerConfig\[2\]                                                                          RLC-BearerConfig-2   entry 2   
  }                                                                                                                             
  }                                                                                                                             

Table 7.1.1.3.16.2.3.3-5: *RLC-BearerConfig-1* (Table
7.1.1.3.16.2.3.3-4)

  ----------------------------------------------------------------------------------------
  Derivation Path: 38.508-1 \[4\], Table 4.6.3-148: *RLC-BearerConfig with condition AM*
  ----------------------------------------------------------------------------------------

Table 7.1.1.3.16.2.3.3-6: *LogicalChannelConfig* (Table
7.1.1.3.16.2.3.3-5)

  Derivation Path: 38.508-1 \[4\], Table 4.6.3-66: *LogicalChannelConfig with condition HI*                                      
  ------------------------------------------------------------------------------------------- ------------------------ --------- -----------
  Information Element                                                                         Value/remark             Comment   Condition
  LogicalChannelConfig ::= SEQUENCE {                                                                                            
  ul-SpecificParameters SEQUENCE {                                                                                               
  allowedServingCells SEQUENCE (SIZE (1..maxNrofServingCells-1)) OF ServCellIndex {           1 entry                            
  ServCellIndex\[1\]                                                                          ServCellIndex of PCell   entry 1   
  }                                                                                                                              
  }                                                                                                                              
  }                                                                                                                              

Table 7.1.1.3.16.2.3.3-7: *RLC-BearerConfig-2* (Table
7.1.1.3.16.2.3.3-4)

  Derivation Path: 38.508-1 \[4\], Table 4.6.3-148: *RLC-BearerConfig with condition AM*                                                            
  ---------------------------------------------------------------------------------------- ---------------------------------------------- --------- -----------
  Information Element                                                                      Value/remark                                   Comment   Condition
  RLC-BearerConfig ::= SEQUENCE {                                                                                                                   
  logicalChannelIdentity                                                                   LogicalChannelIdentity with condition DRBj+1             
  servedRadioBearer CHOICE {                                                                                                                        
  drb-Identity                                                                             DRB-Identity with condition DRBj                         
  }                                                                                                                                                 
  }                                                                                                                                                 

Table 7.1.1.3.16.2.3.3-8: *LogicalChannelConfig* (Table
7.1.1.3.16.2.3.3-7)

  Derivation Path: 38.508-1 \[4\], Table 4.6.3-66: *LogicalChannelConfig with condition HI*                                      
  ------------------------------------------------------------------------------------------- ------------------------ --------- -----------
  Information Element                                                                         Value/remark             Comment   Condition
  LogicalChannelConfig ::= SEQUENCE {                                                                                            
  ul-SpecificParameters SEQUENCE {                                                                                               
  allowedServingCells SEQUENCE (SIZE (1..maxNrofServingCells-1)) OF ServCellIndex {           1 entry                            
  ServCellIndex\[1\]                                                                          ServCellIndex of SCell   entry 1   
  }                                                                                                                              
  }                                                                                                                              
  }                                                                                                                              

###### 7.1.1.3.16.3 Correct Handling of UL grant / DRB configured with survival time / MCG or SCG DRB / Intra-band non-contiguous CA

##### 7.1.1.3.16.3.1 Test Purpose (TP) {#test-purpose-tp-18 .H6}

Same as TC 7.1.1.3.16.2 but applied to Intra-band non-contiguous CA.

##### 7.1.1.3.16.3.2 Conformance requirements {#conformance-requirements-17 .H6}

Same as TC 7.1.1.3.16.2 but applied to Intra-band non-contiguous CA.

##### 7.1.1.3.16.3.3 Test Description {#test-description-17 .H6}

##### 7.1.1.3.16.3.3.1 Pre-test conditions {#pre-test-conditions-17 .H6}

Same as TC 7.1.1.3.16.2 with the following differences:

\- CA configuration: Intra-band non-contiguous replaces Intra-band
Contiguous CA

##### 7.1.1.3.16.3.3.2 Test procedure sequence {#test-procedure-sequence-17 .H6}

Same as TC 7.1.1.3.16.2 with the following differences:

\- CA configuration: Intra-band non-contiguous replaces Intra-band
Contiguous CA

##### 7.1.1.3.16.3.3.3 Specific message contents {#specific-message-contents-17 .H6}

Same as TC 7.1.1.3.16.2 with the following differences:

\- CA configuration: Intra-band non-contiguous replaces Intra-band
Contiguous CA

###### 7.1.1.3.16.4 Correct Handling of UL grant / DRB configured with survival time / MCG or SCG DRB / Inter-band CA

##### 7.1.1.3.16.4.1 Test Purpose (TP) {#test-purpose-tp-19 .H6}

Same as TC 7.1.1.3.16.2 but applied to Inter-band CA.

##### 7.1.1.3.16.4.2 Conformance requirements {#conformance-requirements-18 .H6}

Same as TC 7.1.1.3.16.2 but applied to Inter-band CA.

##### 7.1.1.3.16.4.3 Test Description {#test-description-18 .H6}

##### 7.1.1.3.16.4.3.1 Pre-test conditions {#pre-test-conditions-18 .H6}

Same as TC 7.1.1.3.16.2 with the following differences:

\- CA configuration: Inter-band replaces Intra-band Contiguous CA

\- Cells configuration: NR Cell 10 replaces NR Cell 3

##### 7.1.1.3.16.4.3.2 Test procedure sequence {#test-procedure-sequence-18 .H6}

Same as TC 7.1.1.3.16.2 with the following differences:

\- CA configuration: Inter-band replaces Intra-band Contiguous CA

##### 7.1.1.3.16.4.3.3 Specific message contents {#specific-message-contents-18 .H6}

Same as TC 7.1.1.3.16.2 with the following differences:

\- CA configuration: Inter-band replaces Intra-band Contiguous CA

##### 7.1.1.3.17 Correct Handling of UL HARQ process / PUSCH Repetition / Multi-TRP

###### 7.1.1.3.17.1 Correct Handling of UL HARQ process / PUSCH Repetition / Multi-TRP / PUSCH Repetition Type A / dynamic grant

##### 7.1.1.3.17.1.1 Test Purpose (TP) {#test-purpose-tp-20 .H6}

##### (1) {#section-55 .H6}

**with** { UE in RRC\_CONNECTED state and supporting mTRP PUSCH Type A
repetitions, and configured with two SRS resource sets with \'usage\'
set to \'codebook\' and PUSCH Aggregation \> 2 }

**ensure that** {

**when** { UE has data available for transmission, UE receives an UL
Grant with toggled NDI which indicates codepoint \"10\", and the UL
grant includes \'Second Precoding information\' }

**then** { UE transmits two new MAC PDUs and repeats sending the MAC
PDUs according to \'cyclicMapping pattern\' or \'sequentialMapping
pattern\' configured as per UE\'s capability, and the layer of
transmission is according to 'Precoding information and number of
layers', and the redundancy versions of PUSCH transmission associated
with first and second SRS resource are selected correctly. }

}

##### (2) {#section-56 .H6}

**with** { UE in RRC\_CONNECTED state and supporting mTRP PUSCH Type A
repetitions, and configured with two SRS resource sets with \'usage\'
set to \'codebook\' and PUSCH Aggregation \> 2, and the MAC entity is
configured with twoPHRMode }

**ensure that** {

**when** { phr-PeriodicTimer expires }

**then** { UE transmits an Enhanced Single entry PHR including two
values of power headroom. }

}

##### 7.1.1.3.17.1.2 Conformance requirements {#conformance-requirements-19 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.214 clause 6.1.2.1, TS 38.212 clause 7.3.1.1.2, TS
38.213 clause 7.7.1 and TS 38.321 5.4.6, 6.1.3.50. Unless otherwise
stated these are Rel-17 requirements.

\[TS 38.214, clause 6.1.2.1\]

When two SRS resource sets are configured in
*srs-ResourceSetToAddModList* or *srs-ResourceSetToAddModListDCI-0-2*
with higher layer parameter *usage* in *SRS-ResourceSet* set to
\'codebook\' or \'noncodebook\', for PUSCH repetition Type A, in case
*K\>1,* the same symbol allocation is applied across the *K* consecutive
slots and the PUSCH is limited to a single transmission layer. The UE
shall repeat the TB across the *K* consecutive slots applying the same
symbol allocation in each slot, and the association of the first and
second SRS resource set in *srs-ResourceSetToAddModList* or
*srs-ResourceSetToAddModListDCI-0-2 to* each slot is determined as
follows:

\- if a DCI format 0\_1 or DCI format 0\_2 indicates codepoint \"00\"
for the *SRS resource set indicator*, the first SRS resource set is
associated with all K consecutive slots,

\- if a DCI format 0\_1 or DCI format 0\_2 indicates codepoint \"01\"
for the *SRS resource set indicator*, the second SRS resource set is
associated with all K consecutive slots,

\- if a DCI format 0\_1 or DCI format 0\_2 indicates codepoint \"10\"
for the *SRS resource set indicator*, the first and second SRS resource
set association to K consecutive slots is determined as follows:

\- When K = 2, the first and second SRS resource sets are applied to the
first and second slot of 2 consecutive slots, respectively.

\- When K \> 2 and *cyclicMapping* in *PUSCH-Config* is enabled, the
first and second SRS resource sets are applied to the first and second
slot of K consecutive slots, respectively, and the same SRS resource set
mapping pattern continues to the remaining slots of K consecutive slots.

\- When K \> 2 and *sequentialMapping* in *PUSCH-Config* is enabled,
first SRS resource set is applied to the first and second slots of K
consecutive slots, and the second SRS resource set is applied to the
third and fourth slot of K consecutive slots, and the same SRS resource
set mapping pattern continues to the remaining slots of K consecutive
slots.

\- Otherwise, a DCI format 0\_1 or DCI format 0\_2 indicates codepoint
\"11\" for the *SRS resource set indicator*, and the first and second
SRS resource set association to K consecutive slots is determined as
follows,

\- When K = 2, the second and first SRS resource set are applied to the
first and second slot of 2 consecutive slots, respectively.

\- When K \> 2 and *cyclicMapping* in *PUSCH-Config* is enabled, the
second and first SRS resource sets are applied to the first and second
slot of K consecutive slots, respectively, and the same SRS resource set
mapping pattern continues to the remaining slots of the K consecutive
slots.

\- When K \> 2 and *sequentialMapping* in *PUSCH-Config* is enabled, the
second SRS resource set is applied to the first and second slot of K
consecutive slots, and the first SRS resource set is applied to the
third and fourth slot of K consecutive slots, and the same SRS resource
set mapping pattern continues to the remaining slots of the K
consecutive slots.

For PUSCH repetition Type B, when two SRS resource sets are configured
in *srs-ResourceSetToAddModList* or *srs-ResourceSetToAddModListDCI-0-2*
with higher layer parameter *usage* in *SRS-ResourceSet* set to
\'codebook\' or \'noncodebook\', the SRS resource set association to
nominal PUSCH repetitions follows the same method as SRS resource set
association to slots in PUSCH Type A repetition by considering nominal
repetitions instead of slots.

For both PUSCH repetition Type A and PUSCH repetition Type B, when a DCI
format 0\_1 or DCI format 0\_2 indicates codepoint \"10\" or \"11\" for
the *SRS resource set indicator*, the redundancy version to be applied
on the *n*th transmission occasion (for PUSCH repetition Type A) of the
TB, where n = 0, 1, ... *K*-1, or *n*th actual repetition (for PUSCH
repetition Type B, with the counting including the actual repetitions
that are omitted) is determined according to Table 6.1.2.1-2 and Table
6.1.2.1-3. For all PUSCH repetitions associated with the SRS resource
set of the first transmission occasion or actual repetition, the
redundancy version to be applied is derived according to Table
6.1.2.1-2, where n is counted only considering PUSCH transmission
occasions or actual repetitions associated with the same SRS resource
set as the first transmission occasion or actual repetition. The
redundancy version for PUSCH transmission occasions or actual
repetitions that are associated with an SRS resource set other than the
SRS resource set of the first transmission occasion or actual repetition
is derived according to Table 6.1.2.1-3, where additional shifting
operation for each redundancy version $\text{rv}_{s}\ $is configured by
higher layer parameter *sequenceOffsetforRV* in *PUSCH-Config* and $n$
is counted only considering PUSCH transmission occasions or actual
repetitions that are not associated with the SRS resource set of the
first transmission occasion or actual repetition.

Table 6.1.2.1-3: Applied redundancy version for the other SRS resource
set (SRS resource set not associated with the first transmission
occasion or actual repetition) when *sequenceOffsetforRV* is present

  *rv~id\ ~*indicated by the DCI scheduling the PUSCH   *rv~id~* to be applied to *n*^th^ transmission occasion (repetition Type A) or *n*^th^ actual repetition (repetition Type B)                                                                                         
  ----------------------------------------------------- ------------------------------------------------------------------------------------------------------------------------------ ------------------------------------------ ------------------------------------------ ------------------------------------------
                                                        *n* mod 4 = 0                                                                                                                  *n* mod 4 = 1                              *n* mod 4 = 2                              *n* mod 4 = 3
  $$0$$                                                 $$(0 + \ \text{rv}_{s})\ \text{mod}\ 4$$                                                                                       $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(3 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(1 + \ \text{rv}_{s})\ \text{mod}\ 4$$
  $$2$$                                                 $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$                                                                                       $$(3 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(1 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(0 + \ \text{rv}_{s})\ \text{mod}\ 4$$
  $$3$$                                                 $$(3 + \ \text{rv}_{s})\ \text{mod}\ 4$$                                                                                       $$(1 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(0 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$
  $$1$$                                                 $$(1 + \ \text{rv}_{s})\ \text{mod}\ 4$$                                                                                       $$(0 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(3 + \ \text{rv}_{s})\ \text{mod}\ 4$$

\[TS 38.213, clause 7.1\]

\- For $j \in \left\{ 2,\ldots,J - 1 \right\} = S_{J}$, a
$P_{\text{O\_NOMINAL,PUSCH},f,c}\left( j \right)$ value, applicable for
all $j \in S_{J}$, is provided by *p0-NominalWithGrant,* or
$P_{\text{O\_NOMINAL,PUSCH},f,c}\left( j \right) = P_{\text{O\_NOMINAL,PUSCH},f,c}\left( 0 \right)$
if *p0-NominalWithGrant* is not provided, for each carrier $f$ *of*
serving cell $c$ and a set of
$P_{\text{O\_UE\_PUSCH},b,f,c}\left( j \right)\ $values are provided by
a set of *p0* in *P0-PUSCH-AlphaSet* indicated by a respective set of
*p0-PUSCH-AlphaSetId* for active UL BWP $b$ of carrier $f$ *of* serving
cell $c$

\- If the UE is provided by *SRI-PUSCH-PowerControl* more than one
values of *p0-PUSCH-AlphaSetId* and if a DCI format scheduling the PUSCH
transmission includes an SRI field, the UE obtains a mapping from
*sri-PUSCH-PowerControlId* in *SRI-PUSCH-PowerControl* between a set of
values for the SRI field in the DCI format \[5, TS 38.212\] and a set of
indexes provided by *p0-PUSCH-AlphaSetId* that map to a set of
*P0-PUSCH-AlphaSet* values and determines the value of
$P_{\text{O\_UE\_PUSCH},b,f,c}\left( j \right)$ from the
*p0-PUSCH-AlphaSetId* value that is mapped to the SRI field value. If
the UE is provided by *SRI-PUSCH-PowerControl* more than one values of
*p0-PUSCH-AlphaSetId*

> \- if the DCI format scheduling the PUSCH transmission includes two
> SRI fields and the UE is provided *two SRS resource sets in
> srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with
> usage set to \'codebook\'*, the UE obtains a mapping from
> *sri-PUSCH-PowerControlId* in *SRI-PUSCH-PowerControl* between a set
> of values for the two SRI fields and a set of indexes provided by
> *p0-PUSCH-AlphaSetId* that map to a set of *P0-PUSCH-AlphaSet* values,
> and determines first and second values of
> $P_{\text{O\_UE\_PUSCH},b,f,c}\left( j \right)$ from the
> *p0-PUSCH-AlphaSetId* values that are mapped to the values of the
> first and second SRI fields, respectively.

...

\- For $\alpha_{b,f,c}\left( j \right)$

...

\- For $j \in S_{J}$, a set of $\alpha_{b,f,c}\left( j \right)$ values
are provided by a set of *alpha* in *P0-PUSCH-AlphaSet* indicated by a
respective set of *p0-PUSCH-AlphaSetId* for active UL BWP $b$ of carrier
$f$ *of* serving cell $c$

\- If the UE is provided *SRI-PUSCH-PowerControl* and more than one
values of *p0-PUSCH-AlphaSetId in p0-AlphaSets*,

\- if a DCI format scheduling the PUSCH transmission includes two SRI
fields and the UE is provided *two SRS resource sets in
srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with
usage set to* \'codebook\', the UE obtains a mapping from
*sri-PUSCH-PowerControlId in SRI-PUSCH-PowerControl between a set of
values for*

\- the two SRI fields and a set of indexes provided by
*P0-PUSCH-AlphaSetId* that map to *P0-PUSCH-AlphaSet* values, and
determines first and second values of $\alpha_{b,f,c}\left( j \right)$
from the *P0-PUSCH-AlphaSetID* values that are mapped to the values of
the first and second SRI field values, respectively.

...

\- $\text{PL}_{b,f,c}(q_{d})$ is a downlink pathloss estimate in dB
calculated by the UE using reference signal (RS) index $q_{d}$ for the
active DL BWP, as described in clause 12, *of carrier* $f$ *of* serving
cell $c$

...

\- If the UE is provided *SRI-PUSCH-PowerControl* and more than one
values of *PUSCH-PathlossReferenceRS-Id*, the UE obtains a mapping from
*sri-PUSCH-PowerControlId* in *SRI-PUSCH-PowerControl* between a set of
values for the SRI field, or for first and second SRI fields if the UE
is provided *two SRS resource sets in srs-ResourceSetToAddModList or
srs-ResourceSetToAddModListDCI-0-2 with usage set to* \'codebook\', or
values for a first SRI field and values associated with a second SRI
field value corresponding to Tables 7.3.1.1.2-28/29/30/31 of \[5, TS
38.212\] for a same *number of layers as indicated by the first SRI
field value* if the UE is provided *two SRS resource sets in
srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with
usage set to* \'nonCodebook\', in a DCI format scheduling the PUSCH
transmission and a set of *PUSCH-PathlossReferenceRS-Id* values and
determines the RS resource index $q_{d}$, or respective first and second
RS resource indexes $q_{d}$, from the value of
*PUSCH-PathlossReferenceRS-Id* that is mapped to the SRI field value, or
from the values of *PUSCH-PathlossReferenceRS-Id* that are mapped to
respective first and second SRI field values if the UE is provided *two
SRS resource sets in srs-ResourceSetToAddModList or
srs-ResourceSetToAddModListDCI-0-2 with usage set to* \'codebook\', or
from the values of *PUSCH-PathlossReferenceRS-Id* that are mapped to
respective first SRI field value and a value associated with the second
SRI field value corresponding to Tables 7.3.1.1.2-28/29/30/31 of \[5, TS
38.212\] for a same *number of layers as indicated by the first SRI
field value* if the UE is provided *two SRS resource sets in
srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with
usage set to* \'nonCodebook\',

> where the RS resource is either on serving cell $c$ or, if provided,
> on a serving cell indicated by a value of *pathlossReferenceLinking*

...

> If the UE transmits a PUSCH associated with the first RS resource
> index $q_{d}$, the UE applies *the first*
> $P_{\text{O\_UE\_PUSCH},b,f,c}\left( j \right)$ value, the first
> $\alpha_{b,f,c}\left( j \right)$ value, and
> $f_{b,f,c}\left( i,l \right)$ for determining
> $P_{\text{PUSCH},b,f,c}(i,j,q_{d},l)$. If the UE transmits a PUSCH
> associated with the second RS resource index $q_{d}$, the UE applies
> *the second* $P_{\text{O\_UE\_PUSCH},b,f,c}\left( j \right)$ value,
> the second $\alpha_{b,f,c}\left( j \right)$ value, and
> $f_{b,f,c}\left( i,l \right)$ or $f_{b,f,c}\left( i,0 \right)$
> ifÂ *twoPUSCH-PC-AdjustmentStates*Â is provided or not provided,
> respectively, for determining $P_{\text{PUSCH},b,f,c}(i,j,q_{d},l)$.

\[TS 38.212, clause 7.3.1.1.2\]

\- TPC command for scheduled PUSCH -- 2 bits as defined in Clause 7.1.1
of \[5, TS38.213\]

\- Second TPC command for scheduled PUSCH -- 2 bits as defined in Clause
7.1.1 of \[5, TS38.213\] if higher layer parameter
*SecondTPCFieldDCI-0-1* is configured; 0 bit otherwise.

\- SRS resource set indicator -- 0 or 2 bits

\- 2 bits according to Table 7.3.1.1.2-36 if

\- *txConfig = nonCodeBook*, and there are two SRS resource sets
configured by *srs-ResourceSetToAddModList* and associated with the
*usage* of value \'*nonCodeBook*\', or

> \- *txConfig*=*codebook*, and there are two SRS resource sets
> configured by *srs-ResourceSetToAddModList* and associated with
> *usage* of value \'*codebook*\';

\- 0 bit otherwise.

\- SRS resource indicator -- or bits, where is the number of configured
SRS resources in the SRS resource set indicated by SRS resource set
indicator field if present; otherwise $N_{\text{SRS}}$ is the number of
configured SRS resources in the SRS resource set configured by higher
layer parameter *srs-ResourceSetToAddModList* and associated with the
higher layer parameter *usage* of value \'*codeBook*\' or
\'*nonCodeBook*\',

...

\- Second SRS resource indicator -- 0,
$\left\lceil \log_{2}{(\max_{k \in \{ 1,2,\ldots,min\{ L_{\max},N_{\text{SRS}}\}\}}\left( \frac{N_{\text{SRS}}}{k} \right))} \right\rceil$or
$\left\lceil \log_{2}{(N_{\text{SRS}})} \right\rceil$ bits,

\-
$\left\lceil \log_{2}{(\max_{k \in \{ 1,2,\ldots,min\{ L_{\max},N_{\text{SRS}}\}\}}\left( \frac{N_{\text{SRS}}}{k} \right))} \right\rceil$
bits according to Tables 7.3.1.1.2-28/29A/30A/31A with the same number
of layers indicated by SRS resource indicator field if the higher layer
parameter *txConfig = nonCodebook* and SRS resource set indicator field
is present, where $N_{\text{SRS}}$ is the number of configured SRS
resources in the second SRS resource set, and

\- if UE supports operation with *maxMIMO-Layers* and the higher layer
parameter *maxMIMO-Layers of PUSCH-ServingCellConfig* of the serving
cell is configured, *L~max~* is given by that parameter

\- otherwise, *L~max~* is given by the maximum number of layers for
PUSCH supported by the UE for the serving cell for non-codebook based
operation.

\- $\left\lceil \log_{2}{(N_{\text{SRS}})} \right\rceil$ bits according
to Tables 7.3.1.1.2-32, 7.3.1.1.2-32A and 7.3.1.1.2-32B if the higher
layer parameter *txConfig = codebook* and SRS resource set indicator
field is present, where $N_{\text{SRS}}$ is the number of configured SRS
resources in the second SRS resource set.

\- 0 bit otherwise.

\- Precoding information and number of layers -- number of bits
determined by the following:

...

> \- Second Precoding information -- number of bits determined by the
> following:

\- 0 bits if SRS resource set indicator field is not present;

\- 0 bits if the higher layer parameter *txConfig = nonCodeBook*;

\- 0 bits for 1 antenna port and if the higher layer parameter *txConfig
= codebook*;

\- 3, 4, or 5 bits according to Table 7.3.1.1.2-2C with the same number
of layers indicated by Precoding information and number of layers field
for 4 antenna ports, if SRS resource set indicator field is present,
*txConfig = codebook,* *ul-FullPowerTransmission is not configured or
configured to fullpowerMode2 or configured to fullpower,* transform
precoder is disabled, and according to the values of higher layer
parameters *maxRank, and* *codebookSubset;*

\- 3 or 4 bits according to Table 7.3.1.1.2-2D with the same number of
layers indicated by Precoding information and number of layers field for
4 antenna ports, if SRS resource set indicator field is present,
*txConfig = codebook,* *ul-FullPowerTransmission = fullpowerMode1,
maxRank=2,* transform precoder is disabled*,* and according to the
values of higher layer parameter *codebookSubset;*

\- 3 or 4 bits according to Table 7.3.1.1.2-2E with the same number of
layers indicated by Precoding information and number of layers field for
4 antenna ports, if SRS resource set indicator field is present,
*txConfig = codebook, ul-FullPowerTransmission = fullpowerMode1,*
*maxRank=3 or 4,* transform precoder is disabled, and according to the
values of higher layer parameter *codebookSubset;*

\- 2, 4, or 5 bits according to Table 7.3.1.1.2-3 with the same number
of layers indicated by Precoding information and number of layers field
for 4 antenna ports, if SRS resource set indicator field is present,
*txConfig = codebook,* *ul-FullPowerTransmission is not configured or
configured to fullpowerMode2 or configured to fullpower,* and according
to whether transform precoder is enabled or disabled, and the values of
higher layer parameters *maxRank, and codebookSubset;*

\- 3 or 4 bits according to Table 7.3.1.1.2-3A with the same number of
layers indicated by Precoding information and number of layers field for
4 antenna ports, if SRS resource set indicator field is present,
*txConfig = codebook,* *ul-FullPowerTransmission = fullpowerMode1,
maxRank=1,* and according to whether transform precoder is enabled or
disabled, and the values of higher layer parameter *codebookSubset;*

*- 1 or 3 bits* according to *Table7.3.1.1.2-4B* with the same number of
layers indicated by Precoding information and number of layers field
*for 2 antenna ports,* if SRS resource set indicator field is present,
*txConfig = codebook,* *ul-FullPowerTransmission is not configured or
configured to fullpowerMode2 or configured to fullpower,* transform
precoder is disabled, and according to the values of higher layer
parameters *maxRank and codebookSubset;*

\- 2 bits according to Table 7.3.1.1.2-4C with the same number of layers
indicated by Precoding information and number of layers field for 2
antenna ports, if SRS resource set indicator field is present, *txConfig
= codebook,* *ul-FullPowerTransmission = fullpowerMode1,* transform
precoder is disabled, *maxRank=2, and codebookSubset=nonCoherent;*

*- 1 or 3 bits according to Table7.3.1.1.2-5* with the same number of
layers indicated by Precoding information and number of layers field
*for 2 antenna ports,* if SRS resource set indicator field is present,
*txConfig = codebook,* *ul-FullPowerTransmission is not configured or
configured to fullpowerMode2 or configured to fullpower,* and according
to whether transform precoder is enabled or disabled, and the values of
higher layer parameters *maxRank and codebookSubset*;

> \- 2 bits according to Table 7.3.1.1.2-5A with the same number of
> layers indicated by Precoding information and number of layers field
> for 2 antenna ports, if SRS resource set indicator field is present,
> *txConfig = codebook,* *ul-FullPowerTransmission = fullpowerMode1,
> maxRank=1,* and according to whether transform precoder is enabled or
> disabled, and the values of higher layer parameter *codebookSubset;*

...

Table 7.3.1.1.2-4B: Second precoding information, for 2 antenna ports,
if transform precoder is disabled, *maxRank = 2, and
ul-FullPowerTransmission is not configured or configured to
fullpowerMode2 or configured to fullpower*

  Bit field mapped to index   *codebookSubset* = *fullyAndPartialAndNonCoherent*   Bit field mapped to index   *codebookSubset* = *nonCoherent*
  --------------------------- ---------------------------------------------------- --------------------------- ----------------------------------
  0                           1 layer: TPMI=0                                      0                           1 layer: TPMI=0
  1                           1 layer: TPMI=1                                      1                           1 layer: TPMI=1
  ...                         ...                                                  0                           2 layers: TPMI=0
  5                           1 layer: TPMI=5                                      1                           2 layers: reserved
  6-7                         1 layer: reserved                                                                
  0                           2 layers: TPMI=0                                                                 
  ...                         ...                                                                              
  2                           2 layers: TPMI=2                                                                 
  3-7                         2 layers: reserved                                                               

\[TS 38.321, clause 5.4.6\]

1\> if the allocated UL resources can accommodate the MAC CE for PHR
which the MAC entity is configured to transmit, plus its subheader, as a
result of LCP as defined in clause 5.4.3.1:

2\> if *multiplePHR* with value *true* is configured:

3\> for each activated Serving Cell with configured uplink associated
with any MAC entity of which the active DL BWP is not dormant BWP; and

3\> for each activated Serving Cell with configured uplink associated
with E-UTRA MAC entity:

4\> if this MAC entity is configured with *twoPHRMode*:

5\> if this Serving Cell is configured with multiple TRP PUSCH
repetition and the MAC entity this Serving Cell belongs to is configured
with *twoPHRMode*:

> 6\> obtain two values of the Type 1 or the value of Type 3 power
> headroom for the corresponding uplink carrier as specified in clause
> 7.7 of TS 38.213 \[6\] for NR Serving Cell.

5\> else:

> 6\> obtain the value of the Type 1 or Type 3 power headroom for the
> corresponding uplink carrier as specified in clause 7.7 of TS 38.213
> \[6\] for NR Serving Cell and clause 5.1.1.2 of TS 36.213 \[17\] for
> E-UTRA Serving Cell.

4\> else (i.e. this MAC entity is not configured with *twoPHRMode)*:

...

3\> instruct the Multiplexing and Assembly procedure to generate and
transmit the Enhanced Multiple entry PHR as defined in clause 6.1.3.49
if this MAC entity is configured with *mpe-Reporting-FR2-r17* or the
Enhanced Multiple Entry PHR for multiple TRP MAC CE as defined in clause
6.1.3.51 if this MAC entity is configured with *twoPHRMode* or the
Multiple Entry PHR MAC CE as defined in clause 6.1.3.9 otherwise based
on the values reported by the physical layer.

2\> else (i.e. Single Entry PHR format is used):

3\> if this MAC entity is configured with *twoPHRMode*:

4\> obtain two values of the Type 1 power headroom from the physical
layer for the corresponding uplink carrier of the PCell.

3\> else:

4\> obtain the value of the Type 1 power headroom from the physical
layer for the corresponding uplink carrier of the PCell.

3\> obtain the value for the corresponding P~CMAX,f,c~ field from the
physical layer;

...

3\> instruct the Multiplexing and Assembly procedure to generate and
transmit the Enhanced Single entry PHR as defined in clause 6.1.3.48 if
this MAC entity is configured with *mpe-Reporting-FR2-r17* or the
Enhanced Single Entry PHR for multiple TRP MAC CE as defined in clause
6.1.3.50 if this MAC entity is configured with *twoPHRMode* or the
Single Entry PHR MAC CE as defined in clause 6.1.3.8 otherwise based on
the values reported by the physical layer.

\[TS 38.321, clause 6.1.3.50\]

The Enhanced Single Entry PHR for multiple TRP MAC CE is identified by a
MAC subheader with eLCID as specified in Table 6.2.1-2b.

The two PHs together with one P~CMAX,f,c~ for the Serving Cell are
reported if UE is configured with *twoPHRMode* with the multiple TRP
PUSCH repetition feature is configured.

It has a fixed size and consists of three octets defined as follows
(Figure 6.1.3.50-1):

\- R: Reserved bit, set to 0;

\- Power Headroom i (PH i): This field indicates the power headroom
level, where PH 1 is associated with the *SRS-ResourceSet* with a lower
*srs-ResourceSetId* and PH 2 is associated with the SRS-ResourceSet with
a higher *srs-ResourceSetId*. PH fields for a Serving Cell are included
in ascending order based on i. The length of the field is 6 bits. The
reported PH and the corresponding power headroom levels are shown in
Table 6.1.3.8-1 (the corresponding measured values in dB are specified
in TS 38.133 \[11\]);

\- P: If *mpe-Reporting-FR2* is configured and the Serving Cell operates
on FR2, the MAC entity shall set this field to 0 if the applied P-MPR
value, to meet MPE requirements, as specified in TS 38.101-2 \[15\], is
less than P-MPR\_00 as specified in TS 38.133 \[11\] and to 1 otherwise.
If *mpe-Reporting-FR2* is not configured or the Serving Cell operates on
FR1, this field indicates whether power backoff is applied due to power
management (as allowed by P-MPRc as specified in TS 38.101-1 \[14\], TS
38.101-2 \[15\], and TS 38.101-3 \[16\]). The MAC entity shall set the P
field to 1 if the corresponding P~CMAX,f,c~ field would have had a
different value if no power backoff due to power management had been
applied;

\- V: This field indicates if the PH value for the corresponding TRP is
based on a real transmission or a reference format. For Type 1 PH, the V
field set to 0 indicates real transmission on PUSCH and the V field set
to 1 indicates that a PUSCH reference format is used;

\- P~CMAX,f,c~: This field indicates the P~CMAX,f,c~ (as specified in TS
38.213 \[6\]) used for calculation of the preceding PH fields. The
reported P~CMAX,f,c~ and the corresponding nominal UE transmit power
levels are shown in Table 6.1.3.8-2 (the corresponding measured values
in dBm are specified in TS 38.133 \[11\]);

\- MPE: If *mpe-Reporting-FR2* is configured, and the Serving Cell
operates on FR2, and if the P field is set to 1, this field indicates
the applied power backoff to meet MPE requirements, as specified in TS
38.101-2 \[15\]. This field indicates an index to Table 6.1.3.8-3 and
the corresponding measured values of P-MPR levels in dB are specified in
TS 38.133 \[11\]. The length of the field is 2 bits. If
*mpe-Reporting-FR2* is not configured, or if the Serving Cell operates
on FR1, or if the P field is set to 0, R bits are present instead.

Figure 6.1.3.50-1: Enhanced Single Entry PHR for multiple TRP MAC CE

\[TS 38.321, clause 6.1.3.51\]

The Enhanced Multiple Entry PHR for multiple TRP MAC CE is identified by
a MAC subheader with eLCID as specified in Table 6.2.1-2b.

It has a variable size, and includes the bitmaps, a Type 2 PH field and
an octet containing the associated P~CMAX,f,c~ field (if reported) for
SpCell of the other MAC entity, a Type 1 PH field and an octet
containing the associated P~CMAX,f,c~ field (if reported) for the PCell.
It further includes, in ascending order based on the *ServCellIndex*,
one or multiple of Type X PH fields and octets containing the associated
P~CMAX,f,c~ fields (if reported) for Serving Cells other than PCell
indicated in the bitmap for indicating the presence of PH(s). X is
either 1 or 3 according to TS 38.213 \[6\] and TS 36.213 \[17\].

The presence of Type 2 PH field for SpCell of the other MAC entity is
configured by *phr-Type2OtherCell* with value *true*.

A single octet bitmap is used for indicating the presence of PH(s) per
Serving Cell when the highest *ServCellIndex* of Serving Cell with
configured uplink is less than 8, otherwise four octets are used.

The MAC entity determines whether PH value for an activated Serving Cell
is based on real transmission or a reference format by considering the
configured grant(s) and downlink control information which has been
received until and including the PDCCH occasion in which the first UL
grant for a new transmission that can accommodate the MAC CE for PHR as
a result of LCP as defined in clause 5.4.3.1 is received since a PHR has
been triggered if the PHR MAC CE is reported on an uplink grant received
on the PDCCH or until the first uplink symbol of PUSCH transmission
minus PUSCH preparation time as defined in clause 7.7 of TS 38.213 \[6\]
if the PHR MAC CE is reported on a configured grant.

For a band combination in which the UE does not support dynamic power
sharing, the UE may omit the octets containing Power Headroom field and
P~CMAX,f,c~ field for Serving Cells in the other MAC entity except for
the PCell in the other MAC entity and the reported values of Power
Headroom and P~CMAX,f,c~ for the PCell are up to UE implementation.

The two PHs together with one P~CMAX,f,c~ for the Serving Cell
configured with the multiple TRP PUSCH repetition feature is configured
are reported if the MAC entity is configured with *twoPHRMode*.

The Enhanced Multiple Entry PHR for multiple TRP MAC CEs are defined as
follows:

\- C~i~: This field indicates the presence of PH field(s) for the
Serving Cell with *ServCellIndex* i as specified in TS 38.331 \[5\]. The
C~i~ field set to 1 indicates that PH field(s) for the Serving Cell with
*ServCellIndex* i is reported. The C~i~ field set to 0 indicates that a
PH field for the Serving Cell with *ServCellIndex* i is not reported;

\- R: Reserved bit, set to 0;

\- V: This field indicates if the PH value is based on a real
transmission or a reference format. For Type 1 PH, the V field set to 0
indicates real transmission on PUSCH and the V field set to 1 indicates
that a PUSCH reference format is used. For Type 2 PH, the V field set to
0 indicates real transmission on PUCCH and the V field set to 1
indicates that a PUCCH reference format is used. For Type 3 PH, the V
field set to 0 indicates real transmission on SRS and the V field set to
1 indicates that an SRS reference format is used. Furthermore, for Type
1, Type 2, and Type 3 PH, the V field set to 0 indicates the presence of
the octet containing the associated P~CMAX,f,c~ field and the MPE field,
and all of the V field(s) for the Serving Cell set to 1 indicates that
the octet containing the associated P~CMAX,f,c~ field and the MPE field
is omitted;

\- Power Headroom i (PH i): This field indicates the power headroom
level, where PH 1 is associated with the *SRS-ResourceSet* with a lower
*srs-ResourceSetId* and PH 2 is associated with the SRS-ResourceSet with
a higher *srs-ResourceSetId*. PH fields for a Serving Cell are included
in ascending order based on i. The length of the field is 6 bits. The
reported PH and the corresponding power headroom levels are shown in
Table 6.1.3.8-1 (the corresponding measured values in dB for the NR
Serving Cell are specified in TS 38.133 \[11\] while the corresponding
measured values in dB for the E-UTRA Serving Cell are specified in TS
36.133 \[12\]);

\- P: If *mpe-Reporting-FR2* is configured and the Serving Cell operates
on FR2, the MAC entity shall set this field to 0 if the applied P-MPR
value, to meet MPE requirements, as specified in TS 38.101-2 \[15\], is
less than P-MPR\_00 as specified in TS 38.133 \[11\] and to 1 otherwise.
If *mpe-Reporting-FR2* is not configured or the Serving Cell operates on
FR1, this field indicates whether power backoff is applied due to power
management (as allowed by P-MPRc as specified in TS 38.101-1 \[14\], TS
38.101-2 \[15\], and TS 38.101-3 \[16\]). The MAC entity shall set the P
field to 1 if the corresponding P~CMAX,f,c~ field would have had a
different value if no power backoff due to power management had been
applied;

\- P~CMAX,f,c~: If present, this field indicates the P~CMAX,f,c~ (as
specified in TS 38.213 \[6\]) for the NR Serving Cell and the P~CMAX,c~
or PÌ~CMAX,c~ (as specified in TS 36.213 \[17\]) for the E-UTRA Serving
Cell used for calculation of the preceding PH field. The reported
P~CMAX,f,c~ and the corresponding nominal UE transmit power levels are
shown in Table 6.1.3.8-2 (the corresponding measured values in dBm for
the NR Serving Cell are specified in TS 38.133 \[11\] while the
corresponding measured values in dBm for the E-UTRA Serving Cell are
specified in TS 36.133 \[12\]);

\- MPE: If *mpe-Reporting-FR2* is configured, and the Serving Cell
operates on FR2, and if the P field is set to 1, this field indicates
the applied power backoff to meet MPE requirements, as specified in TS
38.101-2 \[15\]. This field indicates an index to Table 6.1.3.8-3 and
the corresponding measured values of P-MPR levels in dB are specified in
TS 38.133 \[11\]. The length of the field is 2 bits. If
*mpe-Reporting-FR2* is not configured, or if the Serving Cell operates
on FR1, or if the P field is set to 0, R bits are present instead.

Figure 6.1.3.51-1: Enhanced Multiple Entry PHR for multiple TRP MAC CE
with the highest ServCellIndex of Serving Cell with configured uplink is
less than 8

Figure 6.1.3.51-2: Enhanced Multiple Entry PHR for multiple TRP MAC CE
with the highest ServCellIndex of Serving Cell with configured uplink is
equal to or higher than 8

##### 7.1.1.3.17.1.3 Test description {#test-description-19 .H6}

##### 7.1.1.3.17.1.3.1 Pre-test conditions {#pre-test-conditions-19 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that DRB is
configured in RLC AM mode according to Table 7.1.1.3.17.1.3.1-1.

Table 7.1.1.3.17.1.3.1-1: RLC parameters

  -------------------- ------
  *t-PollRetransmit*   ms80
  -------------------- ------

##### 7.1.1.3.17.1.3.2 Test procedure sequence {#test-procedure-sequence-19 .H6}

Table 7.1.1.3.17.1.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | SS        | \<\-\--   | *(RR      | \-      | \- |
|           | transmits |           | CReconfig |         |    |
|           | in the    |           | uration)* |         |    |
|           | indicated |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | an NR     |           |           |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | with      |           |           |         |    |
|           | s         |           |           |         |    |
|           | equential |           |           |         |    |
|           | mapping   |           |           |         |    |
|           | pattern   |           |           |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | as per    |           |           |         |    |
|           | Table     |           |           |         |    |
|           | 7         |           |           |         |    |
|           | .1.1.3.17 |           |           |         |    |
|           | .1.3.3-5. |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | UE        | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | NR        |           | gurationC |         |    |
|           | RRCRecon  |           | omplete)* |         |    |
|           | figuratio |           |           |         |    |
|           | nComplete |           |           |         |    |
|           | message   |           |           |         |    |
|           | to the    |           |           |         |    |
|           | SS. (Note |           |           |         |    |
|           | 2)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \<\-\--   | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a valid   |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | one RLC   |           |           |         |    |
|           | PDU.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | The UE    | \--\>     | (SR)      | \-      | \- |
|           | transmits |           |           |         |    |
|           | a         |           |           |         |    |
|           | S         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | Request.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | The SS    | \<\--     | UL Grant  | \-      | \- |
|           | allocates |           |           |         |    |
|           | an UL     |           |           |         |    |
|           | Grant,    |           |           |         |    |
|           | s         |           |           |         |    |
|           | ufficient |           |           |         |    |
|           | for one   |           |           |         |    |
|           | RLC SDU   |           |           |         |    |
|           | to be     |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back in a |           |           |         |    |
|           | slot n,   |           |           |         |    |
|           | NDI       |           |           |         |    |
|           | indicates |           |           |         |    |
|           | new       |           |           |         |    |
|           | tran      |           |           |         |    |
|           | smission, |           |           |         |    |
|           | DCI       |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | the PUSCH |           |           |         |    |
|           | indicates |           |           |         |    |
|           | rv^ID^ =  |           |           |         |    |
|           | 0.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | one RLC   |           |           |         |    |
|           | SDU, in   |           |           |         |    |
|           | slot n+4  |           |           |         |    |
|           | and       |           |           |         |    |
|           | repeats   |           |           |         |    |
|           | in        |           |           |         |    |
|           | following |           |           |         |    |
|           | pusch-A   |           |           |         |    |
|           | ggregatio |           |           |         |    |
|           | nFactor-1 |           |           |         |    |
|           | slots     |           |           |         |    |
|           | with same |           |           |         |    |
|           | resource  |           |           |         |    |
|           | a         |           |           |         |    |
|           | llocation |           |           |         |    |
|           | but       |           |           |         |    |
|           | different |           |           |         |    |
|           | r         |           |           |         |    |
|           | edundancy |           |           |         |    |
|           | version?  |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
|           | (Note 4)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC      |         |    |
|           | a MAC PDU |           | STATUS    |         |    |
|           | c         |           | PDU)      |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of the    |           |           |         |    |
|           | AMD PDU   |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 6.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8-12      | If UE     | \-        | \-        | \-      | \- |
|           | supports  |           |           |         |    |
|           | pc\_m     |           |           |         |    |
|           | trpPuschC |           |           |         |    |
|           | yclicMapp |           |           |         |    |
|           | ing\_r17, |           |           |         |    |
|           | repeat    |           |           |         |    |
|           | steps 1   |           |           |         |    |
|           | to 5 with |           |           |         |    |
|           | cyclic    |           |           |         |    |
|           | mapping   |           |           |         |    |
|           | pattern   |           |           |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | (in step  |           |           |         |    |
|           | 1) as per |           |           |         |    |
|           | Table     |           |           |         |    |
|           | 7         |           |           |         |    |
|           | .1.1.3.17 |           |           |         |    |
|           | .1.3.3-5. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | one RLC   |           |           |         |    |
|           | SDU, in   |           |           |         |    |
|           | HARQ      |           |           |         |    |
|           | process 1 |           |           |         |    |
|           | and in    |           |           |         |    |
|           | slot n+4  |           |           |         |    |
|           | and       |           |           |         |    |
|           | repeats   |           |           |         |    |
|           | in        |           |           |         |    |
|           | following |           |           |         |    |
|           | pusch-A   |           |           |         |    |
|           | ggregatio |           |           |         |    |
|           | nFactor-1 |           |           |         |    |
|           | slots     |           |           |         |    |
|           | with same |           |           |         |    |
|           | resource  |           |           |         |    |
|           | a         |           |           |         |    |
|           | llocation |           |           |         |    |
|           | but       |           |           |         |    |
|           | different |           |           |         |    |
|           | r         |           |           |         |    |
|           | edundancy |           |           |         |    |
|           | version?  |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
|           | (Note 5)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC      |         |    |
|           | a MAC PDU |           | STATUS    |         |    |
|           | c         |           | PDU)      |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of the    |           |           |         |    |
|           | AMD PDU   |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 9.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | Execute   | \-        | \-        | \-      | \- |
|           | steps     |           |           |         |    |
|           | 15-18 if  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | supports  |           |           |         |    |
|           | pc\_mtr   |           |           |         |    |
|           | pPuschTwo |           |           |         |    |
|           | PhrReport |           |           |         |    |
|           | ing\_r17. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | SS        | \<\--     | *(RR      | \-      | \- |
|           | transmits |           | CReconfig |         |    |
|           | NR        |           | uration)* |         |    |
|           | *R        |           |           |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | configure |           |           |         |    |
|           | specific  |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | p         |           |           |         |    |
|           | arameters |           |           |         |    |
|           | for NR    |           |           |         |    |
|           | Cell.     |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 16        | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | enhanced  |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | Control   |           |           |         |    |
|           | Element   |           |           |         |    |
|           | for       |           |           |         |    |
|           | multiple  |           |           |         |    |
|           | TRP?      |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note 6,  |           |           |         |    |
|           | 7)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17        | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an NR     |           | gurationC |         |    |
|           | *         |           | omplete)* |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | confirm   |           |           |         |    |
|           | the setup |           |           |         |    |
|           | of Power  |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | pa        |           |           |         |    |
|           | rameters. |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note     |           |           |         |    |
|           | 6,2)      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 18        | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | enhanced  |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | Control   |           |           |         |    |
|           | Element   |           |           |         |    |
|           | for       |           |           |         |    |
|           | multiple  |           |           |         |    |
|           | TRP 500ms |           |           |         |    |
|           | after     |           |           |         |    |
|           | step 13?  |           |           |         |    |
|           | (Note 7)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| 36.508    |           |           |           |         |    |
| \[7\],    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 4.6.1-8   |           |           |           |         |    |
| using     |           |           |           |         |    |
| condition |           |           |           |         |    |
| EN-DC\_   |           |           |           |         |    |
| EmbedNR\_ |           |           |           |         |    |
| RRCRecon. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| Checking  |           |           |           |         |    |
| the UE    |           |           |           |         |    |
| uses      |           |           |           |         |    |
| correct   |           |           |           |         |    |
| r         |           |           |           |         |    |
| edundancy |           |           |           |         |    |
| version   |           |           |           |         |    |
| and UE    |           |           |           |         |    |
| decides   |           |           |           |         |    |
| the       |           |           |           |         |    |
| number of |           |           |           |         |    |
| layer of  |           |           |           |         |    |
| all       |           |           |           |         |    |
| tra       |           |           |           |         |    |
| nsmission |           |           |           |         |    |
| according |           |           |           |         |    |
| to the    |           |           |           |         |    |
| '         |           |           |           |         |    |
| Precoding |           |           |           |         |    |
| in        |           |           |           |         |    |
| formation |           |           |           |         |    |
| and       |           |           |           |         |    |
| number of |           |           |           |         |    |
| layers'   |           |           |           |         |    |
| i         |           |           |           |         |    |
| mplicitly |           |           |           |         |    |
| upon      |           |           |           |         |    |
| correctly |           |           |           |         |    |
| decoding  |           |           |           |         |    |
| by the SS |           |           |           |         |    |
| of the UE |           |           |           |         |    |
| UL        |           |           |           |         |    |
| rep       |           |           |           |         |    |
| etitions. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 4:   |           |           |           |         |    |
| The       |           |           |           |         |    |
| r         |           |           |           |         |    |
| edundancy |           |           |           |         |    |
| version   |           |           |           |         |    |
| for the   |           |           |           |         |    |
| first     |           |           |           |         |    |
| tra       |           |           |           |         |    |
| nsmission |           |           |           |         |    |
| and all   |           |           |           |         |    |
| possible  |           |           |           |         |    |
| re        |           |           |           |         |    |
| petitions |           |           |           |         |    |
| are set   |           |           |           |         |    |
| in the    |           |           |           |         |    |
| following |           |           |           |         |    |
| order {0, |           |           |           |         |    |
| 2, 1, 3}  |           |           |           |         |    |
| according |           |           |           |         |    |
| to TS     |           |           |           |         |    |
| 38.214    |           |           |           |         |    |
| \[15\]    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 6.1.2.1-2 |           |           |           |         |    |
| and Table |           |           |           |         |    |
| 6         |           |           |           |         |    |
| .1.2.1-3, |           |           |           |         |    |
| first     |           |           |           |         |    |
| row.      |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 5:   |           |           |           |         |    |
| The       |           |           |           |         |    |
| r         |           |           |           |         |    |
| edundancy |           |           |           |         |    |
| version   |           |           |           |         |    |
| for the   |           |           |           |         |    |
| first     |           |           |           |         |    |
| tra       |           |           |           |         |    |
| nsmission |           |           |           |         |    |
| and all   |           |           |           |         |    |
| possible  |           |           |           |         |    |
| re        |           |           |           |         |    |
| petitions |           |           |           |         |    |
| are set   |           |           |           |         |    |
| in the    |           |           |           |         |    |
| following |           |           |           |         |    |
| order {0, |           |           |           |         |    |
| 1, 2, 3}  |           |           |           |         |    |
| according |           |           |           |         |    |
| to TS     |           |           |           |         |    |
| 38.214    |           |           |           |         |    |
| \[15\]    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 6.1.2.1-2 |           |           |           |         |    |
| and Table |           |           |           |         |    |
| 6         |           |           |           |         |    |
| .1.2.1-3, |           |           |           |         |    |
| first     |           |           |           |         |    |
| row.      |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 6:   |           |           |           |         |    |
| Steps 16  |           |           |           |         |    |
| and 18    |           |           |           |         |    |
| can       |           |           |           |         |    |
| happen in |           |           |           |         |    |
| any       |           |           |           |         |    |
| order.    |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 7:   |           |           |           |         |    |
| For NR5GC |           |           |           |         |    |
| the       |           |           |           |         |    |
| received  |           |           |           |         |    |
| MAC PDU   |           |           |           |         |    |
| will      |           |           |           |         |    |
| contain   |           |           |           |         |    |
| Enhanced  |           |           |           |         |    |
| Single    |           |           |           |         |    |
| Entry PHR |           |           |           |         |    |
| for       |           |           |           |         |    |
| multiple  |           |           |           |         |    |
| TRP MAC   |           |           |           |         |    |
| CE. For   |           |           |           |         |    |
| EN        |           |           |           |         |    |
| -DC/NE-DC |           |           |           |         |    |
| the       |           |           |           |         |    |
| received  |           |           |           |         |    |
| MAC PDU   |           |           |           |         |    |
| will      |           |           |           |         |    |
| contain   |           |           |           |         |    |
| Enhanced  |           |           |           |         |    |
| Multiple  |           |           |           |         |    |
| Entry PHR |           |           |           |         |    |
| for       |           |           |           |         |    |
| multiple  |           |           |           |         |    |
| TRP MAC   |           |           |           |         |    |
| CE.       |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.3.17.1.3.3 Specific message contents {#specific-message-contents-19 .H6}

Table 7.1.1.3.17.1.3.3-0: *ServingCellConfigCommon* (Pre-test
conditions)

+------------------+------------------+---------+------------------+
| Derivation Path: |                  |         |                  |
| TS 38.508-1      |                  |         |                  |
| \[4\], Table     |                  |         |                  |
| 4.6.1-168        |                  |         |                  |
+==================+==================+=========+==================+
| Information      | Value/remark     | Comment | Condition        |
| Element          |                  |         |                  |
+------------------+------------------+---------+------------------+
| Serving          |                  |         |                  |
| CellConfigCommon |                  |         |                  |
| ::= SEQUENCE {   |                  |         |                  |
+------------------+------------------+---------+------------------+
| ssb-             |                  |         |                  |
| PositionsInBurst |                  |         |                  |
| CHOICE {         |                  |         |                  |
+------------------+------------------+---------+------------------+
| shortBitmap      | 1100             |         | FR1 AND          |
|                  |                  |         |                  |
|                  |                  |         | (1.88            |
|                  |                  |         | GHz\<FREQ\<=3GHz |
|                  |                  |         |                  |
|                  |                  |         | AND (FDD OR (TDD |
|                  |                  |         | AND SCS15)) OR   |
|                  |                  |         |                  |
|                  |                  |         | FREQ\<=1.88GHZ)  |
+------------------+------------------+---------+------------------+
| mediumBitmap     | 11000000         |         | FR1 AND          |
|                  |                  |         |                  |
|                  |                  |         | (1.88            |
|                  |                  |         | GHz\<FREQ\<=3GHz |
|                  |                  |         |                  |
|                  |                  |         | AND (TDD AND     |
|                  |                  |         | SCS30) OR        |
|                  |                  |         | FREQ\>3GHz)      |
+------------------+------------------+---------+------------------+
| longBitmap       | 1100000000000000 |         | FR2              |
|                  | 0000000000000000 |         |                  |
|                  | 0000000000000000 |         |                  |
|                  | 0000000000000000 |         |                  |
+------------------+------------------+---------+------------------+
| }                |                  |         |                  |
+------------------+------------------+---------+------------------+
| }                |                  |         |                  |
+------------------+------------------+---------+------------------+

Table 7.1.1.3.17.1.3.3-1: *RRCReconfiguration* (steps 1 and 8, Table
7.1.1.3.17.1.3.2-1)

  ---------------------------------------------------- ----------------- ------------------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                                                                 
  Information Element                                  Value/remark      Comment                                     Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                  
  criticalExtensions CHOICE {                                                                                        
  rrcReconfiguration SEQUENCE {                                                                                      
  secondaryCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   EN-DC
  nonCriticalExtension SEQUENCE {                                                                                    NR
  masterCellGroup                                      CellGroupConfig                                               
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  ---------------------------------------------------- ----------------- ------------------------------------------- -----------

Table 7.1.1.3.17.1.3.3-2: *CellGroupConfig* (Table 7.1.1.3.17.1.3.3-1)

  ---------------------------------------------------- ------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19                                 
  Information Element                                  Value/remark        Comment   Condition
  CellGroupConfig::= SEQUENCE {                                                      
  cellGroupId                                          0                             
                                                       1                             EN-DC
  spCellConfig SEQUENCE {                                                            
  spCellConfigDedicated                                ServingCellConfig             
  }                                                                                  
  }                                                                                  
  ---------------------------------------------------- ------------------- --------- -----------

Table 7.1.1.3.17.1.3.3-3: *ServingCellConfig* (Table 7.1.1.3.17.1.3.3-2)

  ----------------------------------------------------- --------------------- ------------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167                                       
  **Information Element**                               **Value/remark**      **Comment**   **Condition**
  ServingCellConfig ::= SEQUENCE {                                                          
  uplinkConfig SEQUENCE {                                                                   
  initialUplinkBWP                                      BWP-UplinkDedicated                 
  }                                                                                         
  }                                                                                         
  ----------------------------------------------------- --------------------- ------------- ---------------

Table 7.1.1.3.17.1.3.3-4: *BWP-UplinkDedicated* (Table
7.1.1.3.17.1.3.3-3)

  ---------------------------------------------------- ------------------ ------------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-11                                    
  **Information Element**                              **Value/remark**   **Comment**   **Condition**
  BWP-UplinkDedicated ::= SEQUENCE {                                                    
  pusch-Config CHOICE {                                                                 
  setup                                                PUSCH-Config                     
  }                                                                                     
  }                                                                                     
  ---------------------------------------------------- ------------------ ------------- ---------------

Table 7.1.1.3.17.1.3.3-5: *PUSCH-Config* (Table 7.1.1.3.17.1.3.3-4)

  ----------------------------------------------------- -------------------- ------------- ---------------------------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-118                                      
  **Information Element**                               **Value/remark**     **Comment**   **Condition**
  PUSCH-Config ::= SEQUENCE {                                                              
  dmrs-UplinkForPUSCH-MappingTypeB CHOICE {                                                
  setup                                                 DMRS-UplinkConfig                  
  }                                                                                        
  pusch-AggregationFactor                               n4                                 
                                                        n8                                 (TDD AND SCS15) OR FR2
  pusch-PowerControl                                    PUSCH-PowerControl                 
  pusch-RepTypeIndicatorDCI-0-1-r16                     pusch-RepTypeA                     
  mappingPattern-r17                                    cyclicMapping                      pc\_mtrpPuschCyclicMapping\_r17
                                                        sequentialMapping                  
  secondTPCFieldDCI-0-1-r17                             Not present                        
  secondTPCFieldDCI-0-2-r17                             Not present                        
  sequenceOffsetForRV-r17                               1                                  
  }                                                                                        
  ----------------------------------------------------- -------------------- ------------- ---------------------------------

Table 7.1.1.3.17.1.3.3-6: *DMRS-UplinkConfig* (Table 7.1.1.3.17.1.3.3-5)

  --------------------------------------------------------
  Derivation Path: TS 38.**508-1 \[4\],** Table 4.6.3-51
  --------------------------------------------------------

Table 7.1.1.3.17.1.3.3-7: *PUSCH-PowerControl* (Table
7.1.1.3.17.1.3.3-5)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-120                                                                                              
  ----------------------------------------------------------------------------------------------------------------------- -------------- --------- -----------
  Information Element                                                                                                     Value/remark   Comment   Condition
  PUSCH-PowerControl ::= SEQUENCE {                                                                                                                
  p0-AlphaSets SEQUENCE (SIZE (1..maxNrofP0-PUSCH-AlphaSets)) OF P0-PUSCH-AlphaSet {                                      2 entries                
  P0-PUSCH-AlphaSet\[1\] SEQUENCE {                                                                                                      entry 1   
  p0-PUSCH-AlphaSetId                                                                                                     0                        
  p0                                                                                                                      0                        
  alpha                                                                                                                   alpha08                  
  }                                                                                                                                                
  P0-PUSCH-AlphaSet\[2\] SEQUENCE {                                                                                                      entry 2   
  p0-PUSCH-AlphaSetId                                                                                                     1                        
  p0                                                                                                                      -20                      
  alpha                                                                                                                   alpha08                  
  }                                                                                                                                                
  }                                                                                                                                                
  pathlossReferenceRSToAddModList SEQUENCE (SIZE (1..maxNrofPUSCH-PathlossReferenceRSs)) OF PUSCH-PathlossReferenceRS {   2 entries                
  PUSCH-PathlossReferenceRS\[1\] SEQUENCE {                                                                                              entry 1   
  pusch-PathlossReferenceRS-Id                                                                                            0                        
  referenceSignal CHOICE{                                                                                                                          
  ssb-Index                                                                                                               0                        
  }                                                                                                                                                
  }                                                                                                                                                
  PUSCH-PathlossReferenceRS\[2\] SEQUENCE {                                                                                              entry 2   
  pusch-PathlossReferenceRS-Id                                                                                            1                        
  referenceSignal CHOICE{                                                                                                                          
  ssb-Index                                                                                                               1                        
  }                                                                                                                                                
  }                                                                                                                                                
  }                                                                                                                                                
  sri-PUSCH-MappingToAddModList SEQUENCE (SIZE (1..maxNrofSRI-PUSCH-Mappings)) OF SRI-PUSCH-PowerControl {                2 entries                
  SRI-PUSCH-PowerControl\[1\] SEQUENCE {                                                                                                 entry 1   
  sri-PUSCH-PowerControlId                                                                                                0                        
  sri-PUSCH-PathlossReferenceRS-Id                                                                                        0                        
  sri-P0-PUSCH-AlphaSetId                                                                                                 0                        
  sri-PUSCH-ClosedLoopIndex                                                                                               i0                       
  }                                                                                                                                                
  SRI-PUSCH-PowerControl\[2\] SEQUENCE {                                                                                                 entry 2   
  sri-PUSCH-PowerControlId                                                                                                1                        
  sri-PUSCH-PathlossReferenceRS-Id                                                                                        1                        
  sri-P0-PUSCH-AlphaSetId                                                                                                 1                        
  sri-PUSCH-ClosedLoopIndex                                                                                               i1                       
  }                                                                                                                                                
  }                                                                                                                                                
  }                                                                                                                                                

Table 7.1.1.3.17.1.3.3-8: *SRS-Config* (Table 7.1.1.3.17.1.3.3-4)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-182                                                                             
  ---------------------------------------------------------------------------------------------- ------------------ ------------- -----------------------
  **Information Element**                                                                        **Value/remark**   **Comment**   **Condition**
  SRS-Config ::= SEQUENCE {                                                                                                       
  srs-ResourceSetToReleaseList                                                                   Not present                      
  srs-ResourceSetToAddModList SEQUENCE (SIZE(0..maxNrofSRS-ResourceSets)) OF SRS-ResourceSet {   2 entries                        
  SRS-ResourceSet\[1\] SEQUENCE {                                                                                   entry 1       
  srs-ResourceSetId                                                                              0                                
  srs-ResourceIdList SEQUENCE (SIZE(1..maxNrofSRS-ResourcesPerSet)) OF SRS-ResourceId {          1 entry                          
  SRS-ResourceId\[1\]                                                                            0                  entry 1       
  }                                                                                                                               
  resourceType CHOICE {                                                                                                           
  aperiodic SEQUENCE {                                                                                                            
  aperiodicSRS-ResourceTrigger                                                                   1                                
  csi-RS                                                                                         Not present                      
  slotOffset                                                                                     7                                FR1
                                                                                                 4                                FR2
  }                                                                                                                               
  }                                                                                                                               
  usage                                                                                          codebook                         
  alpha                                                                                          Alpha                            
  p0                                                                                             0                                
  pathlossReferenceRS CHOICE {                                                                                                    
  ssb-Index                                                                                      SSB-Index                        
  }                                                                                                                               
  srs-PowerControlAdjustmentStates                                                               Not present                      
  }                                                                                                                               
  SRS-ResourceSet\[2\] SEQUENCE {                                                                                   entry 2       
  srs-ResourceSetId                                                                              1                                
  srs-ResourceIdList SEQUENCE (SIZE(1..maxNrofSRS-ResourcesPerSet)) OF SRS-ResourceId {          1 entry                          
  SRS-ResourceId\[1\]                                                                            1                  entry 1       
  }                                                                                                                               
  resourceType CHOICE {                                                                                                           
  aperiodic SEQUENCE {                                                                                                            
  aperiodicSRS-ResourceTrigger                                                                   1                                
  csi-RS                                                                                         Not present                      
  slotOffset                                                                                     7                                FR1
                                                                                                 4                                FR2
  }                                                                                                                               
  }                                                                                                                               
  usage                                                                                          codebook                         
  alpha                                                                                          Alpha                            
  p0                                                                                             0                                
  pathlossReferenceRS CHOICE {                                                                                                    
  ssb-Index                                                                                      SSB-Index                        
  }                                                                                                                               
  srs-PowerControlAdjustmentStates                                                               Not present                      
  }                                                                                                                               
  }                                                                                                                               
  srs-ResourceToReleaseList                                                                      Not present                      
  srs-ResourceToAddModList SEQUENCE (SIZE(1..maxNrofSRS-Resources)) OF SRS-Resource {            2 entries                        
  SRS-Resource\[1\] SEQUENCE {                                                                                      entry 1       
  srs-ResourceId                                                                                 0                                
  nrofSRS-Ports                                                                                  ports2                           pc\_nrMIMO\_CB\_PUSCH
                                                                                                 port1                            
  ptrs-PortIndex                                                                                 Not present                      
  transmissionComb CHOICE {                                                                                                       
  n2 SEQUENCE {                                                                                                                   
  combOffset-n2                                                                                  0                                
  cyclicShift-n2                                                                                 0                                
  }                                                                                                                               
  }                                                                                                                               
  resourceMapping SEQUENCE {                                                                                                      
  startPosition                                                                                  0                                
  nrofSymbols                                                                                    n1                               
  repetitionFactor                                                                               n1                               
  }                                                                                                                               
  freqDomainPosition                                                                             0                                
  freqDomainShift                                                                                0                                
  freqHopping SEQUENCE {                                                                                                          
  c-SRS                                                                                          0                                
                                                                                                 63                               FR1\_100MHz
                                                                                                 17                               FR2\_100MHz
  b-SRS                                                                                          0                                
  b-hop                                                                                          0                                
  }                                                                                                                               
  groupOrSequenceHopping                                                                         groupHopping                     
  resourceType CHOICE {                                                                                                           
  aperiodic SEQUENCE {                                                                                                            
  }                                                                                                                               
  }                                                                                                                               
  sequenceId                                                                                     0                                
  spatialRelationInfo SEQUENCE {                                                                                                  
  servingCellId                                                                                  Not present                      
  referenceSignal CHOICE {                                                                                                        
  ssb-Index                                                                                      0                                
  }                                                                                                                               
  }                                                                                                                               
  }                                                                                                                               
  SRS-Resource\[2\] SEQUENCE {                                                                                      entry 2       
  srs-ResourceId                                                                                 0                                
  nrofSRS-Ports                                                                                  ports2                           pc\_nrMIMO\_CB\_PUSCH
                                                                                                 port1                            
  ptrs-PortIndex                                                                                 Not present                      
  transmissionComb CHOICE {                                                                                                       
  n2 SEQUENCE {                                                                                                                   
  combOffset-n2                                                                                  1                                
  cyclicShift-n2                                                                                 0                                
  }                                                                                                                               
  }                                                                                                                               
  resourceMapping SEQUENCE {                                                                                                      
  startPosition                                                                                  0                                
  nrofSymbols                                                                                    n1                               
  repetitionFactor                                                                               n1                               
  }                                                                                                                               
  freqDomainPosition                                                                             0                                
  freqDomainShift                                                                                0                                
  freqHopping SEQUENCE {                                                                                                          
  c-SRS                                                                                          0                                
                                                                                                 63                               FR1\_100MHz
                                                                                                 17                               FR2\_100MHz
                                                                                                 0                                FR2\_MBWP
  b-SRS                                                                                          0                                
  b-hop                                                                                          0                                
  }                                                                                                                               
  groupOrSequenceHopping                                                                         groupHopping                     
  resourceType CHOICE {                                                                                                           
  aperiodic SEQUENCE {                                                                                                            
  }                                                                                                                               
  }                                                                                                                               
  sequenceId                                                                                     0                                
  spatialRelationInfo SEQUENCE {                                                                                                  
  servingCellId                                                                                  Not present                      
  referenceSignal CHOICE {                                                                                                        
  ssb-Index                                                                                      1                                
  }                                                                                                                               
  }                                                                                                                               
  }                                                                                                                               
  }                                                                                                                               
  tpc-Accumulation                                                                               Not present                      
  }                                                                                                                               

Table 7.1.1.3.17.1.3.3-9: RRCReconfiguration (step 15, Table
7.1.1.3.17.1.3.2-1)

+-----------------+-----------------+-----------------+-----------+
| Derivation      |                 |                 |           |
| Path: TS        |                 |                 |           |
| 38.508-1 \[4\], |                 |                 |           |
| Table 4.6.1-13  |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| Information     | Value/remark    | Comment         | Condition |
| Element         |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| RRC             |                 |                 |           |
| Reconfiguration |                 |                 |           |
| ::= SEQUENCE {  |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| cri             |                 |                 |           |
| ticalExtensions |                 |                 |           |
| CHOICE {        |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| rrc             |                 |                 |           |
| Reconfiguration |                 |                 |           |
| SEQUENCE {      |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| sec             | CellGroupConfig | OCTET STRING    | EN-DC     |
| ondaryCellGroup |                 | (CONTAINING     |           |
|                 |                 | C               |           |
|                 |                 | ellGroupConfig) |           |
+-----------------+-----------------+-----------------+-----------+
| nonCr           |                 |                 | NR        |
| iticalExtension |                 |                 |           |
| SEQUENCE {      |                 |                 | NE-DC     |
+-----------------+-----------------+-----------------+-----------+
| masterCellGroup | CellGroupConfig | OCTET STRING    |           |
|                 |                 | (CONTAINING     |           |
|                 |                 | C               |           |
|                 |                 | ellGroupConfig) |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+

Table 7.1.1.3.17.1.3.3-10: CellGroupConfig (Table 7.1.1.3.17.1.3.3-9)

+------------------------------+--------------+---------+-----------+
| Derivation Path: TS 38.508-1 |              |         |           |
| \[4\], Table 4.6.3-19        |              |         |           |
+------------------------------+--------------+---------+-----------+
| Information Element          | Value/remark | Comment | Condition |
+------------------------------+--------------+---------+-----------+
| cellGroupConfig::= SEQUENCE  |              |         |           |
| {                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| mac-CellGroupConfig SEQUENCE |              |         |           |
| {                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| phr-Config CHOICE {          |              |         |           |
+------------------------------+--------------+---------+-----------+
| setup SEQUENCE {             |              |         |           |
+------------------------------+--------------+---------+-----------+
| phr-PeriodicTimer            | sf500        |         |           |
+------------------------------+--------------+---------+-----------+
| phr-ProhibitTimer            | sf1000       |         |           |
+------------------------------+--------------+---------+-----------+
| phr-Tx-PowerFactorChange     | infinity     |         |           |
+------------------------------+--------------+---------+-----------+
| multiplePHR                  | false        |         |           |
+------------------------------+--------------+---------+-----------+
| multiplePHR                  | true         |         | EN-DC     |
|                              |              |         |           |
|                              |              |         | NE-DC     |
+------------------------------+--------------+---------+-----------+
| phr-Type2PCell               | false        |         |           |
+------------------------------+--------------+---------+-----------+
| phr-Type2OtherCell           | false        |         |           |
+------------------------------+--------------+---------+-----------+
| phr-ModeOtherCG              | real         |         |           |
+------------------------------+--------------+---------+-----------+
| mpe-Reporting-FR2-r17        | Not present  |         |           |
+------------------------------+--------------+---------+-----------+
| twoPHRMode-r17               | enabled      |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+

Table 7.1.1.3.17.1.3.3-11: Physical layer parameters for DCI format 0\_1
(Steps 5, 8, Table 7.1.1.3.17.1.3.2-1)

  Derivation path: TS 38.508-1 \[4\] Table 4.3.6.1.1.2-1                                                                                                                                                              
  -------------------------------------------------------- ---------------------------------------------------------------------------------------------------------------------------------------- ----------------- -----------------------
  Parameter                                                Value                                                                                                                                    Value in binary   Condition
  TPC command for scheduled PUSCH                          0 dB (accumulated TPC) as per Table 7.1.1-1 in TS 38.213 \[22\]                                                                          "01"              
  Second TPC command for scheduled PUSCH                   0 dB (accumulated TPC) as per Table 7.1.1-1 in TS 38.213 \[22\]                                                                          "01"              
  SRS resource set indicator                               2 as per Table 7.3.1.1.2-36 in TS 38.212 \[27\]                                                                                          "10"              
  SRS resource indicator                                   0                                                                                                                                        "0"               
  Second SRS resource indicator                            1                                                                                                                                        "1"               
  Precoding information and number of layers               Not present (0 bits for 1 antenna port and if the higher layer parameter txConfig = Codebook as per clause 7.3.1.1.2 TS 38.212 \[27\])   \-                
                                                           2                                                                                                                                        "10"              pc\_nrMIMO\_CB\_PUSCH
  Second Precoding information                             Not present (0 bits for 1 antenna port and if the higher layer parameter txConfig = Codebook as per clause 7.3.1.1.2 TS 38.212 \[27\])   \-                
                                                           0                                                                                                                                        "00"              pc\_nrMIMO\_CB\_PUSCH

###### 7.1.1.3.17.2 Correct Handling of UL HARQ process / PUSCH Repetition / Multi-TRP / PUSCH Repetition Type B / dynamic grant

##### 7.1.1.3.17.2.1 Test Purpose (TP) {#test-purpose-tp-21 .H6}

##### (1) {#section-57 .H6}

**with** { UE in RRC\_CONNECTED state and supporting mTRP PUSCH Type B
repetitions, and configured with two SRS resource sets with \'usage\'
set to \'codebook\' and number of repetition K \> 2 }

**ensure that** {

**when** { UE has data available for transmission, UE receives an UL
Grant with toggled NDI which indicates codepoint \"10\", and the UL
grant includes \'Second Precoding information\' }

**then** { UE transmits two new MAC PDUs and repeats sending the MAC
PDUs according to \'cyclicMapping pattern\' or \'sequentialMapping
pattern\' configured as per UE\'s capability, and the layer of
transmission is according to the Precoding information and number of
layers, and the redundancy versions of PUSCH transmission associated
with first and second SRS resource are selected correctly. }

}

##### (2) {#section-58 .H6}

**with** { UE in RRC\_CONNECTED state and supporting mTRP PUSCH Type B
repetitions, and configured with two SRS resource sets with \'usage\'
set to \'codebook\' and number of repetition K \> 2, and the MAC entity
is configured with twoPHRMode }

**ensure that** {

**when** { phr-PeriodicTimer expires }

**then** { UE transmits an Enhanced Single entry PHR including two
values of power headroom. }

}

##### 7.1.1.3.17.2.2 Conformance requirements {#conformance-requirements-20 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.214 clause 6.1.2.1, TS 38.212 clause 7.3.1.1.2, TS
38.213 clause 7.7.1 and TS 38.321 5.4.6, 6.1.3.50. Unless otherwise
stated these are Rel-17 requirements.

\[TS 38.214, clause 6.1.2.1\]

When two SRS resource sets are configured in
*srs-ResourceSetToAddModList* or *srs-ResourceSetToAddModListDCI-0-2*
with higher layer parameter *usage* in *SRS-ResourceSet* set to
\'codebook\' or \'noncodebook\', for PUSCH repetition Type A, in case
*K\>1,* the same symbol allocation is applied across the *K* consecutive
slots and the PUSCH is limited to a single transmission layer. The UE
shall repeat the TB across the *K* consecutive slots applying the same
symbol allocation in each slot, and the association of the first and
second SRS resource set in *srs-ResourceSetToAddModList* or
*srs-ResourceSetToAddModListDCI-0-2 to* each slot is determined as
follows:

\- if a DCI format 0\_1 or DCI format 0\_2 indicates codepoint \"00\"
for the *SRS resource set indicator*, the first SRS resource set is
associated with all K consecutive slots,

\- if a DCI format 0\_1 or DCI format 0\_2 indicates codepoint \"01\"
for the *SRS resource set indicator*, the second SRS resource set is
associated with all K consecutive slots,

\- if a DCI format 0\_1 or DCI format 0\_2 indicates codepoint \"10\"
for the *SRS resource set indicator*, the first and second SRS resource
set association to K consecutive slots is determined as follows:

\- When K = 2, the first and second SRS resource sets are applied to the
first and second slot of 2 consecutive slots, respectively.

\- When K \> 2 and *cyclicMapping* in *PUSCH-Config* is enabled, the
first and second SRS resource sets are applied to the first and second
slot of K consecutive slots, respectively, and the same SRS resource set
mapping pattern continues to the remaining slots of K consecutive slots.

\- When K \> 2 and *sequentialMapping* in *PUSCH-Config* is enabled,
first SRS resource set is applied to the first and second slots of K
consecutive slots, and the second SRS resource set is applied to the
third and fourth slot of K consecutive slots, and the same SRS resource
set mapping pattern continues to the remaining slots of K consecutive
slots.

\- Otherwise, a DCI format 0\_1 or DCI format 0\_2 indicates codepoint
\"11\" for the *SRS resource set indicator*, and the first and second
SRS resource set association to K consecutive slots is determined as
follows,

\- When K = 2, the second and first SRS resource set are applied to the
first and second slot of 2 consecutive slots, respectively.

\- When K \> 2 and *cyclicMapping* in *PUSCH-Config* is enabled, the
second and first SRS resource sets are applied to the first and second
slot of K consecutive slots, respectively, and the same SRS resource set
mapping pattern continues to the remaining slots of the K consecutive
slots.

\- When K \> 2 and *sequentialMapping* in *PUSCH-Config* is enabled, the
second SRS resource set is applied to the first and second slot of K
consecutive slots, and the first SRS resource set is applied to the
third and fourth slot of K consecutive slots, and the same SRS resource
set mapping pattern continues to the remaining slots of the K
consecutive slots.

For PUSCH repetition Type B, when two SRS resource sets are configured
in *srs-ResourceSetToAddModList* or *srs-ResourceSetToAddModListDCI-0-2*
with higher layer parameter *usage* in *SRS-ResourceSet* set to
\'codebook\' or \'noncodebook\', the SRS resource set association to
nominal PUSCH repetitions follows the same method as SRS resource set
association to slots in PUSCH Type A repetition by considering nominal
repetitions instead of slots.

For both PUSCH repetition Type A and PUSCH repetition Type B, when a DCI
format 0\_1 or DCI format 0\_2 indicates codepoint \"10\" or \"11\" for
the *SRS resource set indicator*, the redundancy version to be applied
on the *n*th transmission occasion (for PUSCH repetition Type A) of the
TB, where n = 0, 1, ... *K*-1, or *n*th actual repetition (for PUSCH
repetition Type B, with the counting including the actual repetitions
that are omitted) is determined according to Table 6.1.2.1-2 and Table
6.1.2.1-3. For all PUSCH repetitions associated with the SRS resource
set of the first transmission occasion or actual repetition, the
redundancy version to be applied is derived according to Table
6.1.2.1-2, where n is counted only considering PUSCH transmission
occasions or actual repetitions associated with the same SRS resource
set as the first transmission occasion or actual repetition. The
redundancy version for PUSCH transmission occasions or actual
repetitions that are associated with an SRS resource set other than the
SRS resource set of the first transmission occasion or actual repetition
is derived according to Table 6.1.2.1-3, where additional shifting
operation for each redundancy version $\text{rv}_{s}\ $is configured by
higher layer parameter *sequenceOffsetforRV* in *PUSCH-Config* and $n$
is counted only considering PUSCH transmission occasions or actual
repetitions that are not associated with the SRS resource set of the
first transmission occasion or actual repetition.

Table 6.1.2.1-3: Applied redundancy version for the other SRS resource
set (SRS resource set not associated with the first transmission
occasion or actual repetition) when *sequenceOffsetforRV* is present

  *rv~id\ ~*indicated by the DCI scheduling the PUSCH   *rv~id~* to be applied to *n*^th^ transmission occasion (repetition Type A) or *n*^th^ actual repetition (repetition Type B)                                                                                         
  ----------------------------------------------------- ------------------------------------------------------------------------------------------------------------------------------ ------------------------------------------ ------------------------------------------ ------------------------------------------
                                                        *n* mod 4 = 0                                                                                                                  *n* mod 4 = 1                              *n* mod 4 = 2                              *n* mod 4 = 3
  $$0$$                                                 $$(0 + \ \text{rv}_{s})\ \text{mod}\ 4$$                                                                                       $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(3 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(1 + \ \text{rv}_{s})\ \text{mod}\ 4$$
  $$2$$                                                 $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$                                                                                       $$(3 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(1 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(0 + \ \text{rv}_{s})\ \text{mod}\ 4$$
  $$3$$                                                 $$(3 + \ \text{rv}_{s})\ \text{mod}\ 4$$                                                                                       $$(1 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(0 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$
  $$1$$                                                 $$(1 + \ \text{rv}_{s})\ \text{mod}\ 4$$                                                                                       $$(0 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(2 + \ \text{rv}_{s})\ \text{mod}\ 4$$   $$(3 + \ \text{rv}_{s})\ \text{mod}\ 4$$

\[TS 38.213, clause 7.1\]

\- For $j \in \left\{ 2,\ldots,J - 1 \right\} = S_{J}$, a
$P_{\text{O\_NOMINAL,PUSCH},f,c}\left( j \right)$ value, applicable for
all $j \in S_{J}$, is provided by *p0-NominalWithGrant,* or
$P_{\text{O\_NOMINAL,PUSCH},f,c}\left( j \right) = P_{\text{O\_NOMINAL,PUSCH},f,c}\left( 0 \right)$
if *p0-NominalWithGrant* is not provided, for each carrier $f$ *of*
serving cell $c$ and a set of
$P_{\text{O\_UE\_PUSCH},b,f,c}\left( j \right)\ $values are provided by
a set of *p0* in *P0-PUSCH-AlphaSet* indicated by a respective set of
*p0-PUSCH-AlphaSetId* for active UL BWP $b$ of carrier $f$ *of* serving
cell $c$

\- If the UE is provided by *SRI-PUSCH-PowerControl* more than one
values of *p0-PUSCH-AlphaSetId* and if a DCI format scheduling the PUSCH
transmission includes an SRI field, the UE obtains a mapping from
*sri-PUSCH-PowerControlId* in *SRI-PUSCH-PowerControl* between a set of
values for the SRI field in the DCI format \[5, TS 38.212\] and a set of
indexes provided by *p0-PUSCH-AlphaSetId* that map to a set of
*P0-PUSCH-AlphaSet* values and determines the value of
$P_{\text{O\_UE\_PUSCH},b,f,c}\left( j \right)$ from the
*p0-PUSCH-AlphaSetId* value that is mapped to the SRI field value. If
the UE is provided by *SRI-PUSCH-PowerControl* more than one values of
*p0-PUSCH-AlphaSetId*

> \- if the DCI format scheduling the PUSCH transmission includes two
> SRI fields and the UE is provided *two SRS resource sets in
> srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with
> usage set to \'codebook\'*, the UE obtains a mapping from
> *sri-PUSCH-PowerControlId* in *SRI-PUSCH-PowerControl* between a set
> of values for the two SRI fields and a set of indexes provided by
> *p0-PUSCH-AlphaSetId* that map to a set of *P0-PUSCH-AlphaSet* values,
> and determines first and second values of
> $P_{\text{O\_UE\_PUSCH},b,f,c}\left( j \right)$ from the
> *p0-PUSCH-AlphaSetId* values that are mapped to the values of the
> first and second SRI fields, respectively.

...

\- For $\alpha_{b,f,c}\left( j \right)$

...

\- For $j \in S_{J}$, a set of $\alpha_{b,f,c}\left( j \right)$ values
are provided by a set of *alpha* in *P0-PUSCH-AlphaSet* indicated by a
respective set of *p0-PUSCH-AlphaSetId* for active UL BWP $b$ of carrier
$f$ *of* serving cell $c$

\- If the UE is provided *SRI-PUSCH-PowerControl* and more than one
values of *p0-PUSCH-AlphaSetId in p0-AlphaSets*,

\- if a DCI format scheduling the PUSCH transmission includes two SRI
fields and the UE is provided *two SRS resource sets in
srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with
usage set to* \'codebook\', the UE obtains a mapping from
*sri-PUSCH-PowerControlId in SRI-PUSCH-PowerControl between a set of
values for*

\- the two SRI fields and a set of indexes provided by
*P0-PUSCH-AlphaSetId* that map to *P0-PUSCH-AlphaSet* values, and
determines first and second values of $\alpha_{b,f,c}\left( j \right)$
from the *P0-PUSCH-AlphaSetID* values that are mapped to the values of
the first and second SRI field values, respectively.

...

\- $\text{PL}_{b,f,c}(q_{d})$ is a downlink pathloss estimate in dB
calculated by the UE using reference signal (RS) index $q_{d}$ for the
active DL BWP, as described in clause 12, *of carrier* $f$ *of* serving
cell $c$

...

\- If the UE is provided *SRI-PUSCH-PowerControl* and more than one
values of *PUSCH-PathlossReferenceRS-Id*, the UE obtains a mapping from
*sri-PUSCH-PowerControlId* in *SRI-PUSCH-PowerControl* between a set of
values for the SRI field, or for first and second SRI fields if the UE
is provided *two SRS resource sets in srs-ResourceSetToAddModList or
srs-ResourceSetToAddModListDCI-0-2 with usage set to* \'codebook\', or
values for a first SRI field and values associated with a second SRI
field value corresponding to Tables 7.3.1.1.2-28/29/30/31 of \[5, TS
38.212\] for a same *number of layers as indicated by the first SRI
field value* if the UE is provided *two SRS resource sets in
srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with
usage set to* \'nonCodebook\', in a DCI format scheduling the PUSCH
transmission and a set of *PUSCH-PathlossReferenceRS-Id* values and
determines the RS resource index $q_{d}$, or respective first and second
RS resource indexes $q_{d}$, from the value of
*PUSCH-PathlossReferenceRS-Id* that is mapped to the SRI field value, or
from the values of *PUSCH-PathlossReferenceRS-Id* that are mapped to
respective first and second SRI field values if the UE is provided *two
SRS resource sets in srs-ResourceSetToAddModList or
srs-ResourceSetToAddModListDCI-0-2 with usage set to* \'codebook\', or
from the values of *PUSCH-PathlossReferenceRS-Id* that are mapped to
respective first SRI field value and a value associated with the second
SRI field value corresponding to Tables 7.3.1.1.2-28/29/30/31 of \[5, TS
38.212\] for a same *number of layers as indicated by the first SRI
field value* if the UE is provided *two SRS resource sets in
srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with
usage set to* \'nonCodebook\',

> where the RS resource is either on serving cell $c$ or, if provided,
> on a serving cell indicated by a value of *pathlossReferenceLinking*

...

> If the UE transmits a PUSCH associated with the first RS resource
> index $q_{d}$, the UE applies *the first*
> $P_{\text{O\_UE\_PUSCH},b,f,c}\left( j \right)$ value, the first
> $\alpha_{b,f,c}\left( j \right)$ value, and
> $f_{b,f,c}\left( i,l \right)$ for determining
> $P_{\text{PUSCH},b,f,c}(i,j,q_{d},l)$. If the UE transmits a PUSCH
> associated with the second RS resource index $q_{d}$, the UE applies
> *the second* $P_{\text{O\_UE\_PUSCH},b,f,c}\left( j \right)$ value,
> the second $\alpha_{b,f,c}\left( j \right)$ value, and
> $f_{b,f,c}\left( i,l \right)$ or $f_{b,f,c}\left( i,0 \right)$
> ifÂ *twoPUSCH-PC-AdjustmentStates*Â is provided or not provided,
> respectively, for determining $P_{\text{PUSCH},b,f,c}(i,j,q_{d},l)$.

\[TS 38.212, clause 7.3.1.1.2\]

\- TPC command for scheduled PUSCH -- 2 bits as defined in Clause 7.1.1
of \[5, TS38.213\]

\- Second TPC command for scheduled PUSCH -- 2 bits as defined in Clause
7.1.1 of \[5, TS38.213\] if higher layer parameter
*SecondTPCFieldDCI-0-1* is configured; 0 bit otherwise.

\- SRS resource set indicator -- 0 or 2 bits

\- 2 bits according to Table 7.3.1.1.2-36 if

\- *txConfig = nonCodeBook*, and there are two SRS resource sets
configured by *srs-ResourceSetToAddModList* and associated with the
*usage* of value \'*nonCodeBook*\', or

> \- *txConfig*=*codebook*, and there are two SRS resource sets
> configured by *srs-ResourceSetToAddModList* and associated with
> *usage* of value \'*codebook*\';

\- 0 bit otherwise.

\- SRS resource indicator -- or bits, where is the number of configured
SRS resources in the SRS resource set indicated by SRS resource set
indicator field if present; otherwise $N_{\text{SRS}}$ is the number of
configured SRS resources in the SRS resource set configured by higher
layer parameter *srs-ResourceSetToAddModList* and associated with the
higher layer parameter *usage* of value \'*codeBook*\' or
\'*nonCodeBook*\',

...

\- Second SRS resource indicator -- 0,
$\left\lceil \log_{2}{(\max_{k \in \{ 1,2,\ldots,min\{ L_{\max},N_{\text{SRS}}\}\}}\left( \frac{N_{\text{SRS}}}{k} \right))} \right\rceil$or
$\left\lceil \log_{2}{(N_{\text{SRS}})} \right\rceil$ bits,

\-
$\left\lceil \log_{2}{(\max_{k \in \{ 1,2,\ldots,min\{ L_{\max},N_{\text{SRS}}\}\}}\left( \frac{N_{\text{SRS}}}{k} \right))} \right\rceil$
bits according to Tables 7.3.1.1.2-28/29A/30A/31A with the same number
of layers indicated by SRS resource indicator field if the higher layer
parameter *txConfig = nonCodebook* and SRS resource set indicator field
is present, where $N_{\text{SRS}}$ is the number of configured SRS
resources in the second SRS resource set, and

\- if UE supports operation with *maxMIMO-Layers* and the higher layer
parameter *maxMIMO-Layers of PUSCH-ServingCellConfig* of the serving
cell is configured, *L~max~* is given by that parameter

\- otherwise, *L~max~* is given by the maximum number of layers for
PUSCH supported by the UE for the serving cell for non-codebook based
operation.

\- $\left\lceil \log_{2}{(N_{\text{SRS}})} \right\rceil$ bits according
to Tables 7.3.1.1.2-32, 7.3.1.1.2-32A and 7.3.1.1.2-32B if the higher
layer parameter *txConfig = codebook* and SRS resource set indicator
field is present, where $N_{\text{SRS}}$ is the number of configured SRS
resources in the second SRS resource set.

\- 0 bit otherwise.

\- Precoding information and number of layers -- number of bits
determined by the following:

...

> \- Second Precoding information -- number of bits determined by the
> following:

\- 0 bits if SRS resource set indicator field is not present;

\- 0 bits if the higher layer parameter *txConfig = nonCodeBook*;

\- 0 bits for 1 antenna port and if the higher layer parameter *txConfig
= codebook*;

\- 3, 4, or 5 bits according to Table 7.3.1.1.2-2C with the same number
of layers indicated by Precoding information and number of layers field
for 4 antenna ports, if SRS resource set indicator field is present,
*txConfig = codebook,* *ul-FullPowerTransmission is not configured or
configured to fullpowerMode2 or configured to fullpower,* transform
precoder is disabled, and according to the values of higher layer
parameters *maxRank, and* *codebookSubset;*

\- 3 or 4 bits according to Table 7.3.1.1.2-2D with the same number of
layers indicated by Precoding information and number of layers field for
4 antenna ports, if SRS resource set indicator field is present,
*txConfig = codebook,* *ul-FullPowerTransmission = fullpowerMode1,
maxRank=2,* transform precoder is disabled*,* and according to the
values of higher layer parameter *codebookSubset;*

\- 3 or 4 bits according to Table 7.3.1.1.2-2E with the same number of
layers indicated by Precoding information and number of layers field for
4 antenna ports, if SRS resource set indicator field is present,
*txConfig = codebook, ul-FullPowerTransmission = fullpowerMode1,*
*maxRank=3 or 4,* transform precoder is disabled, and according to the
values of higher layer parameter *codebookSubset;*

\- 2, 4, or 5 bits according to Table 7.3.1.1.2-3 with the same number
of layers indicated by Precoding information and number of layers field
for 4 antenna ports, if SRS resource set indicator field is present,
*txConfig = codebook,* *ul-FullPowerTransmission is not configured or
configured to fullpowerMode2 or configured to fullpower,* and according
to whether transform precoder is enabled or disabled, and the values of
higher layer parameters *maxRank, and codebookSubset;*

\- 3 or 4 bits according to Table 7.3.1.1.2-3A with the same number of
layers indicated by Precoding information and number of layers field for
4 antenna ports, if SRS resource set indicator field is present,
*txConfig = codebook,* *ul-FullPowerTransmission = fullpowerMode1,
maxRank=1,* and according to whether transform precoder is enabled or
disabled, and the values of higher layer parameter *codebookSubset;*

*- 1 or 3 bits* according to *Table7.3.1.1.2-4B* with the same number of
layers indicated by Precoding information and number of layers field
*for 2 antenna ports,* if SRS resource set indicator field is present,
*txConfig = codebook,* *ul-FullPowerTransmission is not configured or
configured to fullpowerMode2 or configured to fullpower,* transform
precoder is disabled, and according to the values of higher layer
parameters *maxRank and codebookSubset;*

\- 2 bits according to Table 7.3.1.1.2-4C with the same number of layers
indicated by Precoding information and number of layers field for 2
antenna ports, if SRS resource set indicator field is present, *txConfig
= codebook,* *ul-FullPowerTransmission = fullpowerMode1,* transform
precoder is disabled, *maxRank=2, and codebookSubset=nonCoherent;*

*- 1 or 3 bits according to Table7.3.1.1.2-5* with the same number of
layers indicated by Precoding information and number of layers field
*for 2 antenna ports,* if SRS resource set indicator field is present,
*txConfig = codebook,* *ul-FullPowerTransmission is not configured or
configured to fullpowerMode2 or configured to fullpower,* and according
to whether transform precoder is enabled or disabled, and the values of
higher layer parameters *maxRank and codebookSubset*;

> \- 2 bits according to Table 7.3.1.1.2-5A with the same number of
> layers indicated by Precoding information and number of layers field
> for 2 antenna ports, if SRS resource set indicator field is present,
> *txConfig = codebook,* *ul-FullPowerTransmission = fullpowerMode1,
> maxRank=1,* and according to whether transform precoder is enabled or
> disabled, and the values of higher layer parameter *codebookSubset;*

...

Table 7.3.1.1.2-4B: Second precoding information, for 2 antenna ports,
if transform precoder is disabled, *maxRank = 2, and
ul-FullPowerTransmission is not configured or configured to
fullpowerMode2 or configured to fullpower*

  Bit field mapped to index   *codebookSubset* = *fullyAndPartialAndNonCoherent*   Bit field mapped to index   *codebookSubset* = *nonCoherent*
  --------------------------- ---------------------------------------------------- --------------------------- ----------------------------------
  0                           1 layer: TPMI=0                                      0                           1 layer: TPMI=0
  1                           1 layer: TPMI=1                                      1                           1 layer: TPMI=1
  ...                         ...                                                  0                           2 layers: TPMI=0
  5                           1 layer: TPMI=5                                      1                           2 layers: reserved
  6-7                         1 layer: reserved                                                                
  0                           2 layers: TPMI=0                                                                 
  ...                         ...                                                                              
  2                           2 layers: TPMI=2                                                                 
  3-7                         2 layers: reserved                                                               

\[TS 38.321, clause 5.4.6\]

1\> if the allocated UL resources can accommodate the MAC CE for PHR
which the MAC entity is configured to transmit, plus its subheader, as a
result of LCP as defined in clause 5.4.3.1:

2\> if *multiplePHR* with value *true* is configured:

3\> for each activated Serving Cell with configured uplink associated
with any MAC entity of which the active DL BWP is not dormant BWP; and

3\> for each activated Serving Cell with configured uplink associated
with E-UTRA MAC entity:

4\> if this MAC entity is configured with *twoPHRMode*:

5\> if this Serving Cell is configured with multiple TRP PUSCH
repetition and the MAC entity this Serving Cell belongs to is configured
with *twoPHRMode*:

> 6\> obtain two values of the Type 1 or the value of Type 3 power
> headroom for the corresponding uplink carrier as specified in clause
> 7.7 of TS 38.213 \[6\] for NR Serving Cell.

5\> else:

> 6\> obtain the value of the Type 1 or Type 3 power headroom for the
> corresponding uplink carrier as specified in clause 7.7 of TS 38.213
> \[6\] for NR Serving Cell and clause 5.1.1.2 of TS 36.213 \[17\] for
> E-UTRA Serving Cell.

4\> else (i.e. this MAC entity is not configured with *twoPHRMode)*:

...

3\> instruct the Multiplexing and Assembly procedure to generate and
transmit the Enhanced Multiple entry PHR as defined in clause 6.1.3.49
if this MAC entity is configured with *mpe-Reporting-FR2-r17* or the
Enhanced Multiple Entry PHR for multiple TRP MAC CE as defined in clause
6.1.3.51 if this MAC entity is configured with *twoPHRMode* or the
Multiple Entry PHR MAC CE as defined in clause 6.1.3.9 otherwise based
on the values reported by the physical layer.

2\> else (i.e. Single Entry PHR format is used):

3\> if this MAC entity is configured with *twoPHRMode*:

4\> obtain two values of the Type 1 power headroom from the physical
layer for the corresponding uplink carrier of the PCell.

3\> else:

4\> obtain the value of the Type 1 power headroom from the physical
layer for the corresponding uplink carrier of the PCell.

3\> obtain the value for the corresponding P~CMAX,f,c~ field from the
physical layer;

...

3\> instruct the Multiplexing and Assembly procedure to generate and
transmit the Enhanced Single entry PHR as defined in clause 6.1.3.48 if
this MAC entity is configured with *mpe-Reporting-FR2-r17* or the
Enhanced Single Entry PHR for multiple TRP MAC CE as defined in clause
6.1.3.50 if this MAC entity is configured with *twoPHRMode* or the
Single Entry PHR MAC CE as defined in clause 6.1.3.8 otherwise based on
the values reported by the physical layer.

\[TS 38.321, clause 6.1.3.50\]

The Enhanced Single Entry PHR for multiple TRP MAC CE is identified by a
MAC subheader with eLCID as specified in Table 6.2.1-2b.

The two PHs together with one P~CMAX,f,c~ for the Serving Cell are
reported if UE is configured with *twoPHRMode* with the multiple TRP
PUSCH repetition feature is configured.

It has a fixed size and consists of three octets defined as follows
(Figure 6.1.3.50-1):

\- R: Reserved bit, set to 0;

\- Power Headroom i (PH i): This field indicates the power headroom
level, where PH 1 is associated with the *SRS-ResourceSet* with a lower
*srs-ResourceSetId* and PH 2 is associated with the SRS-ResourceSet with
a higher *srs-ResourceSetId*. PH fields for a Serving Cell are included
in ascending order based on i. The length of the field is 6 bits. The
reported PH and the corresponding power headroom levels are shown in
Table 6.1.3.8-1 (the corresponding measured values in dB are specified
in TS 38.133 \[11\]);

\- P: If *mpe-Reporting-FR2* is configured and the Serving Cell operates
on FR2, the MAC entity shall set this field to 0 if the applied P-MPR
value, to meet MPE requirements, as specified in TS 38.101-2 \[15\], is
less than P-MPR\_00 as specified in TS 38.133 \[11\] and to 1 otherwise.
If *mpe-Reporting-FR2* is not configured or the Serving Cell operates on
FR1, this field indicates whether power backoff is applied due to power
management (as allowed by P-MPRc as specified in TS 38.101-1 \[14\], TS
38.101-2 \[15\], and TS 38.101-3 \[16\]). The MAC entity shall set the P
field to 1 if the corresponding P~CMAX,f,c~ field would have had a
different value if no power backoff due to power management had been
applied;

\- V: This field indicates if the PH value for the corresponding TRP is
based on a real transmission or a reference format. For Type 1 PH, the V
field set to 0 indicates real transmission on PUSCH and the V field set
to 1 indicates that a PUSCH reference format is used;

\- P~CMAX,f,c~: This field indicates the P~CMAX,f,c~ (as specified in TS
38.213 \[6\]) used for calculation of the preceding PH fields. The
reported P~CMAX,f,c~ and the corresponding nominal UE transmit power
levels are shown in Table 6.1.3.8-2 (the corresponding measured values
in dBm are specified in TS 38.133 \[11\]);

\- MPE: If *mpe-Reporting-FR2* is configured, and the Serving Cell
operates on FR2, and if the P field is set to 1, this field indicates
the applied power backoff to meet MPE requirements, as specified in TS
38.101-2 \[15\]. This field indicates an index to Table 6.1.3.8-3 and
the corresponding measured values of P-MPR levels in dB are specified in
TS 38.133 \[11\]. The length of the field is 2 bits. If
*mpe-Reporting-FR2* is not configured, or if the Serving Cell operates
on FR1, or if the P field is set to 0, R bits are present instead.

Figure 6.1.3.50-1: Enhanced Single Entry PHR for multiple TRP MAC CE

\[TS 38.321, clause 6.1.3.51\]

The Enhanced Multiple Entry PHR for multiple TRP MAC CE is identified by
a MAC subheader with eLCID as specified in Table 6.2.1-2b.

It has a variable size, and includes the bitmaps, a Type 2 PH field and
an octet containing the associated P~CMAX,f,c~ field (if reported) for
SpCell of the other MAC entity, a Type 1 PH field and an octet
containing the associated P~CMAX,f,c~ field (if reported) for the PCell.
It further includes, in ascending order based on the *ServCellIndex*,
one or multiple of Type X PH fields and octets containing the associated
P~CMAX,f,c~ fields (if reported) for Serving Cells other than PCell
indicated in the bitmap for indicating the presence of PH(s). X is
either 1 or 3 according to TS 38.213 \[6\] and TS 36.213 \[17\].

The presence of Type 2 PH field for SpCell of the other MAC entity is
configured by *phr-Type2OtherCell* with value *true*.

A single octet bitmap is used for indicating the presence of PH(s) per
Serving Cell when the highest *ServCellIndex* of Serving Cell with
configured uplink is less than 8, otherwise four octets are used.

The MAC entity determines whether PH value for an activated Serving Cell
is based on real transmission or a reference format by considering the
configured grant(s) and downlink control information which has been
received until and including the PDCCH occasion in which the first UL
grant for a new transmission that can accommodate the MAC CE for PHR as
a result of LCP as defined in clause 5.4.3.1 is received since a PHR has
been triggered if the PHR MAC CE is reported on an uplink grant received
on the PDCCH or until the first uplink symbol of PUSCH transmission
minus PUSCH preparation time as defined in clause 7.7 of TS 38.213 \[6\]
if the PHR MAC CE is reported on a configured grant.

For a band combination in which the UE does not support dynamic power
sharing, the UE may omit the octets containing Power Headroom field and
P~CMAX,f,c~ field for Serving Cells in the other MAC entity except for
the PCell in the other MAC entity and the reported values of Power
Headroom and P~CMAX,f,c~ for the PCell are up to UE implementation.

The two PHs together with one P~CMAX,f,c~ for the Serving Cell
configured with the multiple TRP PUSCH repetition feature is configured
are reported if the MAC entity is configured with *twoPHRMode*.

The Enhanced Multiple Entry PHR for multiple TRP MAC CEs are defined as
follows:

\- C~i~: This field indicates the presence of PH field(s) for the
Serving Cell with *ServCellIndex* i as specified in TS 38.331 \[5\]. The
C~i~ field set to 1 indicates that PH field(s) for the Serving Cell with
*ServCellIndex* i is reported. The C~i~ field set to 0 indicates that a
PH field for the Serving Cell with *ServCellIndex* i is not reported;

\- R: Reserved bit, set to 0;

\- V: This field indicates if the PH value is based on a real
transmission or a reference format. For Type 1 PH, the V field set to 0
indicates real transmission on PUSCH and the V field set to 1 indicates
that a PUSCH reference format is used. For Type 2 PH, the V field set to
0 indicates real transmission on PUCCH and the V field set to 1
indicates that a PUCCH reference format is used. For Type 3 PH, the V
field set to 0 indicates real transmission on SRS and the V field set to
1 indicates that an SRS reference format is used. Furthermore, for Type
1, Type 2, and Type 3 PH, the V field set to 0 indicates the presence of
the octet containing the associated P~CMAX,f,c~ field and the MPE field,
and all of the V field(s) for the Serving Cell set to 1 indicates that
the octet containing the associated P~CMAX,f,c~ field and the MPE field
is omitted;

\- Power Headroom i (PH i): This field indicates the power headroom
level, where PH 1 is associated with the *SRS-ResourceSet* with a lower
*srs-ResourceSetId* and PH 2 is associated with the SRS-ResourceSet with
a higher *srs-ResourceSetId*. PH fields for a Serving Cell are included
in ascending order based on i. The length of the field is 6 bits. The
reported PH and the corresponding power headroom levels are shown in
Table 6.1.3.8-1 (the corresponding measured values in dB for the NR
Serving Cell are specified in TS 38.133 \[11\] while the corresponding
measured values in dB for the E-UTRA Serving Cell are specified in TS
36.133 \[12\]);

\- P: If *mpe-Reporting-FR2* is configured and the Serving Cell operates
on FR2, the MAC entity shall set this field to 0 if the applied P-MPR
value, to meet MPE requirements, as specified in TS 38.101-2 \[15\], is
less than P-MPR\_00 as specified in TS 38.133 \[11\] and to 1 otherwise.
If *mpe-Reporting-FR2* is not configured or the Serving Cell operates on
FR1, this field indicates whether power backoff is applied due to power
management (as allowed by P-MPRc as specified in TS 38.101-1 \[14\], TS
38.101-2 \[15\], and TS 38.101-3 \[16\]). The MAC entity shall set the P
field to 1 if the corresponding P~CMAX,f,c~ field would have had a
different value if no power backoff due to power management had been
applied;

\- P~CMAX,f,c~: If present, this field indicates the P~CMAX,f,c~ (as
specified in TS 38.213 \[6\]) for the NR Serving Cell and the P~CMAX,c~
or PÌ~CMAX,c~ (as specified in TS 36.213 \[17\]) for the E-UTRA Serving
Cell used for calculation of the preceding PH field. The reported
P~CMAX,f,c~ and the corresponding nominal UE transmit power levels are
shown in Table 6.1.3.8-2 (the corresponding measured values in dBm for
the NR Serving Cell are specified in TS 38.133 \[11\] while the
corresponding measured values in dBm for the E-UTRA Serving Cell are
specified in TS 36.133 \[12\]);

\- MPE: If *mpe-Reporting-FR2* is configured, and the Serving Cell
operates on FR2, and if the P field is set to 1, this field indicates
the applied power backoff to meet MPE requirements, as specified in TS
38.101-2 \[15\]. This field indicates an index to Table 6.1.3.8-3 and
the corresponding measured values of P-MPR levels in dB are specified in
TS 38.133 \[11\]. The length of the field is 2 bits. If
*mpe-Reporting-FR2* is not configured, or if the Serving Cell operates
on FR1, or if the P field is set to 0, R bits are present instead.

Figure 6.1.3.51-1: Enhanced Multiple Entry PHR for multiple TRP MAC CE
with the highest ServCellIndex of Serving Cell with configured uplink is
less than 8

Figure 6.1.3.51-2: Enhanced Multiple Entry PHR for multiple TRP MAC CE
with the highest ServCellIndex of Serving Cell with configured uplink is
equal to or higher than 8

##### 7.1.1.3.17.2.3 Test description {#test-description-20 .H6}

##### 7.1.1.3.17.2.3.1 Pre-test conditions {#pre-test-conditions-20 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that DRB is
configured in RLC AM mode according to Table 7.1.1.3.17.2.3.1-1.

Table 7.1.1.3.17.2.3.1-1: RLC parameters

  -------------------- ------
  *t-PollRetransmit*   ms80
  -------------------- ------

##### 7.1.1.3.17.2.3.2 Test procedure sequence {#test-procedure-sequence-20 .H6}

Table 7.1.1.3.17.2.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | SS        | \<\-\--   | *(RR      | \-      | \- |
|           | transmits |           | CReconfig |         |    |
|           | in the    |           | uration)* |         |    |
|           | indicated |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | an NR     |           |           |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | with      |           |           |         |    |
|           | s         |           |           |         |    |
|           | equential |           |           |         |    |
|           | mapping   |           |           |         |    |
|           | pattern   |           |           |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | as per    |           |           |         |    |
|           | Table     |           |           |         |    |
|           | 7         |           |           |         |    |
|           | .1.1.3.17 |           |           |         |    |
|           | .2.3.3-5. |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | UE        | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | NR        |           | gurationC |         |    |
|           | RRCRecon  |           | omplete)* |         |    |
|           | figuratio |           |           |         |    |
|           | nComplete |           |           |         |    |
|           | message   |           |           |         |    |
|           | to the    |           |           |         |    |
|           | SS. (Note |           |           |         |    |
|           | 2)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \<\-\--   | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a valid   |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | one RLC   |           |           |         |    |
|           | PDU.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | The UE    | \--\>     | (SR)      | \-      | \- |
|           | transmits |           |           |         |    |
|           | a         |           |           |         |    |
|           | S         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | Request.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | The SS    | \<\--     | UL Grant  | \-      | \- |
|           | allocates |           |           |         |    |
|           | an UL     |           |           |         |    |
|           | Grant     |           |           |         |    |
|           | s         |           |           |         |    |
|           | ufficient |           |           |         |    |
|           | for one   |           |           |         |    |
|           | RLC SDU   |           |           |         |    |
|           | to be     |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back in a |           |           |         |    |
|           | slot n,   |           |           |         |    |
|           | NDI       |           |           |         |    |
|           | indicates |           |           |         |    |
|           | new       |           |           |         |    |
|           | tran      |           |           |         |    |
|           | smission, |           |           |         |    |
|           | DCI       |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | the PUSCH |           |           |         |    |
|           | indicates |           |           |         |    |
|           | rv^ID^ =  |           |           |         |    |
|           | 0 and     |           |           |         |    |
|           | invalid   |           |           |         |    |
|           | symbol    |           |           |         |    |
|           | pattern   |           |           |         |    |
|           | indicator |           |           |         |    |
|           | set to 1. |           |           |         |    |
|           | The slot  |           |           |         |    |
|           | n is      |           |           |         |    |
|           | selected  |           |           |         |    |
|           | such that |           |           |         |    |
|           | slot      |           |           |         |    |
|           | n+k2-r16  |           |           |         |    |
|           | is the    |           |           |         |    |
|           | first UL  |           |           |         |    |
|           | slot in   |           |           |         |    |
|           | subframe  |           |           |         |    |
|           | m         |           |           |         |    |
|           | s         |           |           |         |    |
|           | atisfying |           |           |         |    |
|           | (m mod    |           |           |         |    |
|           | 20) = 9   |           |           |         |    |
|           | for       |           |           |         |    |
|           | SCS=15kHz |           |           |         |    |
|           | (except   |           |           |         |    |
|           | for       |           |           |         |    |
|           | HD\_FDD)  |           |           |         |    |
|           | and       |           |           |         |    |
|           | S         |           |           |         |    |
|           | CS=120kHz |           |           |         |    |
|           | and       |           |           |         |    |
|           |           |           |           |         |    |
|           | (m mod    |           |           |         |    |
|           | 20) = 8   |           |           |         |    |
|           | for       |           |           |         |    |
|           | SCS=30kHz |           |           |         |    |
|           | and       |           |           |         |    |
|           | HD\_FDD.  |           |           |         |    |
|           | (Note 4)  |           |           |         |    |
|           | (Note 5)  |           |           |         |    |
|           | (Note 6)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | one RLC   |           |           |         |    |
|           | SDU, in   |           |           |         |    |
|           | slot n+4  |           |           |         |    |
|           | and       |           |           |         |    |
|           | repeats   |           |           |         |    |
|           | in actual |           |           |         |    |
|           | re        |           |           |         |    |
|           | petitions |           |           |         |    |
|           | with same |           |           |         |    |
|           | resource  |           |           |         |    |
|           | a         |           |           |         |    |
|           | llocation |           |           |         |    |
|           | but       |           |           |         |    |
|           | different |           |           |         |    |
|           | r         |           |           |         |    |
|           | edundancy |           |           |         |    |
|           | version   |           |           |         |    |
|           | according |           |           |         |    |
|           | to Table  |           |           |         |    |
|           | 7.1.1.3.1 |           |           |         |    |
|           | 7.2.3.2-2 |           |           |         |    |
|           | for       |           |           |         |    |
|           | sequentia |           |           |         |    |
|           | lMapping, |           |           |         |    |
|           | if the    |           |           |         |    |
|           | slot can  |           |           |         |    |
|           | be used   |           |           |         |    |
|           | for       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | tran      |           |           |         |    |
|           | smission? |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC      |         |    |
|           | a MAC PDU |           | STATUS    |         |    |
|           | c         |           | PDU)      |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of the    |           |           |         |    |
|           | AMD PDU   |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 6.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8-12      | If UE     | \-        | \-        | \-      | \- |
|           | supports  |           |           |         |    |
|           | pc\_      |           |           |         |    |
|           | m         |           |           |         |    |
|           | trpPuschC |           |           |         |    |
|           | yclicMapp |           |           |         |    |
|           | ing\_r17, |           |           |         |    |
|           | repeat    |           |           |         |    |
|           | steps 1   |           |           |         |    |
|           | to 5 with |           |           |         |    |
|           | cyclic    |           |           |         |    |
|           | mapping   |           |           |         |    |
|           | pattern   |           |           |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | (in step  |           |           |         |    |
|           | 1) as per |           |           |         |    |
|           | Table     |           |           |         |    |
|           | 7         |           |           |         |    |
|           | .1.1.3.17 |           |           |         |    |
|           | .2.3.3-5. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | one RLC   |           |           |         |    |
|           | SDU, in   |           |           |         |    |
|           | HARQ      |           |           |         |    |
|           | process 1 |           |           |         |    |
|           | and in    |           |           |         |    |
|           | slot n+4  |           |           |         |    |
|           | and       |           |           |         |    |
|           | repeats   |           |           |         |    |
|           | in actual |           |           |         |    |
|           | re        |           |           |         |    |
|           | petitions |           |           |         |    |
|           | with same |           |           |         |    |
|           | resource  |           |           |         |    |
|           | a         |           |           |         |    |
|           | llocation |           |           |         |    |
|           | but       |           |           |         |    |
|           | different |           |           |         |    |
|           | r         |           |           |         |    |
|           | edundancy |           |           |         |    |
|           | version   |           |           |         |    |
|           | according |           |           |         |    |
|           | to Table  |           |           |         |    |
|           | 7.1.1.3.1 |           |           |         |    |
|           | 7.2.3.2-3 |           |           |         |    |
|           | for       |           |           |         |    |
|           | cycli     |           |           |         |    |
|           | cMapping, |           |           |         |    |
|           | if the    |           |           |         |    |
|           | slot can  |           |           |         |    |
|           | be used   |           |           |         |    |
|           | for       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | tran      |           |           |         |    |
|           | smission? |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC      |         |    |
|           | a MAC PDU |           | STATUS    |         |    |
|           | c         |           | PDU)      |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of the    |           |           |         |    |
|           | AMD PDU.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | Execute   | \-        | \-        | \-      | \- |
|           | steps     |           |           |         |    |
|           | 15-18 if  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | supports  |           |           |         |    |
|           | pc\_mt    |           |           |         |    |
|           | rpPuschTw |           |           |         |    |
|           | oPhrRepor |           |           |         |    |
|           | ting\_r17 |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | SS        | \<\--     | *(RR      | \-      | \- |
|           | transmits |           | CReconfig |         |    |
|           | NR        |           | uration)* |         |    |
|           | *R        |           |           |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | configure |           |           |         |    |
|           | specific  |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | p         |           |           |         |    |
|           | arameters |           |           |         |    |
|           | for NR    |           |           |         |    |
|           | Cell.     |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 16        | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | enhanced  |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | Control   |           |           |         |    |
|           | Element   |           |           |         |    |
|           | for       |           |           |         |    |
|           | multiple  |           |           |         |    |
|           | TRP?      |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note 7,  |           |           |         |    |
|           | 8)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17        | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an NR     |           | gurationC |         |    |
|           | *         |           | omplete)* |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | confirm   |           |           |         |    |
|           | the setup |           |           |         |    |
|           | of Power  |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | pa        |           |           |         |    |
|           | rameters. |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note     |           |           |         |    |
|           | 7,2)      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 18        | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | enhanced  |           |           |         |    |
|           | Power     |           |           |         |    |
|           | Headroom  |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | Control   |           |           |         |    |
|           | Element   |           |           |         |    |
|           | for       |           |           |         |    |
|           | multiple  |           |           |         |    |
|           | TRP 500ms |           |           |         |    |
|           | after     |           |           |         |    |
|           | step 13?  |           |           |         |    |
|           | (Note 8)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| 36.508    |           |           |           |         |    |
| \[7\],    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 4.6.1-8   |           |           |           |         |    |
| using     |           |           |           |         |    |
| condition |           |           |           |         |    |
| EN-DC\_   |           |           |           |         |    |
| EmbedNR\_ |           |           |           |         |    |
| RRCRecon. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| Checking  |           |           |           |         |    |
| the UE    |           |           |           |         |    |
| uses      |           |           |           |         |    |
| correct   |           |           |           |         |    |
| r         |           |           |           |         |    |
| edundancy |           |           |           |         |    |
| version   |           |           |           |         |    |
| and UE    |           |           |           |         |    |
| decides   |           |           |           |         |    |
| the       |           |           |           |         |    |
| number of |           |           |           |         |    |
| layer of  |           |           |           |         |    |
| all       |           |           |           |         |    |
| tra       |           |           |           |         |    |
| nsmission |           |           |           |         |    |
| according |           |           |           |         |    |
| to the    |           |           |           |         |    |
| '         |           |           |           |         |    |
| Precoding |           |           |           |         |    |
| in        |           |           |           |         |    |
| formation |           |           |           |         |    |
| and       |           |           |           |         |    |
| number of |           |           |           |         |    |
| layers'   |           |           |           |         |    |
| i         |           |           |           |         |    |
| mplicitly |           |           |           |         |    |
| upon      |           |           |           |         |    |
| correctly |           |           |           |         |    |
| decoding  |           |           |           |         |    |
| by the SS |           |           |           |         |    |
| of the UE |           |           |           |         |    |
| UL        |           |           |           |         |    |
| rep       |           |           |           |         |    |
| etitions. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 4:   |           |           |           |         |    |
| The UL    |           |           |           |         |    |
| grant is  |           |           |           |         |    |
| set to    |           |           |           |         |    |
| 384 bits: |           |           |           |         |    |
| L~RBs~ =  |           |           |           |         |    |
| 24 &      |           |           |           |         |    |
| I~MCS~ =  |           |           |           |         |    |
| 2 (with   |           |           |           |         |    |
| PUSCH-d   |           |           |           |         |    |
| uration=4 |           |           |           |         |    |
| and PUSCH |           |           |           |         |    |
| mapping   |           |           |           |         |    |
| Type B).  |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 5:   |           |           |           |         |    |
| HD\_FDD   |           |           |           |         |    |
| means     |           |           |           |         |    |
| pc\_ha    |           |           |           |         |    |
| lfDuplexF |           |           |           |         |    |
| DD\_TypeA |           |           |           |         |    |
| \_RedCap\ |           |           |           |         |    |
| _r17=true |           |           |           |         |    |
| (i.e      |           |           |           |         |    |
| HD\_FDD   |           |           |           |         |    |
| UE are    |           |           |           |         |    |
| p         |           |           |           |         |    |
| erforming |           |           |           |         |    |
| test on   |           |           |           |         |    |
| FDD       |           |           |           |         |    |
| band).    |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 6:   |           |           |           |         |    |
| k2-r16 is |           |           |           |         |    |
| c         |           |           |           |         |    |
| onfigured |           |           |           |         |    |
| in Table  |           |           |           |         |    |
| 7         |           |           |           |         |    |
| .1.1.3.17 |           |           |           |         |    |
| .2.3.3-3. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 7:   |           |           |           |         |    |
| Steps 16  |           |           |           |         |    |
| and 17    |           |           |           |         |    |
| can       |           |           |           |         |    |
| happen in |           |           |           |         |    |
| any       |           |           |           |         |    |
| order.    |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 8:   |           |           |           |         |    |
| For NR5GC |           |           |           |         |    |
| the       |           |           |           |         |    |
| received  |           |           |           |         |    |
| MAC PDU   |           |           |           |         |    |
| will      |           |           |           |         |    |
| contain   |           |           |           |         |    |
| Enhanced  |           |           |           |         |    |
| Single    |           |           |           |         |    |
| Entry PHR |           |           |           |         |    |
| for       |           |           |           |         |    |
| multiple  |           |           |           |         |    |
| TRP MAC   |           |           |           |         |    |
| CE. For   |           |           |           |         |    |
| EN        |           |           |           |         |    |
| -DC/NE-DC |           |           |           |         |    |
| the       |           |           |           |         |    |
| received  |           |           |           |         |    |
| MAC PDU   |           |           |           |         |    |
| will      |           |           |           |         |    |
| contain   |           |           |           |         |    |
| Enhanced  |           |           |           |         |    |
| Multiple  |           |           |           |         |    |
| Entry PHR |           |           |           |         |    |
| for       |           |           |           |         |    |
| multiple  |           |           |           |         |    |
| TRP MAC   |           |           |           |         |    |
| CE.       |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

Table 7.1.1.3.17.2.3.2-2: Transmitted actual repetition and redundancy
version in each nominal repetition for sequentialMapping

+-------------+-------------+-------------+-------------+-------------+
|             | Nominal     | Nominal     | Nominal     | Nominal     |
|             | repetition  | repetition  | repetition  | repetition  |
|             | 0           | 1           | 2           | 3           |
|             |             |             |             |             |
|             | (NOTE 1, 8) | (NOTE 1, 8) | (NOTE 2, 9) | (NOTE 3, 9) |
+=============+=============+=============+=============+=============+
| FR1 TDD     | Actual      | Actual      | N/A (NOTE   | N/A (NOTE   |
| SCS=15kHz   | repetition  | repetition  | 4, 5)       | 6)          |
|             | 0           | 0           |             |             |
|             |             |             |             |             |
|             | *rv~id~* =  | *rv~id~* =  |             |             |
|             | 0           | 2           |             |             |
+-------------+-------------+-------------+-------------+-------------+
| FR1 FDD     | Actual      | Actual      | Actual      | Actual      |
| SCS=15kHz   | repetition  | repetition  | repetition  | repetition  |
|             | 0           | 0           | 1 (NOTE 4,  | 0           |
|             |             |             | 7)          |             |
|             | *rv~id~* =  | *rv~id~* =  |             | *rv~id~* =  |
|             | 0           | 2           | *rv~id~* =  | 0           |
|             |             |             | 3           |             |
+-------------+-------------+-------------+-------------+-------------+
| FR1 TDD     | Actual      | Actual      | Actual      | Actual      |
| SCS=30kHz   | repetition  | repetition  | repetition  | repetition  |
|             | 0           | 0           | 1 (NOTE 4)  | 0           |
|             |             |             |             |             |
|             | *rv~id~* =  | *rv~id~* =  | *rv~id~* =  | *rv~id~* =  |
|             | 0           | 2           | 3           | 0           |
+-------------+-------------+-------------+-------------+-------------+
| FR2         | Actual      | Actual      | N/A (NOTE   | N/A (NOTE   |
| SCS=120kHz  | repetition  | repetition  | 4, 5)       | 6)          |
|             | 0           | 0           |             |             |
|             |             |             |             |             |
|             | *rv~id~* =  | *rv~id~* =  |             |             |
|             | 0           | 2           |             |             |
+-------------+-------------+-------------+-------------+-------------+
| NOTE 1: The |             |             |             |             |
| nominal     |             |             |             |             |
| repetition  |             |             |             |             |
| is in slot  |             |             |             |             |
| n+k2-r16    |             |             |             |             |
| and only    |             |             |             |             |
| one actual  |             |             |             |             |
| repetition  |             |             |             |             |
| expected.   |             |             |             |             |
|             |             |             |             |             |
| NOTE 2: The |             |             |             |             |
| nominal     |             |             |             |             |
| repetition  |             |             |             |             |
| is split    |             |             |             |             |
| into two    |             |             |             |             |
| actual      |             |             |             |             |
| repetitions |             |             |             |             |
| in slot n+  |             |             |             |             |
| k2-r16 and  |             |             |             |             |
| n+ k2-r16+1 |             |             |             |             |
| re          |             |             |             |             |
| spectively. |             |             |             |             |
|             |             |             |             |             |
| NOTE 3: The |             |             |             |             |
| nominal     |             |             |             |             |
| repetition  |             |             |             |             |
| is in slot  |             |             |             |             |
| n+ k2-r16+1 |             |             |             |             |
| and only    |             |             |             |             |
| one actual  |             |             |             |             |
| repetition  |             |             |             |             |
| expected.   |             |             |             |             |
|             |             |             |             |             |
| NOTE 4: The |             |             |             |             |
| actual      |             |             |             |             |
| repetition  |             |             |             |             |
| 0 is        |             |             |             |             |
| skipped due |             |             |             |             |
| to only 1   |             |             |             |             |
| valid       |             |             |             |             |
| symbol left |             |             |             |             |
| according   |             |             |             |             |
| to          |             |             |             |             |
| inv         |             |             |             |             |
| alidSymbolP |             |             |             |             |
| attern-r16. |             |             |             |             |
|             |             |             |             |             |
| NOTE 5: The |             |             |             |             |
| actual      |             |             |             |             |
| repetition  |             |             |             |             |
| 1 is        |             |             |             |             |
| skipped due |             |             |             |             |
| to being    |             |             |             |             |
| located in  |             |             |             |             |
| DL symbols  |             |             |             |             |
|             |             |             |             |             |
| NOTE 6: The |             |             |             |             |
| actual      |             |             |             |             |
| repetition  |             |             |             |             |
| 0 is        |             |             |             |             |
| skipped due |             |             |             |             |
| to being    |             |             |             |             |
| located in  |             |             |             |             |
| DL symbols  |             |             |             |             |
|             |             |             |             |             |
| NOTE 7: The |             |             |             |             |
| SS may not  |             |             |             |             |
| be able to  |             |             |             |             |
| decode the  |             |             |             |             |
| MAC PDU and |             |             |             |             |
| may only    |             |             |             |             |
| detect a    |             |             |             |             |
| CRC error   |             |             |             |             |
| as there    |             |             |             |             |
| are less    |             |             |             |             |
| symbols     |             |             |             |             |
| available   |             |             |             |             |
| for         |             |             |             |             |
| t           |             |             |             |             |
| ransmission |             |             |             |             |
| of the TBS  |             |             |             |             |
|             |             |             |             |             |
| NOTE 8:     |             |             |             |             |
| Associated  |             |             |             |             |
| with the    |             |             |             |             |
| SRS         |             |             |             |             |
| resource    |             |             |             |             |
| set 0.      |             |             |             |             |
|             |             |             |             |             |
| NOTE 9:     |             |             |             |             |
| Associated  |             |             |             |             |
| with the    |             |             |             |             |
| SRS         |             |             |             |             |
| resource    |             |             |             |             |
| set 1.      |             |             |             |             |
|             |             |             |             |             |
| NOTE 10:    |             |             |             |             |
| The         |             |             |             |             |
| redundancy  |             |             |             |             |
| versions    |             |             |             |             |
| are decided |             |             |             |             |
| according   |             |             |             |             |
| to TS       |             |             |             |             |
| 38.214      |             |             |             |             |
| \[15\]      |             |             |             |             |
| Table       |             |             |             |             |
| 6.1.2.1-2   |             |             |             |             |
| and Table   |             |             |             |             |
| 6.1.2.1-3.  |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+

Table 7.1.1.3.17.2.3.2-3: Transmitted actual repetition and redundancy
version in each nominal repetition for cyclicMapping

+-------------+-------------+-------------+-------------+-------------+
|             | Nominal     | Nominal     | Nominal     | Nominal     |
|             | repetition  | repetition  | repetition  | repetition  |
|             | 0           | 1           | 2           | 3           |
|             |             |             |             |             |
|             | (NOTE 1, 8) | (NOTE 1, 9) | (NOTE 2, 8) | (NOTE 3, 9) |
+=============+=============+=============+=============+=============+
| FR1 TDD     | Actual      | Actual      | N/A (NOTE   | N/A (NOTE   |
| SCS=15kHz   | repetition  | repetition  | 4, 5)       | 6)          |
|             | 0           | 0           |             |             |
|             |             |             |             |             |
|             | *rv~id~* =  | *rv~id~* =  |             |             |
|             | 0           | 1           |             |             |
+-------------+-------------+-------------+-------------+-------------+
| FR1 FDD     | Actual      | Actual      | Actual      | Actual      |
| SCS=15kHz   | repetition  | repetition  | repetition  | repetition  |
|             | 0           | 0           | 1           | 0           |
|             |             |             |             |             |
|             | *rv~id~* =  | *rv~id~* =  | *rv~id~* =  | *rv~id~* =  |
|             | 0           | 1           | 3 (NOTE 4,  | 3           |
|             |             |             | 7)          |             |
+-------------+-------------+-------------+-------------+-------------+
| FR1 TDD     | Actual      | Actual      | Actual      | Actual      |
| SCS=30kHz   | repetition  | repetition  | repetition  | repetition  |
|             | 0           | 0           | 1 (NOTE 4)  | 0           |
|             |             |             |             |             |
|             | *rv~id~* =  | *rv~id~* =  | *rv~id~* =  | *rv~id~* =  |
|             | 0           | 1           | 3           | 3           |
+-------------+-------------+-------------+-------------+-------------+
| FR2         | Actual      | Actual      | N/A (NOTE   | N/A (NOTE   |
| SCS=120kHz  | repetition  | repetition  | 4, 5)       | 6)          |
|             | 0           | 0           |             |             |
|             |             |             |             |             |
|             | *rv~id~* =  | *rv~id~* =  |             |             |
|             | 0           | 1           |             |             |
+-------------+-------------+-------------+-------------+-------------+
| NOTE 1: The |             |             |             |             |
| nominal     |             |             |             |             |
| repetition  |             |             |             |             |
| is in slot  |             |             |             |             |
| n+k2-r16    |             |             |             |             |
| and only    |             |             |             |             |
| one actual  |             |             |             |             |
| repetition  |             |             |             |             |
| expected.   |             |             |             |             |
|             |             |             |             |             |
| NOTE 2: The |             |             |             |             |
| nominal     |             |             |             |             |
| repetition  |             |             |             |             |
| is split    |             |             |             |             |
| into two    |             |             |             |             |
| actual      |             |             |             |             |
| repetitions |             |             |             |             |
| in slot n+  |             |             |             |             |
| k2-r16 and  |             |             |             |             |
| n+ k2-r16+1 |             |             |             |             |
| re          |             |             |             |             |
| spectively. |             |             |             |             |
|             |             |             |             |             |
| NOTE 3: The |             |             |             |             |
| nominal     |             |             |             |             |
| repetition  |             |             |             |             |
| is in slot  |             |             |             |             |
| n+ k2-r16+1 |             |             |             |             |
| and only    |             |             |             |             |
| one actual  |             |             |             |             |
| repetition  |             |             |             |             |
| expected.   |             |             |             |             |
|             |             |             |             |             |
| NOTE 4: The |             |             |             |             |
| actual      |             |             |             |             |
| repetition  |             |             |             |             |
| 0 is        |             |             |             |             |
| skipped due |             |             |             |             |
| to only 1   |             |             |             |             |
| valid       |             |             |             |             |
| symbol left |             |             |             |             |
| according   |             |             |             |             |
| to          |             |             |             |             |
| inv         |             |             |             |             |
| alidSymbolP |             |             |             |             |
| attern-r16. |             |             |             |             |
|             |             |             |             |             |
| NOTE 5: The |             |             |             |             |
| actual      |             |             |             |             |
| repetition  |             |             |             |             |
| 1 is        |             |             |             |             |
| skipped due |             |             |             |             |
| to being    |             |             |             |             |
| located in  |             |             |             |             |
| DL symbols  |             |             |             |             |
|             |             |             |             |             |
| NOTE 6: The |             |             |             |             |
| actual      |             |             |             |             |
| repetition  |             |             |             |             |
| 0 is        |             |             |             |             |
| skipped due |             |             |             |             |
| to being    |             |             |             |             |
| located in  |             |             |             |             |
| DL symbols  |             |             |             |             |
|             |             |             |             |             |
| NOTE 7: The |             |             |             |             |
| SS may not  |             |             |             |             |
| be able to  |             |             |             |             |
| decode the  |             |             |             |             |
| MAC PDU and |             |             |             |             |
| may only    |             |             |             |             |
| detect a    |             |             |             |             |
| CRC error   |             |             |             |             |
| as there    |             |             |             |             |
| are less    |             |             |             |             |
| symbols     |             |             |             |             |
| available   |             |             |             |             |
| for         |             |             |             |             |
| t           |             |             |             |             |
| ransmission |             |             |             |             |
| of the TBS  |             |             |             |             |
|             |             |             |             |             |
| NOTE 8:     |             |             |             |             |
| Associated  |             |             |             |             |
| with the    |             |             |             |             |
| SRS         |             |             |             |             |
| resource    |             |             |             |             |
| set 0.      |             |             |             |             |
|             |             |             |             |             |
| NOTE 9:     |             |             |             |             |
| Associated  |             |             |             |             |
| with the    |             |             |             |             |
| SRS         |             |             |             |             |
| resource    |             |             |             |             |
| set 1.      |             |             |             |             |
|             |             |             |             |             |
| NOTE 10:    |             |             |             |             |
| The         |             |             |             |             |
| redundancy  |             |             |             |             |
| versions    |             |             |             |             |
| are decided |             |             |             |             |
| according   |             |             |             |             |
| to TS       |             |             |             |             |
| 38.214      |             |             |             |             |
| \[15\]      |             |             |             |             |
| Table       |             |             |             |             |
| 6.1.2.1-2   |             |             |             |             |
| and Table   |             |             |             |             |
| 6.1.2.1-3.  |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+

##### 7.1.1.3.17.2.3.3 Specific message contents {#specific-message-contents-20 .H6}

Table 7.1.1.3.17.2.3.3-0: *ServingCellConfigCommon* (Pre-test
conditions)

+------------------+------------------+---------+------------------+
| Derivation Path: |                  |         |                  |
| TS 38.508-1      |                  |         |                  |
| \[4\], Table     |                  |         |                  |
| 4.6.1-168        |                  |         |                  |
+==================+==================+=========+==================+
| Information      | Value/remark     | Comment | Condition        |
| Element          |                  |         |                  |
+------------------+------------------+---------+------------------+
| Serving          |                  |         |                  |
| CellConfigCommon |                  |         |                  |
| ::= SEQUENCE {   |                  |         |                  |
+------------------+------------------+---------+------------------+
| ssb-             |                  |         |                  |
| PositionsInBurst |                  |         |                  |
| CHOICE {         |                  |         |                  |
+------------------+------------------+---------+------------------+
| shortBitmap      | 1100             |         | FR1 AND          |
|                  |                  |         |                  |
|                  |                  |         | (1.88            |
|                  |                  |         | GHz\<FREQ\<=3GHz |
|                  |                  |         |                  |
|                  |                  |         | AND (FDD OR (TDD |
|                  |                  |         | AND SCS15)) OR   |
|                  |                  |         |                  |
|                  |                  |         | FREQ\<=1.88GHZ)  |
+------------------+------------------+---------+------------------+
| mediumBitmap     | 11000000         |         | FR1 AND          |
|                  |                  |         |                  |
|                  |                  |         | (1.88            |
|                  |                  |         | GHz\<FREQ\<=3GHz |
|                  |                  |         |                  |
|                  |                  |         | AND (TDD AND     |
|                  |                  |         | SCS30) OR        |
|                  |                  |         | FREQ\>3GHz)      |
+------------------+------------------+---------+------------------+
| longBitmap       | 1100000000000000 |         | FR2              |
|                  | 0000000000000000 |         |                  |
|                  | 0000000000000000 |         |                  |
|                  | 0000000000000000 |         |                  |
+------------------+------------------+---------+------------------+
| }                |                  |         |                  |
+------------------+------------------+---------+------------------+
| }                |                  |         |                  |
+------------------+------------------+---------+------------------+

Table 7.1.1.3.17.2.3.3-1: *RRCReconfiguration* (steps 1 and 8, Table
7.1.1.3.17.2.3.2-1)

  ---------------------------------------------------- ----------------- ------------------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                                                                 
  Information Element                                  Value/remark      Comment                                     Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                  
  criticalExtensions CHOICE {                                                                                        
  rrcReconfiguration SEQUENCE {                                                                                      
  secondaryCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   EN-DC
  nonCriticalExtension SEQUENCE {                                                                                    NR
  masterCellGroup                                      CellGroupConfig                                               
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  ---------------------------------------------------- ----------------- ------------------------------------------- -----------

Table 7.1.1.3.17.2.3.3-2: *CellGroupConfig* (Table 7.1.1.3.17.2.3.3-1)

  ---------------------------------------------------- ------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19                                 
  Information Element                                  Value/remark        Comment   Condition
  CellGroupConfig::= SEQUENCE {                                                      
  cellGroupId                                          0                             
                                                       1                             EN-DC
  spCellConfig SEQUENCE {                                                            
  spCellConfigDedicated                                ServingCellConfig             
  }                                                                                  
  }                                                                                  
  ---------------------------------------------------- ------------------- --------- -----------

Table 7.1.1.3.17.2.3.3-3: *ServingCellConfig* (Table 7.1.1.3.17.2.3.3-2)

  ----------------------------------------------------- --------------------- ------------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167                                       
  **Information Element**                               **Value/remark**      **Comment**   **Condition**
  ServingCellConfig ::= SEQUENCE {                                                          
  uplinkConfig SEQUENCE {                                                                   
  initialUplinkBWP                                      BWP-UplinkDedicated                 
  }                                                                                         
  }                                                                                         
  ----------------------------------------------------- --------------------- ------------- ---------------

Table 7.1.1.3.17.2.3.3-4: *BWP-UplinkDedicated* (Table
7.1.1.3.17.2.3.3-3)

  ---------------------------------------------------- ------------------ ------------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-11                                    
  **Information Element**                              **Value/remark**   **Comment**   **Condition**
  BWP-UplinkDedicated ::= SEQUENCE {                                                    
  pusch-Config CHOICE {                                                                 
  setup                                                PUSCH-Config                     
  }                                                                                     
  }                                                                                     
  ---------------------------------------------------- ------------------ ------------- ---------------

Table 7.1.1.3.17.2.3.3-5 *PUSCH-Config* (Table 7.1.1.3.17.2.3.3-4)

  ------------------------------------------------------------------------------------------ -------------------- ------------- ---------------------------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-118                                                                           
  **Information Element**                                                                    **Value/remark**     **Comment**   **Condition**
  PUSCH-Config ::= SEQUENCE {                                                                                                   
  dmrs-UplinkForPUSCH-MappingTypeB CHOICE {                                                                                     
  setup                                                                                      DMRS-UplinkConfig                  
  }                                                                                                                             
  pusch-PowerControl                                                                         PUSCH-PowerControl                 
  pusch-TimeDomainAllocationListDCI-0-1-r16 CHOICE {                                                                            
  setup SEQUENCE (SIZE(1..maxNrofUL-Allocations-r16)) OF SEQUENCE {                          1 entry                            
  k2-r16\[1\]                                                                                4                                  
                                                                                             3                                  HD\_FDD
  puschAllocationList-r16\[1\] SEQUENCE (SIZE(1..maxNrofMultiplePUSCHs-r16)) OF SEQUENCE {   1 entry                            
  mappingType-r16\[1\]                                                                       Not present                        
  startSymbolAndLength-r16\[1\]                                                              Not present                        
  startSymbol-r16\[1\]                                                                       4                                  
  length-r16\[1\]                                                                            4                                  
  numberOfRepetitions-r16\[1\]                                                               n4                                 
  }                                                                                                                             
  }                                                                                                                             
  }                                                                                                                             
  invalidSymbolPatternIndicatorDCI-0-1-r16                                                   enabled                            
  pusch-RepTypeIndicatorDCI-0-1-r16                                                          pusch-RepTypeB                     
  invalidSymbolPattern-r16 SEQUENCE {                                                                                           
  symbols-r16 CHOICE {                                                                                                          
  oneSlot                                                                                    00000000000001                     
  }                                                                                                                             
  periodicityAndPattern-r16                                                                  Not present                        
  }                                                                                                                             
  mappingPattern-r17                                                                         cyclicMapping                      pc\_mtrpPuschCyclicMapping\_r17
                                                                                             sequentialMapping                  
  secondTPCFieldDCI-0-1-r17                                                                  Not present                        
  secondTPCFieldDCI-0-2-r17                                                                  Not present                        
  sequenceOffsetForRV-r17                                                                    1                                  
  }                                                                                                                             
  ------------------------------------------------------------------------------------------ -------------------- ------------- ---------------------------------

  ----------- ----------------------------------------------------------------------------------------
  Condition   Explanation
  HD\_FDD     pc\_halfDuplexFDD\_TypeA\_RedCap\_r17 (i.e HD\_FDD UE are performing test on FDD band)
  ----------- ----------------------------------------------------------------------------------------

Table 7.1.1.3.17.2.3.3-6: *DMRS-UplinkConfig* (Table 7.1.1.3.17.2.3.3-5)

  --------------------------------------------------------
  Derivation Path: TS 38.**508-1 \[4\],** Table 4.6.3-51
  --------------------------------------------------------

Table 7.1.1.3.17.2.3.3-7: *PUSCH-PowerControl* (Table
7.1.1.3.17.2.3.3-5)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-120                                                                                              
  ----------------------------------------------------------------------------------------------------------------------- -------------- --------- -----------
  Information Element                                                                                                     Value/remark   Comment   Condition
  PUSCH-PowerControl ::= SEQUENCE {                                                                                                                
  p0-AlphaSets SEQUENCE (SIZE (1..maxNrofP0-PUSCH-AlphaSets)) OF P0-PUSCH-AlphaSet {                                      2 entries                
  P0-PUSCH-AlphaSet\[1\] SEQUENCE {                                                                                                      entry 1   
  p0-PUSCH-AlphaSetId                                                                                                     0                        
  p0                                                                                                                      0                        
  alpha                                                                                                                   alpha08                  
  }                                                                                                                                                
  P0-PUSCH-AlphaSet\[2\] SEQUENCE {                                                                                                      entry 2   
  p0-PUSCH-AlphaSetId                                                                                                     1                        
  p0                                                                                                                      -20                      
  alpha                                                                                                                   alpha08                  
  }                                                                                                                                                
  }                                                                                                                                                
  pathlossReferenceRSToAddModList SEQUENCE (SIZE (1..maxNrofPUSCH-PathlossReferenceRSs)) OF PUSCH-PathlossReferenceRS {   2 entries                
  PUSCH-PathlossReferenceRS\[1\] SEQUENCE {                                                                                              entry 1   
  pusch-PathlossReferenceRS-Id                                                                                            0                        
  referenceSignal CHOICE{                                                                                                                          
  ssb-Index                                                                                                               0                        
  }                                                                                                                                                
  }                                                                                                                                                
  PUSCH-PathlossReferenceRS\[2\] SEQUENCE {                                                                                              entry 2   
  pusch-PathlossReferenceRS-Id                                                                                            1                        
  referenceSignal CHOICE{                                                                                                                          
  ssb-Index                                                                                                               1                        
  }                                                                                                                                                
  }                                                                                                                                                
  }                                                                                                                                                
  sri-PUSCH-MappingToAddModList SEQUENCE (SIZE (1..maxNrofSRI-PUSCH-Mappings)) OF SRI-PUSCH-PowerControl {                2 entries                
  SRI-PUSCH-PowerControl\[1\] SEQUENCE {                                                                                                 entry 1   
  sri-PUSCH-PowerControlId                                                                                                0                        
  sri-PUSCH-PathlossReferenceRS-Id                                                                                        0                        
  sri-P0-PUSCH-AlphaSetId                                                                                                 0                        
  sri-PUSCH-ClosedLoopIndex                                                                                               i0                       
  }                                                                                                                                                
  SRI-PUSCH-PowerControl\[2\] SEQUENCE {                                                                                                 entry 2   
  sri-PUSCH-PowerControlId                                                                                                1                        
  sri-PUSCH-PathlossReferenceRS-Id                                                                                        1                        
  sri-P0-PUSCH-AlphaSetId                                                                                                 1                        
  sri-PUSCH-ClosedLoopIndex                                                                                               i1                       
  }                                                                                                                                                
  }                                                                                                                                                
  }                                                                                                                                                

Table 7.1.1.3.17.2.3.3-8: *SRS-Config* (Table 7.1.1.3.17.2.3.3-4)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-182                                                                             
  ---------------------------------------------------------------------------------------------- ------------------ ------------- -----------------------
  **Information Element**                                                                        **Value/remark**   **Comment**   **Condition**
  SRS-Config ::= SEQUENCE {                                                                                                       
  srs-ResourceSetToReleaseList                                                                   Not present                      
  srs-ResourceSetToAddModList SEQUENCE (SIZE(0..maxNrofSRS-ResourceSets)) OF SRS-ResourceSet {   2 entries                        
  SRS-ResourceSet\[1\] SEQUENCE {                                                                                   entry 1       
  srs-ResourceSetId                                                                              0                                
  srs-ResourceIdList SEQUENCE (SIZE(1..maxNrofSRS-ResourcesPerSet)) OF SRS-ResourceId {          1 entry                          
  SRS-ResourceId\[1\]                                                                            0                  entry 1       
  }                                                                                                                               
  resourceType CHOICE {                                                                                                           
  aperiodic SEQUENCE {                                                                                                            
  aperiodicSRS-ResourceTrigger                                                                   1                                
  csi-RS                                                                                         Not present                      
  slotOffset                                                                                     7                                FR1
                                                                                                 4                                FR2
  }                                                                                                                               
  }                                                                                                                               
  usage                                                                                          codebook                         
  alpha                                                                                          Alpha                            
  p0                                                                                             0                                
  pathlossReferenceRS CHOICE {                                                                                                    
  ssb-Index                                                                                      SSB-Index                        
  }                                                                                                                               
  srs-PowerControlAdjustmentStates                                                               Not present                      
  }                                                                                                                               
  SRS-ResourceSet\[2\] SEQUENCE {                                                                                   entry 2       
  srs-ResourceSetId                                                                              1                                
  srs-ResourceIdList SEQUENCE (SIZE(1..maxNrofSRS-ResourcesPerSet)) OF SRS-ResourceId {          1 entry                          
  SRS-ResourceId\[1\]                                                                            1                  entry 1       
  }                                                                                                                               
  resourceType CHOICE {                                                                                                           
  aperiodic SEQUENCE {                                                                                                            
  aperiodicSRS-ResourceTrigger                                                                   1                                
  csi-RS                                                                                         Not present                      
  slotOffset                                                                                     7                                FR1
                                                                                                 4                                FR2
  }                                                                                                                               
  }                                                                                                                               
  usage                                                                                          codebook                         
  alpha                                                                                          Alpha                            
  p0                                                                                             0                                
  pathlossReferenceRS CHOICE {                                                                                                    
  ssb-Index                                                                                      SSB-Index                        
  }                                                                                                                               
  srs-PowerControlAdjustmentStates                                                               Not present                      
  }                                                                                                                               
  }                                                                                                                               
  srs-ResourceToReleaseList                                                                      Not present                      
  srs-ResourceToAddModList SEQUENCE (SIZE(1..maxNrofSRS-Resources)) OF SRS-Resource {            2 entries                        
  SRS-Resource\[1\] SEQUENCE {                                                                                      entry 1       
  srs-ResourceId                                                                                 0                                
  nrofSRS-Ports                                                                                  ports2                           pc\_nrMIMO\_CB\_PUSCH
                                                                                                 port1                            
  ptrs-PortIndex                                                                                 Not present                      
  transmissionComb CHOICE {                                                                                                       
  n2 SEQUENCE {                                                                                                                   
  combOffset-n2                                                                                  0                                
  cyclicShift-n2                                                                                 0                                
  }                                                                                                                               
  }                                                                                                                               
  resourceMapping SEQUENCE {                                                                                                      
  startPosition                                                                                  0                                
  nrofSymbols                                                                                    n1                               
  repetitionFactor                                                                               n1                               
  }                                                                                                                               
  freqDomainPosition                                                                             0                                
  freqDomainShift                                                                                0                                
  freqHopping SEQUENCE {                                                                                                          
  c-SRS                                                                                          0                                
                                                                                                 63                               FR1\_100MHz
                                                                                                 17                               FR2\_100MHz
  b-SRS                                                                                          0                                
  b-hop                                                                                          0                                
  }                                                                                                                               
  groupOrSequenceHopping                                                                         groupHopping                     
  resourceType CHOICE {                                                                                                           
  aperiodic SEQUENCE {                                                                                                            
  }                                                                                                                               
  }                                                                                                                               
  sequenceId                                                                                     0                                
  spatialRelationInfo SEQUENCE {                                                                                                  
  servingCellId                                                                                  Not present                      
  referenceSignal CHOICE {                                                                                                        
  ssb-Index                                                                                      0                                
  }                                                                                                                               
  }                                                                                                                               
  }                                                                                                                               
  SRS-Resource\[2\] SEQUENCE {                                                                                      entry 2       
  srs-ResourceId                                                                                 0                                
  nrofSRS-Ports                                                                                  ports2                           pc\_nrMIMO\_CB\_PUSCH
                                                                                                 port1                            
  ptrs-PortIndex                                                                                 Not present                      
  transmissionComb CHOICE {                                                                                                       
  n2 SEQUENCE {                                                                                                                   
  combOffset-n2                                                                                  1                                
  cyclicShift-n2                                                                                 0                                
  }                                                                                                                               
  }                                                                                                                               
  resourceMapping SEQUENCE {                                                                                                      
  startPosition                                                                                  0                                
  nrofSymbols                                                                                    n1                               
  repetitionFactor                                                                               n1                               
  }                                                                                                                               
  freqDomainPosition                                                                             0                                
  freqDomainShift                                                                                0                                
  freqHopping SEQUENCE {                                                                                                          
  c-SRS                                                                                          0                                
                                                                                                 63                               FR1\_100MHz
                                                                                                 17                               FR2\_100MHz
                                                                                                 0                                FR2\_MBWP
  b-SRS                                                                                          0                                
  b-hop                                                                                          0                                
  }                                                                                                                               
  groupOrSequenceHopping                                                                         groupHopping                     
  resourceType CHOICE {                                                                                                           
  aperiodic SEQUENCE {                                                                                                            
  }                                                                                                                               
  }                                                                                                                               
  sequenceId                                                                                     0                                
  spatialRelationInfo SEQUENCE {                                                                                                  
  servingCellId                                                                                  Not present                      
  referenceSignal CHOICE {                                                                                                        
  ssb-Index                                                                                      1                                
  }                                                                                                                               
  }                                                                                                                               
  }                                                                                                                               
  }                                                                                                                               
  tpc-Accumulation                                                                               Not present                      
  }                                                                                                                               

Table 7.1.1.3.17.2.3.3-9: RRCReconfiguration (step 12, Table
7.1.1.3.17.2.3.2-1)

+-----------------+-----------------+-----------------+-----------+
| Derivation      |                 |                 |           |
| Path: TS        |                 |                 |           |
| 38.508-1 \[4\], |                 |                 |           |
| Table 4.6.1-13  |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| Information     | Value/remark    | Comment         | Condition |
| Element         |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| RRC             |                 |                 |           |
| Reconfiguration |                 |                 |           |
| ::= SEQUENCE {  |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| cri             |                 |                 |           |
| ticalExtensions |                 |                 |           |
| CHOICE {        |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| rrc             |                 |                 |           |
| Reconfiguration |                 |                 |           |
| SEQUENCE {      |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| sec             | CellGroupConfig | OCTET STRING    | EN-DC     |
| ondaryCellGroup |                 | (CONTAINING     |           |
|                 |                 | C               |           |
|                 |                 | ellGroupConfig) |           |
+-----------------+-----------------+-----------------+-----------+
| nonCr           |                 |                 | NR        |
| iticalExtension |                 |                 |           |
| SEQUENCE {      |                 |                 | NE-DC     |
+-----------------+-----------------+-----------------+-----------+
| masterCellGroup | CellGroupConfig | OCTET STRING    |           |
|                 |                 | (CONTAINING     |           |
|                 |                 | C               |           |
|                 |                 | ellGroupConfig) |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+

Table 7.1.1.3.17.2.3.3-10: CellGroupConfig (Table 7.1.1.3.17.2.3.3-9)

+------------------------------+--------------+---------+-----------+
| Derivation Path: TS 38.508-1 |              |         |           |
| \[4\], Table 4.6.3-19        |              |         |           |
+------------------------------+--------------+---------+-----------+
| Information Element          | Value/remark | Comment | Condition |
+------------------------------+--------------+---------+-----------+
| cellGroupConfig::= SEQUENCE  |              |         |           |
| {                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| mac-CellGroupConfig SEQUENCE |              |         |           |
| {                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| phr-Config CHOICE {          |              |         |           |
+------------------------------+--------------+---------+-----------+
| setup SEQUENCE {             |              |         |           |
+------------------------------+--------------+---------+-----------+
| phr-PeriodicTimer            | sf500        |         |           |
+------------------------------+--------------+---------+-----------+
| phr-ProhibitTimer            | sf1000       |         |           |
+------------------------------+--------------+---------+-----------+
| phr-Tx-PowerFactorChange     | infinity     |         |           |
+------------------------------+--------------+---------+-----------+
| multiplePHR                  | false        |         |           |
+------------------------------+--------------+---------+-----------+
| multiplePHR                  | true         |         | EN-DC     |
|                              |              |         |           |
|                              |              |         | NE-DC     |
+------------------------------+--------------+---------+-----------+
| phr-Type2PCell               | false        |         |           |
+------------------------------+--------------+---------+-----------+
| phr-Type2OtherCell           | false        |         |           |
+------------------------------+--------------+---------+-----------+
| phr-ModeOtherCG              | real         |         |           |
+------------------------------+--------------+---------+-----------+
| mpe-Reporting-FR2-r17        | Not present  |         |           |
+------------------------------+--------------+---------+-----------+
| twoPHRMode-r17               | enabled      |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+
| }                            |              |         |           |
+------------------------------+--------------+---------+-----------+

Table 7.1.1.3.17.2.3.3-11: Physical layer parameters for DCI format 0\_1
(Steps 5, 8, Table 7.1.1.3.17.2.3.2-1)

  Derivation path: TS 38.508-1 \[4\] Table 4.3.6.1.1.2-1                                                                                                                                                              
  -------------------------------------------------------- ---------------------------------------------------------------------------------------------------------------------------------------- ----------------- -----------------------
  Parameter                                                Value                                                                                                                                    Value in binary   Condition
  TPC command for scheduled PUSCH                          0 dB (accumulated TPC) as per Table 7.1.1-1 in TS 38.213 \[22\]                                                                          "01"              
  Second TPC command for scheduled PUSCH                   0 dB (accumulated TPC) as per Table 7.1.1-1 in TS 38.213 \[22\]                                                                          "01"              
  SRS resource set indicator                               2 as per Table 7.3.1.1.2-36 in TS 38.212 \[27\]                                                                                          "10"              
  SRS resource indicator                                   0                                                                                                                                        "0"               
  Second SRS resource indicator                            1                                                                                                                                        "1"               
  Precoding information and number of layers               Not present (0 bits for 1 antenna port and if the higher layer parameter txConfig = Codebook as per clause 7.3.1.1.2 TS 38.212 \[27\])   \-                
                                                           2                                                                                                                                        "10"              pc\_nrMIMO\_CB\_PUSCH
  Second Precoding information                             Not present (0 bits for 1 antenna port and if the higher layer parameter txConfig = Codebook as per clause 7.3.1.1.2 TS 38.212 \[27\])   \-                
                                                           0                                                                                                                                        "00"              pc\_nrMIMO\_CB\_PUSCH

##### 7.1.1.3.18 Correct Handling of MAC control information / Buffer status / UL data arrive in the UE Tx buffer / Refined BSR

##### 7.1.1.3.18.1 Test Purpose (TP) {#test-purpose-tp-22 .H6}

##### (1) {#section-59 .H6}

**with** { UE in NR RRC\_IDLE state }

**ensure that** {

**when** { UL data arrives in the UE transmission buffer for a logical
channel in a LCG configured with additionalBS-TableAllowed, and the
amount of UL data available for transmission is within the buffer sizes
specified in Table 6.1.3.1-3}

**then** { UE reports a Long Refined BSR\"}

}

##### (2) {#section-60 .H6}

**with** { UE in NR RRC\_IDLE state}

**ensure that** {

**when** { UL data arrives in the UE transmission buffer for a logical
channel in a LCG configured with additionalBS-TableAllowed, and the
amount of UL data available for transmission when the MAC PDU containing
the BSR is to be built is greater than the largest buffer size specified
in Table 6.1.3.1-3}

**then** { UE reports a Long BSR\"}

}

##### (3) {#section-61 .H6}

**with** { UE in NR RRC\_IDLE state}

**ensure that** {

**when** { UL data arrives in the UE transmission buffer for a logical
channel in a LCG configured with additionalBS-TableAllowed, and the
amount of UL data available for transmission when the MAC PDU containing
the BSR is to be built is smaller than the smallest buffer size
specified in Table 6.1.3.1-3}

**then** { UE reports a short BSR\"}

}

##### 7.1.1.3.18.2 Conformance requirements {#conformance-requirements-21 .H6}

References: The conformance requirements covered in the present TC are
specified in: 3GPP TS 38.321, clause 5.2.4.6 and TS 38.331, clause 6.3.1
5. Unless otherwise stated these are Rel-18 requirements.

\[TS 38.321, clause 5.4.5\]

...

For Regular and Periodic BSR, the MAC entity for which
*logicalChannelGroupIAB-Ext* is not configured by upper layers shall:

1\> if for at least one LCG configured with *additionalBS-TableAllowed,*
the amount of UL data available for transmission when the MAC PDU
containing the BSR is to be built is within the buffer sizes specified
in Table 6.1.3.1-3:

2\> report Refined Long BSR for all LCGs which have data available for
transmission;

1\> else:

2\> if more than one LCG has data available for transmission when the
MAC PDU containing the BSR is to be built:

3\> report Long BSR for all LCGs which have data available for
transmission.

2\> else if one LCG has data available and is configured with
*additionalBS-TableAllowed* and the amount of UL data available for
transmission when the MAC PDU containing the BSR is to be built is
greater than the largest buffer size specified in Table 6.1.3.1-3:

3\> report Long BSR.

2\> else:

3\> report Short BSR.

\[TS 38.321, clause 6.1.3.1\]

Buffer Status Report (BSR) MAC CEs consist of either:

\- Short BSR format (fixed size); or

\- Extended Short BSR format (fixed size); or

\- Long BSR format (variable size); or

\- Refined Long BSR format (variable size); or

\- Extended Long BSR format (variable size); or

\- Short Truncated BSR format (fixed size); or

\- Extended Short Truncated BSR format (fixed size); or

\- Long Truncated BSR format (variable size); or

\- Extended Long Truncated BSR format (variable size).

Pre-emptive BSR MAC CE consists of:

\- Pre-emptive BSR format (variable size); or

\- Extended Pre-emptive BSR format (variable size).

The BSR formats are identified by MAC subheaders with LCIDs as specified
in Table 6.2.1-2.

The Refined Long BSR format, Extended BSR formats and Pre-emptive BSR
format are identified by MAC subheaders with eLCIDs as specified in
Table 6.2.1-2b.

The fields in the BSR MAC CE are defined as follows:

\- LCG ID: The Logical Channel Group ID field identifies the group of
logical channel(s) whose buffer status is being reported. The length of
the field is 3 bits for the case of Short BSR and Short Truncated BSR
formats, and 8 bits for the case of Extended Short BSR and Extended
Short Truncated BSR formats;

\- LCG~i~: For the Long BSR format, Refined Long BSR format, Extended
Long BSR format, Pre-emptive BSR format, and Extended Pre-emptive BSR
format, this field indicates the presence of the Buffer Size field for
the logical channel group i. The LCG~i~ field set to 1 indicates that
the Buffer Size field for the logical channel group i is reported. The
LCG~i~ field set to 0 indicates that the Buffer Size field for the
logical channel group i is not reported. For the Long Truncated BSR
format and the Extended Long Truncated BSR format, this field indicates
whether logical channel group i has data available. The LCG~i~ field set
to 1 indicates that logical channel group i has data available. The
LCG~i~ field set to 0 indicates that logical channel group i does not
have data available;

\- BT~i~: This field is included only in the Refined Long BSR format.
This field is present only if the corresponding LCG~i~ is set to 1;
otherwise, this field is reserved and set to 0. If present, this field
indicates which buffer size table is used to set the Buffer Size field
for the logical channel group i. The BT~i~ field set to 1 indicates that
the buffer size table specified in Table 6.1.3.1-3 is used for the
logical channel group i. The BT~i~ field set to 0 indicates that the
buffer size table specified in Table 6.1.3.1-2 is used for the logical
channel group i;

\- Buffer Size: The Buffer Size field identifies the total amount of
data available according to the data volume calculation procedure in TSs
38.322 \[3\] and 38.323 \[4\] across all logical channels of a logical
channel group after the MAC PDU has been built (i.e. after the logical
channel prioritization procedure, which may result the value of the
Buffer Size field to zero). The amount of data is indicated in number of
bytes. The size of the RLC headers and MAC subheaders are not considered
in the buffer size computation. The length of this field for the Short
BSR format and the Short Truncated BSR format is 5 bits. The length of
this field for the Extended Short BSR format and the Extended Short
Truncated BSR format is 8 bits. The length of this field for the Long
BSR format, the Refined Long BSR format, the Long Truncated BSR format,
the Extended Long BSR format, and the Extended Long Truncated format is
8 bits. The values for the 5-bit Buffer Size fields are shown in Table
6.1.3.1-1. The values for the 8-bit Buffer Size fields in the Long BSR
format, the Long Truncated BSR format, the Extended Long BSR format, and
the Extended Long Truncated format are shown in Table 6.1.3.1-2. For the
Refined Long BSR format, if an LCG is configured with
*additionalBS-TableAllowed* and the amount of data for the LCG is within
the buffer sizes specified in Table 6.1.3.1-3, the MAC entity shall use
the buffer sizes specified in Table 6.1.3.1-3 to set the value of this
field; otherwise, the MAC entity shall use Table 6.1.3.1-2 instead. For
the Long BSR format, the Refined Long BSR format, the Long Truncated BSR
format, the Extended Long BSR format, and the Extended Long Truncated
format, the Buffer Size fields are included in ascending order based on
the LCG~i~. For the Long Truncated BSR format and the Extended Long
Truncated format the number of Buffer Size fields included is maximised,
while not exceeding the number of padding bits. For the Pre-emptive BSR
format and the Extended Pre-emptive BSR format, the Buffer Size field
identifies the total amount of the data expected to arrive at the IAB-MT
of the node where the Pre-emptive BSR/Extended Pre-emptive BSR is
triggered and does not include the volume of data currently available in
the IAB-MT. Pre-emptive BSR format is identical to the Long BSR format.
Extended Pre-emptive BSR format is identical to the Extended Long BSR
format.

NOTE 1: For the Pre-emptive BSR, if configured, the LCGs to be reported,
the expected data volume calculation, the exact time to report
Pre-emptive BSR and the associated LCH are left to implementation.

NOTE 2: The mapping of LCGs between the ingress and egress links of an
IAB node for purposes of determining expected change in occupancy of
IAB-MT buffers (to be reported as Pre-emptive BSR) is left to
implementation.

NOTE 3: The number of the Buffer Size fields in the Long BSR, Extended
Long BSR, Long Truncated BSR, and Extended Long Truncated BSR format can
be zero.

NOTE 4: The Extended versions of the BSR formats can only be used by IAB
nodes.

\...

...

Figure 6.1.3.1-5: Refined Long BSR MAC CE

...

Table 6.1.3.1-3. Refined buffer size levels (in bytes) for 8-bit Buffer
Size field

  **Index**   **BS value**         **Index**   **BS value**   **Index**   **BS Value**   **Index**   **BS Value**
  ----------- -------------------- ----------- -------------- ----------- -------------- ----------- --------------
  0           \> 4751 and â¤ 5000   64          â¤ 17584        128         â¤ 61841        192         â¤ 217489
  1           â¤ 5099               65          â¤ 17933        129         â¤ 63069        193         â¤ 221805
  2           â¤ 5200               66          â¤ 18289        130         â¤ 64320        194         â¤ 226207
  3           â¤ 5303               67          â¤ 18652        131         â¤ 65596        195         â¤ 230695
  4           â¤ 5408               68          â¤ 19022        132         â¤ 66898        196         â¤ 235273
  5           â¤ 5516               69          â¤ 19399        133         â¤ 68226        197         â¤ 239942
  6           â¤ 5625               70          â¤ 19784        134         â¤ 69580        198         â¤ 244703
  7           â¤ 5737               71          â¤ 20177        135         â¤ 70960        199         â¤ 249559
  8           â¤ 5851               72          â¤ 20577        136         â¤ 72368        200         â¤ 254511
  9           â¤ 5967               73          â¤ 20985        137         â¤ 73804        201         â¤ 259562
  10          â¤ 6085               74          â¤ 21402        138         â¤ 75269        202         â¤ 264713
  11          â¤ 6206               75          â¤ 21827        139         â¤ 76763        203         â¤ 269966
  12          â¤ 6329               76          â¤ 22260        140         â¤ 78286        204         â¤ 275323
  13          â¤ 6455               77          â¤ 22702        141         â¤ 79839        205         â¤ 280786
  14          â¤ 6583               78          â¤ 23152        142         â¤ 81424        206         â¤ 286358
  15          â¤ 6713               79          â¤ 23611        143         â¤ 83040        207         â¤ 292041
  16          â¤ 6847               80          â¤ 24080        144         â¤ 84687        208         â¤ 297836
  17          â¤ 6983               81          â¤ 24558        145         â¤ 86368        209         â¤ 303746
  18          â¤ 7121               82          â¤ 25045        146         â¤ 88082        210         â¤ 309774
  19          â¤ 7262               83          â¤ 25542        147         â¤ 89830        211         â¤ 315921
  20          â¤ 7407               84          â¤ 26049        148         â¤ 91612        212         â¤ 322190
  21          â¤ 7554               85          â¤ 26566        149         â¤ 93430        213         â¤ 328583
  22          â¤ 7703               86          â¤ 27093        150         â¤ 95284        214         â¤ 335104
  23          â¤ 7856               87          â¤ 27631        151         â¤ 97175        215         â¤ 341754
  24          â¤ 8012               88          â¤ 28179        152         â¤ 99103        216         â¤ 348535
  25          â¤ 8171               89          â¤ 28738        153         â¤ 101070       217         â¤ 355452
  26          â¤ 8333               90          â¤ 29309        154         â¤ 103076       218         â¤ 362505
  27          â¤ 8499               91          â¤ 29890        155         â¤ 105121       219         â¤ 369699
  28          â¤ 8667               92          â¤ 30483        156         â¤ 107207       220         â¤ 377035
  29          â¤ 8839               93          â¤ 31088        157         â¤ 109335       221         â¤ 384517
  30          â¤ 9015               94          â¤ 31705        158         â¤ 111504       222         â¤ 392147
  31          â¤ 9194               95          â¤ 32334        159         â¤ 113717       223         â¤ 399929
  32          â¤ 9376               96          â¤ 32976        160         â¤ 115973       224         â¤ 407865
  33          â¤ 9562               97          â¤ 33630        161         â¤ 118275       225         â¤ 415959
  34          â¤ 9752               98          â¤ 34298        162         â¤ 120622       226         â¤ 424213
  35          â¤ 9946               99          â¤ 34978        163         â¤ 123016       227         â¤ 432631
  36          â¤ 10143              100         â¤ 35672        164         â¤ 125457       228         â¤ 441216
  37          â¤ 10344              101         â¤ 36380        165         â¤ 127946       229         â¤ 449971
  38          â¤ 10549              102         â¤ 37102        166         â¤ 130485       230         â¤ 458900
  39          â¤ 10759              103         â¤ 37839        167         â¤ 133074       231         â¤ 468007
  40          â¤ 10972              104         â¤ 38589        168         â¤ 135715       232         â¤ 477294
  41          â¤ 11190              105         â¤ 39355        169         â¤ 138408       233         â¤ 486765
  42          â¤ 11412              106         â¤ 40136        170         â¤ 141155       234         â¤ 496425
  43          â¤ 11639              107         â¤ 40933        171         â¤ 143956       235         â¤ 506276
  44          â¤ 11870              108         â¤ 41745        172         â¤ 146813       236         â¤ 516322
  45          â¤ 12105              109         â¤ 42573        173         â¤ 149726       237         â¤ 526568
  46          â¤ 12345              110         â¤ 43418        174         â¤ 152697       238         â¤ 537017
  47          â¤ 12590              111         â¤ 44280        175         â¤ 155727       239         â¤ 547674
  48          â¤ 12840              112         â¤ 45158        176         â¤ 158817       240         â¤ 558542
  49          â¤ 13095              113         â¤ 46055        177         â¤ 161969       241         â¤ 569625
  50          â¤ 13355              114         â¤ 46968        178         â¤ 165183       242         â¤ 580929
  51          â¤ 13620              115         â¤ 47900        179         â¤ 168461       243         â¤ 592457
  52          â¤ 13890              116         â¤ 48851        180         â¤ 171804       244         â¤ 604213
  53          â¤ 14166              117         â¤ 49820        181         â¤ 175213       245         â¤ 616203
  54          â¤ 14447              118         â¤ 50809        182         â¤ 178690       246         â¤ 628431
  55          â¤ 14734              119         â¤ 51817        183         â¤ 182236       247         â¤ 640902
  56          â¤ 15026              120         â¤ 52846        184         â¤ 185852       248         â¤ 653620
  57          â¤ 15324              121         â¤ 53894        185         â¤ 189540       249         â¤ 666590
  58          â¤ 15628              122         â¤ 54964        186         â¤ 193302       250         â¤ 679818
  59          â¤ 15938              123         â¤ 56054        187         â¤ 197137       251         â¤ 693308
  60          â¤ 16255              124         â¤ 57167        188         â¤ 201049       252         â¤ 707066
  61          â¤ 16577              125         â¤ 58301        189         â¤ 205039       253         â¤ 721097
  62          â¤ 16906              126         â¤ 59458        190         â¤ 209108       254         â¤ 735406
  63          â¤ 17242              127         â¤ 60638        191         â¤ 213257       255         â¤ 750000

\[TS 38.331, clause 6.3.1\]

+----------------------------------------------------------------------+
| ***accessAllowed2RxXR***                                             |
|                                                                      |
| *Indicates if the cells on the frequency support 2Rx XR UEs. If      |
| present, 2Rx XR UEs shall consider only these NR frequencies in cell |
| reselection evaluation.*                                             |
+----------------------------------------------------------------------+

##### 7.1.1.3.18.3 Test description {#test-description-21 .H6}

##### 7.1.1.3.18.3.1 Pre-test conditions {#pre-test-conditions-21 .H6}

Same Pre-test conditions as in clause 7.1.1.0 with the exception of 2 AM
DRBs on NR cell configured according to Table 7.1.1.3.18.3.1-1.

Table 7.1.1.3.18.3.1-1: Logical Channel Configuration Settings

  Parameter                   Value DRB1              Value DRB2
  --------------------------- ----------------------- -----------------------
  LogicalChannelIdentity      LCH4(DRB-Identity +3)   LCH5(DRB-Identity +3)
  Priority                    7                       6
  prioritizedBitRate          0 kB/s                  0 kB/s
  logicalChannelGroup         2 (LCG ID\#2)           1 (LCG ID\#1)
  additionalBS-TableAllowed   1                       0

##### 7.1.1.3.18.3.2 Test procedure sequence {#test-procedure-sequence-21 .H6}

Table 7.1.1.3.18.3.2-1: Main behaviour

  St                                                                                                                                                                                                                                                                      Procedure                                                                                                                                                                                     Message Sequence   TP                                                                         Verdict   
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------------ -------------------------------------------------------------------------- --------- ----
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        U - S              Message                                                                              
  1                                                                                                                                                                                                                                                                       The SS ignores scheduling requests and does not allocate any uplink grant.                                                                                                                    \-                 \-                                                                         \-        \-
  2                                                                                                                                                                                                                                                                       The SS transmits a MAC PDU containing one RLC SDUs of size 2000 bytes on LCH4 (\<4751 bytes)                                                                                                  \<\--              MAC PDU (1 RLC SDUs on LCH4)                                               \-        \-
  3                                                                                                                                                                                                                                                                       SS allocates an UL Grant of 56 bits. (Note 1)                                                                                                                                                 \<\--              (UL Grant, 56 bits)                                                        \-        \-
  4                                                                                                                                                                                                                                                                       Check: Does the UE transmit a Short BSR with 'LCG ID' field set to '2'? (Note 2)                                                                                                              \--\>              MAC PDU (MAC Short BSR (LCG ID='2',))                                      3         P
  5                                                                                                                                                                                                                                                                       The SS transmits a MAC PDU containing one RLC SDUs of size 50000 bytes on LCH4 (\<750000 bytes)                                                                                               \<\--              MAC PDU (1 RLC SDUs on LCH4)                                               \-        \-
  6                                                                                                                                                                                                                                                                       The SS transmits a MAC PDU containing one RLC SDUs of size 200 bytes on LCH5 (\<4751 bytes)                                                                                                                      MAC PDU (1 RLC SDUs on LCH5)                                               \-        \-
  7                                                                                                                                                                                                                                                                       SS allocates an UL Grant of 56 bits. (Note 1)                                                                                                                                                 \<\--              (UL Grant, 56 bits)                                                        \-        \-
  8                                                                                                                                                                                                                                                                       Check: Does the UE transmit a Long Refined BSR with 'LCG ID' field set to '2' and corresponding 'BT' field set to '1' & 'LCG ID' field set to '1' and corresponding 'BT' field set to '0' ?   \--\>              MAC PDU (MAC Long Refined BSR (LCG ID='2', BT ='1'& LCG ID='1', BT='0'))   1         P
  9                                                                                                                                                                                                                                                                       The SS transmits a MAC PDU containing one RLC SDUs of size 30000 bytes on LCH4 (\>750000 bytes)                                                                                               \<\--              MAC PDU (1 RLC SDUs on LCH4)                                               \-        \-
  10                                                                                                                                                                                                                                                                      SS allocates an UL Grant of 56 bits. (Note 1)                                                                                                                                                 \<\--              (UL Grant, 56 bits)                                                        \-        \-
  11                                                                                                                                                                                                                                                                      Check: Does the UE transmit a Long BSR with 'LCG ID' field set to '2' & 'LCG ID' field set to '1' ?                                                                                           \--\>              MAC PDU (MAC Long BSR (LCG ID='2'& LCG ID='1'))                            2         P
  12                                                                                                                                                                                                                                                                      SS allocates an UL Grant of 90000 bytes or more.                                                                                                                                              \<\--              (UL Grant)                                                                 \-        \-
  13                                                                                                                                                                                                                                                                      The UE transmits a MAC PDU including 4 RLC SDUs looped back corresponding to steps 2, 5, 6 and 9.                                                                                             \--\>              MAC PDU (3 MAC sub PDUs from LCH4, 1 MAC sub PDU from LCH5)                \-        \-
  14                                                                                                                                                                                                                                                                      SS transmits an RLC STATUS PDU to acknowledge correctly received data(LCID='000100')                                                                                                          \<\--              RLC STATUS PDU (ACK\_SN=3)                                                 \-        \-
  15                                                                                                                                                                                                                                                                      SS transmits an RLC STATUS PDU to acknowledge correctly received data(LCID='000101')                                                                                                          \<\--              RLC STATUS PDU (ACK\_SN=1)                                                 \-        \-
  Note 1: 56 bits enables UE to transmit a MAC PDU with a 1 byte MAC BSR header and a Short BSR (1 byte) or a 2 bytes MAC BSR header and a Long BSR 3 bytes (with 2 LCG configured) or a 3 bytes MAC BSR header and a Long Refined BSR 4 bytes (with 2 LCG configured).                                                                                                                                                                                                                                                                                                         

##### 7.1.1.3.18.3.3 Specific message contents {#specific-message-contents-21 .H6}

None

##### 7.1.1.3.19 Correct Handling of MAC control information / Buffer Status / UL resources are allocated / Refined BSR / Padding BSR

##### 7.1.1.3.19.1 Test Purpose (TP) {#test-purpose-tp-23 .H6}

##### (1) {#section-62 .H6}

**with** { UE in NR RRC\_IDLE state }

**ensure that** {

**when** { UE transmits a MAC PDU and the number of padding bits is
equal to or larger than the size of the Refined Long BSR plus its
subheader and, for at least one LCG configured with
additionalBS-TableAllowed, the amount of UL data available for
transmission is within the buffer sizes specified in Table 6.1.3.1-3 }

**then** { UE reports a Long Refined BSR\"}

}

##### (2) {#section-63 .H6}

**with** { UE in NR RRC\_IDLE state}

**ensure that** {

**when** { UE transmits a MAC PDU and the number of padding bits is
equal to or larger than the size of the Refined Long BSR plus its
subheader and, for all the LCGs configured with
additionalBS-TableAllowed, the amount of UL data available for
transmission when the MAC PDU containing the BSR is to be built is less
than the smallest buffer size specified in Table 6.1.3.1-3}

**then** { UE reports a Long BSR\"}

}

##### 7.1.1.3.19.2 Conformance requirements {#conformance-requirements-22 .H6}

References: The conformance requirements covered in the present TC are
specified in: 3GPP TS 38.321, clause 5.2.4.6 and TS 38.331, clause 6.3.1
5. Unless otherwise stated these are Rel-18 requirements.

\[TS 38.321, clause 5.4.5\]

...

For Padding BSR, the MAC entity for which *logicalChannelGroupIAB-Ext*
is not configured by upper layers shall:

1\> if the number of padding bits is equal to or larger than the size of
the Short BSR plus its subheader but smaller than the size of the Long
BSR plus its subheader:

2\> if more than one LCG has data available for transmission when the
BSR is to be built:

3\> if the number of padding bits is equal to the size of the Short BSR
plus its subheader:

4\> report Short Truncated BSR of the LCG with the highest priority
logical channel with data available for transmission.

3\> else:

4\> report Long Truncated BSR of the LCG(s) with the logical channels
having data available for transmission following a decreasing order of
the highest priority logical channel (with or without data available for
transmission) in each of these LCG(s), and in case of equal priority, in
increasing order of LCGID.

2\> else:

3\> report Short BSR.

1\> else if for at least one LCG configured with
*additionalBS-TableAllowed*, the amount of UL data available for
transmission when the MAC PDU containing the BSR is to be built is
within the buffer sizes specified in Table 6.1.3.1-3 and the number of
padding bits is equal to or larger than the size of the Refined Long BSR
plus its subheader:

2\> report Refined Long BSR for all LCGs which have data available for
transmission.

1\> else if the number of padding bits is equal to or larger than the
size of the Long BSR plus its subheader:

2\> report Long BSR for all LCGs which have data available for
transmission.

\[TS 38.321, clause 6.1.3.1\]

Buffer Status Report (BSR) MAC CEs consist of either:

\- Short BSR format (fixed size); or

\- Extended Short BSR format (fixed size); or

\- Long BSR format (variable size); or

\- Refined Long BSR format (variable size); or

\- Extended Long BSR format (variable size); or

\- Short Truncated BSR format (fixed size); or

\- Extended Short Truncated BSR format (fixed size); or

\- Long Truncated BSR format (variable size); or

\- Extended Long Truncated BSR format (variable size).

Pre-emptive BSR MAC CE consists of:

\- Pre-emptive BSR format (variable size); or

\- Extended Pre-emptive BSR format (variable size).

The BSR formats are identified by MAC subheaders with LCIDs as specified
in Table 6.2.1-2.

The Refined Long BSR format, Extended BSR formats and Pre-emptive BSR
format are identified by MAC subheaders with eLCIDs as specified in
Table 6.2.1-2b.

The fields in the BSR MAC CE are defined as follows:

\- LCG ID: The Logical Channel Group ID field identifies the group of
logical channel(s) whose buffer status is being reported. The length of
the field is 3 bits for the case of Short BSR and Short Truncated BSR
formats, and 8 bits for the case of Extended Short BSR and Extended
Short Truncated BSR formats;

\- LCG~i~: For the Long BSR format, Refined Long BSR format, Extended
Long BSR format, Pre-emptive BSR format, and Extended Pre-emptive BSR
format, this field indicates the presence of the Buffer Size field for
the logical channel group i. The LCG~i~ field set to 1 indicates that
the Buffer Size field for the logical channel group i is reported. The
LCG~i~ field set to 0 indicates that the Buffer Size field for the
logical channel group i is not reported. For the Long Truncated BSR
format and the Extended Long Truncated BSR format, this field indicates
whether logical channel group i has data available. The LCG~i~ field set
to 1 indicates that logical channel group i has data available. The
LCG~i~ field set to 0 indicates that logical channel group i does not
have data available;

\- BT~i~: This field is included only in the Refined Long BSR format.
This field is present only if the corresponding LCG~i~ is set to 1;
otherwise, this field is reserved and set to 0. If present, this field
indicates which buffer size table is used to set the Buffer Size field
for the logical channel group i. The BT~i~ field set to 1 indicates that
the buffer size table specified in Table 6.1.3.1-3 is used for the
logical channel group i. The BT~i~ field set to 0 indicates that the
buffer size table specified in Table 6.1.3.1-2 is used for the logical
channel group i;

\- Buffer Size: The Buffer Size field identifies the total amount of
data available according to the data volume calculation procedure in TSs
38.322 \[3\] and 38.323 \[4\] across all logical channels of a logical
channel group after the MAC PDU has been built (i.e. after the logical
channel prioritization procedure, which may result the value of the
Buffer Size field to zero). The amount of data is indicated in number of
bytes. The size of the RLC headers and MAC subheaders are not considered
in the buffer size computation. The length of this field for the Short
BSR format and the Short Truncated BSR format is 5 bits. The length of
this field for the Extended Short BSR format and the Extended Short
Truncated BSR format is 8 bits. The length of this field for the Long
BSR format, the Refined Long BSR format, the Long Truncated BSR format,
the Extended Long BSR format, and the Extended Long Truncated format is
8 bits. The values for the 5-bit Buffer Size fields are shown in Table
6.1.3.1-1. The values for the 8-bit Buffer Size fields in the Long BSR
format, the Long Truncated BSR format, the Extended Long BSR format, and
the Extended Long Truncated format are shown in Table 6.1.3.1-2. For the
Refined Long BSR format, if an LCG is configured with
*additionalBS-TableAllowed* and the amount of data for the LCG is within
the buffer sizes specified in Table 6.1.3.1-3, the MAC entity shall use
the buffer sizes specified in Table 6.1.3.1-3 to set the value of this
field; otherwise, the MAC entity shall use Table 6.1.3.1-2 instead. For
the Long BSR format, the Refined Long BSR format, the Long Truncated BSR
format, the Extended Long BSR format, and the Extended Long Truncated
format, the Buffer Size fields are included in ascending order based on
the LCG~i~. For the Long Truncated BSR format and the Extended Long
Truncated format the number of Buffer Size fields included is maximised,
while not exceeding the number of padding bits. For the Pre-emptive BSR
format and the Extended Pre-emptive BSR format, the Buffer Size field
identifies the total amount of the data expected to arrive at the IAB-MT
of the node where the Pre-emptive BSR/Extended Pre-emptive BSR is
triggered and does not include the volume of data currently available in
the IAB-MT. Pre-emptive BSR format is identical to the Long BSR format.
Extended Pre-emptive BSR format is identical to the Extended Long BSR
format.

NOTE 1: For the Pre-emptive BSR, if configured, the LCGs to be reported,
the expected data volume calculation, the exact time to report
Pre-emptive BSR and the associated LCH are left to implementation.

NOTE 2: The mapping of LCGs between the ingress and egress links of an
IAB node for purposes of determining expected change in occupancy of
IAB-MT buffers (to be reported as Pre-emptive BSR) is left to
implementation.

NOTE 3: The number of the Buffer Size fields in the Long BSR, Extended
Long BSR, Long Truncated BSR, and Extended Long Truncated BSR format can
be zero.

NOTE 4: The Extended versions of the BSR formats can only be used by IAB
nodes.

\...

Figure 6.1.3.1-5: Refined Long BSR MAC CE

...

Table 6.1.3.1-3. Refined buffer size levels (in bytes) for 8-bit Buffer
Size field

  **Index**   **BS value**         **Index**   **BS value**   **Index**   **BS Value**   **Index**   **BS Value**
  ----------- -------------------- ----------- -------------- ----------- -------------- ----------- --------------
  0           \> 4751 and â¤ 5000   64          â¤ 17584        128         â¤ 61841        192         â¤ 217489
  1           â¤ 5099               65          â¤ 17933        129         â¤ 63069        193         â¤ 221805
  2           â¤ 5200               66          â¤ 18289        130         â¤ 64320        194         â¤ 226207
  3           â¤ 5303               67          â¤ 18652        131         â¤ 65596        195         â¤ 230695
  4           â¤ 5408               68          â¤ 19022        132         â¤ 66898        196         â¤ 235273
  5           â¤ 5516               69          â¤ 19399        133         â¤ 68226        197         â¤ 239942
  6           â¤ 5625               70          â¤ 19784        134         â¤ 69580        198         â¤ 244703
  7           â¤ 5737               71          â¤ 20177        135         â¤ 70960        199         â¤ 249559
  8           â¤ 5851               72          â¤ 20577        136         â¤ 72368        200         â¤ 254511
  9           â¤ 5967               73          â¤ 20985        137         â¤ 73804        201         â¤ 259562
  10          â¤ 6085               74          â¤ 21402        138         â¤ 75269        202         â¤ 264713
  11          â¤ 6206               75          â¤ 21827        139         â¤ 76763        203         â¤ 269966
  12          â¤ 6329               76          â¤ 22260        140         â¤ 78286        204         â¤ 275323
  13          â¤ 6455               77          â¤ 22702        141         â¤ 79839        205         â¤ 280786
  14          â¤ 6583               78          â¤ 23152        142         â¤ 81424        206         â¤ 286358
  15          â¤ 6713               79          â¤ 23611        143         â¤ 83040        207         â¤ 292041
  16          â¤ 6847               80          â¤ 24080        144         â¤ 84687        208         â¤ 297836
  17          â¤ 6983               81          â¤ 24558        145         â¤ 86368        209         â¤ 303746
  18          â¤ 7121               82          â¤ 25045        146         â¤ 88082        210         â¤ 309774
  19          â¤ 7262               83          â¤ 25542        147         â¤ 89830        211         â¤ 315921
  20          â¤ 7407               84          â¤ 26049        148         â¤ 91612        212         â¤ 322190
  21          â¤ 7554               85          â¤ 26566        149         â¤ 93430        213         â¤ 328583
  22          â¤ 7703               86          â¤ 27093        150         â¤ 95284        214         â¤ 335104
  23          â¤ 7856               87          â¤ 27631        151         â¤ 97175        215         â¤ 341754
  24          â¤ 8012               88          â¤ 28179        152         â¤ 99103        216         â¤ 348535
  25          â¤ 8171               89          â¤ 28738        153         â¤ 101070       217         â¤ 355452
  26          â¤ 8333               90          â¤ 29309        154         â¤ 103076       218         â¤ 362505
  27          â¤ 8499               91          â¤ 29890        155         â¤ 105121       219         â¤ 369699
  28          â¤ 8667               92          â¤ 30483        156         â¤ 107207       220         â¤ 377035
  29          â¤ 8839               93          â¤ 31088        157         â¤ 109335       221         â¤ 384517
  30          â¤ 9015               94          â¤ 31705        158         â¤ 111504       222         â¤ 392147
  31          â¤ 9194               95          â¤ 32334        159         â¤ 113717       223         â¤ 399929
  32          â¤ 9376               96          â¤ 32976        160         â¤ 115973       224         â¤ 407865
  33          â¤ 9562               97          â¤ 33630        161         â¤ 118275       225         â¤ 415959
  34          â¤ 9752               98          â¤ 34298        162         â¤ 120622       226         â¤ 424213
  35          â¤ 9946               99          â¤ 34978        163         â¤ 123016       227         â¤ 432631
  36          â¤ 10143              100         â¤ 35672        164         â¤ 125457       228         â¤ 441216
  37          â¤ 10344              101         â¤ 36380        165         â¤ 127946       229         â¤ 449971
  38          â¤ 10549              102         â¤ 37102        166         â¤ 130485       230         â¤ 458900
  39          â¤ 10759              103         â¤ 37839        167         â¤ 133074       231         â¤ 468007
  40          â¤ 10972              104         â¤ 38589        168         â¤ 135715       232         â¤ 477294
  41          â¤ 11190              105         â¤ 39355        169         â¤ 138408       233         â¤ 486765
  42          â¤ 11412              106         â¤ 40136        170         â¤ 141155       234         â¤ 496425
  43          â¤ 11639              107         â¤ 40933        171         â¤ 143956       235         â¤ 506276
  44          â¤ 11870              108         â¤ 41745        172         â¤ 146813       236         â¤ 516322
  45          â¤ 12105              109         â¤ 42573        173         â¤ 149726       237         â¤ 526568
  46          â¤ 12345              110         â¤ 43418        174         â¤ 152697       238         â¤ 537017
  47          â¤ 12590              111         â¤ 44280        175         â¤ 155727       239         â¤ 547674
  48          â¤ 12840              112         â¤ 45158        176         â¤ 158817       240         â¤ 558542
  49          â¤ 13095              113         â¤ 46055        177         â¤ 161969       241         â¤ 569625
  50          â¤ 13355              114         â¤ 46968        178         â¤ 165183       242         â¤ 580929
  51          â¤ 13620              115         â¤ 47900        179         â¤ 168461       243         â¤ 592457
  52          â¤ 13890              116         â¤ 48851        180         â¤ 171804       244         â¤ 604213
  53          â¤ 14166              117         â¤ 49820        181         â¤ 175213       245         â¤ 616203
  54          â¤ 14447              118         â¤ 50809        182         â¤ 178690       246         â¤ 628431
  55          â¤ 14734              119         â¤ 51817        183         â¤ 182236       247         â¤ 640902
  56          â¤ 15026              120         â¤ 52846        184         â¤ 185852       248         â¤ 653620
  57          â¤ 15324              121         â¤ 53894        185         â¤ 189540       249         â¤ 666590
  58          â¤ 15628              122         â¤ 54964        186         â¤ 193302       250         â¤ 679818
  59          â¤ 15938              123         â¤ 56054        187         â¤ 197137       251         â¤ 693308
  60          â¤ 16255              124         â¤ 57167        188         â¤ 201049       252         â¤ 707066
  61          â¤ 16577              125         â¤ 58301        189         â¤ 205039       253         â¤ 721097
  62          â¤ 16906              126         â¤ 59458        190         â¤ 209108       254         â¤ 735406
  63          â¤ 17242              127         â¤ 60638        191         â¤ 213257       255         â¤ 750000

\[TS 38.331, clause 6.3.1\]

+----------------------------------------------------------------------+
| ***accessAllowed2RxXR***                                             |
|                                                                      |
| *Indicates if the cells on the frequency support 2Rx XR UEs. If      |
| present, 2Rx XR UEs shall consider only these NR frequencies in cell |
| reselection evaluation.*                                             |
+----------------------------------------------------------------------+

##### 7.1.1.3.19.3 Test description {#test-description-22 .H6}

##### 7.1.1.3.19.3.1 Pre-test conditions {#pre-test-conditions-22 .H6}

Same Pre-test conditions as in clause 7.1.1.0 with the exception of 2 AM
DRBs on NR cell configured according to Table 7.1.1.3.19.3.1-1.

Table 7.1.1.3.19.3.1-1: Logical Channel Configuration Settings

  Parameter                   Value DRB1              Value DRB2
  --------------------------- ----------------------- -----------------------
  LogicalChannelIdentity      LCH4(DRB-Identity +3)   LCH5(DRB-Identity +3)
  Priority                    7                       6
  prioritizedBitRate          0 kB/s                  0 kB/s
  logicalChannelGroup         2 (LCG ID\#2)           1 (LCG ID\#1)
  additionalBS-TableAllowed   1                       0

##### 7.1.1.3.19.3.2 Test procedure sequence {#test-procedure-sequence-22 .H6}

Table 7.1.1.3.19.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \-        | \-        | \-      | \- |
|           | ignores   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | requests  |           |           |         |    |
|           | and does  |           |           |         |    |
|           | not       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | any       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (1 RLC    |         |    |
|           | a MAC PDU |           | SDUs on   |         |    |
|           | c         |           | LCH4)     |         |    |
|           | ontaining |           |           |         |    |
|           | one RLC   |           |           |         |    |
|           | SDUs of   |           |           |         |    |
|           | size 2000 |           |           |         |    |
|           | bytes on  |           |           |         |    |
|           | LCH4      |           |           |         |    |
|           | (\<4751   |           |           |         |    |
|           | bytes)    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC SDU  |         |    |
|           | a MAC PDU |           | on LCH5)  |         |    |
|           | including |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | PDU of    |           |           |         |    |
|           | size 13   |           |           |         |    |
|           | bytes on  |           |           |         |    |
|           | LCH5.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | SS        | \<\--     | (UL       | \-      | \- |
|           | allocates |           | Grant, 56 |         |    |
|           | an UL     |           | bits)     |         |    |
|           | Grant of  |           |           |         |    |
|           | 56 bits.  |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           | (MAC Long |         |    |
|           | a Long    |           | BSR (LCG  |         |    |
|           | BSR with  |           | ID='2' &  |         |    |
|           | 'LCG ID'  |           | LCG       |         |    |
|           | field set |           | ID='1'))  |         |    |
|           | to '2' &  |           |           |         |    |
|           | 'LCG ID'  |           |           |         |    |
|           | field set |           |           |         |    |
|           | to '1'.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The SS    | \<\--     | (UL       | \-      | \- |
|           | sends an  |           | grant)    |         |    |
|           | uplink    |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | size 176  |           |           |         |    |
|           | bits.     |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | Does UE   |           | (MAC sub  |         |    |
|           | transmit  |           | PDU       |         |    |
|           | a MAC PDU |           | header    |         |    |
|           | c         |           | for RLC   |         |    |
|           | ontaining |           | PDU, RLC  |         |    |
|           | an RLC    |           | PDU, Long |         |    |
|           | SDU of    |           | BSR       |         |    |
|           | LCH5 and  |           | header,   |         |    |
|           | a Long    |           | Long BSR) |         |    |
|           | BSR       |           |           |         |    |
|           | i         |           |           |         |    |
|           | ndicating |           |           |         |    |
|           | pending   |           |           |         |    |
|           | data      |           |           |         |    |
|           | ('Buffer  |           |           |         |    |
|           | size'     |           |           |         |    |
|           | field \>  |           |           |         |    |
|           | '0') for  |           |           |         |    |
|           | l         |           |           |         |    |
|           | ogicalCha |           |           |         |    |
|           | nnelGroup |           |           |         |    |
|           | 1 ('LCG   |           |           |         |    |
|           | ID' field |           |           |         |    |
|           | set to    |           |           |         |    |
|           | '02')?    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | SS        | \<\--     | RLC       | \-      | \- |
|           | transmits |           | STATUS    |         |    |
|           | an RLC    |           | PDU       |         |    |
|           | STATUS    |           | (A        |         |    |
|           | PDU to    |           | CK\_SN=1) |         |    |
|           | ac        |           |           |         |    |
|           | knowledge |           |           |         |    |
|           | correctly |           |           |         |    |
|           | received  |           |           |         |    |
|           | d         |           |           |         |    |
|           | ata(LCID= |           |           |         |    |
|           | '000101') |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (1 RLC    |         |    |
|           | a MAC PDU |           | SDUs on   |         |    |
|           | c         |           | LCH4)     |         |    |
|           | ontaining |           |           |         |    |
|           | one RLC   |           |           |         |    |
|           | SDUs of   |           |           |         |    |
|           | size 2800 |           |           |         |    |
|           | bytes on  |           |           |         |    |
|           | LCH4      |           |           |         |    |
|           | (\>4751   |           |           |         |    |
|           | bytes     |           |           |         |    |
|           | including |           |           |         |    |
|           | step 2)   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (RLC SDU  |         |    |
|           | a MAC PDU |           | on LCH5)  |         |    |
|           | including |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | PDU of    |           |           |         |    |
|           | size 13   |           |           |         |    |
|           | bytes on  |           |           |         |    |
|           | LCH5.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | SS        | \<\--     | (UL       | \-      | \- |
|           | allocates |           | Grant, 56 |         |    |
|           | an UL     |           | bits)     |         |    |
|           | Grant of  |           |           |         |    |
|           | 56 bits.  |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           | (MAC Long |         |    |
|           | a Long    |           | Refined   |         |    |
|           | Refined   |           | BSR (LCG  |         |    |
|           | BSR with  |           | ID='2' &  |         |    |
|           | 'LCG ID'  |           | LCG       |         |    |
|           | field set |           | ID='1'))  |         |    |
|           | to '2' &  |           |           |         |    |
|           | 'LCG ID'  |           |           |         |    |
|           | field set |           |           |         |    |
|           | to '1'.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | The SS    | \<\--     | (UL       | \-      | \- |
|           | sends an  |           | grant)    |         |    |
|           | uplink    |           |           |         |    |
|           | grant of  |           |           |         |    |
|           | size 176  |           |           |         |    |
|           | bits.     |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does UE   |           | (MAC sub  |         |    |
|           | transmit  |           | PDU       |         |    |
|           | a MAC PDU |           | header    |         |    |
|           | c         |           | for RLC   |         |    |
|           | ontaining |           | PDU, RLC  |         |    |
|           | an RLC    |           | PDU, Long |         |    |
|           | SDU and a |           | Refined   |         |    |
|           | Long BSR  |           | BSR       |         |    |
|           | i         |           | header,   |         |    |
|           | ndicating |           | Long      |         |    |
|           | pending   |           | Refined   |         |    |
|           | data      |           | BSR)      |         |    |
|           | ('Buffer  |           |           |         |    |
|           | size'     |           |           |         |    |
|           | field \>  |           |           |         |    |
|           | '0') for  |           |           |         |    |
|           | l         |           |           |         |    |
|           | ogicalCha |           |           |         |    |
|           | nnelGroup |           |           |         |    |
|           | 1 ('LCG   |           |           |         |    |
|           | ID' field |           |           |         |    |
|           | set to    |           |           |         |    |
|           | '02')?    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 16        | SS        | \<\--     | RLC       | \-      | \- |
|           | transmits |           | STATUS    |         |    |
|           | an RLC    |           | PDU       |         |    |
|           | STATUS    |           | (A        |         |    |
|           | PDU to    |           | CK\_SN=2) |         |    |
|           | ac        |           |           |         |    |
|           | knowledge |           |           |         |    |
|           | correctly |           |           |         |    |
|           | received  |           |           |         |    |
|           | d         |           |           |         |    |
|           | ata(LCID= |           |           |         |    |
|           | '000101') |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17        | SS        | \<\--     | (UL       | \-      | \- |
|           | allocates |           | Grant)    |         |    |
|           | an UL     |           |           |         |    |
|           | Grant of  |           |           |         |    |
|           | 50000     |           |           |         |    |
|           | bytes or  |           |           |         |    |
|           | more.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 18        | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           | (17-Byte  |         |    |
|           | a MAC PDU |           | 2 MAC sub |         |    |
|           | including |           | PDUs from |         |    |
|           | 2 RLC     |           | LCH4)     |         |    |
|           | SDUs      |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back      |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to steps  |           |           |         |    |
|           | 2 and 10. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19        | SS        | \<\--     | RLC       | \-      | \- |
|           | transmits |           | STATUS    |         |    |
|           | an RLC    |           | PDU       |         |    |
|           | STATUS    |           | (A        |         |    |
|           | PDU to    |           | CK\_SN=2) |         |    |
|           | ac        |           |           |         |    |
|           | knowledge |           |           |         |    |
|           | correctly |           |           |         |    |
|           | received  |           |           |         |    |
|           | d         |           |           |         |    |
|           | ata(LCID= |           |           |         |    |
|           | '000100') |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| 56 bits   |           |           |           |         |    |
| enables   |           |           |           |         |    |
| UE to     |           |           |           |         |    |
| transmit  |           |           |           |         |    |
| a MAC PDU |           |           |           |         |    |
| with a 1  |           |           |           |         |    |
| byte MAC  |           |           |           |         |    |
| BSR       |           |           |           |         |    |
| header    |           |           |           |         |    |
| and a     |           |           |           |         |    |
| Short BSR |           |           |           |         |    |
| (1 byte)  |           |           |           |         |    |
| or a 2    |           |           |           |         |    |
| bytes MAC |           |           |           |         |    |
| BSR       |           |           |           |         |    |
| header    |           |           |           |         |    |
| and a     |           |           |           |         |    |
| Long BSR  |           |           |           |         |    |
| 3 bytes   |           |           |           |         |    |
| (with 2   |           |           |           |         |    |
| LCG       |           |           |           |         |    |
| co        |           |           |           |         |    |
| nfigured) |           |           |           |         |    |
| or a 3    |           |           |           |         |    |
| bytes MAC |           |           |           |         |    |
| BSR       |           |           |           |         |    |
| header    |           |           |           |         |    |
| and a     |           |           |           |         |    |
| Long      |           |           |           |         |    |
| Refined   |           |           |           |         |    |
| BSR 4     |           |           |           |         |    |
| bytes     |           |           |           |         |    |
| (with 2   |           |           |           |         |    |
| LCG       |           |           |           |         |    |
| con       |           |           |           |         |    |
| figured). |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| UE        |           |           |           |         |    |
| triggers  |           |           |           |         |    |
| a long    |           |           |           |         |    |
| BSR of    |           |           |           |         |    |
| type      |           |           |           |         |    |
| \"Padding |           |           |           |         |    |
| BSR\" to  |           |           |           |         |    |
| report    |           |           |           |         |    |
| buffer    |           |           |           |         |    |
| status    |           |           |           |         |    |
| for one   |           |           |           |         |    |
| LCG for   |           |           |           |         |    |
| that TTI. |           |           |           |         |    |
| (2 Bytes  |           |           |           |         |    |
| MAC Data  |           |           |           |         |    |
| sub PDU   |           |           |           |         |    |
| header +  |           |           |           |         |    |
| 13 Bytes  |           |           |           |         |    |
| MAC SDU + |           |           |           |         |    |
| 3 Byte    |           |           |           |         |    |
| Long      |           |           |           |         |    |
| refined   |           |           |           |         |    |
| BSR sub   |           |           |           |         |    |
| header +  |           |           |           |         |    |
| 4 Bytes   |           |           |           |         |    |
| Long      |           |           |           |         |    |
| Refined   |           |           |           |         |    |
| BSR (with |           |           |           |         |    |
| 2 LCG     |           |           |           |         |    |
| con       |           |           |           |         |    |
| figured)= |           |           |           |         |    |
| 22        |           |           |           |         |    |
| bytes).   |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.3.19.3.3 Specific message contents {#specific-message-contents-22 .H6}

None

##### 7.1.1.3.20 Correct Handling of MAC control information / Delay Status / Delay status reporting

##### 7.1.1.3.20.1 Test Purpose (TP) {#test-purpose-tp-24 .H6}

##### (1) {#section-64 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { smallest remaining value of the PDCP discardTimers among all
the data buffered for the LCG becomes below remainingTimeThreshold of
the LCG }

**then** { UE reports a DSR including LCGi=1 **and** Remaining Timer and
Buffer Size for the LCGi }

}

##### 7.1.1.3.20.2 Conformance requirements {#conformance-requirements-23 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.321, clauses 5.4.9, 6.1.3.72 and 6.1.3.1. Unless
otherwise stated these are Rel-18 requirements.

\[TS 38.321, clause 5.4.9\]

The Delay Status Reporting (DSR) procedure is used to provide the
serving gNB with delay status of LCGs. This delay status for an LCG
includes remaining time, which is the smallest remaining value of the
running PDCP *discardTimer*s among PDCP SDUs that are buffered for the
LCG but have not been transmitted in any MAC PDU as specified in clause
7.3 in TS 38.323 \[4\], and the total amount of delay-critical UL data
for the LCG according to the data volume calculation procedure specified
in clause 5.5 in TS 38.322 \[3\] and clause 5.15 in TS 38.323 \[4\] for
the associated RLC and PDCP entities, respectively.

RRC controls the DSR procedure by configuring the following parameter:

\- *remainingTimeThreshold (per LCG)*: the threshold on remaining time
for triggering a DSR for a logical channel within an LCG.

If an LCG is configured for delay status reporting, the MAC entity shall
for each logical channel within the LCG:

1\> if the smallest remaining value of the running PDCP *discardTimer*s
among all the PDCP SDUs buffered for the logical channel that have not
been transmitted in any MAC PDU and have not been reported as data
volume in a DSR MAC CE becomes below *remainingTimeThreshold* of the
LCG; and

> 1\> if there is no DSR pending for the logical channel:

2\> trigger a DSR for the logical channel.

If there is at least one DSR pending, the MAC entity shall:

1\> if UL-SCH resources are available for a new transmission and the
UL-SCH resources can accommodate the DSR MAC CE plus its subheader as a
result of logical channel prioritization:

2\> instruct the Multiplexing and Assembly procedure to generate the DSR
MAC CE as specified in clause 6.1.3.72.

...

NOTE 1: The availability of UL-SCH resources for the transmission of the
DSR MAC CE follows the same criteria specified in clause 5.4.5.

A PDCP SDU is considered to be associated with a DSR if it has not been
transmitted in any MAC PDU and is a delay-critical PDCP SDU (as defined
in TS 38.323 \[4\]) associated with the logical channel which triggered
the DSR.

A MAC PDU shall contain at most one DSR MAC CE. A MAC PDU shall not
contain a DSR MAC CE if it includes all PDCP SDUs associated with all
the pending DSRs.

After a DSR is triggered, it is considered as pending until it is
cancelled. The MAC entity shall cancel a pending DSR, when all the PDCP
SDUs associated with the DSR have been discarded, or when a MAC PDU is
transmitted and this MAC PDU includes a DSR MAC CE that contains the
delay information of all the PDCP SDUs associated with the DSR (as
described in the clause 6.1.3.72), or when a MAC PDU is transmitted and
this MAC PDU includes all the PDCP SDUs associated with the DSR.

NOTE 2: It is up to UE implementation whether the MAC entity includes a
DSR MAC CE in a MAC PDU if the MAC PDU can accommodate all PDCP SDUs
associated with all the pending DSRs but is not sufficient to
additionally accommodate the DSR MAC CE plus its subheader.

\[TS 38.321, clause 6.1.3.72\]

The Delay Status Report (DSR) MAC CE is identified by MAC subheader with
an **eLCID** as specified in Table 6.2.1-**2b**.

The fields in the DSR MAC CE are defined as follows:

\- LCG~i~: This field indicates the presence of delay information (i.e.
the Remaining Time and Buffer Size fields) for the LCG i. The LCG~i~
field set to 1 indicates that the delay information for the LCG i is
reported. The LCG~i~ field set to 0 indicates that the delay information
for the LCG i is not reported;

\- Remaining Time: This field indicates the shortest remaining value of
running PDCP *discardTimer* (described in clause 7.3 in TS 38.323 \[4\])
among all PDCP SDUs that are buffered for an LCG but have not been
transmitted in any MAC PDU, at the time of the first symbol of the first
PUSCH transmission that includes this DSR MAC CE. The length of this
field is 6 bits. This field is present only if the buffer size indicated
by the corresponding Buffer Size field is not zero; otherwise, this
field is reserved and set to 0. If present, the value *r* in this field
indicates a remaining time within the range of (*r*, *r* + 1\] msec;

\- BT: This field is present only if the corresponding LCG is configured
with *additionalBS-TableAllowed* and the buffer size indicated by the
corresponding Buffer Size field is not zero; otherwise, this field is
reserved and set to 0. If present, the BT field set to 1 indicates that
the buffer sizes specified in Table 6.1.3.1-3 are used to set the value
of the Buffer Size field, while the BT field set to 0 indicates that the
buffer sizes specified in Table 6.1.3.1-2 are used instead;

\- Buffer Size: The Buffer Size field indicates the total amount of
delay-critical UL data for an LCG according to the data volume
calculation procedure specified in clause 5.5 in TS 38.322 \[3\] and
clause 5.15 in TS 38.323 \[4\] for the associated RLC and PDCP entities,
respectively, after the MAC PDU has been built. If the corresponding LCG
is configured with *additionalBS-TableAllowed* and the amount of
delay-critical UL data for an LCG is within the buffer sizes specified
in Table 6.1.3.1-3, the MAC entity shall use the buffer sizes specified
in Table 6.1.3.1-3 to set the value of this field; otherwise, the MAC
entity shall use Table 6.1.3.1-2 instead. This field is indicated in
number of bytes. The length of this field is 8 bits.

**The DSR MAC CE shall include delay information of all LCGs which have
pending DSRs when the MAC PDU containing this DSR MAC CE is to be built.
The Remaining Time, the BT, and the Buffer Size fields for an LCG shall
be reported in two consecutive octets. These three** fields **for
different LCGs shall be** included in **a** DSR MAC CE **in ascending
order based on the LCG~i~.**

Figure 6.1.3.72-1: DSR MAC CE

\[TS 38.321, clause 6.1.3.1\]

Table 6.1.3.1-2: Buffer size levels (in bytes) for 8-bit Buffer Size
field

  Index   BS value   Index   BS value   Index   BS value    Index   BS value
  ------- ---------- ------- ---------- ------- ----------- ------- -------------
  0       0          64      â¤ 560      128     â¤ 31342     192     â¤ 1754595
  1       â¤ 10       65      â¤ 597      129     â¤ 33376     193     â¤ 1868488
  2       â¤ 11       66      â¤ 635      130     â¤ 35543     194     â¤ 1989774
  3       â¤ 12       67      â¤ 677      131     â¤ 37850     195     â¤ 2118933
  4       â¤ 13       68      â¤ 720      132     â¤ 40307     196     â¤ 2256475
  5       â¤ 14       69      â¤ 767      133     â¤ 42923     197     â¤ 2402946
  6       â¤ 15       70      â¤ 817      134     â¤ 45709     198     â¤ 2558924
  7       â¤ 16       71      â¤ 870      135     â¤ 48676     199     â¤ 2725027
  8       â¤ 17       72      â¤ 926      136     â¤ 51836     200     â¤ 2901912
  9       â¤ 18       73      â¤ 987      137     â¤ 55200     201     â¤ 3090279
  10      â¤ 19       74      â¤ 1051     138     â¤ 58784     202     â¤ 3290873
  11      â¤ 20       75      â¤ 1119     139     â¤ 62599     203     â¤ 3504487
  12      â¤ 22       76      â¤ 1191     140     â¤ 66663     204     â¤ 3731968
  13      â¤ 23       77      â¤ 1269     141     â¤ 70990     205     â¤ 3974215
  14      â¤ 25       78      â¤ 1351     142     â¤ 75598     206     â¤ 4232186
  15      â¤ 26       79      â¤ 1439     143     â¤ 80505     207     â¤ 4506902
  16      â¤ 28       80      â¤ 1532     144     â¤ 85730     208     â¤ 4799451
  17      â¤ 30       81      â¤ 1631     145     â¤ 91295     209     â¤ 5110989
  18      â¤ 32       82      â¤ 1737     146     â¤ 97221     210     â¤ 5442750
  19      â¤ 34       83      â¤ 1850     147     â¤ 103532    211     â¤ 5796046
  20      â¤ 36       84      â¤ 1970     148     â¤ 110252    212     â¤ 6172275
  21      â¤ 38       85      â¤ 2098     149     â¤ 117409    213     â¤ 6572925
  22      â¤ 40       86      â¤ 2234     150     â¤ 125030    214     â¤ 6999582
  23      â¤ 43       87      â¤ 2379     151     â¤ 133146    215     â¤ 7453933
  24      â¤ 46       88      â¤ 2533     152     â¤ 141789    216     â¤ 7937777
  25      â¤ 49       89      â¤ 2698     153     â¤ 150992    217     â¤ 8453028
  26      â¤ 52       90      â¤ 2873     154     â¤ 160793    218     â¤ 9001725
  27      â¤ 55       91      â¤ 3059     155     â¤ 171231    219     â¤ 9586039
  28      â¤ 59       92      â¤ 3258     156     â¤ 182345    220     â¤ 10208280
  29      â¤ 62       93      â¤ 3469     157     â¤ 194182    221     â¤ 10870913
  30      â¤ 66       94      â¤ 3694     158     â¤ 206786    222     â¤ 11576557
  31      â¤ 71       95      â¤ 3934     159     â¤ 220209    223     â¤ 12328006
  32      â¤ 75       96      â¤ 4189     160     â¤ 234503    224     â¤ 13128233
  33      â¤ 80       97      â¤ 4461     161     â¤ 249725    225     â¤ 13980403
  34      â¤ 85       98      â¤ 4751     162     â¤ 265935    226     â¤ 14887889
  35      â¤ 91       99      â¤ 5059     163     â¤ 283197    227     â¤ 15854280
  36      â¤ 97       100     â¤ 5387     164     â¤ 301579    228     â¤ 16883401
  37      â¤ 103      101     â¤ 5737     165     â¤ 321155    229     â¤ 17979324
  38      â¤ 110      102     â¤ 6109     166     â¤ 342002    230     â¤ 19146385
  39      â¤ 117      103     â¤ 6506     167     â¤ 364202    231     â¤ 20389201
  40      â¤ 124      104     â¤ 6928     168     â¤ 387842    232     â¤ 21712690
  41      â¤ 132      105     â¤ 7378     169     â¤ 413018    233     â¤ 23122088
  42      â¤ 141      106     â¤ 7857     170     â¤ 439827    234     â¤ 24622972
  43      â¤ 150      107     â¤ 8367     171     â¤ 468377    235     â¤ 26221280
  44      â¤ 160      108     â¤ 8910     172     â¤ 498780    236     â¤ 27923336
  45      â¤ 170      109     â¤ 9488     173     â¤ 531156    237     â¤ 29735875
  46      â¤ 181      110     â¤ 10104    174     â¤ 565634    238     â¤ 31666069
  47      â¤ 193      111     â¤ 10760    175     â¤ 602350    239     â¤ 33721553
  48      â¤ 205      112     â¤ 11458    176     â¤ 641449    240     â¤ 35910462
  49      â¤ 218      113     â¤ 12202    177     â¤ 683087    241     â¤ 38241455
  50      â¤ 233      114     â¤ 12994    178     â¤ 727427    242     â¤ 40723756
  51      â¤ 248      115     â¤ 13838    179     â¤ 774645    243     â¤ 43367187
  52      â¤ 264      116     â¤ 14736    180     â¤ 824928    244     â¤ 46182206
  53      â¤ 281      117     â¤ 15692    181     â¤ 878475    245     â¤ 49179951
  54      â¤ 299      118     â¤ 16711    182     â¤ 935498    246     â¤ 52372284
  55      â¤ 318      119     â¤ 17795    183     â¤ 996222    247     â¤ 55771835
  56      â¤ 339      120     â¤ 18951    184     â¤ 1060888   248     â¤ 59392055
  57      â¤ 361      121     â¤ 20181    185     â¤ 1129752   249     â¤ 63247269
  58      â¤ 384      122     â¤ 21491    186     â¤ 1203085   250     â¤ 67352729
  59      â¤ 409      123     â¤ 22885    187     â¤ 1281179   251     â¤ 71724679
  60      â¤ 436      124     â¤ 24371    188     â¤ 1364342   252     â¤ 76380419
  61      â¤ 464      125     â¤ 25953    189     â¤ 1452903   253     â¤ 81338368
  62      â¤ 494      126     â¤ 27638    190     â¤ 1547213   254     \> 81338368
  63      â¤ 526      127     â¤ 29431    191     â¤ 1647644   255     Reserved

##### 7.1.1.3.20.3 Test description {#test-description-23 .H6}

##### 7.1.1.3.20.3.1 Pre-test conditions {#pre-test-conditions-23 .H6}

Same Pre-test conditions as in clause 7.1.1.0 with the exception of 2 AM
DRBs on NR cell configured according to Table 7.1.1.3.20.3.1-1.

Table 7.1.1.3.20.3.1-1: Logical Channel Configuration Settings

  Parameter                DRB1                    DRB2
  ------------------------ ----------------------- -----------------------
  LogicalChannelIdentity   LCH4(DRB-Identity +3)   LCH5(DRB-Identity +3)
  Priority                 7                       6
  prioritizedBitRate       0kbs                    0kbs
  logicalChannelGroup      2 (LCG ID\#2)           1 (LCG ID\#1)
  discardTimer             100ms                   100ms
  remainingTimeThreshold   64ms                    32ms

##### 7.1.1.3.20.3.2 Test procedure sequence {#test-procedure-sequence-23 .H6}

Table 7.1.1.3.20.3.2-1: Main behaviour

  St   Procedure                                                                                                                                                                                   Message Sequence   TP                                           Verdict   
  ---- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------------ -------------------------------------------- --------- ----
                                                                                                                                                                                                   U - S              Message                                                
  1    The SS ignores scheduling requests and does not allocate any uplink grant.                                                                                                                                                                                            
  2    The SS sends a MAC PDU including an RLC PDU of size 32 bytes on LCH5 and RLC PDU of size 16 bytes on LCH4.                                                                                  \<\--              MAC PDU (RLC SDU on LCH5, RLC SDU on LCH4)   \-        \-
  3    20 ms after step 2, the SS sends a MAC PDU including an RLC PDU of size 16 bytes on LCH4.                                                                                                   \<\--              MAC PDU (RLC SDU on LCH4)                              
  4    60 ms after step 2, SS transmits an UL Grant of 48 bits, allowing the UE to send a DSR MAC CE.                                                                                              \<\--              (UL Grant (unknown C-RNTI))                  \-        \-
  5    Check: Does the UE transmit MAC PDU containing an DSR MAC CE for indicating remaining time and pending data ('Buffer size' field \> '0') for the LCGi = 2?                                  \--\>              MAC PDU (DSR)                                1         P
  6    SS waits for 80 ms after step 2 for discardTimer to go below remainingTimeThreshold for LCGi = 1 and LCGi = 2 and transmits an UL grant of 64 bits, allowing the UE to send a DSR MAC CE.   \-                 (UL Grant (unknown C-RNTI))                  \-        \-
  7    Check: Does the UE transmit MAC PDU containing an DSR MAC CE for indicating remaining time and pending data ('Buffer size' field \> '0') for the LCGi = 1 and LCGi = 2?                     \--\>              MAC PDU (DSR)                                1         P
  8    SS waits for 100 ms to all discard timers for DRB1 and DRB2 expire.                                                                                                                         \-                 \-                                           \-        \-

##### 7.1.1.3.20.3.3 Specific message contents {#specific-message-contents-23 .H6}

None.

##### 7.1.1.3.20a Correct Handling of MAC control information / Delay Status / Refined delay status reporting

##### 7.1.1.3.20a.1 Test Purpose (TP) {#a.1-test-purpose-tp .H6}

\(1\)

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { smallest remaining value of the PDCP discardTimers among all
the data buffered for the LCG becomes below remainingTimeThreshold of
the LCG **and** additionalBSR-TableAllowed is set to false for all LCGs
**and** regardless of the amount of delay-critical data to be reported }

**then** { UE reports a DSR with BT indication 0 for all LCGs }

}

\(2\)

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { smallest remaining value of the PDCP discardTimers among all
the data buffered for the LCG becomes below remainingTimeThreshold of
the LCG **and** additionalBSR-TableAllowed is set to true for at least
some LCGs **and** the amount of delay-critical data to be reported for
the LCGs with additionalBS-TableAllowed=true is outside the range
specified in Table 6.1.3.1-3 }

**then** { UE reports a DSR with BT indication 0 for all LCGs }

}

\(3\)

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { smallest remaining value of the PDCP discardTimers among all
the data buffered for the LCG becomes below remainingTimeThreshold of
the LCG **and** additionalBSR-TableAllowed is set to true for at least
some LCGs **and** the amount of delay-critical data to be reported for
the LCGs with additionalBS-TableAllowed=true is inside the range
specified in Table 6.1.3.1-3 }

**then** { UE reports a DSR with BT indication 1 for LCGs with
additionalBS-TableAllowed=true **and** 0 for all others }

}

##### 7.1.1.3.20a.2 Conformance requirements {#a.2-conformance-requirements .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.321, clauses 5.4.9, 6.1.3.72 and 6.1.3.1. Unless
otherwise stated these are Rel-18 requirements.

\[TS 38.321, clause 5.4.9\]

The Delay Status Reporting (DSR) procedure is used to provide the
serving gNB with delay status of LCGs. This delay status for an LCG
includes remaining time, which is the smallest remaining value of the
running PDCP *discardTimer*s among SDUs that are buffered for the LCG
but have not been transmitted in any MAC PDU as specified in clause 7.3
in TS 38.323 \[4\], and the total amount of delay-critical UL data for
the LCG according to the data volume calculation procedure specified in
clause 5.5 in TS 38.322 \[3\] and clause 5.6 in TS 38.323 \[4\] for the
associated RLC and PDCP entities, respectively.

RRC controls the DSR procedure by configuring the following parameter:

> \- *remainingTimeThreshold*: the threshold on remaining time for
> triggering a DSR for an LCG.

If an LCG is configured for delay status reporting, the MAC entity
shall:

> 1\> if the smallest remaining value of the running PDCP
> *discardTimer*s among all the SDUs buffered for the LCG that has not
> been transmitted in any MAC PDU and has not been reported as data
> volume in a DSR MAC CE becomes below *remainingTimeThreshold* of the
> LCG; and
>
> 1\> if there is no DSR pending for the LCG:
>
> 2\> trigger a DSR for the LCG.

If there is at least one DSR pending, the MAC entity shall:

> 1\> if UL-SCH resources are available for a new transmission and the
> UL-SCH resources can accommodate the DSR MAC CE plus its subheader as
> a result of logical channel prioritization:
>
> 2\> instruct the Multiplexing and Assembly procedure to generate the
> DSR MAC CE as specified in clause 6.1.3.72.
>
> ...
>
> NOTE: The availability of UL-SCH resources for the transmission of the
> DSR MAC CE follows the same criteria specified in clause 5.4.5.

An SDU is considered to be associated with a DSR if it has not been
transmitted in any MAC PDU and it is associated with the LCG which
triggered the DSR and the remaining value of its PDCP *discardTimer* is
below *remainingTimeThreshold*.

A MAC PDU shall contain at most one DSR MAC CE. The MAC entity shall not
include a DSR MAC CE in a MAC PDU if the MAC PDU can accommodate the
SDUs associated with all the pending DSRs.

After a DSR is triggered, it is considered as pending until it is
cancelled. The MAC entity shall cancel a pending DSR, either when all
the SDUs associated with the DSR have been discarded, or when a MAC PDU
is transmitted and this MAC PDU includes a DSR MAC CE that contains the
delay information of all the SDUs associated with the DSR (as described
in the clause 6.1.3.72). The MAC entity may cancel a pending DSR when a
MAC PDU is transmitted and this MAC PDU includes all the SDUs associated
with the DSR but is not sufficient to include the DSR MAC CE and its
subheader.

\[TS 38.321, clause 6.1.3.72\]

The Delay Status Report (DSR) MAC CE is identified by MAC subheader with
an **eLCID** as specified in Table 6.2.1-**2b**.

The fields in the DSR MAC CE are defined as follows:

\- LCG~i~: This field indicates the presence of delay information (i.e.
the Remaining Time and Buffer Size fields) for the LCG i. The LCG~i~
field set to 1 indicates that the delay information for the LCG i is
reported. The LCG~i~ field set to 0 indicates that the delay information
for the LCG i is not reported;

\- Remaining Time: This field indicates the shortest remaining value of
running PDCP *discardTimer* (described in clause 7.3 in TS 38.323 \[4\])
among all PDCP SDUs that are buffered for an LCG but have not been
transmitted in any MAC PDU, at the time of the first symbol of the first
PUSCH transmission that includes this DSR MAC CE. The length of this
field is 6 bits. This field is present only if the buffer size indicated
by the corresponding Buffer Size field is not zero; otherwise, this
field is reserved and set to 0. If present, the value *r* in this field
indicates a remaining time within the range of (*r*, *r* + 1\] msec;

\- BT: This field is present only if the corresponding LCG is configured
with *additionalBS-TableAllowed* and the buffer size indicated by the
corresponding Buffer Size field is not zero; otherwise, this field is
reserved and set to 0. If present, the BT field set to 1 indicates that
the buffer sizes specified in Table 6.1.3.1-3 are used to set the value
of the Buffer Size field, while the BT field set to 0 indicates that the
buffer sizes specified in Table 6.1.3.1-2 are used instead;

\- Buffer Size: The Buffer Size field indicates the total amount of
delay-critical UL data for an LCG according to the data volume
calculation procedure specified in clause 5.5 in TS 38.322 \[3\] and
clause 5.6 in TS 38.323 \[4\] for the associated RLC and PDCP entities,
respectively, after the MAC PDU has been built. If the corresponding LCG
is configured with *additionalBS-TableAllowed* and the amount of
delay-critical UL data for an LCG is within the buffer sizes specified
in Table 6.1.3.1-3, the MAC entity shall use the buffer sizes specified
in Table 6.1.3.1-3 to set the value of this field; otherwise, the MAC
entity shall use Table 6.1.3.1-2 instead. This field is indicated in
number of bytes. The length of this field is 8 bits.

**The DSR MAC CE shall include delay information of all LCGs which have
pending DSRs when the MAC PDU containing this DSR MAC CE is to be built.
The Remaining Time, the BT, and the Buffer Size fields for an LCG shall
be reported in two consecutive octets. These three** fields **for
different LCGs shall be** included in **a** DSR MAC CE **in ascending
order based on the LCG~i~.**

Figure 6.1.3.72-1: DSR MAC CE

\[TS 38.321, clause 6.1.3.1\]

Table 6.1.3.1-2: Buffer size levels (in bytes) for 8-bit Buffer Size
field

  Index   BS value   Index   BS value   Index   BS value    Index   BS value
  ------- ---------- ------- ---------- ------- ----------- ------- -------------
  0       0          64      â¤ 560      128     â¤ 31342     192     â¤ 1754595
  1       â¤ 10       65      â¤ 597      129     â¤ 33376     193     â¤ 1868488
  2       â¤ 11       66      â¤ 635      130     â¤ 35543     194     â¤ 1989774
  3       â¤ 12       67      â¤ 677      131     â¤ 37850     195     â¤ 2118933
  4       â¤ 13       68      â¤ 720      132     â¤ 40307     196     â¤ 2256475
  5       â¤ 14       69      â¤ 767      133     â¤ 42923     197     â¤ 2402946
  6       â¤ 15       70      â¤ 817      134     â¤ 45709     198     â¤ 2558924
  7       â¤ 16       71      â¤ 870      135     â¤ 48676     199     â¤ 2725027
  8       â¤ 17       72      â¤ 926      136     â¤ 51836     200     â¤ 2901912
  9       â¤ 18       73      â¤ 987      137     â¤ 55200     201     â¤ 3090279
  10      â¤ 19       74      â¤ 1051     138     â¤ 58784     202     â¤ 3290873
  11      â¤ 20       75      â¤ 1119     139     â¤ 62599     203     â¤ 3504487
  12      â¤ 22       76      â¤ 1191     140     â¤ 66663     204     â¤ 3731968
  13      â¤ 23       77      â¤ 1269     141     â¤ 70990     205     â¤ 3974215
  14      â¤ 25       78      â¤ 1351     142     â¤ 75598     206     â¤ 4232186
  15      â¤ 26       79      â¤ 1439     143     â¤ 80505     207     â¤ 4506902
  16      â¤ 28       80      â¤ 1532     144     â¤ 85730     208     â¤ 4799451
  17      â¤ 30       81      â¤ 1631     145     â¤ 91295     209     â¤ 5110989
  18      â¤ 32       82      â¤ 1737     146     â¤ 97221     210     â¤ 5442750
  19      â¤ 34       83      â¤ 1850     147     â¤ 103532    211     â¤ 5796046
  20      â¤ 36       84      â¤ 1970     148     â¤ 110252    212     â¤ 6172275
  21      â¤ 38       85      â¤ 2098     149     â¤ 117409    213     â¤ 6572925
  22      â¤ 40       86      â¤ 2234     150     â¤ 125030    214     â¤ 6999582
  23      â¤ 43       87      â¤ 2379     151     â¤ 133146    215     â¤ 7453933
  24      â¤ 46       88      â¤ 2533     152     â¤ 141789    216     â¤ 7937777
  25      â¤ 49       89      â¤ 2698     153     â¤ 150992    217     â¤ 8453028
  26      â¤ 52       90      â¤ 2873     154     â¤ 160793    218     â¤ 9001725
  27      â¤ 55       91      â¤ 3059     155     â¤ 171231    219     â¤ 9586039
  28      â¤ 59       92      â¤ 3258     156     â¤ 182345    220     â¤ 10208280
  29      â¤ 62       93      â¤ 3469     157     â¤ 194182    221     â¤ 10870913
  30      â¤ 66       94      â¤ 3694     158     â¤ 206786    222     â¤ 11576557
  31      â¤ 71       95      â¤ 3934     159     â¤ 220209    223     â¤ 12328006
  32      â¤ 75       96      â¤ 4189     160     â¤ 234503    224     â¤ 13128233
  33      â¤ 80       97      â¤ 4461     161     â¤ 249725    225     â¤ 13980403
  34      â¤ 85       98      â¤ 4751     162     â¤ 265935    226     â¤ 14887889
  35      â¤ 91       99      â¤ 5059     163     â¤ 283197    227     â¤ 15854280
  36      â¤ 97       100     â¤ 5387     164     â¤ 301579    228     â¤ 16883401
  37      â¤ 103      101     â¤ 5737     165     â¤ 321155    229     â¤ 17979324
  38      â¤ 110      102     â¤ 6109     166     â¤ 342002    230     â¤ 19146385
  39      â¤ 117      103     â¤ 6506     167     â¤ 364202    231     â¤ 20389201
  40      â¤ 124      104     â¤ 6928     168     â¤ 387842    232     â¤ 21712690
  41      â¤ 132      105     â¤ 7378     169     â¤ 413018    233     â¤ 23122088
  42      â¤ 141      106     â¤ 7857     170     â¤ 439827    234     â¤ 24622972
  43      â¤ 150      107     â¤ 8367     171     â¤ 468377    235     â¤ 26221280
  44      â¤ 160      108     â¤ 8910     172     â¤ 498780    236     â¤ 27923336
  45      â¤ 170      109     â¤ 9488     173     â¤ 531156    237     â¤ 29735875
  46      â¤ 181      110     â¤ 10104    174     â¤ 565634    238     â¤ 31666069
  47      â¤ 193      111     â¤ 10760    175     â¤ 602350    239     â¤ 33721553
  48      â¤ 205      112     â¤ 11458    176     â¤ 641449    240     â¤ 35910462
  49      â¤ 218      113     â¤ 12202    177     â¤ 683087    241     â¤ 38241455
  50      â¤ 233      114     â¤ 12994    178     â¤ 727427    242     â¤ 40723756
  51      â¤ 248      115     â¤ 13838    179     â¤ 774645    243     â¤ 43367187
  52      â¤ 264      116     â¤ 14736    180     â¤ 824928    244     â¤ 46182206
  53      â¤ 281      117     â¤ 15692    181     â¤ 878475    245     â¤ 49179951
  54      â¤ 299      118     â¤ 16711    182     â¤ 935498    246     â¤ 52372284
  55      â¤ 318      119     â¤ 17795    183     â¤ 996222    247     â¤ 55771835
  56      â¤ 339      120     â¤ 18951    184     â¤ 1060888   248     â¤ 59392055
  57      â¤ 361      121     â¤ 20181    185     â¤ 1129752   249     â¤ 63247269
  58      â¤ 384      122     â¤ 21491    186     â¤ 1203085   250     â¤ 67352729
  59      â¤ 409      123     â¤ 22885    187     â¤ 1281179   251     â¤ 71724679
  60      â¤ 436      124     â¤ 24371    188     â¤ 1364342   252     â¤ 76380419
  61      â¤ 464      125     â¤ 25953    189     â¤ 1452903   253     â¤ 81338368
  62      â¤ 494      126     â¤ 27638    190     â¤ 1547213   254     \> 81338368
  63      â¤ 526      127     â¤ 29431    191     â¤ 1647644   255     Reserved

Table 6.1.3.1-3. Refined buffer size levels (in bytes) for 8-bit Buffer
Size field

  **Index**   **BS value**         **Index**   **BS value**   **Index**   **BS Value**   **Index**   **BS Value**
  ----------- -------------------- ----------- -------------- ----------- -------------- ----------- --------------
  0           \> 4751 and â¤ 5000   64          â¤ 17584        128         â¤ 61841        192         â¤ 217489
  1           â¤ 5099               65          â¤ 17933        129         â¤ 63069        193         â¤ 221805
  2           â¤ 5200               66          â¤ 18289        130         â¤ 64320        194         â¤ 226207
  3           â¤ 5303               67          â¤ 18652        131         â¤ 65596        195         â¤ 230695
  4           â¤ 5408               68          â¤ 19022        132         â¤ 66898        196         â¤ 235273
  5           â¤ 5516               69          â¤ 19399        133         â¤ 68226        197         â¤ 239942
  6           â¤ 5625               70          â¤ 19784        134         â¤ 69580        198         â¤ 244703
  7           â¤ 5737               71          â¤ 20177        135         â¤ 70960        199         â¤ 249559
  8           â¤ 5851               72          â¤ 20577        136         â¤ 72368        200         â¤ 254511
  9           â¤ 5967               73          â¤ 20985        137         â¤ 73804        201         â¤ 259562
  10          â¤ 6085               74          â¤ 21402        138         â¤ 75269        202         â¤ 264713
  11          â¤ 6206               75          â¤ 21827        139         â¤ 76763        203         â¤ 269966
  12          â¤ 6329               76          â¤ 22260        140         â¤ 78286        204         â¤ 275323
  13          â¤ 6455               77          â¤ 22702        141         â¤ 79839        205         â¤ 280786
  14          â¤ 6583               78          â¤ 23152        142         â¤ 81424        206         â¤ 286358
  15          â¤ 6713               79          â¤ 23611        143         â¤ 83040        207         â¤ 292041
  16          â¤ 6847               80          â¤ 24080        144         â¤ 84687        208         â¤ 297836
  17          â¤ 6983               81          â¤ 24558        145         â¤ 86368        209         â¤ 303746
  18          â¤ 7121               82          â¤ 25045        146         â¤ 88082        210         â¤ 309774
  19          â¤ 7262               83          â¤ 25542        147         â¤ 89830        211         â¤ 315921
  20          â¤ 7407               84          â¤ 26049        148         â¤ 91612        212         â¤ 322190
  21          â¤ 7554               85          â¤ 26566        149         â¤ 93430        213         â¤ 328583
  22          â¤ 7703               86          â¤ 27093        150         â¤ 95284        214         â¤ 335104
  23          â¤ 7856               87          â¤ 27631        151         â¤ 97175        215         â¤ 341754
  24          â¤ 8012               88          â¤ 28179        152         â¤ 99103        216         â¤ 348535
  25          â¤ 8171               89          â¤ 28738        153         â¤ 101070       217         â¤ 355452
  26          â¤ 8333               90          â¤ 29309        154         â¤ 103076       218         â¤ 362505
  27          â¤ 8499               91          â¤ 29890        155         â¤ 105121       219         â¤ 369699
  28          â¤ 8667               92          â¤ 30483        156         â¤ 107207       220         â¤ 377035
  29          â¤ 8839               93          â¤ 31088        157         â¤ 109335       221         â¤ 384517
  30          â¤ 9015               94          â¤ 31705        158         â¤ 111504       222         â¤ 392147
  31          â¤ 9194               95          â¤ 32334        159         â¤ 113717       223         â¤ 399929
  32          â¤ 9376               96          â¤ 32976        160         â¤ 115973       224         â¤ 407865
  33          â¤ 9562               97          â¤ 33630        161         â¤ 118275       225         â¤ 415959
  34          â¤ 9752               98          â¤ 34298        162         â¤ 120622       226         â¤ 424213
  35          â¤ 9946               99          â¤ 34978        163         â¤ 123016       227         â¤ 432631
  36          â¤ 10143              100         â¤ 35672        164         â¤ 125457       228         â¤ 441216
  37          â¤ 10344              101         â¤ 36380        165         â¤ 127946       229         â¤ 449971
  38          â¤ 10549              102         â¤ 37102        166         â¤ 130485       230         â¤ 458900
  39          â¤ 10759              103         â¤ 37839        167         â¤ 133074       231         â¤ 468007
  40          â¤ 10972              104         â¤ 38589        168         â¤ 135715       232         â¤ 477294
  41          â¤ 11190              105         â¤ 39355        169         â¤ 138408       233         â¤ 486765
  42          â¤ 11412              106         â¤ 40136        170         â¤ 141155       234         â¤ 496425
  43          â¤ 11639              107         â¤ 40933        171         â¤ 143956       235         â¤ 506276
  44          â¤ 11870              108         â¤ 41745        172         â¤ 146813       236         â¤ 516322
  45          â¤ 12105              109         â¤ 42573        173         â¤ 149726       237         â¤ 526568
  46          â¤ 12345              110         â¤ 43418        174         â¤ 152697       238         â¤ 537017
  47          â¤ 12590              111         â¤ 44280        175         â¤ 155727       239         â¤ 547674
  48          â¤ 12840              112         â¤ 45158        176         â¤ 158817       240         â¤ 558542
  49          â¤ 13095              113         â¤ 46055        177         â¤ 161969       241         â¤ 569625
  50          â¤ 13355              114         â¤ 46968        178         â¤ 165183       242         â¤ 580929
  51          â¤ 13620              115         â¤ 47900        179         â¤ 168461       243         â¤ 592457
  52          â¤ 13890              116         â¤ 48851        180         â¤ 171804       244         â¤ 604213
  53          â¤ 14166              117         â¤ 49820        181         â¤ 175213       245         â¤ 616203
  54          â¤ 14447              118         â¤ 50809        182         â¤ 178690       246         â¤ 628431
  55          â¤ 14734              119         â¤ 51817        183         â¤ 182236       247         â¤ 640902
  56          â¤ 15026              120         â¤ 52846        184         â¤ 185852       248         â¤ 653620
  57          â¤ 15324              121         â¤ 53894        185         â¤ 189540       249         â¤ 666590
  58          â¤ 15628              122         â¤ 54964        186         â¤ 193302       250         â¤ 679818
  59          â¤ 15938              123         â¤ 56054        187         â¤ 197137       251         â¤ 693308
  60          â¤ 16255              124         â¤ 57167        188         â¤ 201049       252         â¤ 707066
  61          â¤ 16577              125         â¤ 58301        189         â¤ 205039       253         â¤ 721097
  62          â¤ 16906              126         â¤ 59458        190         â¤ 209108       254         â¤ 735406
  63          â¤ 17242              127         â¤ 60638        191         â¤ 213257       255         â¤ 750000

##### 7.1.1.3.20a.3 Test description {#a.3-test-description .H6}

##### 7.1.1.3.20a.3.1 Pre-test conditions {#a.3.1-pre-test-conditions .H6}

Same Pre-test conditions as in clause 7.1.1.0 with the exception of 2 AM
DRBs on NR cell configured according to Table 7.1.1.3.20a.3.1-1.

Table 7.1.1.3.20a.3.1-1: Logical Channel Configuration Settings

  **Parameter**               **DRB1**                **DRB2**
  --------------------------- ----------------------- -----------------------
  LogicalChannelIdentity      LCH4(DRB-Identity +3)   LCH5(DRB-Identity +3)
  Priority                    7                       6
  prioritizedBitRate          0kbs                    0kbs
  logicalChannelGroup         2 (LCG ID\#2)           1 (LCG ID\#1)
  discardTimer                100ms                   100ms
  remainingTimeThreshold      64ms                    32ms
  additionalBS-TableAllowed   0                       0

##### 7.1.1.3.20a.3.2 Test procedure sequence {#a.3.2-test-procedure-sequence .H6}

Table 7.1.1.3.20a.3.2-1: Main behaviour

  St   Procedure                                                                                                                                                                                             Message Sequence   TP                                           Verdict   
  ---- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------------ -------------------------------------------- --------- ----
                                                                                                                                                                                                             U - S              Message                                                
  1    The SS ignores scheduling requests and does not allocate any uplink grant.                                                                                                                            \-                 \-                                           \-        \-
  2    The SS sends a MAC PDU including an RLC PDU of size 5000 bytes on LCH5 (LCG ID\#1) and RLC PDU of size 4800 bytes on LCH4 (LCG ID\#2).                                                                \<\--              MAC PDU (RLC SDU on LCH5, RLC SDU on LCH4)   \-        \-
  3    20 ms after step 2, the SS sends a MAC PDU including RLC PDU of size 200 bytes on LCH4 (LCG ID\#2).                                                                                                   \<\--              MAC PDU (RLC SDU on LCH4)                    \-        \-
  4    60 ms after step 2, SS transmits an UL Grant of 48 bits, allowing the UE to send a DSR MAC CE.                                                                                                        \<\--              (UL Grant (unknown C-RNTI))                  \-        \-
  5    Check: Does the UE transmit MAC PDU containing an DSR for indicating remaining time, pending data ('Buffer size' field \> '0') and BT indication bit set to 0 for LCGi = 2?                           \--\>              MAC PDU (DSR)                                1         P
  6    80 ms after step 2, SS transmits an UL grant of 48 bits, allowing the UE to send a DSR MAC CE.                                                                                                        \<\--              (UL Grant (unknown C-RNTI))                  \-        \-
  7    Check: Does the UE transmit MAC PDU containing an DSR MAC CE for indicating remaining time, pending data ('Buffer size' field \> '0') and BT indication bit set to 0 for the LCGi = 1 and LCGi = 2?   \--\>              MAC PDU (DSR)                                1         P
  8    SS waits for 100 ms for all discard timers to expire and all buffered data to be discarded.                                                                                                           \-                 \-                                           \-        \-
  9    The SS sends *RRCReconfiguration* including *MAC-CellGroupConfig* with *additionalBS-TableAllowed-r18* set to '1' for LCGi = 1 and LCGi = 2.                                                          \<\--              RRCReconfiguration                           \-        \-
  10   The SS sends a MAC PDU including an RLC PDU of size 800000 bytes on LCH5 (LCG ID\#1) and RLC PDU of size 200 bytes on LCH4 (LCG ID\#2).                                                               \<\--              MAC PDU (RLC SDU on LCH5)                    \-        \-
  11   20 ms after step 10, the SS sends a MAC PDU including RLC PDU of size 200 bytes on LCH4 (LCG ID\#2).                                                                                                  \<\--              MAC PDU (RLC SDU on LCH4)                    \-        \-
  12   60 ms after step 10, SS transmits an UL Grant of 48 bits, allowing the UE to send a DSR MAC CE.                                                                                                       \<\--              (UL Grant (unknown C-RNTI))                  \-        \-
  13   Check: Does the UE transmit MAC PDU containing an DSR for indicating remaining time, pending data ('Buffer size' field \> '0') and BT indication bit set to 0 for LCGi = 2?                           \--\>              MAC PDU (DSR)                                2         P
  14   80 ms after step 10, SS transmits an UL grant of 48 bits, allowing the UE to send a DSR MAC CE.                                                                                                       \<\--              (UL Grant (unknown C-RNTI))                  \-        \-
  15   Check: Does the UE transmit MAC PDU containing an DSR MAC CE for indicating remaining time, pending data ('Buffer size' field \> '0') and BT indication bit set to 0 for the LCGi = 1 and LCGi = 2?   \--\>              MAC PDU (DSR)                                2         P
  16   SS waits for 100 ms for all discard timers to expire and all buffered data to be discarded.                                                                                                           \-                 \-                                           \-        \-
  17   The SS sends a MAC PDU including an RLC PDU of size 5000 bytes on LCH5 (LCG ID\#1) and RLC PDU of size 4500 bytes on LCH4 (LCG ID\#2).                                                                \<\--              MAC PDU (RLC SDU on LCH5, RLC SDU on LCH4)   \-        \-
  18   20 ms after step 17, the SS sends a MAC PDU including RLC PDU of size 400 bytes on LCH4 (LCG ID\#2).                                                                                                  \<\--              MAC PDU (RLC SDU on LCH4)                    \-        \-
  19   60 ms after step 17, SS transmits an UL Grant of 48 bits, allowing the UE to send a DSR MAC CE.                                                                                                       \<\--              (UL Grant (unknown C-RNTI))                  \-        \-
  20   Check: Does the UE transmit MAC PDU containing an DSR for indicating remaining time, pending data ('Buffer size' field \> '0') and BT indication bit set to 1 for LCGi = 2?                           \--\>              MAC PDU (DSR)                                3         P
  21   80 ms after step 17, SS transmits an UL grant of 48 bits, allowing the UE to send a DSR MAC CE.                                                                                                       \<\--              (UL Grant (unknown C-RNTI))                  \-        \-
  22   Check: Does the UE transmit MAC PDU containing an DSR MAC CE for indicating remaining time, pending data ('Buffer size' field \> '0') and BT indication bit set to 1 for the LCGi = 1 and LCGi = 2?   \--\>              MAC PDU (DSR)                                3         P
  23   SS waits for 100 ms for all discard timers to expire and all buffered data to be discarded.                                                                                                           \-                 \-                                           \-        \-

##### 7.1.1.3.20a.3.3 Specific message contents {#a.3.3-specific-message-contents .H6}

Table 7.1.1.3.20a.3.3-1: *RRCReconfiguration (Step 9, table
7.1.1.3.20a.3.2-1)*

  -------------------------------------------------- ----------------- ------------------------- -----------
  Derivation Path: TS 38.508-1 \[6\], clause 4.6.1                                               
  Information Element                                Value/remark      Comment                   Condition
  RRCReconfiguration ::= SEQUENCE {                                                              
  criticalExtensions CHOICE {                                                                    
  rrcReconfiguration SEQUENCE {                                                                  
  nonCriticalExtension SEQUENCE {                                                                
  masterCellGroup                                    CellGroupConfig   Table 7.1.1.3.20a.3.3-2   
  }                                                                                              
  }                                                                                              
  }                                                                                              
  }                                                                                              
  -------------------------------------------------- ----------------- ------------------------- -----------

Table 7.1.1.3.20a.3.3-2: *CellGroupConfig* (Table 7.1.1.3.20a.3.3-1)

  -------------------------------------------------- --------------------- ------------------------- -----------
  Derivation Path: TS 38.508-1 \[6\], clause 4.6.3                                                   
  Information Element                                Value/remark          Comment                   Condition
  CellGroupConfig ::= SEQUENCE {                                                                     
  mac-CellGroupConfig                                MAC-CellGroupConfig   Table 7.1.1.3.20a.3.3-3   
  }                                                                                                  
  -------------------------------------------------- --------------------- ------------------------- -----------

Table 7.1.1.3.20a.3.3-3: MAC-CellGroupConfig (Table 7.1.1.3.20a.3.3-2)

  -------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[6\], clause 4.6.3                            
  Information Element                                Value/remark   Comment   Condition
  MAC-CellGroupConfig ::= SEQUENCE {                                          
  additionalBS-TableAllowed-r18                      '110'B                   
  }                                                                           
  -------------------------------------------------- -------------- --------- -----------

##### 7.1.1.3.21 Correct handling of MAC control information / Delay Status / Triggering scheduling request

##### 7.1.1.3.21.1 Test Purpose (TP) {#test-purpose-tp-25 .H6}

##### (1) {#section-65 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE determines that a DSR has been triggered since the last
transmission of a DSR **and** UE has no UL resources allocated for new
transmission for this TTI }

**then** { UE transmits a scheduling request }

}

##### (2) {#section-66 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE have a pending DSR **and** all the SDUs associated with
the DSR have been discarded when PDCP discardTimer expire }

**then** { UE cancel the pending DSR }

}

##### 7.1.1.3.21.2 Conformance requirements {#conformance-requirements-24 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.321, clause 5.4.9. Unless otherwise stated these are
Rel-18 requirements.

\[TS 38.321, clause 5.4.9\]

The Delay Status Reporting (DSR) procedure is used to provide the
serving gNB with delay status of LCGs. This delay status for an LCG
includes remaining time, which is the smallest remaining value of the
running PDCP *discardTimer*s among PDCP SDUs that are buffered for the
LCG but have not been transmitted in any MAC PDU as specified in clause
7.3 in TS 38.323 \[4\], and the total amount of delay-critical UL data
for the LCG according to the data volume calculation procedure specified
in clause 5.5 in TS 38.322 \[3\] and clause 5.15 in TS 38.323 \[4\] for
the associated RLC and PDCP entities, respectively.

RRC controls the DSR procedure by configuring the following parameter:

\- *remainingTimeThreshold (per LCG)*: the threshold on remaining time
for triggering a DSR for a logical channel within an LCG.

If an LCG is configured for delay status reporting, the MAC entity shall
for each logical channel within the LCG:

1\> if the smallest remaining value of the running PDCP *discardTimer*s
among all the PDCP SDUs buffered for the logical channel that have not
been transmitted in any MAC PDU and have not been reported as data
volume in a DSR MAC CE becomes below *remainingTimeThreshold* of the
LCG; and

> 1\> if there is no DSR pending for the logical channel:

2\> trigger a DSR for the logical channel.

If there is at least one DSR pending, the MAC entity shall:

...

1\> else if there is no pending SR already triggered by the DSR
procedure for the same logical channel as of this DSR:

2\> trigger a Scheduling Request.

NOTE 1: The availability of UL-SCH resources for the transmission of the
DSR MAC CE follows the same criteria specified in clause 5.4.5.

A PDCP SDU is considered to be associated with a DSR if it has not been
transmitted in any MAC PDU and is a delay-critical PDCP SDU (as defined
in TS 38.323 \[4\]) associated with the logical channel which triggered
the DSR.

A MAC PDU shall contain at most one DSR MAC CE. A MAC PDU shall not
contain a DSR MAC CE if it includes all PDCP SDUs associated with all
the pending DSRs.

After a DSR is triggered, it is considered as pending until it is
cancelled. The MAC entity shall cancel a pending DSR, when all the PDCP
SDUs associated with the DSR have been discarded, or when a MAC PDU is
transmitted and this MAC PDU includes a DSR MAC CE that contains the
delay information of all the PDCP SDUs associated with the DSR (as
described in the clause 6.1.3.72), or when a MAC PDU is transmitted and
this MAC PDU includes all the PDCP SDUs associated with the DSR.

NOTE 2: It is up to UE implementation whether the MAC entity includes a
DSR MAC CE in a MAC PDU if the MAC PDU can accommodate all PDCP SDUs
associated with all the pending DSRs but is not sufficient to
additionally accommodate the DSR MAC CE plus its subheader.

##### 7.1.1.3.21.3 Test description {#test-description-24 .H6}

##### 7.1.1.3.21.3.1 Pre-test conditions {#pre-test-conditions-24 .H6}

Same Pre-test conditions as in clause 7.1.1.0 with the exception of 2 AM
DRBs on NR cell configured according to Table 7.1.1.3.21.3.1-1.

Table 7.1.1.3.21.3.1-1: Logical Channel Configuration Settings

  Parameter                DRB1                    DRB2
  ------------------------ ----------------------- -----------------------
  LogicalChannelIdentity   LCH4(DRB-Identity +3)   LCH5(DRB-Identity +3)
  Priority                 7                       6
  prioritizedBitRate       0kbs                    0kbs
  logicalChannelGroup      2 (LCG ID\#2)           1 (LCG ID\#1)
  discardTimer             100ms                   100ms
  remainingTimeThreshold   64ms                    32ms

##### 7.1.1.3.21.3.2 Test procedure sequence {#test-procedure-sequence-24 .H6}

Table 7.1.1.3.21.3.2-1: Main behaviour

  St   Procedure                                                                                                                                                                Message Sequence   TP                                           Verdict   
  ---- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ ------------------ -------------------------------------------- --------- ----
                                                                                                                                                                                U - S              Message                                                
  1    The SS ignores scheduling requests and does not allocate any uplink grant.                                                                                                                                                                         
  2    The SS transmits a MAC PDU including an RLC PDU of size 32 bytes on LCH4 and RLC PDU of size 16 bytes on LCH5.                                                           \<\--              MAC PDU (RLC SDU on LCH4, RLC SDU on LCH5)   \-        \-
  3    Wait for 30 ms after step 2.                                                                                                                                             \-                 \-                                           \-        \-
  4    Check: Does the UE transmit a Scheduling Request on PUCCH?                                                                                                               \--\>              (SR)                                         1         P
  5    Wait for 30 ms after step 4,                                                                                                                                             \-                 \-                                           \-        \-
  6    Check: Does the UE transmit a Scheduling Request on PUCCH?                                                                                                               \--\>              (SR)                                         1         P
  7    Wait for 150 ms after step 2 for discarTimers to expire for LCH4 and LCH5.                                                                                               \-                 \-                                           \-        \-
  8    The SS sends an uplink grant of size 64 bits.                                                                                                                            \<\--              (UL grant)                                   \-        \-
  9    Check: Does the UE transmit MAC PDU containing an DSR MAC CE for indicating remaining time and pending data ('Buffer size' field \> '0') for the LCGi = 1 and LCGi= 2?   \--\>              MAC PDU (DSR)                                2         F

##### 7.1.1.3.21.3.3 Specific message contents {#specific-message-contents-24 .H6}

None.

##### 7.1.1.3.22 to 7.1.1.3.27 

##### 7.1.1.3.28 Correct handling of MAC control information / LTM Cell Switch Command / UL transmission without random access

Editor\'s Note: Steps 9 and 10 needs to be investigated further in the
call flow, /NR-DC to be added to title

##### 7.1.1.3.28.1 Test Purpose (TP) {#test-purpose-tp-26 .H6}

##### (1) {#section-67 .H6}

**with** { **UE in RRC\_Connected state with candidate configuration for
RACH-less LTM** }

**ensure that** {

**when** { **UE receives Candidate Cell TCI States
Activation/Deactivation MAC CE** }

**then** { **UE takes the new TCI state into account at the next
RACH-less LTM cell switch** }

}

##### (2) {#section-68 .H6}

**with** { UE in RRC\_Connected state with candidate configuration for
LTM }

**ensure that** {

**when** { **UE receives LTM Cell Switch Command MAC CE for a MAC entity
associated with SCG** }

**then** { **UE skips the Random Access procedure for the LTM cell
switch** }

}

##### 7.1.1.3.28.2 Conformance requirements {#conformance-requirements-25 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.321, clauses 5.1.1 and 5.18.36. Unless otherwise
stated these are Rel-18 requirements.

\[TS 38.321, clause 5.1.1\]

The Random Access procedure described in this clause is initiated by a
PDCCH order, by the MAC entity itself, or by RRC for the events in
accordance with TS 38.300 \[2\]. There is only one Random Access
procedure ongoing at any point in time in a MAC entity. The Random
Access procedure on an SCell or an LTM candidate cell shall only be
initiated by a PDCCH order with *ra-PreambleIndex* different from
0b000000.

> NOTE 1: If a new Random Access procedure is triggered while another is
> already ongoing in the MAC entity, it is up to UE implementation
> whether to continue with the ongoing procedure or start with the new
> procedure (e.g. for SI request).
>
> NOTE 2: If there was an ongoing Random Access procedure that is
> triggered by a PDCCH order while the UE receives another PDCCH order
> indicating the same Random Access Preamble, PRACH mask index and
> uplink carrier, the Random Access procedure is considered as the same
> Random Access procedure as the ongoing one and not initialized again.

When a Random Access procedure is initiated, UE selects a set of Random
Access resources as specified in clause 5.1.1b and initialises the
following parameters for the Random Access procedure according to the
values configured by RRC for the selected set of Random Access
resources:

> \- *prach-ConfigurationIndex*: the available set of PRACH occasions
> for the transmission of the Random Access Preamble for Msg1. These are
> also applicable to the MSGA PRACH if the PRACH occasions are shared
> between 2-step and 4-step RA types;
>
> \- *prach-ConfigurationPeriodScaling-IAB*: the scaling factor defined
> in TS 38.211 \[8\] and applicable to IAB-MTs, extending the
> periodicity of the PRACH occasions baseline configuration indicated by
> *prach-ConfigurationIndex*;
>
> \- *prach-ConfigurationFrameOffset-IAB*: the frame offset defined in
> TS 38.211 \[8\] and applicable to IAB-MTs, altering the ROs frame
> defined in the baseline configuration indicated by
> *prach-ConfigurationIndex*;
>
> \- *prach-ConfigurationSOffset-IAB*: the subframe/slot offset defined
> in TS 38.211 \[8\] and applicable to IAB-MTs, altering the ROs
> subframe or slot defined in the baseline configuration indicated by
> *prach-ConfigurationIndex*;
>
> \- *msgA-PRACH-ConfigurationIndex*: the available set of PRACH
> occasions for the transmission of the Random Access Preamble for MSGA
> in 2-step RA type;
>
> \- *preambleReceivedTargetPower*: initial Random Access Preamble power
> for 4-step RA type;
>
> \- *msgA-PreambleReceivedTargetPower*: initial Random Access Preamble
> power for 2-step RA type;
>
> \- *rsrp-ThresholdSSB*: an RSRP threshold for the selection of the SSB
> for 4-step RA type. If the Random Access procedure is initiated for
> beam failure recovery, *rsrp-ThresholdSSB* used for the selection of
> the SSB within *candidateBeamRSList* refers to *rsrp-ThresholdSSB* in
> *BeamFailureRecoveryConfig* IE;
>
> \- *rsrp-ThresholdCSI-RS*: an RSRP threshold for the selection of
> CSI-RS for 4-step RA type. If the Random Access procedure is initiated
> for beam failure recovery, *rsrp-ThresholdCSI-RS* is equal to
> *rsrp-ThresholdSSB* in *BeamFailureRecoveryConfig* IE;
>
> \- *msgA-RSRP-ThresholdSSB*: an RSRP threshold for the selection of
> the SSB for 2-step RA type;
>
> \- *rsrp-ThresholdSSB-SUL*: an RSRP threshold for the selection
> between the NUL carrier and the SUL carrier;
>
> *- msgA-RSRP-Threshold*: an RSRP threshold for selection between
> 2-step RA type and 4-step RA type when both 2-step and 4-step RA type
> Random Access Resources are configured in the UL BWP;
>
> *- rsrp-ThresholdMsg1-RepetitionNum2*: an RSRP threshold for Msg1
> repetition with repetition number 2 (see clause 5.1.1b);
>
> *- rsrp-ThresholdMsg1-RepetitionNum4*: an RSRP threshold for Msg1
> repetition with repetition number 4 (see clause 5.1.1b);
>
> *- rsrp-ThresholdMsg1-RepetitionNum8*: an RSRP threshold for Msg1
> repetition with repetition number 8 (see clause 5.1.1b);
>
> *- rsrp-ThresholdMsg3*: an RSRP threshold for Msg3 repetition (see
> clause 5.1.1b);
>
> *- FeatureCombination*: feature or a combination of features
> associated with a set of Random Access resources;
>
> *- featurePriorities*: priorities for features, such as (e)RedCap,
> Slicing, etc. (see clause 5.1.1d);
>
> \- *msgA-TransMax*: The maximum number of MSGA transmissions when both
> 4-step and 2-step RA type Random Access Resources are configured;
>
> \- *candidateBeamRSList*: a list of reference signals (CSI-RS and/or
> SSB) identifying the candidate beams for recovery and the associated
> Random Access parameters;
>
> \- *recoverySearchSpaceId*: the search space identity for monitoring
> the response of the beam failure recovery request;
>
> \- *powerRampingStep*: the power-ramping factor;
>
> \- *msgA-PreamblePowerRampingStep:* the power ramping factor for MSGA
> preamble;
>
> \- *powerRampingStepHighPriority*: the power-ramping factor in case of
> prioritized Random Access procedure;
>
> \- *scalingFactorBI*: a scaling factor for prioritized Random Access
> procedure;
>
> \- *ra-PreambleIndex*: Random Access Preamble;
>
> \- *ra-ssb-OccasionMaskIndex*: defines PRACH occasion(s) associated
> with an SSB in which the MAC entity may transmit a Random Access
> Preamble (see clause 7.4);
>
> \- *msgA-SSB-SharedRO-MaskIndex*: Indicates the subset of 4-step RA
> type PRACH occasions shared with 2-step RA type PRACH occasions for
> each SSB. If 2-step RA type PRACH occasions are shared with 4-step RA
> type PRACH occasions and *msgA-SSB-SharedRO-MaskIndex* is not
> configured, then all 4-step RA type PRACH occasions are available for
> 2-step RA type (see clause 7.4);
>
> \- *ssb-SharedRO-MaskIndex*: defines PRACH occasions, on which
> preambles are allocated for a feature or a combination of features,
> associated with an SSB in which the MAC entity may transmit a Random
> Access Preamble (see clause 7.4);
>
> \- *ra-OccasionList*: defines PRACH occasion(s) associated with a
> CSI-RS in which the MAC entity may transmit a Random Access Preamble;
>
> \- *ra-PreambleStartIndex*: the starting index of Random Access
> Preamble(s) for on-demand SI request;
>
> \- *startPreambleForThisPartition*: the ***first preamble associated
> with the set of Random Access Resources applicable to the Random
> Access procedure***;
>
> \- *preambleTransMax*: the maximum number of Random Access Preamble
> transmission;
>
> \- *preambleTransMax-Msg1-Repetition*: the maximum number of Random
> Access Preamble transmissions with a given Msg1 repetition number
> before switching to Msg1 repetition with the next available higher
> Msg1 repetition number;
>
> \- *ssb-perRACH-OccasionAndCB-PreamblesPerSSB*: defines the number of
> SSBs mapped to each PRACH occasion for 4-step RA type and the number
> of contention-based Random Access Preambles mapped to each SSB;
>
> \- *msgA-CB-PreamblesPerSSB-PerSharedRO*: defines the number of
> contention-based Random Access Preambles for 2-step RA type mapped to
> each SSB when the PRACH occasions are shared between 2-step and 4-step
> RA types;
>
> \- *msgA-SSB-PerRACH-OccasionAndCB-PreamblesPerSSB*: defines the
> number of SSBs mapped to each PRACH occasion for 2-step RA type and
> the number of contention-based Random Access Preambles mapped to each
> SSB;
>
> \- *numberOfPreamblesPerSSB-ForThisPartition*: defines the number of
> ***consecutive preambles for*** a feature or a combination of features
> mapped to each SSB;
>
> \- *msgA-PUSCH-ResourceGroupA*: defines MSGA PUSCH resources that the
> UE shall use when performing MSGA transmission using Random Access
> Preambles group A;
>
> \- *msgA-PUSCH-ResourceGroupB*: defines MSGA PUSCH resources that the
> UE shall use when performing MSGA transmission using Random Access
> Preambles group B;
>
> \- *msgA-PUSCH-Resource-Index*: identifies the index of the PUSCH
> resource used for MSGA in case of contention-free Random Access with
> 2-step RA type;
>
> \- if *groupBconfigured* is configured, then Random Access Preambles
> group B is configured for 4-step RA type.
>
> \- Amongst the contention-based Random Access Preambles associated
> with an SSB (as defined in TS 38.213 \[6\]), the first
> *numberOfRA-PreamblesGroupA included in groupBconfigured* Random
> Access Preambles belong to Random Access Preambles group A. The
> remaining Random Access Preambles associated with the SSB belong to
> Random Access Preambles group B (if configured).
>
> \- if *groupB-ConfiguredTwoStepRA* is configured, then Random Access
> Preambles group B is configured for 2-step RA type.
>
> \- Amongst the contention-based Random Access Preambles for 2-step RA
> type associated with an SSB (as defined in TS 38.213 \[6\]), the first
> *numberOfRA-PreamblesGroupA included in GroupB-ConfiguredTwoStepRA*
> Random Access Preambles belong to Random Access Preambles group A. The
> remaining Random Access Preambles associated with the SSB belong to
> Random Access Preambles group B (if configured).
>
> NOTE 3: If Random Access Preambles group B is supported by the cell
> Random Access Preambles group B is included for each SSB.
>
> \- if Random Access Preambles group B is configured for 4-step RA
> type:
>
> \- *ra-Msg3SizeGroupA*: the threshold to determine the groups of
> Random Access Preambles for 4-step RA type;
>
> \- *msg3-DeltaPreamble*: â*~PREAMBLE\_Msg3~* in TS 38.213 \[6\];
>
> \- *messagePowerOffsetGroupB*: the power offset for preamble selection
> *included in groupBconfigured*;
>
> \- *numberOfRA-PreamblesGroupA*: defines the number of Random Access
> Preambles in Random Access Preamble group A for each SSB *included in
> groupBconfigured*.
>
> \- if Random Access Preambles group B is configured for 2-step RA
> type:
>
> \- *msgA-DeltaPreamble*: â*~MsgA\_PUSCH~* in TS 38.213 \[6\];
>
> \- *messagePowerOffsetGroupB*: the power offset for preamble selection
> included in *GroupB-ConfiguredTwoStepRA*;
>
> \- *numberOfRA-PreamblesGroupA*: defines the number of Random Access
> Preambles in Random Access Preamble group A for each SSB included in
> *GroupB-ConfiguredTwoStepRA*;
>
> \- *ra-MsgA-SizeGroupA*: the threshold to determine the groups of
> Random Access Preambles for 2-step RA type.
>
> \- the set of Random Access Preambles and/or PRACH occasions for SI
> request, if any;
>
> \- the set of Random Access Preambles and/or PRACH occasions for beam
> failure recovery request, if any;
>
> \- the set of Random Access Preambles and/or PRACH occasions for
> reconfiguration with sync, if any;
>
> \- *ra-ResponseWindow*: the time window to monitor RA response(s)
> (SpCell only);
>
> \- *ra-ContentionResolutionTimer*: the Contention Resolution Timer
> (SpCell only);
>
> \- *msgB-ResponseWindow*: the time window to monitor RA response(s)
> for 2-step RA type (SpCell only).

In addition, the following information for related Serving Cell is
assumed to be available for UEs:

> \- if Random Access Preambles group B is configured:
>
> \- if the Serving Cell for the Random Access procedure is configured
> with supplementary uplink as specified in TS 38.331 \[5\], and SUL
> carrier is selected for performing Random Access Procedure:
>
> \- P~CMAX,f,c~ of the SUL carrier as specified in TS 38.101-1 \[14\],
> TS 38.101-2 \[15\], and TS 38.101-3 \[16\].
>
> \- else:
>
> \- P~CMAX,f,c~ of the NUL carrier as specified in TS 38.101-1 \[14\],
> TS 38.101-2 \[15\], and TS 38.101-3 \[16\].

The following UE variables are used for the Random Access procedure:

> \- *PREAMBLE\_INDEX*;
>
> \- *PREAMBLE\_TRANSMISSION\_COUNTER*;
>
> \- *PREAMBLE\_POWER\_RAMPING\_COUNTER*;
>
> \- *PREAMBLE\_POWER\_RAMPING\_STEP*;
>
> \- *PREAMBLE\_RECEIVED\_TARGET\_POWER*;
>
> \- *PREAMBLE\_BACKOFF*;
>
> \- *PCMAX*;
>
> \- *SCALING\_FACTOR\_BI*;
>
> \- *TEMPORARY\_C-RNTI*;
>
> \- *RA\_TYPE*;
>
> \- *POWER\_OFFSET\_2STEP\_RA*;
>
> \- *MSGA\_PREAMBLE\_POWER\_RAMPING\_STEP*.

When the Random Access procedure is initiated on a Serving Cell or for
an LTM candidate cell, the MAC entity shall:

> 1\> flush the Msg3 buffer;
>
> 1\> flush the MSGA buffer;
>
> 1\> set the *PREAMBLE\_TRANSMISSION\_COUNTER* to 1;
>
> 1\> if the Random Access procedure is initiated on a Serving Cell; or
>
> 1\> if the Random Access procedure is initiated by the PDCCH order for
> an LTM candidate cell and the PDCCH order indicates preamble initial
> transmission; or
>
> 1\> if the Random Access procedure is initiated by the PDCCH order for
> an LTM candidate cell, which is different from the cell to which the
> UE performed the last Random Access Preamble transmission, and the
> PDCCH order indicates preamble re-transmission:
>
> 2\> set the *PREAMBLE\_POWER\_RAMPING\_COUNTER* to 1;
>
> 1\> set the *PREAMBLE\_BACKOFF* to 0 ms;
>
> 1\> set *POWER\_OFFSET\_2STEP\_RA* to 0 dB;
>
> 1\> if the carrier to use for the Random Access procedure is
> explicitly signalled:
>
> 2\> select the signalled carrier for performing Random Access
> procedure;
>
> 2\> set the *PCMAX* to P~CMAX,f,c~ of the signalled carrier.
>
> 1\> else if the carrier to use for the Random Access procedure is not
> explicitly signalled; and
>
> 1\> if the Serving Cell for the Random Access procedure is configured
> with supplementary uplink as specified in TS 38.331 \[5\]; and
>
> 1\> if the RSRP of the downlink pathloss reference is less than
> *rsrp-ThresholdSSB-SUL*:
>
> 2\> select the SUL carrier for performing Random Access procedure;
>
> 2\> set the *PCMAX* to P~CMAX,f,c~ of the SUL carrier.
>
> 1\> else:
>
> 2\> select the NUL carrier for performing Random Access procedure;
>
> 2\> set the *PCMAX* to P~CMAX,f,c~ of the NUL carrier.
>
> NOTE 4: Void.
>
> 1\> perform the BWP operation as specified in clause 5.15, except when
> the Random Access procedure is initiated by the PDCCH order for an LTM
> candidate cell;
>
> 1\> select the set of Random Access resources applicable to the
> current Random Access procedure according to clause 5.1.1b;
>
> 1\> if the Random Access procedure is initiated by PDCCH order and if
> the *ra-PreambleIndex* explicitly provided by PDCCH is not 0b000000;
> or
>
> 1\> if the Random Access procedure was initiated for SI request (as
> specified in TS 38.331 \[5\]) and the Random Access Resources for SI
> request have been explicitly provided by RRC; or
>
> 1\> if the Random Access procedure was initiated for SpCell beam
> failure recovery (as specified in clause 5.17) and if the
> contention-free Random Access Resources for beam failure recovery
> request for 4-step RA type have been explicitly provided by RRC for
> the BWP selected for Random Access procedure; or
>
> 1\> if the Random Access procedure was initiated for reconfiguration
> with sync not initiated for recovery using an LTM candidate
> configuration as specified in TS 38.331 \[5\] clause 5.3.7.3 and if
> the contention-free Random Access Resources for 4-step RA type have
> been explicitly provided in *rach-ConfigDedicated* for the BWP
> selected for Random Access procedure; or
>
> 1\> if the contention-free Random Access Resources have been
> explicitly provided in the LTM Cell Switch Command MAC CE:
>
> 2\> set the *RA\_TYPE* to *4-stepRA*.
>
> 1\> else if the BWP selected for Random Access procedure is configured
> with both 2-step and 4-step RA type Random Access Resources within the
> selected set of Random Access resources (as specified in clause
> 5.1.1b) and the RSRP of the downlink pathloss reference is above
> *msgA-RSRP-Threshold*; or
>
> 1\> if the BWP selected for Random Access procedure is only configured
> with 2-step RA type Random Access resources within the selected set of
> Random Access resources according to clause 5.1.1b; or
>
> 1\> if the Random Access procedure was initiated for reconfiguration
> with sync not initiated for recovery using an LTM candidate
> configuration as specified in TS 38.331 \[5\] clause 5.3.7.3 and if
> the contention-free Random Access Resources for 2-step RA type have
> been explicitly provided in *rach-ConfigDedicated* for the BWP
> selected for Random Access procedure:
>
> 2\> set the *RA\_TYPE* to *2-stepRA*.
>
> 1\> else:
>
> 2\> set the *RA\_TYPE* to *4-stepRA*.
>
> 1\> perform initialization of variables specific to Random Access type
> as specified in clause 5.1.1a;
>
> 1\> if *RA\_TYPE* is set to *2-stepRA*:
>
> 2\> perform the Random Access Resource selection procedure for 2-step
> RA type (see clause 5.1.2a).
>
> 1\> else:
>
> 2\> perform the Random Access Resource selection procedure (see clause
> 5.1.2).

\[TS 38.321, clause 5.18.35\]

The network may instruct the UE to perform LTM cell switch procedure by
sending the LTM Cell Switch Command MAC CE described in clause 6.1.3.75.

The MAC entity shall:

> 1\> if the MAC entity receives an LTM Cell Switch Command MAC CE on a
> Serving Cell:
>
> 2\> indicate to upper layers that the LTM cell switch procedure is
> triggered and the Target Configuration ID included in the LTM Cell
> Switch Command MAC CE;
>
> 2\> if the MAC reset operation as specified in clause 5.12 is
> performed, as requested by upper layers:
>
> 3\> if Timing Advance Command value (hexa-decimal) is not set as FFF:
>
> 4\> process the received Timing Advance Command (see clause 5.2);
>
> 4\> consider the RACH-less LTM cell switch to be ongoing;
>
> 4\> if the MAC entity is associated with the SCG:
>
> 5\> indicate to upper layers to skip the Random Access procedure for
> this LTM cell switch.
>
> 3\> else if the UE is configured with UE-based Timing Advance
> measurement as specified in TS 38.331 \[5\] and the UE has
> successfully measured the Timing Advance for the SpCell of the
> indicated LTM target configuration:
>
> 4\> process the measured Timing Advance (see clause 5.2);
>
> 4\> consider the RACH-less LTM cell switch to be ongoing.
>
> 4\> if the MAC entity is associated with the SCG:
>
> 5\> indicate to upper layers to skip the Random Access procedure for
> this LTM cell switch.
>
> 3\> indicate to lower layers the information regarding the TCI state
> information included in the LTM Cell Switch Command MAC CE.

\[TS 38.321, clause 6.1.3.75\]

The LTM Cell Switch Command MAC CE is identified by MAC subheader with
eLCID as specified in Table 6.2.1-1b. It has a variable size with
following fields (Figure 6.1.3.75-1):

> \- R: Reserved bit, set to 0;
>
> \- Target Configuration ID: This field indicates the index of
> candidate target configuration to apply for LTM cell switch,
> corresponding to *ltm-CandidateId minus 1* as specified in TS 38.331
> \[5\]. The length of the field is 3 bits;
>
> \- Timing Advance Command: This field indicates whether the TA is
> valid for the LTM target cell (i.e. the SpCell corresponding to the
> target configuration indicated by Target Configuration ID field). If
> the value of this field is set to FFF, this field indicates that no
> valid timing adjustment is available for the PTAG of the LTM target
> cell; otherwise, this field indicates the index value *T~A~* used to
> control the amount of timing adjustment that the MAC entity has to
> apply in TS 38.213 \[6\], and that the UE can skip the Random Access
> procedure for this LTM cell switch. If *tag-Id-ptr* is configured for
> the TCI state indicated by the UL TCI state ID field, if present, or
> by the TCI state ID field otherwise, in the LTM target cell and
> *tag-Id-ptr* is set to value *n1*, this field indicates the TA for the
> TAG indicated by the *tag2-Id* of the LTM target cell; otherwise, this
> field indicates the TA for the TAG indicated by the *tag-id* of the
> LTM target cell. The length of the field is 12 bits;
>
> \- TCI state ID: This field indicates and activates the TCI state for
> the LTM target cell (i.e. the SpCell of the target configuration
> indicated by the Target Configuration ID field). The TCI state is
> identified by *TCI-StateId* in *ltm-DL-OrJointTCI-StateToAddModList*
> as specified in TS 38.331 \[5\]. If the value of
> *unifiedTCI-StateType* in the *ltm-TCI-Info* of the configuration
> indicated by Target Configuration ID field is *joint*, this field is
> for joint TCI state, otherwise, this field is for downlink TCI state.
> The length of the field is 7 bits;
>
> \- UL TCI state ID: This field indicates and activates the uplink TCI
> state for the LTM target cell (i.e. the SpCell of the target
> configuration indicated by the Target Configuration ID field). The UL
> TCI state is identified by *TCI-UL-StateId* in
> *ltm-UL-TCI-StateToAddModList* as specified in TS 38.331 \[5\]. The
> octet containing this field (i.e. this field and the two reserved bits
> in the same octet) is included if the value of *unifiedTCI-StateType*
> in the *ltm-TCI-Info* of the configuration indicated by Target
> Configuration ID field is *separate*. The length of the field is 6
> bits;
>
> \- C: This field indicates the presence of the contention-free Random
> Access Resources fields. If the value of this field is set to 1, the
> following fields are present: Random Access Preamble index field, S/U
> field, SS/PBCH index field, PRACH Mask index field, Repetition number
> field and the reserved bits in the same octet. If the value of this
> field is set to 0, these fields are absent.
>
> \- S/U: This field indicates which UL carrier to transmit the PRACH of
> the contention-free Random Access Resources. If the value of this
> field is set to 1, SUL is used; otherwise, NUL is used. The length of
> the field is 1 bit;
>
> \- Random Access Preamble index: This field indicates the Random
> Access Preamble index of the contention-free Random Access Resources.
> This field should not be set to 0b000000. The length of the field is 6
> bits;
>
> \- SS/PBCH index: This field indicates the SS/PBCH that shall be used
> to determine the RACH occasion for the PRACH transmission of the
> contention-free Random Access Resources. The length of the field is 6
> bits;
>
> \- PRACH Mask index: This field indicates the RACH occasion(s)
> associated with the SS/PBCH indicated by \'SS/PBCH index\' for the
> PRACH transmission of the contention-free Random Access Resources. It
> indicates a subset of RACH occasion(s) from the *rach-ConfigDedicated*
> for the UL carrier (indicated by S/U field), (if provided, otherwise
> it indicates a subset of RACH occasion(s) from the *rach-ConfigCommon*
> for the UL carrier (indicated by S/U field) in the UL BWP
> configuration of *firstActiveUplinkBWP-Id* as specified in TS 38.331
> \[5\]. When the repetition number field is not set to 0, the UE
> ignores this field. The length of the field is 4 bits;
>
> \- Repetition number: This field indicates the Msg1 repetition number
> to be applied to the contention-free Random Access. If this field is
> set to 0, Msg1 repetition number does not apply. If this field is set
> to 1, the Msg1 repetition number is 2. If this field is set to 2, the
> Msg1 repetition number is 4. If this field is set to 3, the Msg1
> repetition number is 8. The length of the field is 2 bits.

NOTE 1: Void

Figure 6.1.3.75-1: LTM Cell Switch Command MAC CE

NOTE 2: If UE receives the LTM Cell Switch Command MAC CE with a Target
Configuration ID value not matching any configured *ltm-CandidateId*
minus 1, as specified in TS 38.331 \[5\], the procedure of handling LTM
Cell Switch Command MAC CE in clause 5.18.35 does not apply.

\[TS 38.321, clause 5.18.36\]

The network may activate and deactivate the TCI states of LTM candidate
cell(s) configured in *CandidateTCI-State and CandidateTCI-UL-State* by
sending the Candidate Cell TCI States Activation/Deactivation MAC CE
described in clause 6.1.3.76. The network deactivates the TCI state(s)
for one LTM candidate cell by not including the corresponding TCI state
ID field(s) in the Candidate Cell TCI States Activation/Deactivation MAC
CE. The configured candidate cell TCI states are initially deactivated
upon (re-)configuration by upper layer and after reconfiguration with
sync that is not triggered by LTM.

The MAC entity shall:

> 1\> if the MAC entity receives a Candidate Cell TCI States
> Activation/Deactivation MAC CE on a Serving Cell:
>
> 2\> indicate to lower layers the information regarding the Candidate
> Cell TCI States Activation/Deactivation MAC CE.

\[TS 38.331, clause 5.3.5.3\]

The UE shall perform the following actions upon reception of the
*RRCReconfiguration,* upon execution of the conditional reconfiguration
(CHO, CPA, CPC, or subsequent CPAC), or upon execution of an LTM cell
switch:

> ...
>
> 1\>Â  if the *RRCReconfiguration* message includes the *ltm-Config*:
>
> 2\> if the *ltm-Config* is set to *setup*:
>
> 3\>Â  perform the LTM configuration procedure as specified in
> 5.3.5.18.1;
>
> ...
>
> 1\>Â  set the content of the *RRCReconfigurationComplete* message as
> follows:
>
> ...
>
> 2\> if this *RRCReconfiguration* message is applied due to an LTM cell
> switch execution procedure according to clause 5.3.5.18.6:
>
> 3\>Â  include in the *appliedLTM-CandidateId* the *LTM-CandidateId* of
> the applied LTM candidate configuration;
>
> ...
>
> 1\>Â  else if the *RRCReconfiguration* message was received via SRB1
> within the *nr-SCG* within *mrdc-SecondaryCellGroup* (UE in NR-DC,
> *mrdc-SecondaryCellGroup* was received in *RRCReconfiguration* or
> *RRCResume* via SRB1):
>
> 2\> if the *RRCReconfiguration* is applied due to a conditional
> reconfiguration execution for CPC or subsequent CPAC which is
> configured via *conditionalReconfiguration* contained in *nr-SCG*
> within *mrdc-SecondaryCellGroup*; or
>
> 2\> if the *RRCReconfiguration* is applied due to an LTM cell switch
> execution:
>
> 3\>Â  submit the *RRCReconfigurationComplete* message via *SRB1*
> embedded in NR RRC message *ULInformationTransferMRDC* as specified in
> clause 5.7.2a.3.
>
> ...
>
> 1\>Â  else if the *RRCReconfiguration* message was received via SRB3
> (UE in NR-DC):
>
> 2\> if the *RRCReconfiguration* message was received within
> *DLInformationTransferMRDC*:
>
> 3\>Â  if the *RRCReconfiguration* message was received within the
> *nr-SCG* within *mrdc-SecondaryCellGroup* (NR SCG RRC
> Reconfiguration):
>
> ...
>
> 4\>Â  submit the *RRCReconfigurationComplete* message via SRB1 to lower
> layers for transmission using the new configuration;
>
> 2\> else:
>
> ...
>
> 3\>Â  submit the *RRCReconfigurationComplete* message via SRB3 to lower
> layers for transmission using the new configuration;
>
> 1\>Â  else (*RRCReconfiguration* was received via SRB1):
>
> 2\> if the UE is in NR-DC and;
>
> ...
>
> 2\> submit the *RRCReconfigurationComplete* message via SRB1 to lower
> layers for transmission using the new configuration;
>
> ...

##### 7.1.1.3.28.3 Test description {#test-description-25 .H6}

##### 7.1.1.3.28.3.1 Pre-test conditions {#pre-test-conditions-25 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that System
information combination NR-2 and in addition NR Cell 10 is configured as
NR PSCell.

##### System Simulator: {#system-simulator-2 .H6}

\- NR Cell 1 is the PCell, NR Cell 10 is the source PSCell and NR Cell
28 is Neighbour Cell of the PSCell.

##### 7.1.1.3.28.3.2 Test procedure sequence {#test-procedure-sequence-25 .H6}

Table 7.1.1.3.28.3.2-1 and 7.1.1.3.28.3.2-2 illustrates the downlink
power levels to be applied for NR Cell 1 and NR Cell 28 at various time
instants of the test execution. Row marked \"T0\" denotes the conditions
after the preamble, while the configuration marked \"T1\" and \"T2\",
are applied at the point indicated in the Main behaviour description in
Table 7.1.1.3.28.3.2-3.

Table 7.1.1.3.28.3.2-1: Time instances of cell power level and parameter
changes for conducted test environment

+----+----------+------+----------+---------+---------+----------+
|    | P        | Unit | NR Cell  | NR      | NR      | Remark   |
|    | arameter |      | 1        |         |         |          |
|    |          |      |          | Cell 10 | Cell 28 |          |
+====+==========+======+==========+=========+=========+==========+
| T0 | SS/PBCH  | dBm/ | -82      | -85     | -91     | Power    |
|    | SSS EPRE |      |          |         |         | levels   |
|    |          | SCS  |          |         |         | are such |
|    |          |      |          |         |         | that     |
|    |          |      |          |         |         | entry    |
|    |          |      |          |         |         | c        |
|    |          |      |          |         |         | ondition |
|    |          |      |          |         |         | for      |
|    |          |      |          |         |         | event A3 |
|    |          |      |          |         |         | is not   |
|    |          |      |          |         |         | s        |
|    |          |      |          |         |         | atisfied |
|    |          |      |          |         |         | for the  |
|    |          |      |          |         |         | n        |
|    |          |      |          |         |         | eighbour |
|    |          |      |          |         |         | NR cell  |
|    |          |      |          |         |         |          |
|    |          |      |          |         |         | ![](.    |
|    |          |      |          |         |         | /media/i |
|    |          |      |          |         |         | mage51.w |
|    |          |      |          |         |         | mf){widt |
|    |          |      |          |         |         | h="2.364 |
|    |          |      |          |         |         | 58333333 |
|    |          |      |          |         |         | 33335in" |
|    |          |      |          |         |         | height=  |
|    |          |      |          |         |         | "0.17708 |
|    |          |      |          |         |         | 33333333 |
|    |          |      |          |         |         | 3334in"} |
+----+----------+------+----------+---------+---------+----------+
| T1 | SS/PBCH  | dBm/ | -82      | -85     | -79     | Power    |
|    | SSS EPRE |      |          |         |         | levels   |
|    |          | SCS  |          |         |         | are such |
|    |          |      |          |         |         | that     |
|    |          |      |          |         |         | entry    |
|    |          |      |          |         |         | c        |
|    |          |      |          |         |         | ondition |
|    |          |      |          |         |         | for      |
|    |          |      |          |         |         | event A3 |
|    |          |      |          |         |         | is       |
|    |          |      |          |         |         | s        |
|    |          |      |          |         |         | atisfied |
|    |          |      |          |         |         | for      |
|    |          |      |          |         |         | inter-f  |
|    |          |      |          |         |         | requency |
|    |          |      |          |         |         | n        |
|    |          |      |          |         |         | eighbour |
|    |          |      |          |         |         | NR cell  |
|    |          |      |          |         |         |          |
|    |          |      |          |         |         | ![](.    |
|    |          |      |          |         |         | /media/i |
|    |          |      |          |         |         | mage51.w |
|    |          |      |          |         |         | mf){widt |
|    |          |      |          |         |         | h="2.364 |
|    |          |      |          |         |         | 58333333 |
|    |          |      |          |         |         | 33335in" |
|    |          |      |          |         |         | height=  |
|    |          |      |          |         |         | "0.17708 |
|    |          |      |          |         |         | 33333333 |
|    |          |      |          |         |         | 3334in"} |
+----+----------+------+----------+---------+---------+----------+

Table 7.1.1.3.28.3.2-2: Time instances of cell power level and parameter
changes for OTA test environment

+----+----------+------+----------+---------+---------+----------+
|    | P        | Unit | NR Cell  | NR      | NR      | Remark   |
|    | arameter |      | 1        |         |         |          |
|    |          |      |          | Cell 10 | Cell 28 |          |
+====+==========+======+==========+=========+=========+==========+
| T0 | SS/PBCH  | dBm/ | -82      | -91     | -100    | Power    |
|    | SSS EPRE |      |          |         |         | levels   |
|    |          | SCS  |          |         |         | are such |
|    |          |      |          |         |         | that     |
|    |          |      |          |         |         | entry    |
|    |          |      |          |         |         | c        |
|    |          |      |          |         |         | ondition |
|    |          |      |          |         |         | for      |
|    |          |      |          |         |         | event A3 |
|    |          |      |          |         |         | is not   |
|    |          |      |          |         |         | s        |
|    |          |      |          |         |         | atisfied |
|    |          |      |          |         |         | for the  |
|    |          |      |          |         |         | n        |
|    |          |      |          |         |         | eighbour |
|    |          |      |          |         |         | NR cell  |
|    |          |      |          |         |         |          |
|    |          |      |          |         |         | !        |
|    |          |      |          |         |         | [](./med |
|    |          |      |          |         |         | ia/image |
|    |          |      |          |         |         | 52.wmf){ |
|    |          |      |          |         |         | width="2 |
|    |          |      |          |         |         | .3125in" |
|    |          |      |          |         |         | he       |
|    |          |      |          |         |         | ight="0. |
|    |          |      |          |         |         | 1875in"} |
+----+----------+------+----------+---------+---------+----------+
| T1 | SS/PBCH  | dBm/ | -82      | -91     | -82     | Power    |
|    | SSS EPRE |      |          |         |         | levels   |
|    |          | SCS  |          |         |         | are such |
|    |          |      |          |         |         | that     |
|    |          |      |          |         |         | entry    |
|    |          |      |          |         |         | c        |
|    |          |      |          |         |         | ondition |
|    |          |      |          |         |         | for      |
|    |          |      |          |         |         | event A3 |
|    |          |      |          |         |         | is       |
|    |          |      |          |         |         | s        |
|    |          |      |          |         |         | atisfied |
|    |          |      |          |         |         | for      |
|    |          |      |          |         |         | inter-f  |
|    |          |      |          |         |         | requency |
|    |          |      |          |         |         | n        |
|    |          |      |          |         |         | eighbour |
|    |          |      |          |         |         | NR cell  |
|    |          |      |          |         |         |          |
|    |          |      |          |         |         | ![](.    |
|    |          |      |          |         |         | /media/i |
|    |          |      |          |         |         | mage51.w |
|    |          |      |          |         |         | mf){widt |
|    |          |      |          |         |         | h="2.364 |
|    |          |      |          |         |         | 58333333 |
|    |          |      |          |         |         | 33335in" |
|    |          |      |          |         |         | height=  |
|    |          |      |          |         |         | "0.17708 |
|    |          |      |          |         |         | 33333333 |
|    |          |      |          |         |         | 3334in"} |
+----+----------+------+----------+---------+---------+----------+

Table 7.1.1.3.28.3.2-3: Main behaviour

  **St**   **Procedure**                                                                                                                                                         **Message Sequence**   **TP**                                                        **Verdict**   
  -------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------- ------------------------------------------------------------- ------------- ----
                                                                                                                                                                                 **U - S**              **Message**                                                                 
  1        The SS transmits an *RRCReconfiguration* message *including MeasConfig* to setup NR measurement and reporting for inter-frequency event A3 on NR Cell 1.              \<\--                  RRCReconfiguration                                            \-            \-
  2        **The UE transmits an *RRCReconfigurationComplete* message.**                                                                                                         \--\>                  RRCReconfigurationComplete                                    \-            \-
  3        **SS re-adjusts the cell-specific reference signal level according to row \"T1\" in table 7.1.1.3.28.3.2-1/2.**                                                       \-                     \-                                                            \-            \-
  4        **The UE transmits a *MeasurementReport* message to report event A3 with the measured RSRP value for NR Cell 28 in NR Cell 1.**                                       \--\>                  MeasurementReport                                             \-            \-
  5        The SS transmits an RRCReconfiguration message with LTM-Candidate-r18 for NR Cell 28 on NR Cell 1.                                                                    \<\--                  RRCReconfiguration                                            \-            \-
  6        The UE transmits RRCReconfigurationComplete message.                                                                                                                  \--\>                  RRCReconfigurationComplete                                    \-            \-
  7        The SS transmits the candidate cell TCI activation MAC CE with Candidate Cell ID set to 0 for NR Cell 28 on NR Cell 1.                                                \<\--                  MAC PDU (Candidate Cell TCI Activation/Deactivation MAC CE)                 
  8        The SS transmits LTM cell switch command MAC CE with Timing Advance Command value set to 0 and SCG of Target Configuration ID value set to 0 on NR Cell1 to the UE.   \<\--                  MAC PDU (LTM Cell Switch Command MAC CE)                      \-            \-
  9        The SS transmits an UL Grant, allowing the UE to transmit the RRCReconfigurationComplete message on NR Cell 28.                                                       \<\--                  UL grant (C-RNTI)                                             \-            \-
  10       Check: Does the UE transmit RRCReconfigurationComplete message in NR Cell 28?                                                                                         \--\>                  RRCReconfigurationComplete                                    1             P
  11       The SS transmits a downlink assignment addressed to the C-RNTI assigned to the UE on NR Cell 28                                                                       \<\--                  PDCCH (C-RNTI)                                                \-            \-
  12       The SS transmits in the indicated downlink assignment a MAC PDU including a RLC PDU with poll bit not set on NR Cell 28.                                              \<\--                  MAC PDU                                                       \-            \-
  13       Check: Does the UE transmit an HARQ ACK on PUCCH?                                                                                                                     \--\>                  HARQ ACK                                                      2             P

##### 7.1.1.1.3.28.3.3 Specific message contents {#specific-message-contents-25 .H6}

Table 7.1.1.3.28.3.3-1: *RRCReconfiguration* (step 1, Table
7.1.1.3.28.3.2-3)

  ---------------------------------------------------------------------------
  Derivation Path: TS 38.508-1 \[4\] Table 4.6.1-13 with condition NR\_MEAS
  ---------------------------------------------------------------------------

Table 7.1.1.3.28.3.3-2: *MeasConfig* (step 1, Table 7.1.1.3.28.3.2-3)

  ------------------------------------------------------------------------------------------ ------------------------ ------------------------ ---------------
  Derivation Path: TS 38.508-1 \[4\] Table 4.6.3-69                                                                                            
  **Information Element**                                                                    **Value/remark**         **Comment**              **Condition**
  MeasConfig ::= SEQUENCE {                                                                                                                    
  measObjectToAddModList SEQUENCE (SIZE (1..maxNrofMeasId)) OF MeasObjectToAddMod {          1 entry                                           
  MeasObjectToAddMod\[1\] SEQUENCE {                                                                                  entry 1                  
  measObjectId                                                                               1                                                 
  measObject CHOICE {                                                                                                                          
  measObjectNR                                                                               MeasObjectNR             Table 7.1.1.3.28.3.3-3   
  }                                                                                                                                            
  }                                                                                                                                            
  }                                                                                                                                            
  reportConfigToAddModList SEQUENCE(SIZE (1..maxReportConfigId)) OF ReportConfigToAddMod {   1 entry                                           
  ReportConfigToAddMod\[1\] SEQUENCE {                                                                                entry 1                  
  reportConfigId                                                                             1                                                 
  reportConfig CHOICE {                                                                                                                        
  reportConfigNR                                                                             ReportConfigNR-EventA3   Table 7.1.1.3.28.3.3-4   
  }                                                                                                                                            
  }                                                                                                                                            
  }                                                                                                                                            
  measIdToAddModList SEQUENCE (SIZE (1..maxNrofMeasId)) OF MeasIdToAddMod {                  1 entry                                           
  MeasIdToAddMod\[1\] SEQUENCE {                                                                                      entry 1                  
  measId                                                                                     1                                                 
  measObjectId                                                                               1                                                 
  reportConfigId                                                                             1                                                 
  }                                                                                                                                            
  }                                                                                                                                            
  }                                                                                                                                            
  ------------------------------------------------------------------------------------------ ------------------------ ------------------------ ---------------

Table 7.1.1.3.28.3.3-3: *MeasObjectNR* (Table 7.1.1.3.28.3.3-2)

  ---------------------------------------------------- ------------------------------------- ------------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-76                                                       
  **Information Element**                              **Value/remark**                      **Comment**   **Condition**
  MeasObjectNR::= SEQUENCE {                                                                               
  ssbFrequency                                         ARFCN-ValueNR for SSB of NR Cell 28                 
  absThreshSS-BlocksConsolidation                      Not present                                         
  nrofSS-BlocksToAverage                               Not present                                         
  }                                                                                                        
  ---------------------------------------------------- ------------------------------------- ------------- ---------------

Table 7.1.1.3.28.3.3-4: *ReportConfigNR-EventA3* (Table
7.1.1.3.28.3.3-2)

  ----------------------------------------------------------------------------- ------------------ ----------------- ---------------
  Derivation Path: TS 38.508-1 \[4\] Table 4.6.3-142 with condition EVENT\_A3                                        
  **Information Element**                                                       **Value/remark**   **Comment**       **Condition**
  ReportConfigNR ::= SEQUENCE {                                                                                      
  reportType CHOICE {                                                                                                
  eventTriggered SEQUENCE {                                                                                          
  eventId CHOICE {                                                                                                   
  eventA3 SEQUENCE {                                                                                                 
  a3-Offset CHOICE {                                                                                                 
  rsrp                                                                          2                  1 dB(2\*0.5 dB)   
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  reportAmount                                                                  infinity                             
  maxNrofRS-IndexesToReport                                                     1                                    
  includeBeamMeasurements                                                       true                                 
  reportQuantityCell SEQUENCE {                                                                                      
  rsrp                                                                          true                                 
  rsrq                                                                          false                                
  sinr                                                                          false                                
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  ----------------------------------------------------------------------------- ------------------ ----------------- ---------------

Table 7.1.1.3.28.3.3-5: *MeasurementReport* (step 4, Table
7.1.1.3.28.3.2-3)

  ---------------------------------------------------------------------------------------- -------------------------------------------- ------------- --------------------
  Derivation Path: TS 38.508-1 \[4\] Table 4.6.1-5A                                                                                                   
  **Information Element**                                                                  **Value/remark**                             **Comment**   **Condition**
  MeasurementReport ::= SEQUENCE {                                                                                                                    
  criticalExtensions CHOICE {                                                                                                                         
  measurementReport SEQUENCE {                                                                                                                        
  measResults SEQUENCE {                                                                                                                              
  measId                                                                                   1                                                          
  measResultServingMOList SEQUENCE (SIZE (1..maxNrofServingCells)) OF MeasResultServMO {   1 entry                                                    
  MeasResultServMO\[1\] SEQUENCE {                                                                                                      entry 1       
  servCellId                                                                               ServCellIndex of NR Cell 1                                 Step 4
  measResultServingCell SEQUENCE {                                                                                                                    
  physCellId                                                                               PCI of NR Cell 1                                           Step 4
  measResult SEQUENCE {                                                                                                                               
  cellResults SEQUENCE {                                                                                                                              
  resultsSSB-Cell SEQUENCE {                                                                                                                          
  rsrp                                                                                     (0..127)                                                   
  rsrq                                                                                     (0..127)                                                   
  sinr                                                                                     Not present                                                
                                                                                           Not checked                                                pc\_ss\_SINR\_Meas
  }                                                                                                                                                   
  }                                                                                                                                                   
  }                                                                                                                                                   
  }                                                                                                                                                   
  }                                                                                                                                                   
  }                                                                                                                                                   
  measResultNeighCells CHOICE {                                                                                                                       
  measResultListNR SEQUENCE (SIZE (1.. maxCellReport)) OF MeasResultNR {                   1 entry                                                    
  MeasResultNR\[1\] SEQUENCE {                                                                                                          entry 1       
  physCellId                                                                               Physical layer cell identity of NR Cell 28                 Step 4
  measResult SEQUENCE {                                                                                                                               
  cellResults SEQUENCE {                                                                                                                              
  resultsSSB-Cell SEQUENCE {                                                                                                                          
  rsrp                                                                                     (0..127)                                                   
  rsrq                                                                                     Not present                                                
  sinr                                                                                     Not present                                                
  }                                                                                                                                                   
  resultsCSI-RS-Cell                                                                       Not present                                                
  }                                                                                                                                                   
  rsIndexResults                                                                           Not present                                                
  }                                                                                                                                                   
  cgi-Info                                                                                 Not present                                                
  }                                                                                                                                                   
  }                                                                                                                                                   
  }                                                                                                                                                   
  }                                                                                                                                                   
  }                                                                                                                                                   
  }                                                                                                                                                   
  }                                                                                                                                                   
  ---------------------------------------------------------------------------------------- -------------------------------------------- ------------- --------------------

Table 7.1.1.3.28.3.3-6: RRCReconfiguration (step 5, Table
7.1.1.3.28.3.2-3)

  --------------------------------------------------------------------------------- ------------------ ------------------------ ---------------
  Derivation path: TS 38.508-1 \[4\], Table 4.6.1-13 with condition NR-DC and LTM                                               
  **Information Element**                                                           **Value/remark**   **Comment**              **Condition**
  RRCReconfiguration ::= SEQUENCE {                                                                                             
  criticalExtensions CHOICE {                                                                                                   
  rrcReconfiguration SEQUENCE {                                                                                                 
  nonCriticalExtension SEQUENCE {                                                                                               
  nonCriticalExtension SEQUENCE {                                                                                               
  masterCellGroup                                                                   Not present                                 
  nonCriticalExtension SEQUENCE {                                                                                               
  nonCriticalExtension SEQUENCE {                                                                                               
  nonCriticalExtension SEQUENCE {                                                                                               
  nonCriticalExtension SEQUENCE {                                                                                               
  ltm-Config-r18 CHOICE {                                                                                                       
  setup                                                                             LTM-Config-r18     Table 7.1.1.3.28.3.3-7   
  }                                                                                                                             
  }                                                                                                                             
  }                                                                                                                             
  }                                                                                                                             
  }                                                                                                                             
  }                                                                                                                             
  }                                                                                                                             
  }                                                                                                                             
  }                                                                                                                             
  }                                                                                                                             
  --------------------------------------------------------------------------------- ------------------ ------------------------ ---------------

Table 7.1.1.3.28.3.3-7: LTM-Config-r18 (Table 7.1.1.3.28.3.3-6)

  -------------------------------------------------------------------------------------------------- ------------------- ------------------------ ---------------
  Derivation path: TS 38.508-1 \[4\], Table 4.6.3-67D                                                                                             
  **Information Element**                                                                            **Value/remark**    **Comment**              **Condition**
  LTM-Config-r18 ::= SEQUENCE {                                                                                                                   
  ltm-CandidateToAddModList-r18 SEQUENCE (SIZE (1..maxNrofLTM-Configs-r18)) OF LTM-Candidate-r18 {   1 entry                                      
  LTM-Candidate-r18\[1\]                                                                             LTM-Candidate-r18   Table 7.1.1.3.28.3.3-8   
  }                                                                                                                                               
  ltm-CSI-ResourceConfig-r18                                                                         Not present                                  
  }                                                                                                                                               
  -------------------------------------------------------------------------------------------------- ------------------- ------------------------ ---------------

Table 7.1.1.3.28.3.3-8: LTM-Candidate-r18 (Table 7.1.1.3.28.3.3-7)

  ------------------------------------------------------------------------ ----------------------------------------------------------------------------------------- ------------- ---------------
  Derivation path: TS 38.508-1 \[4\], Table 4.6.3-67C                                                                                                                              
  **Information Element**                                                  **Value/remark**                                                                          **Comment**   **Condition**
  LTM-Candidate-r18 ::= SEQUENCE {                                                                                                                                                 
  ltm-CandidateId-r18                                                      1                                                                                                       
  ltm-CandidatePCI-r18                                                     Physical layer cell identity of NR Cell 28                                                              Step 5
  ltm-CandidateConfig-r18 OCTET STRING (CONTAINING RRCReconfiguration) {                                                                                                           
  RRCReconfiguration ::= SEQUENCE {                                                                                                                                                
  criticalExtensions CHOICE {                                                                                                                                                      
  rrcReconfiguration SEQUENCE {                                                                                                                                                    
  secondaryCellGroup                                                       CellGroupConfig specified in TS 38.508-1 \[4\] Table 4.6.3-19 with condition NR-DC\_SCG                 
  }                                                                                                                                                                                
  }                                                                                                                                                                                
  }                                                                                                                                                                                
  }                                                                                                                                                                                
  ltm-TCI-Info-r18                                                         *LTM-TCI-Info* specified in TS 38.508-1 \[4\] Table 4.6.3-67I with condition Joint                      
  }                                                                                                                                                                                
  ------------------------------------------------------------------------ ----------------------------------------------------------------------------------------- ------------- ---------------
