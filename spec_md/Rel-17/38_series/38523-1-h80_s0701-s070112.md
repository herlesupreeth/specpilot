7 Layer 2
=========

7.1 NR Layer 2
--------------

### 7.1.0 Common test case specific values for Layer 2

For all layer 2 test cases, default values for periodicBSR-Timer,
retxBSR-Timer and phr-Config shall be taken according to the table
7.1.0-1 unless test case specific values are given in the test case.

Table 7.1.0-1: MAC-CellGroupConfig

  --------------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.308 \[6\], clause Table 4.6.3-49                            
  Information Element                                       Value/remark   Comment   Condition
  MAC-CellGroupConfig ::= SEQUENCE {                                                 
  bsr-Config SEQUENCE {                                                              
  periodicBSR-Timer                                         infinity                 
  retxBSR-Timer                                             sf10240                  
  }                                                                                  
  phr-Config CHOICE {                                                                
  release                                                   NULL                     
  }                                                                                  
  }                                                                                  
  --------------------------------------------------------- -------------- --------- -----------

### 7.1.1 MAC

#### 7.1.1.0 Default Pre-Test Conditions for all MAC test cases

The following pre-test conditions shall be applied in all MAC test cases
until the test case explicitly over writes these conditions

##### System Simulator: {#system-simulator .H6}

\- The SS configures the test environment in accordance to the execution
conditions in Table 7.1.1.0-1.

##### UE: {#ue .H6}

\- None

##### Preamble: {#preamble .H6}

\- The SS performs the generic procedure in \[4\] to get UE in state
RRC\_CONNECTED in accordance to the execution conditions in Table
7.1.1.0-2 and using the message condition UE TEST LOOP MODE A to return
one PDCP SDU per DL PDCP SDU.

Table 7.1.1.0-1: Test environment

+----------------------+----------------------+----------------------+
| Execution Condition  | Cell configuration   | System Information   |
|                      |                      | Combination          |
+======================+======================+======================+
| IF pc\_NG\_RAN\_NR   | NR Cell 1            | NR: System           |
|                      |                      | information          |
|                      |                      | Combination NR-1     |
+----------------------+----------------------+----------------------+
| ELSE IF pc\_EN\_DC   | E-UTRA Cell 1 is     | EUTRA: System        |
|                      | PCell,               | information          |
|                      |                      | Combination 1        |
|                      | NR Cell 1 is PSCell  |                      |
|                      |                      | NR: N/A              |
+----------------------+----------------------+----------------------+
| ELSE IF pc\_NGEN\_DC | NG-RAN E-UTRA Cell 1 | EUTRA: System        |
|                      | is PCell,            | information          |
|                      |                      | Combination 1        |
|                      | NR Cell 1 is PSCell  |                      |
|                      |                      | NR: N/A              |
+----------------------+----------------------+----------------------+
| ELSE IF pc\_NE\_DC   | NR Cell 1 is PCell,  | NR: System           |
|                      |                      | information          |
|                      | E-UTRA Cell 1 is     | Combination NR-1     |
|                      | PSCell               |                      |
|                      |                      | E-UTRA: N/A          |
+----------------------+----------------------+----------------------+

Table 7.1.1.0-2: Preamble parameters

+----------------+----------------+----------------+----------------+
| Execution      | Multi-PDN /    | Generic        | Primary DRB    |
| Condition      | Multi-PDU      | Procedure      | used for Data  |
|                | Sessions       | Parameters     | testing        |
|                | Condition      |                |                |
+================+================+================+================+
| IF             | FALSE          | Conne          | Default DRB of |
| p              |                | ctivity(*NR*), | the first PDU  |
| c\_NG\_RAN\_NR |                |                | session on NR  |
|                |                | Test loop      | Cell           |
|                |                | function(*On*) |                |
|                |                |                |                |
|                |                | One DRB        |                |
+----------------+----------------+----------------+----------------+
|                | TRUE           | Conne          |                |
|                |                | ctivity(*NR*), |                |
|                |                |                |                |
|                |                | Test loop      |                |
|                |                | function(*On*) |                |
|                |                |                |                |
|                |                | *N* DRBs (*N*  |                |
|                |                | â‰¥ 2)           |                |
+----------------+----------------+----------------+----------------+
| ELSE IF        | FALSE          | Connecti       | SN Terminated  |
| pc\_EN\_DC     |                | vity(*EN-DC*), | SCG bearer     |
|                |                |                | unless         |
|                |                | DC bearer(One  | explicitly     |
|                |                | MN Terminated  | specified in   |
|                |                | MCG bearer and | test case      |
|                |                | One *SN        |                |
|                |                | terminated SCG |                |
|                |                | bearer*),      |                |
|                |                |                |                |
|                |                | Test loop      |                |
|                |                | function(*On*) |                |
+----------------+----------------+----------------+----------------+
|                | TRUE           | Connecti       |                |
|                |                | vity(*EN-DC*), |                |
|                |                |                |                |
|                |                | DC bearer(Two  |                |
|                |                | MN Terminated  |                |
|                |                | MCG bearer and |                |
|                |                | One *SN        |                |
|                |                | terminated SCG |                |
|                |                | bearer*),      |                |
|                |                |                |                |
|                |                | Test loop      |                |
|                |                | function(*On*) |                |
+----------------+----------------+----------------+----------------+
| ELSE IF        | FALSE          | Connectivi     | SN Terminated  |
| pc\_NGEN\_DC   |                | ty(*NGEN-DC*), | SCG bearer     |
|                |                |                | unless         |
|                |                | DC bearer(One  | explicitly     |
|                |                | MN Terminated  | specified in   |
|                |                | MCG bearer and | test case      |
|                |                | One *SN        |                |
|                |                | terminated SCG |                |
|                |                | bearer*),      |                |
|                |                |                |                |
|                |                | Test loop      |                |
|                |                | function(*On*) |                |
+----------------+----------------+----------------+----------------+
|                | TRUE           | Connectivi     |                |
|                |                | ty(*NGEN-DC*), |                |
|                |                |                |                |
|                |                | DC bearer(Two  |                |
|                |                | MN Terminated  |                |
|                |                | MCG bearer and |                |
|                |                | One *SN        |                |
|                |                | terminated SCG |                |
|                |                | bearer*),      |                |
|                |                |                |                |
|                |                | Test loop      |                |
|                |                | function(*On*) |                |
+----------------+----------------+----------------+----------------+
| ELSE IF        | FALSE          | Connecti       | SN Terminated  |
| pc\_NE\_DC     |                | vity(*NE-DC*), | SCG bearer     |
|                |                |                | unless         |
|                |                | DC bearer(One  | explicitly     |
|                |                | MN Terminated  | specified in   |
|                |                | MCG bearer and | test case      |
|                |                | One *SN        |                |
|                |                | terminated SCG |                |
|                |                | bearer*),      |                |
|                |                |                |                |
|                |                | Test loop      |                |
|                |                | function(*On*) |                |
+----------------+----------------+----------------+----------------+
|                | TRUE           | Connecti       |                |
|                |                | vity(*NE-DC*), |                |
|                |                |                |                |
|                |                | DC bearer(*N*  |                |
|                |                | â‰¥ 2 MN         |                |
|                |                | Terminated MCG |                |
|                |                | bearer and One |                |
|                |                | *SN terminated |                |
|                |                | SCG bearer*),  |                |
|                |                |                |                |
|                |                | Test loop      |                |
|                |                | function(*On*) |                |
+----------------+----------------+----------------+----------------+

Table 7.1.1.0-3: Message conditions

  **Execution Condition**   **Message condition exceptions**
  ------------------------- ----------------------------------------------------------------------------------------------------
  IF pc\_NG\_RAN\_NR        Message with condition AM is used for step 7 in 4.5.4.2 according to \[4\]
  ELSE IF pc\_EN\_DC        Message condition MCG\_and\_SCG with condition AM is used for step 7 in 4.5.4.2 according to \[4\]
  ELSE IF pc\_NGEN\_DC      Message condition MCG\_and\_SCG with condition AM is used for step 7 in 4.5.4.2 according to \[4\]
  ELSE IF pc\_NE\_DC        Message condition MCG\_and\_SCG with condition AM is used for step 7 in 4.5.4.6 according to \[4\]

Table 7.1.1.0-4: SDAP Configuration Settings for pc\_NG\_RAN\_NR and
pc\_NE\_DC

  ---------------------- -------------------------------------------------- -------------------------------------------------- --------------------------------------------------
  Parameter              Value DRB1                                         Value DRB2                                         Value DRB3
  default DRB            true                                               false                                              false
  mappedQoS-FlowsToAdd   QFI 1 in Table 4.8.2.3-1 according to TS38.508-1   QFI 2 in Table 4.8.2.3-2 according to TS38.508-1   QFI 3 in Table 4.8.2.3-3 according to TS38.508-1
  ---------------------- -------------------------------------------------- -------------------------------------------------- --------------------------------------------------

#### 7.1.1.1 Random Access Procedures

##### 7.1.1.1.1 Correct selection of RACH parameters / Random access preamble and PRACH resource explicitly signalled to the UE by RRC / contention free random access procedure

##### 7.1.1.1.1.1 Test Purpose (TP) {#test-purpose-tp .H6}

##### (1) {#section .H6}

**with** { UE in RRC\_Connected }

**ensure that** {

**when** { SS sends an RRCReconfiguration message including
RACH-ConfigDedicated information element }

**then** { UE sends a prach preamble given in the RACH-ConfigDedicated
on the target cell }

}

##### (2) {#section-1 .H6}

**with** { UE in RRC\_Connected state after transmission of a PRACH
preamble on NR SpCell received in RACH-ConfigDedicated on the target
cell }

**ensure that** {

**when** { UE does not receive a matching Random Access response in
ra-ResponseWindowSize (hence considers RACH attempt as failed) and
PREAMBLE\_TRANSMISSION\_COUNTER is less than PREAMBLE\_TRANS\_MAX }

**then** { UE retransmits a PRACH preamble received in
RACH-ConfigDedicated on the target cell }

}

##### 7.1.1.1.1.2 Conformance requirements {#conformance-requirements .H6}

References: The conformance requirements covered in the present test
case are specified in: TS 38.321, clauses 5.1.2, 5.1.4. Unless otherwise
stated these are Rel-15 requirements.

\[TS 38.321, clause 5.1.2\]

The MAC entity shall:

> ...

1\> else if the *ra-PreambleIndex* has been explicitly provided by
PDCCH; and

1\> if the *ra-PreambleIndex* is not 0b000000:

2\> set the *PREAMBLE\_INDEX* to the signalled *ra-PreambleIndex*;

2\> select the SSB signalled by PDCCH.

1\> else if the contention-free Random Access Resources associated with
SSBs have been explicitly provided in *rach-ConfigDedicated* and at
least one SSB with SS-RSRP above *rsrp-ThresholdSSB* amongst the
associated SSBs is available:

2\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB* amongst the
associated SSBs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB.

...

1\> else if an SSB is selected above:

2\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB permitted by the restrictions given by
the *ra-ssb-OccasionMaskIndex* if configured or indicated by PDCCH (the
MAC entity shall select a PRACH occasion randomly with equal probability
amongst the consecutive PRACH occasions according to clause 8.1 of TS
38.213 \[6\], corresponding to the selected SSB; the MAC entity may take
into account the possible occurrence of measurement gaps when
determining the next available PRACH occasion corresponding to the
selected SSB).

1\> else if a CSI-RS is selected above:

2\> if there is no contention-free Random Access Resource associated
with the selected CSI-RS:

3\> determine the next available PRACH occasion from the PRACH
occasions, permitted by the restrictions given by the
*ra-ssb-OccasionMaskIndex* if configured, corresponding to the SSB in
*candidateBeamRSList* which is quasi-collocated with the selected CSI-RS
as specified in TS 38.214 \[7\] (the MAC entity shall select a PRACH
occasion randomly with equal probability amongst the consecutive PRACH
occasions according to clause 8.1 of TS 38.213 \[6\], corresponding to
the SSB which is quasi-collocated with the selected CSI-RS; the MAC
entity may take into account the possible occurrence of measurement gaps
when determining the next available PRACH occasion corresponding to the
SSB which is quasi-collocated with the selected CSI-RS).

2\> else:

3\> determine the next available PRACH occasion from the PRACH occasions
in *ra-OccasionList* corresponding to the selected CSI-RS (the MAC
entity shall select a PRACH occasion randomly with equal probability
amongst the PRACH occasions occurring simultaneously but on different
subcarriers, corresponding to the selected CSI-RS; the MAC entity may
take into account the possible occurrence of measurement gaps when
determining the next available PRACH occasion corresponding to the
selected CSI-RS).

1\> perform the Random Access Preamble transmission procedure (see
clause 5.1.3).

NOTE: When the UE determines if there is an SSB with SS-RSRP above
*rsrp-ThresholdSSB* or a CSI-RS with CSI-RSRP above
*rsrp-ThresholdCSI-RS*, the UE uses the latest unfiltered L1-RSRP
measurement.

\[TS 38.321, clause 5.1.4\]

Once the Random Access Preamble is transmitted and regardless of the
possible occurrence of a measurement gap, the MAC entity shall:

1\> if the contention-free Random Access Preamble for beam failure
recovery request was transmitted by the MAC entity:

2\> start the *ra-ResponseWindow* configured in
*BeamFailureRecoveryConfig* at the first PDCCH occasion as specified in
TS 38.213 \[6\] from the end of the Random Access Preamble transmission;

2\> monitor for a PDCCH transmission on the search space indicated by
*recoverySearchSpaceId* of the SpCell identified by the C-RNTI while
*ra-ResponseWindow* is running.

1\> else:

2\> start the *ra-ResponseWindow* configured in *RACH-ConfigCommon* at
the first PDCCH occasion as specified in TS 38.213 \[6\] from the end of
the Random Access Preamble transmission;

2\> monitor the PDCCH of the SpCell for Random Access Response(s)
identified by the RA-RNTI while the *ra-ResponseWindow* is running.

1\> if notification of a reception of a PDCCH transmission on the search
space indicated by *recoverySearchSpaceId* is received from lower layers
on the Serving Cell where the preamble was transmitted; and

1\> if PDCCH transmission is addressed to the C-RNTI; and

1\> if the contention-free Random Access Preamble for beam failure
recovery request was transmitted by the MAC entity:

2\> consider the Random Access procedure successfully completed.

1\> else if a downlink assignment has been received on the PDCCH for the
RA-RNTI and the received TB is successfully decoded:

2\> if the Random Access Response contains a MAC subPDU with Backoff
Indicator:

3\> set the *PREAMBLE\_BACKOFF* to value of the BI field of the MAC
subPDU using Table 7.2-1, multiplied with *SCALING\_FACTOR\_BI*.

2\> else:

3\> set the *PREAMBLE\_BACKOFF* to 0 ms.

2\> if the Random Access Response contains a MAC subPDU with Random
Access Preamble identifier corresponding to the transmitted
*PREAMBLE\_INDEX* (see clause 5.1.3):

3\> consider this Random Access Response reception successful.

2\> if the Random Access Response reception is considered successful:

3\> if the Random Access Response includes a MAC subPDU with RAPID only:

4\> consider this Random Access procedure successfully completed;

4\> indicate the reception of an acknowledgement for SI request to upper
layers.

3\> else:

4\> apply the following actions for the Serving Cell where the Random
Access Preamble was transmitted:

5\> process the received Timing Advance Command (see clause 5.2);

5\> indicate the *preambleReceivedTargetPower* and the amount of power
ramping applied to the latest Random Access Preamble transmission to
lower layers (i.e. (*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*);

5\> if the Random Access procedure for an SCell is performed on uplink
carrier where *pusch-Config* is not configured:

6\> ignore the received UL grant.

5\> else:

6\> process the received UL grant value and indicate it to the lower
layers.

4\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

5\> consider the Random Access procedure successfully completed.

4\> else:

5\> set the *TEMPORARY\_C-RNTI* to the value received in the Random
Access Response;

5\> if this is the first successfully received Random Access Response
within this Random Access procedure:

6\> if the transmission is not being made for the CCCH logical channel:

> 7\> indicate to the Multiplexing and assembly entity to include a
> C-RNTI MAC CE in the subsequent uplink transmission.

6\> obtain the MAC PDU to transmit from the Multiplexing and assembly
entity and store it in the Msg3 buffer.

NOTE: If within a Random Access procedure, an uplink grant provided in
the Random Access Response for the same group of contention-based Random
Access Preambles has a different size than the first uplink grant
allocated during that Random Access procedure, the UE behaviour is not
defined.

1\> if *ra-ResponseWindow* configured in *BeamFailureRecoveryConfig*
expires and if a PDCCH transmission on the search space indicated by
*recoverySearchSpaceId* addressed to the C-RNTI has not been received on
the Serving Cell where the preamble was transmitted; or

1\> if *ra-ResponseWindow* configured in *RACH-ConfigCommon* expires,
and if the Random Access Response containing Random Access Preamble
identifiers that matches the transmitted *PREAMBLE\_INDEX* has not been
received:

2\> consider the Random Access Response reception not successful;

2\> increment *PREAMBLE\_TRANSMISSION\_COUNTER* by 1;

2\> if *PREAMBLE\_TRANSMISSION\_COUNTER* = *preambleTransMax* + 1:

3\> if the Random Access Preamble is transmitted on the SpCell:

4\> indicate a Random Access problem to upper layers;

4\> if this Random Access procedure was triggered for SI request:

5\> consider the Random Access procedure unsuccessfully completed.

3\> else if the Random Access Preamble is transmitted on an SCell:

4\> consider the Random Access procedure unsuccessfully completed.

2\> if the Random Access procedure is not completed:

3\> select a random backoff time according to a uniform distribution
between 0 and the *PREAMBLE\_BACKOFF*;

3\> if the criteria (as defined in clause 5.1.2) to select
contention-free Random Access Resources is met during the backoff time:

4\> perform the Random Access Resource selection procedure (see clause
5.1.2);

3\> else:

4\> perform the Random Access Resource selection procedure (see clause
5.1.2) after the backoff time.

The MAC entity may stop *ra-ResponseWindow* (and hence monitoring for
Random Access Response(s)) after successful reception of a Random Access
Response containing Random Access Preamble identifiers that matches the
transmitted *PREAMBLE\_INDEX*.

HARQ operation is not applicable to the Random Access Response
reception.

##### 7.1.1.1.1.3 Test description {#test-description .H6}

##### 7.1.1.1.1.3.1 Pre-test conditions {#pre-test-conditions .H6}

Same Pre-test conditions as in clause 7.1.1.0 except the following:

\- 2 NR cells (NR Cell 1 and NR Cell 2) are configured.

\- Test loop function(*Off*)

##### 7.1.1.1.1.3.2 Test procedure sequence {#test-procedure-sequence .H6}

Table 7.1.1.1.1.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\--     | *(RR      | \-      | \- |
|           | transmits |           | CReconfig |         |    |
|           | an        |           | uration)* |         |    |
|           | *R        |           |           |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | handover  |           |           |         |    |
|           | NR Cell 1 |           |           |         |    |
|           | to target |           |           |         |    |
|           | NR Cell   |           |           |         |    |
|           | 2,        |           |           |         |    |
|           | including |           |           |         |    |
|           | RA        |           |           |         |    |
|           | CH-Config |           |           |         |    |
|           | Dedicated |           |           |         |    |
|           | in        |           |           |         |    |
|           | formation |           |           |         |    |
|           | element.  |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note 1,  |           |           |         |    |
|           | Note 3)   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | Void      | \-        | *-*       | \-      | \- |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | Check:    | \--\>     | (PRACH    | 1       | P  |
|           | Does the  |           | Preamble) |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to        |           |           |         |    |
|           | *ra-Pream |           |           |         |    |
|           | bleIndex* |           |           |         |    |
|           | in step 1 |           |           |         |    |
|           | on NR     |           |           |         |    |
|           | Cell 2?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | Check:    | \--\>     | (PRACH    | 2       | P  |
|           | Does the  |           | Preamble) |         |    |
|           | UE        |           |           |         |    |
|           | re-       |           |           |         |    |
|           | transmits |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to        |           |           |         |    |
|           | *ra-Pream |           |           |         |    |
|           | bleIndex* |           |           |         |    |
|           | in step 1 |           |           |         |    |
|           | on NR     |           |           |         |    |
|           | Cell 2?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | Random    |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | on NR     |           |           |         |    |
|           | cell 2,   |           |           |         |    |
|           | with      |           |           |         |    |
|           | RAPID     |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to        |           |           |         |    |
|           | *ra-Pream |           |           |         |    |
|           | bleIndex* |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 1.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an        |           | gurationC |         |    |
|           | *         |           | omplete)* |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message.  |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| 36.508    |           |           |           |         |    |
| \[7\],    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 4.6.1-8   |           |           |           |         |    |
| using     |           |           |           |         |    |
| condition |           |           |           |         |    |
| EN-DC\_P  |           |           |           |         |    |
| SCell\_HO |           |           |           |         |    |
| AND       |           |           |           |         |    |
| RBCo      |           |           |           |         |    |
| nfig\_NoK |           |           |           |         |    |
| eyChange. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| For       |           |           |           |         |    |
| FR1,PRACH |           |           |           |         |    |
| preamble  |           |           |           |         |    |
| format 0  |           |           |           |         |    |
| as per TS |           |           |           |         |    |
| 38.       |           |           |           |         |    |
| 211\[24\] |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 6.3.3.1-1 |           |           |           |         |    |
| is        |           |           |           |         |    |
| c         |           |           |           |         |    |
| onfigured |           |           |           |         |    |
| (real     |           |           |           |         |    |
| network   |           |           |           |         |    |
| dep       |           |           |           |         |    |
| loyment). |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.1.1.3.3 Specific message contents {#specific-message-contents .H6}

Table 7.1.1.1.1.3.3-1: *Void*

Table 7.1.1.1.1.3.3-2: *RRCReconfiguration* for EN-DC (step 1, Table
7.1.1.1.1.3.2-1)

  ------------------------------------------------------------------------------ ----------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13 with condition EN-DC\_HO.                               
  Information Element                                                            Value/remark      Comment   Condition
  RRCReconfiguration ::= SEQUENCE {                                                                          
  criticalExtensions CHOICE {                                                                                
  rrcReconfiguration SEQUENCE {                                                                              
  secondaryCellGroup                                                             CellGroupConfig             
  }                                                                                                          
  }                                                                                                          
  }                                                                                                          
  ------------------------------------------------------------------------------ ----------------- --------- -----------

Table 7.1.1.1.1.3.3-2A: *RRCReconfiguration* for NR/5GC (step 1, Table
7.1.1.1.1.3.2-1)

  ---------------------------------------------------- -------------------------------------------------------------------------------------------------- --------------------------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                                                                                                                                                          
  Information Element                                  Value/remark                                                                                       Comment                                             Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                                                                                                           
  criticalExtensions CHOICE {                                                                                                                                                                                 
  rrcReconfiguration SEQUENCE {                                                                                                                                                                               
  radioBearerConfig                                    RadioBearerConfig as per TS 38.508-1\[4\] Table 4.6.3-132 with conditions DRBn and Recover\_PDCP   n set to the default DRB of the first PDU session   NR
  nonCriticalExtension SEQUENCE {                                                                                                                                                                             
  masterCellGroup                                      CellGroupConfig                                                                                                                                        
  }                                                                                                                                                                                                           
  }                                                                                                                                                                                                           
  }                                                                                                                                                                                                           
  }                                                                                                                                                                                                           
  ---------------------------------------------------- -------------------------------------------------------------------------------------------------- --------------------------------------------------- -----------

Table 7.1.1.1.1.3.3-3: *CellGroupConfig* for EN-DC (Table
7.1.1.1.1.3.3-2)

  ---------------------------------------------------------------------------------- -------------------------------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19 with condition PSCell\_change                                                                
  Information Element                                                                Value/remark                                       Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                                                                                  
  spCellConfig SEQUENCE {                                                                                                                         
  reconfigurationWithSync SEQUENCE {                                                                                                              
  spCellConfigCommon                                                                 ServingCellConfigCommon                                      
  newUE-Identity                                                                     UE identity different from NR cell 1 UE identity             
  rach-ConfigDedicated CHOICE {                                                                                                                   
  uplink                                                                             RACH-ConfigDedicated                                         
  }                                                                                                                                               
  }                                                                                                                                               
  }                                                                                                                                               
  }                                                                                                                                               
  ---------------------------------------------------------------------------------- -------------------------------------------------- --------- -----------

Table 7.1.1.1.1.3.3-3A: *CellGroupConfig* for NR/5GC (Table
7.1.1.1.1.3.3-2A)

  --------------------------------------------------------------------------------- -------------------------------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19 with condition PCell\_change                                                                
  Information Element                                                               Value/remark                                       Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                                                                                 
  spCellConfig SEQUENCE {                                                                                                                        
  reconfigurationWithSync SEQUENCE {                                                                                                             
  spCellConfigCommon                                                                ServingCellConfigCommon                                      
  newUE-Identity                                                                    UE identity different from NR cell 1 UE identity             
  rach-ConfigDedicated CHOICE {                                                                                                                  
  uplink                                                                            RACH-ConfigDedicated                                         
  }                                                                                                                                              
  }                                                                                                                                              
  spCellConfigDedicated                                                             ServingCellConfig                                            
  }                                                                                                                                              
  }                                                                                                                                              
  --------------------------------------------------------------------------------- -------------------------------------------------- --------- -----------

Table 7.1.1.1.1.3.3-4: *RACH-ConfigDedicated* (Table 7.1.1.1.1.3.3-3 and
Table 7.1.1.1.1.3.3-3A)

  --------------------------------------------------------------------------------- -------------------- ------------------- -----------------------------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-129                                                                        
  Information Element                                                               Value/remark         Comment             Condition
  RACH-ConfigDedicated ::= SEQUENCE {                                                                                        
  cfra SEQUENCE {                                                                                                            
  occasions SEQUENCE {                                                                                                       
  rach-ConfigGeneric                                                                RACH-ConfigGeneric                       FR1, PRACH Preamble format 0 used
  }                                                                                                                          
  resources CHOICE {                                                                                                         
  ssb SEQUENCE {                                                                                                             
  ssb-ResourceList SEQUENCE (SIZE(1..maxRA-SSB-Resources)) OF CFRA-SSB-Resource {   1 entry                                  
  CFRA-SSB-Resource\[1\] SEQUENCE {                                                                      entry 1             
  ssb                                                                               0                                        
  ra-PreambleIndex                                                                  52                   Randomly selected   
  }                                                                                                                          
  }                                                                                                                          
  }                                                                                                                          
  }                                                                                                                          
  }                                                                                                                          
  }                                                                                                                          
  --------------------------------------------------------------------------------- -------------------- ------------------- -----------------------------------

Table 7.1.1.1.1.3.3-5: *RACH-ConfigGeneric* (Table 7.1.1.1.1.3.3-4)

  ----------------------------------------------------- -------------- --------- -----------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-129                            
  Information Element                                   Value/remark   Comment   Condition
  RACH-ConfigDedicated ::= SEQUENCE {                                            
  prach-ConfigurationIndex                              14                       FR1
                                                        13                       FR1 AND HD\_FDD
                                                        149                      FR2
  zeroCorrelationZoneConfig                             12                       FR1
                                                        15                       FR2
  }                                                                              
  ----------------------------------------------------- -------------- --------- -----------------

  ----------- ----------------------------------------------------------------------------------------
  Condition   Explanation
  HD\_FDD     pc\_halfDuplexFDD\_TypeA\_RedCap\_r17 (i.e HD\_FDD UE are performing test on FDD band)
  ----------- ----------------------------------------------------------------------------------------

Table 7.1.1.1.1.3.3-6: *ServingCellConfigCommon* (Table 7.1.1.1.1.3.3-3
and Table 7.1.1.1.1.3.3-3A)

  ----------------------------------------------------- ------------------------ --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                      
  Information Element                                   Value/remark             Comment   Condition
  ServingCellConfigCommon ::= SEQUENCE {                                                   
  uplinkConfigCommon SEQUENCE {                                                            
  initialUplinkBWP                                      BWP-UplinkCommon                   
  }                                                                                        
  tdd-UL-DL-ConfigurationCommon                         TDD-UL-DL-ConfigCommon             
  }                                                                                        
  ----------------------------------------------------- ------------------------ --------- -----------

Table 7.1.1.1.1.3.3-7: *BWP-UplinkCommon (*Table 7.1.1.1.1.3.3-6)

  ---------------------------------------------------- ------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-10                                 
  Information Element                                  Value/remark        Comment   Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                    
  rach-ConfigCommon CHOICE {                                                         
  setup                                                RACH-ConfigCommon             
  }                                                                                  
  }                                                                                  
  ---------------------------------------------------- ------------------- --------- -----------

Table 7.1.1.1.1.3.3-8: *RACH-ConfigCommon (*Table 7.1.1.1.1.3.3-7)

  ----------------------------------------------------- ----------------------------------------------------------------------- ------------------------------ -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128                                                                                                          
  Information Element                                   Value/remark                                                            Comment                        Condition
  RACH-ConfigCommon ::= SEQUENCE {                                                                                                                             
  rach-ConfigGeneric                                    RACH-ConfigGeneric                                                                                     
  ssb-perRACH-OccasionAndCB-PreamblesPerSSB CHOICE {                                                                                                           
  one                                                   n36                                                                                                    
  }                                                                                                                                                            
  prach-RootSequenceIndex CHOICE {                                                                                                                             
  l139                                                  Set according to table 4.4.2-2 in TS 38.508-1 \[4\] for the NR Cell..                                  
  l839                                                  Set according to table 4.4.2-2 in TS 38.508-1 \[4\] for the NR Cell.    PRACH Preamble format 0 used   FR1,
  }                                                                                                                                                            
  }                                                                                                                                                            
  ----------------------------------------------------- ----------------------------------------------------------------------- ------------------------------ -----------

Table 7.1.1.1.1.3.3-9: *TDD-UL-DL-ConfigCommon (*Table 7.1.1.1.1.3.3-6)

  ----------------------------------------------------- ------------------- --------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-192                                 
  Information Element                                   Value/remark        Comment   Condition
  TDD-UL-DL-ConfigCommon ::= SEQUENCE {                                               
  referenceSubcarrierSpacing                            SubcarrierSpacing             
  pattern1 SEQUENCE {                                                                 
  dl-UL-TransmissionPeriodicity                         ms5                           FR1
                                                        ms0p625                       FR2
  nrofDownlinkSlots                                     3                             FR1 AND SCS30
                                                        1                             FR1 AND SCS15
                                                        3                             FR2
  nrofDownlinkSymbols                                   6                             FR1
                                                        10                            FR2
  nrofUplinkSlots                                       2                             FR1 AND SCS30
                                                        1                             FR1 AND SCS15
                                                        1                             FR2
  nrofUplinkSymbols                                     4                             FR1
                                                        2                             FR2
  dl-UL-TransmissionPeriodicity-v1530                   ms3                           FR1
  }                                                                                   
  pattern2                                              Not present                   
  pattern2 SEQUENCE {                                                                 FR1
  dl-UL-TransmissionPeriodicity                         ms2                           
  nrofDownlinkSlots                                     4                             FR1 AND SCS30
                                                        2                             FR1 AND SCS15
  nrofDownlinkSymbols                                   0                             
  nrofUplinkSlots                                       0                             
  nrofUplinkSymbols                                     0                             
  }                                                                                   
  }                                                                                   
  ----------------------------------------------------- ------------------- --------- ---------------

Table 7.1.1.1.1.3.3-10: ServingCellConfig (Table 7.1.1.1.1.3.3-3A)

  ----------------------------------------------------- --------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167                                   
  Information Element                                   Value/remark          Comment   Condition
  ServingCellConfig ::= SEQUENCE {                                                      
  uplinkConfig SEQUENCE {                                                               
  initialUplinkBWP                                      BWP-UplinkDedicated             
  }                                                                                     
  }                                                                                     
  ----------------------------------------------------- --------------------- --------- -----------

Table 7.1.1.1.1.3.3-11: *BWP-UplinkDedicated (*Table 7.1.1.1.1.3.3-10)

  ---------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-15                            
  Information Element                                  Value/remark   Comment   Condition
  BWP-UplinkDedicated ::= SEQUENCE {                                            
  pucch-Config CHOICE {                                                         
  setup                                                PUCCH-Config             
  }                                                                             
  }                                                                             
  ---------------------------------------------------- -------------- --------- -----------

Table 7.1.1.1.1.3.3-12: *PUCCH-Config (*Table 7.1.1.1.1.3.3-11)

  --------------------------------------------------------------------------------------------------------------------- --------------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-112                                                                                                               
  Information Element                                                                                                   Value/remark                      Comment   Condition
  PUCCH-Config ::= SEQUENCE {                                                                                                                                       
  schedulingRequestResourceToAddModList SEQUENCE (SIZE (1..maxNrofSR-Resources)) OF SchedulingRequestResourceConfig {   1 entry                                     
  SchedulingRequestResourceConfig\[1\]                                                                                  SchedulingRequestResourceConfig   entry 1   
  }                                                                                                                                                                 
  }                                                                                                                                                                 
  --------------------------------------------------------------------------------------------------------------------- --------------------------------- --------- -----------

Table 7.1.1.1.1.3.3-13: *SchedulingRequestResourceConfig (*Table
7.1.1.1.1.3.3-12)

  ----------------------------------------------------- -------------- ----------------------------------------------------- -------------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-157                                                                        
  Information Element                                   Value/remark   Comment                                               Condition
  SchedulingRequestResourceConfig ::= SEQUENCE {                                                                             
  periodicityAndOffset CHOICE {                                                                                              
  sl10                                                  2              With SCS = kHz15 results in repetition every 10 ms    SCS15
                                                        9                                                                    SCS15 AND HD\_FDD
  sl20                                                  5              With SCS = kHz30 results in repetition every 10 ms    SCS30
  sl80                                                  4              With SCS = kHz120 results in repetition every 10 ms   SCS120
  }                                                                                                                          
  }                                                                                                                          
  ----------------------------------------------------- -------------- ----------------------------------------------------- -------------------

  ----------- ----------------------------------------------------------------------------------------
  Condition   Explanation
  HD\_FDD     pc\_halfDuplexFDD\_TypeA\_RedCap\_r17 (i.e HD\_FDD UE are performing test on FDD band)
  ----------- ----------------------------------------------------------------------------------------

##### 7.1.1.1.1a Correct selection of RACH parameters / Random access preamble and PRACH resource explicitly signalled to the UE by PDCCH Order / contention free random access procedure

##### 7.1.1.1.1a.1 Test Purpose (TP) {#a.1-test-purpose-tp .H6}

##### (1) {#section-2 .H6}

**with** { UE in RRC\_Connected }

**ensure that** {

**when** { PDCCH control command is received in NR SpCell providing
Random Access Preamble }

**then** { UE sends a PRACH preamble given in the PDCCH Order in NR
SpCell }

}

##### (2) {#section-3 .H6}

**with** { UE in RRC\_Connected state after transmission of a PRACH
preamble on NR SpCell received in PDCCH control command on NR SpCell }

**ensure that** {

**when** { UE does not receive a matching Random Access response in
ra-ResponseWindowSize (hence considers RACH attempt as failed) and
PREAMBLE\_TRANSMISSION\_COUNTER is less than PREAMBLE\_TRANS\_MAX }

**then** { UE retransmits a PRACH preamble received in PDCCH control
command on NR SpCell }

}

##### 7.1.1.1.1a.2 Conformance requirements {#a.2-conformance-requirements .H6}

References: The conformance requirements covered in the present test
case are specified in: TS 38.321, clauses 5.1.2, 5.1.4 and TS 38.212
clause 7.3.1.2.1. Unless otherwise stated these are Rel-15 requirements.

\[TS 38.321, clause 5.1.2\]

The MAC entity shall:

> ...

1\> else if the *ra-PreambleIndex* has been explicitly provided by
either PDCCH or RRC; and

1\> if the *ra-PreambleIndex* is not 0b000000; and

1\> if contention-free Random Access Resource associated with SSBs or
CSI-RS have not been explicitly provided by RRC:

2\> set the *PREAMBLE\_INDEX* to the signalled *ra-PreambleIndex*.

...

1\> if an SSB is selected above and an association between PRACH
occasions and SSBs is configured:

2\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB permitted by the restrictions given by
the *ra-ssb-OccasionMaskIndex* if configured (the MAC entity may take
into account the possible occurrence of measurement gaps when
determining the next available PRACH occasion corresponding to the
selected SSB).

1\> else if a CSI-RS is selected above and an association between PRACH
occasions and CSI-RSs is configured:

2\> determine the next available PRACH occasion from the PRACH occasions
in *ra-OccasionList* corresponding to the selected CSI-RS (the MAC
entity may take into account the possible occurrence of measurement gaps
when determining the next available PRACH occasion corresponding to the
selected CSI-RS).

1\> else:

2\> determine the next available PRACH occasion (the MAC entity may take
into account the possible occurrence of measurement gaps when
determining the next available PRACH occasion).

1\> perform the Random Access Preamble transmission procedure (see
clause 5.1.3).

\[TS 38.321, clause 5.1.4\]

Once the Random Access Preamble is transmitted and regardless of the
possible occurrence of a measurement gap, the MAC entity shall:

\...

1\> else:

2\> start the *ra-ResponseWindow* configured in *RACH-ConfigCommon* at
the first PDCCH occasion as specified in TS 38.213 \[6\] from the end of
the Random Access Preamble transmission;

2\> monitor the PDCCH of the SpCell for Random Access Response(s)
identified by the RA-RNTI while the *ra-ResponseWindow* is running.

1\> if notification of a reception of a PDCCH transmission is received
from lower layers; and

1\> if PDCCH transmission is addressed to the C-RNTI; and

\...

1\> else if a downlink assignment has been received on the PDCCH for the
RA-RNTI and the received TB is successfully decoded:

2\> if the Random Access Response contains a Backoff Indicator
subheader:

3\> set the *PREAMBLE\_BACKOFF* to value of the BI field of the Backoff
Indicator subheader using Table 7.2-1.

2\> else:

3\> set the *PREAMBLE\_BACKOFF* to 0 ms.

2\> if the Random Access Response contains a Random Access Preamble
identifier corresponding to the transmitted *PREAMBLE\_INDEX* (see
subclause 5.1.3):

3\> consider this Random Access Response reception successful.

2\> if the Random Access Response reception is considered successful:

3\> if the Random Access Response includes RAPID only:

4\> consider this Random Access procedure successfully completed;

4\> indicate the reception of an acknowledgement for the SI request to
upper layers.

3\> else:

4\> apply the following actions for the Serving Cell where the Random
Access Preamble was transmitted:

5\> process the received Timing Advance Command (see subclause 5.2);

5\> indicate the *preambleReceivedTargetPower* and the amount of power
ramping applied to the latest Random Access Preamble transmission to
lower layers (i.e. (*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*preamblePowerRampingStep*);

5\> if the Serving Cell for the Random Access procedure is SRS-only
SCell:

6\> ignore the received UL grant.

5\> else:

6\> process the received UL grant value and indicate it to the lower
layers.

4\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

5\> consider the Random Access procedure successfully completed.

\...

1\> if *ra-ResponseWindow* configured in *RACH-ConfigCommon* expires,
and if the Random Access Response containing Random Access Preamble
identifiers that matches the transmitted *PREAMBLE\_INDEX* has not been
received; or:

1\> if *ra-ResponseWindow* configured in *BeamFailureRecoveryConfig*
expires and if the PDCCH addressed to the C-RNTI has not been received:

2\> consider the Random Access Response reception not successful;

2\> increment *PREAMBLE\_TRANSMISSION\_COUNTER* by 1;

2\> if *PREAMBLE\_TRANSMISSION\_COUNTER* = *preambleTxMax* + 1:

3\> if the Random Access Preamble is transmitted on the SpCell:

4\> indicate a Random Access problem to upper layers.

3\> else if the Random Access Preamble is transmitted on a SCell:

4\> consider the Random Access procedure unsuccessfully completed.

2\> if in this Random Access procedure, the Random Access Preamble was
selected by MAC among the contention-based Random Access Preambles:

3\> select a random backoff time according to a uniform distribution
between 0 and the *PREAMBLE\_BACKOFF*;

3\> delay the subsequent Random Access Preamble transmission by the
backoff time.

2\> perform the Random Access Resource selection procedure (see
subclause 5.1.2).

The MAC entity may stop *ra-ResponseWindow* (and hence monitoring for
Random Access Response(s)) after successful reception of a Random Access
Response containing Random Access Preamble identifiers that matches the
transmitted *PREAMBLE\_INDEX*.

HARQ operation is not applicable to the Random Access Response
transmission.

\[TS 38.212, 7.3.1.2.1\]

> If the CRC of the DCI format 1\_0 is scrambled by C-RNTI and the
> \"Frequency domain resource assignment\" field are of all ones, the
> DCI format 1\_0 is for random access procedure initiated by a PDCCH
> order, with all remaining fields set as follows:

\- Random Access Preamble index -- 6 bits according to
*ra-PreambleIndex* in Subclause 5.1.2 of \[8, TS38.321\]

\- UL/SUL indicator -- 1 bit. If the value of the \"Random Access
Preamble index\" is not all zeros and if the UE is configured with SUL
in the cell, this field indicates which UL carrier in the cell to
transmit the PRACH according to Table 7.3.1.1.1-1; otherwise, this field
is reserved

\- SS/PBCH index -- 6 bits. If the value of the \"Random Access Preamble
index\" is not all zeros, this field indicates the SS/PBCH that shall be
used to determine the RACH occasion for the PRACH transmission;
otherwise, this field is reserved.

\- PRACH Mask index -- 4 bits. If the value of the \"Random Access
Preamble index\" is not all zeros, this field indicates the RACH
occasion associated with the SS/PBCH indicated by \"SS/PBCH index\" for
the PRACH transmission, according to Subclause 5.1.1 of \[8, TS38.321\];
otherwise, this field is reserved

\- Reserved bits -- 10 bits

##### 7.1.1.1.1a.3 Test description {#a.3-test-description .H6}

##### 7.1.1.1.1a.3.1 Pre-test conditions {#a.3.1-pre-test-conditions .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that Test loop
function(*Off*).

##### 7.1.1.1.1a.3.2 Test procedure sequence {#a.3.2-test-procedure-sequence .H6}

Table 7.1.1.1.1a.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 0A        | SS        | \<\--     | (R        | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an        |           | guration) |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | *         |           |           |         |    |
|           | configure |           |           |         |    |
|           | specific  |           |           |         |    |
|           | pa        |           |           |         |    |
|           | rameters. |           |           |         |    |
|           | Note 1,   |           |           |         |    |
|           | Note 3*   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 0B        | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | RRCRecon  |           | gurationC |         |    |
|           | figuratio |           | omplete)* |         |    |
|           | nComplete |           |           |         |    |
|           | message.  |           |           |         |    |
|           | *Note 2*  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\--     | (PDCCH    | \-      | \- |
|           | transmits |           | Order)    |         |    |
|           | a PDCCH   |           |           |         |    |
|           | order     |           |           |         |    |
|           | providing |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | ID 37 on  |           |           |         |    |
|           | NR        |           |           |         |    |
|           | SpCell.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | Check:    | \--\>     | (PRACH    | 1       | P  |
|           | Does the  |           | Preamble) |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to        |           |           |         |    |
|           | *ra-Pream |           |           |         |    |
|           | bleIndex* |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 1?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | Check:    | \--\>     | (PRACH    | 2       | P  |
|           | Does the  |           | Preamble) |         |    |
|           | UE        |           |           |         |    |
|           | re-       |           |           |         |    |
|           | transmits |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to        |           |           |         |    |
|           | *ra-Pream |           |           |         |    |
|           | bleIndex* |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 1?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | Check:    | \--\>     | (PRACH    | 2       | P  |
|           | Does the  |           | Preamble) |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to        |           |           |         |    |
|           | *ra-Pream |           |           |         |    |
|           | bleIndex* |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 1?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Check:    | \--\>     | (PRACH    | 2       | P  |
|           | Does the  |           | Preamble) |         |    |
|           | UE        |           |           |         |    |
|           | re-       |           |           |         |    |
|           | transmits |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to        |           |           |         |    |
|           | *ra-Pream |           |           |         |    |
|           | bleIndex* |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 1?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | Random    |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | on NR     |           |           |         |    |
|           | SpCell,   |           |           |         |    |
|           | with      |           |           |         |    |
|           | RAPID     |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to        |           |           |         |    |
|           | *ra-Pream |           |           |         |    |
|           | bleIndex* |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 1.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *R        |           |           |           |         |    |
| RCReconfi |           |           |           |         |    |
| guration* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RRC      |           |           |           |         |    |
| Connectio |           |           |           |         |    |
| nReconfig |           |           |           |         |    |
| uration.* |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| For FR1,  |           |           |           |         |    |
| PRACH     |           |           |           |         |    |
| preamble  |           |           |           |         |    |
| format 0  |           |           |           |         |    |
| as per TS |           |           |           |         |    |
| 38.       |           |           |           |         |    |
| 211\[24\] |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 6.3.3.1-1 |           |           |           |         |    |
| is        |           |           |           |         |    |
| c         |           |           |           |         |    |
| onfigured |           |           |           |         |    |
| in order  |           |           |           |         |    |
| to        |           |           |           |         |    |
| provide   |           |           |           |         |    |
| coverage  |           |           |           |         |    |
| for PRACH |           |           |           |         |    |
| preamble  |           |           |           |         |    |
| format 0  |           |           |           |         |    |
| testing   |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.1.1a.3.3 Specific message contents {#a.3.3-specific-message-contents .H6}

Table 7.1.1.1.1a.3.3-1: *RRCReconfiguration* (step 0A,
Table7.1.1.1.1a.3.2-1)

  ---------------------------------------------------- ----------------- ------------------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                                                                 
  Information Element                                  Value/remark      Comment                                     Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                  
  criticalExtensions CHOICE {                                                                                        
  rrcReconfiguration SEQUENCE {                                                                                      
  secondaryCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   EN-DC
  nonCriticalExtension SEQUENCE {                                                                                    NR
  masterCellGroup                                      CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  ---------------------------------------------------- ----------------- ------------------------------------------- -----------

Table 7.1.1.1.1a.3.3-2: *CellGroupConfig (*Table 7.1.1.1.1a.3.3-1)

  ---------------------------------------------------- ------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19                                       
  Information Element                                  Value/remark              Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                           
  spCellConfig SEQUENCE {                                                                  
  reconfigurationWithSync SEQUENCE {                                                       
  spCellConfigCommon                                   ServingCellConfigCommon             
  newUE-Identity                                       RNTI-Value                          
  t304                                                 ms2000                              
  rach-ConfigDedicated                                 Not Present                         
  }                                                                                        
  spCellConfigDedicated                                ServingCellConfig                   
  }                                                                                        
  }                                                                                        
  ---------------------------------------------------- ------------------------- --------- -----------

Table 7.1.1.1.1a.3.3-3: *ServingCellConfigCommon (*Table
7.1.1.1.1a.3.3-2)

  ----------------------------------------------------- ------------------------ --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                      
  Information Element                                   Value/remark             Comment   Condition
  ServingCellConfigCommon ::= SEQUENCE {                                                   
  uplinkConfigCommon SEQUENCE {                                                            
  initialUplinkBWP                                      BWP-UplinkCommon                   
  }                                                                                        
  tdd-UL-DL-ConfigurationCommon                         TDD-UL-DL-ConfigCommon             
  }                                                                                        
  ----------------------------------------------------- ------------------------ --------- -----------

Table 7.1.1.1.1a.3.3-4: *BWP-UplinkCommon (*Table 7.1.1.1.1a.3.3-3)

  ---------------------------------------------------- ------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-10                                 
  Information Element                                  Value/remark        Comment   Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                    
  rach-ConfigCommon CHOICE {                                                         
  setup                                                RACH-ConfigCommon             
  }                                                                                  
  }                                                                                  
  ---------------------------------------------------- ------------------- --------- -----------

Table 7.1.1.1.1a.3.3-5: *RACH-ConfigCommon (*Table 7.1.1.1.1a.3.3-4)

  ----------------------------------------------------- ---------------------------------------------------------------------- ------------------------------ -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128                                                                                                         
  Information Element                                   Value/remark                                                           Comment                        Condition
  RACH-ConfigCommon ::= SEQUENCE {                                                                                                                            
  rach-ConfigGeneric                                    RACH-ConfigGeneric                                                                                    
  ssb-perRACH-OccasionAndCB-PreamblesPerSSB CHOICE {                                                                                                          
  one                                                   n36                                                                                                   
  }                                                                                                                                                           
  prach-RootSequenceIndex CHOICE {                                                                                                                            
  l139                                                  Set according to table 4.4.2-2 in TS 38.508-1 \[4\] for the NR Cell                                   
  l839                                                  Set according to table 4.4.2-2 in TS 38.508-1 \[4\] for the NR Cell.   PRACH Preamble format 0 used   FR1
  }                                                                                                                                                           
  }                                                                                                                                                           
  ----------------------------------------------------- ---------------------------------------------------------------------- ------------------------------ -----------

Table 7.1.1.1.1a.3.3-6: *RACH-ConfigGeneric (*Table 7.1.1.1.1a.3.3-5)

  ----------------------------------------------------- -------------- --------- -----------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-130                            
  Information Element                                   Value/remark   Comment   Condition
  RACH-ConfigGeneric ::= SEQUENCE {                                              
  preambleReceivedTargetPower                           -104                     
  preambleTransMax                                      n4                       
  prach-ConfigurationIndex                              14                       FR1
                                                        13                       FR1 AND HD\_FDD
                                                        149                      FR2
  zeroCorrelationZoneConfig                             12                       FR1
                                                        15                       FR2
  }                                                                              
  ----------------------------------------------------- -------------- --------- -----------------

  ----------- ----------------------------------------------------------------------------------------
  Condition   Explanation
  HD\_FDD     pc\_halfDuplexFDD\_TypeA\_RedCap\_r17 (i.e HD\_FDD UE are performing test on FDD band)
  ----------- ----------------------------------------------------------------------------------------

Table 7.1.1.1.1a.3.3-7: *TDD-UL-DL-ConfigCommon (*Table
7.1.1.1.1a.3.3-3)

  ----------------------------------------------------- ------------------- --------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-192                                 
  Information Element                                   Value/remark        Comment   Condition
  TDD-UL-DL-ConfigCommon ::= SEQUENCE {                                               
  referenceSubcarrierSpacing                            SubcarrierSpacing             
  pattern1 SEQUENCE {                                                                 
  dl-UL-TransmissionPeriodicity                         ms5                           FR1
                                                        ms0p625                       FR2
  nrofDownlinkSlots                                     3                             FR1 AND SCS30
                                                        1                             FR1 AND SCS15
                                                        3                             FR2
  nrofDownlinkSymbols                                   6                             FR1
                                                        10                            FR2
  nrofUplinkSlots                                       2                             FR1 AND SCS30
                                                        1                             FR1 AND SCS15
                                                        1                             FR2
  nrofUplinkSymbols                                     4                             
                                                        2                             FR2
  dl-UL-TransmissionPeriodicity-v1530                   ms3                           FR1
  }                                                                                   
  pattern2                                              Not present                   
  pattern2 SEQUENCE {                                                                 FR1
  dl-UL-TransmissionPeriodicity                         ms2                           
  nrofDownlinkSlots                                     4                             FR1 AND SCS30
                                                        2                             FR1 AND SCS15
  nrofDownlinkSymbols                                   0                             
  nrofUplinkSlots                                       0                             
  nrofUplinkSymbols                                     0                             
  }                                                                                   
  }                                                                                   
  ----------------------------------------------------- ------------------- --------- ---------------

Table 7.1.1.1.1a.3.3-8: ServingCellConfig (Table 7.1.1.1.1a.3.3-2)

  ----------------------------------------------------- --------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167                                   
  Information Element                                   Value/remark          Comment   Condition
  ServingCellConfig ::= SEQUENCE {                                                      
  uplinkConfig SEQUENCE {                                                               
  initialUplinkBWP                                      BWP-UplinkDedicated             
  }                                                                                     
  }                                                                                     
  ----------------------------------------------------- --------------------- --------- -----------

Table 7.1.1.1.1a.3.3-9: *BWP-UplinkDedicated (*Table 7.1.1.1.1a.3.3-8)

  ---------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-15                            
  Information Element                                  Value/remark   Comment   Condition
  BWP-UplinkDedicated ::= SEQUENCE {                                            
  pucch-Config CHOICE {                                                         
  setup                                                PUCCH-Config             
  }                                                                             
  }                                                                             
  ---------------------------------------------------- -------------- --------- -----------

Table 7.1.1.1.1a.3.3-10: *PUCCH-Config (*Table 7.1.1.1.1a.3.3-9)

  --------------------------------------------------------------------------------------------------------------------- --------------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-112                                                                                                               
  Information Element                                                                                                   Value/remark                      Comment   Condition
  PUCCH-Config ::= SEQUENCE {                                                                                                                                       
  schedulingRequestResourceToAddModList SEQUENCE (SIZE (1..maxNrofSR-Resources)) OF SchedulingRequestResourceConfig {   1 entry                                     
  SchedulingRequestResourceConfig                                                                                       SchedulingRequestResourceConfig   entry 1   
  }                                                                                                                                                                 
  }                                                                                                                                                                 
  --------------------------------------------------------------------------------------------------------------------- --------------------------------- --------- -----------

Table 7.1.1.1.1a.3.3-11: *SchedulingRequestResourceConfig (*Table
7.1.1.1.1a.3.3-10)

  ----------------------------------------------------- -------------- ----------------------------------------------------- --------------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-112                                                                        
  Information Element                                   Value/remark   Comment                                               Condition
  SchedulingRequestResourceConfig ::= SEQUENCE {                                                                             
  periodicityAndOffset CHOICE {                                                                                              
  sl10                                                  2              With SCS = kHz15 results in repetition every 10 ms    SCS15
                                                        9                                                                    SCS 15 AND HD\_FDD
  sl20                                                  5              With SCS = kHz30 results in repetition every 10 ms    SCS30
  sl80                                                  4              With SCS = kHz120 results in repetition every 10 ms   SCS120
  }                                                                                                                          
  }                                                                                                                          
  ----------------------------------------------------- -------------- ----------------------------------------------------- --------------------

  ----------- ----------------------------------------------------------------------------------------
  Condition   Explanation
  HD\_FDD     pc\_halfDuplexFDD\_TypeA\_RedCap\_r17 (i.e HD\_FDD UE are performing test on FDD band)
  ----------- ----------------------------------------------------------------------------------------

##### 7.1.1.1.2 Random access procedure / Successful / C-RNTI Based / Preamble selected by MAC itself

##### 7.1.1.1.2.1 Test Purpose (TP) {#test-purpose-tp-1 .H6}

##### (1) {#section-4 .H6}

**with** { UE in RRC\_Connected NR SpCell TimeAlignmentTimer expired,
and has UL Data to send }

**ensure that** {

**when** { the UL MAC PDU Size is less than messageSizeGroupA }

**then** { UE transmits a random access preamble using a preamble in
group A of random access preambles }

}

##### (2) {#section-5 .H6}

**with** { UE in RRC\_Connected state after transmission of a PRACH
preamble on NR SpCell }

**ensure that** {

**when** { SS does not answer with a matching Random Access Response
within ra-ResponseWindowSize }

**then** { UE retransmits a PRACH preamble from same group }

}

##### (3) {#section-6 .H6}

**with** { UE in RRC\_Connected state after transmission of a PRACH
preamble on NR SpCell }

**ensure** **that** {

**when** { UE receives while ra-ResponseWindowSizeTimer is running MAC
PDU containing multiple RARs but none of the subheaders contains a RAPID
corresponding to the UE }

**then** { UE retransmits a PRACH preamble from same group }

}

##### (4) {#section-7 .H6}

**with** { UE in RRC\_Connected state after transmission of a PRACH
preamble on NR SpCell }

**ensure that** {

**when** { SS sends a Random Access Response including a Backoff
Indicator and the Random Access Preamble identifier is different from
the value received from the UE }

**then** { UE triggers RA preamble after a random time between 0 and the
indicated Backoff parameter from same group }

}

##### (5) {#section-8 .H6}

**with** { UE in RRC\_Connected state after transmission of a PRACH
preamble on NR SpCell }

**ensure that** {

**when** { UE receives while ra-ResponseWindowSizeTimer is running MAC
PDU containing multiple RARs and one of the subheaders contains a RAPID
corresponding to the UE and containing Backoff Indicator }

**then** { UE stores Backoff Indicator UE transmits RACH procedure MSG3
}

}

##### (6) {#section-9 .H6}

**with** { UE in RRC\_Connected state after transmission of Msg3 on NR
SpCell without dedicated preamble }

**ensure that** {

**when** { The SS does not schedule any PDCCH transmission addressed to
UE C-RNTI before Contention resolution timer expiry }

**then** { UE transmits a random access preamble using a preamble in the
same group of random access preambles as used for the first transmission
of Msg3 }

}

##### (7) {#section-10 .H6}

**with** { UE in RRC\_Connected state after transmission of Msg3 on NR
SpCell without dedicated preamble }

**ensure that** {

**when** { UE receive PDCCH transmission addressed to its C-RNTI before
Contention resolution timer expiry }

**then** { UE considers RACH procedure as complete }

}

##### (8) {#section-11 .H6}

**with** { UE in RRC CONNECTED state and Random Access Preambles group B
is configured }

**ensure that** {

**when** { UE has data available for transmission and the MAC PDU Size
carrying this data is greater than ra-Msg3SizeGroupA and
TimeAlignmentTimer expires }

**then** { UE transmits a random access preamble using a preamble in
group B of random access preambles}

}

##### (9) {#section-12 .H6}

**with** { UE in RRC\_Connected state and having initiated a random
access procedure in NR SpCell }

**ensure that** {

**when** { The SS transmits a Timing Advance Command in a Random Access
Response message }

**then** { the UE applies the received Timing Advance value in the next
transmitted MAC PDU }

}

##### 7.1.1.1.2.2 Conformance requirements {#conformance-requirements-1 .H6}

References: The conformance requirements covered in the present test
case are specified in: TS 38.321, clauses 5.1.2, 5.1.3, 5.1.4, 5.1.5,
5.2, 6.1.3.2, 6.1.5 and 6.2.3. Unless otherwise stated these are Rel-15
requirements.

\[TS 38.321, clause 5.1.2\]

The MAC entity shall:

> ...

1\> else (i.e. for the contention-based Random Access preamble
selection):

2\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
is available:

3\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> if Msg3 has not yet been transmitted:

3\> if Random Access Preambles group B is configured:

4\> if the potential Msg3 size (UL data available for transmission plus
MAC header and, where required, MAC CEs) is greater than
*ra-Msg3SizeGroupA* and the pathloss is less than *PCMAX* (of the
Serving Cell performing the Random Access Procedure)
--*preambleReceivedTargetPower* -- *msg3-DeltaPreamble* --
*messagePowerOffsetGroupB*; or

4\> if the Random Access procedure was initiated for the CCCH logical
channel and the CCCH SDU size plus MAC subheader is greater than
*ra-Msg3SizeGroupA*:5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

3\> else:

4\> select the Random Access Preambles group A.

2\> else (i.e. Msg3 is being retransmitted):

3\> select the same group of Random Access Preambles as was used for the
Random Access Preamble transmission attempt corresponding to the first
transmission of Msg3.

2\> if the association between Random Access Preambles and SSBs is
configured:

3\> select a Random Access Preamble randomly with equal probability from
the Random Access Preambles associated with the selected SSB and the
selected Random Access Preambles group.

2\> else:

3\> select a Random Access Preamble randomly with equal probability from
the Random Access Preambles within the selected Random Access Preambles
group.

2\> set the *PREAMBLE\_INDEX* to the selected *ra-PreambleIndex*.

> ...

1\> if the Random Access procedure was initiated for SI request (as
specified in TS 38.331 \[5\]); and

> 1\> if *ra-AssociationPeriodIndex* and *si-RequestPeriod* are
> configured:

2\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB in the association period given by
*ra-AssociationPeriodIndex* in the *si-RequestPeriod* permitted by the
restrictions given by the *ra-ssb-OccasionMaskIndex* (the MAC entity
shall select a PRACH occasion randomly with equal probability amongst
the consecutive PRACH occasions according to subclause 8.1 of TS 38.213
\[6\] corresponding to the selected SSB).

1\> else if an SSB is selected above:

2\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB permitted by the restrictions given by
the *ra-ssb-OccasionMaskIndex* if configured (the MAC entity shall
select a PRACH occasion randomly with equal probability amongst the
consecutive PRACH occasions according to subclause 8.1 of TS 38.213
\[6\], corresponding to the selected SSB; the MAC entity may take into
account the possible occurrence of measurement gaps when determining the
next available PRACH occasion corresponding to the selected SSB).

1\> else if a CSI-RS is selected above:

2\> if there is no contention-free Random Access Resource associated
with the selected CSI-RS:

3\> determine the next available PRACH occasion from the PRACH
occasions, permitted by the restrictions given by the
*ra-ssb-OccasionMaskIndex* if configured, corresponding to the SSB in
*candidateBeamRSList* which is quasi-collocated with the selected CSI-RS
as specified in TS 38.214 \[7\] (the MAC entity may take into account
the possible occurrence of measurement gaps when determining the next
available PRACH occasion corresponding to the SSB which is
quasi-collected with the selected CSI-RS).

2\> else:

3\> determine the next available PRACH occasion from the PRACH occasions
in *ra-OccasionList* corresponding to the selected CSI-RS (the MAC
entity shall select a PRACH occasion randomly with equal probability
amongst the PRACH occasions occurring simultaneously but on different
subcarriers, corresponding to the selected CSI-RS; the MAC entity may
take into account the possible occurrence of measurement gaps when
determining the next available PRACH occasion corresponding to the
selected CSI-RS).

1\> perform the Random Access Preamble transmission procedure (see
subclause 5.1.3).

\[TS 38.321, clause 5.1.3\]

The MAC entity shall, for each Random Access Preamble:

1\> if *PREAMBLE\_TRANSMISSION\_COUNTER* is greater than one; and

1\> if the notification of suspending power ramping counter has not been
received from lower layers; and

1\> if SSB selected is not changed (i.e. same as the previous Random
Access Preamble transmission):

2\> increment *PREAMBLE\_POWER\_RAMPING\_COUNTER* by 1.

1\> select the value of *DELTA\_PREAMBLE* according to subclause 7.3;

1\> set *PREAMBLE\_RECEIVED\_TARGET\_POWER* to
*preambleReceivedTargetPower* + *DELTA\_PREAMBLE* +
(*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*;

1\> except for contention-free Random Access Preamble for beam failure
recovery request, compute the RA-RNTI associated with the PRACH occasion
in which the Random Access Preamble is transmitted;

1\> instruct the physical layer to transmit the Random Access Preamble
using the selected PRACH, corresponding RA-RNTI (if available),
*PREAMBLE\_INDEX* and *PREAMBLE\_RECEIVED\_TARGET\_POWER*.

The RA-RNTI associated with the PRACH in which the Random Access
Preamble is transmitted, is computed as:

RA-RNTI= 1 + s\_id + 14 Ã— t\_id + 14 Ã— 80 Ã— f\_id + 14 Ã— 80 Ã— 8 Ã—
ul\_carrier\_id

where s\_id is the index of the first OFDM symbol of the specified PRACH
(0 â‰¤ s\_id \< 14), t\_id is the index of the first slot of the specified
PRACH in a system frame (0 â‰¤ t\_id \< 80), f\_id is the index of the
specified PRACH in the frequency domain (0 â‰¤ f\_id \< 8), and
ul\_carrier\_id is the UL carrier used for Msg1 transmission (0 for NUL
carrier, and 1 for SUL carrier).

\[TS 38.321, clause 5.1.4\]

Once the Random Access Preamble is transmitted and regardless of the
possible occurrence of a measurement gap, the MAC entity shall:

> ...

1\> else:

2\> start the *ra-ResponseWindow* configured in *RACH-ConfigCommon* at
the first PDCCH occasion as specified in TS 38.213 \[6\] from the end of
the Random Access Preamble transmission;

2\> monitor the PDCCH of the SpCell for Random Access Response(s)
identified by the RA-RNTI while the *ra-ResponseWindow* is running.

1\> if notification of a reception of a PDCCH transmission is received
from lower layers on the Serving Cell where the preamble was
transmitted; and

1\> if PDCCH transmission is addressed to the C-RNTI; and

1\> if the contention-free Random Access Preamble for beam failure
recovery request was transmitted by the MAC entity:

2\> consider the Random Access procedure successfully completed.

1\> else if a downlink assignment has been received on the PDCCH for the
RA-RNTI and the received TB is successfully decoded:

2\> if the Random Access Response contains a MAC subPDU with Backoff
Indicator:

3\> set the *PREAMBLE\_BACKOFF* to value of the BI field of the MAC
subPDU using Table 7.2-1, multiplied with *SCALING\_FACTOR\_B*I.

2\> else:

3\> set the *PREAMBLE\_BACKOFF* to 0 ms.

2\> if the Random Access Response contains a MAC subPDU with Random
Access Preamble identifier corresponding to the transmitted
*PREAMBLE\_INDEX* (see subclause 5.1.3):

3\> consider this Random Access Response reception successful.

2\> if the Random Access Response reception is considered successful:

3\> if the Random Access Response includes RAPID only:

4\> consider this Random Access procedure successfully completed;

4\> indicate the reception of an acknowledgement for the SI request to
upper layers.

3\> else:

4\> apply the following actions for the Serving Cell where the Random
Access Preamble was transmitted:

5\> process the received Timing Advance Command (see subclause 5.2);

5\> indicate the *preambleReceivedTargetPower* and the amount of power
ramping applied to the latest Random Access Preamble transmission to
lower layers (i.e. (*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*preamblePowerRampingStep*).

5\> if the Serving Cell for the Random Access procedure is SRS-only
SCell:

6\> ignore the received UL grant.

5\> else:

6\> process the received UL grant value and indicate it to the lower
layers.

4\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

5\> consider the Random Access procedure successfully completed.

4\> else:

5\> set the *TEMPORARY\_C-RNTI* to the value received in the Random
Access Response;

> ...

1\> if *ra-ResponseWindow* configured in *RACH-ConfigCommon* expires,
and if the Random Access Response containing Random Access Preamble
identifiers that matches the transmitted *PREAMBLE\_INDEX* has not been
received; or

1\> if *ra-ResponseWindow* configured in *BeamFailureRecoveryConfig*
expires and if the PDCCH addressed to the C-RNTI has not been received
on the Serving Cell where the preamble was transmitted:

2\> consider the Random Access Response reception not successful;

2\> increment *PREAMBLE\_TRANSMISSION\_COUNTER* by 1;

2\> if *PREAMBLE\_TRANSMISSION\_COUNTER* = *preambleTxMax* + 1:

3\> if the Random Access Preamble is transmitted on the SpCell:

4\> indicate a Random Access problem to upper layers.

4\> if this Random Access procedure was triggered for SI request:

5\> consider the Random Access procedure unsuccessfully completed.

\> else if the Random Access Preamble is transmitted on a SCell:

4\> consider the Random Access procedure unsuccessfully completed.

2\> if the Random Access procedure is not completed:

3\> select a random backoff time according to a uniform distribution
between 0 and the *PREAMBLE\_BACKOFF*;

3\> if the criteria (as defined in subclause 5.1.2) to select
contention-free Random Access Resources is met during the backoff time:

4\> perform the Random Access Resource selection procedure (see
subclause 5.1.2);

3\> else:

4\> perform the Random Access Resource selection procedure (see
subclause 5.1.2) after the backoff time.

The MAC entity may stop *ra-ResponseWindow* (and hence monitoring for
Random Access Response(s)) after successful reception of a Random Access
Response containing Random Access Preamble identifiers that matches the
transmitted *PREAMBLE\_INDEX*.

HARQ operation is not applicable to the Random Access Response
transmission.

\[TS 38.321, clause 5.1.5\]

Once Msg3 is transmitted, the MAC entity shall:

1\> start the *ra-ContentionResolutionTimer* and restart the
*ra-ContentionResolutionTimer* at each HARQ retransmission in the first
symbol after the end of the Msg3 transmission;

1\> monitor the PDCCH while the *ra-ContentionResolutionTimer* is
running regardless of the possible occurrence of a measurement gap;

1\> if notification of a reception of a PDCCH transmission of the SpCell
is received from lower layers:

2\> if the C-RNTI MAC CE was included in Msg3:

3\> if the Random Access procedure was initiated by the MAC sublayer
itself or by the RRC sublayer and the PDCCH transmission is addressed to
the C-RNTI and contains a UL grant for a new transmission; or

3\> if the Random Access procedure was initiated by a PDCCH order and
the PDCCH transmission is addressed to the C-RNTI; or

3\> if the Random Access procedure was initiated by a beam failure
indication from lower layer and the PDCCH transmission is addressed to
the C-RNTI:

4\> consider this Contention Resolution successful;

4\> stop *ra-ContentionResolutionTimer*;

4\> discard the *TEMPORARY\_C-RNTI*;

4\> consider this Random Access procedure successfully completed.

...

1\> if *ra-ContentionResolutionTimer* expires:

2\> discard the *TEMPORARY\_C-RNTI*;

2\> consider the Contention Resolution not successful.

1\> if the Contention Resolution is considered not successful:

2\> flush the HARQ buffer used for transmission of the MAC PDU in the
Msg3 buffer;

2\> increment PREAMBLE\_TRANSMISSION\_COUNTER by 1;

2\> if *PREAMBLE\_TRANSMISSION\_COUNTER* = *preambleTxMax* + 1:

3\> indicate a Random Access problem to upper layers.

3\> if this Random Access procedure was triggered for SI request:

4\> consider the Random Access procedure unsuccessfully completed.

2\> if the Random Access procedure is not completed:

3\> select a random backoff time according to a uniform distribution
between 0 and the PREAMBLE\_BACKOFF;

3\> if the criteria (as defined in subclause 5.1.2) to select
contention-free Random Access Resources is met during the backoff time:

4\> perform the Random Access Resource selection procedure (see
subclause 5.1.2);

3\> else:

4\> perform the Random Access Resource selection procedure (see
subclause 5.1.2) after the backoff time.

\[TS 38.321, clause 5.2\]

RRC configures the following parameters for the maintenance of UL time
alignment:

\- *timeAlignmentTimer* (per TAG) which controls how long the MAC entity
considers the Serving Cells belonging to the associated TAG to be uplink
time aligned.

The MAC entity shall:

1\> when a Timing Advance Command MAC CE is received, and if a N~TA~ (as
defined in TS 38.211 \[8\]) has been maintained with the indicated TAG:

2\> apply the Timing Advance Command for the indicated TAG;

2\> start or restart the *timeAlignmentTimer* associated with the
indicated TAG.

...

1\> when a *timeAlignmentTimer* expires:

2\> if the *timeAlignmentTimer* is associated with the PTAG:

3\> flush all HARQ buffers for all Serving Cells;

3\> notify RRC to release PUCCH for all Serving Cells, if configured;

3\> notify RRC to release SRS for all Serving Cells, if configured;

3\> clear any configured downlink assignments and configured uplink
grants;

3\> clear any PUSCH resource for semi-persistent CSI reporting;

3\> consider all running *timeAlignmentTimer*s as expired;

3\> maintain N~TA~ (defined in TS 38.211 \[8\]) of all TAGs.

2\> else if the *timeAlignmentTimer* is associated with an STAG, then
for all Serving Cells belonging to this TAG*:*

3\> flush all HARQ buffers;

3\> notify RRC to release PUCCH, if configured;

3\> notify RRC to release SRS, if configured;

3\> clear any configured downlink assignments and configured uplink
grants;

3\> clear any PUSCH resource for semi-persistent CSI reporting;

3\> maintain N~TA~ (defined in TS 38.211 \[8\]) of this TAG.

When the MAC entity stops uplink transmissions for an SCell due to the
fact that the maximum uplink transmission timing difference between TAGs
of the MAC entity or the maximum uplink transmission timing difference
between TAGs of any MAC entity of the UE is exceeded, the MAC entity
considers the *timeAlignmentTimer* associated with the SCell as expired.

The MAC entity shall not perform any uplink transmission on a Serving
Cell except the Random Access Preamble transmission when the
*timeAlignmentTimer* associated with the TAG to which this Serving Cell
belongs is not running. Furthermore, when the *timeAlignmentTimer*
associated with the pTAG is not running, the MAC entity shall not
perform any uplink transmission on any Serving Cell except the Random
Access Preamble transmission on the SpCell.

\[TS 38.321, clause 6.1.3.2\]

The C-RNTI MAC CE is identified by MAC PDU subheader with LCID as
specified in Table 6.2.1-2.

It has a fixed size and consists of a single field defined as follows
(Figure 6.1.3.2-1):

\- C-RNTI: This field contains the C-RNTI of the MAC entity. The length
of the field is 16 bits.

![](./media/image1.emf)

Figure 6.1.3.2-1: C-RNTI MAC CE

\[TS 38.321, clause 6.1.5\]

A MAC PDU consists of one or more MAC subPDUs and optionally padding.
Each MAC subPDU consists one of the following:

\- a MAC subheader with Backoff Indicator only;

\- a MAC subheader with RAPID only (i.e. acknowledgment for SI request);

\- a MAC subheader with RAPID and MAC RAR.

A MAC subheader with Backoff Indicator consists of five header fields
E/T/R/R/BI as described in Figure 6.1.5-1. A MAC subPDU with Backoff
Indicator only is placed at the beginning of the MAC PDU, if included.
\'MAC subPDU(s) with RAPID only\' and \'MAC subPDU(s) with RAPID and MAC
RAR\' can be placed anywhere between MAC subPDU with Backoff Indicator
only (if any) and padding (if any).

A MAC subheader with RAPID consists of three header fields E/T/RAPID as
described in Figure 6.1.5-2.

Padding is placed at the end of the MAC PDU if present. Presence and
length of padding is implicit based on TB size, size of MAC subPDU(s).

![](./media/image2.emf)

Figure 6.1.5-1: E/T/R/R/BI MAC subheader

![](./media/image3.emf)

Figure 6.1.5-2: E/T/RAPID MAC subheader

![](./media/image4.emf)

Figure 6.1.5-3: Example of MAC PDU consisting of MAC RARs

\[TS 38.321, clause 6.2.3\]

The MAC RAR is of fixed size as depicted in Figure 6.2.3-1, and consists
of the following fields:

\- R: Reserved bit, set to \"0\";

\- Timing Advance Command: The Timing Advance Command field indicates
the index value *T~A~* used to control the amount of timing adjustment
that the MAC entity has to apply in TS 38.213 \[6\]. The size of the
Timing Advance Command field is 12 bits;

\- UL Grant: The Uplink Grant field indicates the resources to be used
on the uplink in TS 38.213 \[6\]. The size of the UL Grant field is 27
bits;

\- Temporary C-RNTI: The Temporary C-RNTI field indicates the temporary
identity that is used by the MAC entity during Random Access. The size
of the Temporary C-RNTI field is 16 bits.

The MAC RAR is octet aligned.

Figure 6.2.3-1: MAC RAR

##### 7.1.1.1.2.3 Test description {#test-description-1 .H6}

##### 7.1.1.1.2.3.1 Pre-test conditions {#pre-test-conditions-1 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that Short\_DCI
condition is applied in NR Serving cell configuration.

##### 7.1.1.1.2.3.2 Test procedure sequence {#test-procedure-sequence-1 .H6}

Table 7.1.1.1.2.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Step 0AA  |           |           |         |    |
|           | is        |           |           |         |    |
|           | performed |           |           |         |    |
|           | IF        |           |           |         |    |
|           | pc\_NG    |           |           |         |    |
|           | \_RAN\_NR |           |           |         |    |
|           | only.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 0AA       | The SS    | \-        | \-        | \-      | \- |
|           | transmits |           |           |         |    |
|           | an        |           |           |         |    |
|           | updated   |           |           |         |    |
|           | system    |           |           |         |    |
|           | in        |           |           |         |    |
|           | formation |           |           |         |    |
|           | as        |           |           |         |    |
|           | specified |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.1.  |           |           |         |    |
|           | 2.3.3-1A. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 0A        | SS        | \<\--     | (R        | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an        |           | guration) |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | *         |           |           |         |    |
|           | configure |           |           |         |    |
|           | specific  |           |           |         |    |
|           | pa        |           |           |         |    |
|           | rameters. |           |           |         |    |
|           | (Note 1)* |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 0B        | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | RRCRecon  |           | gurationC |         |    |
|           | figuratio |           | omplete)* |         |    |
|           | nComplete |           |           |         |    |
|           | message.  |           |           |         |    |
|           | *(Note    |           |           |         |    |
|           | 2)*       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (Timing   |         |    |
|           | Timing    |           | Advance   |         |    |
|           | Advance   |           |           |         |    |
|           | command   |           | Command   |         |    |
|           | to        |           | MAC       |         |    |
|           | SpCell.   |           | Control   |         |    |
|           | SS does   |           | Element)  |         |    |
|           | not send  |           |           |         |    |
|           | any       |           |           |         |    |
|           | s         |           |           |         |    |
|           | ubsequent |           |           |         |    |
|           | timing    |           |           |         |    |
|           | al        |           |           |         |    |
|           | ignments. |           |           |         |    |
|           | Start     |           |           |         |    |
|           | Timer\_T1 |           |           |         |    |
|           | = Time    |           |           |         |    |
|           | Alignment |           |           |         |    |
|           | timer     |           |           |         |    |
|           | value on  |           |           |         |    |
|           | SS.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | 40 to 50  | \<\--     | MAC PDU   | \-      | \- |
|           | TTI       |           |           |         |    |
|           | before    |           |           |         |    |
|           | Timer\_T1 |           |           |         |    |
|           | expires   |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a PDCP    |           |           |         |    |
|           | SDU of    |           |           |         |    |
|           | size 56   |           |           |         |    |
|           | bits,     |           |           |         |    |
|           | less then |           |           |         |    |
|           | ra-Msg3S  |           |           |         |    |
|           | izeGroupA |           |           |         |    |
|           | (208      |           |           |         |    |
|           | bits) on  |           |           |         |    |
|           | SpCell.   |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \-        | \-        | \-      | \- |
|           | ignores   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | requests  |           |           |         |    |
|           | and does  |           |           |         |    |
|           | not       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | any       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | Check:    | \--\>     | PRACH     | 1       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | using a   |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | in group  |           |           |         |    |
|           | A defined |           |           |         |    |
|           | in        |           |           |         |    |
|           | CellGr    |           |           |         |    |
|           | oupConfig |           |           |         |    |
|           | in        |           |           |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | (totalNum |           |           |         |    |
|           | berOfRA-P |           |           |         |    |
|           | reambles, |           |           |         |    |
|           | ssb-p     |           |           |         |    |
|           | erRACH-Oc |           |           |         |    |
|           | casionAnd |           |           |         |    |
|           | CB-Preamb |           |           |         |    |
|           | lesPerSSB |           |           |         |    |
|           | and       |           |           |         |    |
|           | numberOfR |           |           |         |    |
|           | A-Preambl |           |           |         |    |
|           | esGroupA) |           |           |         |    |
|           | on SpCell |           |           |         |    |
|           | in frame  |           |           |         |    |
|           | number X  |           |           |         |    |
|           | meeting   |           |           |         |    |
|           | condition |           |           |         |    |
|           | n~SFN~    |           |           |         |    |
|           | mod 8 =1, |           |           |         |    |
|           | subframe  |           |           |         |    |
|           | number    |           |           |         |    |
|           | 2,6,9     |           |           |         |    |
|           | (FDD FR1  |           |           |         |    |
|           | except    |           |           |         |    |
|           | for       |           |           |         |    |
|           | HD\_FDD), |           |           |         |    |
|           | frame     |           |           |         |    |
|           | number X  |           |           |         |    |
|           | meeting   |           |           |         |    |
|           | condition |           |           |         |    |
|           | nSFN mod  |           |           |         |    |
|           | 8 =1,     |           |           |         |    |
|           | subframe  |           |           |         |    |
|           | number 4  |           |           |         |    |
|           | (         |           |           |         |    |
|           | HD\_FDD), |           |           |         |    |
|           | frame     |           |           |         |    |
|           | number X  |           |           |         |    |
|           | meeting   |           |           |         |    |
|           | condition |           |           |         |    |
|           | nSFN mod  |           |           |         |    |
|           | 2 =1,     |           |           |         |    |
|           | subframe  |           |           |         |    |
|           | number    |           |           |         |    |
|           | 8,9 (FR1  |           |           |         |    |
|           | TDD) and  |           |           |         |    |
|           | frame     |           |           |         |    |
|           | number X  |           |           |         |    |
|           | meeting   |           |           |         |    |
|           | condition |           |           |         |    |
|           | nSFN mod  |           |           |         |    |
|           | 4 =1 and  |           |           |         |    |
|           | slot      |           |           |         |    |
|           | number 8, |           |           |         |    |
|           | 9, 18,    |           |           |         |    |
|           | 19, 28,   |           |           |         |    |
|           | 29, 38,   |           |           |         |    |
|           | 39 , 48,  |           |           |         |    |
|           | 49, 58,   |           |           |         |    |
|           | 59, 68,   |           |           |         |    |
|           | 69, 78,   |           |           |         |    |
|           | 79 (FR2   |           |           |         |    |
|           | 120 kHz)? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Check:    | \--\>     | PRACH     | 2       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH, |           |           |         |    |
|           | in frame  |           |           |         |    |
|           | number    |           |           |         |    |
|           | X+8       |           |           |         |    |
|           | subframe  |           |           |         |    |
|           | number    |           |           |         |    |
|           | 2,6,9     |           |           |         |    |
|           | (FDD FR1  |           |           |         |    |
|           | except    |           |           |         |    |
|           | for       |           |           |         |    |
|           | HD\_FDD), |           |           |         |    |
|           | in frame  |           |           |         |    |
|           | number    |           |           |         |    |
|           | X+8       |           |           |         |    |
|           | subframe  |           |           |         |    |
|           | number 4  |           |           |         |    |
|           | (         |           |           |         |    |
|           | HD\_FDD), |           |           |         |    |
|           | in frame  |           |           |         |    |
|           | number X  |           |           |         |    |
|           | or X+2 in |           |           |         |    |
|           | subrame   |           |           |         |    |
|           | number    |           |           |         |    |
|           | 8,9 (FR1  |           |           |         |    |
|           | TDD) and  |           |           |         |    |
|           | frame     |           |           |         |    |
|           | number X  |           |           |         |    |
|           | or X+4    |           |           |         |    |
|           | and slot  |           |           |         |    |
|           | number 8, |           |           |         |    |
|           | 9, 18,    |           |           |         |    |
|           | 19, 28,   |           |           |         |    |
|           | 29, 38,   |           |           |         |    |
|           | 39 , 48,  |           |           |         |    |
|           | 49, 58,   |           |           |         |    |
|           | 59, 68,   |           |           |         |    |
|           | 69, 78,   |           |           |         |    |
|           | 79 (FR2   |           |           |         |    |
|           | 120 kHz)  |           |           |         |    |
|           | using the |           |           |         |    |
|           | same      |           |           |         |    |
|           | group A?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | a MAC PDU |           | Response  |         |    |
|           | addressed |           |           |         |    |
|           | to UE     |           |           |         |    |
|           | RA-RNTI,  |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | multiple  |           |           |         |    |
|           | RARs but  |           |           |         |    |
|           | none of   |           |           |         |    |
|           | the MAC   |           |           |         |    |
|           | sub       |           |           |         |    |
|           | headers   |           |           |         |    |
|           | contains  |           |           |         |    |
|           | a         |           |           |         |    |
|           | matching  |           |           |         |    |
|           | RAPID on  |           |           |         |    |
|           | SpCell.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | In        |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | with step |           |           |         |    |
|           | 7,        |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | behaviour |           |           |         |    |
|           | defined   |           |           |         |    |
|           | in table  |           |           |         |    |
|           | 7.1.1.    |           |           |         |    |
|           | 1.2.3.2-2 |           |           |         |    |
|           | is        |           |           |         |    |
|           | executed. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | Check:    | \--\>     | PRACH     | 3       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | re        |           |           |         |    |
|           | -transmit |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | on SpCell |           |           |         |    |
|           | using the |           |           |         |    |
|           | same      |           |           |         |    |
|           | group A?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | a Random  |           | Res       |         |    |
|           | Access    |           | ponse(BI, |         |    |
|           | Response  |           | RAPID)    |         |    |
|           | with the  |           |           |         |    |
|           | back off  |           |           |         |    |
|           | parameter |           |           |         |    |
|           | set to    |           |           |         |    |
|           | value     |           |           |         |    |
|           | Index     |           |           |         |    |
|           | field     |           |           |         |    |
|           | \'12\'    |           |           |         |    |
|           | and with  |           |           |         |    |
|           | the       |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | i         |           |           |         |    |
|           | dentifier |           |           |         |    |
|           | different |           |           |         |    |
|           | from the  |           |           |         |    |
|           | value     |           |           |         |    |
|           | received  |           |           |         |    |
|           | from the  |           |           |         |    |
|           | UE in the |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Preamble. |           |           |         |    |
|           |           |           |           |         |    |
|           | The SS    |           |           |         |    |
|           | sets      |           |           |         |    |
|           | Timer\_T2 |           |           |         |    |
|           | to the    |           |           |         |    |
|           | Back off  |           |           |         |    |
|           | value     |           |           |         |    |
|           | '960'     |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssociated |           |           |         |    |
|           | with the  |           |           |         |    |
|           | Index     |           |           |         |    |
|           | value     |           |           |         |    |
|           | '12' and  |           |           |         |    |
|           | starts    |           |           |         |    |
|           | T         |           |           |         |    |
|           | imer\_T2. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | Check:    | \--\>     | Random    | 4       | P  |
|           | Does UE   |           | Access    |         |    |
|           | send a    |           | Preamble  |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | on SpCell |           |           |         |    |
|           | while     |           |           |         |    |
|           | Timer\_T2 |           |           |         |    |
|           | is        |           |           |         |    |
|           | running?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | SS sends  | \<\--     | Random    | \-      | \- |
|           | Random    |           | Access    |         |    |
|           | Access    |           | Res       |         |    |
|           | Response  |           | ponse(BI, |         |    |
|           | with an   |           | RAPID)    |         |    |
|           | UL Grant  |           |           |         |    |
|           | of        |           |           |         |    |
|           | 56-bits,  |           |           |         |    |
|           | a back    |           |           |         |    |
|           | off       |           |           |         |    |
|           | parameter |           |           |         |    |
|           | set to    |           |           |         |    |
|           | value     |           |           |         |    |
|           | Index     |           |           |         |    |
|           | field     |           |           |         |    |
|           | '13' and  |           |           |         |    |
|           | the       |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | i         |           |           |         |    |
|           | dentifier |           |           |         |    |
|           | value set |           |           |         |    |
|           | to the    |           |           |         |    |
|           | same      |           |           |         |    |
|           | value as  |           |           |         |    |
|           | received  |           |           |         |    |
|           | from the  |           |           |         |    |
|           | UE in the |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Preamble. |           |           |         |    |
|           | (Note 4)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | Check:    | \--\>     | msg3      | 5       | P  |
|           | Does UE   |           | (C-RNTI   |         |    |
|           | sends a   |           | MAC       |         |    |
|           | msg3 in   |           | CONTROL   |         |    |
|           | the grant |           | ELEMENT)  |         |    |
|           | a         |           |           |         |    |
|           | ssociated |           |           |         |    |
|           | to the    |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Â´Response |           |           |         |    |
|           | received  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 10 on     |           |           |         |    |
|           | SpCell?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | SS does   | \-        | \-        | \-      | \- |
|           | not       |           |           |         |    |
|           | schedule  |           |           |         |    |
|           | any PDCCH |           |           |         |    |
|           | tra       |           |           |         |    |
|           | nsmission |           |           |         |    |
|           | for UE    |           |           |         |    |
|           | C-RNTI.   |           |           |         |    |
|           |           |           |           |         |    |
|           | The SS    |           |           |         |    |
|           | sets      |           |           |         |    |
|           | Timer\_T3 |           |           |         |    |
|           | to the    |           |           |         |    |
|           | Back off  |           |           |         |    |
|           | value     |           |           |         |    |
|           | '1920'    |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssociated |           |           |         |    |
|           | with the  |           |           |         |    |
|           | Index     |           |           |         |    |
|           | value     |           |           |         |    |
|           | '13' plus |           |           |         |    |
|           | C         |           |           |         |    |
|           | ontention |           |           |         |    |
|           | R         |           |           |         |    |
|           | esolution |           |           |         |    |
|           | Timer and |           |           |         |    |
|           | starts    |           |           |         |    |
|           | T         |           |           |         |    |
|           | imer\_T3. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | Check:    | \--\>     | PRACH     | 6       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | using a   |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | belonging |           |           |         |    |
|           | to group  |           |           |         |    |
|           | A for     |           |           |         |    |
|           | time      |           |           |         |    |
|           | equal to  |           |           |         |    |
|           | Timer\_T3 |           |           |         |    |
|           | on        |           |           |         |    |
|           | SpCell?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | Random    |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | with an   |           |           |         |    |
|           | UL Grant  |           |           |         |    |
|           | of        |           |           |         |    |
|           | 56-bits   |           |           |         |    |
|           | and RAPID |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to the    |           |           |         |    |
|           | tr        |           |           |         |    |
|           | ansmitted |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 13,       |           |           |         |    |
|           | including |           |           |         |    |
|           | T-CRNTI.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | UE sends  | \--\>     | msg3      | \-      | \- |
|           | a msg3    |           | (C-RNTI   |         |    |
|           | using the |           | MAC       |         |    |
|           | grant     |           | CONTROL   |         |    |
|           | a         |           | ELEMENT)  |         |    |
|           | ssociated |           |           |         |    |
|           | to the    |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Â´Response |           |           |         |    |
|           | received  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 14 on     |           |           |         |    |
|           | SpCell?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 16        | SS        | \<\--     | C         | \-      | \- |
|           | schedules |           | ontention |         |    |
|           | PDCCH     |           | R         |         |    |
|           | tra       |           | esolution |         |    |
|           | nsmission |           |           |         |    |
|           | for UE    |           |           |         |    |
|           | C\_RNTI   |           |           |         |    |
|           | and       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | In        |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | with step |           |           |         |    |
|           | 17,       |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | behaviour |           |           |         |    |
|           | defined   |           |           |         |    |
|           | in table  |           |           |         |    |
|           | 7.1.1.    |           |           |         |    |
|           | 1.2.3.2-3 |           |           |         |    |
|           | is        |           |           |         |    |
|           | executed. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17        | Check:    | \--\>     | MAC PDU   | 7       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | with      |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back PDCP |           |           |         |    |
|           | SDU?      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Step 17AA |           |           |         |    |
|           | is        |           |           |         |    |
|           | performed |           |           |         |    |
|           | IF        |           |           |         |    |
|           | pc\_NG    |           |           |         |    |
|           | \_RAN\_NR |           |           |         |    |
|           | only.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17AA      | The SS    | \-        | \-        | \-      | \- |
|           | transmits |           |           |         |    |
|           | an        |           |           |         |    |
|           | updated   |           |           |         |    |
|           | system    |           |           |         |    |
|           | in        |           |           |         |    |
|           | formation |           |           |         |    |
|           | as        |           |           |         |    |
|           | specified |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.1.  |           |           |         |    |
|           | 2.3.3-1A. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17A       | The SS    | \<\--     | (NR RRC:  | \-      | \- |
|           | transmits |           | R         |         |    |
|           | an        |           | RCReconfi |         |    |
|           | RRCReconf |           | guration) |         |    |
|           | iguration |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | *         |           |           |         |    |
|           | configure |           |           |         |    |
|           | specific  |           |           |         |    |
|           | pa        |           |           |         |    |
|           | rameters. |           |           |         |    |
|           | (Note 1)* |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17B       | The UE    | \--\>     | (NR RRC:  | \-      | \- |
|           | transmits |           | R         |         |    |
|           | an        |           | RCReconfi |         |    |
|           | RRCRecon  |           | gurationt |         |    |
|           | figuratio |           | Complete) |         |    |
|           | nComplete |           |           |         |    |
|           | message.  |           |           |         |    |
|           | (*Note    |           |           |         |    |
|           | 2)*       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 18        | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (Timing   |         |    |
|           | Timing    |           | Advance   |         |    |
|           | Advance   |           |           |         |    |
|           | command   |           | Command   |         |    |
|           | to        |           | MAC       |         |    |
|           | SpCell.   |           | Control   |         |    |
|           | SS does   |           | Element)  |         |    |
|           | not send  |           |           |         |    |
|           | any       |           |           |         |    |
|           | s         |           |           |         |    |
|           | ubsequent |           |           |         |    |
|           | timing    |           |           |         |    |
|           | al        |           |           |         |    |
|           | ignments. |           |           |         |    |
|           | Start     |           |           |         |    |
|           | Timer\_T4 |           |           |         |    |
|           | = Time    |           |           |         |    |
|           | Alignment |           |           |         |    |
|           | timer     |           |           |         |    |
|           | value on  |           |           |         |    |
|           | SS.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19        | 40 to 50  | \<\--     | MAC PDU   | \-      | \- |
|           | TTI       |           |           |         |    |
|           | before    |           |           |         |    |
|           | Timer\_T4 |           |           |         |    |
|           | expires   |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a PDCP    |           |           |         |    |
|           | SDU of    |           |           |         |    |
|           | size \>   |           |           |         |    |
|           | ra-Msg3S  |           |           |         |    |
|           | izeGroupA |           |           |         |    |
|           | (208      |           |           |         |    |
|           | bits).    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 20        | The SS    | \-        | \-        | \-      | \- |
|           | ignores   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | requests  |           |           |         |    |
|           | and does  |           |           |         |    |
|           | not       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | any       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 21        | Check:    | \--\>     | PRACH     | 8       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | using a   |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | in group  |           |           |         |    |
|           | B defined |           |           |         |    |
|           | in        |           |           |         |    |
|           | CellGr    |           |           |         |    |
|           | oupConfig |           |           |         |    |
|           | in        |           |           |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | (ssb-pe   |           |           |         |    |
|           | rRACH-Occ |           |           |         |    |
|           | asionAndC |           |           |         |    |
|           | B-Preambl |           |           |         |    |
|           | esPerSSB, |           |           |         |    |
|           | numberOf  |           |           |         |    |
|           | RA-Preamb |           |           |         |    |
|           | lesGroupA |           |           |         |    |
|           | and       |           |           |         |    |
|           | num       |           |           |         |    |
|           | berOfRA-P |           |           |         |    |
|           | reambles) |           |           |         |    |
|           | on        |           |           |         |    |
|           | SpCell?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 22        | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | Random    |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | with an   |           |           |         |    |
|           | UL Grant  |           |           |         |    |
|           | of        |           |           |         |    |
|           | 56-bits   |           |           |         |    |
|           | and RAPID |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to the    |           |           |         |    |
|           | tr        |           |           |         |    |
|           | ansmitted |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 21,       |           |           |         |    |
|           | including |           |           |         |    |
|           | T-CRNTI.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 23        | UE sends  | \--\>     | msg3      | \-      | \- |
|           | a msg3    |           | (C-RNTI   |         |    |
|           | using the |           | MAC       |         |    |
|           | grant     |           | CONTROL   |         |    |
|           | a         |           | ELEMENT)  |         |    |
|           | ssociated |           |           |         |    |
|           | to the    |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Â´Response |           |           |         |    |
|           | received  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 22 on     |           |           |         |    |
|           | SpCell?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 23A       | SS        | \<\--     | C         | \-      | \- |
|           | schedules |           | ontention |         |    |
|           | PDCCH     |           | R         |         |    |
|           | tra       |           | esolution |         |    |
|           | nsmission |           |           |         |    |
|           | for UE    |           |           |         |    |
|           | C\_RNTI   |           |           |         |    |
|           | and       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 24        | Check:    | \--\>     | MAC PDU   | 9       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | with      |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back PDCP |           |           |         |    |
|           | SDU?      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *R        |           |           |           |         |    |
| RCReconfi |           |           |           |         |    |
| guration* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RRC      |           |           |           |         |    |
| Connectio |           |           |           |         |    |
| nReconfig |           |           |           |         |    |
| uration.* |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| MAC PDU   |           |           |           |         |    |
| size of   |           |           |           |         |    |
| 56bits is |           |           |           |         |    |
| selected  |           |           |           |         |    |
| to allow  |           |           |           |         |    |
| UE send   |           |           |           |         |    |
| status    |           |           |           |         |    |
| PDU and   |           |           |           |         |    |
| still     |           |           |           |         |    |
| stays     |           |           |           |         |    |
| below the |           |           |           |         |    |
| limit of  |           |           |           |         |    |
| r         |           |           |           |         |    |
| a-Msg3Siz |           |           |           |         |    |
| eGrioupA. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 4:   |           |           |           |         |    |
| UL grant  |           |           |           |         |    |
| of 56bits |           |           |           |         |    |
| is to     |           |           |           |         |    |
| make UE   |           |           |           |         |    |
| not send  |           |           |           |         |    |
| any       |           |           |           |         |    |
| loopback  |           |           |           |         |    |
| data in   |           |           |           |         |    |
| uplink    |           |           |           |         |    |
| with      |           |           |           |         |    |
| msg3.     |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

Table 7.1.1.1.2.3.2-2: Parallel behaviour

  St   Procedure                                             Message Sequence   TP                                  Verdict   
  ---- ----------------------------------------------------- ------------------ ----------------------------------- --------- ---
                                                             U - S              Message                                       
  1    Check: Does the UE transmit msg3 message on SpCell?   \--\>              msg3 (C-RNTI MAC CONTROL ELEMENT)   \-        F

Table 7.1.1.1.2.3.2-3: Parallel behaviour

  St   Procedure                                                  Message Sequence   TP               Verdict   
  ---- ---------------------------------------------------------- ------------------ ---------------- --------- ---
                                                                  U - S              Message                    
  1    Check: Does the UE transmit an PRACH preamble on SpCell?   \--\>              PRACH Preamble   \-        F

##### 7.1.1.1.2.3.3 Specific message contents {#specific-message-contents-1 .H6}

Table 7.1.1.1.2.3.3-1: *MAC-CellGroupConfig* (preamble)

  ------------------------------------------------------------ -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-68                                    
  Information Element                                          Value/remark   Comment   Condition
  MAC-CellGroupConfig ::= SEQUENCE {                                                    
  tag-Config SEQUENCE {                                                                 
  tag-ToAddModList SEQUENCE (SIZE (1..maxNrofTAGs)) OF TAG {   1 entry                  
  TAG\[1\] SEQUENCE {                                                         entry 1   
  timeAlignmentTimer                                           ms750                    
  }                                                                                     
  }                                                                                     
  }                                                                                     
  }                                                                                     
  ------------------------------------------------------------ -------------- --------- -----------

Table 7.1.1.1.2.3.3-1A: *SIB1* (steps 0AA and 17AA, Table
7.1.1.1.2.3.2-1)

  --------------------------------------------------- ------------------------- ------------------------------------------- -----------
  Derivation path: TS 38.508-1 \[4\] table 4.6.1-28                                                                         
  Information Element                                 Value/Remark              Comment                                     Condition
  SIB1 ::= SEQUENCE {                                                                                                       
  servingCellConfigCommon                             ServingCellConfigCommon   Same contents as in Table 7.1.1.1.2.3.3-4   
  }                                                                                                                         
  --------------------------------------------------- ------------------------- ------------------------------------------- -----------

Table 7.1.1.1.2.3.3-2: *RRCReconfiguration* (step 0A and step 17A, Table
7.1.1.1.2.3.2-1)

  ---------------------------------------------------- ----------------- ------------------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                                                                 
  Information Element                                  Value/remark      Comment                                     Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                  
  criticalExtensions CHOICE {                                                                                        
  rrcReconfiguration ::= SEQUENCE {                                                                                  
  secondaryCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   EN-DC
  nonCriticalExtension SEQUENCE {                                                                                    NR
  masterCellGroup                                      CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  ---------------------------------------------------- ----------------- ------------------------------------------- -----------

Table 7.1.1.1.2.3.3-3: *CellGroupConfig (*Table 7.1.1.1.2.3.3-2)

  ---------------------------------------------------- ------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19                                       
  Information Element                                  Value/remark              Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                           
  spCellConfig SEQUENCE {                                                                  
  reconfigurationWithSync SEQUENCE {                                                       
  spCellConfigCommon                                   ServingCellConfigCommon             
  newUE-Identity                                       RNTI-Value                          
  t304                                                 ms2000                              
  rach-ConfigDedicated                                 Not Present                         
  }                                                                                        
  }                                                                                        
  }                                                                                        
  ---------------------------------------------------- ------------------------- --------- -----------

Table 7.1.1.1.2.3.3-4: *ServingCellConfigCommon (*Table 7.1.1.1.2.3.3-3,
Table 7.1.1.1.2.3.3-1A)

  ----------------------------------------------------- ------------------ --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                
  Information Element                                   Value/remark       Comment   Condition
  ServingCellConfigCommon ::= SEQUENCE {                                             
  uplinkConfigCommon SEQUENCE {                                                      
  initialUplinkBWP                                      BWP-UplinkCommon             
  }                                                                                  
  }                                                                                  
  ----------------------------------------------------- ------------------ --------- -----------

Table 7.1.1.1.2.3.3-5: *BWP-UplinkCommon (*Table 7.1.1.1.2.3.3-4)

  ---------------------------------------------------- ------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-10                                 
  Information Element                                  Value/remark        Comment   Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                    
  rach-ConfigCommon CHOICE {                                                         
  setup                                                RACH-ConfigCommon             
  }                                                                                  
  }                                                                                  
  ---------------------------------------------------- ------------------- --------- -----------

Table 7.1.1.1.2.3.3-6: *RACH-ConfigCommon (*Table 7.1.1.1.2.3.3-5)

  ----------------------------------------------------- -------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128                                  
  Information Element                                   Value/remark         Comment   Condition
  RACH-ConfigCommon ::= SEQUENCE {                                                     
  rach-ConfigGeneric                                    RACH-ConfigGeneric             
  totalNumberOfRA-Preambles                             42                             
  ssb-perRACH-OccasionAndCB-PreamblesPerSSB CHOICE {                                   
  One                                                   n32                            
  }                                                                                    
  groupBconfigured SEQUENCE {                                                          
  ra-Msg3SizeGroupA                                     b208                           
  messagePowerOffsetGroupB                              minusinfinity                  
  numberOfRA-PreamblesGroupA                            28                             
  }                                                                                    
  ra-ContentionResolutionTimer                          sf48                           
  }                                                                                    
  ----------------------------------------------------- -------------------- --------- -----------

Table 7.1.1.1.2.3.3-7: *RACH-ConfigGeneric (*Table 7.1.1.1.2.3.3-6)

  ----------------------------------------------------- -------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-130                                                                                                                                                                                                                                                                                                           
  Information Element                                   Value/remark   Comment                                                                                                                                                                                                                                                                                  Condition
  RACH-ConfigGeneric ::= SEQUENCE {                                                                                                                                                                                                                                                                                                                             
  prach-ConfigurationIndex                              119            As per Table 6.3.3.2-2: of TS 38.211 \[24\], this results in PRACH preamble transmission in a radio frame meeting n~SFN~ mod 8=1, subframe number 2, 6, 9 and starting symbol 0 using preamble Format A2.                                                                                FR1 FDD
                                                        120            As per Table 6.3.3.2-2: of TS 38.211 \[24\], this results in PRACH preamble transmission in a radio frame meeting n~SFN~ mod 8=1, subframe number 4 and starting symbol 0 using preamble Format A2.                                                                                      FR1 FDD AND HD\_FDD
  prach-ConfigurationIndex                              91             As per Table 6.3.3.2-3: of TS 38.211 \[24\], this results in PRACH preamble transmission in a radio frame meeting n~SFN~ mod 2=1, subframe number 8, 9 and starting symbol 0 using preamble Format A2.                                                                                   FR1 TDD
                                                        6              As per Table 6.3.3.2-4: of TS 38.211 \[24\] and clause 5.3.2 of TS 38.211 this results in PRACH preamble transmission in radio frame meeting nSFN mod 4 = 1, slot number 8, 9, 18, 19, 28, 29, 38, 39 , 48, 49, 58, 59, 68, 69, 78, 79 and starting symbol 0 using preamble format A1.   FR2 (120 kHz)
  preambleReceivedTargetPower                           dBm-104                                                                                                                                                                                                                                                                                                 
  preambleTransMax                                      n10                                                                                                                                                                                                                                                                                                     
  powerRampingStep                                      dB2                                                                                                                                                                                                                                                                                                     
  ra-ResponseWindow                                     sl8                                                                                                                                                                                                                                                                                                     FR1 FDD and FR2 (120 kHz)
                                                        sl20                                                                                                                                                                                                                                                                                                    FR1 TDD
  }                                                                                                                                                                                                                                                                                                                                                             
  ----------------------------------------------------- -------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------

  ----------- ----------------------------------------------------------------------------------------
  Condition   Explanation
  HD\_FDD     pc\_halfDuplexFDD\_TypeA\_RedCap\_r17 (i.e HD\_FDD UE are performing test on FDD band)
  ----------- ----------------------------------------------------------------------------------------

Table 7.1.1.1.2.3.3-8: Void

##### 7.1.1.1.3 Random access procedure / Successful / SI request

##### 7.1.1.1.3.1 Test Purpose (TP) {#test-purpose-tp-2 .H6}

##### (1) {#section-13 .H6}

**with** { UE in RRC\_Idle State and need for Updated System information
}

**ensure that** {

**when** { UE transmitted PRACH preamble and ra-ResponseWindow has
expired}

**then** { UE retransmits the PRACH Preamble }

}

##### (2) {#section-14 .H6}

**with** { UE in RRC\_Idle State and transmitted PRACH preamble for
System information request }

**ensure that** {

**when** { UE received a RAR message addressed to RA-RNTI and including
matching RAPID only }

**then** { UE considers the RACH procedure to be successfully completed
and informs the upper layer }

}

##### (3) {#section-15 .H6}

##### Void {#void .H6}

##### 7.1.1.1.3.2 Conformance requirements {#conformance-requirements-2 .H6}

References: The conformance requirements covered in the present TC are
specified in: 3GPP TS 38.321, clause 5.1.2, 5.1.3, 5.1.4, and 6.1., 3GPP
TS 38.331 clause 5.2.2.2.25. Unless otherwise stated these are Rel-15
requirements.

\[TS 38.321, clause 5.1.2\]

The MAC entity shall:

1\> if the Random Access procedure was initiated for beam failure
recovery (as specified in subclause 5.17); and

1\> if the *beamFailureRecoveryTimer* (in subclause 5.17) is either
running or not configured; and

1\> if the contention-free Random Access Resources for beam failure
recovery request associated with any of the SSBs and/or CSI-RSs have
been explicitly provided by RRC; and

1\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
amongst the SSBs in *candidateBeamRSList* or the CSI-RSs with CSI-RSRP
above *rsrp-ThresholdCSI-RS* amongst the CSI-RSs in
*candidateBeamRSList* is available:

2\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB* amongst the
SSBs in *candidateBeamRSList* or a CSI-RS with CSI-RSRP above
*rsrp-ThresholdCSI-RS* amongst the CSI-RSs in *candidateBeamRSList*;

2\> if CSI-RS is selected, and there is no *ra-PreambleIndex* associated
with the selected CSI-RS:

3\> set the *PREAMBLE\_INDEX* to a ra-PreambleIndex corresponding to the
SSB in *candidateBeamRSList* which is quasi-collocated with the selected
CSI-RS as specified in TS 38.214 \[7\].

2\> else:

3\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB or CSI-RS from the set of Random Access Preambles for
beam failure recovery request.

1\> else if the *ra-PreambleIndex* has been explicitly provided by
either PDCCH or RRC; and

1\> if the *ra-PreambleIndex* is not 0b000000; and

1\> if contention-free Random Access Resource associated with SSBs or
CSI-RSs have not been explicitly provided by RRC:

2\> set the *PREAMBLE\_INDEX* to the signalled *ra-PreambleIndex*.

1\> else if the contention-free Random Access Resources associated with
SSBs have been explicitly provided by RRC and at least one SSB with
SS-RSRP above *rsrp-ThresholdSSB* amongst the associated SSBs is
available:

2\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB* amongst the
associated SSBs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB.

1\> else if the contention-free Random Access Resources associated with
CSI-RSs have been explicitly provided by RRC and at least one CSI-RS
with CSI-RSRP above *rsrp-ThresholdCSI-RS* amongst the associated
CSI-RSs is available:

2\> select a CSI-RS with CSI-RSRP above *rsrp-ThresholdCSI-RS* amongst
the associated CSI-RSs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected CSI-RS.

1\> else:

2\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
is available:

3\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> if Msg3 has not yet been transmitted:

3\> if Random Access Preambles group B is configured:

4\> if the potential Msg3 size (UL data available for transmission plus
MAC header and, where required, MAC CEs) is greater than
*ra-Msg3SizeGroupA* and the pathloss is less than *PCMAX* (of the
Serving Cell performing the Random Access Procedure) --
*preambleReceivedTargetPower* -- *msg3-DeltaPreamble* --
*messagePowerOffsetGroupB*; or

4\> if the Random Access procedure was initiated for the CCCH logical
channel and the CCCH SDU size plus MAC subheader is greater than
*ra-Msg3SizeGroupA*:

5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

3\> else:

4\> select the Random Access Preambles group A.

2\> else (i.e. Msg3 is being retransmitted):

3\> select the same group of Random Access Preambles as was used for the
Random Access Preamble transmission attempt corresponding to the first
transmission of Msg3.

2\> if the association between Random Access Preambles and SSBs is
configured:

3\> select a *ra-PreambleIndex* randomly with equal probability from the
Random Access Preambles associated with the selected SSB and the
selected Random Access Preambles group.

2\> else:

3\> select a *ra-PreambleIndex* randomly with equal probability from the
Random Access Preambles within the selected Random Access Preambles
group.

2\> set the *PREAMBLE\_INDEX* to the selected *ra-PreambleIndex*.

1\> if an SSB is selected above and an association between PRACH
occasions and SSBs is configured:

2\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB permitted by the restrictions given by
the *ra-ssb-OccasionMaskIndex* if configured (the MAC entity shall
select a PRACH occasion randomly with equal probability amongst the
PRACH occasions occurring simultaneously but on different subcarriers,
corresponding to the selected SSB; the MAC entity may take into account
the possible occurrence of measurement gaps when determining the next
available PRACH occasion corresponding to the selected SSB).

1\> else if a CSI-RS is selected above and an association between PRACH
occasions and CSI-RSs is configured:

2\> determine the next available PRACH occasion from the PRACH occasions
in *ra-OccasionList* corresponding to the selected CSI-RS (the MAC
entity shall select a PRACH occasion randomly with equal probability
amongst the PRACH occasions occurring simultaneously but on different
subcarriers, corresponding to the selected CSI-RS; the MAC entity may
take into account the possible occurrence of measurement gaps when
determining the next available PRACH occasion corresponding to the
selected CSI-RS).

1\> else if Random Access procedure was initiated for beam failure
recovery; and

1\> if a CSI-RS is selected above and there is no contention-free Random
Access Resource associated with the selected CSI-RS:

2\> determine the next available PRACH occasion from the PRACH
occasions, permitted by the restrictions given by the
*ra-ssb-OccasionMaskIndex* if configured, corresponding to the SSB in
*candidateBeamRSList* which is quasi-collocated with the selected CSI-RS
as specified in TS 38.214 \[7\] (the MAC entity may take into account
the possible occurrence of measurement gaps when determining the next
available PRACH occasion corresponding to the SSB which is
quasi-collected with the selected CSI-RS).

1\> else:

2\> determine the next available PRACH occasion (the MAC entity shall
select a PRACH occasion randomly with equal probability amongst the
PRACH occasions occurring simultaneously but on different subcarriers;
the MAC entity may take into account the possible occurrence of
measurement gaps when determining the next available PRACH occasion).

1\> perform the Random Access Preamble transmission procedure (see
subclause 5.1.3).

\[TS 38.321, clause 5.1.3\]

The MAC entity shall, for each Random Access Preamble:

1\> if *PREAMBLE\_TRANSMISSION\_COUNTER* is greater than one; and

1\> if the notification of suspending power ramping counter has not been
received from lower layers; and

1\> if SSB selected is not changed (i.e. same as the previous Random
Access Preamble transmission):

2\> increment *PREAMBLE\_POWER\_RAMPING\_COUNTER* by 1.

1\> select the value of *DELTA\_PREAMBLE* according to subclause 7.3;

1\> set *PREAMBLE\_RECEIVED\_TARGET\_POWER* to
*preambleReceivedTargetPower* + *DELTA\_PREAMBLE* +
(*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*;

1\> except for contention-free Random Access Preamble for beam failure
recovery request, compute the RA-RNTI associated with the PRACH occasion
in which the Random Access Preamble is transmitted;

1\> instruct the physical layer to transmit the Random Access Preamble
using the selected PRACH, corresponding RA-RNTI (if available),
*PREAMBLE\_INDEX* and *PREAMBLE\_RECEIVED\_TARGET\_POWER*.

The RA-RNTI associated with the PRACH in which the Random Access
Preamble is transmitted, is computed as:

RA-RNTI= 1 + s\_id + 14 Ã— t\_id + 14 Ã— 80 Ã— f\_id + 14 Ã— 80 Ã— 8 Ã—
ul\_carrier\_id

where s\_id is the index of the first OFDM symbol of the specified PRACH
(0 â‰¤ s\_id \< 14), t\_id is the index of the first slot of the specified
PRACH in a system frame (0 â‰¤ t\_id \< 80), f\_id is the index of the
specified PRACH in the frequency domain (0 â‰¤ f\_id \< 8), and
ul\_carrier\_id is the UL carrier used for Msg1 transmission (0 for NUL
carrier, and 1 for SUL carrier).

\[TS 38.321, clause 5.1.4\]

Once the Random Access Preamble is transmitted and regardless of the
possible occurrence of a measurement gap, the MAC entity shall:

1\> if the contention-free Random Access Preamble for beam failure
recovery request was transmitted by the MAC entity:

2\> start the *ra-ResponseWindow* configured in
*BeamFailureRecoveryConfig* at the first PDCCH occasion as specified in
TS 38.213 \[6\] from the end of the Random Access Preamble transmission;

2\> monitor the PDCCH of the SpCell for response to beam failure
recovery request identified by the C-RNTI while *ra-ResponseWindow* is
running.

1\> else:

2\> start the *ra-ResponseWindow* configured in *RACH-ConfigCommon* at
the first PDCCH occasion as specified in TS 38.213 \[6\] from the end of
the Random Access Preamble transmission;

2\> monitor the PDCCH of the SpCell for Random Access Response(s)
identified by the RA-RNTI while the *ra-ResponseWindow* is running.

1\> if notification of a reception of a PDCCH transmission is received
from lower layers; and

1\> if PDCCH transmission is addressed to the C-RNTI; and

1\> if the contention-free Random Access Preamble for beam failure
recovery request was transmitted by the MAC entity:

2\> consider the Random Access procedure successfully completed.

1\> else if a downlink assignment has been received on the PDCCH for the
RA-RNTI and the received TB is successfully decoded:

2\> if the Random Access Response contains a MAC subPDU with Backoff
Indicator:

3\> set the *PREAMBLE\_BACKOFF* to value of the BI field of the MAC
subPDU using Table 7.2-1, multiplied with *SCALING\_FACTOR\_B*I.

2\> else:

3\> set the *PREAMBLE\_BACKOFF* to 0 ms.

2\> if the Random Access Response contains a MAC subPDU with Random
Access Preamble identifier corresponding to the transmitted
*PREAMBLE\_INDEX* (see subclause 5.1.3):

3\> consider this Random Access Response reception successful.

2\> if the Random Access Response reception is considered successful:

3\> if the Random Access Response includes a MAC subPDU with RAPID only:

4\> consider this Random Access procedure successfully completed;

4\> indicate the reception of an acknowledgement for SI request to upper
layers.

3\> else:

4\> apply the following actions for the Serving Cell where the Random
Access Preamble was transmitted:

5\> process the received Timing Advance Command (see subclause 5.2);

5\> indicate the *preambleReceivedTargetPower* and the amount of power
ramping applied to the latest Random Access Preamble transmission to
lower layers (i.e. (*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*);

5\> if the Serving Cell for the Random Access procedure is SRS-only
SCell:

6\> ignore the received UL grant.

5\> else:

6\> process the received UL grant value and indicate it to the lower
layers.

4\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

5\> consider the Random Access procedure successfully completed.

4\> else:

5\> set the *TEMPORARY\_C-RNTI* to the value received in the Random
Access Response;

5\> if this is the first successfully received Random Access Response
within this Random Access procedure:

6\> if the transmission is not being made for the CCCH logical channel:

> 7\> indicate to the Multiplexing and assembly entity to include a
> C-RNTI MAC CE in the subsequent uplink transmission.

6\> obtain the MAC PDU to transmit from the Multiplexing and assembly
entity and store it in the Msg3 buffer.

1\> if *ra-ResponseWindow* configured in *RACH-ConfigCommon* expires,
and if the Random Access Response containing Random Access Preamble
identifiers that matches the transmitted *PREAMBLE\_INDEX* has not been
received; or

1\> if *ra-ResponseWindow* configured in *BeamFailureRecoveryConfig*
expires and if the PDCCH addressed to the C-RNTI has not been received:

2\> consider the Random Access Response reception not successful;

2\> increment *PREAMBLE\_TRANSMISSION\_COUNTER* by 1;

2\> if *PREAMBLE\_TRANSMISSION\_COUNTER* = *preambleTransMax* + 1:

3\> if the Random Access Preamble is transmitted on the SpCell:

4\> indicate a Random Access problem to upper layers;

4\> if this Random Access procedure was triggered for SI request:

5\> consider the Random Access procedure unsuccessfully completed.

3\> else if the Random Access Preamble is transmitted on a SCell:

4\> consider the Random Access procedure unsuccessfully completed.

2\> if the Random Access procedure is not completed:

3\> if in this Random Access procedure, the Random Access Preamble was
selected by MAC among the contention-based Random Access Preambles:

4\> select a random backoff time according to a uniform distribution
between 0 and the *PREAMBLE\_BACKOFF*;

4\> delay the subsequent Random Access Preamble transmission by the
backoff time.

3\> perform the Random Access Resource selection procedure (see
subclause 5.1.2).

The MAC entity may stop *ra-ResponseWindow* (and hence monitoring for
Random Access Response(s)) after successful reception of a Random Access
Response containing Random Access Preamble identifiers that matches the
transmitted *PREAMBLE\_INDEX*.

HARQ operation is not applicable to the Random Access Response
transmission.

\[TS 38.321, clause 6.1.5\]

A MAC PDU consists of one or more MAC subPDUs and optionally padding.
Each MAC subPDU consists one of the following:

\- a MAC subheader with Backoff Indicator only;

\- a MAC subheader with RAPID only (i.e. acknowledgment for SI request);

\- a MAC subheader with RAPID and MAC RAR.

A MAC subheader with Backoff Indicator consists of five header fields
E/T/R/R/BI as described in Figure 6.1.5-1. A MAC subPDU with Backoff
Indicator only is placed at the beginning of the MAC PDU, if included.
\'MAC subPDU(s) with RAPID only\' and \'MAC subPDU(s) with RAPID and MAC
RAR\' can be placed anywhere between MAC subPDU with Backoff Indicator
only (if any) and padding (if any).

A MAC subheader with RAPID consists of three header fields E/T/RAPID as
described in Figure 6.1.5-2.

Padding is placed at the end of the MAC PDU if present. Presence and
length of padding is implicit based on TB size, size of MAC subPDU(s).

![](./media/image2.emf)

Figure 6.1.5-1: E/T/R/R/BI MAC subheader

![](./media/image3.emf)

Figure 6.1.5-2: E/T/RAPID MAC subheader

![](./media/image4.emf)

Figure 6.1.5-3: Example of MAC PDU consisting of MAC RARs

\[38.331, clause 5.2.2.2.2\]

UEs in RRC\_IDLE or in RRC\_INACTIVE shall monitor for SI change
indication in its own paging occasion every DRX cycle. UEs in
RRC\_CONNECTED shall monitor for SI change indication in any paging
occasion at least once per modification period if the UE is provided
with common search space on the active BWP to monitor paging, as
specified in TS 38.213 \[13\], clause 13.

ETWS or CMAS capable UEs in RRC\_IDLE or in RRC\_INACTIVE shall monitor
for indications about PWS notification in its own paging occasion every
DRX cycle. ETWS or CMAS capable UEs in RRC\_CONNECTED shall monitor for
indication about PWS notification in any paging occasion at least once
every *defaultPagingCycle* if the UE is provided with common search
space on the active BWP to monitor paging.

For Short Message reception in a paging occasion, the UE monitors the
PDCCH monitoring occasion(s) for paging as specified in TS 38.304 \[20\]
and TS 38.213 \[13\].

If the UE receives a Short Message, the UE shall:

1\> if the UE is ETWS capable or CMAS capable, the
*etwsAndCmasIndication* bit of Short Message is set, and the UE is
provided with *searchSpaceOtherSystemInformation* on the active BWP:

2\> immediately re-acquire the *SIB1*;

2\> if the UE is ETWS capable and *si-SchedulingInfo* includes
scheduling information for *SIB6*:

3\> acquire *SIB6*, as specified in clause 5.2.2.3.2, immediately;

2\> if the UE is ETWS capable and *si-SchedulingInfo* includes
scheduling information for *SIB7*:

3\> acquire *SIB7*, as specified in clause 5.2.2.3.2, immediately;

2\> if the UE is CMAS capable and *si-SchedulingInfo* includes
scheduling information for *SIB8*:

3\> acquire *SIB8*, as specified in sub-clause 5.2.2.3.2, immediately;

1\> if the *systemInfoModification* bit of Short Message is set:

2\> apply the SI acquisition procedure as defined in sub-clause 5.2.2.3
from the start of the next modification period.

##### 7.1.1.1.3.3 Test description {#test-description-2 .H6}

##### 7.1.1.1.3.3.1 Pre-test conditions {#pre-test-conditions-2 .H6}

System Simulator:

> \- NR Cell 1 and NR Cell 11.

\- System information combination NR-3 as defined in TS 38.508-1 \[4\]
clause 4.4.3.1.3 is used in NR Cell 1.

UE:

> \- None.

Preamble:

\- The UE is in NR RRC\_Idle mode (state 1N-A) on NR Cell 1 according to
38.508-1 \[4\] Table 4.4A.2-1.

##### 7.1.1.1.3.3.2 Test procedure sequence {#test-procedure-sequence-2 .H6}

Table 7.1.1.1.3.3.2-1/2 illustrate the downlink power levels and other
changing parameters to be applied for the cell at various time instants
of the test execution. The exact instants on which these values shall be
applied are described in the texts in this clause. Configurations marked
\"T0\" is applied for Preamble. Configurations marked \"T1\" and \"T2\"
are applied at the points indicated in the Main behaviour description in
Table 7.1.1.1.3.3.2-3.

Table 7.1.1.1.3.3.2-1: Time instances of cell power level and parameter
changes for FR1

+----------+----------+---------+----------+----------+----------+
|          | P        | Unit    | NR Cell  | NR Cell  | Remark   |
|          | arameter |         | 1        | 11       |          |
+==========+==========+=========+==========+==========+==========+
| T0       | SS/PBCH  | dBm/SCS | -90      | Off      | The      |
|          |          |         |          |          | power    |
|          | SSS EPRE |         |          |          | level is |
|          |          |         |          |          | such     |
|          |          |         |          |          | that     |
|          |          |         |          |          | Srxlev~  |
|          |          |         |          |          | NRCell1~ |
|          |          |         |          |          | \> 0     |
+----------+----------+---------+----------+----------+----------+
|          | Q        | dBm     | -106     | \-       |          |
|          | rxlevmin |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Qrxlevm  | dB      | 0        | \-       |          |
|          | inoffset |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Pcomp    | dB      | 0        | \-       |          |
|          | ensation |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Qoffset  | dB      | 16       | \-       |          |
+----------+----------+---------+----------+----------+----------+
| T1       | SS/PBCH  | dBm/SCS | -90      | -84      | The      |
|          |          |         |          |          | power    |
|          | SSS EPRE |         |          |          | level    |
|          |          |         |          |          | values   |
|          |          |         |          |          | are      |
|          |          |         |          |          | assigned |
|          |          |         |          |          | to       |
|          |          |         |          |          | satisfy  |
|          |          |         |          |          | R~NR     |
|          |          |         |          |          | Cell\ 1~ |
|          |          |         |          |          | \>       |
|          |          |         |          |          | R~NRC    |
|          |          |         |          |          | ell\ 11~ |
+----------+----------+---------+----------+----------+----------+
|          | Q        | dBm     | -106     | -106     |          |
|          | rxlevmin |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Qrxlevm  | dB      | 0        | 0        |          |
|          | inoffset |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Pcomp    | dB      | 0        | 0        |          |
|          | ensation |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Qoffset  | dB      | 16       | \-       |          |
+----------+----------+---------+----------+----------+----------+
| T2       | SS/PBCH  | dBm/SCS | -90      | -84      | The      |
|          |          |         |          |          | power    |
|          | SSS EPRE |         |          |          | level    |
|          |          |         |          |          | values   |
|          |          |         |          |          | are      |
|          |          |         |          |          | assigned |
|          |          |         |          |          | to       |
|          |          |         |          |          | satisfy  |
|          |          |         |          |          | R~NR     |
|          |          |         |          |          | Cell\ 1~ |
|          |          |         |          |          | \<       |
|          |          |         |          |          | R~NRC    |
|          |          |         |          |          | ell\ 11~ |
+----------+----------+---------+----------+----------+----------+
|          | Q        | dBm     | -106     | -106     |          |
|          | rxlevmin |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Qrxlevm  | dB      | 0        | 0        |          |
|          | inoffset |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Pcomp    | dB      | 0        | 0        |          |
|          | ensation |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Qoffset  | dB      | -10      | \-       |          |
+----------+----------+---------+----------+----------+----------+
| Note:    |          |         |          |          |          |
| The      |          |         |          |          |          |
| downlink |          |         |          |          |          |
| signal   |          |         |          |          |          |
| level    |          |         |          |          |          |
| unc      |          |         |          |          |          |
| ertainty |          |         |          |          |          |
| is       |          |         |          |          |          |
| s        |          |         |          |          |          |
| pecified |          |         |          |          |          |
| in TS    |          |         |          |          |          |
| 38.508-1 |          |         |          |          |          |
| \[4\]    |          |         |          |          |          |
| clause   |          |         |          |          |          |
| 6.2.2.1. |          |         |          |          |          |
+----------+----------+---------+----------+----------+----------+

Table 7.1.1.1.3.3.2-2: Time instances of cell power level and parameter
changes for FR2

+----------+----------+---------+----------+----------+----------+
|          | P        | Unit    | NR Cell  | NR Cell  | Remark   |
|          | arameter |         | 1        | 11       |          |
+==========+==========+=========+==========+==========+==========+
| T0       | SS/PBCH  | dBm/SCS | -91      | Off      | The      |
|          |          |         |          |          | power    |
|          | SSS EPRE |         |          |          | level is |
|          |          |         |          |          | such     |
|          |          |         |          |          | that     |
|          |          |         |          |          | Srxlev~  |
|          |          |         |          |          | NRCell1~ |
|          |          |         |          |          | \> 0     |
+----------+----------+---------+----------+----------+----------+
|          | Q        | dBm     | 2\*      | \-       |          |
|          | rxlevmin |         | ROU      |          |          |
|          |          |         | ND((-110 |          |          |
|          |          |         | +Delta(N |          |          |
|          |          |         | Rfs))/2) |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Qrxlevm  | dB      | 0        | \-       |          |
|          | inoffset |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Pcomp    | dB      | 0        | \-       |          |
|          | ensation |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Qoffset  | dB      | 16       | \-       |          |
+----------+----------+---------+----------+----------+----------+
| T1       | SS/PBCH  | dBm/SCS | -91      | -82      | The      |
|          |          |         |          |          | power    |
|          | SSS EPRE |         |          |          | level    |
|          |          |         |          |          | values   |
|          |          |         |          |          | are      |
|          |          |         |          |          | assigned |
|          |          |         |          |          | to       |
|          |          |         |          |          | satisfy  |
|          |          |         |          |          | R~NR     |
|          |          |         |          |          | Cell\ 1~ |
|          |          |         |          |          | \>       |
|          |          |         |          |          | R~NRC    |
|          |          |         |          |          | ell\ 11~ |
+----------+----------+---------+----------+----------+----------+
|          | Q        | dBm     | 2\*      | 2\*      |          |
|          | rxlevmin |         | ROU      | ROU      |          |
|          |          |         | ND((-110 | ND((-110 |          |
|          |          |         | +Delta(N | +Delta(N |          |
|          |          |         | Rfs))/2) | Rfs))/2) |          |
+----------+----------+---------+----------+----------+----------+
|          | Qrxlevm  | dB      | 0        | 0        |          |
|          | inoffset |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Pcomp    | dB      | 0        | 0        |          |
|          | ensation |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Qoffset  | dB      | 16       | \-       |          |
+----------+----------+---------+----------+----------+----------+
| T2       | SS/PBCH  | dBm/SCS | -91      | -82      | The      |
|          |          |         |          |          | power    |
|          | SSS EPRE |         |          |          | level    |
|          |          |         |          |          | values   |
|          |          |         |          |          | are      |
|          |          |         |          |          | assigned |
|          |          |         |          |          | to       |
|          |          |         |          |          | satisfy  |
|          |          |         |          |          | R~NR     |
|          |          |         |          |          | Cell\ 1~ |
|          |          |         |          |          | \<       |
|          |          |         |          |          | R~NRC    |
|          |          |         |          |          | ell\ 11~ |
+----------+----------+---------+----------+----------+----------+
|          | Q        | dBm     | 2\*      | 2\*      |          |
|          | rxlevmin |         | ROU      | ROU      |          |
|          |          |         | ND((-110 | ND((-110 |          |
|          |          |         | +Delta(N | +Delta(N |          |
|          |          |         | Rfs))/2) | Rfs))/2) |          |
+----------+----------+---------+----------+----------+----------+
|          | Qrxlevm  | dB      | 0        | 0        |          |
|          | inoffset |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Pcomp    | dB      | 0        | 0        |          |
|          | ensation |         |          |          |          |
+----------+----------+---------+----------+----------+----------+
|          | Qoffset  | dB      | -10      | \-       |          |
+----------+----------+---------+----------+----------+----------+
| Note:    |          |         |          |          |          |
| The      |          |         |          |          |          |
| downlink |          |         |          |          |          |
| signal   |          |         |          |          |          |
| level    |          |         |          |          |          |
| unc      |          |         |          |          |          |
| ertainty |          |         |          |          |          |
| is       |          |         |          |          |          |
| s        |          |         |          |          |          |
| pecified |          |         |          |          |          |
| in TS    |          |         |          |          |          |
| 38.508-1 |          |         |          |          |          |
| \[4\]    |          |         |          |          |          |
| section  |          |         |          |          |          |
| 6.2.2.2. |          |         |          |          |          |
+----------+----------+---------+----------+----------+----------+

Table 7.1.1.1.3.3.2-3: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \-        | \-        | \-      | \- |
|           | changes   |           |           |         |    |
|           | SS/PBCH   |           |           |         |    |
|           |           |           |           |         |    |
|           | EPRE      |           |           |         |    |
|           | level of  |           |           |         |    |
|           | NR Cell   |           |           |         |    |
|           | 11        |           |           |         |    |
|           | according |           |           |         |    |
|           | to the    |           |           |         |    |
|           | row       |           |           |         |    |
|           | \"T1\" in |           |           |         |    |
|           | Table     |           |           |         |    |
|           | 7.1.1.1.3 |           |           |         |    |
|           | .3.2-1/2. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | Wait 60s  | \-        | *-*       | \-      | \- |
|           | to ensure |           |           |         |    |
|           | UE        |           |           |         |    |
|           | detects   |           |           |         |    |
|           | NR Cell   |           |           |         |    |
|           | 11.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | SS        | \<\--     | (Short    | \-      | \- |
|           | transmits |           | Message)  |         |    |
|           | Short     |           |           |         |    |
|           | Message   |           |           |         |    |
|           | on PDCCH  |           |           |         |    |
|           | addressed |           |           |         |    |
|           | to P-RNTI |           |           |         |    |
|           | using     |           |           |         |    |
|           | Short     |           |           |         |    |
|           | Message   |           |           |         |    |
|           | field in  |           |           |         |    |
|           | DCI       |           |           |         |    |
|           | format    |           |           |         |    |
|           | 1\_0. Bit |           |           |         |    |
|           | 1 of      |           |           |         |    |
|           | Short     |           |           |         |    |
|           | Message   |           |           |         |    |
|           | field is  |           |           |         |    |
|           | set to 1  |           |           |         |    |
|           | to        |           |           |         |    |
|           | indicate  |           |           |         |    |
|           | the SI    |           |           |         |    |
|           | *modif    |           |           |         |    |
|           | ication.* |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | The       | \<\--     |           | \-      | \- |
|           | *         |           |           |         |    |
|           | valueTag* |           |           |         |    |
|           | for SIB3  |           |           |         |    |
|           | in the    |           |           |         |    |
|           | SIB1      |           |           |         |    |
|           | message   |           |           |         |    |
|           | is        |           |           |         |    |
|           | increased |           |           |         |    |
|           | and       |           |           |         |    |
|           | *si*      |           |           |         |    |
|           | -*Broadca |           |           |         |    |
|           | stStatus* |           |           |         |    |
|           | for SIB3  |           |           |         |    |
|           | is set to |           |           |         |    |
|           | '*notBro  |           |           |         |    |
|           | adcasted' |           |           |         |    |
|           | and SS    |           |           |         |    |
|           | stops     |           |           |         |    |
|           | bro       |           |           |         |    |
|           | adcasting |           |           |         |    |
|           | SIB3*.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Check:    | \--\>     | PRACH     | 1       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | using the |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | indicated |           |           |         |    |
|           | by        |           |           |         |    |
|           | *ra-P     |           |           |         |    |
|           | reambleSt |           |           |         |    |
|           | artIndex* |           |           |         |    |
|           | defined   |           |           |         |    |
|           | in        |           |           |         |    |
|           | SI-*Reque |           |           |         |    |
|           | stConfig* |           |           |         |    |
|           | in *SIB1* |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.1   |           |           |         |    |
|           | .3.3.3-1? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | Check:    | \--\>     | PRACH     | 1       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | re        |           |           |         |    |
|           | -transmit |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | after     |           |           |         |    |
|           | *         |           |           |         |    |
|           | ra-Respon |           |           |         |    |
|           | seWindow* |           |           |         |    |
|           | using the |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | indicated |           |           |         |    |
|           | by        |           |           |         |    |
|           | *ra-P     |           |           |         |    |
|           | reambleSt |           |           |         |    |
|           | artIndex* |           |           |         |    |
|           | defined   |           |           |         |    |
|           | in        |           |           |         |    |
|           | SI-*Reque |           |           |         |    |
|           | stConfig* |           |           |         |    |
|           | in *SIB1* |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.1   |           |           |         |    |
|           | .3.3.3-1? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | Check:    | \--\>     | PRACH     | 1       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | re        |           |           |         |    |
|           | -transmit |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | after     |           |           |         |    |
|           | *         |           |           |         |    |
|           | ra-Respon |           |           |         |    |
|           | seWindow* |           |           |         |    |
|           | using the |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | indicated |           |           |         |    |
|           | by        |           |           |         |    |
|           | *ra-P     |           |           |         |    |
|           | reambleSt |           |           |         |    |
|           | artIndex* |           |           |         |    |
|           | defined   |           |           |         |    |
|           | in        |           |           |         |    |
|           | SI-*Reque |           |           |         |    |
|           | stConfig* |           |           |         |    |
|           | in *SIB1* |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.1   |           |           |         |    |
|           | .3.3.3-1? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | Check:    | \--\>     | PRACH     | 1       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | re        |           |           |         |    |
|           | -transmit |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | after     |           |           |         |    |
|           | *         |           |           |         |    |
|           | ra-Respon |           |           |         |    |
|           | seWindow* |           |           |         |    |
|           | using the |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | indicated |           |           |         |    |
|           | by        |           |           |         |    |
|           | *ra-P     |           |           |         |    |
|           | reambleSt |           |           |         |    |
|           | artIndex* |           |           |         |    |
|           | defined   |           |           |         |    |
|           | in        |           |           |         |    |
|           | SI-*Reque |           |           |         |    |
|           | stConfig* |           |           |         |    |
|           | in *SIB1* |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.1   |           |           |         |    |
|           | .3.3.3-1? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | a RAR     |           | Response  |         |    |
|           | message   |           |           |         |    |
|           | addressed |           |           |         |    |
|           | to UE     |           |           |         |    |
|           | RA-RNTI   |           |           |         |    |
|           | including |           |           |         |    |
|           | a MAC     |           |           |         |    |
|           | subPDU    |           |           |         |    |
|           | with a    |           |           |         |    |
|           | matching  |           |           |         |    |
|           | RAPID     |           |           |         |    |
|           | only.     |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9A        | The SS    |           |           |         |    |
|           | changes   |           |           |         |    |
|           | the       |           |           |         |    |
|           | parameter |           |           |         |    |
|           | '*        |           |           |         |    |
|           | Qoffset'* |           |           |         |    |
|           | in SIB3   |           |           |         |    |
|           | of NR     |           |           |         |    |
|           | Cell 1    |           |           |         |    |
|           | according |           |           |         |    |
|           | to the    |           |           |         |    |
|           | row       |           |           |         |    |
|           | \"T2\" in |           |           |         |    |
|           | Table     |           |           |         |    |
|           | 7.1.1.1.  |           |           |         |    |
|           | 3.3.2-1/2 |           |           |         |    |
|           | and       |           |           |         |    |
|           | starts    |           |           |         |    |
|           | bro       |           |           |         |    |
|           | adcasting |           |           |         |    |
|           | SIB3.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | Check:    | \--\>     | *RRCSetu  | 2       | F  |
|           | Does UE   |           | pRequest* |         |    |
|           | send Msg3 |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *RRCSetu  |           |           |         |    |
|           | pRequest* |           |           |         |    |
|           | message   |           |           |         |    |
|           | in the    |           |           |         |    |
|           | grant     |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssociated |           |           |         |    |
|           | to the    |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | received  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 9?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | Check:    | \-        | \-        | 2       | P  |
|           | Does the  |           |           |         |    |
|           | test      |           |           |         |    |
|           | result of |           |           |         |    |
|           | generic   |           |           |         |    |
|           | test      |           |           |         |    |
|           | procedure |           |           |         |    |
|           | in TS     |           |           |         |    |
|           | 38.508-1  |           |           |         |    |
|           | \[4\]     |           |           |         |    |
|           | Table     |           |           |         |    |
|           | 4.        |           |           |         |    |
|           | 9.5.2.2-1 |           |           |         |    |
|           | indicate  |           |           |         |    |
|           | that the  |           |           |         |    |
|           | UE is     |           |           |         |    |
|           | camped on |           |           |         |    |
|           | NR Cell   |           |           |         |    |
|           | 11        |           |           |         |    |
|           | belonging |           |           |         |    |
|           | to a new  |           |           |         |    |
|           | TA?       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| The UE    |           |           |           |         |    |
| will      |           |           |           |         |    |
| indicate  |           |           |           |         |    |
| the       |           |           |           |         |    |
| reception |           |           |           |         |    |
| of an     |           |           |           |         |    |
| acknow    |           |           |           |         |    |
| ledgement |           |           |           |         |    |
| for SI    |           |           |           |         |    |
| request   |           |           |           |         |    |
| to upper  |           |           |           |         |    |
| layers    |           |           |           |         |    |
| after UE  |           |           |           |         |    |
| receives  |           |           |           |         |    |
| the RAR   |           |           |           |         |    |
| message   |           |           |           |         |    |
| including |           |           |           |         |    |
| a MAC     |           |           |           |         |    |
| subPDU    |           |           |           |         |    |
| with a    |           |           |           |         |    |
| matching  |           |           |           |         |    |
| RAPID     |           |           |           |         |    |
| only,     |           |           |           |         |    |
| according |           |           |           |         |    |
| to TS     |           |           |           |         |    |
| 38.321    |           |           |           |         |    |
| \[18\]    |           |           |           |         |    |
| clause    |           |           |           |         |    |
| 5.1.4.    |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.1.3.3.3 Specific message contents {#specific-message-contents-2 .H6}

Table 7.1.1.1.3.3.3-1: *SIB1* on NR Cell 1 (Step 4, Table
7.1.1.1.3.3.2-3)

  ---------------------------------------------------- -------------------- ------------------------------------ -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-28                                                             
  Information Element                                  Value/remark         Comment                              Condition
  SIB1 ::= SEQUENCE {                                                                                            
  si-SchedulingInfo SEQUENCE {                                                                                   
  schedulingInfoList SEQUENCE {                        2 entries                                                 
  si-BroadcastStatus\[1\]                              Broadcasting                                              
  si-Periodicity\[1\]                                  rf32                                                      
  sib-MappingInfo\[1\] SEQUENCE {                                                                                
  type                                                 SibType2                                                  
  valueTag                                             0                                                         
  areaScope                                            Not present                                               
  }                                                                                                              
  si-BroadcastStatus\[2\]                              notBroadcasting                                           
  si-Periodicity\[2\]                                  rf64                                                      
  sib-MappingInfo\[2\] SEQUENCE {                                                                                
  type                                                 SibType3                                                  
  valueTag                                             1                                                         
  areaScope                                            Not present                                               
  }                                                                                                              
  }                                                                                                              
  si-RequestConfig SEQUENCE {                                                                                    
  rach-OccasionsSI SEQUENCE {                                                                                    
  rach-ConfigSI                                        RACH-ConfigGeneric   TS 38.508-1 \[4\], Table 4.6.3-130   
  ssb-perRACH-Occasion                                 one                                                       
  }                                                                                                              
  si-RequestPeriod                                     two                                                       
  si-RequestResources SEQUENCE {                       1 entry                                                   
  ra-PreambleStartIndex\[1\]                           52                                                        
  ra-AssociationPeriodIndex\[1\]                       0                                                         
  ra-ssb-OccasionMaskIndex\[1\]                        0                                                         
  }                                                                                                              
  }                                                                                                              
  si-RequestConfigSUL                                  Not present                                               
  }                                                                                                              
  }                                                                                                              
  ---------------------------------------------------- -------------------- ------------------------------------ -----------

Table 7.1.1.1.3.3.3-2: *SIB3* on NR Cell 1 (Preamble and Step 9A, Table
7.1.1.1.3.3.2-3)

  --------------------------------------------------- ------------------------------------------------------------------------ ---------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.2-2                                                                                       
  Information Element                                 Value/remark                                                             Comment    Condition
  SIB3 ::= SEQUENCE {                                                                                                                     
  intraFreqNeighCellList SEQUENCE {                                                                                                       
  physCellId                                          The cell identity of NR Cell 11 defined in 38.508-1 \[4\] clause 4.4.2              
  q-OffsetCell                                        16                                                                       Preamble   
                                                      -10                                                                      Step 9A    
  }                                                                                                                                       
  }                                                                                                                                       
  --------------------------------------------------- ------------------------------------------------------------------------ ---------- -----------

##### 7.1.1.1.4 Random access procedure / Successful / Beam Failure / Preamble selected by MAC itself / Non Contention Free RACH procedure

##### 7.1.1.1.4.1 Test Purpose (TP) {#test-purpose-tp-3 .H6}

##### (1) {#section-16 .H6}

**with** { UE in RRC\_CONNECTED state with no failureDetectionResources
configured and RACH procedure due to beam failure is triggered }

**ensure that** {

**when** { contention free random access resources for beam failure
recovery request associated with SS blocks are not provided by RRC }

**then** { UE selects initiates the non-contention free Random Access
Procedure }

}

##### (2) {#section-17 .H6}

**with** { UE in RRC\_CONNECTED state and RACH procedure due to beam
failure is triggered }

**ensure** **that** {

**when** { contention free random access resources for beam failure
recovery request associated with SS blocks are explicitly provided by
RRC }

**then** { UE selects the PREAMBLE\_INDEX to a ra-PreambleIndex
corresponding to the selected SS block and initiates the contention free
Random Access Procedure }

}

##### (3) {#section-18 .H6}

**with** { UE in RRC\_CONNECTED state and RACH procedure due to beam
failure is triggered }

**ensure** **that** {

**when** { contention free random access resources for beam failure
recovery request associated with CSI-RS are explicitly provided by RRC }

**then** { UE selects the PREAMBLE\_INDEX to a ra-PreambleIndex
corresponding to the selected CSI-RS and initiates the contention free
Random Access Procedure }

}

##### (4) {#section-19 .H6}

**with** { UE in RRC\_CONNECTED state with Preamble transmitted for
contention free RACH procedure for beam failure }

**ensure** **that** {

**when** { ra-ResponseWindowBFR expires and the PDCCH addressed to the
C-RNTI has not been received }

**then** { UE retransmits the PRACH Preamble }

}

##### (5) {#section-20 .H6}

**with** { UE in RRC\_CONNECTED state with Preamble transmitted for
contention free RACH procedure for beam failure }

**ensure** **that** {

**when** { before expiry of ra-ResponseWindowBFR the PDCCH addressed to
the C-RNTI is received }

**then** { UE considers the RACH procedure to be successfully completed
and stops retransmitting PRACH preambles }

}

##### 7.1.1.1.4.2 Conformance requirements {#conformance-requirements-3 .H6}

References: The conformance requirements covered in the present test
case are specified in: TS 38.321, clause 5.1.2, 5.1.3, 5.1.4 and 5.17.
Unless otherwise stated these are Rel-15 requirements.

\[TS 38.321, clause 5.1.2\]

The MAC entity shall:

1\> if the Random Access procedure was initiated for beam failure
recovery (as specified in subclause 5.17); and

1\> if the *beamFailureRecoveryTimer* (in subclause 5.17) is either
running or not configured; and

1\> if the contention-free Random Access Resources for beam failure
recovery request associated with any of the SSBs and/or CSI-RSs have
been explicitly provided by RRC; and

1\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
amongst the SSBs in *candidateBeamRSList* or the CSI-RSs with CSI-RSRP
above *rsrp-ThresholdCSI-RS* amongst the CSI-RSs in
*candidateBeamRSList* is available:

2\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB* amongst the
SSBs in *candidateBeamRSList* or a CSI-RS with CSI-RSRP above
*rsrp-ThresholdCSI-RS* amongst the CSI-RSs in *candidateBeamRSList*;

2\> if CSI-RS is selected, and there is no *ra-PreambleIndex* associated
with the selected CSI-RS:

3\> set the *PREAMBLE\_INDEX* to a ra-PreambleIndex corresponding to the
SSB in *candidateBeamRSList* which is quasi-collocated with the selected
CSI-RS as specified in TS 38.214 \[7\].

2\> else:

3\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB or CSI-RS from the set of Random Access Preambles for
beam failure recovery request.

1\> else if the *ra-PreambleIndex* has been explicitly provided by
PDCCH; and

1\> if the *ra-PreambleIndex* is not 0b000000:

2\> set the *PREAMBLE\_INDEX* to the signalled *ra-PreambleIndex*;

2\> select the SSB signalled by PDCCH.

1\> else if the contention-free Random Access Resources associated with
SSBs have been explicitly provided by RRC and at least one SSB with
SS-RSRP above *rsrp-ThresholdSSB* amongst the associated SSBs is
available:

2\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB* amongst the
associated SSBs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB.

1\> else if the contention-free Random Access Resources associated with
CSI-RSs have been explicitly provided by RRC and at least one CSI-RS
with CSI-RSRP above *rsrp-ThresholdCSI-RS* amongst the associated
CSI-RSs is available:

2\> select a CSI-RS with CSI-RSRP above *rsrp-ThresholdCSI-RS* amongst
the associated CSI-RSs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected CSI-RS.

1\> else if the Random Access procedure was initiated for SI request (as
specified in TS 38.331 \[5\]); and

1\> if the Random Access Resources for SI request have been explicitly
provided by RRC:

2\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
is available:

3\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> select a Random Access Preamble corresponding to the selected SSB,
from the Random Access Preamble(s) determined according to
*ra-PreambleStartIndex* as specified in TS 38.331 \[5\];

2\> set the *PREAMBLE\_INDEX* to selected Random Access Preamble.

1\> else (i.e. for the contention-based Random Access preamble
selection):

2\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
is available:

3\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> if Msg3 has not yet been transmitted:

3\> if Random Access Preambles group B is configured:

4\> if the potential Msg3 size (UL data available for transmission plus
MAC header and, where required, MAC CEs) is greater than
*ra-Msg3SizeGroupA* and the pathloss is less than *PCMAX* (of the
Serving Cell performing the Random Access Procedure) --
*preambleReceivedTargetPower* -- *msg3-DeltaPreamble* --
*messagePowerOffsetGroupB*; or

4\> if the Random Access procedure was initiated for the CCCH logical
channel and the CCCH SDU size plus MAC subheader is greater than
*ra-Msg3SizeGroupA*:

5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

3\> else:

4\> select the Random Access Preambles group A.

2\> else (i.e. Msg3 is being retransmitted):

3\> select the same group of Random Access Preambles as was used for the
Random Access Preamble transmission attempt corresponding to the first
transmission of Msg3.

2\> if the association between Random Access Preambles and SSBs is
configured:

3\> select a Random Access Preamble randomly with equal probability from
the Random Access Preambles associated with the selected SSB and the
selected Random Access Preambles group.

2\> else:

3\> select a Random Access Preamble randomly with equal probability from
the Random Access Preambles within the selected Random Access Preambles
group.

2\> set the *PREAMBLE\_INDEX* to the selected Random Access Preamble.

1\> if the Random Access procedure was initiated for SI request (as
specified in TS 38.331 \[5\]); and

1\> if *ra-AssociationPeriodIndex* and *si-RequestPeriod* are
configured:

2\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB in the association period given by
*ra-AssociationPeriodIndex* in the *si-RequestPeriod* permitted by the
restrictions given by the *ra-ssb-OccasionMaskIndex* (the MAC entity
shall select a PRACH occasion randomly with equal probability amongst
the consecutive PRACH occasions according to subclause 8.1 of TS 38.213
\[6\] corresponding to the selected SSB).

1\> else if an SSB is selected above:

2\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB permitted by the restrictions given by
the *ra-ssb-OccasionMaskIndex* if configured (the MAC entity shall
select a PRACH occasion randomly with equal probability amongst the
consecutive PRACH occasions according to subclause 8.1 of TS 38.213
\[6\], corresponding to the selected SSB; the MAC entity may take into
account the possible occurrence of measurement gaps when determining the
next available PRACH occasion corresponding to the selected SSB).

1\> else if a CSI-RS is selected above:

2\> if there is no contention-free Random Access Resource associated
with the selected CSI-RS:

3\> determine the next available PRACH occasion from the PRACH
occasions, permitted by the restrictions given by the
*ra-ssb-OccasionMaskIndex* if configured, corresponding to the SSB in
*candidateBeamRSList* which is quasi-collocated with the selected CSI-RS
as specified in TS 38.214 \[7\] (the MAC entity may take into account
the possible occurrence of measurement gaps when determining the next
available PRACH occasion corresponding to the SSB which is
quasi-collected with the selected CSI-RS).

2\> else:

3\> determine the next available PRACH occasion from the PRACH occasions
in *ra-OccasionList* corresponding to the selected CSI-RS (the MAC
entity shall select a PRACH occasion randomly with equal probability
amongst the PRACH occasions occurring simultaneously but on different
subcarriers, corresponding to the selected CSI-RS; the MAC entity may
take into account the possible occurrence of measurement gaps when
determining the next available PRACH occasion corresponding to the
selected CSI-RS).

1\> perform the Random Access Preamble transmission procedure (see
subclause 5.1.3).

NOTE: When the UE determines if there is an SSB with SS-RSRP above
*rsrp-ThresholdSSB* or a CSI-RS with CSI-RSRP above
*rsrp-ThresholdCSI-RS*, the UE uses the latest unfiltered L1-RSRP
measurement.

\[TS 38.321, clause 5.1.4\]

Once the Random Access Preamble is transmitted and regardless of the
possible occurrence of a measurement gap, the MAC entity shall:

1\> if the contention-free Random Access Preamble for beam failure
recovery request was transmitted by the MAC entity:

2\> start the *ra-ResponseWindow* configured in
*BeamFailureRecoveryConfig* at the first PDCCH occasion as specified in
TS 38.213 \[6\] from the end of the Random Access Preamble transmission;

2\> monitor the PDCCH of the SpCell for response to beam failure
recovery request identified by the C-RNTI while *ra-ResponseWindow* is
running.

1\> else:

2\> start the *ra-ResponseWindow* configured in *RACH-ConfigCommon* at
the first PDCCH occasion as specified in TS 38.213 \[6\] from the end of
the Random Access Preamble transmission;

2\> monitor the PDCCH of the SpCell for Random Access Response(s)
identified by the RA-RNTI while the *ra-ResponseWindow* is running.

1\> if notification of a reception of a PDCCH transmission is received
from lower layers on the Serving Cell where the preamble was
transmitted; and

1\> if PDCCH transmission is addressed to the C-RNTI; and

1\> if the contention-free Random Access Preamble for beam failure
recovery request was transmitted by the MAC entity:

2\> consider the Random Access procedure successfully completed.

1\> else if a downlink assignment has been received on the PDCCH for the
RA-RNTI and the received TB is successfully decoded:

2\> if the Random Access Response contains a MAC subPDU with Backoff
Indicator:

3\> set the *PREAMBLE\_BACKOFF* to value of the BI field of the MAC
subPDU using Table 7.2-1, multiplied with *SCALING\_FACTOR\_BI*.

2\> else:

3\> set the *PREAMBLE\_BACKOFF* to 0 ms.

2\> if the Random Access Response contains a MAC subPDU with Random
Access Preamble identifier corresponding to the transmitted
*PREAMBLE\_INDEX* (see subclause 5.1.3):

3\> consider this Random Access Response reception successful.

2\> if the Random Access Response reception is considered successful:

3\> if the Random Access Response includes a MAC subPDU with RAPID only:

4\> consider this Random Access procedure successfully completed;

4\> indicate the reception of an acknowledgement for SI request to upper
layers.

3\> else:

4\> apply the following actions for the Serving Cell where the Random
Access Preamble was transmitted:

5\> process the received Timing Advance Command (see subclause 5.2);

5\> indicate the *preambleReceivedTargetPower* and the amount of power
ramping applied to the latest Random Access Preamble transmission to
lower layers (i.e. (*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*);

5\> if the Serving Cell for the Random Access procedure is SRS-only
SCell:

6\> ignore the received UL grant.

5\> else:

6\> process the received UL grant value and indicate it to the lower
layers.

4\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

5\> consider the Random Access procedure successfully completed.

4\> else:

5\> set the *TEMPORARY\_C-RNTI* to the value received in the Random
Access Response;

5\> if this is the first successfully received Random Access Response
within this Random Access procedure:

6\> if the transmission is not being made for the CCCH logical channel:

> 7\> indicate to the Multiplexing and assembly entity to include a
> C-RNTI MAC CE in the subsequent uplink transmission.

6\> obtain the MAC PDU to transmit from the Multiplexing and assembly
entity and store it in the Msg3 buffer.

1\> if *ra-ResponseWindow* configured in *RACH-ConfigCommon* expires,
and if the Random Access Response containing Random Access Preamble
identifiers that matches the transmitted *PREAMBLE\_INDEX* has not been
received; or

1\> if *ra-ResponseWindow* configured in *BeamFailureRecoveryConfig*
expires and if the PDCCH addressed to the C-RNTI has not been received
on the Serving Cell where the preamble was transmitted:

2\> consider the Random Access Response reception not successful;

2\> increment *PREAMBLE\_TRANSMISSION\_COUNTER* by 1;

2\> if *PREAMBLE\_TRANSMISSION\_COUNTER* = *preambleTransMax* + 1:

3\> if the Random Access Preamble is transmitted on the SpCell:

4\> indicate a Random Access problem to upper layers;

4\> if this Random Access procedure was triggered for SI request:

5\> consider the Random Access procedure unsuccessfully completed.

3\> else if the Random Access Preamble is transmitted on a SCell:

4\> consider the Random Access procedure unsuccessfully completed.

2\> if the Random Access procedure is not completed:

3\> select a random backoff time according to a uniform distribution
between 0 and the *PREAMBLE\_BACKOFF*;

3\> if the criteria (as defined in subclause 5.1.2) to select
contention-free Random Access Resources is met during the backoff time:

4\> perform the Random Access Resource selection procedure (see
subclause 5.1.2);

3\> else:

4\> perform the Random Access Resource selection procedure (see
subclause 5.1.2) after the backoff time.

The MAC entity may stop *ra-ResponseWindow* (and hence monitoring for
Random Access Response(s)) after successful reception of a Random Access
Response containing Random Access Preamble identifiers that matches the
transmitted *PREAMBLE\_INDEX*.

HARQ operation is not applicable to the Random Access Response
transmission.

##### 7.1.1.1.4.3 Test description {#test-description-3 .H6}

##### 7.1.1.1.4.3.1 Pre-test conditions {#pre-test-conditions-3 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that set to return
no data in uplink.

##### 7.1.1.1.4.3.2 Test procedure sequence {#test-procedure-sequence-3 .H6}

Table 7.1.1.1.4.3.2-1/1A illustrates the downlink power levels and other
changing parameters to be applied for the cells at various time instants
of the test execution. Row marked \"T0\" denotes the initial conditions
after preamble, while columns marked \"T1\"and \"T2\"are to be applied
subsequently. The exact instants on which these values shall be applied
are described in the texts in this clause.

Table 7.1.1.1.4.3.2-1: Time instances of cell power level and parameter
changes for FR1

+-------+-------+-------+-------+-------+-------+-------+-------+
|       | Para  | Unit  | E     | NR    | NR    | NR    | R     |
|       | meter |       | -UTRA | Cell  | Cell  | Cell  | emark |
|       |       |       | Cell  | 1     | 1     | 1     |       |
|       |       |       | 1     |       | Beam  |       |       |
|       |       |       |       |       | index | Beam  |       |
|       |       |       |       |       | \#1   | index |       |
|       |       |       |       |       |       | \#0   |       |
+=======+=======+=======+=======+=======+=======+=======+=======+
| T0    | Cel   | dBm/  | -85   | \-    | \-    | \-    | Be    |
|       | l-spe | 15kHz |       |       |       |       | am\#1 |
|       | cific |       |       |       |       |       | S     |
|       | RS    |       |       |       |       |       | witch |
|       | EPRE  |       |       |       |       |       | ON    |
|       |       |       |       |       |       |       | and   |
|       |       |       |       |       |       |       | Be    |
|       |       |       |       |       |       |       | am\#0 |
|       |       |       |       |       |       |       | S     |
|       |       |       |       |       |       |       | witch |
|       |       |       |       |       |       |       | OFF   |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | Refe  | dB    | \-    | -88   | \-    | \-    |       |
|       | rence | m/SCS |       |       |       |       |       |
|       | Power |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | C     | dB    | \-    | \-    | 0     | -57   |       |
|       | SI-RS |       |       |       |       |       |       |
|       | EPRE  |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SS    |       |       |       |       |       |       |
|       | /PBCH |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SSS   |       |       |       |       |       |       |
|       | EPRE, |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| T1    | Cel   | dBm/  | -85   | \-    | \-    | \-    | Be    |
|       | l-spe | 15kHz |       |       |       |       | am\#1 |
|       | cific |       |       |       |       |       | S     |
|       | RS    |       |       |       |       |       | witch |
|       | EPRE  |       |       |       |       |       | OFF   |
|       |       |       |       |       |       |       | and   |
|       |       |       |       |       |       |       | Be    |
|       |       |       |       |       |       |       | am\#0 |
|       |       |       |       |       |       |       | S     |
|       |       |       |       |       |       |       | witch |
|       |       |       |       |       |       |       | ON    |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | Refe  | dB    | \-    | -88   | \-    | \-    |       |
|       | rence | m/SCS |       |       |       |       |       |
|       | Power |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | C     | dB    | \-    | \-    | -57   | 0     |       |
|       | SI-RS |       |       |       |       |       |       |
|       | EPRE  |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SS    |       |       |       |       |       |       |
|       | /PBCH |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SSS   |       |       |       |       |       |       |
|       | EPRE, |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| T2    | Cel   | dBm/  | -85   | \-    | \-    | \-    | Be    |
|       | l-spe | 15kHz |       |       |       |       | am\#1 |
|       | cific |       |       |       |       |       | S     |
|       | RS    |       |       |       |       |       | witch |
|       | EPRE  |       |       |       |       |       | ON    |
|       |       |       |       |       |       |       | and   |
|       |       |       |       |       |       |       | Be    |
|       |       |       |       |       |       |       | am\#0 |
|       |       |       |       |       |       |       | S     |
|       |       |       |       |       |       |       | witch |
|       |       |       |       |       |       |       | OFF   |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | Refe  | dB    | \-    | -88   | \-    | \-    |       |
|       | rence | m/SCS |       |       |       |       |       |
|       | Power |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | C     | dB    | \-    | \-    | 0     | -57   |       |
|       | SI-RS |       |       |       |       |       |       |
|       | EPRE  |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SS    |       |       |       |       |       |       |
|       | /PBCH |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SSS   |       |       |       |       |       |       |
|       | EPRE, |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| NOTE: |       |       |       |       |       |       |       |
| \     |       |       |       |       |       |       |       |
| "Beam |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#1\" |       |       |       |       |       |       |       |
| r     |       |       |       |       |       |       |       |
| efers |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| tr    |       |       |       |       |       |       |       |
| ansmi |       |       |       |       |       |       |       |
| ssion |       |       |       |       |       |       |       |
| of    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| SS    |       |       |       |       |       |       |       |
| /PBCH |       |       |       |       |       |       |       |
| block |       |       |       |       |       |       |       |
| with  |       |       |       |       |       |       |       |
| SSB   |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#1   |       |       |       |       |       |       |       |
| (acco |       |       |       |       |       |       |       |
| rding |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| s     |       |       |       |       |       |       |       |
| sb-Po |       |       |       |       |       |       |       |
| sitio |       |       |       |       |       |       |       |
| nsInB |       |       |       |       |       |       |       |
| urst) |       |       |       |       |       |       |       |
| and   |       |       |       |       |       |       |       |
| C     |       |       |       |       |       |       |       |
| SI-RS |       |       |       |       |       |       |       |
| with  |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#1   |       |       |       |       |       |       |       |
| (acco |       |       |       |       |       |       |       |
| rding |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| CSI-  |       |       |       |       |       |       |       |
| MeasC |       |       |       |       |       |       |       |
| onfig |       |       |       |       |       |       |       |
| being |       |       |       |       |       |       |       |
| sign  |       |       |       |       |       |       |       |
| alled |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| UE at |       |       |       |       |       |       |       |
| step  |       |       |       |       |       |       |       |
| 1/8   |       |       |       |       |       |       |       |
| /17); |       |       |       |       |       |       |       |
| \     |       |       |       |       |       |       |       |
| "Beam |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#0\" |       |       |       |       |       |       |       |
| r     |       |       |       |       |       |       |       |
| efers |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| tr    |       |       |       |       |       |       |       |
| ansmi |       |       |       |       |       |       |       |
| ssion |       |       |       |       |       |       |       |
| of    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| SS    |       |       |       |       |       |       |       |
| /PBCH |       |       |       |       |       |       |       |
| block |       |       |       |       |       |       |       |
| with  |       |       |       |       |       |       |       |
| SSB   |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#0   |       |       |       |       |       |       |       |
| (acco |       |       |       |       |       |       |       |
| rding |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| s     |       |       |       |       |       |       |       |
| sb-Po |       |       |       |       |       |       |       |
| sitio |       |       |       |       |       |       |       |
| nsInB |       |       |       |       |       |       |       |
| urst) |       |       |       |       |       |       |       |
| and   |       |       |       |       |       |       |       |
| C     |       |       |       |       |       |       |       |
| SI-RS |       |       |       |       |       |       |       |
| with  |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#0   |       |       |       |       |       |       |       |
| (acco |       |       |       |       |       |       |       |
| rding |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| CSI-  |       |       |       |       |       |       |       |
| MeasC |       |       |       |       |       |       |       |
| onfig |       |       |       |       |       |       |       |
| being |       |       |       |       |       |       |       |
| sign  |       |       |       |       |       |       |       |
| alled |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| UE at |       |       |       |       |       |       |       |
| step  |       |       |       |       |       |       |       |
| 1/8   |       |       |       |       |       |       |       |
| /17). |       |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+

Table 7.1.1.1.4.3.2-1A: Time instances of cell power level and parameter
changes for FR2

+-------+-------+-------+-------+-------+-------+-------+-------+
|       | Para  | Unit  | E     | NR    | NR    | NR    | R     |
|       | meter |       | -UTRA | Cell  | Cell  | Cell  | emark |
|       |       |       | Cell  | 1     | 1     | 1     |       |
|       |       |       | 1     |       | Beam  |       |       |
|       |       |       |       |       | index | Beam  |       |
|       |       |       |       |       | \#1   | index |       |
|       |       |       |       |       |       | \#0   |       |
+=======+=======+=======+=======+=======+=======+=======+=======+
| T0    | Cel   | dBm/  | -96   | \-    | \-    | \-    | Be    |
|       | l-spe | 15kHz |       |       |       |       | am\#1 |
|       | cific |       |       |       |       |       | S     |
|       | RS    |       |       |       |       |       | witch |
|       | EPRE  |       |       |       |       |       | ON    |
|       |       |       |       |       |       |       | and   |
|       |       |       |       |       |       |       | Be    |
|       |       |       |       |       |       |       | am\#0 |
|       |       |       |       |       |       |       | S     |
|       |       |       |       |       |       |       | witch |
|       |       |       |       |       |       |       | OFF   |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | Refe  | dB    | \-    | -82   | \-    | \-    |       |
|       | rence | m/SCS |       |       |       |       |       |
|       | Power |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | C     | dB    | \-    | \-    | 0     | -63   |       |
|       | SI-RS |       |       |       |       |       |       |
|       | EPRE  |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SS    |       |       |       |       |       |       |
|       | /PBCH |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SSS   |       |       |       |       |       |       |
|       | EPRE, |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| T1    | Cel   | dBm/  | -96   | \-    | \-    | \-    | Be    |
|       | l-spe | 15kHz |       |       |       |       | am\#1 |
|       | cific |       |       |       |       |       | S     |
|       | RS    |       |       |       |       |       | witch |
|       | EPRE  |       |       |       |       |       | OFF   |
|       |       |       |       |       |       |       | and   |
|       |       |       |       |       |       |       | Be    |
|       |       |       |       |       |       |       | am\#0 |
|       |       |       |       |       |       |       | S     |
|       |       |       |       |       |       |       | witch |
|       |       |       |       |       |       |       | ON    |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | Refe  | dB    | \-    | -82   | \-    | \-    |       |
|       | rence | m/SCS |       |       |       |       |       |
|       | Power |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | C     | dB    | \-    | \-    | -63   | 0     |       |
|       | SI-RS | m/SCS |       |       |       |       |       |
|       | EPRE  |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SS    |       |       |       |       |       |       |
|       | /PBCH |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SSS   |       |       |       |       |       |       |
|       | EPRE, |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| T2    | Cel   | dBm/  | -96   | \-    | \-    | \-    | Be    |
|       | l-spe | 15kHz |       |       |       |       | am\#1 |
|       | cific |       |       |       |       |       | S     |
|       | RS    |       |       |       |       |       | witch |
|       | EPRE  |       |       |       |       |       | ON    |
|       |       |       |       |       |       |       | and   |
|       |       |       |       |       |       |       | Be    |
|       |       |       |       |       |       |       | am\#0 |
|       |       |       |       |       |       |       | S     |
|       |       |       |       |       |       |       | witch |
|       |       |       |       |       |       |       | OFF   |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | Refe  | dB    | \-    | -82   | \-    | \-    |       |
|       | rence | m/SCS |       |       |       |       |       |
|       | Power |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | C     | dB    | \-    | \-    | 0     | -63   |       |
|       | SI-RS | m/SCS |       |       |       |       |       |
|       | EPRE  |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SS    |       |       |       |       |       |       |
|       | /PBCH |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SSS   |       |       |       |       |       |       |
|       | EPRE, |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| NOTE: |       |       |       |       |       |       |       |
| \     |       |       |       |       |       |       |       |
| "Beam |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#1\" |       |       |       |       |       |       |       |
| r     |       |       |       |       |       |       |       |
| efers |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| tr    |       |       |       |       |       |       |       |
| ansmi |       |       |       |       |       |       |       |
| ssion |       |       |       |       |       |       |       |
| of    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| SS    |       |       |       |       |       |       |       |
| /PBCH |       |       |       |       |       |       |       |
| block |       |       |       |       |       |       |       |
| with  |       |       |       |       |       |       |       |
| SSB   |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#1   |       |       |       |       |       |       |       |
| (acco |       |       |       |       |       |       |       |
| rding |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| s     |       |       |       |       |       |       |       |
| sb-Po |       |       |       |       |       |       |       |
| sitio |       |       |       |       |       |       |       |
| nsInB |       |       |       |       |       |       |       |
| urst) |       |       |       |       |       |       |       |
| and   |       |       |       |       |       |       |       |
| C     |       |       |       |       |       |       |       |
| SI-RS |       |       |       |       |       |       |       |
| with  |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#1   |       |       |       |       |       |       |       |
| (acco |       |       |       |       |       |       |       |
| rding |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| CSI-  |       |       |       |       |       |       |       |
| MeasC |       |       |       |       |       |       |       |
| onfig |       |       |       |       |       |       |       |
| being |       |       |       |       |       |       |       |
| sign  |       |       |       |       |       |       |       |
| alled |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| UE at |       |       |       |       |       |       |       |
| step  |       |       |       |       |       |       |       |
| 1/8   |       |       |       |       |       |       |       |
| /17); |       |       |       |       |       |       |       |
| \     |       |       |       |       |       |       |       |
| "Beam |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#0\" |       |       |       |       |       |       |       |
| r     |       |       |       |       |       |       |       |
| efers |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| tr    |       |       |       |       |       |       |       |
| ansmi |       |       |       |       |       |       |       |
| ssion |       |       |       |       |       |       |       |
| of    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| SS    |       |       |       |       |       |       |       |
| /PBCH |       |       |       |       |       |       |       |
| block |       |       |       |       |       |       |       |
| with  |       |       |       |       |       |       |       |
| SSB   |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#0   |       |       |       |       |       |       |       |
| (acco |       |       |       |       |       |       |       |
| rding |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| s     |       |       |       |       |       |       |       |
| sb-Po |       |       |       |       |       |       |       |
| sitio |       |       |       |       |       |       |       |
| nsInB |       |       |       |       |       |       |       |
| urst) |       |       |       |       |       |       |       |
| and   |       |       |       |       |       |       |       |
| C     |       |       |       |       |       |       |       |
| SI-RS |       |       |       |       |       |       |       |
| with  |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#0   |       |       |       |       |       |       |       |
| (acco |       |       |       |       |       |       |       |
| rding |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| CSI-  |       |       |       |       |       |       |       |
| MeasC |       |       |       |       |       |       |       |
| onfig |       |       |       |       |       |       |       |
| being |       |       |       |       |       |       |       |
| sign  |       |       |       |       |       |       |       |
| alled |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| UE at |       |       |       |       |       |       |       |
| step  |       |       |       |       |       |       |       |
| 1/8   |       |       |       |       |       |       |       |
| /17). |       |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+

Table 7.1.1.1.4.3.2-2: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\--     | NR RRC:   | \-      | \- |
|           | transmits |           | *R        |         |    |
|           | an NR     |           | RCReconfi |         |    |
|           | *R        |           | guration* |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | configure |           |           |         |    |
|           | p         |           |           |         |    |
|           | arameters |           |           |         |    |
|           | for BFR.  |           |           |         |    |
|           | Note 1.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | UE        | \--\>     | NR RRC:   | \-      | \- |
|           | responses |           | *         |         |    |
|           | NR        |           | RRCReconf |         |    |
|           | *         |           | iguration |         |    |
|           | RRCReconf |           | Complete* |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message.  |           |           |         |    |
|           | Note 2.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \-        | \-        | \-      | \- |
|           | changes   |           |           |         |    |
|           | NR Cell 1 |           |           |         |    |
|           | power     |           |           |         |    |
|           | level     |           |           |         |    |
|           | according |           |           |         |    |
|           | to the    |           |           |         |    |
|           | row       |           |           |         |    |
|           | \"T1\" in |           |           |         |    |
|           | table     |           |           |         |    |
|           | 7         |           |           |         |    |
|           | .1.1.1.4. |           |           |         |    |
|           | 3.2-1/1A. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | Check:    | \--\>     | PRACH     | 1       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | for the   |           |           |         |    |
|           | non-c     |           |           |         |    |
|           | ontention |           |           |         |    |
|           | free      |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Procedure |           |           |         |    |
|           | on NR     |           |           |         |    |
|           | Cell 1    |           |           |         |    |
|           | Beam      |           |           |         |    |
|           | index     |           |           |         |    |
|           | \#1?      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | a MAC PDU |           | Response  |         |    |
|           | addressed |           |           |         |    |
|           | to UE     |           |           |         |    |
|           | RA-RNTI,  |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | multiple  |           |           |         |    |
|           | RAR's and |           |           |         |    |
|           | one of    |           |           |         |    |
|           | the MAC   |           |           |         |    |
|           | sub       |           |           |         |    |
|           | headers   |           |           |         |    |
|           | contains  |           |           |         |    |
|           | a         |           |           |         |    |
|           | matching  |           |           |         |    |
|           | RAPID on  |           |           |         |    |
|           | NR Cell   |           |           |         |    |
|           | 1.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | UE sends  | \--\>     | msg3      | \-      | \- |
|           | a msg3    |           | (C-RNTI   |         |    |
|           | using the |           | MAC       |         |    |
|           | grant     |           | CONTROL   |         |    |
|           | a         |           | ELEMENT)  |         |    |
|           | ssociated |           |           |         |    |
|           | to the    |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | received  |           |           |         |    |
|           | in Step 5 |           |           |         |    |
|           | on NR     |           |           |         |    |
|           | Cell 1.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | SS        | \<\--     | C         | \-      | \- |
|           | schedules |           | ontention |         |    |
|           | PDCCH     |           | R         |         |    |
|           | tra       |           | esolution |         |    |
|           | nsmission |           |           |         |    |
|           | for UE    |           |           |         |    |
|           | C-RNTI.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Steps 8a1 |           |           |         |    |
|           | to 8a9    |           |           |         |    |
|           | describe  |           |           |         |    |
|           | behaviour |           |           |         |    |
|           | that      |           |           |         |    |
|           | depends   |           |           |         |    |
|           | on the UE |           |           |         |    |
|           | ca        |           |           |         |    |
|           | pability; |           |           |         |    |
|           | the       |           |           |         |    |
|           | "lower    |           |           |         |    |
|           | case      |           |           |         |    |
|           | letter"   |           |           |         |    |
|           | i         |           |           |         |    |
|           | dentifies |           |           |         |    |
|           | a step    |           |           |         |    |
|           | sequence  |           |           |         |    |
|           | that      |           |           |         |    |
|           | takes     |           |           |         |    |
|           | place if  |           |           |         |    |
|           | two       |           |           |         |    |
|           | cap       |           |           |         |    |
|           | abilities |           |           |         |    |
|           | (i.e      |           |           |         |    |
|           | pc\_max   |           |           |         |    |
|           | NumberCSI |           |           |         |    |
|           | \_RS\_BFD |           |           |         |    |
|           | AND       |           |           |         |    |
|           | pc\_      |           |           |         |    |
|           | maxNumber |           |           |         |    |
|           | CSI\_RS\_ |           |           |         |    |
|           | SSB\_CBD) |           |           |         |    |
|           | are       |           |           |         |    |
|           | s         |           |           |         |    |
|           | upported. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8a1       | IF        | \<\--     | NR RRC:   | \-      | \- |
|           | pc\_max   |           | *R        |         |    |
|           | NumberCSI |           | RCReconfi |         |    |
|           | \_RS\_BFD |           | guration* |         |    |
|           | AND       |           |           |         |    |
|           | pc\       |           |           |         |    |
|           | _maxNumbe |           |           |         |    |
|           | rCSI\_RS\ |           |           |         |    |
|           | _SSB\_CBD |           |           |         |    |
|           | THEN the  |           |           |         |    |
|           | SS        |           |           |         |    |
|           | transmits |           |           |         |    |
|           | an NR     |           |           |         |    |
|           | *R        |           |           |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | to        |           |           |         |    |
|           | establish |           |           |         |    |
|           | random    |           |           |         |    |
|           | access    |           |           |         |    |
|           | resources |           |           |         |    |
|           | for BFR   |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssociated |           |           |         |    |
|           | with SS   |           |           |         |    |
|           | blocks    |           |           |         |    |
|           | ex        |           |           |         |    |
|           | plicitly. |           |           |         |    |
|           | Note 1.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8a2       | UE        | \--\>     | NR RRC:   | \-      | \- |
|           | responses |           | *         |         |    |
|           | NR        |           | RRCReconf |         |    |
|           | *         |           | iguration |         |    |
|           | RRCReconf |           | Complete* |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message.  |           |           |         |    |
|           | Note 2.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8a3       | The SS    | \-        | \-        | \-      | \- |
|           | changes   |           |           |         |    |
|           | NR Cell 1 |           |           |         |    |
|           | power     |           |           |         |    |
|           | level     |           |           |         |    |
|           | according |           |           |         |    |
|           | to the    |           |           |         |    |
|           | row       |           |           |         |    |
|           | \"T2\" in |           |           |         |    |
|           | table     |           |           |         |    |
|           | 7         |           |           |         |    |
|           | .1.1.1.4. |           |           |         |    |
|           | 3.2-1/1A. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8a4       | Check:    | \--\>     | PRACH     | 2       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | using a   |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | with      |           |           |         |    |
|           | PREAMB    |           |           |         |    |
|           | LE\_INDEX |           |           |         |    |
|           | to a      |           |           |         |    |
|           | ra-Prea   |           |           |         |    |
|           | mbleIndex |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to the    |           |           |         |    |
|           | selected  |           |           |         |    |
|           | SS block  |           |           |         |    |
|           | provided  |           |           |         |    |
|           | by RRC on |           |           |         |    |
|           | NR Cell 1 |           |           |         |    |
|           | Beam      |           |           |         |    |
|           | index     |           |           |         |    |
|           | \#0?      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8a5       | The SS    | \-        | \-        | \-      | \- |
|           | waits for |           |           |         |    |
|           | ra        |           |           |         |    |
|           | -Response |           |           |         |    |
|           | WindowBFR |           |           |         |    |
|           | expire.   |           |           |         |    |
|           |           |           |           |         |    |
|           | NOTE: The |           |           |         |    |
|           | SS does   |           |           |         |    |
|           | not       |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | UE.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8a6       | Check:    | \--\>     | PRACH     | 4       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | r         |           |           |         |    |
|           | etransmit |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | with      |           |           |         |    |
|           | ra-Prea   |           |           |         |    |
|           | mbleIndex |           |           |         |    |
|           | same as   |           |           |         |    |
|           | the Step  |           |           |         |    |
|           | 11?       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8a7       | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | a MAC PDU |           | Response  |         |    |
|           | addressed |           |           |         |    |
|           | to UE     |           |           |         |    |
|           | C-RNTI,   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | multiple  |           |           |         |    |
|           | RAR's and |           |           |         |    |
|           | one of    |           |           |         |    |
|           | the MAC   |           |           |         |    |
|           | sub       |           |           |         |    |
|           | headers   |           |           |         |    |
|           | contains  |           |           |         |    |
|           | a         |           |           |         |    |
|           | matching  |           |           |         |    |
|           | RAPID on  |           |           |         |    |
|           | NR Cell   |           |           |         |    |
|           | 1.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8a8       | The SS    | \-        | \-        | \-      | \- |
|           | waits for |           |           |         |    |
|           | ra        |           |           |         |    |
|           | -Response |           |           |         |    |
|           | WindowBFR |           |           |         |    |
|           | expire.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8a9       | Check:    | \-        | \-        | 5       | F  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | r         |           |           |         |    |
|           | etransmit |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9-16      | Void      | \-        | \-        | \-      | \- |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Steps     |           |           |         |    |
|           | 17a1 to   |           |           |         |    |
|           | 17a9      |           |           |         |    |
|           | describe  |           |           |         |    |
|           | behaviour |           |           |         |    |
|           | that      |           |           |         |    |
|           | depends   |           |           |         |    |
|           | on the UE |           |           |         |    |
|           | ca        |           |           |         |    |
|           | pability; |           |           |         |    |
|           | the       |           |           |         |    |
|           | "lower    |           |           |         |    |
|           | case      |           |           |         |    |
|           | letter"   |           |           |         |    |
|           | i         |           |           |         |    |
|           | dentifies |           |           |         |    |
|           | a step    |           |           |         |    |
|           | sequence  |           |           |         |    |
|           | that      |           |           |         |    |
|           | takes     |           |           |         |    |
|           | place if  |           |           |         |    |
|           | three     |           |           |         |    |
|           | cap       |           |           |         |    |
|           | abilities |           |           |         |    |
|           | (i.e      |           |           |         |    |
|           | pc\_cs    |           |           |         |    |
|           | i\_RS\_CF |           |           |         |    |
|           | RA\_ForHO |           |           |         |    |
|           | AND       |           |           |         |    |
|           | pc\_max   |           |           |         |    |
|           | NumberCSI |           |           |         |    |
|           | \_RS\_BFD |           |           |         |    |
|           | AND       |           |           |         |    |
|           | pc\_      |           |           |         |    |
|           | maxNumber |           |           |         |    |
|           | CSI\_RS\_ |           |           |         |    |
|           | SSB\_CBD) |           |           |         |    |
|           | are       |           |           |         |    |
|           | s         |           |           |         |    |
|           | upported. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17a1      | IF        | \<\--     | NR RRC:   | \-      | \- |
|           | pc\_cs    |           | *R        |         |    |
|           | i\_RS\_CF |           | RCReconfi |         |    |
|           | RA\_ForHO |           | guration* |         |    |
|           | AND       |           |           |         |    |
|           | pc\_max   |           |           |         |    |
|           | NumberCSI |           |           |         |    |
|           | \_RS\_BFD |           |           |         |    |
|           | AND       |           |           |         |    |
|           | pc\       |           |           |         |    |
|           | _maxNumbe |           |           |         |    |
|           | rCSI\_RS\ |           |           |         |    |
|           | _SSB\_CBD |           |           |         |    |
|           | THEN the  |           |           |         |    |
|           | SS        |           |           |         |    |
|           | transmits |           |           |         |    |
|           | an NR     |           |           |         |    |
|           | *R        |           |           |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | establish |           |           |         |    |
|           | random    |           |           |         |    |
|           | access    |           |           |         |    |
|           | resources |           |           |         |    |
|           | for BFR   |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssociated |           |           |         |    |
|           | with      |           |           |         |    |
|           | CSI-RS    |           |           |         |    |
|           | ex        |           |           |         |    |
|           | plicitly. |           |           |         |    |
|           | Note 1.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17a2      | UE        | \--\>     | NR RRC:   | \-      | \- |
|           | responses |           | *         |         |    |
|           | NR        |           | RRCReconf |         |    |
|           | *         |           | iguration |         |    |
|           | RRCReconf |           | Complete* |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message.  |           |           |         |    |
|           | Note 2.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17a3      | The SS    | \-        | \-        | \-      | \- |
|           | changes   |           |           |         |    |
|           | NR Cell 1 |           |           |         |    |
|           | power     |           |           |         |    |
|           | level     |           |           |         |    |
|           | according |           |           |         |    |
|           | to the    |           |           |         |    |
|           | row       |           |           |         |    |
|           | \"T1\" in |           |           |         |    |
|           | table     |           |           |         |    |
|           | 7         |           |           |         |    |
|           | .1.1.1.4. |           |           |         |    |
|           | 3.2-1/1A. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17a4      | Check:    | \--\>     | PRACH     | 3       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | using a   |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | with      |           |           |         |    |
|           | PREAMB    |           |           |         |    |
|           | LE\_INDEX |           |           |         |    |
|           | to a      |           |           |         |    |
|           | ra-Prea   |           |           |         |    |
|           | mbleIndex |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to the    |           |           |         |    |
|           | selected  |           |           |         |    |
|           | CSI-RS    |           |           |         |    |
|           | provided  |           |           |         |    |
|           | by RRC on |           |           |         |    |
|           | NR Cell 1 |           |           |         |    |
|           | Beam      |           |           |         |    |
|           | index     |           |           |         |    |
|           | \#1?      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17a5      | The SS    | \-        | \-        | \-      | \- |
|           | waits for |           |           |         |    |
|           | ra        |           |           |         |    |
|           | -Response |           |           |         |    |
|           | WindowBFR |           |           |         |    |
|           | expire.   |           |           |         |    |
|           |           |           |           |         |    |
|           | NOTE: The |           |           |         |    |
|           | SS does   |           |           |         |    |
|           | not       |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | UE.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17a6      | Check:    | \--\>     | PRACH     | 4       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | r         |           |           |         |    |
|           | etransmit |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | with      |           |           |         |    |
|           | ra-Prea   |           |           |         |    |
|           | mbleIndex |           |           |         |    |
|           | same as   |           |           |         |    |
|           | the Step  |           |           |         |    |
|           | 20?       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17a7      | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | a MAC PDU |           | Response  |         |    |
|           | addressed |           |           |         |    |
|           | to UE     |           |           |         |    |
|           | C-RNTI,   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | multiple  |           |           |         |    |
|           | RAR's and |           |           |         |    |
|           | one of    |           |           |         |    |
|           | the MAC   |           |           |         |    |
|           | sub       |           |           |         |    |
|           | headers   |           |           |         |    |
|           | contains  |           |           |         |    |
|           | a         |           |           |         |    |
|           | matching  |           |           |         |    |
|           | RAPID on  |           |           |         |    |
|           | NR Cell   |           |           |         |    |
|           | 1.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17a8      | The SS    | \-        | \-        | \-      | \- |
|           | waits for |           |           |         |    |
|           | ra        |           |           |         |    |
|           | -Response |           |           |         |    |
|           | WindowBFR |           |           |         |    |
|           | expire.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17a9      | Check:    | \-        | \-        | 5       | F  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | r         |           |           |         |    |
|           | etransmit |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 18-25     | Void      | \-        | \-        | \-      | \- |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *R        |           |           |           |         |    |
| RCReconfi |           |           |           |         |    |
| guration* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RR       |           |           |           |         |    |
| CConnecti |           |           |           |         |    |
| onReconfi |           |           |           |         |    |
| guration* |           |           |           |         |    |
| 36.508    |           |           |           |         |    |
| \[7\],    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 4.6.1-8   |           |           |           |         |    |
| using     |           |           |           |         |    |
| condition |           |           |           |         |    |
| EN-DC\_   |           |           |           |         |    |
| EmbedNR\_ |           |           |           |         |    |
| RRCRecon. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *         |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RR       |           |           |           |         |    |
| CConnecti |           |           |           |         |    |
| onReconfi |           |           |           |         |    |
| gurationC |           |           |           |         |    |
| omplete*. |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.1.4.3.3 Specific message contents {#specific-message-contents-3 .H6}

Table 7.1.1.1.4.3.3-1: Void

Table 7.1.1.1.4.3.3-2: Void

Table 7.1.1.1.4.3.3-3: *RRCReconfiguration* (Step 1, Step8, Step17 Table
7.1.1.1.4.3.2-2)

  ------------------------------------------------- ----------------- ------------------------------------------- -----------
  Derivation path: 38.508-1 \[4\], Table 4.6.1-13                                                                 
  Information Element                               Value/remark      Comment                                     Condition
  RRCReconfiguration::=SEQUENCE{                                                                                  
  criticalExtensions CHOICE{                                                                                      
  rrcReconfiguration SEQUENCE{                                                                                    
  secondaryCellGroup                                CellGroupConfig   OCTET STRING                                EN-DC
  nonCriticalExtension SEQUENCE {                                                                                 NR
  masterCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   
  }                                                                                                               
  }                                                                                                               
  }                                                                                                               
  }                                                                                                               
  ------------------------------------------------- ----------------- ------------------------------------------- -----------

Table 7.1.1.1.4.3.3-4: *CellGroupConfig* (Table 7.1.1.1.4.3.3-3:
*RRCReconfiguration*)

  ---------------------------------------------------- ------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19                                 
  Information Element                                  Value/remark        Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                     
  spCellConfig SEQUENCE {                                                            
  spCellConfigDedicated                                ServingCellConfig             
  }                                                                                  
  }                                                                                  
  ---------------------------------------------------- ------------------- --------- -----------

Table 7.1.1.1.4.3.3-5: *ServingCellConfig* (Table 7.1.1.1.4.3.3-4:
*CellGroupConfig*)

  ----------------------------------------------------- ----------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                     
  Information Element                                   Value/remark            Comment   Condition
  ServingCellConfig ::= SEQUENCE {                                                        
  initialDownlinkBWP                                    BWP-DownlinkDedicated             
  uplinkConfig SEQUENCE {                                                                 
  initialUplinkBWP                                      BWP-UplinkDedicated               
  }                                                                                       
  csi-MeasConfig CHOICE {                                                                 Step 1
  setup                                                 *CSI-MeasConfig*                  
  }                                                                                       
  }                                                                                       
  ----------------------------------------------------- ----------------------- --------- -----------

Table 7.1.1.1.4.3.3-6: *BWP-DownlinkDedicated* (Table 7.1.1.1.4.3.3-5:
*ServingCellConfig*)

  ---------------------------------------------------- --------------------------- --------- ----------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-11                                         
  Information Element                                  Value/remark                Comment   Condition
  BWP-DownlinkDedicated ::= SEQUENCE {                                                       
  pdcch-Config                                         Not present                           Step 17
  pdcch-Config CHOICE {                                                                      Step 1, Step 8
  setup                                                PDCCH-Config                          
  }                                                                                          
  pdsch-Config CHOICE {                                                                      
  setup                                                PDSCH-Config                          
  }                                                                                          
  radioLinkMonitoringConfig CHOICE {                                                         
  setup                                                RadioLinkMonitoringConfig             
  }                                                                                          
  }                                                                                          
  ---------------------------------------------------- --------------------------- --------- ----------------

Table 7.1.1.1.4.3.3-7: RadioLinkMonitoringConfig (Table 7.1.1.1.4.3.3-6:
*BWP-DownlinkDedicated*)

  ----------------------------------------------------------------------------------------------------------------------- -------------- -------------------------- -----------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-133                                                                                                               
  Information Element                                                                                                     Value/remark   Comment                    Condition
  RadioLinkMonitoringConfig ::= SEQUENCE {                                                                                                                          
  failureDetectionResourcesToAddModList SEQUENCE (SIZE(1..maxNrofFailureDetectionResources)) OF RadioLinkMonitoringRS {   2 entries                                 
  RadioLinkMonitoringRS\[1\] SEQUENCE {                                                                                                  entry 1                    
  radioLinkMonitoringRS-Id                                                                                                0                                         
  purpose                                                                                                                 rlf                                       Step 1, Step 17
                                                                                                                          both                                      Step 8
  detectionResource CHOICE {                                                                                                                                        
  csi-rs                                                                                                                  0              NR Cell 1 Beam index \#0   
  }                                                                                                                                                                 
  }                                                                                                                                                                 
  RadioLinkMonitoringRS\[2\] SEQUENCE {                                                                                                  entry 2                    
  radioLinkMonitoringRS-Id                                                                                                1                                         
  purpose                                                                                                                 rlf                                       Step 1, Step 8
                                                                                                                          both                                      Step 17
  detectionResource CHOICE {                                                                                                                                        
  csi-rs                                                                                                                  1              NR Cell 1 Beam index \#1   
  }                                                                                                                                                                 
  }                                                                                                                                                                 
  }                                                                                                                                                                 
  beamFailureInstanceMaxCount                                                                                             n1                                        
  beamFailureDetectionTimer                                                                                               pbfd1                                     
  }                                                                                                                                                                 
  ----------------------------------------------------------------------------------------------------------------------- -------------- -------------------------- -----------------

Table 7.1.1.1.4.3.3-8: *PDSCH-Config* (Table 7.1.1.1.4.3.3-6:
*BWP-DownlinkDedicated*)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-100                                                                            
  ------------------------------------------------------------------------------ ---------------------------- ------------------ -----------
  Information Element                                                            Value/remark                 Comment            Condition
  PDSCH-Config ::= SEQUENCE {                                                                                                    
  tci-StatesToAddModList SEQUENCE(SIZE (1.. maxNrofTCI-States)) OF TCI-State {   3 entries                                       
  TCI-State\[1\] SEQUENCE {                                                                                   entry 1            
  tci-StateId                                                                    0                                               
  qcl-type1 SEQUENCE {                                                                                                           
  cell                                                                           ServCellIndex of NR SpCell   Cell ID            
  bwp-id                                                                         0                            BWP ID             
  referenceSignal CHOICE {                                                                                                       
  ssb                                                                            1                            SSB index \#1      
  }                                                                                                                              
  qcl-Type                                                                       type C                                          
  }                                                                                                                              
  qcl-type2                                                                      Not present                                     
  qcl-type2 SEQUENCE {                                                                                                           FR2
  cell                                                                           ServCellIndex of NR SpCell   Cell ID            
  bwp-id                                                                         0                            BWP ID             
  referenceSignal CHOICE {                                                                                                       
  ssb                                                                            1                            SSB index \#1      
  }                                                                                                                              
  qcl-Type                                                                       type D                                          
  }                                                                                                                              
  }                                                                                                                              
  TCI-State\[2\] SEQUENCE {                                                                                   entry 2            
  tci-StateId                                                                    1                                               
  qcl-type1 SEQUENCE {                                                                                                           
  cell                                                                           ServCellIndex of NR SpCell   Cell ID            
  bwp-id                                                                         0                            BWP ID             
  referenceSignal CHOICE {                                                                                                       
  ssb                                                                            0                            SSB index \#0      
  }                                                                                                                              
  qcl-Type                                                                       type C                                          
  }                                                                                                                              
  qcl-type2                                                                      Not present                                     
  qcl-type2 SEQUENCE {                                                                                                           FR2
  cell                                                                           ServCellIndex of NR SpCell   Cell ID            
  bwp-id                                                                         0                            BWP ID             
  referenceSignal CHOICE {                                                                                                       
  ssb                                                                            0                            SSB index \#0      
  }                                                                                                                              
  qcl-Type                                                                       type D                                          
  }                                                                                                                              
  }                                                                                                                              
  TCI-State\[3\] SEQUENCE {                                                                                   entry 3            
  tci-StateId                                                                    2                                               
  qcl-type1 SEQUENCE {                                                                                                           
  cell                                                                           ServCellIndex of NR SpCell   Cell ID            
  bwp-id                                                                         0                            BWP ID             
  referenceSignal CHOICE {                                                                                                       
  csi-rs                                                                         1                            Csi-Rs index \#1   
  }                                                                                                                              
  qcl-Type                                                                       type A                                          
  }                                                                                                                              
  qcl-type2                                                                      Not present                                     
  qcl-type2 SEQUENCE {                                                                                                           FR2
  cell                                                                           ServCellIndex of NR SpCell   Cell ID            
  bwp-id                                                                         0                            BWP ID             
  referenceSignal CHOICE {                                                                                                       
  Csi-rs                                                                         1                            Csi-Rs index \#1   
  }                                                                                                                              
  qcl-Type                                                                       type D                                          
  }                                                                                                                              
  }                                                                                                                              
  }                                                                                                                              
  }                                                                                                                              

Table 7.1.1.1.4.3.3-9: *PDCCH-Config* (Table 7.1.1.1.4.3.3-6:
*BWP-DownlinkDedicated*)

  Derivation Path: TS 38.508-1 \[4\],Table 4.6.3-95                                                                                  
  --------------------------------------------------------------------------------------- -------------------------------- --------- -----------
  Information Element                                                                     Value/remark                     Comment   Condition
  PDCCH-Config::= SEQUENCE {                                                                                                         
  controlResourceSetToAddModList SEQUENCE(SEQUENCE(SIZE (1..3)) OF ControlResourceSet {   2 entries                                  
  ControlResourceSet\[1\]                                                                 ControlResourceSetid1            entry 1   
  ControlResourceSet\[2\]                                                                 ControlResourceSetid2            entry 2   
  }                                                                                                                                  
  searchSpacesToAddModList SEQUENCE(SIZE (1..10)) OF SearchSpace {                        2 entries                                  
  SearchSpace\[1\]                                                                        SearchSpace with condition USS   entry 1   
  SearchSpace\[2\]                                                                        SearchSpaceBFR                   entry 2   
  }                                                                                                                                  
  }                                                                                                                                  

Table 7.1.1.1.4.3.3-10: *ControlResourceSetId1* (Table 7.1.1.1.4.3.3-9:
*PDCCH-Config*)

+-------------------+--------------+----------------+-----------+
| Derivation Path:  |              |                |           |
| TS 38.508-1       |              |                |           |
| \[4\], Table      |              |                |           |
| 4.6.3-28          |              |                |           |
+-------------------+--------------+----------------+-----------+
| Information       | Value/remark | Comment        | Condition |
| Element           |              |                |           |
+-------------------+--------------+----------------+-----------+
| C                 |              |                |           |
| ontrolResourceSet |              |                |           |
| ::= SEQUENCE {    |              |                |           |
+-------------------+--------------+----------------+-----------+
| con               | 1            |                |           |
| trolResourceSetId |              |                |           |
+-------------------+--------------+----------------+-----------+
| tci-Stat          | 1 entry      |                | Step 1    |
| esPDCCH-ToAddList |              |                |           |
| SEQUENCE (SIZE    |              |                |           |
| (1..maxNrof       |              |                |           |
| TCI-StatesPDCCH)) |              |                |           |
| OF TCI-StateId {  |              |                |           |
+-------------------+--------------+----------------+-----------+
| TCI-StateId\[1\]  | 2            | entry 1        |           |
|                   |              |                |           |
|                   |              | TCI-State Id 2 |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| tci-StatesPD      | 1 entry      |                | Step 8    |
| CCH-ToReleaseList |              |                |           |
| SEQUENCE (SIZE    |              |                |           |
| (1..maxNrof       |              |                |           |
| TCI-StatesPDCCH)) |              |                |           |
| OF TCI-StateId {  |              |                |           |
+-------------------+--------------+----------------+-----------+
| TCI-StateId\[1\]  | 2            | entry 1        |           |
|                   |              |                |           |
|                   |              | TCI-State Id 2 |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+

Table 7.1.1.1.4.3.3-11: *ControlResourceSetId2* (Table 7.1.1.1.4.3.3-9:
*PDCCH-Config*)

  ---------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-28                            
  Information Element                                  Value/remark   Comment   Condition
  ControlResourceSet ::= SEQUENCE {                                             
  controlResourceSetId                                 2                        
  }                                                                             
  ---------------------------------------------------- -------------- --------- -----------

Table 7.1.1.1.4.3.3-12: *SearchSpaceBFR* (Table 7.1.1.1.4.3.3-9:
*PDCCH-Config*)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-162                                  
  ----------------------------------------------------- -------------------- --------- -----------
  Information Element                                   Value/remark         Comment   Condition
  SearchSpace ::= SEQUENCE {                                                           
  searchSpaceId                                         4                              
  controlResourceSetId                                  2                              
  searchSpaceType CHOICE {                                                             
  ue-Specific SEQUENCE {                                                               
  dci-Formats                                           formats0-0-And-1-0             
  }                                                                                    
  }                                                                                    
  }                                                                                    

Table 7.1.1.1.4.3.3-13: *CSI-MeasConfig* (Table 7.1.1.1.4.3.3-5:
*ServingCellConfig*)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-38                                         
  ---------------------------------------------------- --------------------------- --------- -----------
  Information Element                                  Value/remark                Comment   Condition
  CSI-MeasConfig::= SEQUENCE {                                                               
  nzp-CSI-RS-ResourceToAddModList SEQUENCE {           2 entries                             
  NZP-CSI-RS-Resource\[1\]                             NZP-CSI-RS-ResourceId0                
  NZP-CSI-RS-Resource\[2\]                             NZP-CSI-RS-ResourceId1                
  }                                                                                          
  nzp-CSI-RS-ResourceSetToAddModList SEQUENCE {        1 entry                               
  NZP-CSI-RS-ResourceSet\[1\]                          NZP-CSI-RS-ResourceSetid0             
  }                                                                                          
  csi-IM-ResourceToAddModList                          Not present                           
  csi-IM-ResourceSetToAddModList                       Not present                           
  csi-SSB-ResourceSetToAddModList                      Not present                           
  csi-ReportConfigToAddModList                         Not present                           
  reportTriggerSize                                    Not present                           
  aperiodicTriggerStateList                            Not present                           
  }                                                                                          

Table 7.1.1.1.4.3.3-14: *NZP-CSI-RS-ResourceId0* (Table
7.1.1.1.4.3.3-13: *CSI-MeasConfig*)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-85                                                                                   
  ---------------------------------------------------- ------------------------------------------- ----------------------------------- -----------
  Information Element                                  Value/remark                                Comment                             Condition
  NZP-CSI-RS-Resource ::= SEQUENCE {                                                                                                   
  nzp-CSI-RS-ResourceId                                0                                                                               
  resourceMapping                                      CSI-RS-ResourceMapping with condition TRS   TS 38.508-1 \[4\], Table 4.6.3-45   
  qcl-InfoPeriodicCSI-RS                               0                                           QCL to SSB \#0                      
  }                                                                                                                                    

Table 7.1.1.1.4.3.3-15: *NZP-CSI-RS-ResourceId1* (Table
7.1.1.1.4.3.3-13: *CSI-MeasConfig*)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-85                                                                                   
  ---------------------------------------------------- ------------------------------------------- ----------------------------------- -----------
  Information Element                                  Value/remark                                Comment                             Condition
  NZP-CSI-RS-Resource ::= SEQUENCE {                                                                                                   
  nzp-CSI-RS-ResourceId                                1                                                                               
  resourceMapping                                      CSI-RS-ResourceMapping with condition TRS   TS 38.508-1 \[4\], Table 4.6.3-45   
  periodicityAndOffset                                 CSI-ResourcePeriodicityAndOffset\_Id1                                           
  qcl-InfoPeriodicCSI-RS                               1                                           QCL to SSB \#1                      
  }                                                                                                                                    

Table 7.1.1.1.4.3.3-16: *CSI-ResourcePeriodicityAndOffset\_Id1* (Table
7.1.1.1.4.3.3-15: *NZP-CSI-RS-ResourceId1*)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-43                            
  ---------------------------------------------------- -------------- --------- -----------
  Information Element                                  Value/remark   Comment   Condition
  CSI-ResourcePeriodicityAndOffset ::= CHOICE {                                 
  slots80                                              11                       FR1
  slots320                                             41                       FR2
  }                                                                             

Table 7.1.1.1.4.3.3-17: *NZP-CSI-RS-ResourceSetid0* (Table
7.1.1.1.4.3.3-13: *CSI-MeasConfig*)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-87                                                                                
  -------------------------------------------------------------------------------------------------------- -------------- --------- -----------
  Information Element                                                                                      Value/remark   Comment   Condition
  NZP-CSI-RS-ResourceSet ::= SEQUENCE {                                                                                             
  nzp-CSI-ResourceSetId                                                                                    0                        
  nzp-CSI-RS-Resources SEQUENCE (SIZE (1..maxNrofNZP-CSI-RS-ResourcesPerSet)) OF NZP-CSI-RS-ResourceId {   2 entries                
  NZP-CSI-RS-ResourceId\[1\]                                                                               0              entry 1   
  NZP-CSI-RS-ResourceId\[2\]                                                                               1              entry 2   
  }                                                                                                                                 
  trs-Info                                                                                                 true                     
  }                                                                                                                                 

Table 7.1.1.1.4.3.3-18: *BWP-UplinkDedicated* (Table 7.1.1.1.4.3.3-5:
*ServingCellConfig*)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-15                                                
  ---------------------------------------------------- ---------------------------------- --------- -----------
  Information Element                                  Value/remark                       Comment   Condition
  BWP-UplinkDedicated ::= SEQUENCE {                                                                
  pucch-Config CHOICE {                                                                             
  setup                                                PUCCH-Config                                 
  }                                                                                                 
  pusch-Config CHOICE {                                                                             
  setup                                                PUSCH-Config                                 
  }                                                                                                 
  beamFailureRecoveryConfig                            BeamFailureRecoveryConfig\_SSB               Step8
                                                       BeamFailureRecoveryConfig\_CSIRS             Step17
                                                       Not Present                                  Step1
  }                                                                                                 

Table 7.1.1.1.4.3.3-19: *BeamFailureRecoveryConfig\_SSB* (Table
7.1.1.1.4.3.3-18: *BWP-UplinkDedicated*)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-6                                                                                                                              
  ----------------------------------------------------------------------------------------------------- -------------------- --------------------------------------------------- -----------
  Information Element                                                                                   Value/remark         Comment                                             Condition
  BeamFailureRecoveryConfig ::= SEQUENCE {                                                                                                                                       
  rootSequenceIndex-BFR                                                                                 0                    See TS 38.508-1 \[4\] clause 4.4.2, Table 4.4.2-2   
  rach-ConfigBFR                                                                                        RACH-ConfigGeneric   38.508-1 \[4\] Table 4.6.3-130                      
  rsrp-ThresholdSSB                                                                                     57(-99dBm)                                                               
  candidateBeamRSList SEQUENCE (SIZE(1..maxNrofCandidateBeams)) OF PRACH-ResourceDedicatedBFR CHOICE{                                                                            
  ssb SEQUENCE {                                                                                                                                                                 
  ssb                                                                                                   1                    NR Cell Beam\#1                                     
  ra-PreambleIndex                                                                                      56                   (0..63)                                             
  }                                                                                                                                                                              
  }                                                                                                                                                                              
  ssb-perRACH-Occasion                                                                                  one                                                                      
  ra-ssb-OccasionMaskIndex                                                                              0                                                                        
  recoverySearchSpaceID                                                                                 4                                                                        
  ra-Prioritization                                                                                     Not Present                                                              
  beamFailureRecoveryTimer                                                                              ms200                                                                    
  }                                                                                                                                                                              

Table 7.1.1.1.4.3.3-20: *BeamFailureRecoveryConfig\_CSIRS* (Table
7.1.1.1.4.3.3-18: *BWP-UplinkDedicated*)

+-----------------+-----------------+-----------------+-----------+
| Derivation      |                 |                 |           |
| Path: TS        |                 |                 |           |
| 38.508-1 \[4\], |                 |                 |           |
| Table 4.6.3-6   |                 |                 |           |
+=================+=================+=================+===========+
| Information     | Value/remark    | Comment         | Condition |
| Element         |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| BeamFailur      |                 |                 |           |
| eRecoveryConfig |                 |                 |           |
| ::= SEQUENCE {  |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| rootSe          | 0               | See TS 38.508-1 |           |
| quenceIndex-BFR |                 | \[4\] clause    |           |
|                 |                 | 4.4.2, Table    |           |
|                 |                 | 4.4.2-2         |           |
+-----------------+-----------------+-----------------+-----------+
| rach-ConfigBFR  | RAC             | 38.508-1 \[4\]  |           |
|                 | H-ConfigGeneric | Table 4.6.3-130 |           |
+-----------------+-----------------+-----------------+-----------+
| rs              | 57(-99dBm)      |                 |           |
| rp-ThresholdSSB |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| cand            |                 |                 |           |
| idateBeamRSList |                 |                 |           |
| SEQUENCE        |                 |                 |           |
| (S              |                 |                 |           |
| IZE(1..maxNrofC |                 |                 |           |
| andidateBeams)) |                 |                 |           |
| OF              |                 |                 |           |
| PRACH-Resou     |                 |                 |           |
| rceDedicatedBFR |                 |                 |           |
| CHOICE{         |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| csi-RS SEQUENCE |                 |                 |           |
| {               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| csi-RS          | 0               |                 |           |
+-----------------+-----------------+-----------------+-----------+
| ra-OccasionList | 1 entry         |                 |           |
| SEQUENCE        |                 |                 |           |
| (SIZ            |                 |                 |           |
| E(1..maxRA-Occa |                 |                 |           |
| sionsPerCSIRS)) |                 |                 |           |
| OF INTEGER      |                 |                 |           |
| (0..max         |                 |                 |           |
| RA-Occasions-1) |                 |                 |           |
| {               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| INTEGER\[1\]    | 0               | entry 1         |           |
|                 |                 |                 |           |
|                 |                 | NR Cell Beam\#0 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| r               | 59              |                 |           |
| a-PreambleIndex |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| ssb-p           | Not Present     |                 |           |
| erRACH-Occasion |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| ra-ssb-Oc       | Not Present     |                 |           |
| casionMaskIndex |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| recove          | 4               |                 |           |
| rySearchSpaceID |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| ra              | Not Present     |                 |           |
| -Prioritization |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| beamFailu       | ms200           |                 |           |
| reRecoveryTimer |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+

Table 7.1.1.1.4.3.3-21: *PUCCH-Config* (Table 7.1.1.1.4.3.3-18:
*BWP-UplinkDedicated*)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-112                                                                                   
  ------------------------------------------------------------------------------------------------------------ -------------- --------- ---------------
  Information Element                                                                                          Value/remark   Comment   Condition
  pucch-Config::= SEQUENCE {                                                                                                            
  pucch-PowerControl SEQUENCE {                                                                                                         
  pathlossReferenceRSs SEQUENCE (SIZE (1..maxNrofPUCCH-PathlossReferenceRSs)) OF PUCCH-PathlossReferenceRS {   1 entry                  
  PUCCH-PathlossReferenceRS\[1\] SEQUENCE {                                                                                   entry 1   
  referenceSignal CHOICE {                                                                                                              
  ssb-Index                                                                                                    1                        Step1, Step17
                                                                                                               0                        Step8
  }                                                                                                                                     
  }                                                                                                                                     
  }                                                                                                                                     
  }                                                                                                                                     
  }                                                                                                                                     

Table 7.1.1.1.4.3.3-22: *PUSCH-Config* (Table 7.1.1.1.4.3.3-18:
*BWP-UplinkDedicated*)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-118                                                                                              
  ----------------------------------------------------------------------------------------------------------------------- -------------- --------- ---------------
  Information Element                                                                                                     Value/remark   Comment   Condition
  pusch-Config::= SEQUENCE {                                                                                                                       
  pusch-PowerControl SEQUENCE {                                                                                                                    
  pathlossReferenceRSToAddModList SEQUENCE (SIZE (1..maxNrofPUSCH-PathlossReferenceRSs)) OF PUSCH-PathlossReferenceRS {   1 entry                  
  PUSCH-PathlossReferenceRS\[1\] SEQUENCE {                                                                                              entry 1   
  referenceSignal CHOICE{                                                                                                                          
  ssb-Index                                                                                                               1                        Step1, Step17
                                                                                                                          0                        Step8
  }                                                                                                                                                
  }                                                                                                                                                
  }                                                                                                                                                
  }                                                                                                                                                
  }                                                                                                                                                

##### 7.1.1.1.5 Random access procedure / Successful / Supplementary Uplink

##### 7.1.1.1.5.1 Test Purpose (TP) {#test-purpose-tp-4 .H6}

##### (1) {#section-21 .H6}

**with** { UE in RRC\_CONNECTED state with supplementary uplink
configured and RACH procedure is triggered }

**ensure** **that** {

**when** { RSRP of the downlink pathloss reference is less than
*rsrp-ThresholdSSB-SUL* }

**then** { UE performs the Random Access Procedure on the Supplementary
Uplink carrier }

}

##### (2) {#section-22 .H6}

**with** { UE in RRC\_CONNECTED state with supplementary uplink and
uplink on SUL carrier}

**ensure** **that** {

**when** { UE receives DCI indicating transmission on NUL carrier }

**then** { UE transmits on NUL carrier }

}

##### 7.1.1.1.5.2 Conformance requirements {#conformance-requirements-4 .H6}

References: The conformance requirements covered in the present TC are
specified in TS 38.321: clause 5.1.1 and clause 5.16. Unless otherwise
stated these are Rel-15 requirements.

\[TS 38.321, clause 5.1.1\]

The Random Access procedure described in this clause is initiated by a
PDCCH order, by the MAC entity itself, or by RRC for the events in
accordance with TS 38.300 \[2\]. There is only one Random Access
procedure ongoing at any point in time in a MAC entity. The Random
Access procedure on an SCell shall only be initiated by a PDCCH order
with *ra-PreambleIndex* different from 0b000000.

NOTE 1: If a new Random Access procedure is triggered while another is
already ongoing in the MAC entity, it is up to UE implementation whether
to continue with the ongoing procedure or start with the new procedure
(e.g. for SI request).

RRC configures the following parameters for the Random Access procedure:

\- *prach-ConfigurationIndex*: the available set of PRACH occasions for
the transmission of the Random Access Preamble;

\- *preambleReceivedTargetPower*: initial Random Access Preamble power;

\- *rsrp-ThresholdSSB*: an RSRP threshold for the selection of the SSB.
If the Random Access procedure is initiated for beam failure recovery,
*rsrp-ThresholdSSB* used for the selection of the SSB within
*candidateBeamRSList* refers to *rsrp-ThresholdSSB* in
*BeamFailureRecoveryConfig* IE;

\- *rsrp-ThresholdCSI-RS*: an RSRP threshold for the selection of
CSI-RS. If the Random Access procedure is initiated for beam failure
recovery, *rsrp-ThresholdCSI-RS* is equal to *rsrp-ThresholdSSB* in
*BeamFailureRecoveryConfig* IE;

\- *rsrp-ThresholdSSB-SUL*: an RSRP threshold for the selection between
the NUL carrier and the SUL carrier;

\- *candidateBeamRSList*: a list of reference signals (CSI*-RS* and/or
SSB) identifying the candidate beams for recovery and the associated
Random Access parameters;

\- *recoverySearchSpaceId*: the search space identity for monitoring the
response of the beam failure recovery request;

\- *powerRampingStep*: the power-ramping factor;

\- *powerRampingStepHighPriority*: the power-ramping factor in case of
prioritized Random Access procedure;

\- *scalingFactorBI*: a scaling factor for prioritized Random Access
procedure;

\- *ra-PreambleIndex*: Random Access Preamble;

\- *ra-ssb-OccasionMaskIndex*: defines PRACH occasion(s) associated with
an SSB in which the MAC entity may transmit a Random Access Preamble
(see clause 7.4);

\- *ra-OccasionList*: defines PRACH occasion(s) associated with a CSI-RS
in which the MAC entity may transmit a Random Access Preamble;

\- *ra-PreambleStartIndex*: the starting index of Random Access
Preamble(s) for on-demand SI request;

\- *preambleTransMax*: the maximum number of Random Access Preamble
transmission;

\- *ssb-perRACH-OccasionAndCB-PreamblesPerSSB*: defines the number of
SSBs mapped to each PRACH occasion and the number of contention-based
Random Access Preambles mapped to each SSB;

\- if *groupBconfigured* is configured, then Random Access Preambles
group B is configured.

\- Amongst the contention-based Random Access Preambles associated with
an SSB (as defined in TS 38.213 \[6\]), the first
*numberOfRA-PreamblesGroupA* Random Access Preambles belong to Random
Access Preambles group A. The remaining Random Access Preambles
associated with the SSB belong to Random Access Preambles group B (if
configured).

NOTE 2: If Random Access Preambles group B is supported by the cell
Random Access Preambles group B is included for each SSB.

\- if Random Access Preambles group B is configured:

\- *ra-Msg3SizeGroupA*: the threshold to determine the groups of Random
Access Preambles;

\- *msg3-DeltaPreamble*: âˆ†*~PREAMBLE\_Msg3~* in TS 38.213 \[6\];

\- *messagePowerOffsetGroupB*: the power offset for preamble selection;

\- *numberOfRA-PreamblesGroupA*: defines the number of Random Access
Preambles in Random Access Preamble group A for each SSB.

\- the set of Random Access Preambles and/or PRACH occasions for SI
request, if any;

\- the set of Random Access Preambles and/or PRACH occasions for beam
failure recovery request, if any;

\- the set of Random Access Preambles and/or PRACH occasions for
reconfiguration with sync, if any;

\- *ra-ResponseWindow*: the time window to monitor RA response(s)
(SpCell only);

\- *ra-ContentionResolutionTimer*: the Contention Resolution Timer
(SpCell only).

In addition, the following information for related Serving Cell is
assumed to be available for UEs:

\- if Random Access Preambles group B is configured:

\- if the Serving Cell for the Random Access procedure is configured
with supplementary uplink as specified in TS 38.331 \[5\], and SUL
carrier is selected for performing Random Access Procedure:

\- P~CMAX,f,c~ of the SUL carrier as specified in TS 38.101-1 \[14\], TS
38.101-2 \[15\], and TS 38.101-3 \[16\].

\- else:

\- P~CMAX,f,c~ of the NUL carrier as specified in TS 38.101-1 \[14\], TS
38.101-2 \[15\], and TS 38.101-3 \[16\].

The following UE variables are used for the Random Access procedure:

\- *PREAMBLE\_INDEX*;

\- *PREAMBLE\_TRANSMISSION\_COUNTER*;

\- *PREAMBLE\_POWER\_RAMPING\_COUNTER*;

\- *PREAMBLE\_POWER\_RAMPING\_STEP*;

\- *PREAMBLE\_RECEIVED\_TARGET\_POWER*;

\- *PREAMBLE\_BACKOFF*;

\- *PCMAX*;

\- *SCALING\_FACTOR\_BI*;

\- *TEMPORARY\_C-RNTI*.

When the Random Access procedure is initiated on a Serving Cell, the MAC
entity shall:

1\> flush the Msg3 buffer;

1\> set the *PREAMBLE\_TRANSMISSION\_COUNTER* to 1;

1\> set the *PREAMBLE\_POWER\_RAMPING\_COUNTER* to 1;

1\> set the *PREAMBLE\_BACKOFF* to 0 ms;

1\> if the carrier to use for the Random Access procedure is explicitly
signalled:

2\> select the signalled carrier for performing Random Access procedure;

2\> set the *PCMAX* to P~CMAX,f,c~ of the signalled carrier.

1\> else if the carrier to use for the Random Access procedure is not
explicitly signalled; and

1\> if the Serving Cell for the Random Access procedure is configured
with supplementary uplink as specified in TS 38.331 \[5\]; and

1\> if the RSRP of the downlink pathloss reference is less than
*rsrp-ThresholdSSB-SUL*:

2\> select the SUL carrier for performing Random Access procedure;

2\> set the *PCMAX* to P~CMAX,f,c~ of the SUL carrier.

1\> else:

2\> select the NUL carrier for performing Random Access procedure;

2\> set the *PCMAX* to P~CMAX,f,c~ of the NUL carrier.

1\> perform the BWP operation as specified in clause 5.15;

1\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to

*powerRampingStep*;1\> set *SCALING\_FACTOR\_BI* to 1;

1\> if the Random Access procedure was initiated for beam failure
recovery (as specified in clause 5.17); and

1\> if *beamFailureRecoveryConfig* is configured for the active UL BWP
of the selected carrier:

2\> start the *beamFailureRecoveryTimer*, if configured;

2\> apply the parameters *powerRampingStep*,
*preambleReceivedTargetPower*, and *preambleTransMax* configured in the
*beamFailureRecoveryConfig*;

2\> if *powerRampingStepHighPriority* is configured in the
*beamFailureRecoveryConfig*:

3\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority*.

2\> else:

3\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to *powerRampingStep*.

2\> if *scalingFactorBI* is configured in the
*beamFailureRecoveryConfig*:

3\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

1\> else if the Random Access procedure was initiated for handover; and

1\> if *rach-ConfigDedicated* is configured for the selected carrier:

2\> if *powerRampingStepHighPriority* is configured in the
*rach-ConfigDedicated*:

3\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority*.

2\> if *scalingFactorBI* is configured in the *rach-ConfigDedicated*:

3\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

1\> perform the Random Access Resource selection procedure (see clause
5.1.2).

\[TS 38.321, clause 5.16\]

The Supplementary UL (SUL) carrier can be configured as a complement to
the normal UL (NUL) carrier. Switching between the NUL carrier and the
SUL carrier means that the UL transmissions move from one carrier to the
other carrier, which is done by:

\- an indication in DCI;

\- the Random Access procedure as specified in clause 5.1.1.

If the MAC entity receives a UL grant indicating an SUL switch while a
Random Access procedure is ongoing, the MAC entity shall ignore the UL
grant.

The Serving Cell configured with *supplementaryUplink* belongs to a
single TAG.

##### 7.1.1.1.5.3 Test description {#test-description-4 .H6}

##### 7.1.1.1.5.3.1 Pre-test conditions {#pre-test-conditions-4 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that supplementary
uplink (SUL) carrier is configured on NR Cell 33.

##### 7.1.1.1.5.3.2 Test procedure sequence {#test-procedure-sequence-4 .H6}

Table 7.1.1.1.5.3.2-1 illustrates the downlink power levels to be
applied for the NR cells at various time instants of the test execution.
Row marked \"T0\" denotes the initial conditions, while row marked
\"T1\" are to be applied subsequently. The exact instants on which these
values shall be applied are described in the texts in this clause.

Table 7.1.1.1.5.3.2-1: Time instances of cell power level changes

+----+-----------+---------+-----------+-----------+-----------+
|    | Parameter | Unit    | NR Cell 1 | NR Cell   | Remark    |
|    |           |         |           | 33 (SUL)  |           |
|    |           |         | (NUL)     |           |           |
+====+===========+=========+===========+===========+===========+
| T0 | SS/PBCH   | dBm/SCS | -75       | N/A       | NR Cell1  |
|    |           |         |           |           | Power     |
|    | SSS EPRE  |         |           |           | level is  |
|    |           |         |           |           | higher    |
|    |           |         |           |           | than      |
|    |           |         |           |           | *rsrp-    |
|    |           |         |           |           | Threshold |
|    |           |         |           |           | SSB-SUL.* |
+----+-----------+---------+-----------+-----------+-----------+
| T1 | SS/PBCH   | dBm/SCS | -85       | N/A       | NR Cell1  |
|    |           |         |           |           | Power     |
|    | SSS EPRE  |         |           |           | level is  |
|    |           |         |           |           | lower     |
|    |           |         |           |           | than      |
|    |           |         |           |           | *rsrp-    |
|    |           |         |           |           | Threshold |
|    |           |         |           |           | SSB-SUL.* |
+----+-----------+---------+-----------+-----------+-----------+

Table 7.1.1.1.5.3.2-2: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    |           | \-        | \-      | \- |
|           | ignores   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | requests  |           |           |         |    |
|           | and does  |           |           |         |    |
|           | not       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | any       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a PDCP    |           |           |         |    |
|           | SDU on NR |           |           |         |    |
|           | Cell 1.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \-        | \-        | \-      | \- |
|           | changes   |           |           |         |    |
|           | NR Cell   |           |           |         |    |
|           | 1's power |           |           |         |    |
|           | level     |           |           |         |    |
|           | according |           |           |         |    |
|           | to the    |           |           |         |    |
|           | row       |           |           |         |    |
|           | \"T1\" in |           |           |         |    |
|           | table     |           |           |         |    |
|           | 7.1.1.1   |           |           |         |    |
|           | .5.3.2-1. |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | Void.     | \-        | \-        | \-      | \- |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Check:    | \--\>     | PRACH     | 1       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | initiate  |           |           |         |    |
|           | the       |           |           |         |    |
|           | random    |           |           |         |    |
|           | access    |           |           |         |    |
|           | procedure |           |           |         |    |
|           | on SUL    |           |           |         |    |
|           | carrier   |           |           |         |    |
|           | on NR     |           |           |         |    |
|           | Cell 33?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | Random    |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | with an   |           |           |         |    |
|           | UL Grant  |           |           |         |    |
|           | of        |           |           |         |    |
|           | 56-bits   |           |           |         |    |
|           | on NR     |           |           |         |    |
|           | Cell 1    |           |           |         |    |
|           | and RAPID |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to the    |           |           |         |    |
|           | tr        |           |           |         |    |
|           | ansmitted |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 5. (Note  |           |           |         |    |
|           | 2)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | Check:    | \--\>     | Msg3      | 1       | P  |
|           | Does the  |           | (C-RNTI   |         |    |
|           | UE send a |           | MAC CE)   |         |    |
|           | msg3      |           |           |         |    |
|           | using the |           |           |         |    |
|           | grant     |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssociated |           |           |         |    |
|           | to the    |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | received  |           |           |         |    |
|           | in Step 6 |           |           |         |    |
|           | on SUL    |           |           |         |    |
|           | carrier   |           |           |         |    |
|           | on NR     |           |           |         |    |
|           | Cell 33?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | The SS    | \<\--     | C         | \-      | \- |
|           | schedules |           | ontention |         |    |
|           | PDCCH     |           | R         |         |    |
|           | tra       |           | esolution |         |    |
|           | nsmission |           |           |         |    |
|           | on NR     |           |           |         |    |
|           | Cell 1    |           |           |         |    |
|           | for UE    |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | with      |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant's   |           |           |         |    |
|           | UL/SUL    |           |           |         |    |
|           | indicator |           |           |         |    |
|           | set to 1. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | with      |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back PDCP |           |           |         |    |
|           | SDU on    |           |           |         |    |
|           | SUL       |           |           |         |    |
|           | carrier   |           |           |         |    |
|           | on NR     |           |           |         |    |
|           | Cell 33?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a PDCP    |           |           |         |    |
|           | SDU on NR |           |           |         |    |
|           | Cell 1.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | The SS    | \<\--     | DCI       | \-      | \- |
|           | schedules |           | format    |         |    |
|           | PDCCH     |           | 0\_0(UE   |         |    |
|           | tra       |           | C-RNTI,   |         |    |
|           | nsmission |           | UL/SUL    |         |    |
|           | on NR     |           | indicator |         |    |
|           | Cell 1    |           | = "0")    |         |    |
|           | for UE    |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | with      |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant's   |           |           |         |    |
|           | UL/SUL    |           |           |         |    |
|           | indicator |           |           |         |    |
|           | set to 0. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | with      |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back PDCP |           |           |         |    |
|           | SDU on    |           |           |         |    |
|           | NUL       |           |           |         |    |
|           | carrier   |           |           |         |    |
|           | on NR     |           |           |         |    |
|           | Cell 1?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| Reduce    |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| Cell 1    |           |           |           |         |    |
| SS/PBCH   |           |           |           |         |    |
| EPRE      |           |           |           |         |    |
| level to  |           |           |           |         |    |
| ensure    |           |           |           |         |    |
| that RSRP |           |           |           |         |    |
| of the    |           |           |           |         |    |
| downlink  |           |           |           |         |    |
| pathloss  |           |           |           |         |    |
| reference |           |           |           |         |    |
| is lower  |           |           |           |         |    |
| than      |           |           |           |         |    |
| rsrp      |           |           |           |         |    |
| -Threshol |           |           |           |         |    |
| dSSB-SUL, |           |           |           |         |    |
| while UE  |           |           |           |         |    |
| is still  |           |           |           |         |    |
| able to   |           |           |           |         |    |
| receive   |           |           |           |         |    |
| msg2 and  |           |           |           |         |    |
| msg4      |           |           |           |         |    |
| c         |           |           |           |         |    |
| orrectly. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| UL grant  |           |           |           |         |    |
| of 56     |           |           |           |         |    |
| bits is   |           |           |           |         |    |
| to make   |           |           |           |         |    |
| UE not    |           |           |           |         |    |
| send any  |           |           |           |         |    |
| loopback  |           |           |           |         |    |
| data in   |           |           |           |         |    |
| uplink    |           |           |           |         |    |
| with      |           |           |           |         |    |
| msg3,     |           |           |           |         |    |
| according |           |           |           |         |    |
| to TS     |           |           |           |         |    |
| 38.321    |           |           |           |         |    |
| \[18\]    |           |           |           |         |    |
| clause    |           |           |           |         |    |
| 5.4.3.1.  |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.1.5.3.3 Specific message contents {#specific-message-contents-4 .H6}

Table 7.1.1.1.5.3.3-1: *SIB1 of NR Cell 1* (preamble and all steps,
Table 7.1.1.1.5.3.2-2)

  ---------------------------------------------------- ---------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-28                                          
  Information Element                                  Value/remark                 Comment   Condition
  SIB1::= SEQUENCE {                                                                          
  servingCellConfigCommon                              ServingCellConfigCommonSIB             
  }                                                                                           
  ---------------------------------------------------- ---------------------------- --------- -----------

Table 7.1.1.1.5.3.3-2: ServingCellConfigCommonSIB (Table
7.1.1.1.5.3.3-1)

  ----------------------------------------------------- ------------------ --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-169                                
  Information Element                                   Value/remark       Comment   Condition
  ServingCellConfigCommonSIB ::= SEQUENCE {                                          
  supplementaryUplink SEQUENCE {                                                     
  initialUplinkBWP                                      BWP-UplinkCommon             
  }                                                                                  
  }                                                                                  
  ----------------------------------------------------- ------------------ --------- -----------

Table 7.1.1.1.5.3.3-3: BWP-UplinkCommon *(*Table 7.1.1.1.5.3.3-2)

  ---------------------------------------------------- ------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-14                                 
  Information Element                                  Value/remark        Comment   Condition
  BWP-UplinkCommon::= SEQUENCE {                                                     
  rach-ConfigCommon CHOICE {                                                         
  setup                                                RACH-ConfigCommon             
  }                                                                                  
  }                                                                                  
  ---------------------------------------------------- ------------------- --------- -----------

Table 7.1.1.1.5.3.3-4: RACH-ConfigCommon *(*Table 7.1.1.1.5.3.3-3)

  ----------------------------------------------------- -------------- -------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128                                             
  Information Element                                   Value/remark   Comment                    Condition
  RACH-ConfigCommon::= SEQUENCE {                                                                 
  rsrp-ThresholdSSB-SUL                                 76             IE value 76 means -80dBm   SUL
  }                                                                                               
  ----------------------------------------------------- -------------- -------------------------- -----------

Table 7.1.1.1.5.3.3-5: DCI Format 0-1 *(Step 8 of* Table
7.1.1.1.5.3.2-2)

  --------------------------------------------------------- -------------- --------- ------------------------------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.3.6.1.1.2-1                            
  Information Element                                       Value/remark   Comment   Condition
  UL/SUL indicator                                          1                        UE configured with SUL in the cell
  --------------------------------------------------------- -------------- --------- ------------------------------------

##### 7.1.1.1.6 Random access procedure / Successful/ Temporary C-RNTI Based / Preamble selected by MAC itself

##### 7.1.1.1.6.1 Test Purpose (TP) {#test-purpose-tp-5 .H6}

#####  (1) {#section-23 .H6}

**with** { UE in RRC Idle state has UL CCCH PDU to send and Random
Access Preambles group B is configured }

**ensure that** {

**when** { the UL CCCH MAC PDU Size is less than messageSizeGroupA }

**then** { UE transmits a random access preamble using a preamble in
group A of random access preambles }

}

##### (2) {#section-24 .H6}

**with** { UE in RRC Idle state initiated Random Access procedure to
transmit UL CCCH PDU and transmitted MSG3 }

**ensure that** {

**when** { The SS schedules any PDCCH transmission addressed to UE
Temporary C-RNTI before Contention resolution timer expiry with MAC PDU
does not contain a matching UE Contention Resolution Identity MAC CE }

**then** {UE re transmits a random access preamble using a preamble in
the same group of random access preambles as used for the first
transmission of Msg3 }

}

##### (3) {#section-25 .H6}

**with** { UE in RRC Idle state initiated Random Access procedure to
transmit UL CCCH PDU and transmitted MSG3 }

**ensure that** {

**when** { The SS does not schedule any PDCCH transmission addressed to
UE Temporary C-RNTI before Contention resolution timer expiry }

**then** {UE re transmits a random access preamble using a preamble in
the same group of random access preambles as used for the first
transmission of Msg3 }

}

##### (4) {#section-26 .H6}

**with** { UE in RRC Idle state initiated Random Access procedure to
transmit UL CCCH PDU and transmitted MSG3 }

**ensure that** {

**when** { The SS schedules a PDCCH transmission addressed to UE
Temporary C-RNTI before Contention resolution timer expiry }

**then** {UE assumes RACH procedure as complete }

}

##### 7.1.1.1.6.2 Conformance requirements {#conformance-requirements-5 .H6}

References: The conformance requirements covered in the present TC are
specified in: 3GPP TS 38.321, clauses 5.1.2, 5.1.3, 5.1.4, 5.1.5, 5.2,
6.1.3.2, 6.1.5 and 6.2.3. Unless otherwise stated these are Rel-15
requirements.

\[TS 38.321, clause 5.1.2\]

The MAC entity shall:

1\> if the Random Access procedure was initiated for beam failure
recovery (as specified in subclause 5.17); and

1\> if the *beamFailureRecoveryTimer* (in subclause 5.17) is either
running or not configured; and

1\> if the contention-free Random Access Resources for beam failure
recovery request associated with any of the SSBs and/or CSI-RSs have
been explicitly provided by RRC; and

1\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
amongst the SSBs in *candidateBeamRSList* or the CSI-RSs with CSI-RSRP
above *rsrp-ThresholdCSI-RS* amongst the CSI-RSs in
*candidateBeamRSList* is available:

2\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB* amongst the
SSBs in *candidateBeamRSList* or a CSI-RS with CSI-RSRP above
*rsrp-ThresholdCSI-RS* amongst the CSI-RSs in *candidateBeamRSList*;

2\> if CSI-RS is selected, and there is no *ra-PreambleIndex* associated
with the selected CSI-RS:

3\> set the *PREAMBLE\_INDEX* to a ra-PreambleIndex corresponding to the
SSB in *candidateBeamRSList* which is quasi-colocated with the selected
CSI-RS as specified in TS 38.214 \[7\].

2\> else:

3\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB or CSI-RS from the set of Random Access Preambles for
beam failure recovery request.

1\> else if the *ra-PreambleIndex* has been explicitly provided by
PDCCH; and

1\> if the *ra-PreambleIndex* is not 0b000000:

> 2\> set the *PREAMBLE\_INDEX* to the signalled *ra-PreambleIndex*;

2\> select the SSB signalled by PDCCH.

1\> else if the contention-free Random Access Resources associated with
SSBs have been explicitly provided in *rach-ConfigDedicated* and at
least one SSB with SS-RSRP above *rsrp-ThresholdSSB* amongst the
associated SSBs is available:

2\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB* amongst the
associated SSBs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB.

1\> else if the contention-free Random Access Resources associated with
CSI-RSs have been explicitly provided in *rach-ConfigDedicated* and at
least one CSI-RS with CSI-RSRP above *rsrp-ThresholdCSI-RS* amongst the
associated CSI-RSs is available:

2\> select a CSI-RS with CSI-RSRP above *rsrp-ThresholdCSI-RS* amongst
the associated CSI-RSs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected CSI-RS.

> 1\> else if the Random Access procedure was initiated for SI request
> (as specified in TS 38.331 \[5\]); and
>
> 1\> if the Random Access Resources for SI request have been explicitly
> provided by RRC:
>
> 2\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
> is available:
>
> 3\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB*.
>
> 2\> else:
>
> 3\> select any SSB.
>
> 2\> select a Random Access Preamble corresponding to the selected SSB,
> from the Random Access Preamble(s) determined according to
> *ra-PreambleStartIndex* as specified in TS 38.331 \[5\];
>
> 2\> set the *PREAMBLE\_INDEX* to selected Random Access Preamble.
>
> 1\> else (i.e. for the contention-based Random Access preamble
> selection):

2\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
is available:

3\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> if Msg3 has not yet been transmitted:

3\> if Random Access Preambles group B is configured:

4\> if the potential Msg3 size (UL data available for transmission plus
MAC header and, where required, MAC CEs) is greater than
*ra-Msg3SizeGroupA* and the pathloss is less than *PCMAX* (of the
Serving Cell performing the Random Access Procedure) --
*preambleReceivedTargetPower* -- *msg3-DeltaPreamble* --
*messagePowerOffsetGroupB*; or

4\> if the Random Access procedure was initiated for the CCCH logical
channel and the CCCH SDU size plus MAC subheader is greater than
*ra-Msg3SizeGroupA*:

5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

3\> else:

4\> select the Random Access Preambles group A.

2\> else (i.e. Msg3 is being retransmitted):

3\> select the same group of Random Access Preambles as was used for the
Random Access Preamble transmission attempt corresponding to the first
transmission of Msg3.

\> select a Random Access Preamble3 randomly with equal probability from
the Random Access Preambles associated with the selected SSB and the
selected Random Access Preambles group.

\> else:

2\> set the *PREAMBLE\_INDEX* to the selected Random Access Preamble.

> 11\> ifthe Random Access procedure was initiated for SI request (as
> specified in TS 38.331 \[5\]); and
>
> 1\> if *ra-AssociationPeriodIndex* and *si-RequestPeriod* are
> configured:
>
> 2\> determine the next available PRACH occasion from the PRACH
> occasions corresponding to the selected SSB in the association period
> given by *ra-AssociationPeriodIndex* in the *si-RequestPeriod*
> permitted by the restrictions given by the *ra-ssb-OccasionMaskIndex*
> if configured (the MAC entity shall select a PRACH occasion randomly
> with equal probability amongst the consecutive PRACH occasions
> according to subclause 8.1 of TS 38.213 \[6\] corresponding to the
> selected SSB).

\> else if an SSB is selected above:

2\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB permitted by the restrictions given by
the *ra-ssb-OccasionMaskIndex* if configured or indicated by PDCCH (the
MAC entity shall select a PRACH occasion randomly with equal probability
amongst the consecutive PRACH occasions according to subclause 8.1 of TS
38.213 \[6\], corresponding to the selected SSB; the MAC entity may take
into account the possible occurrence of measurement gaps when
determining the next available PRACH occasion corresponding to the
selected SSB).

1\> else if a CSI-RS is selected above:

> 2\> if there is no contention-free Random Access Resource associated
> with the selected CSI-RS:
>
> 3\> determine the next available PRACH occasion from the PRACH
> occasions, permitted by the restrictions given by the
> ra-ssb-OccasionMaskIndex if configured, corresponding to the SSB in
> candidateBeamRSList which is quasi-colocated with the selected CSI-RS
> as specified in TS 38.214 \[7\] (the MAC entity shall select a PRACH
> occasion randomly with equal probability amongst the consecutive PRACH
> occasions according to subclause 8.1 of TS 38.213 \[6\], corresponding
> to the SSB which is quasi-colocated with the selected CSI-RS; the MAC
> entity may take into account the possible occurrence of measurement
> gaps when determining the next available PRACH occasion corresponding
> to the SSB which is quasi-colocated with the selected CSI-RS).

2\> else:

3\> determine the next available PRACH occasion from the PRACH occasions
in *ra-OccasionList* corresponding to the selected CSI-RS (the MAC
entity shall select a PRACH occasion randomly with equal probability
amongst the PRACH occasions occurring simultaneously but on different
subcarriers, corresponding to the selected CSI-RS; the MAC entity may
take into account the possible occurrence of measurement gaps when
determining the next available PRACH occasion corresponding to the
selected CSI-RS).

1\> else if Random Access procedure was initiated for beam failure
recovery; and

1\> if a CSI-RS is selected above and there is no contention-free Random
Access Resource associated with the selected CSI-RS:

2\> determine the next available PRACH occasion from the PRACH
occasions, permitted by the restrictions given by the
*ra-ssb-OccasionMaskIndex* if configured, corresponding to the SSB in
*candidateBeamRSList* which is quasi-collocated with the selected CSI-RS
as specified in TS 38.214 \[7\] (the MAC entity may take into account
the possible occurrence of measurement gaps when determining the next
available PRACH occasion corresponding to the SSB which is
quasi-collected with the selected CSI-RS).

1\> else:

2\> determine the next available PRACH occasion (the MAC entity shall
select a PRACH occasion randomly with equal probability amongst the
PRACH occasions occurring simultaneously but on different subcarriers;
the MAC entity may take into account the possible occurrence of
measurement gaps when determining the next available PRACH occasion).

1\> perform the Random Access Preamble transmission procedure (see
subclause 5.1.3).

> NOTE: When the UE determines if there is an SSB with SS-RSRP above
> *rsrp-ThresholdSSB* or a CSI-RS with CSI-RSRP above
> *rsrp-ThresholdCSI-RS*, the UE uses the latest unfiltered L1-RSRP
> measurement.

\[TS 38.321, clause 5.1.3\]

The MAC entity shall, for each Random Access Preamble:

1\> if *PREAMBLE\_TRANSMISSION\_COUNTER* is greater than one; and

1\> if the notification of suspending power ramping counter has not been
received from lower layers; and

1\> if SSB or CSI-RS selected is not changed from the selection in the
last Random Access Preamble transmission:

2\> increment *PREAMBLE\_POWER\_RAMPING\_COUNTER* by 1.

1\> select the value of *DELTA\_PREAMBLE* according to subclause 7.3;

1\> set *PREAMBLE\_RECEIVED\_TARGET\_POWER* to
*preambleReceivedTargetPower* + *DELTA\_PREAMBLE* +
(*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*;

1\> except for contention-free Random Access Preamble for beam failure
recovery request, compute the RA-RNTI associated with the PRACH occasion
in which the Random Access Preamble is transmitted;

1\> instruct the physical layer to transmit the Random Access Preamble
using the selected PRACH occasion, corresponding RA-RNTI (if available),
*PREAMBLE\_INDEX* and *PREAMBLE\_RECEIVED\_TARGET\_POWER*.

The RA-RNTI associated with the PRACH occasion in which the Random
Access Preamble is transmitted, is computed as:

RA-RNTI= 1 + s\_id + 14 Ã— t\_id + 14 Ã— 80 Ã— f\_id + 14 Ã— 80 Ã— 8 Ã—
ul\_carrier\_id

where s\_id is the index of the first OFDM symbol of the PRACH occasion
(0 â‰¤ s\_id \< 14), t\_id is the index of the first slot of the PRACH
occasion in a system frame (0 â‰¤ t\_id \< 80), f\_id is the index of the
PRACH occasion in the frequency domain (0 â‰¤ f\_id \< 8), and
ul\_carrier\_id is the UL carrier used for Random Access Preamble
transmission (0 for NUL carrier, and 1 for SUL carrier).

\[TS 38.321, clause 5.1.4\]

Once the Random Access Preamble is transmitted and regardless of the
possible occurrence of a measurement gap, the MAC entity shall:

1\> if the contention-free Random Access Preamble for beam failure
recovery request was transmitted by the MAC entity:

2\> start the *ra-ResponseWindow* configured in
*BeamFailureRecoveryConfig* at the first PDCCH occasion as specified in
TS 38.213 \[6\] from the end of the Random Access Preamble transmission;

2\> monitor for a PDCCH transmission on the search space indicated by
*recoverySearchSpaceId* of the SpCell identified by the C-RNTI while
*ra-ResponseWindow* is running.

1\> else:

2\> start the *ra-ResponseWindow* configured in *RACH-ConfigCommon* at
the first PDCCH occasion as specified in TS 38.213 \[6\] from the end of
the Random Access Preamble transmission;

2\> monitor the PDCCH of the SpCell for Random Access Response(s)
identified by the RA-RNTI while the *ra-ResponseWindow* is running.

1\> if notification of a reception of a PDCCH transmission on the search
space indicated by *recoverySearchSpaceId* is received from lower layers
on the Serving Cell where the preamble was transmitted; and

1\> if PDCCH transmission is addressed to the C-RNTI; and

1\> if the contention-free Random Access Preamble for beam failure
recovery request was transmitted by the MAC entity:

2\> consider the Random Access procedure successfully completed.

1\> else if a downlink assignment has been received on the PDCCH for the
RA-RNTI and the received TB is successfully decoded:

2\> if the Random Access Response contains a MAC subPDU with Backoff
Indicator:

3\> set the *PREAMBLE\_BACKOFF* to value of the BI field of the MAC
subPDU using Table 7.2-1, multiplied with *SCALING\_FACTOR\_B*I.

2\> else:

3\> set the *PREAMBLE\_BACKOFF* to 0 ms.

2\> if the Random Access Response contains a MAC subPDU with Random
Access Preamble identifier corresponding to the transmitted
*PREAMBLE\_INDEX* (see subclause 5.1.3):

3\> consider this Random Access Response reception successful.

2\> if the Random Access Response reception is considered successful:

3\> if the Random Access Response includes a MAC subPDU with RAPID only:

4\> consider this Random Access procedure successfully completed;

4\> indicate the reception of an acknowledgement for SI request to upper
layers.

3\> else:

4\> apply the following actions for the Serving Cell where the Random
Access Preamble was transmitted:

5\> process the received Timing Advance Command (see subclause 5.2);

5\> indicate the *preambleReceivedTargetPower* and the amount of power
ramping applied to the latest Random Access Preamble transmission to
lower layers (i.e. (*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*);

5\> if the Serving Cell for the Random Access procedure is SRS-only
SCell:

6\> ignore the received UL grant.

5\> else:

6\> process the received UL grant value and indicate it to the lower
layers.

4\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

5\> consider the Random Access procedure successfully completed.

4\> else:

5\> set the *TEMPORARY\_C-RNTI* to the value received in the Random
Access Response;

5\> if this is the first successfully received Random Access Response
within this Random Access procedure:

6\> if the transmission is not being made for the CCCH logical channel:

> 7\> indicate to the Multiplexing and assembly entity to include a
> C-RNTI MAC CE in the subsequent uplink transmission.

6\> obtain the MAC PDU to transmit from the Multiplexing and assembly
entity and store it in the Msg3 buffer.

> NOTE: If within a Random Access procedure, an uplink grant provided in
> the Random Access Response for the same group of contention-based
> Random Access Preambles has a different size than the first uplink
> grant allocated during that Random Access procedure, the UE behavior
> is not defined.
>
> 1\> if *ra-ResponseWindow* configured in *BeamFailureRecoveryConfig*
> expires and if a PDCCH transmission on the search space indicated by
> *recoverySearchSpaceId* addressed to the C-RNTI has not been received
> on the Serving Cell where the preamble was transmitted; or

\> if *ra-ResponseWindow* configured in *RACH-ConfigCommon* expires, and
if the Random Access Response containing Random Access Preamble
identifiers that matches the transmitted *PREAMBLE\_INDEX* has not been
received1:

2\> consider the Random Access Response reception not successful;

2\> increment *PREAMBLE\_TRANSMISSION\_COUNTER* by 1;

2\> if *PREAMBLE\_TRANSMISSION\_COUNTER* = *preambleTransMax* + 1:

3\> if the Random Access Preamble is transmitted on the SpCell:

4\> indicate a Random Access problem to upper layers;

4\> if this Random Access procedure was triggered for SI request:

5\> consider the Random Access procedure unsuccessfully completed.

3\> else if the Random Access Preamble is transmitted on a SCell:

4\> consider the Random Access procedure unsuccessfully completed.

2\> if the Random Access procedure is not completed:

> 3\> select a random backoff time according to a uniform distribution
> between 0 and the *PREAMBLE\_BACKOFF*;
>
> 3\> if the criteria (as defined in subclause 5.1.2) to select
> contention-free Random Access Resources is met during the backoff
> time:
>
> 4\> perform the Random Access Resource selection procedure (see
> subclause 5.1.2);
>
> 3\> else:
>
> 4\> perform the Random Access Resource selection procedure (see
> subclause 5.1.2) after the backoff time.

The MAC entity may stop *ra-ResponseWindow* (and hence monitoring for
Random Access Response(s)) after successful reception of a Random Access
Response containing Random Access Preamble identifiers that matches the
transmitted *PREAMBLE\_INDEX*.

HARQ operation is not applicable to the Random Access Response
reception.

\[TS 38.321, clause 5.1.5\]

Once Msg3 is transmitted, the MAC entity shall:

1\> start the *ra-ContentionResolutionTimer* and restart the
*ra-ContentionResolutionTimer* at each HARQ retransmission in the first
symbol after the end of the Msg3 transmission;

1\> monitor the PDCCH while the *ra-ContentionResolutionTimer* is
running regardless of the possible occurrence of a measurement gap;

1\> if notification of a reception of a PDCCH transmission of the SpCell
is received from lower layers:

2\> if the C-RNTI MAC CE was included in Msg3:

> 3\> if the Random Access procedure was initiated for beam failure
> recovery (as specified in subclause 5.17) and the PDCCH transmission
> is addressed to the C-RNTI; or

3\> if the Random Access procedure was initiated by the MAC sublayer
itself or by the RRC sublayer and the PDCCH transmission is addressed to
the C-RNTI and contains a UL grant for a new transmission; or

3\> if the Random Access procedure was initiated by a PDCCH order and
the PDCCH transmission is addressed to the C-RNT:I

\> if the Random Access procedure was initiated for beam failure
recovery (as specified in subclause 5.17) and the PDCCH transmission is
addressed to the C-RNTI:

4\> consider this Contention Resolution successful;

4\> stop *ra-ContentionResolutionTimer*;

4\> discard the *TEMPORARY\_C-RNTI*;

4\> consider this Random Access procedure successfully completed.

2\> else if the CCCH SDU was included in Msg3 and the PDCCH transmission
is addressed to its *TEMPORARY\_C-RNTI*:

3\> if the MAC PDU is successfully decoded:

4\> stop *ra-ContentionResolutionTimer*;

4\> if the MAC PDU contains a UE Contention Resolution Identity MAC CE;
and

4\> if the UE Contention Resolution Identity in the MAC CE matches the
CCCH SDU transmitted in Msg3:

5\> consider this Contention Resolution successful and finish the
disassembly and demultiplexing of the MAC PDU;

5\> if this Random Access procedure was initiated for SI request:

6\> indicate the reception of an acknowledgement for SI request to upper
layers.

5\> else:

6\> set the C-RNTI to the value of the *TEMPORARY\_C-RNTI*;

5\> discard the *TEMPORARY\_C-RNTI*;

5\> consider this Random Access procedure successfully completed.

4\> else:

5\> discard the *TEMPORARY\_C-RNTI*;

5\> consider this Contention Resolution not successful and discard the
successfully decoded MAC PDU.

1\> if *ra-ContentionResolutionTimer* expires:

2\> discard the *TEMPORARY\_C-RNTI*;

2\> consider the Contention Resolution not successful.

1\> if the Contention Resolution is considered not successful:

2\> flush the HARQ buffer used for transmission of the MAC PDU in the
Msg3 buffer;

2\> increment *PREAMBLE\_TRANSMISSION\_COUNTER* by 1;

2\> if *PREAMBLE\_TRANSMISSION\_COUNTER* = *preambleTransMax* + 1:

3\> indicate a Random Access problem to upper layers.

3\> if this Random Access procedure was triggered for SI request:

4\> consider the Random Access procedure unsuccessfully completed.

2\> if the Random Access procedure is not completed:

3\> select a random backoff time according to a uniform distribution
between 0 and the *PREAMBLE\_BACKOFF*;

3\> if the criteria (as defined in subclause 5.1.2) to select
contention-free Random Access Resources is met during the backoff time:

3\> perform the Random Access Resource selection procedure (see
subclause 5.1.2).

> 3\> else:
>
> 4\> perform the Random Access Resource selection procedure (see
> subclause 5.1.2) after the backoff time.

\[TS 38.321, clause 5.2\]

RRC configures the following parameters for the maintenance of UL time
alignment:

\- *timeAlignmentTimer* (per TAG) which controls how long the MAC entity
considers the Serving Cells belonging to the associated TAG to be uplink
time aligned.

The MAC entity shall:

1\> when a Timing Advance Command MAC CE is received, and if an N~TA~
(as defined in TS 38.211 \[8\]) has been maintained with the indicated
TAG:

2\> apply the Timing Advance Command for the indicated TAG;

2\> start or restart the *timeAlignmentTimer* associated with the
indicated TAG.

1\> when a Timing Advance Command is received in a Random Access
Response message for a Serving Cell belonging to a TAG:

2\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble:

3\> apply the Timing Advance Command for this TAG;

3\> start or restart the *timeAlignmentTimer* associated with this TAG.

2\> else if the *timeAlignmentTimer* associated with this TAG is not
running:

3\> apply the Timing Advance Command for this TAG;

3\> start the *timeAlignmentTimer* associated with this TAG;

3\> when the Contention Resolution is considered not successful as
described in subclause 5.1.5; or

3\> when the Contention Resolution is considered successful for SI
request as described in subclause 5.1.5, after transmitting HARQ
feedback for MAC PDU including UE Contention Resolution Identity MAC CE:

4\> stop *timeAlignmentTimer* associated with this TAG.

2\> else:

3\> ignore the received Timing Advance Command.

1\> when a *timeAlignmentTimer* expires:

2\> if the *timeAlignmentTimer* is associated with the PTAG:

3\> flush all HARQ buffers for all Serving Cells;

3\> notify RRC to release PUCCH for all Serving Cells, if configured;

3\> notify RRC to release SRS for all Serving Cells, if configured;

3\> clear any configured downlink assignments and configured uplink
grants;

> 3\> clear any PUSCH resource for semi-persistent CSI reporting;

3\> consider all running *timeAlignmentTimer*s as expired;

3\> maintain N~TA~ (defined in TS 38.211 \[8\]) of all TAGs.

2\> else if the *timeAlignmentTimer* is associated with an STAG, then
for all Serving Cells belonging to this TAG:

3\> flush all HARQ buffers;

3\> notify RRC to release PUCCH, if configured;

3\> notify RRC to release SRS, if configured;

3\> clear any configured downlink assignments and configured uplink
grants;

> 3\> clear any PUSCH resource for semi-persistent CSI reporting;

3\> maintain N~TA~ (defined in TS 38.211 \[8\]) of this TAG.

When the MAC entity stops uplink transmissions for an SCell due to the
fact that the maximum uplink transmission timing difference between TAGs
of the MAC entity or the maximum uplink transmission timing difference
between TAGs of any MAC entity of the UE is exceeded, the MAC entity
considers the *timeAlignmentTimer* associated with the SCell as expired.

The MAC entity shall not perform any uplink transmission on a Serving
Cell except the Random Access Preamble transmission when the
*timeAlignmentTimer* associated with the TAG to which this Serving Cell
belongs is not running. Furthermore, when the *timeAlignmentTimer*
associated with the PTAG is not running, the MAC entity shall not
perform any uplink transmission on any Serving Cell except the Random
Access Preamble transmission on the SpCell.

\[TS 38.321, clause 6.1.3.2\]

The C-RNTI MAC CE is identified by MAC PDU subheader with LCID as
specified in Table 6.2.1-2.

It has a fixed size and consists of a single field defined as follows
(Figure 6.1.3.2-1):

\- C-RNTI: This field contains the C-RNTI of the MAC entity. The length
of the field is 16 bits.

Figure 6.1.3.2-1: C-RNTI MAC CE

\[TS 38.321, clause 6.1.5\]

A MAC PDU consists of one or more MAC subPDUs and optionally padding.
Each MAC subPDU consists one of the following:

\- a MAC subheader with Backoff Indicator only;

\- a MAC subheader with RAPID only (i.e. acknowledgment for SI request);

\- a MAC subheader with RAPID and MAC RAR.

A MAC subheader with Backoff Indicator consists of five header fields
E/T/R/R/BI as described in Figure 6.1.5-1. A MAC subPDU with Backoff
Indicator only is placed at the beginning of the MAC PDU, if included.
\'MAC subPDU(s) with RAPID only\' and \'MAC subPDU(s) with RAPID and MAC
RAR\' can be placed anywhere between MAC subPDU with Backoff Indicator
only (if any) and padding (if any).

A MAC subheader with RAPID consists of three header fields E/T/RAPID as
described in Figure 6.1.5-2.

Padding is placed at the end of the MAC PDU if present. Presence and
length of padding is implicit based on TB size, size of MAC subPDU(s).

Figure 6.1.5-1: E/T/R/R/BI MAC subheader

Figure 6.1.5-2: E/T/RAPID MAC subheader

Figure 6.1.5-3: Example of MAC PDU consisting of MAC RARs

\[TS 38.321, clause 6.2.3\]

The MAC RAR is of fixed size as depicted in Figure 6.2.3-1, and consists
of the following fields:

\- R: Reserved bit, set to \"0\";

\- Timing Advance Command: The Timing Advance Command field indicates
the index value *T~A~* used to control the amount of timing adjustment
that the MAC entity has to apply in TS 38.213 \[6\]. The size of the
Timing Advance Command field is 12 bits;

\- UL Grant: The Uplink Grant field indicates the resources to be used
on the uplink in TS 38.213 \[6\]. The size of the UL Grant field is 27
bits;

\- Temporary C-RNTI: The Temporary C-RNTI field indicates the temporary
identity that is used by the MAC entity during Random Access. The size
of the Temporary C-RNTI field is 16 bits.

The MAC RAR is octet aligned.

![](./media/image7.emf)

Figure 6.2.3-1: MAC RAR

##### 7.1.1.1.6.3 Test description {#test-description-5 .H6}

##### 7.1.1.1.6.3.1 Pre-test conditions {#pre-test-conditions-5 .H6}

##### Same Pre-test conditions as in clause 7.1.1.0 except that Test loop function(*Off*).7.1.1.1.6.3.2 Test procedure sequence {#same-pre-test-conditions-as-in-clause-7.1.1.0-except-that-test-loop-functionoff.7.1.1.1.6.3.2-test-procedure-sequence .H6}

Table 7.1.1.1.6.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\--     | *Paging*  | \-      | \- |
|           | transmits |           |           |         |    |
|           | a Paging  |           |           |         |    |
|           | message   |           |           |         |    |
|           | including |           |           |         |    |
|           | a matched |           |           |         |    |
|           | UE        |           |           |         |    |
|           | identity. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | Check:    | \--\>     | PRACH     | 1       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | using a   |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | in group  |           |           |         |    |
|           | A defined |           |           |         |    |
|           | in        |           |           |         |    |
|           | *servin   |           |           |         |    |
|           | gCellConf |           |           |         |    |
|           | igCommon* |           |           |         |    |
|           | in *SIB1* |           |           |         |    |
|           | (totalNum |           |           |         |    |
|           | berOfRA-P |           |           |         |    |
|           | reambles, |           |           |         |    |
|           | ssb-p     |           |           |         |    |
|           | erRACH-Oc |           |           |         |    |
|           | casionAnd |           |           |         |    |
|           | CB-Preamb |           |           |         |    |
|           | lesPerSSB |           |           |         |    |
|           | and       |           |           |         |    |
|           | n         |           |           |         |    |
|           | umberOfRA |           |           |         |    |
|           | -Preamble |           |           |         |    |
|           | sGroupA)? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | Random    |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | with      |           |           |         |    |
|           | RAPID     |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to the    |           |           |         |    |
|           | tr        |           |           |         |    |
|           | ansmitted |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 2,        |           |           |         |    |
|           | including |           |           |         |    |
|           | TC-RNTI   |           |           |         |    |
|           | and not   |           |           |         |    |
|           | including |           |           |         |    |
|           | Back off  |           |           |         |    |
|           | Indicator |           |           |         |    |
|           | s         |           |           |         |    |
|           | ubheader. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           | (         |         |    |
|           | a MAC PDU |           | *RRCSetup |         |    |
|           | c         |           | Request*) |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *RRCSetu  |           |           |         |    |
|           | pRequest* |           |           |         |    |
|           | message.  |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Before    |           |           |         |    |
|           | the       |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontention |           |           |         |    |
|           | r         |           |           |         |    |
|           | esolution |           |           |         |    |
|           | timer     |           |           |         |    |
|           | expires,  |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | does not  |           |           |         |    |
|           | schedule  |           |           |         |    |
|           | any       |           |           |         |    |
|           | PDCCH.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | Check:    | \--\>     | PRACH     | 3       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | re        |           |           |         |    |
|           | -transmit |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | using a   |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | in the    |           |           |         |    |
|           | same      |           |           |         |    |
|           | group A?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | Random    |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | with      |           |           |         |    |
|           | RAPID     |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to the    |           |           |         |    |
|           | tr        |           |           |         |    |
|           | ansmitted |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 6,        |           |           |         |    |
|           | including |           |           |         |    |
|           | TC-RNTI   |           |           |         |    |
|           | and not   |           |           |         |    |
|           | including |           |           |         |    |
|           | Back off  |           |           |         |    |
|           | Indicator |           |           |         |    |
|           | s         |           |           |         |    |
|           | ubheader. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           | (         |         |    |
|           | a MAC PDU |           | *RRCSetup |         |    |
|           | c         |           | Request*) |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *RRCSetu  |           |           |         |    |
|           | pRequest* |           |           |         |    |
|           | message.  |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | schedules |           |           |         |    |
|           | PDCCH     |           | (*R       |         |    |
|           | tra       |           | RCSetup*) |         |    |
|           | nsmission |           |           |         |    |
|           | addressed |           |           |         |    |
|           | to        |           |           |         |    |
|           | TC-RNTI   |           |           |         |    |
|           | to        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a valid   |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *         |           |           |         |    |
|           | RRCSetup* |           |           |         |    |
|           | message,  |           |           |         |    |
|           | but not   |           |           |         |    |
|           | including |           |           |         |    |
|           | a         |           |           |         |    |
|           | matching  |           |           |         |    |
|           | 'UE       |           |           |         |    |
|           | C         |           |           |         |    |
|           | ontention |           |           |         |    |
|           | R         |           |           |         |    |
|           | esolution |           |           |         |    |
|           | Identity' |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | control   |           |           |         |    |
|           | element.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | In        |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | with step |           |           |         |    |
|           | 10, the   |           |           |         |    |
|           | parallel  |           |           |         |    |
|           | behaviour |           |           |         |    |
|           | in table  |           |           |         |    |
|           | 7.1.1.    |           |           |         |    |
|           | 1.6.3.2-2 |           |           |         |    |
|           | is        |           |           |         |    |
|           | running.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | Check:    | \--\>     | PRACH     | 2       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | re        |           |           |         |    |
|           | -transmit |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | using a   |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | in the    |           |           |         |    |
|           | same      |           |           |         |    |
|           | group A?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | The SS    | \<\--     | Random    | \-      |    |
|           | transmits |           | Access    |         |    |
|           | Random    |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | with      |           |           |         |    |
|           | RAPID     |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to the    |           |           |         |    |
|           | tr        |           |           |         |    |
|           | ansmitted |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 10,       |           |           |         |    |
|           | including |           |           |         |    |
|           | TC-RNTI   |           |           |         |    |
|           | and not   |           |           |         |    |
|           | including |           |           |         |    |
|           | Back off  |           |           |         |    |
|           | Indicator |           |           |         |    |
|           | s         |           |           |         |    |
|           | ubheader. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           | (         |         |    |
|           | a MAC PDU |           | *RRCSetup |         |    |
|           | c         |           | Request*) |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *RRCSetu  |           |           |         |    |
|           | pRequest* |           |           |         |    |
|           | message.  |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | schedules |           |           |         |    |
|           | PDCCH     |           | (*        |         |    |
|           | tra       |           | RRCSetup* |         |    |
|           | nsmission |           | and UE    |         |    |
|           | addressed |           | C         |         |    |
|           | to        |           | ontention |         |    |
|           | TC-RNTI   |           | R         |         |    |
|           | to        |           | esolution |         |    |
|           | transmit  |           | Identity  |         |    |
|           | a valid   |           | MAC CE)   |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *         |           |           |         |    |
|           | RRCSetup* |           |           |         |    |
|           | message   |           |           |         |    |
|           | and 'UE   |           |           |         |    |
|           | C         |           |           |         |    |
|           | ontention |           |           |         |    |
|           | R         |           |           |         |    |
|           | esolution |           |           |         |    |
|           | Identity' |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | control   |           |           |         |    |
|           | element   |           |           |         |    |
|           | with      |           |           |         |    |
|           | matched   |           |           |         |    |
|           | 'C        |           |           |         |    |
|           | ontention |           |           |         |    |
|           | R         |           |           |         |    |
|           | esolution |           |           |         |    |
|           | I         |           |           |         |    |
|           | dentity'. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | Check:    | \--\>     | MAC PDU   | 4       | P  |
|           | Does UE   |           | (*        |         |    |
|           | transmit  |           | RRCSetupC |         |    |
|           | a MAC PDU |           | omplete)* |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *RRCSetup |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message   |           |           |         |    |
|           | i         |           |           |         |    |
|           | ndicating |           |           |         |    |
|           | a         |           |           |         |    |
|           | cceptance |           |           |         |    |
|           | of        |           |           |         |    |
|           | *         |           |           |         |    |
|           | RRCSetup* |           |           |         |    |
|           | message?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| Size of   |           |           |           |         |    |
| *RRCSetu  |           |           |           |         |    |
| pRequest* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is 45     |           |           |           |         |    |
| bits,     |           |           |           |         |    |
| octet     |           |           |           |         |    |
| aligned = |           |           |           |         |    |
| 48 bits.  |           |           |           |         |    |
| With 16   |           |           |           |         |    |
| bits of   |           |           |           |         |    |
| MAC       |           |           |           |         |    |
| Header    |           |           |           |         |    |
| the       |           |           |           |         |    |
| minimum   |           |           |           |         |    |
| size of   |           |           |           |         |    |
| MAC PDU   |           |           |           |         |    |
| carrying  |           |           |           |         |    |
| *RRCSetu  |           |           |           |         |    |
| pRequest* |           |           |           |         |    |
| is 64     |           |           |           |         |    |
| bits.     |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

Table 7.1.1.1.6.3.2-2: Parallel behaviour

  St   Procedure                                                                                                             Message Sequence   TP                             Verdict   
  ---- --------------------------------------------------------------------------------------------------------------------- ------------------ ------------------------------ --------- ---
                                                                                                                             U - S              Message                                  
  1    Check: UE transmits a MAC PDU containing an *RRCSetupComplete* message indicating acceptance of *RRCSetup* message?   \--\>              MAC PDU (*RRCSetupComplete)*   2         F

##### 7.1.1.1.6.3.3 Specific message contents {#specific-message-contents-5 .H6}

Table 7.1.1.1.6.3.3-1: *SIB1 (*Preamble, Table 7.1.1.1.6.3.2-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-28                                
  ---------------------------------------------------- ------------------ --------- -----------
  Information Element                                  Value/remark       Comment   Condition
  SIB1 ::= SEQUENCE {                                                               
  servingCellConfigCommon SEQUENCE {                                                
  uplinkConfigCommon SEQUENCE {                                                     
  initialUplinkBWP                                     BWP-UplinkCommon             
  }                                                                                 
  }                                                                                 
  }                                                                                 

Table 7.1.1.1.6.3.3-2: *BWP-UplinkCommon (*Table 7.1.1.1.6.3.3-1)

  ---------------------------------------------------- ------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-10                                 
  Information Element                                  Value/remark        Comment   Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                    
  rach-ConfigCommon CHOICE {                                                         
  setup                                                RACH-ConfigCommon             
  }                                                                                  
  }                                                                                  
  ---------------------------------------------------- ------------------- --------- -----------

Table 7.1.1.1.6.3.3-3: *RACH-ConfigCommon (*Table 7.1.1.1.6.3.3-2)

  ----------------------------------------------------- -------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128                                  
  Information Element                                   Value/remark         Comment   Condition
  RACH-ConfigCommon::= SEQUENCE {                                                      
  rach-ConfigGeneric                                    RACH-ConfigGeneric             
  totalNumberOfRA-Preambles                             42                             
  ssb-perRACH-OccasionAndCB-PreamblesPerSSB CHOICE {                                   
  One                                                   n32                            
  }                                                                                    
  groupBconfigured SEQUENCE {                                                          
  ra-Msg3SizeGroupA                                     b208                           
  messagePowerOffsetGroupB                              minusinfinity                  
  numberOfRA-PreamblesGroupA                            28                             
  }                                                                                    
  ra-ContentionResolutionTimer                          sf48                           
  }                                                                                    
  ----------------------------------------------------- -------------------- --------- -----------

##### 7.1.1.1.7 Random access procedure / 2-step RACH / RA\_TYPE selection

##### 7.1.1.1.7.1 Test Purpose (TP) {#test-purpose-tp-6 .H6}

##### (1) {#section-27 .H6}

**with** { UE in RRC\_Connected and NR SpCell TimeAlignmentTimer
expired, and has UL Data to send }

**ensure that** {

**when** { the BWP selected for Random Access procedure is configured
with both 2-step and 4-step RA type Random Access Resources and the RSRP
of the downlink pathloss reference is above msgA-RSRP-Threshold }

**then** { UE SET RA\_TYPE to 2-step AND sends a MSGA on the NR SpCell }

}

##### (2) {#section-28 .H6}

**with** { UE in RRC\_Connected NR SpCell TimeAlignmentTimer expired,
and has UL Data to send }

**ensure that** {

**when** { BWP selected for Random Access procedure is only configured
with 2-step RA type Random Access resources }

**then** { UE SET RA\_TYPE to 2-step AND sends a MSGA on the NR SpCell }

}

##### 7.1.1.1.7.2 Conformance requirements {#conformance-requirements-6 .H6}

References: The conformance requirements covered in the present TC are
specified in: 3GPP TS 38.321, clause 5.1.1, 5.1.2a and 5.1.3a. Unless
otherwise stated these are Rel-16 requirements.

\[TS 38.321, clause 5.1.1\]

1\> if the Random Access procedure was initiated for SpCell beam failure
recovery (as specified in clause 5.17) and if the contention-free Random
Access Resources for beam failure recovery request for 4-step RA type
have been explicitly provided by RRC for the BWP selected for Random
Access procedure; or

1\> if the Random Access procedure was initiated for reconfiguration
with sync and if the contention-free Random Access Resources for 4-step
RA type have been explicitly provided in *rach-ConfigDedicated* for the
BWP selected for Random Access procedure:

2\> set the *RA\_TYPE* to *4-stepRA*.

1\> else if the BWP selected for Random Access procedure is configured
with both 2-step and 4-step RA type Random Access Resources and the RSRP
of the downlink pathloss reference is above *msgA-RSRP-Threshold*; or

1\> if the BWP selected for Random Access procedure is only configured
with 2-step RA type Random Access resources (i.e. no 4-step RACH RA type
resources configured); or

1\> if the Random Access procedure was initiated for reconfiguration
with sync and if the contention-free Random Access Resources for 2-step
RA type have been explicitly provided in *rach-ConfigDedicated* for the
BWP selected for Random Access procedure:

2\> set the *RA\_TYPE* to *2-stepRA*.

1\> else:

2\> set the *RA\_TYPE* to *4-stepRA*.

1\> perform initialization of variables specific to Random Access type
as specified in clause 5.1.1a;

1\> if *RA\_TYPE* is set to *2-stepRA*:

2\> perform the Random Access Resource selection procedure for 2-step RA
type (see clause 5.1.2a).

1\> else:

2\> perform the Random Access Resource selection procedure (see clause
5.1.2).

\[TS 38.321, clause 5.1.2a\]

If the selected *RA\_TYPE* is set to *2-stepRA*, the MAC entity shall:

1\> if the contention-free 2-step RA type Resources associated with SSBs
have been explicitly provided in *rach-ConfigDedicated* and at least one
SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB* amongst the associated
SSBs is available:

2\> select an SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB* amongst
the associated SSBs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB.

1\> else (i.e. for the contention-based Random Access Preamble
selection):

2\> if at least one of the SSBs with SS-RSRP above
*msgA-RSRP-ThresholdSSB* is available:

3\> select an SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> if contention-free Random Access Resources for 2-step RA type have
not been configured and if Random Access Preambles group has not yet
been selected during the current Random Access procedure:

3\> if Random Access Preambles group B for 2-step RA type is configured:

4\> if the potential MSGA payload size (UL data available for
transmission plus MAC subheader and, where required, MAC CEs) is greater
than the *ra-MsgA-SizeGroupA* and the pathloss is less than *PCMAX* (of
the Serving Cell performing the Random Access Procedure) --
*msgA-PreambleReceivedTargetPower* -- *msgA-DeltaPreamble* --
*messagePowerOffsetGroupB*; or

4\> if the Random Access procedure was initiated for the CCCH logical
channel and the CCCH SDU size plus MAC subheader is greater than
*ra-MsgA-SizeGroupA*:

5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

3\> else:

4\> select the Random Access Preambles group A.

2\> else if contention-free Random Access Resources for 2-step RA type
have been configured and if Random Access Preambles group has not yet
been selected during the current Random Access procedure:

3\> if Random Access Preambles group B for 2-step RA type is configured;
and

3\> if the transport block size of the MSGA payload configured in the
*rach-ConfigDedicated* corresponds to the transport block size of the
MSGA payload associated with Random Access Preambles group B:

4\> select the Random Access Preambles group B.

3\> else:

4\> select the Random Access Preambles group A.

2\> else (i.e. Random Access preambles group has been selected during
the current Random Access procedure):

3\> select the same group of Random Access Preambles as was used for the
Random Access Preamble transmission attempt corresponding to the earlier
transmission of MSGA.

2\> select a Random Access Preamble randomly with equal probability from
the 2-step RA type Random Access Preambles associated with the selected
SSB and the selected Random Access Preambles group;

2\> set the *PREAMBLE\_INDEX* to the selected Random Access Preamble.

1\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB permitted by the restrictions given by
the *msgA-SSB-SharedRO-MaskIndex* if configured and
*ra-ssb-OccasionMaskIndex* *if configured* (the MAC entity shall select
a PRACH occasion randomly with equal probability among the consecutive
PRACH occasions allocated for 2-step RA type according to clause 8.1 of
TS 38.213 \[6\], corresponding to the selected SSB; the MAC entity may
take into account the possible occurrence of measurement gaps when
determining the next available PRACH occasion corresponding to the
selected SSB);

1\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

2\> select a PUSCH occasion from the PUSCH occasions configured in
*msgA-CFRA-PUSCH* corresponding to the PRACH slot of the selected PRACH
occasion, according to *msgA-PUSCH-resource-Index* corresponding to the
selected SSB;

2\> determine the UL grant and the associated HARQ information for the
MSGA payload in the selected PUSCH occasion;

2\> deliver the UL grant and the associated HARQ information to the HARQ
entity.

1\> else:

2\> select a PUSCH occasion corresponding to the selected preamble and
PRACH occasion according to clause 8.1A of TS 38.213 \[6\];

2\> determine the UL grant for the MSGA payload according to the PUSCH
configuration associated with the selected Random Access Preambles group
and determine the associated HARQ information;

2\> if the selected preamble and PRACH occasion is mapped to a valid
PUSCH occasion as specified in clause 8.1A of TS 38.213 \[6\]:

3\> deliver the UL grant and the associated HARQ information to the HARQ
entity.

1\> perform the MSGA transmission procedure (see clause 5.1.3a).

NOTE: To determine if there is an SSB with *SS-RSRP* above
*msgA-RSRP-ThresholdSSB*, the UE uses the latest unfiltered *L1-RSRP*
measurement.

\[TS 38.321, clause 5.1.3a\]

The MAC entity shall, for each MSGA:

1\> if *PREAMBLE\_TRANSMISSION\_COUNTER* is greater than one; and

1\> if the notification of suspending power ramping counter has not been
received from lower layers; and

1\> if LBT failure indication was not received from lower layers for the
last MSGA Random Access Preamble transmission; and

1\> if SSB selected is not changed from the selection in the last Random
Access Preamble transmission:

2\> increment *PREAMBLE\_POWER\_RAMPING\_COUNTER* by 1.

1\> select the value of *DELTA\_PREAMBLE* according to clause 7.3;

1\> set *PREAMBLE\_RECEIVED\_TARGET\_POWER* to
*msgA-PreambleReceivedTargetPower* + *DELTA\_PREAMBLE* +
(*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*;

1\> if this is the first MSGA transmission within this Random Access
procedure:

2\> if the transmission is not being made for the CCCH logical channel:

3\> indicate to the Multiplexing and assembly entity to include a C-RNTI
MAC CE in the subsequent uplink transmission.

2\> if the Random Access procedure was initiated for SpCell beam failure
recovery and *spCell-BFR-CBRA* with value *true* is configured:

3\> indicate to the Multiplexing and assembly entity to include a BFR
MAC CE or a Truncated BFR MAC CE in the subsequent uplink transmission.

2\> obtain the MAC PDU to transmit from the Multiplexing and assembly
entity according to the HARQ information determined for the MSGA payload
(see clause 5.1.2a) and store it in the MSGA buffer.

1\> compute the MSGB-RNTI associated with the PRACH occasion in which
the Random Access Preamble is transmitted;

1\> instruct the physical layer to transmit the MSGA using the selected
PRACH occasion and the associated PUSCH resource of MSGA (if the
selected preamble and PRACH occasion is mapped to a valid PUSCH
occasion), using the corresponding RA-RNTI, MSGB-RNTI,
*PREAMBLE\_INDEX*, *PREAMBLE\_RECEIVED\_TARGET\_POWER,
msgA-PreambleReceivedTargetPower,* and the amount of power ramping
applied to the latest MSGA preamble transmission (i.e.
(*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*);

##### 7.1.1.1.7.3 Test description {#test-description-6 .H6}

##### 7.1.1.1.7.3.1 Pre-test conditions {#pre-test-conditions-6 .H6}

##### Same Pre-test conditions as in clause 7.1.1.0. {#same-pre-test-conditions-as-in-clause-7.1.1.0. .H6}

##### 7.1.1.1.7.3.2 Test procedure sequence {#test-procedure-sequence-5 .H6}

Table 7.1.1.1.7.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 0A        | SS        | \<\--     | (R        | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an        |           | guration) |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | *c        |           |           |         |    |
|           | onfigure* |           |           |         |    |
|           | both      |           |           |         |    |
|           | 2-Step    |           |           |         |    |
|           | and       |           |           |         |    |
|           | 4-Step RA |           |           |         |    |
|           | type      |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Re        |           |           |         |    |
|           | sources*. |           |           |         |    |
|           | (Note 1)* |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 0B        | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | RRCRecon  |           | gurationC |         |    |
|           | figuratio |           | omplete)* |         |    |
|           | nComplete |           |           |         |    |
|           | message.  |           |           |         |    |
|           | *Note 2*  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (Timing   |         |    |
|           | Timing    |           | Advance   |         |    |
|           | Advance   |           |           |         |    |
|           | command   |           | Command   |         |    |
|           | to        |           | MAC       |         |    |
|           | SpCell.   |           | Control   |         |    |
|           | SS does   |           | Element)  |         |    |
|           | not send  |           |           |         |    |
|           | any       |           |           |         |    |
|           | s         |           |           |         |    |
|           | ubsequent |           |           |         |    |
|           | timing    |           |           |         |    |
|           | al        |           |           |         |    |
|           | ignments. |           |           |         |    |
|           | Start     |           |           |         |    |
|           | Timer\_T1 |           |           |         |    |
|           | = Time    |           |           |         |    |
|           | Alignment |           |           |         |    |
|           | timer     |           |           |         |    |
|           | value on  |           |           |         |    |
|           | SS.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | 40 to 50  | \<\--     | MAC PDU   | \-      | \- |
|           | TTI       |           |           |         |    |
|           | before    |           |           |         |    |
|           | Timer\_T1 |           |           |         |    |
|           | expires   |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a PDCP    |           |           |         |    |
|           | SDU (Note |           |           |         |    |
|           | 3)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \-        | \-        | \-      | \- |
|           | ignores   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | requests  |           |           |         |    |
|           | and does  |           |           |         |    |
|           | not       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | any       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           | (         |         |    |
|           | UE        |           | including |         |    |
|           | transmit  |           | C-RNTI    |         |    |
|           | a MSGA    |           | MAC CE)   |         |    |
|           | using the |           |           |         |    |
|           | selected  |           |           |         |    |
|           | PRACH     |           |           |         |    |
|           | occasion  |           |           |         |    |
|           | and the   |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssociated |           |           |         |    |
|           | PUSCH     |           |           |         |    |
|           | resource  |           |           |         |    |
|           | of MSGA?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | SS        | \<\--     | MAC       | \-      | \- |
|           | schedules |           | PDU       |         |    |
|           | PDCCH     |           | (Absolute |         |    |
|           | tra       |           | Timing    |         |    |
|           | nsmission |           | Advance   |         |    |
|           | for UE    |           |           |         |    |
|           | C\_RNTI   |           | Command   |         |    |
|           | and DL    |           | MAC       |         |    |
|           | MAC PDU   |           | Control   |         |    |
|           | c         |           | Element)  |         |    |
|           | ontaining |           |           |         |    |
|           | Absolute  |           |           |         |    |
|           | Timing    |           |           |         |    |
|           | Advance   |           |           |         |    |
|           | Command   |           |           |         |    |
|           | MAC CE.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | SS        | \<\--     | (R        | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an        |           | guration) |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | *c        |           |           |         |    |
|           | onfigure* |           |           |         |    |
|           | only      |           |           |         |    |
|           | 2-Step RA |           |           |         |    |
|           | type      |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Re        |           |           |         |    |
|           | sources*. |           |           |         |    |
|           | (Note 1)* |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | RRCRecon  |           | gurationC |         |    |
|           | figuratio |           | omplete)* |         |    |
|           | nComplete |           |           |         |    |
|           | message.  |           |           |         |    |
|           | *Note 2*  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (Timing   |         |    |
|           | Timing    |           | Advance   |         |    |
|           | Advance   |           |           |         |    |
|           | command   |           | Command   |         |    |
|           | to        |           | MAC       |         |    |
|           | SpCell.   |           | Control   |         |    |
|           | SS does   |           | Element)  |         |    |
|           | not send  |           |           |         |    |
|           | any       |           |           |         |    |
|           | s         |           |           |         |    |
|           | ubsequent |           |           |         |    |
|           | timing    |           |           |         |    |
|           | al        |           |           |         |    |
|           | ignments. |           |           |         |    |
|           | Start     |           |           |         |    |
|           | Timer\_T1 |           |           |         |    |
|           | = Time    |           |           |         |    |
|           | Alignment |           |           |         |    |
|           | timer     |           |           |         |    |
|           | value on  |           |           |         |    |
|           | SS.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | 40 to 50  | \<\--     | MAC PDU   | \-      | \- |
|           | TTI       |           |           |         |    |
|           | before    |           |           |         |    |
|           | Timer\_T1 |           |           |         |    |
|           | expires   |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a PDCP    |           |           |         |    |
|           | SDU.      |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | The SS    | \-        | \-        | \-      | \- |
|           | ignores   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | requests  |           |           |         |    |
|           | and does  |           |           |         |    |
|           | not       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | any       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | Does the  |           | (         |         |    |
|           | UE MSGA   |           | including |         |    |
|           | using the |           | C-RNTI    |         |    |
|           | selected  |           | MAC CE)   |         |    |
|           | PRACH     |           |           |         |    |
|           | occasion  |           |           |         |    |
|           | and the   |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssociated |           |           |         |    |
|           | PUSCH     |           |           |         |    |
|           | resource  |           |           |         |    |
|           | of MSGA?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | SS        | \<\--     | MAC       | \-      | \- |
|           | schedules |           | PDU       |         |    |
|           | PDCCH     |           | (Absolute |         |    |
|           | tra       |           | Timing    |         |    |
|           | nsmission |           | Advance   |         |    |
|           | for UE    |           |           |         |    |
|           | C\_RNTI   |           | Command   |         |    |
|           | and DL    |           | MAC       |         |    |
|           | MAC PDU   |           | Control   |         |    |
|           | c         |           | Element)  |         |    |
|           | ontaining |           |           |         |    |
|           | Absolute  |           |           |         |    |
|           | Timing    |           |           |         |    |
|           | Advance   |           |           |         |    |
|           | Command   |           |           |         |    |
|           | MAC CE.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *R        |           |           |           |         |    |
| RCReconfi |           |           |           |         |    |
| guration* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RRC      |           |           |           |         |    |
| Connectio |           |           |           |         |    |
| nReconfig |           |           |           |         |    |
| uration.* |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| PDCP SDU  |           |           |           |         |    |
| is 56     |           |           |           |         |    |
| bit.      |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.1.7.3.3 Specific message contents {#specific-message-contents-6 .H6}

Table 7.1.1.1.7.3.3-1: *RRCReconfiguration* for EN-DC (steps 0A and 6,
Table 7.1.1.1.7.3.2-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13 with condition EN-DC\_HO.                               
  ------------------------------------------------------------------------------ ----------------- --------- -----------
  Information Element                                                            Value/remark      Comment   Condition
  RRCReconfiguration ::= SEQUENCE {                                                                          
  criticalExtensions CHOICE {                                                                                
  rrcReconfiguration SEQUENCE {                                                                              
  secondaryCellGroup                                                             CellGroupConfig             
  }                                                                                                          
  }                                                                                                          
  }                                                                                                          

Table 7.1.1.1.7.3.3-1A: *RRCReconfiguration* for NR/5GC (steps 0A and 6,
Table 7.1.1.1.7.3.2-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                               
  ---------------------------------------------------- ----------------- --------- -----------
  Information Element                                  Value/remark      Comment   Condition
  RRCReconfiguration ::= SEQUENCE {                                                
  criticalExtensions CHOICE {                                                      
  rrcReconfiguration SEQUENCE {                                                    
  nonCriticalExtension SEQUENCE {                                                  
  masterCellGroup                                      CellGroupConfig             
  }                                                                                
  }                                                                                
  }                                                                                
  }                                                                                

Table 7.1.1.1.7.3.3-2: *CellGroupConfig* for EN-DC (Table
7.1.1.1.7.3.3-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19 with condition PSCell\_change                                                                
  ---------------------------------------------------------------------------------- -------------------------------------------------- --------- -----------
  Information Element                                                                Value/remark                                       Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                                                                                  
  spCellConfig SEQUENCE {                                                                                                                         
  reconfigurationWithSync SEQUENCE {                                                                                                              
  spCellConfigCommon                                                                 ServingCellConfigCommon                                      
  rach-ConfigDedicated                                                               Not present                                                  
  newUE-Identity                                                                     UE identity different from NR cell 1 UE identity             
  }                                                                                                                                               
  }                                                                                                                                               
  }                                                                                                                                               

Table 7.1.1.1.7.3.3-2A: *CellGroupConfig* for NR/5GC (Table
7.1.1.1.7.3.3-1A)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19 with condition PCell\_change                                                                
  --------------------------------------------------------------------------------- -------------------------------------------------- --------- -----------
  Information Element                                                               Value/remark                                       Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                                                                                 
  spCellConfig SEQUENCE {                                                                                                                        
  reconfigurationWithSync SEQUENCE {                                                                                                             
  spCellConfigCommon                                                                ServingCellConfigCommon                                      
  rach-ConfigDedicated                                                              Not present                                                  
  newUE-Identity                                                                    UE identity different from NR cell 1 UE identity             
  }                                                                                                                                              
  }                                                                                                                                              
  }                                                                                                                                              

Table 7.1.1.1.7.3.3-3: *ServingCellConfigCommon* (Table 7.1.1.1.7.3.3-2
and Table 7.1.1.1.7.3.3-2A)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                      
  ----------------------------------------------------- ------------------------ --------- -----------
  Information Element                                   Value/remark             Comment   Condition
  ServingCellConfigCommon ::= SEQUENCE {                                                   
  uplinkConfigCommon SEQUENCE {                                                            
  initialUplinkBWP                                      BWP-UplinkCommon                   
  }                                                                                        
  tdd-UL-DL-ConfigurationCommon                         TDD-UL-DL-ConfigCommon             
  }                                                                                        

Table 7.1.1.1.7.3.3-4: *BWP-UplinkCommon (*Table 7.1.1.1.7.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-10                                 
  ---------------------------------------------------- ------------------- --------- -----------
  Information Element                                  Value/remark        Comment   Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                    
  rach-ConfigCommon CHOICE {                                                         
  setup                                                RACH-ConfigCommon             Step 0A
                                                       Not present                   Step 6
  }                                                                                  
  msgA-ConfigCommon-r16 CHOICE {                                                     
  setup                                                MsgA-ConfigCommon             
  }                                                                                  
  }                                                                                  

Table 7.1.1.1.7.3.3-5: *RACH-ConfigCommon (*Table 7.1.1.1.7.3.3-4)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128                                                                                                         
  ----------------------------------------------------- ---------------------------------------------------------------------- ------------------------------ -----------
  Information Element                                   Value/remark                                                           Comment                        Condition
  RACH-ConfigCommon ::= SEQUENCE {                                                                                                                            
  rach-ConfigGeneric                                    RACH-ConfigGeneric                                                                                    
  ssb-perRACH-OccasionAndCB-PreamblesPerSSB CHOICE {                                                                                                          
  one                                                   n36                                                                                                   
  }                                                                                                                                                           
  prach-RootSequenceIndex CHOICE {                                                                                                                            
  l139                                                  Set according to table 4.4.2-2 in TS 38.508-1 \[4\] for the NR Cell.                                  
  l839                                                  Set according to table 4.4.2-2 in TS 38.508-1 \[4\] for the NR Cell.   PRACH Preamble format 0 used   FR1,
  }                                                                                                                                                           
  }                                                                                                                                                           

Table 7.1.1.1.7.3.3-6: *MsgA-ConfigCommon (*Table 7.1.1.1.7.3.3-4)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-81A                                          
  ----------------------------------------------------- ---------------------------- --------- -----------
  Information Element                                   Value/remark                 Comment   Condition
  MsgA-ConfigCommonL-r16 ::= SEQUENCE {                                                        
  rach-ConfigCommonTwoStepRA-r16                        RACH-ConfigCommonTwoStepRA             
  msgA-PUSCH-Config-r16                                 MsgA-PUSCH-Config                      
  }                                                                                            

Table 7.1.1.1.7.3.3-7: *TDD-UL-DL-ConfigCommon (*Table 7.1.1.1.7.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-192                                 
  ----------------------------------------------------- ------------------- --------- ------------
  Information Element                                   Value/remark        Comment   Condition
  TDD-UL-DL-ConfigCommon ::= SEQUENCE {                                               
  referenceSubcarrierSpacing                            SubcarrierSpacing             
  pattern1 SEQUENCE {                                                                 
  dl-UL-TransmissionPeriodicity                         ms5                           FR1 SCS 30
                                                        ms5                           FR1 SCS 15
                                                        ms0p625                       FR2
  nrofDownlinkSlots                                     3                             FR1 SCS 30
                                                        3                             FR1 SCS 15
                                                        3                             FR2
  nrofDownlinkSymbols                                   6                             FR1 SCS 30
                                                        10                            FR1 SCS 15
                                                        10                            FR2
  nrofUplinkSlots                                       2                             FR1 SCS 30
                                                        1                             FR1 SCS 15
                                                        1                             FR2
  nrofUplinkSymbols                                     4                             FR1 SCS 30
                                                        2                             FR1 SCS 15
                                                        2                             FR2
  dl-UL-TransmissionPeriodicity-v1530                   ms3                           FR1 SCS 30
  }                                                                                   
  pattern2                                              Not present                   
  pattern2 SEQUENCE {                                                                 FR1 SCS 30
  dl-UL-TransmissionPeriodicity                         ms2                           
  nrofDownlinkSlots                                     4                             
  nrofDownlinkSymbols                                   0                             
  nrofUplinkSlots                                       0                             
  nrofUplinkSymbols                                     0                             
  }                                                                                   
  }                                                                                   

Table 7.1.1.1.7.3.3-8: *RACH-ConfigCommonTwoStepRA (*Table
7.1.1.1.7.3.3-6)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128A                             
  ------------------------------------------------------ -------------- ---------- -----------
  Information Element                                    Value/remark   Comment    Condition
  RACH-ConfigCommonTwoStepRA-r16 ::= SEQUENCE {                                    
  msgA-RSRP-Threshold-r16                                57             -100 dBm   
  }                                                                                

Table 7.1.1.1.7.3.3-9: *MsgA-PUSCH-Config (*Table 7.1.1.1.7.3.3-6)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-81B                            
  ----------------------------------------------------- -------------- --------- ------------
  Information Element                                   Value/remark   Comment   Condition
  MsgA-PUSCH-Config-r16 ::= SEQUENCE {                                           
  msgA-PUSCH-ResourceGroupA-r16 SEQUENCE {                                       
  msgA-PUSCH-TimeDomainOffset-r16                       5                        
                                                        10                       FR1 SCS 30
  startSymbolAndLengthMsgA-PO-r16                       27                       
  nrofPRBs-PerMsgA-PO-r16                               4                        
  }                                                                              
  }                                                                              

##### 7.1.1.1.8 Correct selection of RACH parameters / 2-step RACH/MSGA and PRACH resource explicitly signalled to the UE by RRC / contention free random access procedure

##### 7.1.1.1.8.1 Test Purpose (TP) {#test-purpose-tp-7 .H6}

##### (1) {#section-29 .H6}

**with** { UE in RRC\_Connected }

**ensure that** {

**when** { SS sends an RRCReconfiguration message including
RACH-ConfigDedicated information element and the contention-free Random
Access Resources for 2-step RA type have been explicitly provided in
rach-ConfigDedicated }

**then** { UE SET RA\_TYPE to 2-step AND sends a MSGA on the NR PSCell }

}

##### (2) {#section-30 .H6}

**with** { UE in RRC\_Connected state after transmission of a MSGA on NR
SpCell received in RACH-ConfigDedicated on the target cell }

**ensure that** {

**when** { UE does not receive a matching MSGB in msgB-ResponseWindow
and PREAMBLE\_TRANSMISSION\_COUNTER is less than msgA-TransMax + 1 }

**then** { UE retransmits a MSGA in RACH-ConfigDedicated on the target
cell }

}

##### 7.1.1.1.8.2 Conformance requirements {#conformance-requirements-7 .H6}

References: The conformance requirements covered in the present TC are
specified in: 3GPP TS 38.321, clause 5.1.1, 5.1.2a, 5.1.3a and 5.1.4a.
Unless otherwise stated these are Rel-16 requirements.

\[TS 38.321, clause 5.1.1\]

1\> if the Random Access procedure was initiated for SpCell beam failure
recovery (as specified in clause 5.17) and if the contention-free Random
Access Resources for beam failure recovery request for 4-step RA type
have been explicitly provided by RRC for the BWP selected for Random
Access procedure; or

1\> if the Random Access procedure was initiated for reconfiguration
with sync and if the contention-free Random Access Resources for 4-step
RA type have been explicitly provided in *rach-ConfigDedicated* for the
BWP selected for Random Access procedure:

2\> set the *RA\_TYPE* to *4-stepRA*.

1\> else if the BWP selected for Random Access procedure is configured
with both 2-step and 4-step RA type Random Access Resources and the RSRP
of the downlink pathloss reference is above *msgA-RSRP-Threshold*; or

1\> if the BWP selected for Random Access procedure is only configured
with 2-step RA type Random Access resources (i.e. no 4-step RACH RA type
resources configured); or

1\> if the Random Access procedure was initiated for reconfiguration
with sync and if the contention-free Random Access Resources for 2-step
RA type have been explicitly provided in *rach-ConfigDedicated* for the
BWP selected for Random Access procedure:

2\> set the *RA\_TYPE* to *2-stepRA*.

1\> else:

2\> set the *RA\_TYPE* to *4-stepRA*.

1\> perform initialization of variables specific to Random Access type
as specified in clause 5.1.1a;

1\> if *RA\_TYPE* is set to *2-stepRA*:

2\> perform the Random Access Resource selection procedure for 2-step RA
type (see clause 5.1.2a).

1\> else:

2\> perform the Random Access Resource selection procedure (see clause
5.1.2).

\[TS 38.321, clause 5.1.2a\]

If the selected *RA\_TYPE* is set to *2-stepRA*, the MAC entity shall:

1\> if the contention-free 2-step RA type Resources associated with SSBs
have been explicitly provided in *rach-ConfigDedicated* and at least one
SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB* amongst the associated
SSBs is available:

2\> select an SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB* amongst
the associated SSBs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB.

1\> else (i.e. for the contention-based Random Access Preamble
selection):

2\> if at least one of the SSBs with SS-RSRP above
*msgA-RSRP-ThresholdSSB* is available:

3\> select an SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> if contention-free Random Access Resources for 2-step RA type have
not been configured and if Random Access Preambles group has not yet
been selected during the current Random Access procedure:

3\> if Random Access Preambles group B for 2-step RA type is configured:

4\> if the potential MSGA payload size (UL data available for
transmission plus MAC subheader and, where required, MAC CEs) is greater
than the *ra-MsgA-SizeGroupA* and the pathloss is less than *PCMAX* (of
the Serving Cell performing the Random Access Procedure) --
*msgA-PreambleReceivedTargetPower* -- *msgA-DeltaPreamble* --
*messagePowerOffsetGroupB*; or

4\> if the Random Access procedure was initiated for the CCCH logical
channel and the CCCH SDU size plus MAC subheader is greater than
*ra-MsgA-SizeGroupA*:

5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

3\> else:

4\> select the Random Access Preambles group A.

2\> else if contention-free Random Access Resources for 2-step RA type
have been configured and if Random Access Preambles group has not yet
been selected during the current Random Access procedure:

3\> if Random Access Preambles group B for 2-step RA type is configured;
and

3\> if the transport block size of the MSGA payload configured in the
*rach-ConfigDedicated* corresponds to the transport block size of the
MSGA payload associated with Random Access Preambles group B:

4\> select the Random Access Preambles group B.

3\> else:

4\> select the Random Access Preambles group A.

2\> else (i.e. Random Access preambles group has been selected during
the current Random Access procedure):

3\> select the same group of Random Access Preambles as was used for the
Random Access Preamble transmission attempt corresponding to the earlier
transmission of MSGA.

2\> select a Random Access Preamble randomly with equal probability from
the 2-step RA type Random Access Preambles associated with the selected
SSB and the selected Random Access Preambles group;

2\> set the *PREAMBLE\_INDEX* to the selected Random Access Preamble.

1\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB permitted by the restrictions given by
the *msgA-SSB-SharedRO-MaskIndex* if configured and
*ra-ssb-OccasionMaskIndex* *if configured* (the MAC entity shall select
a PRACH occasion randomly with equal probability among the consecutive
PRACH occasions allocated for 2-step RA type according to clause 8.1 of
TS 38.213 \[6\], corresponding to the selected SSB; the MAC entity may
take into account the possible occurrence of measurement gaps when
determining the next available PRACH occasion corresponding to the
selected SSB);

1\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

2\> select a PUSCH occasion from the PUSCH occasions configured in
*msgA-CFRA-PUSCH* corresponding to the PRACH slot of the selected PRACH
occasion, according to *msgA-PUSCH-resource-Index* corresponding to the
selected SSB;

2\> determine the UL grant and the associated HARQ information for the
MSGA payload in the selected PUSCH occasion;

2\> deliver the UL grant and the associated HARQ information to the HARQ
entity.

1\> else:

2\> select a PUSCH occasion corresponding to the selected preamble and
PRACH occasion according to clause 8.1A of TS 38.213 \[6\];

2\> determine the UL grant for the MSGA payload according to the PUSCH
configuration associated with the selected Random Access Preambles group
and determine the associated HARQ information;

2\> if the selected preamble and PRACH occasion is mapped to a valid
PUSCH occasion as specified in clause 8.1A of TS 38.213 \[6\]:

3\> deliver the UL grant and the associated HARQ information to the HARQ
entity.

1\> perform the MSGA transmission procedure (see clause 5.1.3a).

NOTE: To determine if there is an SSB with *SS-RSRP* above
*msgA-RSRP-ThresholdSSB*, the UE uses the latest unfiltered *L1-RSRP*
measurement.

\[TS 38.321, clause 5.1.3a\]

The MAC entity shall, for each MSGA:

1\> if *PREAMBLE\_TRANSMISSION\_COUNTER* is greater than one; and

1\> if the notification of suspending power ramping counter has not been
received from lower layers; and

1\> if LBT failure indication was not received from lower layers for the
last MSGA Random Access Preamble transmission; and

1\> if SSB selected is not changed from the selection in the last Random
Access Preamble transmission:

2\> increment *PREAMBLE\_POWER\_RAMPING\_COUNTER* by 1.

1\> select the value of *DELTA\_PREAMBLE* according to clause 7.3;

1\> set *PREAMBLE\_RECEIVED\_TARGET\_POWER* to
*msgA-PreambleReceivedTargetPower* + *DELTA\_PREAMBLE* +
(*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*;

1\> if this is the first MSGA transmission within this Random Access
procedure:

2\> if the transmission is not being made for the CCCH logical channel:

3\> indicate to the Multiplexing and assembly entity to include a C-RNTI
MAC CE in the subsequent uplink transmission.

2\> if the Random Access procedure was initiated for SpCell beam failure
recovery and *spCell-BFR-CBRA* with value *true* is configured:

3\> indicate to the Multiplexing and assembly entity to include a BFR
MAC CE or a Truncated BFR MAC CE in the subsequent uplink transmission.

2\> obtain the MAC PDU to transmit from the Multiplexing and assembly
entity according to the HARQ information determined for the MSGA payload
(see clause 5.1.2a) and store it in the MSGA buffer.

1\> compute the MSGB-RNTI associated with the PRACH occasion in which
the Random Access Preamble is transmitted;

1\> instruct the physical layer to transmit the MSGA using the selected
PRACH occasion and the associated PUSCH resource of MSGA (if the
selected preamble and PRACH occasion is mapped to a valid PUSCH
occasion), using the corresponding RA-RNTI, MSGB-RNTI,
*PREAMBLE\_INDEX*, *PREAMBLE\_RECEIVED\_TARGET\_POWER,
msgA-PreambleReceivedTargetPower,* and the amount of power ramping
applied to the latest MSGA preamble transmission (i.e.
(*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*);

\[TS 38.321, clause 5.1.4a\]

Once the MSGA preamble is transmitted, regardless of the possible
occurrence of a measurement gap, the MAC entity shall:

1\> start the *msgB-ResponseWindow* at the PDCCH occasion as specified
in TS 38.213 \[6\], clause 8.2A;

1\> monitor the PDCCH of the SpCell for a Random Access Response
identified by MSGB-RNTI while the *msgB-ResponseWindow* is running;

1\> if C-RNTI MAC CE was included in the MSGA:

2\> monitor the PDCCH of the SpCell for Random Access Response
identified by the C-RNTI while the *msgB-ResponseWindow* is running.

1\> if notification of a reception of a PDCCH transmission of the SpCell
is received from lower layers:

2\> if the C-RNTI MAC CE was included in MSGA:

3\> if the Random Access procedure was initiated for SpCell beam failure
recovery (as specified in clause 5.17) and the PDCCH transmission is
addressed to the C-RNTI:

4\> consider this Random Access Response reception successful;

4\> stop the *msgB-ResponseWindow*;

4\> consider this Random Access procedure successfully completed.

3\> else if the *timeAlignmentTimer* associated with the PTAG is
running:

4\> if the PDCCH transmission is addressed to the C-RNTI and contains a
UL grant for a new transmission:

5\> consider this Random Access Response reception successful;

5\> stop the *msgB-ResponseWindow*;

5\> consider this Random Access procedure successfully completed.

3\> else:

4\> if a downlink assignment has been received on the PDCCH for the
C-RNTI and the received TB is successfully decoded:

5\> if the MAC PDU contains the Absolute Timing Advance Command MAC CE:

6\> process the received Timing Advance Command (see clause 5.2);

6\> consider this Random Access Response reception successful;

6\> stop the *msgB-ResponseWindow*;

6\> consider this Random Access procedure successfully completed and
finish the disassembly and demultiplexing of the MAC PDU.

2\> if a valid (as specified in TS 38.213 \[6\]) downlink assignment has
been received on the PDCCH for the MSGB-RNTI and the received TB is
successfully decoded:

3\> if the MSGB contains a MAC subPDU with Backoff Indicator:

4\> set the *PREAMBLE\_BACKOFF* to value of the BI field of the MAC
subPDU using Table 7.2-1, multiplied with *SCALING\_FACTOR\_BI*.

3\> else:

4\> set the *PREAMBLE\_BACKOFF* to 0 ms.

3\> if the MSGB contains a fallbackRAR MAC subPDU; and

3\> if the Random Access Preamble identifier in the MAC subPDU matches
the transmitted *PREAMBLE\_INDEX* (see clause 5.1.3a):

4\> consider this Random Access Response reception successful;

4\> apply the following actions for the SpCell:

5\> process the received Timing Advance Command (see clause 5.2);

5\> indicate the *msgA-PreambleReceivedTargetPower* and the amount of
power ramping applied to the latest Random Access Preamble transmission
to lower layers (i.e. (*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*);

5\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

6\> consider the Random Access procedure successfully completed;

6\> process the received UL grant value and indicate it to the lower
layers.

5\> else:

6\> set the *TEMPORARY\_C-RNTI* to the value received in the Random
Access Response;

6\> if the Msg3 buffer is empty:

> 7\> obtain the MAC PDU to transmit from the MSGA buffer and store it
> in the Msg3 buffer;

6\> process the received UL grant value and indicate it to the lower
layers and proceed with Msg3 transmission.

NOTE: If within a 2-step RA type procedure, an uplink grant provided in
the fallback RAR has a different size than the MSGA payload, the UE
behaviour is not defined.

3\> else if the MSGB contains a successRAR MAC subPDU; and

3\> if the CCCH SDU was included in the MSGA and the UE Contention
Resolution Identity in the MAC subPDU matches the CCCH SDU:

4\> stop *msgB-ResponseWindow*;

4\> if this Random Access procedure was initiated for SI request:

5\> indicate the reception of an acknowledgement for SI request to upper
layers.

4\> else:

5\> set the C-RNTI to the value received in the *successRAR;*

5\> apply the following actions for the SpCell:

6\> process the received Timing Advance Command (see clause 5.2);

6\> indicate the *msgA-PreambleReceivedTargetPower* and the amount of
power ramping applied to the latest Random Access Preamble transmission
to lower layers (i.e. (*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*).

4\> deliver the *TPC*, *PUCCH resource Indicator, ChannelAccess-CPext*
(if indicated), and *HARQ feedback Timing Indicator* received in
successRAR to lower layers.

4\> consider this Random Access Response reception successful;

4\> consider this Random Access procedure successfully completed;

4\> finish the disassembly and demultiplexing of the MAC PDU.

1\> if *msgB-ResponseWindow* expires, and the Random Access Response
Reception has not been considered as successful based on descriptions
above:

2\> increment *PREAMBLE\_TRANSMISSION\_COUNTER* by 1;

2\> if *PREAMBLE\_TRANSMISSION\_COUNTE*R = *preambleTransMax* + 1:

3\> indicate a Random Access problem to upper layers;

3\> if this Random Access procedure was triggered for SI request:

4\> consider this Random Access procedure unsuccessfully completed.

2\> if the Random Access procedure is not completed:

3\> if *msgA-TransMax* is applied (see clause 5.1.1a) and
*PREAMBLE\_TRANSMISSION\_COUNTER* = *msgA-TransMax* + 1:

4\> set the *RA\_TYPE* to *4-stepRA*;

4\> perform initialization of variables specific to Random Access type
as specified in clause 5.1.1a;

4\> if the Msg3 buffer is empty:

5\> obtain the MAC PDU to transmit from the MSGA buffer and store it in
the Msg3 buffer;

4\> flush HARQ buffer used for the transmission of MAC PDU in the MSGA
buffer;

4\> discard explicitly signalled contention-free 2-step RA type Random
Access Resources, if any;

4\> perform the Random Access Resource selection procedure as specified
in clause 5.1.2.

3\> else:

4\> select a random backoff time according to a uniform distribution
between 0 and the *PREAMBLE\_BACKOFF*;

4\> if the criteria (as defined in clause 5.1.2a) to select
contention-free Random Access Resources is met during the backoff time:

5\> perform the Random Access Resource selection procedure for 2-step RA
type Random Access (see clause 5.1.2a).

4\> else:

5\> perform the Random Access Resource selection procedure for 2-step RA
type Random Access (see clause 5.1.2a) after the backoff time.

Upon receiving a fallbackRAR, the MAC entity may stop
*msgB-ResponseWindow* once the Random Access Response reception is
considered as successful.

##### 7.1.1.1.8.3 Test description {#test-description-7 .H6}

##### 7.1.1.1.8.3.1 Pre-test conditions {#pre-test-conditions-7 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that Test loop
function(*Off*).

##### 7.1.1.1.8.3.2 Test procedure sequence {#test-procedure-sequence-6 .H6}

Table 7.1.1.1.8.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | SS        | \<\--     | RRCReconf | \-      | \- |
|           | transmits |           | iguration |         |    |
|           | an        |           |           |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | message   |           |           |         |    |
|           | with      |           |           |         |    |
|           | reconf    |           |           |         |    |
|           | iguration |           |           |         |    |
|           | with sync |           |           |         |    |
|           | and       |           |           |         |    |
|           | conten    |           |           |         |    |
|           | tion-free |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Resources |           |           |         |    |
|           | for       |           |           |         |    |
|           | 2-step RA |           |           |         |    |
|           | type have |           |           |         |    |
|           | been      |           |           |         |    |
|           | e         |           |           |         |    |
|           | xplicitly |           |           |         |    |
|           | provided  |           |           |         |    |
|           | in        |           |           |         |    |
|           | *rac      |           |           |         |    |
|           | h-ConfigD |           |           |         |    |
|           | edicated. |           |           |         |    |
|           | (Note 1)* |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | xception: |           |           |         |    |
|           | Steps 2   |           |           |         |    |
|           | to 3 are  |           |           |         |    |
|           | run       |           |           |         |    |
|           | *msgA-    |           |           |         |    |
|           | TransMax* |           |           |         |    |
|           | times     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | Check:    | \--\>     | *MAC PDU  | 1,2     | P  |
|           | Does the  |           | (*        |         |    |
|           | UE        |           | including |         |    |
|           | transmit  |           | C-RNTI    |         |    |
|           | a MSGA    |           | MAC CE)   |         |    |
|           | including |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | MAC CE    |           |           |         |    |
|           | message   |           |           |         |    |
|           | using the |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Resources |           |           |         |    |
|           | for       |           |           |         |    |
|           | 2-step RA |           |           |         |    |
|           | type      |           |           |         |    |
|           | e         |           |           |         |    |
|           | xplicitly |           |           |         |    |
|           | pr        |           |           |         |    |
|           | ovided*?* |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | SS does   | \-        | *-*       | \-      | \- |
|           | not       |           |           |         |    |
|           | sche      |           |           |         |    |
|           | dulePDCCH |           |           |         |    |
|           | tra       |           |           |         |    |
|           | nsmission |           |           |         |    |
|           | for UE    |           |           |         |    |
|           | C\_RNTI   |           |           |         |    |
|           | until     |           |           |         |    |
|           | *ms       |           |           |         |    |
|           | gB-Respon |           |           |         |    |
|           | seWindow* |           |           |         |    |
|           | expires.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | Check:    | \--\>     | *MAC PDU  | 2       | P  |
|           | Does the  |           | (*        |         |    |
|           | UE        |           | including |         |    |
|           | transmit  |           | C-RNTI    |         |    |
|           | a MSGA    |           | MAC CE)   |         |    |
|           | including |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | CEmessage |           |           |         |    |
|           | using the |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Resources |           |           |         |    |
|           | for       |           |           |         |    |
|           | 2-step RA |           |           |         |    |
|           | type      |           |           |         |    |
|           | e         |           |           |         |    |
|           | xplicitly |           |           |         |    |
|           | provided? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | SS        | \<\--     | MAC       | \-      | \- |
|           | schedules |           | PDU       |         |    |
|           | PDCCH     |           | (Absolute |         |    |
|           | tra       |           | Timing    |         |    |
|           | nsmission |           | Advance   |         |    |
|           | for UE    |           |           |         |    |
|           | C\_RNTI   |           | Command   |         |    |
|           | and DL    |           | MAC       |         |    |
|           | MAC PDU   |           | Control   |         |    |
|           | c         |           | Element)  |         |    |
|           | ontaining |           |           |         |    |
|           | Absolute  |           |           |         |    |
|           | Timing    |           |           |         |    |
|           | Advance   |           |           |         |    |
|           | Command   |           |           |         |    |
|           | MAC CE.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | UE        | \--\>     | RRCRecon  | \-      | \- |
|           | transmits |           | figuratio |         |    |
|           | an        |           | nComplete |         |    |
|           | RRCRecon  |           |           |         |    |
|           | figuratio |           |           |         |    |
|           | nComplete |           |           |         |    |
|           | mess      |           |           |         |    |
|           | age.(Note |           |           |         |    |
|           | 2)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *R        |           |           |           |         |    |
| RCReconfi |           |           |           |         |    |
| guration* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RRC      |           |           |           |         |    |
| Connectio |           |           |           |         |    |
| nReconfig |           |           |           |         |    |
| uration.* |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| RRCConnec |           |           |           |         |    |
| tionRecon |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| and sent  |           |           |           |         |    |
| in E-UTRA |           |           |           |         |    |
| cell.     |           |           |           |         |    |
| RRCConnec |           |           |           |         |    |
| tionRecon |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| could be  |           |           |           |         |    |
| tr        |           |           |           |         |    |
| ansmitted |           |           |           |         |    |
| during    |           |           |           |         |    |
| Step2 and |           |           |           |         |    |
| Step5.    |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.1.8.3.3 Specific message contents {#specific-message-contents-7 .H6}

Table 7.1.1.1.8.3.3-1: *RRCReconfiguration* for EN-DC (steps 1, Table
7.1.1.1.8.3.2-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13 with condition EN-DC\_HO.                               
  ------------------------------------------------------------------------------ ----------------- --------- -----------
  Information Element                                                            Value/remark      Comment   Condition
  RRCReconfiguration ::= SEQUENCE {                                                                          
  criticalExtensions CHOICE {                                                                                
  rrcReconfiguration ::= SEQUENCE {                                                                          
  secondaryCellGroup                                                             CellGroupConfig             
  }                                                                                                          
  }                                                                                                          
  }                                                                                                          

Table 7.1.1.1.8.3.3-1A: *RRCReconfiguration* for NR/5GC (step 1, Table
7.1.1.1.8.3.2-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                                                                                                                                                          
  ---------------------------------------------------- -------------------------------------------------------------------------------------------------- --------------------------------------------------- -----------
  Information Element                                  Value/remark                                                                                       Comment                                             Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                                                                                                           
  criticalExtensions CHOICE {                                                                                                                                                                                 
  rrcReconfiguration ::= SEQUENCE {                                                                                                                                                                           
  radioBearerConfig                                    RadioBearerConfig as per TS 38.508-1\[4\] Table 4.6.3-132 with conditions DRBn and Recover\_PDCP   n set to the default DRB of the first PDU session   NR
  nonCriticalExtension SEQUENCE {                                                                                                                                                                             
  masterCellGroup                                      CellGroupConfig                                                                                                                                        
  }                                                                                                                                                                                                           
  }                                                                                                                                                                                                           
  }                                                                                                                                                                                                           
  }                                                                                                                                                                                                           

Table 7.1.1.1.8.3.3-2: *CellGroupConfig* for EN-DC (Table
7.1.1.1.8.3.3-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19 with condition PSCell\_change                                                                
  ---------------------------------------------------------------------------------- -------------------------------------------------- --------- -----------
  Information Element                                                                Value/remark                                       Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                                                                                  
  spCellConfig SEQUENCE {                                                                                                                         
  reconfigurationWithSync SEQUENCE {                                                                                                              
  spCellConfigCommon                                                                 ServingCellConfigCommon                                      
  newUE-Identity                                                                     UE identity different from NR cell 1 UE identity             
  rach-ConfigDedicated CHOICE {                                                                                                                   
  uplink                                                                             RACH-ConfigDedicated                                         
  }                                                                                                                                               
  }                                                                                                                                               
  }                                                                                                                                               
  }                                                                                                                                               

Table 7.1.1.1.8.3.3-2A: *CellGroupConfig* for NR/5GC (Table
7.1.1.1.8.3.3-1A)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19 with condition PCell\_change                                                                
  --------------------------------------------------------------------------------- -------------------------------------------------- --------- -----------
  Information Element                                                               Value/remark                                       Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                                                                                 
  spCellConfig SEQUENCE {                                                                                                                        
  reconfigurationWithSync SEQUENCE {                                                                                                             
  spCellConfigCommon                                                                ServingCellConfigCommon                                      
  newUE-Identity                                                                    UE identity different from NR cell 1 UE identity             
  rach-ConfigDedicated CHOICE {                                                                                                                  
  uplink                                                                            RACH-ConfigDedicated                                         
  }                                                                                                                                              
  }                                                                                                                                              
  }                                                                                                                                              
  }                                                                                                                                              

Table 7.1.1.1.8.3.3-3: *RACH-ConfigDedicated* (Table 7.1.1.1.8.3.3-2 and
Table 7.1.1.1.8.3.3-2A)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-129                                                                                 
  --------------------------------------------------------------------------------- ----------------------------- ------------------- ------------
  Information Element                                                               Value/remark                  Comment             Condition
  RACH-ConfigDedicated ::= SEQUENCE {                                                                                                 
  cfra-TwoStep-r16 SEQUENCE {                                                                                                         
  occasionsTwoStepRA-r16 SEQUENCE {                                                                                                   
  rach-ConfigGenericTwoStepRA-r16                                                   RACH-ConfigGenericTwoStepRA                       
  ssb-PerRACH-OccasionTwoStepRA-r16                                                 one                                               
  }                                                                                                                                   
  msgA-CFRA-PUSCH-r16 SEQUENCE {                                                                                                      
  msgA-PUSCH-TimeDomainOffset-r16                                                   5                                                 
                                                                                    10                                                FR1 SCS 30
  startSymbolAndLengthMsgA-PO-r16                                                   27                            S=0, L=14           
  msgA-TransMax-r16                                                                 n10                                               
  resourcesTwoStep-r16 SEQUENCE {                                                                                                     
  ssb-ResourceList SEQUENCE (SIZE(1..maxRA-SSB-Resources)) OF CFRA-SSB-Resource {                                                     
  ssb                                                                               0                                                 
  ra-PreambleIndex                                                                  52                            Randomly selected   
  msgA-PUSCH-Resource-Index-r16                                                     Not present                                       
  }                                                                                                                                   
  ra-ssb-OccasionMaskIndex                                                          0                                                 
  }                                                                                                                                   
  }                                                                                                                                   
  }                                                                                                                                   

Table 7.1.1.1.8.3.3-4: *RACH-ConfigGeneric* (Table 7.1.1.1.8.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-129                            
  ----------------------------------------------------- -------------- --------- -----------------
  Information Element                                   Value/remark   Comment   Condition
  RACH-ConfigGeneric ::= SEQUENCE {                                              
  prach-ConfigurationIndex                              14                       FR1
                                                        13                       FR1 AND HD\_FDD
                                                        149                      FR2
  zeroCorrelationZoneConfig                             12                       FR1
                                                        15                       FR2
  }                                                                              

  Condition   Explanation
  ----------- ----------------------------------------------------------------------------------------
  HD\_FDD     pc\_halfDuplexFDD\_TypeA\_RedCap\_r17 (i.e HD\_FDD UE are performing test on FDD band)

Table 7.1.1.1.8.3.3-5: *RACH-ConfigGenericTwoStepRA* (Table
7.1.1.1.8.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-130A                            
  ------------------------------------------------------ -------------- --------- -----------------
  Information Element                                    Value/remark   Comment   Condition
  *RACH-ConfigGenericTwoStepRA* ::= SEQUENCE {                                    
  msgA-PRACH-ConfigurationIndex-r16                      Not present              
                                                         13                       FR1 AND HD\_FDD
  msgA-RO-FDM-r16                                        Not present              
  msgA-RO-FrequencyStart-r16                             Not present              
  msgA-ZeroCorrelationZoneConfig-r16                     Not present              
  msgA-PreamblePowerRampingStep-r16                      Not present              
  msgA-PreambleReceivedTargetPower-r16                   Not present              
  }                                                                               

  ----------- ----------------------------------------------------------------------------------------
  Condition   Explanation
  HD\_FDD     pc\_halfDuplexFDD\_TypeA\_RedCap\_r17 (i.e HD\_FDD UE are performing test on FDD band)
  ----------- ----------------------------------------------------------------------------------------

Table 7.1.1.1.8.3.3-6: *ServingCellConfigCommon* (Table 7.1.1.1.8.3.3-2
and Table 7.1.1.1.8.3.3-2A)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                      
  ----------------------------------------------------- ------------------------ --------- -----------
  Information Element                                   Value/remark             Comment   Condition
  ServingCellConfigCommon ::= SEQUENCE {                                                   
  uplinkConfigCommon SEQUENCE {                                                            
  initialUplinkBWP                                      BWP-UplinkCommon                   
  }                                                                                        
  tdd-UL-DL-ConfigurationCommon                         TDD-UL-DL-ConfigCommon             
  }                                                                                        

Table 7.1.1.1.8.3.3-7: *BWP-UplinkCommon (*Table 7.1.1.1.8.3.3-6)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-10                                 
  ---------------------------------------------------- ------------------- --------- -----------
  Information Element                                  Value/remark        Comment   Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                    
  rach-ConfigCommon CHOICE {                                                         
  setup                                                RACH-ConfigCommon             
  }                                                                                  
  msgA-ConfigCommon-r16 CHOICE {                                                     
  setup                                                MsgA-ConfigCommon             
  }                                                                                  
  }                                                                                  

Table 7.1.1.1.8.3.3-8: *RACH-ConfigCommon (*Table 7.1.1.1.8.3.3-7)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128                                                                                                         
  ----------------------------------------------------- ---------------------------------------------------------------------- ------------------------------ -----------
  Information Element                                   Value/remark                                                           Comment                        Condition
  RACH-ConfigCommon ::= SEQUENCE {                                                                                                                            
  rach-ConfigGeneric                                    RACH-ConfigGeneric                                                                                    
  Ssb-perRACH-OccasionAndCB-PreamblesPerSSB CHOICE {                                                                                                          
  one                                                   n36                                                                                                   
  }                                                                                                                                                           
  prach-RootSequenceIndex CHOICE {                                                                                                                            
  l139                                                  Set according to table 4.4.2-2 in TS 38.508-1 \[4\] for the NR Cell.                                  
  l839                                                  Set according to table 4.4.2-2 in TS 38.508-1 \[4\] for the NR Cell.   PRACH Preamble format 0 used   FR1,
  }                                                                                                                                                           
  }                                                                                                                                                           

Table 7.1.1.1.8.3.3-9: *MsgA-ConfigCommon (*Table 7.1.1.1.8.3.3-7)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-81A                                          
  ----------------------------------------------------- ---------------------------- --------- -----------
  Information Element                                   Value/remark                 Comment   Condition
  MsgA-ConfigCommon-r16 ::= SEQUENCE {                                                         
  rach-ConfigCommonTwoStepRA-r16                        RACH-ConfigCommonTwoStepRA             
  msgA-PUSCH-Config-r16                                 MsgA-PUSCH-Config                      
  }                                                                                            

Table 7.1.1.1.8.3.3-10: *TDD-UL-DL-ConfigCommon (*Table 7.1.1.1.8.3.3-6)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-192                                 
  ----------------------------------------------------- ------------------- --------- --------------------------
  Information Element                                   Value/remark        Comment   Condition
  TDD-UL-DL-ConfigCommon ::= SEQUENCE {                                               
  referenceSubcarrierSpacing                            SubcarrierSpacing             
  pattern1 SEQUENCE {                                                                 
  dl-UL-TransmissionPeriodicity                         ms5                           FR1 SCS 30
                                                        ms5                           FR1 SCS 15
                                                        ms0p625                       FR2
  nrofDownlinkSlots                                     3                             FR1 SCS 30
                                                        1                             FR1 SCS 15
                                                        3                             FR2
  nrofDownlinkSymbols                                   6                             FR1 SCS 30
                                                        10                            FR1 SCS 15
                                                        10                            FR2
  nrofUplinkSlots                                       2                             FR1 SCS 30
                                                        1                             FR1 SCS 15
                                                        1                             FR2
  nrofUplinkSymbols                                     4                             FR1 SCS 30
                                                        2                             FR1 SCS 15
                                                        2                             FR2
  dl-UL-TransmissionPeriodicity-v1530                   ms3                           FR1 SCS 30 or FR1 SCS 15
  }                                                                                   
  pattern2                                              Not present                   
  pattern2 SEQUENCE {                                                                 FR1 SCS 30 or FR1 SCS 15
  dl-UL-TransmissionPeriodicity                         ms2                           
  nrofDownlinkSlots                                     4                             FR1 SCS 30
                                                        2                             FR1 SCS 15
  nrofDownlinkSymbols                                   0                             
  nrofUplinkSlots                                       0                             
  nrofUplinkSymbols                                     0                             
  }                                                                                   
  }                                                                                   

Table 7.1.1.1.8.3.3-11: *RACH-ConfigCommonTwoStepRA (*Table
7.1.1.1.8.3.3-9)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128A                             
  ------------------------------------------------------ -------------- ---------- -----------
  Information Element                                    Value/remark   Comment    Condition
  RACH-ConfigCommonTwoStepRA-r16 ::= SEQUENCE {                                    
  msgA-RSRP-Threshold-r16                                57             -100 dBm   
  }                                                                                

Table 7.1.1.1.8.3.3-12: *Void*

##### 7.1.1.1.9 Random access procedure / Successful / 2-step RACH/C-RNTI Based / Preamble selected by MAC itself

##### 7.1.1.1.9.1 Test Purpose (TP) {#test-purpose-tp-8 .H6}

##### (1) {#section-31 .H6}

**with** { UE in RRC\_Connected state after NR SpCell TimeAlignmentTimer
expired, and has UL Data to send }

**ensure that** {

**when** { the UL MAC PDU Size is less than ra-MsgA-SizeGroupA }

**then** { UE transmits a MSGA using a preamble in group A of random
access preambles }

}

##### (2) {#section-32 .H6}

**with** { UE in RRC\_Connected state after transmission of a MSGA on NR
SpCell }

**ensure that** {

**when** { SS does not answer with a matching MSGB within
msgB-ResponseWindow }

**then** { UE retransmits a MSGA using a preamble from same group }

}

##### (3) {#section-33 .H6}

**with** { UE in RRC\_Connected state after transmission of a MSGA on NR
SpCell }

**ensure that** {

**when** { SS sends a MSGB including a Backoff Indicator and the Random
Access Preamble identifier is different from the value received from UE
}

**then** { UE performs the Random Access Resource selection procedure
for 2-step RA type Random Access after a random time between 0 and the
indicated Backoff parameter from same group }

}

##### (4) {#section-34 .H6}

**with** { UE in RRC\_Connected state after NR SpCell TimeAlignmentTimer
expired, and has UL Data to send }

**ensure that** {

**when** { the UL MAC PDU Size is greater than messageSizeGroupA }

**then** { UE transmits a MSGA using a preamble in group B of random
access preambles }

}

##### (5) {#section-35 .H6}

**with** { UE in RRC\_Connected state and having initiated a 2-step RA
type Random Access procedure in NR SpCell }

**ensure that** {

**when** { SS transmits a Timing Advance Command in a MSGB message }

**then** { UE applies the received Timing Advance value in the next
transmitted MAC PDU }

}

##### 7.1.1.1.9.2 Conformance requirements {#conformance-requirements-8 .H6}

References: The conformance requirements covered in the present TC are
specified in: 3GPP TS 38.321, clause 5.1.2a, 5.1.3a, 5.1.4a, 5.1.5 and
5.2. Unless otherwise stated these are Rel-16 requirements.

\[TS 38.321, clause 5.1.2a\]

If the selected *RA\_TYPE* is set to *2-stepRA*, the MAC entity shall:

1\> if the contention-free 2-step RA type Resources associated with SSBs
have been explicitly provided in *rach-ConfigDedicated* and at least one
SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB* amongst the associated
SSBs is available:

2\> select an SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB* amongst
the associated SSBs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB.

1\> else (i.e. for the contention-based Random Access Preamble
selection):

2\> if at least one of the SSBs with SS-RSRP above
*msgA-RSRP-ThresholdSSB* is available:

3\> select an SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> if contention-free Random Access Resources for 2-step RA type have
not been configured and if Random Access Preambles group has not yet
been selected during the current Random Access procedure:

3\> if Random Access Preambles group B for 2-step RA type is configured:

4\> if the potential MSGA payload size (UL data available for
transmission plus MAC subheader and, where required, MAC CEs) is greater
than the *ra-MsgA-SizeGroupA* and the pathloss is less than *PCMAX* (of
the Serving Cell performing the Random Access Procedure) --
*msgA-PreambleReceivedTargetPower* -- *msgA-DeltaPreamble* --
*messagePowerOffsetGroupB*; or

4\> if the Random Access procedure was initiated for the CCCH logical
channel and the CCCH SDU size plus MAC subheader is greater than
*ra-MsgA-SizeGroupA*:

5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

3\> else:

4\> select the Random Access Preambles group A.

2\> else if contention-free Random Access Resources for 2-step RA type
have been configured and if Random Access Preambles group has not yet
been selected during the current Random Access procedure:

3\> if Random Access Preambles group B for 2-step RA type is configured;
and

3\> if the transport block size of the MSGA payload configured in the
*rach-ConfigDedicated* corresponds to the transport block size of the
MSGA payload associated with Random Access Preambles group B:

4\> select the Random Access Preambles group B.

3\> else:

4\> select the Random Access Preambles group A.

2\> else (i.e. Random Access preambles group has been selected during
the current Random Access procedure):

3\> select the same group of Random Access Preambles as was used for the
Random Access Preamble transmission attempt corresponding to the earlier
transmission of MSGA.

2\> select a Random Access Preamble randomly with equal probability from
the 2-step RA type Random Access Preambles associated with the selected
SSB and the selected Random Access Preambles group;

2\> set the *PREAMBLE\_INDEX* to the selected Random Access Preamble.

1\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB permitted by the restrictions given by
the *msgA-SSB-SharedRO-MaskIndex* if configured and
*ra-ssb-OccasionMaskIndex* *if configured* (the MAC entity shall select
a PRACH occasion randomly with equal probability among the consecutive
PRACH occasions allocated for 2-step RA type according to clause 8.1 of
TS 38.213 \[6\], corresponding to the selected SSB; the MAC entity may
take into account the possible occurrence of measurement gaps when
determining the next available PRACH occasion corresponding to the
selected SSB);

1\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

2\> select a PUSCH occasion from the PUSCH occasions configured in
*msgA-CFRA-PUSCH* corresponding to the PRACH slot of the selected PRACH
occasion, according to *msgA-PUSCH-resource-Index* corresponding to the
selected SSB;

2\> determine the UL grant and the associated HARQ information for the
MSGA payload in the selected PUSCH occasion;

2\> deliver the UL grant and the associated HARQ information to the HARQ
entity.

1\> else:

2\> select a PUSCH occasion corresponding to the selected preamble and
PRACH occasion according to clause 8.1A of TS 38.213 \[6\];

2\> determine the UL grant for the MSGA payload according to the PUSCH
configuration associated with the selected Random Access Preambles group
and determine the associated HARQ information;

2\> if the selected preamble and PRACH occasion is mapped to a valid
PUSCH occasion as specified in clause 8.1A of TS 38.213 \[6\]:

3\> deliver the UL grant and the associated HARQ information to the HARQ
entity.

1\> perform the MSGA transmission procedure (see clause 5.1.3a).

NOTE: To determine if there is an SSB with *SS-RSRP* above
*msgA-RSRP-ThresholdSSB*, the UE uses the latest unfiltered *L1-RSRP*
measurement.

\[TS 38.321, clause 5.1.3a\]

The MAC entity shall, for each MSGA:

1\> if *PREAMBLE\_TRANSMISSION\_COUNTER* is greater than one; and

1\> if the notification of suspending power ramping counter has not been
received from lower layers; and

1\> if LBT failure indication was not received from lower layers for the
last MSGA Random Access Preamble transmission; and

1\> if SSB selected is not changed from the selection in the last Random
Access Preamble transmission:

2\> increment *PREAMBLE\_POWER\_RAMPING\_COUNTER* by 1.

1\> select the value of *DELTA\_PREAMBLE* according to clause 7.3;

1\> set *PREAMBLE\_RECEIVED\_TARGET\_POWER* to
*msgA-PreambleReceivedTargetPower* + *DELTA\_PREAMBLE* +
(*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*;

1\> if this is the first MSGA transmission within this Random Access
procedure:

2\> if the transmission is not being made for the CCCH logical channel:

3\> indicate to the Multiplexing and assembly entity to include a C-RNTI
MAC CE in the subsequent uplink transmission.

2\> if the Random Access procedure was initiated for SpCell beam failure
recovery and *spCell-BFR-CBRA* with value *true* is configured:

3\> indicate to the Multiplexing and assembly entity to include a BFR
MAC CE or a Truncated BFR MAC CE in the subsequent uplink transmission.

2\> obtain the MAC PDU to transmit from the Multiplexing and assembly
entity according to the HARQ information determined for the MSGA payload
(see clause 5.1.2a) and store it in the MSGA buffer.

1\> compute the MSGB-RNTI associated with the PRACH occasion in which
the Random Access Preamble is transmitted;

1\> instruct the physical layer to transmit the MSGA using the selected
PRACH occasion and the associated PUSCH resource of MSGA (if the
selected preamble and PRACH occasion is mapped to a valid PUSCH
occasion), using the corresponding RA-RNTI, MSGB-RNTI,
*PREAMBLE\_INDEX*, *PREAMBLE\_RECEIVED\_TARGET\_POWER,
msgA-PreambleReceivedTargetPower,* and the amount of power ramping
applied to the latest MSGA preamble transmission (i.e.
(*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*);

1\> if LBT failure indication is received from lower layers for the
transmission of this MSGA Random Access Preamble:

2\> instruct the physical layer to cancel the transmission of the MSGA
payload on the associated PUSCH resource;

2\> if *lbt-FailureRecoveryConfig* is configured:

3\> perform the Random Access Resource selection procedure for 2-step RA
type (see clause 5.1.2a).

2\> else:

3\> increment *PREAMBLE\_TRANSMISSION\_COUNTER* by 1;

3\> if *PREAMBLE\_TRANSMISSION\_COUNTE*R = *preambleTransMax* + 1:

4\> indicate a Random Access problem to upper layers;

4\> if this Random Access procedure was triggered for SI request:

5\> consider this Random Access procedure unsuccessfully completed.

3\> if the Random Access procedure is not completed:

4\> if *msgA-TransMax* is applied (see clause 5.1.1a) and
*PREAMBLE\_TRANSMISSION\_COUNTER* = *msgA-TransMax* + 1:

5\> set the *RA\_TYPE* to *4-stepRA*;

5\> perform initialization of variables specific to Random Access type
as specified in clause 5.1.1a;

5\> if the Msg3 buffer is empty:

6\> obtain the MAC PDU to transmit from the MSGA buffer and store it in
the Msg3 buffer;

5\> flush HARQ buffer used for the transmission of MAC PDU in the MSGA
buffer;

5\> discard explicitly signalled contention-free 2-step RA type Random
Access Resources, if any;

5\> perform the Random Access Resource selection procedure as specified
in clause 5.1.2.

4\> else:

5\> perform the Random Access Resource selection procedure for 2-step RA
type (see clause 5.1.2a).

NOTE: The MSGA transmission includes the transmission of the PRACH
Preamble as well as the contents of the MSGA buffer in the PUSCH
resource corresponding to the selected PRACH occasion and
*PREAMBLE\_INDEX* (see TS 38.213 \[6\])

The MSGB-RNTI associated with the PRACH occasion in which the Random
Access Preamble is transmitted, is computed as:

MSGB-RNTI = 1 + s\_id + 14 Ã— t\_id + 14 Ã— 80 Ã— f\_id + 14 Ã— 80 Ã— 8 Ã—
ul\_carrier\_id + 14 Ã— 80 Ã— 8 Ã— 2

where s\_id is the index of the first OFDM symbol of the PRACH occasion
(0 â‰¤ s\_id \< 14), t\_id is the index of the first slot of the PRACH
occasion in a system frame (0 â‰¤ t\_id \< 80), where the subcarrier
spacing to determine t\_id is based on the value of Î¼ specified in
clause 5.3.2 in TS 38.211 \[8\], f\_id is the index of the PRACH
occasion in the frequency domain (0 â‰¤ f\_id \< 8), and ul\_carrier\_id
is the UL carrier used for Random Access Preamble transmission (0 for
NUL carrier, and 1 for SUL carrier). The RA-RNTI is calculated as
specified in clause 5.1.3.

\[TS 38.321, clause 5.1.4a\]

Once the MSGA preamble is transmitted, regardless of the possible
occurrence of a measurement gap, the MAC entity shall:

1\> start the *msgB-ResponseWindow* at the PDCCH occasion as specified
in TS 38.213 \[6\], clause 8.2A;

1\> monitor the PDCCH of the SpCell for a Random Access Response
identified by MSGB-RNTI while the *msgB-ResponseWindow* is running;

1\> if C-RNTI MAC CE was included in the MSGA:

2\> monitor the PDCCH of the SpCell for Random Access Response
identified by the C-RNTI while the *msgB-ResponseWindow* is running.

1\> if notification of a reception of a PDCCH transmission of the SpCell
is received from lower layers:

2\> if the C-RNTI MAC CE was included in MSGA:

3\> if the Random Access procedure was initiated for SpCell beam failure
recovery (as specified in clause 5.17) and the PDCCH transmission is
addressed to the C-RNTI:

4\> consider this Random Access Response reception successful;

4\> stop the *msgB-ResponseWindow*;

4\> consider this Random Access procedure successfully completed.

3\> else if the *timeAlignmentTimer* associated with the PTAG is
running:

4\> if the PDCCH transmission is addressed to the C-RNTI and contains a
UL grant for a new transmission:

5\> consider this Random Access Response reception successful;

5\> stop the *msgB-ResponseWindow*;

5\> consider this Random Access procedure successfully completed.

3\> else:

4\> if a downlink assignment has been received on the PDCCH for the
C-RNTI and the received TB is successfully decoded:

5\> if the MAC PDU contains the Absolute Timing Advance Command MAC CE:

6\> process the received Timing Advance Command (see clause 5.2);

6\> consider this Random Access Response reception successful;

6\> stop the *msgB-ResponseWindow*;

6\> consider this Random Access procedure successfully completed and
finish the disassembly and demultiplexing of the MAC PDU.

2\> if a valid (as specified in TS 38.213 \[6\]) downlink assignment has
been received on the PDCCH for the MSGB-RNTI and the received TB is
successfully decoded:

3\> if the MSGB contains a MAC subPDU with Backoff Indicator:

4\> set the *PREAMBLE\_BACKOFF* to value of the BI field of the MAC
subPDU using Table 7.2-1, multiplied with *SCALING\_FACTOR\_BI*.

3\> else:

4\> set the *PREAMBLE\_BACKOFF* to 0 ms.

3\> if the MSGB contains a fallbackRAR MAC subPDU; and

3\> if the Random Access Preamble identifier in the MAC subPDU matches
the transmitted *PREAMBLE\_INDEX* (see clause 5.1.3a):

4\> consider this Random Access Response reception successful;

4\> apply the following actions for the SpCell:

5\> process the received Timing Advance Command (see clause 5.2);

5\> indicate the *msgA-PreambleReceivedTargetPower* and the amount of
power ramping applied to the latest Random Access Preamble transmission
to lower layers (i.e. (*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*);

5\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

6\> consider the Random Access procedure successfully completed;

6\> process the received UL grant value and indicate it to the lower
layers.

5\> else:

6\> set the *TEMPORARY\_C-RNTI* to the value received in the Random
Access Response;

6\> if the Msg3 buffer is empty:

> 7\> obtain the MAC PDU to transmit from the MSGA buffer and store it
> in the Msg3 buffer;

6\> process the received UL grant value and indicate it to the lower
layers and proceed with Msg3 transmission.

NOTE: If within a 2-step RA type procedure, an uplink grant provided in
the fallback RAR has a different size than the MSGA payload, the UE
behaviour is not defined.

3\> else if the MSGB contains a successRAR MAC subPDU; and

3\> if the CCCH SDU was included in the MSGA and the UE Contention
Resolution Identity in the MAC subPDU matches the CCCH SDU:

4\> stop *msgB-ResponseWindow*;

4\> if this Random Access procedure was initiated for SI request:

5\> indicate the reception of an acknowledgement for SI request to upper
layers.

4\> else:

5\> set the C-RNTI to the value received in the *successRAR;*

5\> apply the following actions for the SpCell:

6\> process the received Timing Advance Command (see clause 5.2);

6\> indicate the *msgA-PreambleReceivedTargetPower* and the amount of
power ramping applied to the latest Random Access Preamble transmission
to lower layers (i.e. (*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*).

4\> deliver the *TPC*, *PUCCH resource Indicator, ChannelAccess-CPext*
(if indicated), and *HARQ feedback Timing Indicator* received in
successRAR to lower layers.

4\> consider this Random Access Response reception successful;

4\> consider this Random Access procedure successfully completed;

4\> finish the disassembly and demultiplexing of the MAC PDU.

1\> if *msgB-ResponseWindow* expires, and the Random Access Response
Reception has not been considered as successful based on descriptions
above:

2\> increment *PREAMBLE\_TRANSMISSION\_COUNTER* by 1;

2\> if *PREAMBLE\_TRANSMISSION\_COUNTE*R = *preambleTransMax* + 1:

3\> indicate a Random Access problem to upper layers;

3\> if this Random Access procedure was triggered for SI request:

4\> consider this Random Access procedure unsuccessfully completed.

2\> if the Random Access procedure is not completed:

3\> if *msgA-TransMax* is applied (see clause 5.1.1a) and
*PREAMBLE\_TRANSMISSION\_COUNTER* = *msgA-TransMax* + 1:

4\> set the *RA\_TYPE* to *4-stepRA*;

4\> perform initialization of variables specific to Random Access type
as specified in clause 5.1.1a;

4\> if the Msg3 buffer is empty:

5\> obtain the MAC PDU to transmit from the MSGA buffer and store it in
the Msg3 buffer;

4\> flush HARQ buffer used for the transmission of MAC PDU in the MSGA
buffer;

4\> discard explicitly signalled contention-free 2-step RA type Random
Access Resources, if any;

4\> perform the Random Access Resource selection procedure as specified
in clause 5.1.2.

3\> else:

4\> select a random backoff time according to a uniform distribution
between 0 and the *PREAMBLE\_BACKOFF*;

4\> if the criteria (as defined in clause 5.1.2a) to select
contention-free Random Access Resources is met during the backoff time:

5\> perform the Random Access Resource selection procedure for 2-step RA
type Random Access (see clause 5.1.2a).

4\> else:

5\> perform the Random Access Resource selection procedure for 2-step RA
type Random Access (see clause 5.1.2a) after the backoff time.

Upon receiving a fallbackRAR, the MAC entity may stop
*msgB-ResponseWindow* once the Random Access Response reception is
considered as successful.

\[TS 38.321, clause 5.1.5\]

Once Msg3 is transmitted the MAC entity shall:

1\> start the *ra-ContentionResolutionTimer* and restart the
*ra-ContentionResolutionTimer* at each HARQ retransmission in the first
symbol after the end of the Msg3 transmission;

1\> monitor the PDCCH while the *ra-ContentionResolutionTimer* is
running regardless of the possible occurrence of a measurement gap;

1\> if notification of a reception of a PDCCH transmission of the SpCell
is received from lower layers:

2\> if the C-RNTI MAC CE was included in Msg3:

3\> if the Random Access procedure was initiated for SpCell beam failure
recovery (as specified in clause 5.17) and the PDCCH transmission is
addressed to the C-RNTI; or

3\> if the Random Access procedure was initiated by a PDCCH order and
the PDCCH transmission is addressed to the C-RNTI; or

3\> if the Random Access procedure was initiated by the MAC sublayer
itself or by the RRC sublayer and the PDCCH transmission is addressed to
the C-RNTI and contains a UL grant for a new transmission:

4\> consider this Contention Resolution successful;

4\> stop *ra-ContentionResolutionTimer*;

4\> discard the *TEMPORARY\_C-RNTI*;

4\> consider this Random Access procedure successfully completed.

2\> else if the CCCH SDU was included in Msg3 and the PDCCH transmission
is addressed to its *TEMPORARY\_C-RNTI*:

3\> if the MAC PDU is successfully decoded:

4\> stop *ra-ContentionResolutionTimer*;

4\> if the MAC PDU contains a UE Contention Resolution Identity MAC CE;
and

4\> if the UE Contention Resolution Identity in the MAC CE matches the
CCCH SDU transmitted in Msg3:

5\> consider this Contention Resolution successful and finish the
disassembly and demultiplexing of the MAC PDU;

5\> if this Random Access procedure was initiated for SI request:

6\> indicate the reception of an acknowledgement for SI request to upper
layers.

5\> else:

6\> set the C-RNTI to the value of the *TEMPORARY\_C-RNTI*;

5\> discard the *TEMPORARY\_C-RNTI*;

5\> consider this Random Access procedure successfully completed.

4\> else:

5\> discard the *TEMPORARY\_C-RNTI*;

5\> consider this Contention Resolution not successful and discard the
successfully decoded MAC PDU.

1\> if *ra-ContentionResolutionTimer* expires:

2\> discard the *TEMPORARY\_C-RNTI*;

2\> consider the Contention Resolution not successful.

1\> if the Contention Resolution is considered not successful:

2\> flush the HARQ buffer used for transmission of the MAC PDU in the
Msg3 buffer;

2\> increment *PREAMBLE\_TRANSMISSION\_COUNTER* by 1;

2\> if *PREAMBLE\_TRANSMISSION\_COUNTER* = *preambleTransMax* + 1:

3\> indicate a Random Access problem to upper layers.

3\> if this Random Access procedure was triggered for SI request:

4\> consider the Random Access procedure unsuccessfully completed.

2\> if the Random Access procedure is not completed:

3\> if the *RA\_TYPE* is set to *4-stepRA*:

4\> select a random backoff time according to a uniform distribution
between 0 and the *PREAMBLE\_BACKOFF*;

4\> if the criteria (as defined in clause 5.1.2) to select
contention-free Random Access Resources is met during the backoff time:

5\> perform the Random Access Resource selection procedure (see clause
5.1.2);

4\> else:

5\> perform the Random Access Resource selection procedure (see clause
5.1.2) after the backoff time.

3\> else (i.e. the *RA\_TYPE* is set to *2-stepRA*):

4\> if *msgA-TransMax* is applied (see clause 5.1.1a) and
*PREAMBLE\_TRANSMISSION\_COUNTER* = *msgA-TransMax* + 1:

5\> set the *RA\_TYPE* to *4-stepRA*;

5\> perform initialization of variables specific to Random Access type
as specified in clause 5.1.1a;

5\> flush HARQ buffer used for the transmission of MAC PDU in the MSGA
buffer;

5\> discard explicitly signalled contention-free 2-step RA type Random
Access Resources, if any;

5\> perform the Random Access Resource selection as specified in clause
5.1.2.

4\> else:

5\> select a random backoff time according to a uniform distribution
between 0 and the *PREAMBLE\_BACKOFF*;

5\> if the criteria (as defined in clause 5.1.2a) to select
contention-free Random Access Resources is met during the backoff time:

6\> perform the Random Access Resource selection procedure for 2-step RA
type as specified in clause 5.1.2a.

5\> else:

6\> perform the Random Access Resource selection for 2-step RA type
procedure (see clause 5.1.2a) after the backoff time.

\[TS 38.321, clause 5.2\]

RRC configures the following parameters for the maintenance of UL time
alignment:

\- *timeAlignmentTimer* (per TAG) which controls how long the MAC entity
considers the Serving Cells belonging to the associated TAG to be uplink
time aligned.

The MAC entity shall:

1\> when a Timing Advance Command MAC CE is received, and if an N~TA~
(as defined in TS 38.211 \[8\]) has been maintained with the indicated
TAG:

2\> apply the Timing Advance Command for the indicated TAG;

2\> start or restart the *timeAlignmentTimer* associated with the
indicated TAG.

1\> when a Timing Advance Command is received in a Random Access
Response message for a Serving Cell belonging to a TAG or in a MSGB for
an SpCell:

2\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble:

3\> apply the Timing Advance Command for this TAG;

3\> start or restart the *timeAlignmentTimer* associated with this TAG.

2\> else if the *timeAlignmentTimer* associated with this TAG is not
running:

3\> apply the Timing Advance Command for this TAG;

3\> start the *timeAlignmentTimer* associated with this TAG;

3\> when the Contention Resolution is considered not successful as
described in clause 5.1.5; or

3\> when the Contention Resolution is considered successful for SI
request as described in clause 5.1.5, after transmitting HARQ feedback
for MAC PDU including UE Contention Resolution Identity MAC CE:

4\> stop *timeAlignmentTimer* associated with this TAG.

2\> else:

3\> ignore the received Timing Advance Command.

1\> when an Absolute Timing Advance Command is received in response to a
MSGA transmission including C-RNTI MAC CE as specified in clause 5.1.4a:

2\> apply the Timing Advance Command for PTAG;

2\> start or restart the *timeAlignmentTimer* associated with PTAG.

1\> when a *timeAlignmentTimer* expires:

2\> if the *timeAlignmentTimer* is associated with the PTAG:

3\> flush all HARQ buffers for all Serving Cells;

3\> notify RRC to release PUCCH for all Serving Cells, if configured;

3\> notify RRC to release SRS for all Serving Cells, if configured;

3\> clear any configured downlink assignments and configured uplink
grants;

3\> clear any PUSCH resource for semi-persistent CSI reporting;

3\> consider all running *timeAlignmentTimer*s as expired;

3\> maintain N~TA~ (defined in TS 38.211 \[8\]) of all TAGs.

2\> else if the *timeAlignmentTimer* is associated with an STAG, then
for all Serving Cells belonging to this TAG:

3\> flush all HARQ buffers;

3\> notify RRC to release PUCCH, if configured;

3\> notify RRC to release SRS, if configured;

3\> clear any configured downlink assignments and configured uplink
grants;

3\> clear any PUSCH resource for semi-persistent CSI reporting;

3\> maintain N~TA~ (defined in TS 38.211 \[8\]) of this TAG.

When the MAC entity stops uplink transmissions for an SCell due to the
fact that the maximum uplink transmission timing difference between TAGs
of the MAC entity or the maximum uplink transmission timing difference
between TAGs of any MAC entity of the UE is exceeded, the MAC entity
considers the *timeAlignmentTimer* associated with the SCell as expired.

The MAC entity shall not perform any uplink transmission on a Serving
Cell except the Random Access Preamble and MSGA transmission when the
*timeAlignmentTimer* associated with the TAG to which this Serving Cell
belongs is not running. Furthermore, when the *timeAlignmentTimer*
associated with the PTAG is not running, the MAC entity shall not
perform any uplink transmission on any Serving Cell except the Random
Access Preamble and MSGA transmission on the SpCell.

##### 7.1.1.1.9.3 Test description {#test-description-8 .H6}

##### 7.1.1.1.9.3.1 Pre-test conditions {#pre-test-conditions-8 .H6}

##### Same Pre-test conditions as in clause 7.1.1.0. {#same-pre-test-conditions-as-in-clause-7.1.1.0.-1 .H6}

##### 7.1.1.1.9.3.2 Test procedure sequence {#test-procedure-sequence-7 .H6}

Table 7.1.1.1.9.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Step 1 is |           |           |         |    |
|           | performed |           |           |         |    |
|           | IF        |           |           |         |    |
|           | pc\_NG    |           |           |         |    |
|           | \_RAN\_NR |           |           |         |    |
|           | only.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \-        | \-        | \-      | \- |
|           | transmits |           |           |         |    |
|           | an        |           |           |         |    |
|           | updated   |           |           |         |    |
|           | system    |           |           |         |    |
|           | in        |           |           |         |    |
|           | formation |           |           |         |    |
|           | as        |           |           |         |    |
|           | specified |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.1   |           |           |         |    |
|           | .9.3.3-2. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | SS        | \<\--     | (R        | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an        |           | guration) |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | *c        |           |           |         |    |
|           | onfigure* |           |           |         |    |
|           | 2-Step    |           |           |         |    |
|           | and RA    |           |           |         |    |
|           | type      |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Re        |           |           |         |    |
|           | sources*. |           |           |         |    |
|           | (Note 1)* |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | RRCRecon  |           | gurationC |         |    |
|           | figuratio |           | omplete)* |         |    |
|           | nComplete |           |           |         |    |
|           | message.  |           |           |         |    |
|           | *(Note    |           |           |         |    |
|           | 2)*       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (Timing   |         |    |
|           | Timing    |           | Advance   |         |    |
|           | Advance   |           |           |         |    |
|           | command   |           | Command   |         |    |
|           | to        |           | MAC CE)   |         |    |
|           | SpCell.   |           |           |         |    |
|           | SS does   |           |           |         |    |
|           | not send  |           |           |         |    |
|           | any       |           |           |         |    |
|           | s         |           |           |         |    |
|           | ubsequent |           |           |         |    |
|           | timing    |           |           |         |    |
|           | al        |           |           |         |    |
|           | ignments. |           |           |         |    |
|           | Start     |           |           |         |    |
|           | Timer\_T1 |           |           |         |    |
|           | = Time    |           |           |         |    |
|           | Alignment |           |           |         |    |
|           | timer     |           |           |         |    |
|           | value on  |           |           |         |    |
|           | SS.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | 40 to 50  | \<\--     | MAC PDU   | \-      | \- |
|           | TTI       |           |           |         |    |
|           | before    |           |           |         |    |
|           | Timer\_T1 |           |           |         |    |
|           | expires   |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a PDCP    |           |           |         |    |
|           | SDU of    |           |           |         |    |
|           | size 56   |           |           |         |    |
|           | bits,     |           |           |         |    |
|           | less than |           |           |         |    |
|           | *r        |           |           |         |    |
|           | a-MsgA-Si |           |           |         |    |
|           | zeGroupA* |           |           |         |    |
|           | (208      |           |           |         |    |
|           | bits) on  |           |           |         |    |
|           | SpCell.   |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The SS    | \-        | \-        | \-      | \- |
|           | ignores   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | requests  |           |           |         |    |
|           | and does  |           |           |         |    |
|           | not       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | any       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           | (         |         |    |
|           | UE        |           | including |         |    |
|           | transmit  |           | C-RNTI    |         |    |
|           | MSGA      |           | MAC CE)   |         |    |
|           | using     |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | in group  |           |           |         |    |
|           | A?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | Does the  |           | (         |         |    |
|           | UE        |           | including |         |    |
|           | re        |           | C-RNTI    |         |    |
|           | -transmit |           | MAC CE)   |         |    |
|           | MSGA      |           |           |         |    |
|           | using a   |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | in the    |           |           |         |    |
|           | same      |           |           |         |    |
|           | group A   |           |           |         |    |
|           | after     |           |           |         |    |
|           | expiry of |           |           |         |    |
|           | *msg      |           |           |         |    |
|           | B-Respons |           |           |         |    |
|           | eWindow*? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | The SS    | \<\--     | MAC       | \-      | \- |
|           | transmits |           | PDU(BI,   |         |    |
|           | a MSGB    |           | RAPID)    |         |    |
|           | with the  |           |           |         |    |
|           | Backoff   |           |           |         |    |
|           | parameter |           |           |         |    |
|           | set to    |           |           |         |    |
|           | value     |           |           |         |    |
|           | Index     |           |           |         |    |
|           | field     |           |           |         |    |
|           | \'12\'    |           |           |         |    |
|           | and with  |           |           |         |    |
|           | the RAPID |           |           |         |    |
|           | different |           |           |         |    |
|           | from the  |           |           |         |    |
|           | value     |           |           |         |    |
|           | received  |           |           |         |    |
|           | from the  |           |           |         |    |
|           | UE.       |           |           |         |    |
|           |           |           |           |         |    |
|           | The SS    |           |           |         |    |
|           | sets      |           |           |         |    |
|           | Timer\_T2 |           |           |         |    |
|           | to the    |           |           |         |    |
|           | Backoff   |           |           |         |    |
|           | value     |           |           |         |    |
|           | '960'     |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssociated |           |           |         |    |
|           | with the  |           |           |         |    |
|           | Index     |           |           |         |    |
|           | value     |           |           |         |    |
|           | '12' and  |           |           |         |    |
|           | starts    |           |           |         |    |
|           | T         |           |           |         |    |
|           | imer\_T2. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | Check:    | \--\>     | MAC PDU   | 3       | P  |
|           | Does UE   |           | (         |         |    |
|           | transmit  |           | including |         |    |
|           | MSGA      |           | C-RNTI    |         |    |
|           | using     |           | MAC CE)   |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | in group  |           |           |         |    |
|           | A while   |           |           |         |    |
|           | Timer\_T2 |           |           |         |    |
|           | is        |           |           |         |    |
|           | running?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | The SS    | \<\--     | MAC       | \-      | \- |
|           | schedules |           | PDU       |         |    |
|           | PDCCH     |           | (Absolute |         |    |
|           | tra       |           | Timing    |         |    |
|           | nsmission |           | Advance   |         |    |
|           | for UE    |           | Command   |         |    |
|           | C\_RNTI   |           | MAC CE)   |         |    |
|           | and DL    |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Absolute  |           |           |         |    |
|           | Timing    |           |           |         |    |
|           | Advance   |           |           |         |    |
|           | Command   |           |           |         |    |
|           | MAC CE.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (Timing   |         |    |
|           | Timing    |           | Advance   |         |    |
|           | Advance   |           |           |         |    |
|           | command   |           | Command   |         |    |
|           | to        |           | MAC CE)   |         |    |
|           | SpCell.   |           |           |         |    |
|           | SS does   |           |           |         |    |
|           | not send  |           |           |         |    |
|           | any       |           |           |         |    |
|           | s         |           |           |         |    |
|           | ubsequent |           |           |         |    |
|           | timing    |           |           |         |    |
|           | al        |           |           |         |    |
|           | ignments. |           |           |         |    |
|           | Start     |           |           |         |    |
|           | Timer\_T3 |           |           |         |    |
|           | = Time    |           |           |         |    |
|           | Alignment |           |           |         |    |
|           | timer     |           |           |         |    |
|           | value on  |           |           |         |    |
|           | SS.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | 40 to 50  | \<\--     | MAC PDU   | \-      | \- |
|           | TTI       |           |           |         |    |
|           | before    |           |           |         |    |
|           | Timer\_T3 |           |           |         |    |
|           | expires   |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a PDCP    |           |           |         |    |
|           | SDU of    |           |           |         |    |
|           | size 256  |           |           |         |    |
|           | bits,     |           |           |         |    |
|           | more than |           |           |         |    |
|           | *r        |           |           |         |    |
|           | a-MsgA-Si |           |           |         |    |
|           | zeGroupA* |           |           |         |    |
|           | (208      |           |           |         |    |
|           | bits) on  |           |           |         |    |
|           | SpCell.   |           |           |         |    |
|           | (Note 4)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | The SS    | \-        | \-        | \-      | \- |
|           | ignores   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | requests  |           |           |         |    |
|           | and does  |           |           |         |    |
|           | not       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | any       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | Check:    | \--\>     | MAC PDU   | 4       | P  |
|           | Does the  |           | (         |         |    |
|           | UE        |           | including |         |    |
|           | transmit  |           | C-RNTI    |         |    |
|           | MSGA      |           | MAC CE)   |         |    |
|           | using     |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | in group  |           |           |         |    |
|           | B?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 16        | SS        | \<\--     | MAC       | \-      | \- |
|           | schedules |           | P         |         |    |
|           | PDCCH     |           | DU(Timing |         |    |
|           | tra       |           | Advance   |         |    |
|           | nsmission |           |           |         |    |
|           | for UE    |           | Command   |         |    |
|           | C\_RNTI   |           | MAC CE)   |         |    |
|           | and DL    |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | Timing    |           |           |         |    |
|           | Advance   |           |           |         |    |
|           | Command   |           |           |         |    |
|           | MAC CE.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17        | The SS is | \-        | \-        | \-      | \- |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | to        |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | normal    |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 18        | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a PDCP    |           |           |         |    |
|           | SDU.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19        | Check:    | \--\>     | MAC PDU   | 5       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back PDCP |           |           |         |    |
|           | SDU using |           |           |         |    |
|           | the new   |           |           |         |    |
|           | Timing    |           |           |         |    |
|           | Advance   |           |           |         |    |
|           | value?    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *R        |           |           |           |         |    |
| RCReconfi |           |           |           |         |    |
| guration* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RRC      |           |           |           |         |    |
| Connectio |           |           |           |         |    |
| nReconfig |           |           |           |         |    |
| uration.* |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| MAC PDU   |           |           |           |         |    |
| size of   |           |           |           |         |    |
| 56bits is |           |           |           |         |    |
| selected  |           |           |           |         |    |
| to allow  |           |           |           |         |    |
| UE send   |           |           |           |         |    |
| status    |           |           |           |         |    |
| PDU and   |           |           |           |         |    |
| stays     |           |           |           |         |    |
| below the |           |           |           |         |    |
| limit of  |           |           |           |         |    |
| r         |           |           |           |         |    |
| a-MsgA-Si |           |           |           |         |    |
| zeGroupA. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 4:   |           |           |           |         |    |
| MAC PDU   |           |           |           |         |    |
| size of   |           |           |           |         |    |
| 256bits   |           |           |           |         |    |
| is        |           |           |           |         |    |
| selected  |           |           |           |         |    |
| to allow  |           |           |           |         |    |
| UE send   |           |           |           |         |    |
| status    |           |           |           |         |    |
| PDU and   |           |           |           |         |    |
| stays     |           |           |           |         |    |
| above the |           |           |           |         |    |
| limit of  |           |           |           |         |    |
| r         |           |           |           |         |    |
| a-MsgA-Si |           |           |           |         |    |
| zeGroupA. |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.1.9.3.3 Specific message contents {#specific-message-contents-8 .H6}

Table 7.1.1.1.9.3.3-1: *MAC-CellGroupConfig* (preamble)

  ------------------------------------------------------------ -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-68                                    
  Information Element                                          Value/remark   Comment   Condition
  MAC-CellGroupConfig ::= SEQUENCE {                                                    
  tag-Config SEQUENCE {                                                                 
  tag-ToAddModList SEQUENCE (SIZE (1..maxNrofTAGs)) OF TAG {   1 entry                  
  TAG\[1\] SEQUENCE {                                                         entry 1   
  timeAlignmentTimer                                           ms750                    
  }                                                                                     
  }                                                                                     
  }                                                                                     
  }                                                                                     
  ------------------------------------------------------------ -------------- --------- -----------

Table 7.1.1.1.9.3.3-2: *SIB1* (step 1, Table 7.1.1.1.9.3.2-1)

  --------------------------------------------------- ------------------------- --------- -----------
  Derivation path: TS 38.508-1 \[4\] Table 4.6.1-28                                       
  Information Element                                 Value/Remark              Comment   Condition
  SIB1 ::= SEQUENCE {                                                                     
  servingCellConfigCommon                             ServingCellConfigCommon             
  }                                                                                       
  --------------------------------------------------- ------------------------- --------- -----------

Table 7.1.1.1.9.3.3-3: *ServingCellConfigCommon (*Table 7.1.1.1.9.3.3-2)

  ----------------------------------------------------- ------------------ --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                
  Information Element                                   Value/remark       Comment   Condition
  ServingCellConfigCommon ::= SEQUENCE {                                             
  uplinkConfigCommon SEQUENCE {                                                      
  initialUplinkBWP                                      BWP-UplinkCommon             
  }                                                                                  
  }                                                                                  
  ----------------------------------------------------- ------------------ --------- -----------

Table 7.1.1.1.9.3.3-4: *BWP-UplinkCommon* (Table 7.1.1.1.9.3.3-3)

  ---------------------------------------------------- ----------------------- ------------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-14                                         
  **Information Element**                              **Value/remark**        **Comment**   **Condition**
  BWP-UplinkCommon ::= SEQUENCE {                                                            
  msgA-ConfigCommon-r16 CHOICE {                                                             
  setup                                                MsgA-ConfigCommon-r16                 
  }                                                                                          
  }                                                                                          
  ---------------------------------------------------- ----------------------- ------------- ---------------

Table 7.1.1.1.9.3.3-5: *MsgA-ConfigCommon-r16* (Table 7.1.1.1.9.3.3-4)

  ----------------------------------------------------- -------------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-81A                                              
  Information Element                                   Value/remark                     Comment   Condition
  MsgA-ConfigCommon-r16 :: = SEQUENCE {                                                            
  rach-ConfigCommonTwoStepRA-r16                        RACH-ConfigCommonTwoStepRA-r16             
  msgA-PUSCH-Config-r16                                 MsgA-PUSCH-Config-r16                      
  }                                                                                                
  ----------------------------------------------------- -------------------------------- --------- -----------

Table 7.1.1.1.9.3.3-6: *RACH-ConfigCommonTwoStepRA-r16* (Table
7.1.1.1.9.3.3-5)

  ------------------------------------------------------------- --------------------------------- ------------------------------------ -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128A                                                                                 
  Information Element                                           Value/remark                      Comment                              Condition
  RACH-ConfigCommonTwoStepRA-r16 ::= SEQUENCE {                                                                                        
  rach-ConfigGenericTwoStepRA-r16                               RACH-ConfigGenericTwoStepRA-r16                                        
  msgA-TotalNumberOfRA-Preambles-r16                            16                                                                     
  msgA-SSB-PerRACH-OccasionAndCB-PreamblesPerSSB-r16 CHOICE {                                                                          
  two                                                           n4                                                                     
  }                                                                                                                                    
  groupB-ConfiguredTwoStepRA-r16                                GroupB-ConfiguredTwoStepRA-r16                                         
  msgA-PRACH-RootSequenceIndex-r16 CHOICE {                                                                                            
  l839                                                          100                                                                    
  }                                                                                                                                    
  msgA-TransMax-r16                                             n4                                                                     
  msgA-RSRP-ThresholdSSB-r16                                    56                                                                     
  msgA-RestrictedSetConfig-r16                                  unrestrictedSet                                                        
  ra-PrioritizationForAccessIdentityTwoStep-r16 SEQUENCE {                                                                             
  ra-Prioritization-r16                                         RA-Prioritization                 TS 38.508-1 \[4\], Table 4.6.3-131   
  ra-PrioritizationForAI-r16                                    '00'B                                                                  
  }                                                                                                                                    
  ra-ContentionResolutionTimer-r16                              sf32                                                                   
  }                                                                                                                                    
  ------------------------------------------------------------- --------------------------------- ------------------------------------ -----------

Table 7.1.1.1.9.3.3-7: *RACH-ConfigGenericTwoStepRA-r16* (Table
7.1.1.1.9.3.3-6)

  ------------------------------------------------------ -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-130A                            
  Information Element                                    Value/remark   Comment   Condition
  RACH-ConfigGenericTwoStepRA-r16 ::= SEQUENCE {                                  
  msgA-PRACH-ConfigurationIndex-r16                      0                        
                                                         1                        HD\_FDD
  msgA-RO-FDM-r16                                        one                      
  msgA-RO-FrequencyStart-r16                             0                        
  msgA-ZeroCorrelationZoneConfig-r16                     0                        
  msgA-PreamblePowerRampingStep-r16                      dB2                      
  msgA-PreambleReceivedTargetPower-r16                   -200                     
  msgB-ResponseWindow-r16                                sl80                     
  preambleTransMax-r16                                   n4                       
  }                                                                               
  ------------------------------------------------------ -------------- --------- -----------

  Condition   Explanation
  ----------- ----------------------------------------------------------------------------------------
  HD\_FDD     pc\_halfDuplexFDD\_TypeA\_RedCap\_r17 (i.e HD\_FDD UE are performing test on FDD band)

Table 7.1.1.1.9.3.3-8: *GroupB-ConfiguredTwoStepRA-r16* (Table
7.1.1.1.9.3.3-6)

  ------------------------------------------------ --------------- --------- -----------
  Derivation Path: TS 38.331 \[6\], clause 6.3.2                             
  Information Element                              Value/remark    Comment   Condition
  GroupB-ConfiguredTwoStepRA-r16 ::= SEQUENCE {                              
  ra-MsgA-SizeGroupA                               b208                      
  messagePowerOffsetGroupB                         minusinfinity             
  numberOfRA-PreamblesGroupA                       8                         
  }                                                                          
  ------------------------------------------------ --------------- --------- -----------

Table 7.1.1.1.9.3.3-9: *MsgA-PUSCH-Config-r16* (Table 7.1.1.1.9.3.3-5)

  ----------------------------------------------------- ------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-81B                                       
  Information Element                                   Value/remark              Comment   Condition
  MsgA-PUSCH-Config-r16 ::= SEQUENCE {                                                      
  msgA-PUSCH-ResourceGroupA-r16                         MsgA-PUSCH-Resource-r16             
  msgA-PUSCH-ResourceGroupB-r16                         MsgA-PUSCH-Resource-r16             
  }                                                                                         
  ----------------------------------------------------- ------------------------- --------- -----------

Table 7.1.1.1.9.3.3-10: *MsgA-PUSCH-Resource-r16* (Table
7.1.1.1.9.3.3-9)

  ------------------------------------------------ ---------------------- --------- -----------
  Derivation Path: TS 38.331 \[6\] ,clause 6.3.2                                    
  Information Element                              Value/remark           Comment   Condition
  MsgA-PUSCH-Resource-r16 ::= SEQUENCE {                                            
  msgA-MCS-r16                                     0                                
  nrofSlotsMsgA-PUSCH-r16                          1                                
  nrofMsgA-PO-PerSlot-r16                          one                              
  msgA-PUSCH-TimeDomainOffset-r16                  1                                
  guardBandMsgA-PUSCH-r16                          0                                
  frequencyStartMsgA-PUSCH-r16                     0                                
  nrofPRBs-PerMsgA-PO-r16                          24                               
  nrofMsgA-PO-FDM-r16                              one                              
  msgA-DMRS-Config-r16                             MsgA-DMRS-Config-r16             
  nrofDMRS-Sequences-r16                           1                                
  }                                                                                 
  ------------------------------------------------ ---------------------- --------- -----------

Table 7.1.1.1.9.3.3-11: *MsgA-DMRS-Config-r16* (Table 7.1.1.1.9.3.3-10)

  ------------------------------------------------ -------------- --------- -----------
  Derivation Path: TS 38.331 \[6\], clause 6.3.2                            
  Information Element                              Value/remark   Comment   Condition
  MsgA-DMRS-Config-r16 ::= SEQUENCE {                                       
  msgA-DMRS-AdditionalPosition-r16                 pos0                     
  msgA-MaxLength-r16                               len2                     
  }                                                                         
  ------------------------------------------------ -------------- --------- -----------

Table 7.1.1.1.9.3.3-12: *RRCReconfiguration* (step 2, Table
7.1.1.1.9.3.2-1)

  ---------------------------------------------------- ----------------- ------------------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                                                                 
  Information Element                                  Value/remark      Comment                                     Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                  
  criticalExtensions CHOICE {                                                                                        
  rrcReconfiguration SEQUENCE {                                                                                      
  secondaryCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   EN-DC
  nonCriticalExtension SEQUENCE {                                                                                    NR
  masterCellGroup                                      CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  ---------------------------------------------------- ----------------- ------------------------------------------- -----------

Table 7.1.1.1.9.3.3-13: *CellGroupConfig (*Table 7.1.1.1.9.3.3-12)

  ---------------------------------------------------- ------------------------- ------------------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19                                                                         
  Information Element                                  Value/remark              Comment                                     Condition
  CellGroupConfig ::= SEQUENCE {                                                                                             
  spCellConfig SEQUENCE {                                                                                                    
  reconfigurationWithSync SEQUENCE {                                                                                         
  spCellConfigCommon                                   ServingCellConfigCommon   Same contents as in Table 7.1.1.1.9.3.3-3   
  newUE-Identity                                       RNTI-Value                                                            
  t304                                                 ms2000                                                                
  rach-ConfigDedicated                                 Not present                                                           
  }                                                                                                                          
  }                                                                                                                          
  }                                                                                                                          
  ---------------------------------------------------- ------------------------- ------------------------------------------- -----------

##### 7.1.1.1.9a Random access procedure / 2-step RACH / Successful / RRC\_IDLE

##### 7.1.1.1.9a.1 Test Purpose (TP) {#a.1-test-purpose-tp-1 .H6}

##### (1) {#section-36 .H6}

**with** { UE in RRC Idle state and 2-step RA type Random Access
resources is configured }

**ensure that** {

**when** { UE has UL CCCH PDU to send }

**then** { UE transmits a MSGA }

}

##### (2) {#section-37 .H6}

**with** { UE in RRC Idle state initiated Random Access procedure to
transmit UL CCCH PDU and transmitted MSGA }

**ensure that** {

**when** { SS does not answer with a MSGB containing a matching
successRAR within msgB-ResponseWindow }

**then** { UE retransmits a MSGA }

}

##### (3) {#section-38 .H6}

**with** { UE in RRC Idle state initiated Random Access procedure to
transmit UL CCCH PDU and transmitted MSGA }

**ensure that** {

**when** { SS answers with a MSGB containing a matching successRAR
within msgB-ResponseWindow }

**then** { UE assumes RACH procedure as complete }

}

##### 7.1.1.1.9a.2 Conformance requirements {#a.2-conformance-requirements-1 .H6}

References: The conformance requirements covered in the present TC are
specified in: 3GPP TS 38.321, clause 5.1.1, 5.1.2a, 5.1.3a and 5.1.4a.
Unless otherwise stated these are Rel-16 requirements.

\[TS 38.321, clause 5.1.1\]

1\> if the Random Access procedure was initiated for SpCell beam failure
recovery (as specified in clause 5.17) and if the contention-free Random
Access Resources for beam failure recovery request for 4-step RA type
have been explicitly provided by RRC for the BWP selected for Random
Access procedure; or

...

1\> if *RA\_TYPE* is set to *2-stepRA*:

2\> perform the Random Access Resource selection procedure for 2-step RA
type (see clause 5.1.2a).

1\> else:

2\> perform the Random Access Resource selection procedure (see clause
5.1.2).

\[TS 38.321, clause 5.1.2a\]

If the selected *RA\_TYPE* is set to *2-stepRA*, the MAC entity shall:

1\> if the contention-free 2-step RA type Resources associated with SSBs
have been explicitly provided in *rach-ConfigDedicated* and at least one
SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB* amongst the associated
SSBs is available:

2\> select an SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB* amongst
the associated SSBs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB.

...

1\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

2\> select a PUSCH occasion from the PUSCH occasions configured in
*msgA-CFRA-PUSCH* corresponding to the PRACH slot of the selected PRACH
occasion, according to *msgA-PUSCH-resource-Index* corresponding to the
selected SSB;

2\> determine the UL grant and the associated HARQ information for the
MSGA payload in the selected PUSCH occasion;

2\> deliver the UL grant and the associated HARQ information to the HARQ
entity.

1\> else:

2\> select a PUSCH occasion corresponding to the selected preamble and
PRACH occasion according to clause 8.1A of TS 38.213 \[6\];

2\> determine the UL grant for the MSGA payload according to the PUSCH
configuration associated with the selected Random Access Preambles group
and determine the associated HARQ information;

2\> if the selected preamble and PRACH occasion is mapped to a valid
PUSCH occasion as specified in clause 8.1A of TS 38.213 \[6\]:

3\> deliver the UL grant and the associated HARQ information to the HARQ
entity.

1\> perform the MSGA transmission procedure (see clause 5.1.3a).

NOTE: To determine if there is an SSB with *SS-RSRP* above
*msgA-RSRP-ThresholdSSB*, the UE uses the latest unfiltered *L1-RSRP*
measurement.

\[TS 38.321, clause 5.1.3a\]

The MAC entity shall, for each MSGA:

1\> if *PREAMBLE\_TRANSMISSION\_COUNTER* is greater than one; and

1\> if the notification of suspending power ramping counter has not been
received from lower layers; and

1\> if LBT failure indication was not received from lower layers for the
last MSGA Random Access Preamble transmission; and

1\> if SSB selected is not changed from the selection in the last Random
Access Preamble transmission:

2\> increment *PREAMBLE\_POWER\_RAMPING\_COUNTER* by 1.

1\> select the value of *DELTA\_PREAMBLE* according to clause 7.3;

1\> set *PREAMBLE\_RECEIVED\_TARGET\_POWER* to
*msgA-PreambleReceivedTargetPower* + *DELTA\_PREAMBLE* +
(*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*;

1\> if this is the first MSGA transmission within this Random Access
procedure:

2\> if the transmission is not being made for the CCCH logical channel:

3\> indicate to the Multiplexing and assembly entity to include a C-RNTI
MAC CE in the subsequent uplink transmission.

2\> if the Random Access procedure was initiated for SpCell beam failure
recovery and *spCell-BFR-CBRA* with value *true* is configured:

3\> indicate to the Multiplexing and assembly entity to include a BFR
MAC CE or a Truncated BFR MAC CE in the subsequent uplink transmission.

2\> obtain the MAC PDU to transmit from the Multiplexing and assembly
entity according to the HARQ information determined for the MSGA payload
(see clause 5.1.2a) and store it in the MSGA buffer.

1\> compute the MSGB-RNTI associated with the PRACH occasion in which
the Random Access Preamble is transmitted;

1\> instruct the physical layer to transmit the MSGA using the selected
PRACH occasion and the associated PUSCH resource of MSGA (if the
selected preamble and PRACH occasion is mapped to a valid PUSCH
occasion), using the corresponding RA-RNTI, MSGB-RNTI,
*PREAMBLE\_INDEX*, *PREAMBLE\_RECEIVED\_TARGET\_POWER,
msgA-PreambleReceivedTargetPower,* and the amount of power ramping
applied to the latest MSGA preamble transmission (i.e.
(*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*);

\[TS 38.321, clause 5.1.4a\]

Once the MSGA preamble is transmitted, regardless of the possible
occurrence of a measurement gap, the MAC entity shall:

1\> start the *msgB-ResponseWindow* at the PDCCH occasion as specified
in TS 38.213 \[6\], clause 8.2A;

1\> monitor the PDCCH of the SpCell for a Random Access Response
identified by MSGB-RNTI while the *msgB-ResponseWindow* is running;

*...*

3\> else if the MSGB contains a successRAR MAC subPDU; and

3\> if the CCCH SDU was included in the MSGA and the UE Contention
Resolution Identity in the MAC subPDU matches the CCCH SDU:

4\> stop *msgB-ResponseWindow*;

4\> if this Random Access procedure was initiated for SI request:

5\> indicate the reception of an acknowledgement for SI request to upper
layers.

4\> else:

5\> set the C-RNTI to the value received in the *successRAR;*

5\> apply the following actions for the SpCell:

6\> process the received Timing Advance Command (see clause 5.2);

6\> indicate the *msgA-PreambleReceivedTargetPower* and the amount of
power ramping applied to the latest Random Access Preamble transmission
to lower layers (i.e. (*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*).

4\> deliver the *TPC*, *PUCCH resource Indicator, ChannelAccess-CPext*
(if indicated), and *HARQ feedback Timing Indicator* received in
successRAR to lower layers.

4\> consider this Random Access Response reception successful;

4\> consider this Random Access procedure successfully completed;

4\> finish the disassembly and demultiplexing of the MAC PDU.

...

Upon receiving a fallbackRAR, the MAC entity may stop
*msgB-ResponseWindow* once the Random Access Response reception is
considered as successful.

##### 7.1.1.1.9a.3 Test description {#a.3-test-description-1 .H6}

##### 7.1.1.1.9a.3.1 Pre-test conditions {#a.3.1-pre-test-conditions-1 .H6}

##### System Simulator: {#system-simulator-1 .H6}

\- The SS configures the test environment in accordance to the execution
conditions in Table 7.1.1.0-1.

##### UE: {#ue-1 .H6}

\- None

##### Preamble: {#preamble-1 .H6}

\- The UE is in NR RRC\_Idle mode (state 1N-A) on NR Cell 1 according to
38.508-1 \[4\] Table 4.4A.2-1.

##### 7.1.1.1.9a.3.2 Test procedure sequence {#a.3.2-test-procedure-sequence-1 .H6}

Table 7.1.1.1.9a.3.2-1: Main behaviour

  St   Procedure                                                                                                                 Message Sequence   TP                                Verdict   
  ---- ------------------------------------------------------------------------------------------------------------------------- ------------------ --------------------------------- --------- ----
                                                                                                                                 U - S              Message                                     
  1    The SS transmits a Paging message including a matched UE identity.                                                        \<\--              *Paging*                          \-        \-
  2    Check: Does the UE transmit MSGA?                                                                                         \--\>              MAC PDU (*RRCSetupRequest*)       1         P
  3    Check: Does the UE re-transmit MSGA after expiry of *msgB-ResponseWindow*?                                                \--\>              MAC PDU (*RRCSetupRequest*)       2         P
  4    The SS transmits a MSGB including a successRAR MAC subPDU containing matching Contention Resolution Identity .            \<\--              MAC PDU(successRAR, *RRCSetup*)   \-        \-
  5    Check: Does UE transmit a MAC PDU containing an *RRCSetupComplete* message indicating acceptance of *RRCSetup* message?   \--\>              MAC PDU (*RRCSetupComplete)*      3         P

##### 7.1.1.1.9a.3.3 Specific message contents {#a.3.3-specific-message-contents-1 .H6}

Table 7.1.1.1.9a.3.3-1: *SIB1 (*Preamble, Table 7.1.1.1.9a.3.2-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-28                                
  ---------------------------------------------------- ------------------ --------- -----------
  Information Element                                  Value/remark       Comment   Condition
  SIB1 ::= SEQUENCE {                                                               
  servingCellConfigCommon SEQUENCE {                                                
  uplinkConfigCommon SEQUENCE {                                                     
  initialUplinkBWP                                     BWP-UplinkCommon             
  }                                                                                 
  }                                                                                 
  }                                                                                 

Table 7.1.1.1.9a.3.3-2: *BWP-UplinkCommon (*Table 7.1.1.1.9a.3.3-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-10                                 
  ---------------------------------------------------- ------------------- --------- -----------
  Information Element                                  Value/remark        Comment   Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                    
  msgA-ConfigCommon-r16 CHOICE {                                                     
  setup                                                MsgA-ConfigCommon             
  }                                                                                  
  }                                                                                  

Table 7.1.1.1.9a.3.3-3: *MsgA-ConfigCommon (*Table 7.1.1.1.9a.3.3-2)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-81A                                          
  ----------------------------------------------------- ---------------------------- --------- -----------
  Information Element                                   Value/remark                 Comment   Condition
  MsgA-ConfigCommonL-r16 ::= SEQUENCE {                                                        
  rach-ConfigCommonTwoStepRA-r16                        RACH-ConfigCommonTwoStepRA             
  msgA-PUSCH-Config-r16                                 MsgA-PUSCH-Config                      
  }                                                                                            

Table 7.1.1.1.9a.3.3-4: *RACH-ConfigCommonTwoStepRA* (Table
7.1.1.1.9a.3.3-3)

  ------------------------------------------------------ --------------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128A                                               
  Information Element                                    Value/remark                      Comment   Condition
  RACH-ConfigCommonTwoStepRA-r16 ::= SEQUENCE {                                                      
  rach-ConfigGenericTwoStepRA-r16                        RACH-ConfigGenericTwoStepRA-r16             
  }                                                                                                  
  ------------------------------------------------------ --------------------------------- --------- -----------

Table 7.1.1.1.9a.3.3-5: *RACH-ConfigGenericTwoStepRA-r16* (Table
7.1.1.1.9a.3.3-4)

  ------------------------------------------------------ -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-130A                            
  Information Element                                    Value/remark   Comment   Condition
  RACH-ConfigGenericTwoStepRA-r16 ::= SEQUENCE {                                  
  msgB-ResponseWindow-r16                                sl40                     
  }                                                                               
  ------------------------------------------------------ -------------- --------- -----------

##### 7.1.1.1.10 Random access procedure / 2-step RACH/not complete/ RA\_TYPE to 4-stepRA

##### 7.1.1.1.10.1 Test Purpose (TP) {#test-purpose-tp-9 .H6}

##### (1) {#section-39 .H6}

**with** { UE in RRC\_Connected state after transmission of a MSGA on NR
SpCell }

**ensure that** {

**when** { UE does not receive a matching MSGB in msgB-ResponseWindow
and PREAMBLE\_TRANSMISSION\_COUNTER is equal to msgA-TransMax+1 }

**then** { UE triggers 4-step RACH procedure on NR SpCell }

}

##### 7.1.1.1.10.2 Conformance requirements {#conformance-requirements-9 .H6}

References: The conformance requirements covered in the current TC are
specified in: TS 38.321, clauses 5.1.1 and 5.1.4a. Unless otherwise
stated these are Rel-16 requirements.

\[TS 38.321, clause5.1.1\]

The Random Access procedure described in this clause is initiated by a
PDCCH order, by the MAC entity itself, or by RRC for the events in
accordance with TS 38.300 \[2\]. There is only one Random Access
procedure ongoing at any point in time in a MAC entity. The Random
Access procedure on an SCell shall only be initiated by a PDCCH order
with *ra-PreambleIndex* different from 0b000000.

...

1\> if the Random Access procedure is initiated by PDCCH order and if
the *ra-PreambleIndex* explicitly provided by PDCCH is not 0b000000; or

1\> if the Random Access procedure was initiated for SI request (as
specified in TS 38.331 \[5\]) and the Random Access Resources for SI
request have been explicitly provided by RRC; or

1\> if the Random Access procedure was initiated for SpCell beam failure
recovery (as specified in clause 5.17) and if the contention-free Random
Access Resources for beam failure recovery request for 4-step RA type
have been explicitly provided by RRC for the BWP selected for Random
Access procedure; or

1\> if the Random Access procedure was initiated for reconfiguration
with sync and if the contention-free Random Access Resources for 4-step
RA type have been explicitly provided in *rach-ConfigDedicated* for the
BWP selected for Random Access procedure:

2\> set the *RA\_TYPE* to *4-stepRA*.

1\> else if the BWP selected for Random Access procedure is configured
with both 2-step and 4-step RA type Random Access Resources and the RSRP
of the downlink pathloss reference is above *msgA-RSRP-Threshold*; or

1\> if the BWP selected for Random Access procedure is only configured
with 2-step RA type Random Access resources (i.e. no 4-step RACH RA type
resources configured); or

1\> if the Random Access procedure was initiated for reconfiguration
with sync and if the contention-free Random Access Resources for 2-step
RA type have been explicitly provided in *rach-ConfigDedicated* for the
BWP selected for Random Access procedure:

2\> set the *RA\_TYPE* to *2-stepRA*.

1\> else:

2\> set the *RA\_TYPE* to *4-stepRA*.

1\> perform initialization of variables specific to Random Access type
as specified in clause 5.1.1a;

1\> if *RA\_TYPE* is set to *2-stepRA*:

2\> perform the Random Access Resource selection procedure for 2-step RA
type (see clause 5.1.2a).

1\> else:

2\> perform the Random Access Resource selection procedure (see clause
5.1.2).

\[TS 38.321, clause 5.1.4a\]

Once the MSGA preamble is transmitted, regardless of the possible
occurrence of a measurement gap, the MAC entity shall:

...

1\> if *msgB-ResponseWindow* expires, and the Random Access Response
Reception has not been considered as successful based on descriptions
above:

2\> increment *PREAMBLE\_TRANSMISSION\_COUNTER* by 1;

2\> if *PREAMBLE\_TRANSMISSION\_COUNTE*R = *preambleTransMax* + 1:

3\> indicate a Random Access problem to upper layers;

3\> if this Random Access procedure was triggered for SI request:

4\> consider this Random Access procedure unsuccessfully completed.

2\> if the Random Access procedure is not completed:

3\> if *msgA-TransMax* is applied (see clause 5.1.1a) and
*PREAMBLE\_TRANSMISSION\_COUNTER* = *msgA-TransMax* + 1:

4\> set the *RA\_TYPE* to *4-stepRA*;

4\> perform initialization of variables specific to Random Access type
as specified in clause 5.1.1a;

4\> if the Msg3 buffer is empty:

5\> obtain the MAC PDU to transmit from the MSGA buffer and store it in
the Msg3 buffer;

4\> flush HARQ buffer used for the transmission of MAC PDU in the MSGA
buffer;

4\> discard explicitly signalled contention-free 2-step RA type Random
Access Resources, if any;

4\> perform the Random Access Resource selection procedure as specified
in clause 5.1.2.

3\> else:

4\> select a random backoff time according to a uniform distribution
between 0 and the *PREAMBLE\_BACKOFF*;

4\> if the criteria (as defined in clause 5.1.2a) to select
contention-free Random Access Resources is met during the backoff time:

5\> perform the Random Access Resource selection procedure for 2-step RA
type Random Access (see clause 5.1.2a).

4\> else:

5\> perform the Random Access Resource selection procedure for 2-step RA
type Random Access (see clause 5.1.2a) after the backoff time.

Upon receiving a fallbackRAR, the MAC entity may stop
*msgB-ResponseWindow* once the Random Access Response reception is
considered as successful.

##### 7.1.1.1.10.3 Test description {#test-description-9 .H6}

##### 7.1.1.1.10.3.1 Pre-test conditions {#pre-test-conditions-9 .H6}

##### Same Pre-test conditions as in clause 7.1.1.0.  {#same-pre-test-conditions-as-in-clause-7.1.1.0.-2 .H6}

##### 7.1.1.1.10.3.2 Test procedure sequence {#test-procedure-sequence-8 .H6}

Table 7.1.1.1.10.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | SS        | \<\--     | (R        | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | an        |           | guration) |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | *c        |           |           |         |    |
|           | onfigure* |           |           |         |    |
|           | both      |           |           |         |    |
|           | 2-Step    |           |           |         |    |
|           | and       |           |           |         |    |
|           | 4-Step RA |           |           |         |    |
|           | type      |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Re        |           |           |         |    |
|           | sources*. |           |           |         |    |
|           | Note 1*   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | RRCRecon  |           | gurationC |         |    |
|           | figuratio |           | omplete)* |         |    |
|           | nComplete |           |           |         |    |
|           | message.  |           |           |         |    |
|           | *Note 2*  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           | (Timing   |         |    |
|           | Timing    |           | Advance   |         |    |
|           | Advance   |           |           |         |    |
|           | command   |           | Command   |         |    |
|           | to        |           | MAC       |         |    |
|           | SpCell.   |           | Control   |         |    |
|           | SS does   |           | Element)  |         |    |
|           | not send  |           |           |         |    |
|           | any       |           |           |         |    |
|           | s         |           |           |         |    |
|           | ubsequent |           |           |         |    |
|           | timing    |           |           |         |    |
|           | al        |           |           |         |    |
|           | ignments. |           |           |         |    |
|           | Start     |           |           |         |    |
|           | Timer\_T1 |           |           |         |    |
|           | = Time    |           |           |         |    |
|           | Alignment |           |           |         |    |
|           | timer     |           |           |         |    |
|           | value on  |           |           |         |    |
|           | SS.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | 40 to 50  | \<\--     | MAC PDU   | \-      | \- |
|           | TTI       |           |           |         |    |
|           | before    |           |           |         |    |
|           | Timer\_T1 |           |           |         |    |
|           | expires   |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a PDCP    |           |           |         |    |
|           | SDU       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | The SS    | \-        | \-        | \-      | \- |
|           | ignores   |           |           |         |    |
|           | s         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | requests  |           |           |         |    |
|           | and does  |           |           |         |    |
|           | not       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | any       |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | xception: |           |           |         |    |
|           | Step 6    |           |           |         |    |
|           | will be   |           |           |         |    |
|           | repeated  |           |           |         |    |
|           | preambl   |           |           |         |    |
|           | eTransMax |           |           |         |    |
|           | times and |           |           |         |    |
|           | SS does   |           |           |         |    |
|           | not       |           |           |         |    |
|           | response  |           |           |         |    |
|           | the MSGA  |           |           |         |    |
|           | in STEP   |           |           |         |    |
|           | 6, to     |           |           |         |    |
|           | make      |           |           |         |    |
|           | PREA      |           |           |         |    |
|           | MBLE\_TRA |           |           |         |    |
|           | NSMISSION |           |           |         |    |
|           | \_COUNTER |           |           |         |    |
|           | =         |           |           |         |    |
|           | msgA-Tr   |           |           |         |    |
|           | ansMax+1. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           | (         |         |    |
|           | MSGA      |           | including |         |    |
|           | using the |           | C-RNTI    |         |    |
|           | selected  |           | MAC CE)   |         |    |
|           | PRACH     |           |           |         |    |
|           | occasion  |           |           |         |    |
|           | and the   |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssociated |           |           |         |    |
|           | PUSCH     |           |           |         |    |
|           | resource  |           |           |         |    |
|           | of MSGA   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | Check:    | \--\>     | PRACH     | 1       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | Random    |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | and RAPID |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to the    |           |           |         |    |
|           | tr        |           |           |         |    |
|           | ansmitted |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 7.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | UE sends  | \--\>     | msg3      | \-      | \- |
|           | a msg3    |           | (C-RNTI   |         |    |
|           | using the |           | MAC       |         |    |
|           | grant     |           | CONTROL   |         |    |
|           | a         |           | ELEMENT)  |         |    |
|           | ssociated |           |           |         |    |
|           | to the    |           |           |         |    |
|           | Random    |           |           |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | received  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 8.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | SS        | \<\--     | C         | \-      | \- |
|           | schedules |           | ontention |         |    |
|           | PDCCH     |           | R         |         |    |
|           | tra       |           | esolution |         |    |
|           | nsmission |           |           |         |    |
|           | for UE    |           |           |         |    |
|           | C\_RNTI   |           |           |         |    |
|           | and       |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | uplink    |           |           |         |    |
|           | grant.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | with      |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | looped    |           |           |         |    |
|           | back PDCP |           |           |         |    |
|           | SDU.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *R        |           |           |           |         |    |
| RCReconfi |           |           |           |         |    |
| guration* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RRC      |           |           |           |         |    |
| Connectio |           |           |           |         |    |
| nReconfig |           |           |           |         |    |
| uration.* |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete. |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.1.10.3.3 Specific message contents {#specific-message-contents-9 .H6}

Table 7.1.1.1.10.3.3-1: *RRCReconfiguration* for EN-DC (step 1, Table
7.1.1.1.10.3.2-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13 with condition EN-DC\_HO.                               
  ------------------------------------------------------------------------------ ----------------- --------- -----------
  Information Element                                                            Value/remark      Comment   Condition
  RRCReconfiguration ::= SEQUENCE {                                                                          
  criticalExtensions CHOICE {                                                                                
  rrcReconfiguration SEQUENCE {                                                                              
  secondaryCellGroup                                                             CellGroupConfig             
  }                                                                                                          
  }                                                                                                          
  }                                                                                                          

Table 7.1.1.1.10.3.3-1A: *RRCReconfiguration* for NR/5GC (step 1, Table
7.1.1.1.10.3.2-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                               
  ---------------------------------------------------- ----------------- --------- -----------
  Information Element                                  Value/remark      Comment   Condition
  RRCReconfiguration ::= SEQUENCE {                                                
  criticalExtensions CHOICE {                                                      
  rrcReconfiguration SEQUENCE {                                                    
  nonCriticalExtension SEQUENCE {                                                  
  masterCellGroup                                      CellGroupConfig             
  }                                                                                
  }                                                                                
  }                                                                                
  }                                                                                

Table 7.1.1.1.10.3.3-2: *CellGroupConfig* for EN-DC (Table
7.1.1.1.10.3.3-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19 with condition PSCell\_change                                                                
  ---------------------------------------------------------------------------------- -------------------------------------------------- --------- -----------
  Information Element                                                                Value/remark                                       Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                                                                                  
  spCellConfig SEQUENCE {                                                                                                                         
  reconfigurationWithSync SEQUENCE {                                                                                                              
  spCellConfigCommon                                                                 ServingCellConfigCommon                                      
  newUE-Identity                                                                     UE identity different from NR cell 1 UE identity             
  rach-ConfigDedicated CHOICE {                                                                                                                   
  uplink                                                                             RACH-ConfigDedicated                                         
  }                                                                                                                                               
  }                                                                                                                                               
  }                                                                                                                                               
  }                                                                                                                                               

Table 7.1.1.1.10.3.3-2A: *CellGroupConfig* for NR/5GC (Table
7.1.1.1.10.3.3-1A)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19 with condition PCell\_change                                                                
  --------------------------------------------------------------------------------- -------------------------------------------------- --------- -----------
  Information Element                                                               Value/remark                                       Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                                                                                 
  spCellConfig SEQUENCE {                                                                                                                        
  reconfigurationWithSync SEQUENCE {                                                                                                             
  spCellConfigCommon                                                                ServingCellConfigCommon                                      
  newUE-Identity                                                                    UE identity different from NR cell 1 UE identity             
  rach-ConfigDedicated CHOICE {                                                                                                                  
  uplink                                                                            RACH-ConfigDedicated                                         
  }                                                                                                                                              
  }                                                                                                                                              
  }                                                                                                                                              
  }                                                                                                                                              

Table 7.1.1.1.10.3.3-3: *RACH-ConfigDedicated* (Table 7.1.1.1.10.3.3-2
and Table 7.1.1.1.10.3.3-2A)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-129 with condition 2-step RA                                           
  ------------------------------------------------------------------------------ ----------------------------- --------- -----------
  Information Element                                                            Value/remark                  Comment   Condition
  RACH-ConfigDedicated ::= SEQUENCE {                                                                                    
  cfra-TwoStep-r16 SEQUENCE {                                                                                            
  occasionsTwoStepRA-r16 SEQUENCE {                                                                                      
  rach-ConfigGenericTwoStepRA-r16                                                RACH-ConfigGenericTwoStepRA             
  }                                                                                                                      
  }                                                                                                                      
  }                                                                                                                      

Table 7.1.1.1.10.3.3-4: *Void*

Table 7.1.1.1.10.3.3-5: *RACH-ConfigGenericTwoStepRA* (Table
7.1.1.1.10.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-130A                            
  ------------------------------------------------------ -------------- --------- -----------
  Information Element                                    Value/remark   Comment   Condition
  RACH-ConfigGenericTwoStepRA ::= SEQUENCE {                                      
  msgA-PRACH-ConfigurationIndex-r16                      Not present              
  msgA-RO-FDM-r16                                        Not present              
  msgA-RO-FrequencyStart-r16                             Not present              
  msgA-ZeroCorrelationZoneConfig-r16                     Not present              
  msgA-PreamblePowerRampingStep-r16                      Not present              
  msgA-PreambleReceivedTargetPower-r16                   Not present              
  }                                                                               

Table 7.1.1.1.10.3.3-6: *ServingCellConfigCommon* (Table
7.1.1.1.10.3.3-2 and Table 7.1.1.1.10.3.3-2A)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                      
  ----------------------------------------------------- ------------------------ --------- -----------
  Information Element                                   Value/remark             Comment   Condition
  ServingCellConfigCommon ::= SEQUENCE {                                                   
  uplinkConfigCommon SEQUENCE {                                                            
  initialUplinkBWP                                      BWP-UplinkCommon                   
  }                                                                                        
  tdd-UL-DL-ConfigurationCommon                         TDD-UL-DL-ConfigCommon             
  }                                                                                        

Table 7.1.1.1.10.3.3-7: *BWP-UplinkCommon (*Table 7.1.1.1.10.3.3-6)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-10                                 
  ---------------------------------------------------- ------------------- --------- -----------
  Information Element                                  Value/remark        Comment   Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                    
  rach-ConfigCommon CHOICE {                                                         
  setup                                                RACH-ConfigCommon             
  }                                                                                  
  msgA-ConfigCommon-r16 CHOICE {                                                     
  setup                                                MsgA-ConfigCommon             
  }                                                                                  
  }                                                                                  

Table 7.1.1.1.10.3.3-8: *RACH-ConfigCommon (*Table 7.1.1.1.10.3.3-7)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128                                                                                                         
  ----------------------------------------------------- ---------------------------------------------------------------------- ------------------------------ -----------
  Information Element                                   Value/remark                                                           Comment                        Condition
  RACH-ConfigCommon ::= SEQUENCE {                                                                                                                            
  rach-ConfigGeneric                                    RACH-ConfigGeneric                                                                                    
  ssb-perRACH-OccasionAndCB-PreamblesPerSSB CHOICE {                                                                                                          
  one                                                   n36                                                                                                   
  }                                                                                                                                                           
  prach-RootSequenceIndex CHOICE {                                                                                                                            
  l139                                                  Set according to table 4.4.2-2 in TS 38.508-1 \[4\] for the NR Cell.                                  
  l839                                                  Set according to table 4.4.2-2 in TS 38.508-1 \[4\] for the NR Cell.   PRACH Preamble format 0 used   FR1,
  }                                                                                                                                                           
  }                                                                                                                                                           

Table 7.1.1.1.10.3.3-9: *MsgA-ConfigCommon (*Table 7.1.1.1.10.3.3-7)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-81A                                          
  ----------------------------------------------------- ---------------------------- --------- -----------
  Information Element                                   Value/remark                 Comment   Condition
  MsgA-ConfigCommon-r16 ::= SEQUENCE {                                                         
  rach-ConfigCommonTwoStepRA-r16                        RACH-ConfigCommonTwoStepRA             
  msgA-PUSCH-Config-r16                                 MsgA-PUSCH-Config                      
  }                                                                                            

Table 7.1.1.1.10.3.3-10: *TDD-UL-DL-ConfigCommon (*Table
7.1.1.1.10.3.3-6)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-192                                 
  ----------------------------------------------------- ------------------- --------- --------------------------
  Information Element                                   Value/remark        Comment   Condition
  TDD-UL-DL-ConfigCommon ::= SEQUENCE {                                               
  referenceSubcarrierSpacing                            SubcarrierSpacing             
  pattern1 SEQUENCE {                                                                 
  dl-UL-TransmissionPeriodicity                         ms5                           FR1 SCS 30
                                                        ms5                           FR1 SCS 15
                                                        ms0p625                       FR2
  nrofDownlinkSlots                                     3                             FR1 SCS 30
                                                        1                             FR1 SCS 15
                                                        3                             FR2
  nrofDownlinkSymbols                                   6                             FR1 SCS 30
                                                        10                            FR1 SCS 15
                                                        10                            FR2
  nrofUplinkSlots                                       2                             FR1 SCS 30
                                                        1                             FR1 SCS 15
                                                        1                             FR2
  nrofUplinkSymbols                                     4                             FR1 SCS 30
                                                        2                             FR1 SCS 15
                                                        2                             FR2
  dl-UL-TransmissionPeriodicity-v1530                   ms3                           FR1 SCS 30 or FR1 SCS 15
  }                                                                                   
  pattern2                                              Not present                   
  pattern2 SEQUENCE {                                                                 FR1 SCS 30 or FR1 SCS 15
  dl-UL-TransmissionPeriodicity                         ms2                           
  nrofDownlinkSlots                                     4                             FR1 SCS 30
                                                        2                             FR1 SCS 15
  nrofDownlinkSymbols                                   0                             
  nrofUplinkSlots                                       0                             
  nrofUplinkSymbols                                     0                             
  }                                                                                   
  }                                                                                   

Table 7.1.1.1.10.3.3-11: *RACH-ConfigCommonTwoStepRA (*Table
7.1.1.1.10.3.3-9)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128A                             
  ------------------------------------------------------ -------------- ---------- -----------
  Information Element                                    Value/remark   Comment    Condition
  RACH-ConfigCommonTwoStepRA-r16 ::= SEQUENCE {                                    
  msgA-RSRP-Threshold-r16                                57             -100 dBm   
  }                                                                                

Table 7.1.1.1.10.3.3-12: Void

##### 7.1.1.1.10a Random access procedure / 2-step RACH/ Fallback for CBRA 

##### 7.1.1.1.10a.1 Test Purpose (TP) {#a.1-test-purpose-tp-2 .H6}

##### (1) {#section-40 .H6}

**with** { UE in RRC Idle state initiated Random Access procedure to
transmit UL CCCH PDU and transmitted MSGA }

**ensure that** {

**when** { SS answers with a matching MSGB including fallbackRAR within
msgB-ResponseWindow }

**then** { UE transmits a MSG3 using the UL grant scheduled in the
fallbackRAR }

}

##### (2) {#section-41 .H6}

**with** { UE received a MSGB including fallbackRAR within
msgB-ResponseWindow, and transmitted a MSG3 using the UL grant scheduled
in the fallbackRAR }

**ensure that** {

**when** { The SS does not schedule any PDCCH transmission addressed to
UE Temporary C-RNTI before Contention resolution timer expiry }

**then** { UE retransmits a MSGA }

}

##### (3) {#section-42 .H6}

**with** { UE received a MSGB including fallbackRAR within
msgB-ResponseWindow, and transmitted a MSG3 using the UL grant scheduled
in the fallbackRAR }

**ensure that** {

**when** { The SS schedules a PDCCH transmission addressed to UE
Temporary C-RNTI before Contention resolution timer expiry }

**then** { UE assumes RACH procedure as complete }

}

##### 7.1.1.1.10a.2 Conformance requirements {#a.2-conformance-requirements-2 .H6}

References: The conformance requirements covered in the present TC are
specified in: 3GPP TS 38.321, clause 5.1.4a, 5.1.5 and 6.2.3a and TS
38.300, clause 9.2.6. Unless otherwise stated these are Rel-16
requirements.

\[TS 38.321, clause 5.1.4a\]

Once the MSGA preamble is transmitted, regardless of the possible
occurrence of a measurement gap, the MAC entity shall:

1\> start the *msgB-ResponseWindow* at the PDCCH occasion as specified
in TS 38.213 \[6\], clause 8.2A;

1\> monitor the PDCCH of the SpCell for a Random Access Response
identified by MSGB-RNTI while the *msgB-ResponseWindow* is running;

1\> if C-RNTI MAC CE was included in the MSGA:

2\> monitor the PDCCH of the SpCell for Random Access Response
identified by the C-RNTI while the *msgB-ResponseWindow* is running.

1\> if notification of a reception of a PDCCH transmission of the SpCell
is received from lower layers:

...

2\> if a valid (as specified in TS 38.213 \[6\]) downlink assignment has
been received on the PDCCH for the MSGB-RNTI and the received TB is
successfully decoded:

3\> if the MSGB contains a MAC subPDU with Backoff Indicator:

4\> set the *PREAMBLE\_BACKOFF* to value of the BI field of the MAC
subPDU using Table 7.2-1, multiplied with *SCALING\_FACTOR\_BI*.

3\> else:

4\> set the *PREAMBLE\_BACKOFF* to 0 ms.

3\> if the MSGB contains a fallbackRAR MAC subPDU; and

3\> if the Random Access Preamble identifier in the MAC subPDU matches
the transmitted *PREAMBLE\_INDEX* (see clause 5.1.3a):

4\> consider this Random Access Response reception successful;

4\> apply the following actions for the SpCell:

5\> process the received Timing Advance Command (see clause 5.2);

5\> indicate the *msgA-PreambleReceivedTargetPower* and the amount of
power ramping applied to the latest Random Access Preamble transmission
to lower layers (i.e. (*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*);

5\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

6\> consider the Random Access procedure successfully completed;

6\> process the received UL grant value and indicate it to the lower
layers.

5\> else:

6\> set the *TEMPORARY\_C-RNTI* to the value received in the Random
Access Response;

6\> if the Msg3 buffer is empty:

> 7\> obtain the MAC PDU to transmit from the MSGA buffer and store it
> in the Msg3 buffer;

6\> process the received UL grant value and indicate it to the lower
layers and proceed with Msg3 transmission.

...

Upon receiving a fallbackRAR, the MAC entity may stop
*msgB-ResponseWindow* once the Random Access Response reception is
considered as successful.

\[TS 38.321, clause 5.1.5\]

Once Msg3 is transmitted the MAC entity shall:

1\> if Msg3 is transmitted on a non-terrestrial network:

2\> start the *ra-ContentionResolutionTimer* and restart the
*ra-ContentionResolutionTimer* at each HARQ retransmission in the first
symbol after the end of the Msg3 transmission plus the UE estimate of
UE-gNB RTT.

1\> else if the Msg3 transmission (i.e. initial transmission or HARQ
retransmission) is scheduled with Type A PUSCH repetition:

2\> start or restart the *ra-ContentionResolutionTimer* in the first
symbol after the end of all repetitions of the Msg3 transmission.

...

1\> if notification of a reception of a PDCCH transmission of the SpCell
is received from lower layers:

> ...

2\> else if the CCCH SDU was included in Msg3 and the PDCCH transmission
is addressed to its *TEMPORARY\_C-RNTI*:

3\> if the MAC PDU is successfully decoded:

4\> stop *ra-ContentionResolutionTimer*;

4\> if the MAC PDU contains a UE Contention Resolution Identity MAC CE;
and

4\> if the UE Contention Resolution Identity in the MAC CE matches the
CCCH SDU transmitted in Msg3:

5\> consider this Contention Resolution successful and finish the
disassembly and demultiplexing of the MAC PDU;

5\> if this Random Access procedure was initiated for SI request:

6\> indicate the reception of an acknowledgement for SI request to upper
layers.

5\> else:

6\> set the C-RNTI to the value of the *TEMPORARY\_C-RNTI*;

5\> discard the *TEMPORARY\_C-RNTI*;

5\> consider this Random Access procedure successfully completed.

4\> else:

5\> discard the *TEMPORARY\_C-RNTI*;

5\> consider this Contention Resolution not successful and discard the
successfully decoded MAC PDU.

1\> if *ra-ContentionResolutionTimer* expires:

2\> if Msg3 is transmitted on a non-terrestrial network and
*ra-ContentionResolutionTimer* expires prior to the first symbol after
the end of a Msg3 retransmission plus the UE estimate of UE-gNB RTT:

3\> do not consider the Contention Resolution unsuccessful.

2\> else:

3\> discard the *TEMPORARY\_C-RNTI*;

3\> consider the Contention Resolution not successful.

1\> if the Contention Resolution is considered not successful:

2\> flush the HARQ buffer used for transmission of the MAC PDU in the
Msg3 buffer;

2\> increment *PREAMBLE\_TRANSMISSION\_COUNTER* by 1;

2\> if *PREAMBLE\_TRANSMISSION\_COUNTER* = *preambleTransMax* + 1:

3\> indicate a Random Access problem to upper layers.

3\> if this Random Access procedure was triggered for SI request:

4\> consider the Random Access procedure unsuccessfully completed.

2\> if the Random Access procedure is not completed:

3\> if the *RA\_TYPE* is set to *4-stepRA*:

...

3\> else (i.e. the *RA\_TYPE* is set to *2-stepRA*):

4\> if *msgA-TransMax* is applied (see clause 5.1.1a) and
*PREAMBLE\_TRANSMISSION\_COUNTER* = *msgA-TransMax* + 1:

5\> set the *RA\_TYPE* to *4-stepRA*;

5\> perform initialization of variables specific to Random Access type
as specified in clause 5.1.1a;

5\> flush HARQ buffer used for the transmission of MAC PDU in the MSGA
buffer;

5\> discard explicitly signalled contention-free 2-step RA type Random
Access Resources, if any;

5\> perform the Random Access Resource selection as specified in clause
5.1.2.

4\> else:

5\> select a random backoff time according to a uniform distribution
between 0 and the *PREAMBLE\_BACKOFF*;

5\> if the criteria (as defined in clause 5.1.2a) to select
contention-free Random Access Resources is met during the backoff time:

6\> perform the Random Access Resource selection procedure for 2-step RA
type as specified in clause 5.1.2a.

5\> else:

6\> perform the Random Access Resource selection for 2-step RA type
procedure (see clause 5.1.2a) after the backoff time.

\[TS 38.321, clause 6.2.3.a\]

The fallbackRAR is of fixed size as depicted in Figure 6.2.3a-1, and
consists of the following fields:

\- R: Reserved bit, set to 0;

\- Timing Advance Command: The Timing Advance Command field indicates
the index value *T~A~* used to control the amount of timing adjustment
that the MAC entity has to apply in TS 38.213 \[6\]. The size of the
Timing Advance Command field is 12 bits;

\- UL Grant: The Uplink Grant field indicates the resources to be used
on the uplink in TS 38.213 \[6\]. The size of the UL Grant field is 27
bits;

\- Temporary C-RNTI: The Temporary C-RNTI field indicates the temporary
identity that is used by the MAC entity during Random Access. The size
of the Temporary C-RNTI field is 16 bits.

The fallbackRAR is octet aligned.

Figure 6.2.3a-1: fallbackRAR

...

\[TS 38.300, clause 9.2.6\]

The MSGA of the 2-step RA type includes a preamble on PRACH and a
payload on PUSCH. After MSGA transmission, the UE monitors for a
response from the network within a configured window. For CFRA,
dedicated preamble and PUSCH resource are configured for MSGA
transmission and upon receiving the network response, the UE ends the
random access procedure as shown in Figure 9.2.6-1(d). For CBRA, if
contention resolution is successful upon receiving the network response,
the UE ends the random access procedure as shown in Figure 9.2.6-1(b);
while if fallback indication is received in MSGB, the UE performs MSG3
transmission using the UL grant scheduled in the fallback indication and
monitors contention resolution as shown in Figure 9.2.6-2. If contention
resolution is not successful after MSG3 (re)transmission(s), the UE goes
back to MSGA transmission.

...

Figure 9.2.6-2: Fallback for CBRA with 2-step RA type

...

##### 7.1.1.1.10a.3 Test description {#a.3-test-description-2 .H6}

##### 7.1.1.1.10a.3.1 Pre-test conditions {#a.3.1-pre-test-conditions-2 .H6}

##### System Simulator: {#system-simulator-2 .H6}

\- The SS configures the test environment in accordance to the execution
conditions in Table 7.1.1.0-1.

##### UE: {#ue-2 .H6}

\- None

##### Preamble: {#preamble-2 .H6}

\- The UE is in NR RRC\_Idle mode (state 1N-A) on NR Cell 1 according to
TS 38.508-1 \[4\] Table 4.4A.2-1.

#####  7.1.1.1.10a.3.2 Test procedure sequence {#a.3.2-test-procedure-sequence-2 .H6}

Table 7.1.1.1.10a.3.2-1: Main behaviour

+----+--------------+--------------+--------------+---------+----+
| St | Procedure    | Message      | TP           | Verdict |    |
|    |              | Sequence     |              |         |    |
+====+==============+==============+==============+=========+====+
|    |              | U - S        | Message      |         |    |
+----+--------------+--------------+--------------+---------+----+
| 1  | The SS       | \<\--        | *Paging*     | \-      | \- |
|    | transmits a  |              |              |         |    |
|    | Paging       |              |              |         |    |
|    | message      |              |              |         |    |
|    | including a  |              |              |         |    |
|    | matched UE   |              |              |         |    |
|    | identity.    |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 2  | The UE       | \--\>        | MAC PDU      | \-      | \- |
|    | transmit     |              | (*RRCSe      |         |    |
|    | MSGA.        |              | tupRequest*) |         |    |
+----+--------------+--------------+--------------+---------+----+
| 3  | The SS       | \<\--        | MAC          | \-      | \- |
|    | transmits a  |              | PDU(         |         |    |
|    | MSGB DL MAC  |              | fallbackRAR) |         |    |
|    | PDU          |              |              |         |    |
|    | containing a |              |              |         |    |
|    | fallbackRAR. |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 4  | Check: Does  | \--\>        | MAC PDU      | 1       | P  |
|    | the UE       |              | (*RRCSetu    |         |    |
|    | transmit a   |              | pRequest*)\` |         |    |
|    | MAC PDU      |              |              |         |    |
|    | including    |              |              |         |    |
|    | RRC          |              |              |         |    |
|    | SetupRequest |              |              |         |    |
|    | message      |              |              |         |    |
|    | using the    |              |              |         |    |
|    | grant        |              |              |         |    |
|    | associated   |              |              |         |    |
|    | to           |              |              |         |    |
|    | fallbackRAR  |              |              |         |    |
|    | MAC subPDU   |              |              |         |    |
|    | received in  |              |              |         |    |
|    | step 3?      |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 5  | Before the   | \-           | \-           | \-      | \- |
|    | contention   |              |              |         |    |
|    | resolution   |              |              |         |    |
|    | timer        |              |              |         |    |
|    | expires, the |              |              |         |    |
|    | SS does not  |              |              |         |    |
|    | schedule any |              |              |         |    |
|    | PDCCH.       |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 6  | Check: Does  | \--\>        | MAC PDU      | 2       | P  |
|    | the UE       |              | (*RRCSe      |         |    |
|    | transmit     |              | tupRequest*) |         |    |
|    | MSGA?        |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 7  | The SS       | \<\--        | MAC          | \-      | \- |
|    | transmits a  |              | PDU(         |         |    |
|    | MSGB DL MAC  |              | fallbackRAR) |         |    |
|    | PDU          |              |              |         |    |
|    | containing a |              |              |         |    |
|    | fallbackRAR. |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 8  | Check: Does  | \--\>        | MAC PDU      | 1       | P  |
|    | the UE       |              | (*RRCSetu    |         |    |
|    | transmit a   |              | pRequest*)\` |         |    |
|    | MAC PDU      |              |              |         |    |
|    | including    |              |              |         |    |
|    | RRC          |              |              |         |    |
|    | SetupRequest |              |              |         |    |
|    | message      |              |              |         |    |
|    | using the    |              |              |         |    |
|    | grant        |              |              |         |    |
|    | associated   |              |              |         |    |
|    | to           |              |              |         |    |
|    | fallbackRAR  |              |              |         |    |
|    | MAC subPDU   |              |              |         |    |
|    | received in  |              |              |         |    |
|    | step 7?      |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 9  | The SS       | \<\--        | MAC PDU      | \-      | \- |
|    | schedules    |              |              |         |    |
|    | PDCCH        |              | (UE          |         |    |
|    | transmission |              | Contention   |         |    |
|    | addressed to |              | Resolution   |         |    |
|    | TC-RNTI to   |              | Identity MAC |         |    |
|    | transmit a   |              | CE,          |         |    |
|    | valid MAC    |              | *RRCSetup*)  |         |    |
|    | PDU          |              |              |         |    |
|    | containing   |              |              |         |    |
|    | an           |              |              |         |    |
|    | *RRCSetup*   |              |              |         |    |
|    | message and  |              |              |         |    |
|    | 'UE          |              |              |         |    |
|    | Contention   |              |              |         |    |
|    | Resolution   |              |              |         |    |
|    | Identity'    |              |              |         |    |
|    | MAC control  |              |              |         |    |
|    | element with |              |              |         |    |
|    | matched      |              |              |         |    |
|    | 'Contention  |              |              |         |    |
|    | Resolution   |              |              |         |    |
|    | Identity'.   |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 10 | Check: Does  | \--\>        | MAC PDU      | 3       | P  |
|    | UE transmit  |              | (*RRCSet     |         |    |
|    | a MAC PDU    |              | upComplete)* |         |    |
|    | containing   |              |              |         |    |
|    | an           |              |              |         |    |
|    | *RRCSe       |              |              |         |    |
|    | tupComplete* |              |              |         |    |
|    | message      |              |              |         |    |
|    | indicating   |              |              |         |    |
|    | acceptance   |              |              |         |    |
|    | of           |              |              |         |    |
|    | *RRCSetup*   |              |              |         |    |
|    | message?     |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+

##### 7.1.1.1.10a.3.3 Specific message contents {#a.3.3-specific-message-contents-2 .H6}

Table 7.1.1.1.10a.3.3-1: *SIB1 (*Preamble, Table 7.1.1.1.10a.3.2-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-28                                
  ---------------------------------------------------- ------------------ --------- -----------
  Information Element                                  Value/remark       Comment   Condition
  SIB1 ::= SEQUENCE {                                                               
  servingCellConfigCommon SEQUENCE {                                                
  uplinkConfigCommon SEQUENCE {                                                     
  initialUplinkBWP                                     BWP-UplinkCommon             
  }                                                                                 
  }                                                                                 
  }                                                                                 

Table 7.1.1.1.10a.3.3-2: *BWP-UplinkCommon (*Table 7.1.1.1.10a.3.3-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-10                                 
  ---------------------------------------------------- ------------------- --------- -----------
  Information Element                                  Value/remark        Comment   Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                    
  rach-ConfigCommon CHOICE {                                                         
  setup                                                RACH-ConfigCommon             
  }                                                                                  
  msgA-ConfigCommon-r16 CHOICE {                                                     
  setup                                                MsgA-ConfigCommon             
  }                                                                                  
  }                                                                                  

Table 7.1.1.1.10a.3.3-3: *RACH-ConfigCommon (*Table 7.1.1.1.10a.3.3-2)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128                                                                                                         
  ----------------------------------------------------- ---------------------------------------------------------------------- ------------------------------ -----------
  Information Element                                   Value/remark                                                           Comment                        Condition
  RACH-ConfigCommon ::= SEQUENCE {                                                                                                                            
  rach-ConfigGeneric                                    RACH-ConfigGeneric                                                                                    
  ssb-perRACH-OccasionAndCB-PreamblesPerSSB CHOICE {                                                                                                          
  one                                                   n36                                                                                                   
  }                                                                                                                                                           
  prach-RootSequenceIndex CHOICE {                                                                                                                            
  l139                                                  Set according to table 4.4.2-2 in TS 38.508-1 \[4\] for the NR Cell.                                  
  l839                                                  Set according to table 4.4.2-2 in TS 38.508-1 \[4\] for the NR Cell.   PRACH Preamble format 0 used   FR1,
  }                                                                                                                                                           
  }                                                                                                                                                           

Table 7.1.1.1.10a.3.3-4: *MsgA-ConfigCommon (*Table 7.1.1.1.10a.3.3-2)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-81A                                          
  ----------------------------------------------------- ---------------------------- --------- -----------
  Information Element                                   Value/remark                 Comment   Condition
  MsgA-ConfigCommonL-r16 ::= SEQUENCE {                                                        
  rach-ConfigCommonTwoStepRA-r16                        RACH-ConfigCommonTwoStepRA             
  msgA-PUSCH-Config-r16                                 MsgA-PUSCH-Config                      
  }                                                                                            

Table 7.1.1.1.10a.3.3-5: *RACH-ConfigCommonTwoStepRA (*Table
7.1.1.1.10a.3.3-4)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128A                                                
  ------------------------------------------------------ --------------------------------- ---------- -----------
  Information Element                                    Value/remark                      Comment    Condition
  RACH-ConfigCommonTwoStepRA-r16 ::= SEQUENCE {                                                       
  msgA-RSRP-Threshold-r16                                57                                -100 dBm   
  rach-ConfigGenericTwoStepRA-r16                        RACH-ConfigGenericTwoStepRA-r16              
  }                                                                                                   

Table 7.1.1.1.10a.3.3-5A: *RACH-ConfigGenericTwoStepRA-r16* (Table
7.1.1.1.9a.3.3-5)

  ------------------------------------------------------ -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-130A                            
  Information Element                                    Value/remark   Comment   Condition
  RACH-ConfigGenericTwoStepRA-r16 ::= SEQUENCE {                                  
  msgB-ResponseWindow-r16                                sl40                     
  }                                                                               
  ------------------------------------------------------ -------------- --------- -----------

Table 7.1.1.1.10a.3.3-6: *MsgA-PUSCH-Config (*Table 7.1.1.1.10a.3.3-4)

  -----------------------------------------------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-81B
  -----------------------------------------------------

##### 7.1.1.1.11 Random access procedure / Successful/ Slice specific RACH configuration

##### 7.1.1.1.11.1 Test Purpose (TP) {#test-purpose-tp-10 .H6}

##### (1) {#section-43 .H6}

**with** { UE in NR RRC\_IDLE state and starts Random Access procedure}

**ensure that** {

**when** { SS configures NSAG indicator and associated set of preambles
in FeatureCombinationPreambles in SIB1}

**then** { UE transmits a random access preamble using the slice
specific random access resource}

}

##### 7.1.1.1.11.2 Conformance requirements {#conformance-requirements-10 .H6}

References: The conformance requirements covered in the present TC are
specified in: 3GPP TS 38.321, clauses 5.1.1a, 5.1.1c, 5.1.1d, 5.1.2.
Unless otherwise stated these are Rel-17 requirements.

\[TS 38.321, clause 5.1.1a\]

The MAC entity shall:

1.  if *RA\_TYPE* is set to *2-stepRA*:

...

1\> else (i.e. *RA\_TYPE* is set to *4-stepRA*):

2\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to *powerRampingStep*;

2\> set *SCALING\_FACTOR\_BI* to 1;

2\> set *preambleTransMax* to *preambleTransMax* included in the
*RACH-ConfigGeneric;*

...

2\> else if *ra-PrioritizationForSlicing* for a NSAG identity is
configured for the selected carrier; and

2\> if the MAC entity is provided by upper layers with this NSAG
identity:

3\> if *powerRampingStepHighPriority* is configured in the
*ra-PrioritizationForSlicing* for this NSAG identity*:*

4\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority*.

3\> if *scalingFactorBI* is configured in the
*ra-PrioritizationForSlicing* for this NSAG identity:

4\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

2\> else if *ra-PrioritizationForAccessIdentity* is configured for the
selected carrier; and

\[TS 38.321, clause 5.1.1c\]

The MAC entity shall for each set of configured Random Access resources
for 4-step RA type and for each set of configured Random Access
resources for 2-step RA type:

1\> if RedCap indication is configured for a set of Random Access
resources:

2\> consider the set of Random Access resources as not available for a
Random Access procedure for which RedCap indication is not applicable.

1\> if SDT indication is configured for a set of Random Access
resources:

2\> consider the set of Random Access resources as not available for the
Random Access procedure which is not triggered for SDT.

1\> if NSAG indication is configured for a set of Random Access
resources:

2\> consider the set of Random Access resources as not available for the
Random Access procedure unless it is triggered for the corresponding
NSAG indication.

1\> if MSG3 repetition indication is configured for a set of Random
Access resources:

2\> consider the set of Random Access resources as not available for the
Random Access procedure if MSG3 repetition is not applicable.

1\> if a set of Random Access resources is not configured with any of
the RedCap or SDT or NSAG(s) or MSG3 repetition indications:

2\> consider the set of Random Access resources to not associated with
any feature indication.

\[TS 38.321, clause 5.1.1d\]

The MAC entity shall:

1\> among the available sets of Random Access resources for this Random
Access procedure (as specified in clause 5.1.1c), identify those
configured with a feature which has the highest priority assigned in
*featurePriorities* among all the features applicable to this Random
Access procedure as specified in TS 38.331 \[5\].

1\> if a single set of Random Access resources is identified:

2\> select this set of Random Access resources.

1\> else if more than one set of Random Access resources is identified:

2\> repeat the procedure taking as an input the identified sets of
Random Access resources and the feature applicable to the current Random
Access procedure with the highest priority assigned in
*featurePriorities* among all the features applicable to this Random
Access procedure, except the features considered already.

1\> else (i.e. no set of Random Access resources is identified):

2\> repeat the procedure taking as an input the previous identified
available sets of Random Access resources and the feature applicable to
the current Random Access procedure with the highest priority assigned
in *featurePriorities* among all the features applicable to this Random
Access procedure, except the features considered already.

\[TS 38.321, clause 5.1.2\]

If the selected *RA\_TYPE* is set to *4-stepRA*, the MAC entity shall:

...

1\> else (i.e. for the contention-based Random Access preamble
selection):

2\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
is available:

3\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> if the *RA\_TYPE* is switched from *2-stepRA* to *4-stepRA*:

3\> if a Random Access Preambles group was selected during the current
Random Access procedure:

4\> select the same group of Random Access Preambles as was selected for
the 2-step RA type.

3\> else:

4\> if Random Access Preambles group B is configured; and

4\> if the transport block size of the MSGA payload configured in the
*rach-ConfigDedicated* corresponds to the transport block size of the
MSGA payload associated with Random Access Preambles group B:

5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

2\> else if Msg3 buffer is empty:

3\> if Random Access Preambles group B is configured:

4\> if the potential Msg3 size (UL data available for transmission plus
MAC subheader(s) and, where required, MAC CEs) is greater than
*ra-Msg3SizeGroupA* and the pathloss is less than *PCMAX* (of the
Serving Cell performing the Random Access Procedure) --
*preambleReceivedTargetPower* -- *msg3-DeltaPreamble* --
*messagePowerOffsetGroupB*; or

4\> if the Random Access procedure was initiated for the CCCH logical
channel and the CCCH SDU size plus MAC subheader is greater than
*ra-Msg3SizeGroupA*:

5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

3\> else:

4\> select the Random Access Preambles group A.

2\> else (i.e. Msg3 is being retransmitted):

3\> select the same group of Random Access Preambles as was used for the
Random Access Preamble transmission attempt corresponding to the first
transmission of Msg3.

2\> select a Random Access Preamble randomly with equal probability from
the Random Access Preambles associated with the selected SSB and the
selected Random Access Preambles group;

2\> set the *PREAMBLE\_INDEX* to the selected Random Access Preamble.

##### 7.1.1.1.11.3 Test description {#test-description-10 .H6}

##### 7.1.1.1.11.3.1 Pre-test conditions {#pre-test-conditions-10 .H6}

The UE is in NR RRC\_Idle mode (state 1N-A) on NR Cell 1 according to
38.508-1 \[4\] Table 4.4A.2-1.. The NSAG identifier transmitted in SIB1
is same as the NSAG identifier provided to the UE in Registration Accept
message.

##### 7.1.1.1.11.3.2 Test procedure sequence {#test-procedure-sequence-9 .H6}

Table 7.1.1.1.11.3.2-1: Main behaviour

+----+--------------+--------------+--------------+---------+----+
| St | Procedure    | Message      | TP           | Verdict |    |
|    |              | Sequence     |              |         |    |
+====+==============+==============+==============+=========+====+
|    |              | U - S        | Message      |         |    |
+----+--------------+--------------+--------------+---------+----+
| 1  | The SS       | \<\--        | *Paging*     | \-      | \- |
|    | transmits a  |              |              |         |    |
|    | Paging       |              |              |         |    |
|    | message      |              |              |         |    |
|    | including a  |              |              |         |    |
|    | matched UE   |              |              |         |    |
|    | identity.    |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 2  | Check: Does  | \--\>        | PRACH        | 1       | P  |
|    | the UE       |              | Preamble     |         |    |
|    | transmits a  |              |              |         |    |
|    | preamble on  |              |              |         |    |
|    | PRACH using  |              |              |         |    |
|    | a preamble   |              |              |         |    |
|    | in the       |              |              |         |    |
|    | Fea          |              |              |         |    |
|    | tureCombinat |              |              |         |    |
|    | ionPreambles |              |              |         |    |
|    | configured   |              |              |         |    |
|    | for NSAG?    |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 3  | The SS       | \<\--        | Random       | \-      |    |
|    | transmits    |              | Access       |         |    |
|    | Random       |              | Response     |         |    |
|    | Access       |              |              |         |    |
|    | Response     |              |              |         |    |
|    | with RAPID   |              |              |         |    |
|    | c            |              |              |         |    |
|    | orresponding |              |              |         |    |
|    | to the       |              |              |         |    |
|    | transmitted  |              |              |         |    |
|    | Preamble in  |              |              |         |    |
|    | step 2,      |              |              |         |    |
|    | including    |              |              |         |    |
|    | TC-RNTI and  |              |              |         |    |
|    | not          |              |              |         |    |
|    | including    |              |              |         |    |
|    | Back off     |              |              |         |    |
|    | Indicator    |              |              |         |    |
|    | subheader.   |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 4  | The UE       | \--\>        | MAC PDU      | \-      | \- |
|    | transmits a  |              | (*RRCSe      |         |    |
|    | MAC PDU      |              | tupRequest*) |         |    |
|    | containing   |              |              |         |    |
|    | an           |              |              |         |    |
|    | *RRCS        |              |              |         |    |
|    | etupRequest* |              |              |         |    |
|    | message.     |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 5  | The SS       | \<\--        | MAC PDU      | \-      | \- |
|    | schedules    |              |              |         |    |
|    | PDCCH        |              | (*RRCSetup*  |         |    |
|    | transmission |              | and UE       |         |    |
|    | addressed to |              | Contention   |         |    |
|    | TC-RNTI to   |              | Resolution   |         |    |
|    | transmit a   |              | Identity MAC |         |    |
|    | valid MAC    |              | CE)          |         |    |
|    | PDU          |              |              |         |    |
|    | containing   |              |              |         |    |
|    | an           |              |              |         |    |
|    | *RRCSetup*   |              |              |         |    |
|    | message and  |              |              |         |    |
|    | 'UE          |              |              |         |    |
|    | Contention   |              |              |         |    |
|    | Resolution   |              |              |         |    |
|    | Identity'    |              |              |         |    |
|    | MAC control  |              |              |         |    |
|    | element with |              |              |         |    |
|    | matched      |              |              |         |    |
|    | 'Contention  |              |              |         |    |
|    | Resolution   |              |              |         |    |
|    | Identity'.   |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 6  | The UE       | \--\>        | MAC PDU      | \-      | \- |
|    | transmits a  |              | (*RRCSet     |         |    |
|    | MAC PDU      |              | upComplete)* |         |    |
|    | containing   |              |              |         |    |
|    | an           |              |              |         |    |
|    | *RRCSe       |              |              |         |    |
|    | tupComplete* |              |              |         |    |
|    | message      |              |              |         |    |
|    | indicating   |              |              |         |    |
|    | acceptance   |              |              |         |    |
|    | of           |              |              |         |    |
|    | *RRCSetup*   |              |              |         |    |
|    | message.     |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+

##### 7.1.1.1.11.3.3 Specific message contents {#specific-message-contents-10 .H6}

Table 7.1.1.1.11.3.3-1: SIB 1 (preamble and all steps, Table
7.1.1.1.11.3.2-1)

  --------------------------------------------------- ------------------------- ------------------------ -----------
  Derivation path: TS 38.508-1 \[4\] Table 4.6.1-28                                                      
  Information Element                                 Value/Remark              Comment                  Condition
  SIB1 ::= SEQUENCE {                                                                                    
  servingCellConfigCommon                             ServingCellConfigCommon   Table 7.1.1.1.11.3.3-2   
  }                                                                                                      
  --------------------------------------------------- ------------------------- ------------------------ -----------

Table 7.1.1.1.11.3.3-2: *ServingCellConfigCommon* (7.1.1.1.11.3.3-1)

  ----------------------------------------------------- ------------------ ------------------------ -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                               
  Information Element                                   Value/remark       Comment                  Condition
  ServingCellConfigCommon ::= SEQUENCE {                                                            
  uplinkConfigCommon SEQUENCE {                                                                     
  initialUplinkBWP                                      BWP-UplinkCommon   Table 7.1.1.1.11.3.3-3   
  }                                                                                                 
  }                                                                                                 
  ----------------------------------------------------- ------------------ ------------------------ -----------

Table 7.1.1.1.11.3.3-3: BWP-UplinkCommon (Table 7.1.1.1.11.3.3-2)

  ---------------------------------------------------- ------------------- ------------------------ ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-14                                                
  **Information Element**                              **Value/remark**    **Comment**              **Condition**
  BWP-UplinkCommon ::= SEQUENCE {                                                                   
  AdditionalRACH-ConfigList-r17 SEQUENCE {                                                          
  AdditionalRACH-Config-r17 SEQUENCE {                                                              
  rach-ConfigCommon-r17                                RACH-ConfigCommon   Table 7.1.1.1.11.3.3-4   
  )                                                                                                 
  }                                                                                                 
  }                                                                                                 
  ---------------------------------------------------- ------------------- ------------------------ ---------------

Table 7.1.1.1.11.3.3-4: RACH-ConfigCommon *(*Table 7.1.1.1.11.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128                                                          
  ----------------------------------------------------- ----------------------------- ------------------------ -----------
  Information Element                                   Value/remark                  Comment                  Condition
  RACH-ConfigCommon::= SEQUENCE {                                                                              
  featureCombinationPreamblesList-r17 SEQUENCE {                                                               
  FeatureCombinationPreambles-r17                       FeatureCombinationPreambles   Table 7.1.1.1.11.3.3-5   
  }                                                                                                            
  }                                                                                                            

Table 7.1.1.1.11.3.3-5: FeatureCombinationPreambles (Table
7.1.1.1.11.3.3-4)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-56E                                      
  ----------------------------------------------------- -------------- ------------------- -----------
  Information Element                                   Value/remark   Comment             Condition
  FeatureCombinationPreambles-r17 ::= SEQUENCE {                                           
  featureCombination-r17 ::= SEQUENCE {                                                    
  nsag-r17::= SEQUENCE {                                                                   
  nsag-r17\[0\]                                         '0000 0001'B                       
  }                                                                                        
  }                                                                                        
  startPreambleForThisPartition-r17                     8              Randomly selected   
  numberOfPreamblesPerSSB-ForThisPartition-r17          12                                 
  ssb-SharedRO-MaskIndex-r17                            Not present                        
  groupBconfigured-r17                                  Not present                        
  separateMsgA-PUSCH-Config-r17                         Not present                        
  msgA-RSRP-Threshold-r17                               Not present                        
  rsrp-ThresholdSSB-r17                                 Not present                        
  deltaPreamble-r17                                     Not present                        
  }                                                                                        

##### 7.1.1.1.12 Random access procedure / Successful/ ra-PrioritizationForSlicing

##### 7.1.1.1.12.1 Test Purpose (TP) {#test-purpose-tp-11 .H6}

##### (1) {#section-44 .H6}

**with** { UE in NR RRC\_IDLE state and starts Random Access procedure}

**ensure that** {

**when** { SS configures both ra-PrioritizationForSlicing for a NSAG
identity and ra-PrioritizationForAccessIdentity in SIB1 and set
enableRA-PrioritizationForSlicing to TRUE}

**then** { UE uses powerRampingStepHighPriority and scalingFactorBI
configured in the ra-PrioritizationForSlicing for Random Access
procedure }

}

##### (2) {#section-45 .H6}

**with** { UE in NR RRC\_IDLE state after transmission of a PRACH
preamble on NR SpCell and SS configured scalingFactorBI in
ra-PrioritizationForSlicing for a NSAG identity in SIB1 }

**ensure that** {

**when** { SS sends a Random Access Response including a Backoff
Indicator with the Random Access Preamble identifier different from the
value received from the UE}

**then** { UE triggers RA preamble after a random time between 0 and the
indicated Backoff parameter multiplied with scalingFactorBI configured
in the ra-PrioritizationForSlicing }

}

##### 7.1.1.1.12.2 Conformance requirements {#conformance-requirements-11 .H6}

References: The conformance requirements covered in the present TC are
specified in: 3GPP TS 38.321, clauses 5.1.1a, 5.1.1c, 5.1.1d, 5.1.2.
Unless otherwise stated these are Rel-17 requirements.

\[TS 38.321, clause 5.1.1a\]

The MAC entity shall:

1.  if *RA\_TYPE* is set to *2-stepRA*:

...

1\> else (i.e. *RA\_TYPE* is set to *4-stepRA*):

2\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to *powerRampingStep*;

2\> set *SCALING\_FACTOR\_BI* to 1;

2\> set *preambleTransMax* to *preambleTransMax* included in the
*RACH-ConfigGeneric;*

...

2\> if the MAC entity is provided by upper layers with both this NSAG
identity and Access Identity 1 or 2; and

2\> if for at least one of these Access Identities the corresponding bit
in the *ra-PrioritizationForAI* is set to *one*:

3\> if *enableRA-PrioritizationForSlicing* is set to *true*:

4\> if *powerRampingStepHighPriority* is configured in the
*ra-PrioritizationForSlicing* for this NSAG identity*:*

5\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority*.

4\> if *scalingFactorBI* is configured in the
*ra-PrioritizationForSlicing* for this NSAG identity:

5\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

3\> else if *enableRA-PrioritizationForSlicing* is set to *false*:

4\> if *powerRampingStepHighPriority* is configured in the
*ra-PrioritizationForAccessIdentity:*

5\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority*.

4\> if *scalingFactorBI* is configured in the
*ra-PrioritizationForAccessIdentity*:

5\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

2\> else if *ra-PrioritizationForSlicing* for a NSAG identity is
configured for the selected carrier; and

2\> if the MAC entity is provided by upper layers with this NSAG
identity:

3\> if *powerRampingStepHighPriority* is configured in the
*ra-PrioritizationForSlicing* for this NSAG identity*:*

4\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority*.

3\> if *scalingFactorBI* is configured in the
*ra-PrioritizationForSlicing* for this NSAG identity:

4\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

2\> else if *ra-PrioritizationForAccessIdentity* is configured for the
selected carrier; and

\[TS 38.321, clause 5.1.1c\]

The MAC entity shall for each set of configured Random Access resources
for 4-step RA type and for each set of configured Random Access
resources for 2-step RA type:

1\> if RedCap indication is configured for a set of Random Access
resources:

2\> consider the set of Random Access resources as not available for a
Random Access procedure for which RedCap indication is not applicable.

1\> if SDT indication is configured for a set of Random Access
resources:

2\> consider the set of Random Access resources as not available for the
Random Access procedure which is not triggered for SDT.

1\> if NSAG indication is configured for a set of Random Access
resources:

2\> consider the set of Random Access resources as not available for the
Random Access procedure unless it is triggered for the corresponding
NSAG indication.

1\> if MSG3 repetition indication is configured for a set of Random
Access resources:

2\> consider the set of Random Access resources as not available for the
Random Access procedure if MSG3 repetition is not applicable.

1\> if a set of Random Access resources is not configured with any of
the RedCap or SDT or NSAG(s) or MSG3 repetition indications:

2\> consider the set of Random Access resources to not associated with
any feature indication.

\[TS 38.321, clause 5.1.1d\]

The MAC entity shall:

1\> among the available sets of Random Access resources for this Random
Access procedure (as specified in clause 5.1.1c), identify those
configured with a feature which has the highest priority assigned in
*featurePriorities* among all the features applicable to this Random
Access procedure as specified in TS 38.331 \[5\].

1\> if a single set of Random Access resources is identified:

2\> select this set of Random Access resources.

1\> else if more than one set of Random Access resources is identified:

2\> repeat the procedure taking as an input the identified sets of
Random Access resources and the feature applicable to the current Random
Access procedure with the highest priority assigned in
*featurePriorities* among all the features applicable to this Random
Access procedure, except the features considered already.

1\> else (i.e. no set of Random Access resources is identified):

2\> repeat the procedure taking as an input the previous identified
available sets of Random Access resources and the feature applicable to
the current Random Access procedure with the highest priority assigned
in *featurePriorities* among all the features applicable to this Random
Access procedure, except the features considered already.

\[TS 38.321, clause 5.1.2\]

If the selected *RA\_TYPE* is set to *4-stepRA*, the MAC entity shall:

...

1\> else (i.e. for the contention-based Random Access preamble
selection):

2\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
is available:

3\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> if the *RA\_TYPE* is switched from *2-stepRA* to *4-stepRA*:

3\> if a Random Access Preambles group was selected during the current
Random Access procedure:

4\> select the same group of Random Access Preambles as was selected for
the 2-step RA type.

3\> else:

4\> if Random Access Preambles group B is configured; and

4\> if the transport block size of the MSGA payload configured in the
*rach-ConfigDedicated* corresponds to the transport block size of the
MSGA payload associated with Random Access Preambles group B:

5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

2\> else if Msg3 buffer is empty:

3\> if Random Access Preambles group B is configured:

4\> if the potential Msg3 size (UL data available for transmission plus
MAC subheader(s) and, where required, MAC CEs) is greater than
*ra-Msg3SizeGroupA* and the pathloss is less than *PCMAX* (of the
Serving Cell performing the Random Access Procedure) --
*preambleReceivedTargetPower* -- *msg3-DeltaPreamble* --
*messagePowerOffsetGroupB*; or

4\> if the Random Access procedure was initiated for the CCCH logical
channel and the CCCH SDU size plus MAC subheader is greater than
*ra-Msg3SizeGroupA*:

5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

3\> else:

4\> select the Random Access Preambles group A.

2\> else (i.e. Msg3 is being retransmitted):

3\> select the same group of Random Access Preambles as was used for the
Random Access Preamble transmission attempt corresponding to the first
transmission of Msg3.

2\> select a Random Access Preamble randomly with equal probability from
the Random Access Preambles associated with the selected SSB and the
selected Random Access Preambles group;

2\> set the *PREAMBLE\_INDEX* to the selected Random Access Preamble.

##### 7.1.1.1.12.3 Test description {#test-description-11 .H6}

##### 7.1.1.1.12.3.1 Pre-test conditions {#pre-test-conditions-11 .H6}

The UE is in NR RRC\_Idle mode (state 1N-A) on NR Cell 1 according to
38.508-1 \[4\] Table 4.4A.2-1.. The NSAG identifier transmitted in SIB1
is same as the NSAG identifier provided to the UE in Registration Accept
message. The UE is assigned the MPS indicator bit of the 5GS network
feature support IE to \"Access identity 1 valid\", in the REGISTRATION
ACCEPT message.

##### 7.1.1.1.12.3.2 Test procedure sequence {#test-procedure-sequence-10 .H6}

Table 7.1.1.1.12.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\--     | *Paging*  | \-      | \- |
|           | transmits |           |           |         |    |
|           | a Paging  |           |           |         |    |
|           | message   |           |           |         |    |
|           | including |           |           |         |    |
|           | a matched |           |           |         |    |
|           | UE        |           |           |         |    |
|           | identity. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | Check:    | \--\>     | PRACH     | 1       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmits |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | using a   |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | in the    |           |           |         |    |
|           | FeatureCo |           |           |         |    |
|           | mbination |           |           |         |    |
|           | Preambles |           |           |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | for NSAG? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \<\--     | Random    | \-      |    |
|           | transmits |           | Access    |         |    |
|           | Random    |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | with      |           |           |         |    |
|           | RAPID not |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to the    |           |           |         |    |
|           | tr        |           |           |         |    |
|           | ansmitted |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 2,        |           |           |         |    |
|           | including |           |           |         |    |
|           | TC-RNTI   |           |           |         |    |
|           | and       |           |           |         |    |
|           | including |           |           |         |    |
|           | Back off  |           |           |         |    |
|           | Indicator |           |           |         |    |
|           | s         |           |           |         |    |
|           | ubheader. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | Check:    | \--\>     | PRACH     | 2       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmits |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | using a   |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | in the    |           |           |         |    |
|           | FeatureCo |           |           |         |    |
|           | mbination |           |           |         |    |
|           | Preambles |           |           |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | for NSAG? |           |           |         |    |
|           | Note 1    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | The SS    | \<\--     | Random    | \-      |    |
|           | transmits |           | Access    |         |    |
|           | Random    |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | with      |           |           |         |    |
|           | RAPID     |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to the    |           |           |         |    |
|           | tr        |           |           |         |    |
|           | ansmitted |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 4,        |           |           |         |    |
|           | including |           |           |         |    |
|           | TC-RNTI   |           |           |         |    |
|           | and not   |           |           |         |    |
|           | including |           |           |         |    |
|           | Back off  |           |           |         |    |
|           | Indicator |           |           |         |    |
|           | s         |           |           |         |    |
|           | ubheader. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           | (         |         |    |
|           | a MAC PDU |           | *RRCSetup |         |    |
|           | c         |           | Request*) |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *RRCSetu  |           |           |         |    |
|           | pRequest* |           |           |         |    |
|           | message.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | schedules |           |           |         |    |
|           | PDCCH     |           | (*        |         |    |
|           | tra       |           | RRCSetup* |         |    |
|           | nsmission |           | and UE    |         |    |
|           | addressed |           | C         |         |    |
|           | to        |           | ontention |         |    |
|           | TC-RNTI   |           | R         |         |    |
|           | to        |           | esolution |         |    |
|           | transmit  |           | Identity  |         |    |
|           | a valid   |           | MAC CE)   |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *         |           |           |         |    |
|           | RRCSetup* |           |           |         |    |
|           | message   |           |           |         |    |
|           | and 'UE   |           |           |         |    |
|           | C         |           |           |         |    |
|           | ontention |           |           |         |    |
|           | R         |           |           |         |    |
|           | esolution |           |           |         |    |
|           | Identity' |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | control   |           |           |         |    |
|           | element   |           |           |         |    |
|           | with      |           |           |         |    |
|           | matched   |           |           |         |    |
|           | 'C        |           |           |         |    |
|           | ontention |           |           |         |    |
|           | R         |           |           |         |    |
|           | esolution |           |           |         |    |
|           | I         |           |           |         |    |
|           | dentity'. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           | (*        |         |    |
|           | a MAC PDU |           | RRCSetupC |         |    |
|           | c         |           | omplete)* |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *RRCSetup |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message   |           |           |         |    |
|           | i         |           |           |         |    |
|           | ndicating |           |           |         |    |
|           | a         |           |           |         |    |
|           | cceptance |           |           |         |    |
|           | of        |           |           |         |    |
|           | *         |           |           |         |    |
|           | RRCSetup* |           |           |         |    |
|           | message.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| The Step  |           |           |           |         |    |
| 4 occurs  |           |           |           |         |    |
| after     |           |           |           |         |    |
| random    |           |           |           |         |    |
| time      |           |           |           |         |    |
| between 0 |           |           |           |         |    |
| and the   |           |           |           |         |    |
| step 3    |           |           |           |         |    |
| Backoff   |           |           |           |         |    |
| indicator |           |           |           |         |    |
| m         |           |           |           |         |    |
| ultiplied |           |           |           |         |    |
| with      |           |           |           |         |    |
| scalin    |           |           |           |         |    |
| gFactorBI |           |           |           |         |    |
| c         |           |           |           |         |    |
| onfigured |           |           |           |         |    |
| in the    |           |           |           |         |    |
| ra-Priori |           |           |           |         |    |
| tizationF |           |           |           |         |    |
| orSlicing |           |           |           |         |    |
| for NSAG. |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.1.12.3.3 Specific message contents {#specific-message-contents-11 .H6}

Table 7.1.1.1.12.3.3-1: SIB 1 (preamble and all steps, Table
7.1.1.1.12.3.2-1)

  Derivation path: TS 38.508-1 \[4\] Table 4.6.1-28                                                      
  --------------------------------------------------- ------------------------- ------------------------ -----------
  Information Element                                 Value/Remark              Comment                  Condition
  SIB1 ::= SEQUENCE {                                                                                    
  servingCellConfigCommon                             ServingCellConfigCommon   Table 7.1.1.1.12.3.3-2   
  }                                                                                                      

Table 7.1.1.1.12.3.3-2: *ServingCellConfigCommon* (Table
7.1.1.1.12.3.3-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                               
  ----------------------------------------------------- ------------------ ------------------------ -----------
  Information Element                                   Value/remark       Comment                  Condition
  ServingCellConfigCommon ::= SEQUENCE {                                                            
  uplinkConfigCommon SEQUENCE {                                                                     
  initialUplinkBWP                                      BWP-UplinkCommon   Table 7.1.1.1.12.3.3-3   
  }                                                                                                 
  }                                                                                                 

Table 7.1.1.1.12.3.3-3: BWP-UplinkCommon (Table 7.1.1.1.12.3.3-2)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-14                                                
  ---------------------------------------------------- ------------------- ------------------------ ---------------
  **Information Element**                              **Value/remark**    **Comment**              **Condition**
  BWP-UplinkCommon ::= SEQUENCE {                                                                   
  enableRA-PrioritizationForSlicing                    true                                         
  AdditionalRACH-ConfigList-r17 SEQUENCE {                                                          
  AdditionalRACH-Config-r17 SEQUENCE {                                                              
  rach-ConfigCommon-r17                                RACH-ConfigCommon   Table 7.1.1.1.12.3.3-4   
  }                                                                                                 
  }                                                                                                 
  }                                                                                                 

Table 7.1.1.1.12.3.3-4: RACH-ConfigCommon *(*Table 7.1.1.1.12.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128                                                                        
  ----------------------------------------------------- ------------------------------------------- ------------------------ -----------
  Information Element                                   Value/remark                                Comment                  Condition
  RACH-ConfigCommon::= SEQUENCE {                                                                                            
  ra-PrioritizationForAccessIdentity-r16 SEQUENCE {                                                                          
  ra-Prioritization-r16                                 RA-Prioritization With condition AI\_RACH                            
  ra-PrioritizationForAI-r16                            \'10\'B                                                              
  }                                                                                                                          
  ra-PrioritizationForSlicing-r17                       *RA-PrioritizationForSlicing*               Table 7.1.1.1.12.3.3-6   
  featureCombinationPreamblesList-r17 SEQUENCE {                                                                             
  FeatureCombinationPreambles-r17                       FeatureCombinationPreambles                 Table 7.1.1.1.12.3.3-5   
  }                                                                                                                          
  }                                                                                                                          

Table 7.1.1.1.12.3.3-5: FeatureCombinationPreambles (Table
7.1.1.1.12.3.3-4)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-56E                                      
  ----------------------------------------------------- -------------- ------------------- -----------
  Information Element                                   Value/remark   Comment             Condition
  FeatureCombinationPreambles-r17 ::= SEQUENCE {                                           
  featureCombination-r17 ::= SEQUENCE {                                                    
  nsag-r17::= SEQUENCE {                                                                   
  nsag-r17\[0\]                                         '0000 0001'B                       
  }                                                                                        
  }                                                                                        
  startPreambleForThisPartition-r17                     8              Randomly selected   
  numberOfPreamblesPerSSB-ForThisPartition-r17          12                                 
  ssb-SharedRO-MaskIndex-r17                            Not present                        
  groupBconfigured-r17                                  Not present                        
  separateMsgA-PUSCH-Config-r17                         Not present                        
  msgA-RSRP-Threshold-r17                               Not present                        
  rsrp-ThresholdSSB-r17                                 Not present                        
  deltaPreamble-r17                                     Not present                        
  }                                                                                        

Table 7.1.1.1.12.3.3-6: *RA-PrioritizationForSlicing* (Table
7.1.1.1.12.3.3-4)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-131A                                                                                                                    
  -------------------------------------------------------------------------------------------------------------- ---------------------------------------------- --------- -----------
  Information Element                                                                                            Value/remark                                   Comment   Condition
  RA-PrioritizationForSlicing-r17::= SEQUENCE {                                                                                                                           
  ra-PrioritizationSliceInfoList-r17 SEQUENCE (SIZE (1..maxSliceInfo-r17)) OF RA-PrioritizationSliceInfo-r17 {   1 entry                                                  
  RA-PrioritizationSliceInfo-r17\[1\] SEQUENCE{                                                                                                                 entry 1   
  nsagIDList-r17 SEQUENCE (SIZE (1..maxSliceInfo-r17)) OF NSAG-ID-r17 {                                          1 entry                                                  
  NSAG-ID-r17                                                                                                    '0000 0001'B                                             
  }                                                                                                                                                                       
  ra-Prioritization-r17                                                                                          RA-Prioritization with condition Slice\_RACH             
  }                                                                                                                                                                       
  }                                                                                                                                                                       
  }                                                                                                                                                                       

Table 7.1.1.1.12.3.3-7: *RA-Prioritization (Table 7.1.1.1.12.3.3-6)*

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-131                            
  ----------------------------------------------------- -------------- --------- -------------
  Information Element                                   Value/remark   Comment   Condition
  RA-Prioritization::= SEQUENCE {                                                
  powerRampingStepHighPriority                          dB0                      AI\_RACH
                                                        dB2                      Slice\_RACH
  scalingFactorBI                                       zero                     AI\_RACH
                                                        dot25                    Slice\_RACH
  }                                                                              

  Condition     Explanation
  ------------- ---------------------------------------------
  AI\_RACH      Access Identity specific RACH configuration
  Slice\_RACH   Slice specific RACH configuration

##### 7.1.1.1.13 Random access procedure / Successful / Slice specific RACH configuration / 2-step RACH

##### 7.1.1.1.13.1 Test Purpose (TP) {#test-purpose-tp-12 .H6}

##### (1) {#section-46 .H6}

**with** { UE in NR RRC\_IDLE state and starts Random Access procedure}

**ensure that** {

**when** { SS configures NSAG indicator and associated set of preambles
in FeatureCombinationPreambles in RACH-ConfigCommonTwoStepRA in SIB1}

**then** { UE transmits a random access preamble using the slice
specific random access resource}

}

##### 7.1.1.1.13.2 Conformance requirements {#conformance-requirements-12 .H6}

References: The conformance requirements covered in the present TC are
specified in: 3GPP TS 38.321, clauses 5.1.1a, 5.1.1c, 5.1.1d, 5.1.2.
Unless otherwise stated these are Rel-17 requirements.

\[TS 38.321, clause 5.1.1a\]

The MAC entity shall:

1\> if *RA\_TYPE* is set to *2-stepRA*:

2\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to
*msgA-PreamblePowerRampingStep*;

2\> set *SCALING\_FACTOR\_BI* to 1;

2\> apply *preambleTransMax* included in the
*RACH-ConfigGenericTwoStepRA;*

2\> if the Random Access procedure was initiated for reconfiguration
with sync or for SCG activation; and

2\> if *cfra-TwoStep* is configured for the selected carrier:

3\> if *msgA-TransMax* is configured in the *cfra-TwoStep*:

4\> apply *msgA-TransMax* configured in the *cfra-TwoStep*.

2\> else if *msgA-TransMax* is included in the
*RACH-ConfigCommonTwoStepRA*:

3\> apply *msgA-TransMax* included in the *RACH-ConfigCommonTwoStepRA.*

2\> if the Random Access procedure was initiated for SpCell beam failure
recovery (as specified in clause 5.17); and

2\> if *beamFailureRecoveryConfig* is configured for the active UL BWP
of the selected carrier; and

2\> if *ra-PrioritizationTwoStep* is configured in the
*beamFailureRecoveryConfig*:

3\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority* included in the
*ra-PrioritizationTwoStep* in *beamFailureRecoveryConfig*;

3\> if *scalingFactorBI* is configured in the *ra-PrioritizationTwoStep*
in *beamFailureRecoveryConfig*:

4\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

2\> else if the Random Access procedure was initiated for
reconfiguration with sync or for SCG activation; and

2\> if *rach-ConfigDedicated* is configured for the selected carrier;
and

2\> if *ra-PrioritizationTwoStep* is configured in the
*rach-ConfigDedicated*:

3\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority* included in the
*ra-PrioritizationTwoStep* in *rach-ConfigDedicated*;

3\> if *scalingFactorBI* is configured in *ra-PrioritizationTwoStep* in
the *rach-ConfigDedicated*:

4\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

2\> else if both *ra-PrioritizationForSlicingTwoStep* for a NSAG
identity and *ra-PrioritizationForAccessIdentityTwoStep* are configured
for the selected carrier; and

2\> if the MAC entity is provided by upper layers with both this NSAG
identity and Access Identity 1 or 2; and

2\> if for at least one of these Access Identities the corresponding bit
in the *ra-PrioritizationForAI* is set to *one*:

3\> if *enableRA-PrioritizationForSlicing* is set to *true*:

4\> if *powerRampingStepHighPriority* is configured in the
*ra-PrioritizationForSlicingTwoStep* for this NSAG identity*:*

5\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority*.

4\> if *scalingFactorBI* is configured in the
*ra-PrioritizationForSlicingTwoStep* for this NSAG identity:

5\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

3\> else if *enableRA-PrioritizationForSlicing* is set to *false*:

4\> if *powerRampingStepHighPriority* is configured in the
*ra-PrioritizationForAccessIdentityTwoStep:*

5\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority*.

4\> if *scalingFactorBI* is configured in the
*ra-PrioritizationForAccessIdentityTwoStep*:

5\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

2\> else if *ra-PrioritizationForSlicingTwoStep* for a NSAG identity is
configured for the selected carrier; and

2\> if the MAC entity is provided by upper layers with this NSAG
identity:

3\> if *powerRampingStepHighPriority* is configured in the
*ra-PrioritizationForSlicingTwoStep* for this NSAG identity*:*

4\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority*.

3\> if *scalingFactorBI* is configured in the
*ra-PrioritizationForSlicingTwoStep* for this NSAG identity:

4\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

\[TS 38.321, clause 5.1.1c\]

The MAC entity shall for each set of configured Random Access resources
for 4-step RA type and for each set of configured Random Access
resources for 2-step RA type:

1\> if RedCap indication is configured for a set of Random Access
resources:

2\> consider the set of Random Access resources as not available for a
Random Access procedure for which RedCap indication is not applicable.

1\> if SDT indication is configured for a set of Random Access
resources:

2\> consider the set of Random Access resources as not available for the
Random Access procedure which is not triggered for SDT.

1\> if NSAG indication is configured for a set of Random Access
resources:

2\> consider the set of Random Access resources as not available for the
Random Access procedure unless it is triggered for the corresponding
NSAG indication.

1\> if MSG3 repetition indication is configured for a set of Random
Access resources:

2\> consider the set of Random Access resources as not available for the
Random Access procedure if MSG3 repetition is not applicable.

1\> if a set of Random Access resources is not configured with any of
the RedCap or SDT or NSAG(s) or MSG3 repetition indications:

2\> consider the set of Random Access resources to not associated with
any feature indication.

\[TS 38.321, clause 5.1.1d\]

The MAC entity shall:

1\> among the available sets of Random Access resources for this Random
Access procedure (as specified in clause 5.1.1c), identify those
configured with a feature which has the highest priority assigned in
*featurePriorities* among all the features applicable to this Random
Access procedure as specified in TS 38.331 \[5\].

1\> if a single set of Random Access resources is identified:

2\> select this set of Random Access resources.

1\> else if more than one set of Random Access resources is identified:

2\> repeat the procedure taking as an input the identified sets of
Random Access resources and the feature applicable to the current Random
Access procedure with the highest priority assigned in
*featurePriorities* among all the features applicable to this Random
Access procedure, except the features considered already.

1\> else (i.e. no set of Random Access resources is identified):

2\> repeat the procedure taking as an input the previous identified
available sets of Random Access resources and the feature applicable to
the current Random Access procedure with the highest priority assigned
in *featurePriorities* among all the features applicable to this Random
Access procedure, except the features considered already.

\[TS 38.321, clause 5.1.2a\]

If the selected *RA\_TYPE* is set to *2-stepRA*, the MAC entity shall:

1\> if the contention-free 2-step RA type Resources associated with SSBs
have been explicitly provided in *rach-ConfigDedicated* and at least one
SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB* amongst the associated
SSBs is available:

2\> select an SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB* amongst
the associated SSBs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB.

1\> else (i.e. for the contention-based Random Access Preamble
selection):

2\> if at least one of the SSBs with SS-RSRP above
*msgA-RSRP-ThresholdSSB* is available:

3\> select an SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> if contention-free Random Access Resources for 2-step RA type have
not been configured and if Random Access Preambles group has not yet
been selected during the current Random Access procedure:

3\> if Random Access Preambles group B for 2-step RA type is configured:

4\> if the potential MSGA payload size (UL data available for
transmission plus MAC subheader and, where required, MAC CEs) is greater
than the *ra-MsgA-SizeGroupA* and the pathloss is less than *PCMAX* (of
the Serving Cell performing the Random Access Procedure) --
*msgA-PreambleReceivedTargetPower* -- *msgA-DeltaPreamble* --
*messagePowerOffsetGroupB*; or

4\> if the Random Access procedure was initiated for the CCCH logical
channel and the CCCH SDU size plus MAC subheader is greater than
*ra-MsgA-SizeGroupA*:

5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

3\> else:

4\> select the Random Access Preambles group A.

2\> else if contention-free Random Access Resources for 2-step RA type
have been configured and if Random Access Preambles group has not yet
been selected during the current Random Access procedure:

3\> if Random Access Preambles group B for 2-step RA type is configured;
and

3\> if the transport block size of the MSGA payload configured in the
*rach-ConfigDedicated* corresponds to the transport block size of the
MSGA payload associated with Random Access Preambles group B:

4\> select the Random Access Preambles group B.

3\> else:

4\> select the Random Access Preambles group A.

2\> else (i.e. Random Access preambles group has been selected during
the current Random Access procedure):

3\> select the same group of Random Access Preambles as was used for the
Random Access Preamble transmission attempt corresponding to the earlier
transmission of MSGA.

2\> select a Random Access Preamble randomly with equal probability from
the 2-step RA type Random Access Preambles associated with the selected
SSB and the selected Random Access Preambles group;

2\> set the *PREAMBLE\_INDEX* to the selected Random Access Preamble.

1\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB permitted by the restrictions given by
the *msgA-SSB-SharedRO-MaskIndex* if configured, or
*ra-ssb-OccasionMaskIndex* *if configured,* or *ssb-SharedRO-MaskIndex*
if configured (the MAC entity shall select a PRACH occasion randomly
with equal probability among the consecutive PRACH occasions allocated
for 2-step RA type according to clause 8.1 of TS 38.213 \[6\] regardless
the FR2 UL gap, corresponding to the selected SSB; the MAC entity may
take into account the possible occurrence of measurement gaps and MUSIM
gaps when determining the next available PRACH occasion corresponding to
the selected SSB);

1\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

2\> select a PUSCH occasion from the PUSCH occasions configured in
*msgA-CFRA-PUSCH* corresponding to the PRACH slot of the selected PRACH
occasion, according to *msgA-PUSCH-Resource-Index* corresponding to the
selected SSB;

2\> determine the UL grant and the associated HARQ information for the
MSGA payload in the selected PUSCH occasion;

2\> deliver the UL grant and the associated HARQ information to the HARQ
entity.

1\> else:

2\> select a PUSCH occasion corresponding to the selected preamble and
PRACH occasion according to clause 8.1A of TS 38.213 \[6\];

2\> determine the UL grant for the MSGA payload according to the PUSCH
configuration associated with the selected Random Access Preambles group
and determine the associated HARQ information;

2\> if the selected preamble and PRACH occasion is mapped to a valid
PUSCH occasion as specified in clause 8.1A of TS 38.213 \[6\]:

3\> deliver the UL grant and the associated HARQ information to the HARQ
entity.

1\> perform the MSGA transmission procedure (see clause 5.1.3a).

NOTE 1: To determine if there is an SSB with *SS-RSRP* above
*msgA-RSRP-ThresholdSSB*, the UE uses the latest unfiltered *L1-RSRP*
measurement.

NOTE 2: If a RedCap UE in RRC\_IDLE or RRC\_INACTIVE mode is configured
with a BWP indicated by *initialDownlinkBWP-RedCap* which is not
associated with any SSB, SS-RSRP measurement is performed based on the
SSB associated with the BWP indicated by *initialDownlinkBWP*.

##### 7.1.1.1.13.3 Test description {#test-description-12 .H6}

##### 7.1.1.1.13.3.1 Pre-test conditions {#pre-test-conditions-12 .H6}

The UE is in NR RRC\_Idle mode (state 1N-A) on NR Cell 1 according to
38.508-1 \[4\] Table 4.4A.2-1. The NSAG identifier transmitted in SIB1
is same as the NSAG identifier provided to the UE in Registration Accept
message.

##### 7.1.1.1.13.3.2 Test procedure sequence {#test-procedure-sequence-11 .H6}

Table 7.1.1.1.13.3.2-1: Main behaviour

+----+--------------+--------------+--------------+---------+----+
| St | Procedure    | Message      | TP           | Verdict |    |
|    |              | Sequence     |              |         |    |
+====+==============+==============+==============+=========+====+
|    |              | U - S        | Message      |         |    |
+----+--------------+--------------+--------------+---------+----+
| 1  | The SS       | \<\--        | *Paging*     | \-      | \- |
|    | transmits a  |              |              |         |    |
|    | Paging       |              |              |         |    |
|    | message      |              |              |         |    |
|    | including a  |              |              |         |    |
|    | matched UE   |              |              |         |    |
|    | identity.    |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 2  | Check: Does  | \--\>        | PRACH        | 1       | P  |
|    | the UE       |              | Preamble     |         |    |
|    | transmits a  |              |              |         |    |
|    | preamble on  |              |              |         |    |
|    | PRACH using  |              |              |         |    |
|    | a preamble   |              |              |         |    |
|    | in the       |              |              |         |    |
|    | Fea          |              |              |         |    |
|    | tureCombinat |              |              |         |    |
|    | ionPreambles |              |              |         |    |
|    | configured   |              |              |         |    |
|    | for NSAG?    |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 3  | Check: Does  | \--\>        | MAC PDU      | 1       | P  |
|    | the UE       |              | (*RRCSe      |         |    |
|    | transmit     |              | tupRequest*) |         |    |
|    | MSGA using   |              |              |         |    |
|    | the PRACH    |              |              |         |    |
|    | Preamble in  |              |              |         |    |
|    | step 2       |              |              |         |    |
|    | associated   |              |              |         |    |
|    | PUSCH        |              |              |         |    |
|    | resource     |              |              |         |    |
|    | containing a |              |              |         |    |
|    | *RRCS        |              |              |         |    |
|    | etupRequest* |              |              |         |    |
|    | message.     |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 4  | The SS       | \<\--        | MAC PDU      | \-      | \- |
|    | schedules    |              |              |         |    |
|    | PDCCH        |              | (successRAR  |         |    |
|    | transmission |              | *,           |         |    |
|    | addressed to |              | RRCSetup*)   |         |    |
|    | MSGB-RNTI    |              |              |         |    |
|    | c            |              |              |         |    |
|    | orresponding |              |              |         |    |
|    | to preamble  |              |              |         |    |
|    | in Step 2 to |              |              |         |    |
|    | transmit a   |              |              |         |    |
|    | valid MAC    |              |              |         |    |
|    | PDU          |              |              |         |    |
|    | containing   |              |              |         |    |
|    | MAC subPDU   |              |              |         |    |
|    | for          |              |              |         |    |
|    | successRAR   |              |              |         |    |
|    | (with        |              |              |         |    |
|    | matching UE  |              |              |         |    |
|    | Contention   |              |              |         |    |
|    | Resolution   |              |              |         |    |
|    | Identity)    |              |              |         |    |
|    | *and MAC     |              |              |         |    |
|    | subPDU for   |              |              |         |    |
|    | RRCSetup*    |              |              |         |    |
|    | message.     |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 5  | The UE       | \--\>        | MAC PDU      | \-      | \- |
|    | transmits a  |              | (*RRCSet     |         |    |
|    | MAC PDU      |              | upComplete)* |         |    |
|    | containing   |              |              |         |    |
|    | an           |              |              |         |    |
|    | *RRCSe       |              |              |         |    |
|    | tupComplete* |              |              |         |    |
|    | message      |              |              |         |    |
|    | indicating   |              |              |         |    |
|    | acceptance   |              |              |         |    |
|    | of           |              |              |         |    |
|    | *RRCSetup*   |              |              |         |    |
|    | message.     |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+

##### 7.1.1.1.13.3.3 Specific message contents {#specific-message-contents-12 .H6}

Table 7.1.1.1.13.3.3-1: SIB 1 (preamble and all steps, Table
7.1.1.1.13.3.2-1)

  Derivation path: TS 38.508-1 \[4\] Table 4.6.1-28                                                      
  --------------------------------------------------- ------------------------- ------------------------ -----------
  Information Element                                 Value/Remark              Comment                  Condition
  SIB1 ::= SEQUENCE {                                                                                    
  servingCellConfigCommon                             ServingCellConfigCommon   Table 7.1.1.1.13.3.3-2   
  }                                                                                                      

Table 7.1.1.1.13.3.3-2: *ServingCellConfigCommon* (Table
7.1.1.1.13.3.3-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                               
  ----------------------------------------------------- ------------------ ------------------------ -----------
  Information Element                                   Value/remark       Comment                  Condition
  ServingCellConfigCommon ::= SEQUENCE {                                                            
  uplinkConfigCommon SEQUENCE {                                                                     
  initialUplinkBWP                                      BWP-UplinkCommon   Table 7.1.1.1.13.3.3-3   
  }                                                                                                 
  }                                                                                                 

Table 7.1.1.1.13.3.3-3: BWP-UplinkCommon (Table 7.1.1.1.13.3.3-2)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-14                                                    
  ---------------------------------------------------- ----------------------- ------------------------ ---------------
  **Information Element**                              **Value/remark**        **Comment**              **Condition**
  BWP-UplinkCommon ::= SEQUENCE {                                                                       
  AdditionalRACH-ConfigList-r17 SEQUENCE {                                                              
  AdditionalRACH-Config-r17 SEQUENCE {                                                                  
  msgA-ConfigCommon-r17                                MsgA-ConfigCommon-r16   Table 7.1.1.1.13.3.3-4   
  }                                                                                                     
  }                                                                                                     
  }                                                                                                     

Table 7.1.1.1.13.3.3-4: *MsgA-ConfigCommon-r16* (Table 7.1.1.1.13.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-81A                                                             
  ----------------------------------------------------- -------------------------------- ------------------------ -----------
  Information Element                                   Value/remark                     Comment                  Condition
  MsgA-ConfigCommon-r16 :: = SEQUENCE {                                                                           
  rach-ConfigCommonTwoStepRA-r16                        RACH-ConfigCommonTwoStepRA-r16   Table 7.1.1.1.13.3.3-5   
  }                                                                                                               

Table 7.1.1.1.13.3.3-5: *RACH-ConfigCommonTwoStepRA-r16* (Table
7.1.1.1.13.3.3-4)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128A                                                          
  ------------------------------------------------------ ----------------------------- ------------------------ -----------
  Information Element                                    Value/remark                  Comment                  Condition
  RACH-ConfigCommonTwoStepRA-r16 ::= SEQUENCE {                                                                 
  featureCombinationPreamblesList-r17 SEQUENCE {                                                                
  FeatureCombinationPreambles-r17                        FeatureCombinationPreambles   Table 7.1.1.1.13.3.3-6   
  }                                                                                                             
  }                                                                                                             

Table 7.1.1.1.13.3.3-6: FeatureCombinationPreambles (Table
7.1.1.1.13.3.3-5)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-56E                                                          
  ----------------------------------------------------- --------------------- -------------------------------- -----------
  Information Element                                   Value/remark          Comment                          Condition
  FeatureCombinationPreambles-r17 ::= SEQUENCE {                                                               
  featureCombination-r17 ::= SEQUENCE {                                                                        
  nsag-r17::= SEQUENCE {                                                                                       
  nsag-r17\[0\]                                         '0000 0001'B                                           
  }                                                                                                            
  }                                                                                                            
  startPreambleForThisPartition-r17                     8                     Randomly selected                
  numberOfPreamblesPerSSB-ForThisPartition-r17          12                                                     
  ssb-SharedRO-MaskIndex-r17                            Not present                                            
  groupBconfigured-r17                                  Not present                                            
  separateMsgA-PUSCH-Config-r17                         *MsgA-PUSCH-Config*   38.508-1 \[4\] table 4.6.3-81B   
  msgA-RSRP-Threshold-r17                               57                    -100 dBm                         
  rsrp-ThresholdSSB-r17                                 RSRP-Range            38.508-1 \[4\] table 4.6.3-152   
  deltaPreamble-r17                                     Not present                                            
  }                                                                                                            

##### 7.1.1.1.14 Random access procedure / Successful/ ra-PrioritizationForSlicingTwoStep / 2-step RACH

##### 7.1.1.1.14.1 Test Purpose (TP) {#test-purpose-tp-13 .H6}

##### (1) {#section-47 .H6}

**with** { UE in NR RRC\_IDLE state and starts Random Access procedure}

**ensure that** {

**when** { SS configures both ra-PrioritizationForSlicingTwoStep for a
NSAG identity and ra-PrioritizationForAccessIdentityTwoStep in SIB1 and
set enableRA-PrioritizationForSlicing to TRUE}

**then** { UE uses powerRampingStepHighPriority and scalingFactorBI
configured in the ra-PrioritizationForSlicing for Random Access
procedure}

}

##### (2) {#section-48 .H6}

**with** { UE in NR RRC\_IDLE state after transmission of a MSGA on NR
SpCell and SS configured scalingFactorBI in
ra-PrioritizationForSlicingTwoStep for a NSAG identity in SIB1 }

**ensure that** {

**when** { SS sends a MSGB including a Backoff Indicator with the Random
Access Preamble identifier different from the value received from the
UE}

**then** { UE performs the Random Access Resource selection procedure
for 2-step RA type Random Access after a random time between 0 and the
indicated Backoff parameter multiplied with scalingFactorBI configured
in the ra-PrioritizationForSlicing }

}

##### 7.1.1.1.14.2 Conformance requirements {#conformance-requirements-13 .H6}

References: The conformance requirements covered in the present TC are
specified in: 3GPP TS 38.321, clauses 5.1.1a, 5.1.1c, 5.1.1d, 5.1.2a.
Unless otherwise stated these are Rel-17 requirements.

\[TS 38.321, clause 5.1.1a\]

The MAC entity shall:

1\> if *RA\_TYPE* is set to *2-stepRA*:

2\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to
*msgA-PreamblePowerRampingStep*;

2\> set *SCALING\_FACTOR\_BI* to 1;

2\> apply *preambleTransMax* included in the
*RACH-ConfigGenericTwoStepRA;*

2\> if the Random Access procedure was initiated for reconfiguration
with sync or for SCG activation; and

2\> if *cfra-TwoStep* is configured for the selected carrier:

3\> if *msgA-TransMax* is configured in the *cfra-TwoStep*:

4\> apply *msgA-TransMax* configured in the *cfra-TwoStep*.

2\> else if *msgA-TransMax* is included in the
*RACH-ConfigCommonTwoStepRA*:

3\> apply *msgA-TransMax* included in the *RACH-ConfigCommonTwoStepRA.*

2\> if the Random Access procedure was initiated for SpCell beam failure
recovery (as specified in clause 5.17); and

2\> if *beamFailureRecoveryConfig* is configured for the active UL BWP
of the selected carrier; and

2\> if *ra-PrioritizationTwoStep* is configured in the
*beamFailureRecoveryConfig*:

3\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority* included in the
*ra-PrioritizationTwoStep* in *beamFailureRecoveryConfig*;

3\> if *scalingFactorBI* is configured in the *ra-PrioritizationTwoStep*
in *beamFailureRecoveryConfig*:

4\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

2\> else if the Random Access procedure was initiated for
reconfiguration with sync or for SCG activation; and

2\> if *rach-ConfigDedicated* is configured for the selected carrier;
and

2\> if *ra-PrioritizationTwoStep* is configured in the
*rach-ConfigDedicated*:

3\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority* included in the
*ra-PrioritizationTwoStep* in *rach-ConfigDedicated*;

3\> if *scalingFactorBI* is configured in *ra-PrioritizationTwoStep* in
the *rach-ConfigDedicated*:

4\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

2\> else if both *ra-PrioritizationForSlicingTwoStep* for a NSAG
identity and *ra-PrioritizationForAccessIdentityTwoStep* are configured
for the selected carrier; and

2\> if the MAC entity is provided by upper layers with both this NSAG
identity and Access Identity 1 or 2; and

2\> if for at least one of these Access Identities the corresponding bit
in the *ra-PrioritizationForAI* is set to *one*:

3\> if *enableRA-PrioritizationForSlicing* is set to *true*:

4\> if *powerRampingStepHighPriority* is configured in the
*ra-PrioritizationForSlicingTwoStep* for this NSAG identity*:*

5\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority*.

4\> if *scalingFactorBI* is configured in the
*ra-PrioritizationForSlicingTwoStep* for this NSAG identity:

5\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

3\> else if *enableRA-PrioritizationForSlicing* is set to *false*:

4\> if *powerRampingStepHighPriority* is configured in the
*ra-PrioritizationForAccessIdentityTwoStep:*

5\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority*.

4\> if *scalingFactorBI* is configured in the
*ra-PrioritizationForAccessIdentityTwoStep*:

5\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

2\> else if *ra-PrioritizationForSlicingTwoStep* for a NSAG identity is
configured for the selected carrier; and

2\> if the MAC entity is provided by upper layers with this NSAG
identity:

3\> if *powerRampingStepHighPriority* is configured in the
*ra-PrioritizationForSlicingTwoStep* for this NSAG identity*:*

4\> set *PREAMBLE\_POWER\_RAMPING\_STEP* to the
*powerRampingStepHighPriority*.

3\> if *scalingFactorBI* is configured in the
*ra-PrioritizationForSlicingTwoStep* for this NSAG identity:

4\> set *SCALING\_FACTOR\_BI* to the *scalingFactorBI*.

\[TS 38.321, clause 5.1.1c\]

The MAC entity shall for each set of configured Random Access resources
for 4-step RA type and for each set of configured Random Access
resources for 2-step RA type:

1\> if RedCap indication is configured for a set of Random Access
resources:

2\> consider the set of Random Access resources as not available for a
Random Access procedure for which RedCap indication is not applicable.

1\> if SDT indication is configured for a set of Random Access
resources:

2\> consider the set of Random Access resources as not available for the
Random Access procedure which is not triggered for SDT.

1\> if NSAG indication is configured for a set of Random Access
resources:

2\> consider the set of Random Access resources as not available for the
Random Access procedure unless it is triggered for the corresponding
NSAG indication.

1\> if MSG3 repetition indication is configured for a set of Random
Access resources:

2\> consider the set of Random Access resources as not available for the
Random Access procedure if MSG3 repetition is not applicable.

1\> if a set of Random Access resources is not configured with any of
the RedCap or SDT or NSAG(s) or MSG3 repetition indications:

2\> consider the set of Random Access resources to not associated with
any feature indication.

\[TS 38.321, clause 5.1.1d\]

The MAC entity shall:

1\> among the available sets of Random Access resources for this Random
Access procedure (as specified in clause 5.1.1c), identify those
configured with a feature which has the highest priority assigned in
*featurePriorities* among all the features applicable to this Random
Access procedure as specified in TS 38.331 \[5\].

1\> if a single set of Random Access resources is identified:

2\> select this set of Random Access resources.

1\> else if more than one set of Random Access resources is identified:

2\> repeat the procedure taking as an input the identified sets of
Random Access resources and the feature applicable to the current Random
Access procedure with the highest priority assigned in
*featurePriorities* among all the features applicable to this Random
Access procedure, except the features considered already.

1\> else (i.e. no set of Random Access resources is identified):

2\> repeat the procedure taking as an input the previous identified
available sets of Random Access resources and the feature applicable to
the current Random Access procedure with the highest priority assigned
in *featurePriorities* among all the features applicable to this Random
Access procedure, except the features considered already.

\[TS 38.321, clause 5.1.2a\]

If the selected *RA\_TYPE* is set to *2-stepRA*, the MAC entity shall:

1\> if the contention-free 2-step RA type Resources associated with SSBs
have been explicitly provided in *rach-ConfigDedicated* and at least one
SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB* amongst the associated
SSBs is available:

2\> select an SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB* amongst
the associated SSBs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB.

1\> else (i.e. for the contention-based Random Access Preamble
selection):

2\> if at least one of the SSBs with SS-RSRP above
*msgA-RSRP-ThresholdSSB* is available:

3\> select an SSB with SS-RSRP above *msgA-RSRP-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> if contention-free Random Access Resources for 2-step RA type have
not been configured and if Random Access Preambles group has not yet
been selected during the current Random Access procedure:

3\> if Random Access Preambles group B for 2-step RA type is configured:

4\> if the potential MSGA payload size (UL data available for
transmission plus MAC subheader and, where required, MAC CEs) is greater
than the *ra-MsgA-SizeGroupA* and the pathloss is less than *PCMAX* (of
the Serving Cell performing the Random Access Procedure) --
*msgA-PreambleReceivedTargetPower* -- *msgA-DeltaPreamble* --
*messagePowerOffsetGroupB*; or

4\> if the Random Access procedure was initiated for the CCCH logical
channel and the CCCH SDU size plus MAC subheader is greater than
*ra-MsgA-SizeGroupA*:

5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

3\> else:

4\> select the Random Access Preambles group A.

2\> else if contention-free Random Access Resources for 2-step RA type
have been configured and if Random Access Preambles group has not yet
been selected during the current Random Access procedure:

3\> if Random Access Preambles group B for 2-step RA type is configured;
and

3\> if the transport block size of the MSGA payload configured in the
*rach-ConfigDedicated* corresponds to the transport block size of the
MSGA payload associated with Random Access Preambles group B:

4\> select the Random Access Preambles group B.

3\> else:

4\> select the Random Access Preambles group A.

2\> else (i.e. Random Access preambles group has been selected during
the current Random Access procedure):

3\> select the same group of Random Access Preambles as was used for the
Random Access Preamble transmission attempt corresponding to the earlier
transmission of MSGA.

2\> select a Random Access Preamble randomly with equal probability from
the 2-step RA type Random Access Preambles associated with the selected
SSB and the selected Random Access Preambles group;

2\> set the *PREAMBLE\_INDEX* to the selected Random Access Preamble.

1\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB permitted by the restrictions given by
the *msgA-SSB-SharedRO-MaskIndex* if configured, or
*ra-ssb-OccasionMaskIndex* *if configured,* or *ssb-SharedRO-MaskIndex*
if configured (the MAC entity shall select a PRACH occasion randomly
with equal probability among the consecutive PRACH occasions allocated
for 2-step RA type according to clause 8.1 of TS 38.213 \[6\] regardless
the FR2 UL gap, corresponding to the selected SSB; the MAC entity may
take into account the possible occurrence of measurement gaps and MUSIM
gaps when determining the next available PRACH occasion corresponding to
the selected SSB);

1\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

2\> select a PUSCH occasion from the PUSCH occasions configured in
*msgA-CFRA-PUSCH* corresponding to the PRACH slot of the selected PRACH
occasion, according to *msgA-PUSCH-Resource-Index* corresponding to the
selected SSB;

2\> determine the UL grant and the associated HARQ information for the
MSGA payload in the selected PUSCH occasion;

2\> deliver the UL grant and the associated HARQ information to the HARQ
entity.

1\> else:

2\> select a PUSCH occasion corresponding to the selected preamble and
PRACH occasion according to clause 8.1A of TS 38.213 \[6\];

2\> determine the UL grant for the MSGA payload according to the PUSCH
configuration associated with the selected Random Access Preambles group
and determine the associated HARQ information;

2\> if the selected preamble and PRACH occasion is mapped to a valid
PUSCH occasion as specified in clause 8.1A of TS 38.213 \[6\]:

3\> deliver the UL grant and the associated HARQ information to the HARQ
entity.

1\> perform the MSGA transmission procedure (see clause 5.1.3a).

NOTE 1: To determine if there is an SSB with *SS-RSRP* above
*msgA-RSRP-ThresholdSSB*, the UE uses the latest unfiltered *L1-RSRP*
measurement.

NOTE 2: If a RedCap UE in RRC\_IDLE or RRC\_INACTIVE mode is configured
with a BWP indicated by *initialDownlinkBWP-RedCap* which is not
associated with any SSB, SS-RSRP measurement is performed based on the
SSB associated with the BWP indicated by *initialDownlinkBWP*.

##### 7.1.1.1.14.3 Test description {#test-description-13 .H6}

##### 7.1.1.1.14.3.1 Pre-test conditions {#pre-test-conditions-13 .H6}

The UE is in NR RRC\_Idle mode (state 1N-A) on NR Cell 1 according to
38.508-1 \[4\] Table 4.4A.2-1. The NSAG identifier transmitted in SIB1
is same as the NSAG identifier provided to the UE in Registration Accept
message. The UE is assigned the MPS indicator bit of the 5GS network
feature support IE to \"Access identity 1 valid\", in the REGISTRATION
ACCEPT message.

##### 7.1.1.1.14.3.2 Test procedure sequence {#test-procedure-sequence-12 .H6}

Table 7.1.1.1.14.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\--     | *Paging*  | \-      | \- |
|           | transmits |           |           |         |    |
|           | a Paging  |           |           |         |    |
|           | message   |           |           |         |    |
|           | including |           |           |         |    |
|           | a matched |           |           |         |    |
|           | UE        |           |           |         |    |
|           | identity. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | Check:    | \--\>     | PRACH     | 1       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmits |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | using a   |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | in the    |           |           |         |    |
|           | FeatureCo |           |           |         |    |
|           | mbination |           |           |         |    |
|           | Preambles |           |           |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | for NSAG? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | Check:    | \--\>     | MAC PDU   | 1       | P  |
|           | Does the  |           | (         |         |    |
|           | UE        |           | *RRCSetup |         |    |
|           | transmit  |           | Request*) |         |    |
|           | MSGA      |           |           |         |    |
|           | using the |           |           |         |    |
|           | PRACH     |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | in step 2 |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssociated |           |           |         |    |
|           | PUSCH     |           |           |         |    |
|           | resource  |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a         |           |           |         |    |
|           | *RRCSetu  |           |           |         |    |
|           | pRequest* |           |           |         |    |
|           | message.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | schedules |           |           |         |    |
|           | PDCCH     |           | (s        |         |    |
|           | tra       |           | uccessRAR |         |    |
|           | nsmission |           | *,Back    |         |    |
|           | addressed |           | off       |         |    |
|           | to        |           | I         |         |    |
|           | MSGB-RNTI |           | ndicator* |         |    |
|           | corr      |           | )         |         |    |
|           | esponding |           |           |         |    |
|           | to        |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | in Step 2 |           |           |         |    |
|           | to        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a valid   |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | subPDU    |           |           |         |    |
|           | for       |           |           |         |    |
|           | successRA |           |           |         |    |
|           | R(without |           |           |         |    |
|           | matching  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | C         |           |           |         |    |
|           | ontention |           |           |         |    |
|           | R         |           |           |         |    |
|           | esolution |           |           |         |    |
|           | Identity) |           |           |         |    |
|           | and       |           |           |         |    |
|           | including |           |           |         |    |
|           | Back off  |           |           |         |    |
|           | Indicator |           |           |         |    |
|           | su        |           |           |         |    |
|           | bheader.. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Check:    | \--\>     | PRACH     | 2       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmits |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | using a   |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | in the    |           |           |         |    |
|           | FeatureCo |           |           |         |    |
|           | mbination |           |           |         |    |
|           | Preambles |           |           |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | for NSAG? |           |           |         |    |
|           | Note 1    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | Does the  |           | (         |         |    |
|           | UE        |           | *RRCSetup |         |    |
|           | transmit  |           | Request*) |         |    |
|           | MSGA      |           |           |         |    |
|           | using the |           |           |         |    |
|           | PRACH     |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | in step 5 |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssociated |           |           |         |    |
|           | PUSCH     |           |           |         |    |
|           | resource  |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a         |           |           |         |    |
|           | *RRCSetu  |           |           |         |    |
|           | pRequest* |           |           |         |    |
|           | message.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | schedules |           |           |         |    |
|           | PDCCH     |           | (s        |         |    |
|           | tra       |           | uccessRAR |         |    |
|           | nsmission |           | *,        |         |    |
|           | addressed |           | R         |         |    |
|           | to        |           | RCSetup*) |         |    |
|           | MSGB-RNTI |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to        |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | in Step 2 |           |           |         |    |
|           | to        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a valid   |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | subPDU    |           |           |         |    |
|           | for       |           |           |         |    |
|           | s         |           |           |         |    |
|           | uccessRAR |           |           |         |    |
|           | (with     |           |           |         |    |
|           | matching  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | C         |           |           |         |    |
|           | ontention |           |           |         |    |
|           | R         |           |           |         |    |
|           | esolution |           |           |         |    |
|           | Identity) |           |           |         |    |
|           | *and MAC  |           |           |         |    |
|           | subPDU    |           |           |         |    |
|           | for       |           |           |         |    |
|           | RRCSetup* |           |           |         |    |
|           | message.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           | (*        |         |    |
|           | a MAC PDU |           | RRCSetupC |         |    |
|           | c         |           | omplete)* |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *RRCSetup |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message   |           |           |         |    |
|           | i         |           |           |         |    |
|           | ndicating |           |           |         |    |
|           | a         |           |           |         |    |
|           | cceptance |           |           |         |    |
|           | of        |           |           |         |    |
|           | *         |           |           |         |    |
|           | RRCSetup* |           |           |         |    |
|           | message.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| The Step  |           |           |           |         |    |
| 5 occurs  |           |           |           |         |    |
| after     |           |           |           |         |    |
| random    |           |           |           |         |    |
| time      |           |           |           |         |    |
| between 0 |           |           |           |         |    |
| and the   |           |           |           |         |    |
| step 4    |           |           |           |         |    |
| Backoff   |           |           |           |         |    |
| indicator |           |           |           |         |    |
| m         |           |           |           |         |    |
| ultiplied |           |           |           |         |    |
| with      |           |           |           |         |    |
| scalin    |           |           |           |         |    |
| gFactorBI |           |           |           |         |    |
| c         |           |           |           |         |    |
| onfigured |           |           |           |         |    |
| in the    |           |           |           |         |    |
| ra-Priori |           |           |           |         |    |
| tizationF |           |           |           |         |    |
| orSlicing |           |           |           |         |    |
| for NSAG. |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.1.14.3.3 Specific message contents {#specific-message-contents-13 .H6}

Table 7.1.1.1.14.3.3-1: SIB 1 (preamble and all steps, Table
7.1.1.1.14.3.2-1)

  Derivation path: TS 38.508-1 \[4\] Table 4.6.1-28                                                      
  --------------------------------------------------- ------------------------- ------------------------ -----------
  Information Element                                 Value/Remark              Comment                  Condition
  SIB1 ::= SEQUENCE {                                                                                    
  servingCellConfigCommon                             ServingCellConfigCommon   Table 7.1.1.1.14.3.3-2   
  }                                                                                                      

Table 7.1.1.1.14.3.3-2: *ServingCellConfigCommon* (Table
7.1.1.1.14.3.3-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                               
  ----------------------------------------------------- ------------------ ------------------------ -----------
  Information Element                                   Value/remark       Comment                  Condition
  ServingCellConfigCommon ::= SEQUENCE {                                                            
  uplinkConfigCommon SEQUENCE {                                                                     
  initialUplinkBWP                                      BWP-UplinkCommon   Table 7.1.1.1.14.3.3-3   
  }                                                                                                 
  }                                                                                                 

Table 7.1.1.1.14.3.3-3: BWP-UplinkCommon (Table 7.1.1.1.14.3.3-2)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-14                                                    
  ---------------------------------------------------- ----------------------- ------------------------ ---------------
  **Information Element**                              **Value/remark**        **Comment**              **Condition**
  BWP-UplinkCommon ::= SEQUENCE {                                                                       
  enableRA-PrioritizationForSlicing                    true                                             
  AdditionalRACH-ConfigList-r17 SEQUENCE {                                                              
  AdditionalRACH-Config-r17 SEQUENCE {                                                                  
  msgA-ConfigCommon-r17                                MsgA-ConfigCommon-r16   Table 7.1.1.1.14.3.3-4   
  }                                                                                                     
  }                                                                                                     
  }                                                                                                     

Table 7.1.1.1.14.3.3-4: *MsgA-ConfigCommon-r16* (Table 7.1.1.1.14.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-81A                                                             
  ----------------------------------------------------- -------------------------------- ------------------------ -----------
  Information Element                                   Value/remark                     Comment                  Condition
  MsgA-ConfigCommon-r16 :: = SEQUENCE {                                                                           
  rach-ConfigCommonTwoStepRA-r16                        RACH-ConfigCommonTwoStepRA-r16   Table 7.1.1.1.14.3.3-5   
  }                                                                                                               

Table 7.1.1.1.14.3.3-5: *RACH-ConfigCommonTwoStepRA-r16* (Table
7.1.1.1.14.3.3-4)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128A                                                             
  ---------------------------------------------------------- ------------------------------------------- --------- -----------
  Information Element                                        Value/remark                                Comment   Condition
  RACH-ConfigCommonTwoStepRA-r16 ::= SEQUENCE {                                                                    
  ra-PrioritizationForAccessIdentityTwoStep-r16 SEQUENCE {                                                         
  ra-Prioritization-r16                                      RA-Prioritization With condition AI\_RACH             
  ra-PrioritizationForAI-r16                                 \'10\'B                                               
  }                                                                                                                
  ra-PrioritizationForSlicingTwoStep-r17                     *RA-PrioritizationForSlicing*                         
  featureCombinationPreamblesList-r17 SEQUENCE {                                                                   
  FeatureCombinationPreambles-r17                            FeatureCombinationPreambles                           
  }                                                                                                                
  }                                                                                                                

Table 7.1.1.1.14.3.3-6: FeatureCombinationPreambles (Table
7.1.1.1.14.3.3-5)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-56E                                                    
  ----------------------------------------------------- --------------------- -------------------------- -----------
  Information Element                                   Value/remark          Comment                    Condition
  FeatureCombinationPreambles-r17 ::= SEQUENCE {                                                         
  featureCombination-r17 ::= SEQUENCE {                                                                  
  nsag-r17::= SEQUENCE {                                                                                 
  nsag-r17\[0\]                                         '0000 0001'B                                     
  }                                                                                                      
  }                                                                                                      
  startPreambleForThisPartition-r17                     8                     Randomly selected          
  numberOfPreamblesPerSSB-ForThisPartition-r17          12                                               
  ssb-SharedRO-MaskIndex-r17                            Not present                                      
  groupBconfigured-r17                                  Not present                                      
  separateMsgA-PUSCH-Config-r17                         *MsgA-PUSCH-Config*   38.508-1 table 4.6.3-81B   
  msgA-RSRP-Threshold-r17                               57                    -100 dBm                   
  rsrp-ThresholdSSB-r17                                 RSRP-Range            38.508-1 table 4.6.3-152   
  deltaPreamble-r17                                     Not present                                      
  }                                                                                                      

Table 7.1.1.1.14.3.3-7: *RA-PrioritizationForSlicing* (Table
7.1.1.1.14.3.3-5)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-131A                                                                                                                    
  -------------------------------------------------------------------------------------------------------------- ---------------------------------------------- --------- -----------
  Information Element                                                                                            Value/remark                                   Comment   Condition
  RA-PrioritizationForSlicing-r17::= SEQUENCE {                                                                                                                           
  ra-PrioritizationSliceInfoList-r17 SEQUENCE (SIZE (1..maxSliceInfo-r17)) OF RA-PrioritizationSliceInfo-r17 {   1 entry                                                  
  RA-PrioritizationSliceInfo-r17\[1\] SEQUENCE{                                                                                                                 entry 1   
  nsagIDList-r17 SEQUENCE (SIZE (1..maxSliceInfo-r17)) OF NSAG-ID-r17 {                                          1 entry                                                  
  NSAG-ID-r17                                                                                                    '0000 0001'B                                             
  }                                                                                                                                                                       
  ra-Prioritization-r17                                                                                          RA-Prioritization with condition Slice\_RACH             
  }                                                                                                                                                                       
  }                                                                                                                                                                       
  }                                                                                                                                                                       

Table 7.1.1.1.14.3.3-8: *RA-Prioritization (Table 7.1.1.1.14.3.3-7)*

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-131                            
  ----------------------------------------------------- -------------- --------- -------------
  Information Element                                   Value/remark   Comment   Condition
  RA-Prioritization::= SEQUENCE {                                                
  powerRampingStepHighPriority                          dB0                      AI\_RACH
                                                        dB2                      Slice\_RACH
  scalingFactorBI                                       zero                     AI\_RACH
                                                        dot25                    Slice\_RACH
  }                                                                              

  Condition     Explanation
  ------------- ---------------------------------------------
  AI\_RACH      Access Identity specific RACH configuration
  Slice\_RACH   Slice specific RACH configuration

##### 7.1.1.1.15 Random access procedure / RedCap UE / SI request

##### 7.1.1.1.15.1 Test Purpose (TP) {#test-purpose-tp-14 .H6}

##### (1) {#section-49 .H6}

**with** { UE in RRC\_Idle State and initialUplinkBWP-RedCap and
si-RequestConfigRedCap is configured in SIB1 of Serving Cell}

**ensure that** {

**when** { one System information,which *si-BroadcastStatus* is set to
*notBroadcasting,* is updated }

**then** { UE transmitted PRACH preamble for System information request
using the PRACH preamble(s) and PRACH resource(s) in
si-RequestConfigRedcap and retransmitted PRACH preamble when
ra-ResponseWindow has expired }

}

##### (2) {#section-50 .H6}

**with** { UE in RRC\_Idle State and transmitted PRACH preamble for
System information request }

**ensure that** {

**when** { UE received a RAR message addressed to RA-RNTI and including
matching RAPID only }

**then** { UE considers the RACH procedure to be successfully completed
and informs the upper layer }

}

##### 7.1.1.1.15.2 Conformance requirements {#conformance-requirements-14 .H6}

References: The conformance requirements covered in the present test
case are specified in: TS 38.321, clauses 5.1.1 and 5.1.2, TS38.331,
clauses 5.2.2.3.3 and 6.3.2. Unless otherwise stated these are Rel-17
requirements.

\[TS 38.321, clause 5.1.1\]

\- *ra-PreambleStartIndex*: the starting index of Random Access
Preamble(s) for on-demand SI request;

\[TS 38.321, clause 5.1.2\]

If the selected *RA\_TYPE* is set to *4-stepRA*, the MAC entity shall:

...

1\> else if the Random Access procedure was initiated for SI request (as
specified in TS 38.331 \[5\]); and

1\> if the Random Access Resources for SI request have been explicitly
provided by RRC:

2\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
is available:

3\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> select a Random Access Preamble corresponding to the selected SSB,
from the Random Access Preamble(s) determined according to
*ra-PreambleStartIndex* as specified in TS 38.331 \[5\];

2\> set the *PREAMBLE\_INDEX* to selected Random Access Preamble.

\[TS 38.331, clause 5.2.2.3.3\]

The UE shall, while SDT procedure is not ongoing:

...

1\> else if the UE is a RedCap UE and if ***initialUplinkBWP-RedCap***
is configured in *UplinkConfigCommonSIB* and if *SIB1* includes
*si-SchedulingInfo* containing *si-RequestConfigRedCap* and criteria to
select normal uplink as defined in TS 38.321\[3\], clause 5.1.1 is met:

2\> trigger the lower layer to initiate the Random Access procedure on
normal uplink in accordance with TS 38.321 \[3\] using the PRACH
preamble(s) and PRACH resource(s) in *si-RequestConfigRedcap*
corresponding to the SI message(s) that the UE requires to operate
within the cell, and for which *si-BroadcastStatus* is set to
*notBroadcasting*;

2\> if acknowledgement for SI request is received from lower layers:

3\> acquire the requested SI message(s) as defined in clause 5.2.2.3.2,
immediately;

1\> else:

2\> if the UE is not a RedCap UE and if *SIB1* includes
*si-SchedulingInfo* containing *si-RequestConfig* and criteria to select
normal uplink as defined in TS 38.321\[3\], clause 5.1.1 is met; or

2\> if the UE is a RedCap UE and if ***initialUplinkBWP-RedCap*** is not
configured in *UplinkConfigCommonSIB* and if *SIB1* includes
*si-SchedulingInfo* containing *si-RequestConfig* and criteria to select
normal uplink as defined in TS 38.321\[3\], clause 5.1.1 is met:

3\> trigger the lower layer to initiate the Random Access procedure on
normal uplink in accordance with TS 38.321 \[3\] using the PRACH
preamble(s) and PRACH resource(s) in *si-RequestConfig* corresponding to
the SI message(s) that the UE requires to operate within the cell, and
for which *si-BroadcastStatus* is set to *notBroadcasting*;

3\> if acknowledgement for SI request is received from lower layers:

4\> acquire the requested SI message(s) as defined in clause 5.2.2.3.2,
immediately;

\[TS 38.331, clause 6.3.2\]

***si-RequestConfigRedCap***

Configuration of Msg1 resources for ***initialUplinkBWP-RedCap*** that
the ***RedCap*** UE uses for requesting SI-messages for which
*si-BroadcastStatus* is set to *notBroadcasting*.

##### 7.1.1.1.15.3 Test description {#test-description-14 .H6}

##### 7.1.1.1.15.3.1 Pre-test conditions {#pre-test-conditions-14 .H6}

System Simulator:

> \- NR Cell 1 and NR Cell 11.

\- System information combination NR-3 as defined in TS 38.508-1 \[4\]
clause 4.4.3.1.3 is used in NR Cell 1.

UE:

> \- None.

Preamble:

\- The UE is in NR RRC\_Idle mode (state 1N-A) on NR Cell 1 according to
38.508-1 \[4\] Table 4.4A.2-1.

##### 7.1.1.1.15.3.2 Test procedure sequence {#test-procedure-sequence-13 .H6}

Same test procedure sequence as in clause 7.1.1.1.3.3.3 with the
following differences:

Table 7.1.1.1.15.3.2-3 is the same as Table 7.1.1.1.3.3.2-3 with the
exception that the preamble is indicated by *ra-PreambleStartIndex*
defined in SI-*RequestConfigRedCap* in *SIB1* in Table 7.1.1.1.15.3.3-1
in step 5/6/7/8.

##### 7.1.1.1.15.3.3 Specific message contents {#specific-message-contents-14 .H6}

Table 7.1.1.1.15.3.3-1: *SIB1* on NR Cell 1 (Step 4, Table
7.1.1.1.15.3.2-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-28                                                                                               
  ---------------------------------------------------- ---------------------------- -------------------------------------------------------------- -----------
  Information Element                                  Value/remark                 Comment                                                        Condition
  SIB1 ::= SEQUENCE {                                                                                                                              
  si-SchedulingInfo SEQUENCE {                                                                                                                     
  schedulingInfoList SEQUENCE {                        2 entries                                                                                   
  si-BroadcastStatus\[1\]                              Broadcasting                                                                                
  si-Periodicity\[1\]                                  rf32                                                                                        
  sib-MappingInfo\[1\] SEQUENCE {                                                                                                                  
  type                                                 SibType2                                                                                    
  valueTag                                             0                                                                                           
  areaScope                                            Not present                                                                                 
  }                                                                                                                                                
  si-BroadcastStatus\[2\]                              notBroadcasting                                                                             
  si-Periodicity\[2\]                                  rf64                                                                                        
  sib-MappingInfo\[2\] SEQUENCE {                                                                                                                  
  type                                                 SibType3                                                                                    
  valueTag                                             1                                                                                           
  areaScope                                            Not present                                                                                 
  }                                                                                                                                                
  }                                                                                                                                                
  si-RequestConfig SEQUENCE {                                                                                                                      
  rach-OccasionsSI SEQUENCE {                                                                                                                      
  rach-ConfigSI                                        RACH-ConfigGeneric           TS 38.508-1 \[4\], Table 4.6.3-130                             
  ssb-perRACH-Occasion                                 one                                                                                         
  }                                                                                                                                                
  si-RequestPeriod                                     two                                                                                         
  si-RequestResources SEQUENCE {                       1 entry                                                                                     
  ra-PreambleStartIndex\[1\]                           52                                                                                          
  ra-AssociationPeriodIndex\[1\]                       0                                                                                           
  ra-ssb-OccasionMaskIndex\[1\]                        0                                                                                           
  }                                                                                                                                                
  }                                                                                                                                                
  si-RequestConfigSUL                                  Not present                                                                                 
  }                                                                                                                                                
  servingCellConfigCommon                              ServingCellConfigCommonSIB   Table 7.1.1.1.15.3.3-2                                         
  nonCriticalExtension SEQUENCE {                                                                                                                  
  nonCriticalExtension SEQUENCE {                                                                                                                  
  nonCriticalExtension SEQUENCE {                                                                                                                  
  nonCriticalExtension SEQUENCE {                                                                                                                  
  si-SchedulingInfo-v1740 SEQUENCE {                                                                                                               
  si-RequestConfigRedCap-r17 SEQUENCE {                                                                                                            
  rach-OccasionsSI SEQUENCE {                                                                                                                      
  rach-ConfigSI                                        RACH-ConfigGeneric           TS 38.508-1 \[4\], Table 4.6.3-130                             
  ssb-perRACH-Occasion                                 one                                                                                         
  }                                                                                                                                                
  si-RequestPeriod                                     two                                                                                         
  si-RequestResources SEQUENCE {                       1 entry                                                                                     
  ra-PreambleStartIndex\[1\]                           53                           Different from the ra-PreambleStartIndex in si-RequestConfig   
  ra-AssociationPeriodIndex\[1\]                       0                                                                                           
  ra-ssb-OccasionMaskIndex\[1\]                        0                                                                                           
  }                                                                                                                                                
  }                                                                                                                                                
  nonCriticalExtension                                 Not present                                                                                 
  }                                                                                                                                                
  }                                                                                                                                                
  }                                                                                                                                                
  }                                                                                                                                                
  }                                                                                                                                                

Table 7.1.1.1.15.3.3-2: *ServingCellConfigCommonSIB* (Table
7.1.1.1.15.3.3-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-169                                               
  ----------------------------------------------------- ------------------ ------------------------ -----------
  Information Element                                   Value/remark       Comment                  Condition
  ServingCellConfigCommonSIB ::= SEQUENCE {                                                         
  uplinkConfigCommon-v1700 ::= SEQUENCE {                                                           
  initialUplinkBWP-RedCap-r17                           BWP-UplinkCommon   Table 7.1.1.1.15.3.3-3   
  }                                                                                                 
  }                                                                                                 

Table 7.1.1.1.15.3.3-3: *BWP-UplinkCommon* (Table 7.1.1.1.15.3.3-2)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-14                                                 
  ---------------------------------------------------- -------------------- ------------------------ -----------
  Information Element                                  Value/remark         Comment                  Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                                    
  pucch-ConfigCommon CHOICE {                                                                        
  setup                                                PUCCH-ConfigCommon   Table 7.1.1.1.15.3.3-4   
  }                                                                                                  
  }                                                                                                  

Table 7.1.1.1.15.3.3-4: *PUCCH-ConfigCommon* (Table 7.1.1.1.15.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-113                            
  ----------------------------------------------------- -------------- --------- -----------
  Information Element                                   Value/remark   Comment   Condition
  PUCCH-ConfigCommon ::= SEQUENCE {                                              
  pucch-ResourceCommon                                  Not present              
  pucch-ResourceCommonRedCap-r17                        0                        
  }                                                                              

Table 7.1.1.1.15.3.3-5: *SIB3* on NR Cell 1 (Preamble and Step 9A, Table
7.1.1.1.15.3.2-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.2-2                                                                                       
  --------------------------------------------------- ------------------------------------------------------------------------ ---------- -----------
  Information Element                                 Value/remark                                                             Comment    Condition
  SIB3 ::= SEQUENCE {                                                                                                                     
  intraFreqNeighCellList SEQUENCE {                                                                                                       
  physCellId                                          The cell identity of NR Cell 11 defined in 38.508-1 \[4\] clause 4.4.2              
  q-OffsetCell                                        16                                                                       Preamble   
                                                      -10                                                                      Step 9A    
  }                                                                                                                                       
  }                                                                                                                                       

##### 7.1.1.1.16 Random access procedure / RedCap UE identification / Msg3-based / CCCH1

##### 7.1.1.1.16.1 Test Purpose (TP) {#test-purpose-tp-15 .H6}

##### (1) {#section-51 .H6}

**with** { UE supporting RedCap and in NR RRC\_Inactive state }

**ensure that** {

**when** { UE starts Random Access procedure }

**then** { the UE uses the RedCap specific LCID in Msg3}

}

##### 7.1.1.1.16.2 Conformance requirements {#conformance-requirements-15 .H6}

References: The conformance requirements covered in the present test
case are specified in: TS 38.321, clause 6.2.1 and TS38.331,clause
5.3.13.3. Unless otherwise stated these are Rel-17 requirements.

\[TS 38.321, clause 6.2.1\]

Table 6.2.1-2 Values of LCID for UL-SCH

  Codepoint/Index   LCID values
  ----------------- --------------------------------------------------------------------------------------------
  0                 CCCH of size 64 bits (referred to as \"CCCH1\" in TS 38.331 \[5\]), except for a RedCap UE
  1--32             Identity of the logical channel of DCCH and DTCH
  33                Extended logical channel ID field (two-octet eLCID field)
  34                Extended logical channel ID field (one-octet eLCID field)
  35                CCCH of size 48 bits (referred to as \"CCCH\" in TS 38.331 \[5\]) for a RedCap UE
  36                CCCH of size 64 bits (referred to as \"CCCH1\" in TS 38.331 \[5\]) for a RedCap UE
  37--42            Reserved
  43                Truncated Enhanced BFR (one octet C~i~)
  44                Timing Advance Report
  45                Truncated Sidelink BSR
  46                Sidelink BSR
  47                Reserved
  48                LBT failure (four octets)
  49                LBT failure (one octet)
  50                BFR (one octet C~i~)
  51                Truncated BFR (one octet C~i~)
  52                CCCH of size 48 bits (referred to as \"CCCH\" in TS 38.331 \[5\]), except for a RedCap UE
  53                Recommended bit rate query
  54                Multiple Entry PHR (four octets C~i~)
  55                Configured Grant Confirmation
  56                Multiple Entry PHR (one octet C~i~)
  57                Single Entry PHR
  58                C-RNTI
  59                Short Truncated BSR
  60                Long Truncated BSR
  61                Short BSR
  62                Long BSR
  63                Padding

\[TS 38.331, clause 5.3.13.3\]

The UE shall set the contents of *RRCResumeRequest* or
*RRCResumeRequest1* message as follows:

1\> if field *useFullResumeID* is signalled in *SIB1*:

2\> select *RRCResumeRequest1* as the message to use;

2\> set the *resumeIdentity* to the stored *fullI-RNTI* value;

##### 7.1.1.1.16.3 Test description {#test-description-15 .H6}

##### 7.1.1.1.16.3.1 Pre-test conditions {#pre-test-conditions-15 .H6}

##### System Simulator: {#system-simulator-3 .H6}

> \- NR Cell 1.

##### UE: {#ue-3 .H6}

> \- None

##### Preamble: {#preamble-3 .H6}

\- The UE is in 2N-A state on NR Cell 1 using generic procedure
parameter Connectivity (*NR*) and Test loop function(*Off*) according to
TS 38.508-1 \[4\].

##### 7.1.1.1.16.3.2 Test procedure sequence {#test-procedure-sequence-14 .H6}

Table 7.1.1.1.16.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \-        | *-*       | \-      | \- |
|           | changes   |           |           |         |    |
|           | the SIB1  |           |           |         |    |
|           | of NR     |           |           |         |    |
|           | Cell 1 to |           |           |         |    |
|           | set the   |           |           |         |    |
|           | *useFull  |           |           |         |    |
|           | ResumeID* |           |           |         |    |
|           | to True.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The SS    | \<\--     | PDCCH     | \-      | \- |
|           | transmits |           | (DCI      |         |    |
|           | a Short   |           | 1\_0):    |         |    |
|           | message   |           | Short     |         |    |
|           | on PDCCH  |           | Message   |         |    |
|           | using     |           |           |         |    |
|           | P-RNTI    |           |           |         |    |
|           | i         |           |           |         |    |
|           | ndicating |           |           |         |    |
|           | a         |           |           |         |    |
|           | *system   |           |           |         |    |
|           | InfoModif |           |           |         |    |
|           | ication*. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | Wait for  | \-        | \-        | \-      | \- |
|           | 2.1\*     |           |           |         |    |
|           | mod       |           |           |         |    |
|           | ification |           |           |         |    |
|           | period    |           |           |         |    |
|           | second    |           |           |         |    |
|           | for the   |           |           |         |    |
|           | UE to     |           |           |         |    |
|           | receive   |           |           |         |    |
|           | new       |           |           |         |    |
|           | system    |           |           |         |    |
|           | inf       |           |           |         |    |
|           | ormation. |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | The SS    | \<\--     | NR RRC:   | \-      | \- |
|           | transmits |           | *Paging*  |         |    |
|           | a         |           |           |         |    |
|           | *Paging*  |           |           |         |    |
|           | message   |           |           |         |    |
|           | including |           |           |         |    |
|           | a matched |           |           |         |    |
|           | identity  |           |           |         |    |
|           | (correct  |           |           |         |    |
|           | *full     |           |           |         |    |
|           | I-RNTI*). |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Ch        | \--\>     | NR RRC:   | 1       | P  |
|           | eck:Â Does |           | *         |         |    |
|           | the UE    |           | RRCResume |         |    |
|           | transmit  |           | Request1* |         |    |
|           | an        |           |           |         |    |
|           | *         |           |           |         |    |
|           | RRCResume |           |           |         |    |
|           | Request1* |           |           |         |    |
|           | message   |           |           |         |    |
|           | by        |           |           |         |    |
|           | setting   |           |           |         |    |
|           | LCID to   |           |           |         |    |
|           | 36?       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The SS    | \<\--     | NR RRC:   | \-      | \- |
|           | transmits |           | *R        |         |    |
|           | an        |           | RCResume* |         |    |
|           | *R        |           |           |         |    |
|           | RCResume* |           |           |         |    |
|           | message.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The UE    | \--\>     | NR RRC:   | \-      | \- |
|           | transmits |           | *         |         |    |
|           | an        |           | RRCResume |         |    |
|           | *         |           | Complete* |         |    |
|           | RRCResume |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| The       |           |           |           |         |    |
| mod       |           |           |           |         |    |
| ification |           |           |           |         |    |
| period,   |           |           |           |         |    |
| expressed |           |           |           |         |    |
| in number |           |           |           |         |    |
| of radio  |           |           |           |         |    |
| frames =  |           |           |           |         |    |
| modif     |           |           |           |         |    |
| icationPe |           |           |           |         |    |
| riodCoeff |           |           |           |         |    |
| \*        |           |           |           |         |    |
| d         |           |           |           |         |    |
| efaultPag |           |           |           |         |    |
| ingCycle. |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.1.16.3.3 Specific message contents {#specific-message-contents-15 .H6}

Table 7.1.1.1.16.3.3-1: SIB1 (step 1, Table 7.1.1.1.16.3.2-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-28                            
  ---------------------------------------------------- -------------- --------- -----------
  Information Element                                  Value/remark   Comment   Condition
  SIB1 ::= SEQUENCE {                                                           
  useFullResumeID                                      true                     
  }                                                                             

Table 7.1.1.1.16.3.3-2: Paging (step 4, Table 7.1.1.1.16.3.2-1)

  ----------------------------------------------------------------------------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-9 with condition NR\_RRC\_RESUME
  ----------------------------------------------------------------------------------

##### 7.1.1.1.17 Random access procedure / RedCap UE identification

##### 7.1.1.1.17.1 Test Purpose (TP) {#test-purpose-tp-16 .H6}

##### (1) {#section-52 .H6}

**with** { UE supporting RedCap and in NR RRC\_IDLE state }

**ensure that** {

**when** { UE starts Random Access procedure }

**then** { the UE uses the RedCap specific random access resource in
Msg1}

}

##### (2) {#section-53 .H6}

**with** { UE supporting RedCap and in NR RRC\_IDLE state }

**ensure that** {

**when** { UE starts Random Access procedure }

**then** { the UE uses the RedCap specific LCID in Msg3 }

}

##### 7.1.1.1.17.2 Conformance requirements {#conformance-requirements-16 .H6}

References: The conformance requirements covered in the present test
case are specified in: TS 38.321, clauses 5.1.1, 5.1.1b, 5.1.1c ,5.1.1d
and 6.2.1, TS38.300, clauses 16.13.3. Unless otherwise stated these are
Rel-17 requirements.

\[TS 38.321, clause 5.1.1\]

...

When a Random Access procedure is initiated, UE selects a set of Random
Access resources as specified in clause 5.1.1b and initialises the
following parameters for the Random Access procedure according to the
values configured by RRC for the selected set of Random Access
resources:

...

*- featurePriorities*: priorities for features, such as REDCAP, Slice
group(s), etc. (see clause 5.1.1d);

...

\- *startPreambleForThisPartition*: the ***first preamble associated
with the set of Random Access Resources applicable to the Random Access
procedure***;

...

\- *numberOfPreamblesForThisPartition*: the ***number of consequtive
preambles associated with the set of Random Access Resources applicable
to the Random Access procedure***;

...

When the Random Access procedure is initiated on a Serving Cell, the MAC
entity shall:

...

1\> perform the BWP operation as specified in clause 5.15;

1\> select the set of Random Access resources applicable to the current
Random Access procedure according to clause 5.1.1b;

...

\[TS 38.321, clause 5.1.1b\]

The MAC entity shall:

...

1\> if contention-free Random Access Resources have not been provided
for this Random Access procedure and one or more of the features
including REDCAP and/or a specific slice group(s) and/or SDT and/or MSG3
repetition is applicable for this Random Access procedure:

Editor\'s Note: FFS if some clarification is needed on how feature
applicability is known (e.g. from RRC etc)

2\> if none of the sets of Random Access resources are available for the
current Random Access procedure (as specified in clause 5.1.1c):

3\> select the set of Random Access resources that are not associated
with any feature indication (as specified in clause 5.1.1c) for this
Random Access procedure.

2\> else if there are one or more set(s) of Random Access resources
available (as specified in clause 5.1.1c) and one of these set(s) of
Random Access resources can be used for indicating all features
triggering this Random Access procedure:

3\> select the available set of Random Access resources for this Random
Access procedure.

...

\[TS 38.321, clause 5.1.1c\]

The MAC entity shall for each set of configured Random Access resources
for 4-step RA type and for each set of configured Random Access
resources for 2-step RA type:

1\> if REDCAP indication is configured for a set of Random Access
resources:

2\> consider the set of Random Access resources as not available for a
RACH procedure for which REDCAP indication is not applicable.

...

\[TS 38.321, clause 5.1.1d\]

The MAC entity shall:

1\> among the available sets of Random Access resources, identify those
configured with a feature which has the highest priority assigned in
*featurePriorities* among all the features applicable to this Random
Access procedure as specified in TS 38.331 \[5\].

1\> if a single set of Random Access resources is identified:

2\> select this set of Random Access resources.

...

\[TS 38.300, clause 16.13.3\]

A RedCap UE can be identified by the network during Random Access
procedure via MSG3/MSGA from a RedCap specific LCID(s) and optionally
via MSG1/MSGA (PRACH occasion or PRACH preamble). For RedCap UE
identification via MSG1/MSGA, RedCap specific Random Access
configuration may be configured by the network. For MSG3/MSGA, a RedCap
UE is identified by the dedicated LCID(s) indicated for CCCH
identification (CCCH or CCCH1) regardless whether RedCap specific Random
Access configuration is configured by the network.

\[TS 38.321, clause 6.2.1\]

Table 6.2.1-2 Values of LCID for UL-SCH

  Codepoint/Index   LCID values
  ----------------- --------------------------------------------------------------------------------------------
  0                 CCCH of size 64 bits (referred to as \"CCCH1\" in TS 38.331 \[5\]), except for a RedCap UE
  1--32             Identity of the logical channel of DCCH and DTCH
  33                Extended logical channel ID field (two-octet eLCID field)
  34                Extended logical channel ID field (one-octet eLCID field)
  35                CCCH of size 48 bits (referred to as \"CCCH\" in TS 38.331 \[5\]) for a RedCap UE
  36                CCCH of size 64 bits (referred to as \"CCCH1\" in TS 38.331 \[5\]) for a RedCap UE
  37--42            Reserved
  43                Truncated Enhanced BFR (one octet C~i~)
  44                Timing Advance Report
  45                Truncated Sidelink BSR
  46                Sidelink BSR
  47                Reserved
  48                LBT failure (four octets)
  49                LBT failure (one octet)
  50                BFR (one octet C~i~)
  51                Truncated BFR (one octet C~i~)
  52                CCCH of size 48 bits (referred to as \"CCCH\" in TS 38.331 \[5\]), except for a RedCap UE
  53                Recommended bit rate query
  54                Multiple Entry PHR (four octets C~i~)
  55                Configured Grant Confirmation
  56                Multiple Entry PHR (one octet C~i~)
  57                Single Entry PHR
  58                C-RNTI
  59                Short Truncated BSR
  60                Long Truncated BSR
  61                Short BSR
  62                Long BSR
  63                Padding

##### 7.1.1.1.17.3 Test description {#test-description-16 .H6}

##### 7.1.1.1.17.3.1 Pre-test conditions {#pre-test-conditions-16 .H6}

##### System Simulator: {#system-simulator-4 .H6}

> \- NR Cell 1.

##### UE: {#ue-4 .H6}

> \- None

##### Preamble: {#preamble-4 .H6}

\- The UE is in 1N-A state on NR Cell 1 using generic procedure
parameter Connectivity (*NR*) and Test loop function(*Off*) according to
TS 38.508-1 \[4\].

##### 7.1.1.1.17.3.2 Test procedure sequence {#test-procedure-sequence-15 .H6}

Table 7.1.1.1.17.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \-        | *-*       | \-      | \- |
|           | changes   |           |           |         |    |
|           | the SIB1  |           |           |         |    |
|           | of NR     |           |           |         |    |
|           | Cell 1 to |           |           |         |    |
|           | configure |           |           |         |    |
|           | the       |           |           |         |    |
|           | specific  |           |           |         |    |
|           | PRACH     |           |           |         |    |
|           | resource  |           |           |         |    |
|           | for       |           |           |         |    |
|           | RedCap in |           |           |         |    |
|           | initialU  |           |           |         |    |
|           | plinkBWP. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | The SS    | \<\--     | PDCCH     | \-      | \- |
|           | transmits |           | (DCI      |         |    |
|           | a Short   |           | 1\_0):    |         |    |
|           | message   |           | Short     |         |    |
|           | on PDCCH  |           | Message   |         |    |
|           | using     |           |           |         |    |
|           | P-RNTI    |           |           |         |    |
|           | i         |           |           |         |    |
|           | ndicating |           |           |         |    |
|           | a         |           |           |         |    |
|           | *system   |           |           |         |    |
|           | InfoModif |           |           |         |    |
|           | ication*. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | Wait for  | \-        | \-        | \-      | \- |
|           | 2.1\*     |           |           |         |    |
|           | mod       |           |           |         |    |
|           | ification |           |           |         |    |
|           | period    |           |           |         |    |
|           | second    |           |           |         |    |
|           | for the   |           |           |         |    |
|           | UE to     |           |           |         |    |
|           | receive   |           |           |         |    |
|           | new       |           |           |         |    |
|           | system    |           |           |         |    |
|           | inf       |           |           |         |    |
|           | ormation. |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | The SS    | \<\--     | NR RRC:   | \-      | \- |
|           | transmits |           | Paging    |         |    |
|           | a Paging  |           |           |         |    |
|           | message   |           |           |         |    |
|           | including |           |           |         |    |
|           | a matched |           |           |         |    |
|           | identity. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Check:    | \--\>     | PRACH     | 1       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | with      |           |           |         |    |
|           | *ra-Pream |           |           |         |    |
|           | bleIndex* |           |           |         |    |
|           | range     |           |           |         |    |
|           | from 8 to |           |           |         |    |
|           | 11 on NR  |           |           |         |    |
|           | Cell 1?   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | The SS    | \<\--     | Random    | \-      |    |
|           | transmits |           | Access    |         |    |
|           | Random    |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | with      |           |           |         |    |
|           | RAPID     |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to the    |           |           |         |    |
|           | tr        |           |           |         |    |
|           | ansmitted |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 5.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | Does the  |           | (         |         |    |
|           | UE        |           | *RRCSetup |         |    |
|           | transmit  |           | Request*) |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *RRCSetu  |           |           |         |    |
|           | pRequest* |           |           |         |    |
|           | message   |           |           |         |    |
|           | by        |           |           |         |    |
|           | setting   |           |           |         |    |
|           | LCID to   |           |           |         |    |
|           | 35?       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | schedules |           |           |         |    |
|           | PDCCH     |           | (*        |         |    |
|           | tra       |           | RRCSetup* |         |    |
|           | nsmission |           | and UE    |         |    |
|           | addressed |           | C         |         |    |
|           | to        |           | ontention |         |    |
|           | TC-RNTI   |           | R         |         |    |
|           | to        |           | esolution |         |    |
|           | transmit  |           | Identity  |         |    |
|           | a valid   |           | MAC CE)   |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *         |           |           |         |    |
|           | RRCSetup* |           |           |         |    |
|           | message   |           |           |         |    |
|           | and 'UE   |           |           |         |    |
|           | C         |           |           |         |    |
|           | ontention |           |           |         |    |
|           | R         |           |           |         |    |
|           | esolution |           |           |         |    |
|           | Identity' |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | control   |           |           |         |    |
|           | element   |           |           |         |    |
|           | with      |           |           |         |    |
|           | matched   |           |           |         |    |
|           | 'C        |           |           |         |    |
|           | ontention |           |           |         |    |
|           | R         |           |           |         |    |
|           | esolution |           |           |         |    |
|           | I         |           |           |         |    |
|           | dentity'. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | UE        | \--\>     | MAC PDU   | \-      | \- |
|           | transmit  |           | (*        |         |    |
|           | a MAC PDU |           | RRCSetupC |         |    |
|           | c         |           | omplete)* |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *RRCSetup |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message   |           |           |         |    |
|           | i         |           |           |         |    |
|           | ndicating |           |           |         |    |
|           | a         |           |           |         |    |
|           | cceptance |           |           |         |    |
|           | of        |           |           |         |    |
|           | *         |           |           |         |    |
|           | RRCSetup* |           |           |         |    |
|           | message   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | The test  | \-        | *-*       | \-      | \- |
|           | steps 5   |           |           |         |    |
|           | to 8 of   |           |           |         |    |
|           | generic   |           |           |         |    |
|           | test      |           |           |         |    |
|           | procedure |           |           |         |    |
|           | in TS     |           |           |         |    |
|           | 38.508-1  |           |           |         |    |
|           | \[4\]     |           |           |         |    |
|           | Table     |           |           |         |    |
|           | 4.5.4.2-3 |           |           |         |    |
|           | are       |           |           |         |    |
|           | performed |           |           |         |    |
|           | on NR     |           |           |         |    |
|           | Cell 1.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | The SS    | \<\--     | NR RRC:   | \-      |    |
|           | transmits |           | R         |         |    |
|           | *RRC      |           | RCRelease |         |    |
|           | Release.* |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | The SS    | \-        | *-*       | \-      | \- |
|           | changes   |           |           |         |    |
|           | the SIB1  |           |           |         |    |
|           | of NR     |           |           |         |    |
|           | Cell 1 to |           |           |         |    |
|           | configure |           |           |         |    |
|           | the       |           |           |         |    |
|           | specific  |           |           |         |    |
|           | PRACH     |           |           |         |    |
|           | resource  |           |           |         |    |
|           | for       |           |           |         |    |
|           | RedCap in |           |           |         |    |
|           | initia    |           |           |         |    |
|           | lUplinkBW |           |           |         |    |
|           | P-RedCap. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | The SS    | \<\--     | PDCCH     | \-      | \- |
|           | transmits |           | (DCI      |         |    |
|           | a Short   |           | 1\_0):    |         |    |
|           | message   |           | Short     |         |    |
|           | on PDCCH  |           | Message   |         |    |
|           | using     |           |           |         |    |
|           | P-RNTI    |           |           |         |    |
|           | i         |           |           |         |    |
|           | ndicating |           |           |         |    |
|           | a         |           |           |         |    |
|           | *system   |           |           |         |    |
|           | InfoModif |           |           |         |    |
|           | ication*. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | Wait for  | \-        | \-        | \-      | \- |
|           | 2.1\*     |           |           |         |    |
|           | mod       |           |           |         |    |
|           | ification |           |           |         |    |
|           | period    |           |           |         |    |
|           | second    |           |           |         |    |
|           | for the   |           |           |         |    |
|           | UE to     |           |           |         |    |
|           | receive   |           |           |         |    |
|           | new       |           |           |         |    |
|           | system    |           |           |         |    |
|           | inf       |           |           |         |    |
|           | ormation. |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | The SS    | \<\--     | NR RRC:   | \-      | \- |
|           | transmits |           | Paging    |         |    |
|           | a Paging  |           |           |         |    |
|           | message   |           |           |         |    |
|           | including |           |           |         |    |
|           | a matched |           |           |         |    |
|           | identity. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 16        | Check:    | \--\>     | PRACH     | 1       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | with      |           |           |         |    |
|           | *ra-Pream |           |           |         |    |
|           | bleIndex* |           |           |         |    |
|           | range     |           |           |         |    |
|           | from 12   |           |           |         |    |
|           | to 15 on  |           |           |         |    |
|           | NR Cell   |           |           |         |    |
|           | 1?        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17        | The SS    | \<\--     | Random    | \-      |    |
|           | transmits |           | Access    |         |    |
|           | Random    |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
|           | with      |           |           |         |    |
|           | RAPID     |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to the    |           |           |         |    |
|           | tr        |           |           |         |    |
|           | ansmitted |           |           |         |    |
|           | Preamble  |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 16.       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 18        | Check:    | \--\>     | MAC PDU   | 2       | P  |
|           | Does the  |           | (         |         |    |
|           | UE        |           | *RRCSetup |         |    |
|           | transmit  |           | Request*) |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *RRCSetu  |           |           |         |    |
|           | pRequest* |           |           |         |    |
|           | message   |           |           |         |    |
|           | by        |           |           |         |    |
|           | setting   |           |           |         |    |
|           | LCID to   |           |           |         |    |
|           | 35?       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19        | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | schedules |           |           |         |    |
|           | PDCCH     |           | (*        |         |    |
|           | tra       |           | RRCSetup* |         |    |
|           | nsmission |           | and UE    |         |    |
|           | addressed |           | C         |         |    |
|           | to        |           | ontention |         |    |
|           | TC-RNTI   |           | R         |         |    |
|           | to        |           | esolution |         |    |
|           | transmit  |           | Identity  |         |    |
|           | a valid   |           | MAC CE)   |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *         |           |           |         |    |
|           | RRCSetup* |           |           |         |    |
|           | message   |           |           |         |    |
|           | and 'UE   |           |           |         |    |
|           | C         |           |           |         |    |
|           | ontention |           |           |         |    |
|           | R         |           |           |         |    |
|           | esolution |           |           |         |    |
|           | Identity' |           |           |         |    |
|           | MAC       |           |           |         |    |
|           | control   |           |           |         |    |
|           | element   |           |           |         |    |
|           | with      |           |           |         |    |
|           | matched   |           |           |         |    |
|           | 'C        |           |           |         |    |
|           | ontention |           |           |         |    |
|           | R         |           |           |         |    |
|           | esolution |           |           |         |    |
|           | I         |           |           |         |    |
|           | dentity'. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 20        | UE        | \--\>     | MAC PDU   | \-      | \- |
|           | transmit  |           | (*        |         |    |
|           | a MAC PDU |           | RRCSetupC |         |    |
|           | c         |           | omplete)* |         |    |
|           | ontaining |           |           |         |    |
|           | an        |           |           |         |    |
|           | *RRCSetup |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message   |           |           |         |    |
|           | i         |           |           |         |    |
|           | ndicating |           |           |         |    |
|           | a         |           |           |         |    |
|           | cceptance |           |           |         |    |
|           | of        |           |           |         |    |
|           | *         |           |           |         |    |
|           | RRCSetup* |           |           |         |    |
|           | message   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| The       |           |           |           |         |    |
| mod       |           |           |           |         |    |
| ification |           |           |           |         |    |
| period,   |           |           |           |         |    |
| expressed |           |           |           |         |    |
| in number |           |           |           |         |    |
| of radio  |           |           |           |         |    |
| frames =  |           |           |           |         |    |
| modif     |           |           |           |         |    |
| icationPe |           |           |           |         |    |
| riodCoeff |           |           |           |         |    |
| \*        |           |           |           |         |    |
| d         |           |           |           |         |    |
| efaultPag |           |           |           |         |    |
| ingCycle. |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.1.17.3.3 Specific message contents {#specific-message-contents-16 .H6}

Table 7.1.1.1.17.3.3-1: *SIB1* (step 1 and step12, Table
7.1.1.1.17.3.2-1)

  ---------------------------------------------------- ---------------------------- ------------------------ -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-28                                                         
  Information Element                                  Value/remark                 Comment                  Condition
  SIB1 ::= SEQUENCE {                                                                                        
  servingCellConfigCommon                              ServingCellConfigCommonSIB   Table 7.1.1.1.17.3.3-2   
  nonCriticalExtension SEQUENCE {                                                                            
  nonCriticalExtension SEQUENCE {                                                                            
  nonCriticalExtension SEQUENCE {                                                                            
  featurePriorities-r17 SEQUENCE {                                                                           
  redCapPriority-r17                                   0                                                     
  }                                                                                                          
  }                                                                                                          
  }                                                                                                          
  }                                                                                                          
  }                                                                                                          
  ---------------------------------------------------- ---------------------------- ------------------------ -----------

Table 7.1.1.1.17.3.3-2: *ServingCellConfigCommonSIB* (Table
7.1.1.1.17.3.3-1)

  ----------------------------------------------------- ------------------------- ----------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-169                                                                 
  Information Element                                   Value/remark              Comment                             Condition
  ServingCellConfigCommonSIB ::= SEQUENCE {                                                                           
  uplinkConfigCommon                                    UplinkConfigCommonSIB     Table 7.1.1.1.17.3.3-3              Step1
  uplinkConfigCommon                                    UplinkConfigCommonSIB     TS 38.508-1 \[4\] Table 4.6.3-202   Step 12
  uplinkConfigCommon-v1700                              Not present                                                   Step 1
  uplinkConfigCommon-v1700 SEQUENCE {                                                                                 Step12
  initialUplinkBWP-RedCap-r17                           BWP-UplinkCommon-RedCap   Table 7.1.1.1.17.3.3-4A             
  }                                                                                                                   
  }                                                                                                                   
  ----------------------------------------------------- ------------------------- ----------------------------------- -----------

Table 7.1.1.1.17.3.3-3: *UplinkConfigCommonSIB* (Table 7.1.1.1.17.3.3-2)

  ----------------------------------------------------- ------------------ ------------------------ -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-202                                               
  Information Element                                   Value/remark       Comment                  Condition
  UplinkConfigCommonSIB ::= SEQUENCE {                                                              
  initialUplinkBWP                                      BWP-UplinkCommon   Table 7.1.1.1.17.3.3-4   
  }                                                                                                 
  ----------------------------------------------------- ------------------ ------------------------ -----------

Table 7.1.1.1.17.3.3-4: *BWP-UplinkCommon* (Table 7.1.1.1.17.3.3-3)

  ---------------------------------------------------- ------------------- ------------------------ -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-14                                                
  Information Element                                  Value/remark        Comment                  Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                                   
  rach-ConfigCommon CHOICE {                                                                        
  setup                                                RACH-ConfigCommon   Table 7.1.1.1.17.3.3-5   Step 1
  }                                                                                                 
  }                                                                                                 
  ---------------------------------------------------- ------------------- ------------------------ -----------

Table 7.1.1.1.17.3.3-4A: *BWP-UplinkCommon-RedCap* (Table
7.1.1.1.17.3.3-3)

  ---------------------------------------------------- --------------------------- ------------------------ -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-14                                                        
  Information Element                                  Value/remark                Comment                  Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                                           
  rach-ConfigCommon CHOICE {                                                                                
  setup                                                RACH-ConfigCommon           Table 7.1.1.1.17.3.3-5   Step 12
  }                                                                                                         
  pucch-ConfigCommon CHOICE {                                                                               
  setup                                                PUCCH-ConfigCommon-RedCap   Table 7.1.1.1.17.3.3-6   Step 12
  }                                                                                                         
  }                                                                                                         
  ---------------------------------------------------- --------------------------- ------------------------ -----------

Table 7.1.1.1.17.3.3-5: *RACH-ConfigCommon* (Table 7.1.1.1.17.3.3-4)

  ----------------------------------------------------------------------------------------------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128                                                                                                                
  Information Element                                                                                                                       Value/remark   Comment   Condition
  RACH-ConfigCommon ::= SEQUENCE {                                                                                                                                   
  featureCombinationPreamblesList-r17 SEQUENCE (SIZE(1..maxFeatureCombPreamblesPerRACHResource-r17)) OF FeatureCombinationPreambles-r17 {   1 entry                  
  FeatureCombinationPreambles-r17\[1\] SEQUENCE {                                                                                                          entry 1   
  featureCombination-r17 SEQUENCE {                                                                                                                                  
  redCap-r17                                                                                                                                True                     
  }                                                                                                                                                                  
  startPreambleForThisPartition-r17                                                                                                         8                        Step 1
                                                                                                                                            12                       Step 12
  numberOfPreamblesPerSSB-ForThisPartition-r17                                                                                              4                        
  }                                                                                                                                                                  
  }                                                                                                                                                                  
  }                                                                                                                                                                  
  ----------------------------------------------------------------------------------------------------------------------------------------- -------------- --------- -----------

Table 7.1.1.1.17.3.3-6: *PUCCH-ConfigCommon-RedCap* (Table
7.1.1.1.17.3.3-4A)

  ----------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-113                            
  Information Element                                   Value/remark   Comment   Condition
  PUCCH-ConfigCommon ::= SEQUENCE {                                              
  pucch-ResourceCommon                                  Not present              
  pucch-ResourceCommonRedCap-r17                        0                        
  }                                                                              
  ----------------------------------------------------- -------------- --------- -----------

##### 7.1.1.1.18 Random access procedure / Msg3 repetition indication / Random access resources selection

##### 7.1.1.1.18.1 Test Purpose (TP) {#test-purpose-tp-17 .H6}

##### (1) {#section-54 .H6}

**with** { UE in RRC\_IDLE state and supporting MSG3 repetition }

**ensure that** {

**when** { UE is configured with both sets of Random Access resources
with and without MSG3 repetition indication AND the RSRP of the downlink
pathloss reference is less than the configured threshold }

**then** { UE requests MSG3 repetition via separate RACH resources and
performs MSG3 repetition for MSG3 initial transmission and
retransmission as per network indication }

}

##### (2) {#section-55 .H6}

**with** { UE in RRC\_IDLE state and supporting MSG3 repetition }

**ensure that** {

**when** { UE is configured with both sets of Random Access resources
with and without MSG3 repetition indication AND the RSRP of the downlink
pathloss reference is higher than the configured threshold }

**then** { UE does not request MSG3 repetition }

}

##### (3) {#section-56 .H6}

**with** { UE in RRC\_IDLE state and supporting MSG3 repetition }

**ensure that** {

**when** { UE is only configured with Random Access resources with MSG3
repetition indication }

**then** { UE requests MSG3 repetition via separate RACH resources and
performs MSG3 repetition for MSG3 initial transmission and
retransmission as per network indication }

}

##### 7.1.1.1.18.2 Conformance requirements {#conformance-requirements-17 .H6}

References: The conformance requirements covered in the present test
case are specified in: TS 38.213 clause 8.1, 8.3, TS 38.214 clause
6.1.2.1, TS 38.300, clause 19, and TS 38.321 clause 5.1.1b. Unless
otherwise stated these are Rel-17 requirements.

\[TS 38.213 clause 8.1\]

For a random access procedure associated with a feature combination
indicated by *FeatureCombinationPreambles*, a UE is provided a number
$N$ of SS/PBCH block indexes associated with one PRACH occasion by
*ssb-perRACH-OccasionAndCB-PreamblesPerSSB* or
*msgA-SSB-PerRACH-OccasionAndCB-PreamblesPerSSB when provided* and a
number $S$ of contention based preambles per SS/PBCH block index per
valid PRACH occasion by *startPreambleForThisPartition* and
*numberOfPreamblesPerSSB-ForThisPartition*. The PRACH transmission can
be on a subset of PRACH occasions associated with a same SS/PBCH block
index within an SSB-RO mapping cycle for a UE provided with a PRACH mask
index by *ssb-SharedRO-MaskIndex* according to \[11, TS 38.321\].

\[TS 38.213 clause 8.3\]

A UE can be provided in *BWP-UplinkCommon* a set of numbers of
repetitions for a PUSCH transmission with PUSCH repetition Type A that
is scheduled by a RAR UL grant or by a DCI format 0\_0 with CRC
scrambled by a TC-RNTI. If the UE requests repetitions for the PUSCH
transmission \[11, TS 38.321\], the UE transmits the PUSCH over
$N_{\text{PUSCH}}^{\text{repeat}}$ slots, where
$N_{\text{PUSCH}}^{\text{repeat}}$ is indicated by the 2 MSBs of the MCS
field in the RAR UL grant or in the DCI format 0\_0 from a set of four
values provided by *numberOfMsg3-RepetitionsList* or from {1, 2, 3, 4}
if *numberOfMsg3-RepetitionsList* is not provided. The UE determines an
MCS for the PUSCH transmission by the 2 LSBs of the MCS field in the RAR
UL grant or by the 3 LSBs of the MCS field in the DCI format 0\_0, and
determines a redundancy version and RBs for each repetition as described
in \[6, TS 38.214\]. For unpaired spectrum operation, the UE determines
the $N_{\text{PUSCH}}^{\text{repeat}}$ slots as the first
$N_{\text{PUSCH}}^{\text{repeat}}$ slots starting from slot
$n + k_{2} + \mathrm{\Delta}$ where a repetition of the PUSCH
transmission does not include a symbol indicated as downlink by
*tdd-UL-DL-ConfigurationCommon* or indicated as a symbol of an SS/PBCH
block with index provided by *ssb-PositionsInBurst.*

\[TS 38.214 clause 6.1.2.1\]

For PUSCH repetition type A, when transmitting PUSCH scheduled by RAR UL
grant, the 2 MSBs of the MCS information field of the RAR UL grant
provide a codepoint to determine the number of repetitions *K* according
to Table 6.1.2.1-1A, based on whether or not the higher layer parameter
*numberOfMsg3-RepetitionsList* is configured. The number of slots used
for TBS determination N is equal to 1.

For PUSCH repetition type A, when transmitting PUSCH scheduled by DCI
format 0\_0 with CRC scrambled by TC-RNTI, the 2 MSBs of the MCS
information field of the DCI format 0\_0 with CRC scrambled by TC-RNTI
provide a codepoint to determine the number of repetitions *K* according
to Table 6.1.2.1-1A, based on whether or not the higher layer parameter
*numberOfMsg3-RepetitionsList* is configured. The number of slots used
for TBS determination N is equal to 1.

Table 6.1.2.1-1A: Number of repetition *K* as a function of 2 MSBs of
MCS information field

  *numberOfMsg3-RepetitionsList is configured*                                                    *numberOfMsg3-RepetitionsList is not configured*               
  ---------------------------------------------- ------------------------------------------------ -------------------------------------------------- ----------- -----
  *Codepoint*                                    *K*                                                                                                 Codepoint   *K*
  00                                             First value of *numberOfMsg3-RepetitionsList*                                                       00          1
  01                                             Second value of *numberOfMsg3-RepetitionsList*                                                      01          2
  10                                             Third value of *numberOfMsg3-RepetitionsList*                                                       10          3
  11                                             Fourth value of *numberOfMsg3-RepetitionsList*                                                      11          4

...

For a PUSCH transmission scheduled by DCI format 0\_1, or 0\_2, or 0\_0
with CRC scrambled by TC-RNTI, the redundancy version to be applied on
the *n*th transmission occasion of the TB, where n = 0, 1, ...
$N \bullet K$ -1, is determined according to table 6.1.2.1-2.

For a PUSCH transmission of a PUSCH repetition Type A scheduled by RAR
UL grant, the redundancy version to be applied on the *n*th transmission
occasion of the TB, where n = 0, 1, ... $N \bullet K$ -1, is determined
according to the first row of Table 6.1.2.1-2.

Table 6.1.2.1-2: Redundancy version for PUSCH transmission

  *rv~id\ ~*indicated by the DCI scheduling the PUSCH   *rv~id~* to be applied to *n*^th^ transmission occasion (repetition Type A) or TB processing over multiple slots) or *n*^th^ actual repetition (repetition Type B)                                                                   
  ----------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------------------------- ------------------------------- -------------------------------
                                                        *((n-(n mod N))/N)* mod 4 = 0                                                                                                                                        *((n-(n mod N))/N)* mod 4 = 1   *((n-(n mod N))/N)* mod 4 = 2   *((n-(n mod N))/N)* mod 4 = 3
  0                                                     0                                                                                                                                                                    2                               3                               1
  2                                                     2                                                                                                                                                                    3                               1                               0
  3                                                     3                                                                                                                                                                    1                               0                               2
  1                                                     1                                                                                                                                                                    0                               2                               3

\[TS 38.300, clause 19\]

To improve NR uplink coverage for both FR1 and FR2, the following
enhancements on PUSCH, PUCCH and MSG3 PUSCH are supported:

\- ...

\- Aggregation of multiple slots with TB repetition for MSG3
transmission is supported on both NUL and SUL, applicable to CBRA with
4-step RA type. If configured, the UE requests MSG3 repetition via
separate RACH resources when the RSRP of DL path-loss reference is lower
than a configured threshold. BWP configured with RACH resources solely
for MSG3 repetition is also supported without the need to consider the
RSRP of DL path-loss reference by the UE.

\[TS 38.321, clause 5.1.1b\]

The MAC entity shall:

1\> if the BWP selected for Random Access procedure is configured with
both set(s) of Random Access resources with MSG3 repetition indication
and set(s) of Random Access resources without MSG3 repetition indication
and the RSRP of the downlink pathloss reference is less than
*rsrp-ThresholdMsg3*; or

1\> if the BWP selected for Random Access procedure is only configured
with the set(s) of Random Access resources with MSG3 repetition
indication;

2\> assume MSG3 repetition is applicable for the current Random Access
procedure.

1\> else:

2\> assume MSG3 repetition is not applicable for the current Random
Access procedure.

NOTE 1: Void.

1\> if contention-free Random Access Resources have not been provided
for this Random Access procedure and one or more of the features
including RedCap and/or a specific NSAG(s) and/or SDT and/or MSG3
repetition is applicable for this Random Access procedure:

NOTE 2: The applicability of SDT is determined by MAC entity according
to clause 5.27. The applicability of specific slice group(s) is
determined by upper layers when the Random Access procedure is initiated
by the upper layers. The applicability of RedCap is also determined by
upper layers when Random Access procedure is initiated and it is
applicable to the Random Access procedures initiated by PDCCH orders and
any Random Access procedure initiated by the MAC entity.

2\> if none of the sets of Random Access resources are available for any
feature applicable to the current Random Access procedure (as specified
in clause 5.1.1c):

3\> select the set(s) of Random Access resources that are not associated
with any feature indication (as specified in clause 5.1.1c) for this
Random Access procedure.

2\> else if there is one set of Random Access resources available which
can be used for indicating all features triggering this Random Access
procedure:

3\> select this set of Random Access resources for this Random Access
procedure.

2\> else (i.e. there are one or more sets of Random Access resources
available that are configured with indication(s) for a subset of all
features triggering this Random Access procedure):

> 3\> select a set of Random Access resources from the available set(s)
> of Random Access resources based on the priority order indicated by
> upper layers as specified in clause 5.1.1d for this Random Access
> Procedure.

1\> else if contention-free Random Access Resources have been provided
for this Random Access procedure and RedCap is applicable for the
current Random Access procedure and there is one set of Random Access
resources available that is only configured with RedCap indication:

2\> select this set of Random Access resources for this Random Access
procedure.

1\> else:

2\> select the set of Random Access resources that are not associated
with any feature indication (as specified in clause 5.1.1c) for the
current Random Access procedure.

##### 7.1.1.1.18.3 Test description {#test-description-17 .H6}

##### 7.1.1.1.18.3.1 Pre-test conditions {#pre-test-conditions-17 .H6}

##### System Simulator: {#system-simulator-5 .H6}

> \- NR Cell 1.

\- System information combination NR-1 as defined in TS 38.508-1 \[4\]
clause 4.4.3.1 is used in NR Cell 1.

##### UE: {#ue-5 .H6}

> \- None

##### Preamble: {#preamble-5 .H6}

\- The UE is in 1N-A state on NR Cell 1 using generic procedure
parameter Connectivity (*NR*) and Test loop function(*Off*) according to
TS 38.508-1 \[4\].

##### 7.1.1.1.18.3.2 Test procedure sequence {#test-procedure-sequence-16 .H6}

Table 7.1.1.1.18.3.2-1/2 illustrate the downlink power levels and other
changing parameters to be applied for the cell at various time instants
of the test execution. The exact instants on which these values shall be
applied are described in the texts in this clause. Configurations marked
\"T0\" is applied for Preamble. Configurations marked \"T1\" are applied
at the points indicated in the Main behaviour description in Table
7.1.1.1.18.3.2-3.

Table 7.1.1.1.18.3.2-1: Time instances of cell power level and parameter
changes for FR1

+------------------+-----------+------+-----------+------------------+
|                  | Parameter | Unit | NR Cell 1 | Remark           |
+==================+===========+======+===========+==================+
| T0               | SS/PBCH   | dBm/ | -77       | The power level  |
|                  |           |      |           | is such that     |
|                  | SSS EPRE  | SCS  |           | RSRP of PL-RS    |
|                  |           |      |           | \>*rsr           |
|                  |           |      |           | p-ThresholdMsg3* |
+------------------+-----------+------+-----------+------------------+
| T1               | SS/PBCH   | dBm/ | -93       | The power level  |
|                  |           |      |           | is such that     |
|                  | SSS EPRE  | SCS  |           | RSRP of PL-RS \< |
|                  |           |      |           | *rsr             |
|                  |           |      |           | p-ThresholdMsg3* |
+------------------+-----------+------+-----------+------------------+
| Note: The        |           |      |           |                  |
| downlink signal  |           |      |           |                  |
| level            |           |      |           |                  |
| uncertainty is   |           |      |           |                  |
| specified in TS  |           |      |           |                  |
| 38.508-1 \[4\]   |           |      |           |                  |
| clause 6.2.2.1.  |           |      |           |                  |
+------------------+-----------+------+-----------+------------------+

Table 7.1.1.1.18.3.2-2: Time instances of cell power level and parameter
changes for FR2

+------------------+-----------+------+-----------+------------------+
|                  | Parameter | Unit | NR Cell 1 | Remark           |
+==================+===========+======+===========+==================+
| T0               | SS/PBCH   | dBm/ | -71       | The power level  |
|                  |           |      |           | is such that     |
|                  | SSS EPRE  | SCS  |           | RSRP of PL-RS \> |
|                  |           |      |           | *rsr             |
|                  |           |      |           | p-ThresholdMsg3* |
+------------------+-----------+------+-----------+------------------+
| T1               | SS/PBCH   | dBm/ | -99       | The power level  |
|                  |           |      |           | is such that     |
|                  | SSS EPRE  | SCS  |           | RSRP of PL-RS \< |
|                  |           |      |           | *rsr             |
|                  |           |      |           | p-ThresholdMsg3* |
+------------------+-----------+------+-----------+------------------+
| Note: The        |           |      |           |                  |
| downlink signal  |           |      |           |                  |
| level            |           |      |           |                  |
| uncertainty is   |           |      |           |                  |
| specified in TS  |           |      |           |                  |
| 38.508-1 \[4\]   |           |      |           |                  |
| clause 6.2.2.1.  |           |      |           |                  |
+------------------+-----------+------+-----------+------------------+

Table 7.1.1.1.18.3.2-3: Main behaviour

+-------+-------------+-------------+-------------+---------+----+
| St    | Procedure   | Message     | TP          | Verdict |    |
|       |             | Sequence    |             |         |    |
+=======+=============+=============+=============+=========+====+
|       |             | U - S       | Message     |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 0A    | The SS      | \-          | \-          | \-      | \- |
|       | changes NR  |             |             |         |    |
|       | Cell 1      |             |             |         |    |
|       | power level |             |             |         |    |
|       | according   |             |             |         |    |
|       | to the row  |             |             |         |    |
|       | \"T1\" in   |             |             |         |    |
|       | Table       |             |             |         |    |
|       | 7.1.1.1     |             |             |         |    |
|       | .18.3.2-1/2 |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 1     | The SS      | \<\--       | NR RRC*:    | \-      | \- |
|       | transmits a |             | Paging*     |         |    |
|       | Paging      |             |             |         |    |
|       | message     |             |             |         |    |
|       | including a |             |             |         |    |
|       | matched UE  |             |             |         |    |
|       | identity.   |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 2     | Check: Does | \--\>       | *PRACH      | 1       | P  |
|       | the UE      |             | preamble*   |         |    |
|       | transmit a  |             |             |         |    |
|       | PRACH       |             |             |         |    |
|       | preamble    |             |             |         |    |
|       | belonging   |             |             |         |    |
|       | to the      |             |             |         |    |
|       | random      |             |             |         |    |
|       | access      |             |             |         |    |
|       | resource    |             |             |         |    |
|       | set for     |             |             |         |    |
|       | Msg3        |             |             |         |    |
|       | repetition? |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 3     | The SS      | \<\--       | Random      | \-      | \- |
|       | transmits   |             | Access      |         |    |
|       | Random      |             | Response    |         |    |
|       | Access      |             |             |         |    |
|       | Response    |             |             |         |    |
|       | with RAPID  |             |             |         |    |
|       | co          |             |             |         |    |
|       | rresponding |             |             |         |    |
|       | to the      |             |             |         |    |
|       | transmitted |             |             |         |    |
|       | Preamble in |             |             |         |    |
|       | step 2 and  |             |             |         |    |
|       | MCS =       |             |             |         |    |
|       | "0000".     |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 4     | Check: Does | \--\>       | MAC PDU     | 1       | P  |
|       | the UE      |             | (*RRCSet    |         |    |
|       | transmit a  |             | upRequest*) |         |    |
|       | MAC PDU     |             |             |         |    |
|       | containing  |             |             |         |    |
|       | an          |             |             |         |    |
|       | *RRCSe      |             |             |         |    |
|       | tupRequest* |             |             |         |    |
|       | message and |             |             |         |    |
|       | repeat      |             |             |         |    |
|       | t           |             |             |         |    |
|       | ransmitting |             |             |         |    |
|       | this MAC    |             |             |         |    |
|       | PDU in      |             |             |         |    |
|       | every slot  |             |             |         |    |
|       | which is    |             |             |         |    |
|       | suitable    |             |             |         |    |
|       | for UL      |             |             |         |    |
|       | t           |             |             |         |    |
|       | ransmission |             |             |         |    |
|       | in the next |             |             |         |    |
|       | consecutive |             |             |         |    |
|       | N-1 slots   |             |             |         |    |
|       | with same   |             |             |         |    |
|       | resource    |             |             |         |    |
|       | allocation  |             |             |         |    |
|       | but         |             |             |         |    |
|       | different   |             |             |         |    |
|       | redundancy  |             |             |         |    |
|       | version?    |             |             |         |    |
|       |             |             |             |         |    |
|       | NOTE 1: N   |             |             |         |    |
|       | is the      |             |             |         |    |
|       | repetition  |             |             |         |    |
|       | number      |             |             |         |    |
|       | indicated   |             |             |         |    |
|       | by the 1st  |             |             |         |    |
|       | entry of    |             |             |         |    |
|       | *numberOf   |             |             |         |    |
|       | Msg3-Repeti |             |             |         |    |
|       | tionsList*. |             |             |         |    |
|       |             |             |             |         |    |
|       | NOTE 2: The |             |             |         |    |
|       | redundancy  |             |             |         |    |
|       | version for |             |             |         |    |
|       | the first   |             |             |         |    |
|       | t           |             |             |         |    |
|       | ransmission |             |             |         |    |
|       | and all     |             |             |         |    |
|       | possible    |             |             |         |    |
|       | repetitions |             |             |         |    |
|       | are set in  |             |             |         |    |
|       | the         |             |             |         |    |
|       | following   |             |             |         |    |
|       | order {0,   |             |             |         |    |
|       | 2, 3, 1}    |             |             |         |    |
|       | according   |             |             |         |    |
|       | to TS       |             |             |         |    |
|       | 38.214      |             |             |         |    |
|       | \[15\]      |             |             |         |    |
|       | Table       |             |             |         |    |
|       | 6.1.2.1-2,  |             |             |         |    |
|       | first row.  |             |             |         |    |
|       | Usage of    |             |             |         |    |
|       | correct     |             |             |         |    |
|       | redundancy  |             |             |         |    |
|       | version is  |             |             |         |    |
|       | implicitly  |             |             |         |    |
|       | checked     |             |             |         |    |
|       | upon        |             |             |         |    |
|       | correct     |             |             |         |    |
|       | decoding by |             |             |         |    |
|       | the SS of   |             |             |         |    |
|       | the UE UL   |             |             |         |    |
|       | r           |             |             |         |    |
|       | epetitions. |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 5     | The SS      | \<\--       | DCI format  | \-      | \- |
|       | transmits a |             | 0\_0        |         |    |
|       | DCI format  |             | (TC-RNTI)   |         |    |
|       | 0\_0        |             |             |         |    |
|       | addressed   |             |             |         |    |
|       | to TC-RNTI  |             |             |         |    |
|       | with MCS =  |             |             |         |    |
|       | "01000" and |             |             |         |    |
|       | rv^ID^ = 2  |             |             |         |    |
|       | to indicate |             |             |         |    |
|       | Msg.3       |             |             |         |    |
|       | retr        |             |             |         |    |
|       | ansmission. |             |             |         |    |
|       |             |             |             |         |    |
|       | NOTE: This  |             |             |         |    |
|       | message is  |             |             |         |    |
|       | scheduled   |             |             |         |    |
|       | ap          |             |             |         |    |
|       | proximately |             |             |         |    |
|       | middle of   |             |             |         |    |
|       | contention  |             |             |         |    |
|       | resolution  |             |             |         |    |
|       | window in   |             |             |         |    |
|       | UE.         |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 6     | Check: Does | \--\>       | MAC PDU     | 1       | P  |
|       | the UE      |             | (*RRCSet    |         |    |
|       | retransmit  |             | upRequest*) |         |    |
|       | the MAC PDU |             |             |         |    |
|       | containing  |             |             |         |    |
|       | *RRCSe      |             |             |         |    |
|       | tupRequest* |             |             |         |    |
|       | message and |             |             |         |    |
|       | repeat      |             |             |         |    |
|       | t           |             |             |         |    |
|       | ransmitting |             |             |         |    |
|       | this MAC    |             |             |         |    |
|       | PDU in      |             |             |         |    |
|       | every slot  |             |             |         |    |
|       | which is    |             |             |         |    |
|       | suitable    |             |             |         |    |
|       | for UL      |             |             |         |    |
|       | t           |             |             |         |    |
|       | ransmission |             |             |         |    |
|       | in the next |             |             |         |    |
|       | consecutive |             |             |         |    |
|       | N-1 slots   |             |             |         |    |
|       | with same   |             |             |         |    |
|       | resource    |             |             |         |    |
|       | allocation  |             |             |         |    |
|       | but         |             |             |         |    |
|       | different   |             |             |         |    |
|       | redundancy  |             |             |         |    |
|       | version?    |             |             |         |    |
|       |             |             |             |         |    |
|       | NOTE 1: N   |             |             |         |    |
|       | is the      |             |             |         |    |
|       | repetition  |             |             |         |    |
|       | number      |             |             |         |    |
|       | indicated   |             |             |         |    |
|       | by the 2nd  |             |             |         |    |
|       | entry of    |             |             |         |    |
|       | *numberOf   |             |             |         |    |
|       | Msg3-Repeti |             |             |         |    |
|       | tionsList*. |             |             |         |    |
|       |             |             |             |         |    |
|       | NOTE 2: The |             |             |         |    |
|       | redundancy  |             |             |         |    |
|       | version for |             |             |         |    |
|       | the first   |             |             |         |    |
|       | t           |             |             |         |    |
|       | ransmission |             |             |         |    |
|       | and all     |             |             |         |    |
|       | possible    |             |             |         |    |
|       | repetitions |             |             |         |    |
|       | are set in  |             |             |         |    |
|       | the         |             |             |         |    |
|       | following   |             |             |         |    |
|       | order {0,   |             |             |         |    |
|       | 2, 3, 1}    |             |             |         |    |
|       | according   |             |             |         |    |
|       | to TS       |             |             |         |    |
|       | 38.214      |             |             |         |    |
|       | \[15\]      |             |             |         |    |
|       | Table       |             |             |         |    |
|       | 6.1.2.1-2,  |             |             |         |    |
|       | second row. |             |             |         |    |
|       | Usage of    |             |             |         |    |
|       | correct     |             |             |         |    |
|       | redundancy  |             |             |         |    |
|       | version is  |             |             |         |    |
|       | implicitly  |             |             |         |    |
|       | checked     |             |             |         |    |
|       | upon        |             |             |         |    |
|       | correct     |             |             |         |    |
|       | decoding by |             |             |         |    |
|       | the SS of   |             |             |         |    |
|       | the UE UL   |             |             |         |    |
|       | r           |             |             |         |    |
|       | epetitions. |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 7-12  | Steps 3 to  | \-          | \-          | \-      | \- |
|       | 8 of        |             |             |         |    |
|       | generic     |             |             |         |    |
|       | test        |             |             |         |    |
|       | procedure   |             |             |         |    |
|       | in TS       |             |             |         |    |
|       | 38.508-1    |             |             |         |    |
|       | \[4\] Table |             |             |         |    |
|       | 4.5.4.2-3   |             |             |         |    |
|       | are         |             |             |         |    |
|       | performed   |             |             |         |    |
|       | on NR Cell  |             |             |         |    |
|       | 1.          |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 13    | The SS      | \<\--       | NR RRC*:    | \-      | \- |
|       | transmits   |             | RRCRelease* |         |    |
|       | an          |             |             |         |    |
|       | *           |             |             |         |    |
|       | RRCRelease* |             |             |         |    |
|       | message*.*  |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 14    | The SS      | \-          | \-          | \-      | \- |
|       | changes NR  |             |             |         |    |
|       | Cell 1      |             |             |         |    |
|       | power level |             |             |         |    |
|       | according   |             |             |         |    |
|       | to the row  |             |             |         |    |
|       | \"T0\" in   |             |             |         |    |
|       | Table       |             |             |         |    |
|       | 7.1.1.1     |             |             |         |    |
|       | .18.3.2-1/2 |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 15    | Wait 10s.   | \-          | \-          | \-      | \- |
+-------+-------------+-------------+-------------+---------+----+
| 16    | The SS      | \<\--       | NR RRC*:    | \-      | \- |
|       | transmits a |             | Paging*     |         |    |
|       | Paging      |             |             |         |    |
|       | message     |             |             |         |    |
|       | including a |             |             |         |    |
|       | matched UE  |             |             |         |    |
|       | identity.   |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 17    | Check: Does | \--\>       | *PRACH      | 2       | P  |
|       | the UE      |             | preamble*   |         |    |
|       | transmit a  |             |             |         |    |
|       | PRACH       |             |             |         |    |
|       | preamble    |             |             |         |    |
|       | belonging   |             |             |         |    |
|       | to the      |             |             |         |    |
|       | random      |             |             |         |    |
|       | access      |             |             |         |    |
|       | resource    |             |             |         |    |
|       | set not for |             |             |         |    |
|       | Msg3        |             |             |         |    |
|       | repetition? |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 18    | The SS      | \<\--       | Random      | \-      | \- |
|       | transmits   |             | Access      |         |    |
|       | Random      |             | Response    |         |    |
|       | Access      |             |             |         |    |
|       | Response    |             |             |         |    |
|       | with RAPID  |             |             |         |    |
|       | co          |             |             |         |    |
|       | rresponding |             |             |         |    |
|       | to the      |             |             |         |    |
|       | transmitted |             |             |         |    |
|       | Preamble in |             |             |         |    |
|       | step 17 and |             |             |         |    |
|       | MCS =       |             |             |         |    |
|       | "0000".     |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 19    | Check: Does | \--\>       | MAC PDU     | 2       | P  |
|       | the UE      |             | (*RRCSet    |         |    |
|       | transmit a  |             | upRequest*) |         |    |
|       | MAC PDU     |             |             |         |    |
|       | containing  |             |             |         |    |
|       | an          |             |             |         |    |
|       | *RRCSe      |             |             |         |    |
|       | tupRequest* |             |             |         |    |
|       | message and |             |             |         |    |
|       | not repeat  |             |             |         |    |
|       | t           |             |             |         |    |
|       | ransmitting |             |             |         |    |
|       | this MAC    |             |             |         |    |
|       | PDU in      |             |             |         |    |
|       | following   |             |             |         |    |
|       | slots which |             |             |         |    |
|       | are         |             |             |         |    |
|       | suitable    |             |             |         |    |
|       | for UL      |             |             |         |    |
|       | tr          |             |             |         |    |
|       | ansmission? |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 20-25 | Steps 3 to  | \-          | \-          | \-      | \- |
|       | 8 of        |             |             |         |    |
|       | generic     |             |             |         |    |
|       | test        |             |             |         |    |
|       | procedure   |             |             |         |    |
|       | in TS       |             |             |         |    |
|       | 38.508-1    |             |             |         |    |
|       | \[4\] Table |             |             |         |    |
|       | 4.5.4.2-3   |             |             |         |    |
|       | are         |             |             |         |    |
|       | performed   |             |             |         |    |
|       | on NR Cell  |             |             |         |    |
|       | 1.          |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 26    | The SS      | \<\--       | NR RRC*:    | \-      | \- |
|       | transmits   |             | RRCRelease* |         |    |
|       | an          |             |             |         |    |
|       | *           |             |             |         |    |
|       | RRCRelease* |             |             |         |    |
|       | message*.*  |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 27    | The SS      | \-          | \-          | \-      | \- |
|       | changes the |             |             |         |    |
|       | SIB1 of NR  |             |             |         |    |
|       | Cell 1 to   |             |             |         |    |
|       | release the |             |             |         |    |
|       | random      |             |             |         |    |
|       | access      |             |             |         |    |
|       | resource    |             |             |         |    |
|       | set not for |             |             |         |    |
|       | Msg3        |             |             |         |    |
|       | repetition. |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 28    | The SS      | \<\--       | PDCCH (DCI  | \-      | \- |
|       | transmits a |             | 1\_0):      |         |    |
|       | Short       |             | Short       |         |    |
|       | Message on  |             | Message     |         |    |
|       | PDCCH using |             |             |         |    |
|       | P-RNTI      |             |             |         |    |
|       | indicating  |             |             |         |    |
|       | a           |             |             |         |    |
|       | *sy         |             |             |         |    |
|       | stemInfoMod |             |             |         |    |
|       | ification*. |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 29    | Wait for    | \-          | \-          | \-      | \- |
|       | 2.1\*       |             |             |         |    |
|       | m           |             |             |         |    |
|       | odification |             |             |         |    |
|       | period      |             |             |         |    |
|       | seconds for |             |             |         |    |
|       | the UE to   |             |             |         |    |
|       | receive new |             |             |         |    |
|       | system      |             |             |         |    |
|       | i           |             |             |         |    |
|       | nformation. |             |             |         |    |
|       |             |             |             |         |    |
|       | NOTE: The   |             |             |         |    |
|       | m           |             |             |         |    |
|       | odification |             |             |         |    |
|       | period,     |             |             |         |    |
|       | expressed   |             |             |         |    |
|       | in number   |             |             |         |    |
|       | of radio    |             |             |         |    |
|       | frames =    |             |             |         |    |
|       | m           |             |             |         |    |
|       | odification |             |             |         |    |
|       | PeriodCoeff |             |             |         |    |
|       | \*          |             |             |         |    |
|       | defaultP    |             |             |         |    |
|       | agingCycle. |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 30    | The SS      | \<\--       | NR RRC*:    | \-      | \- |
|       | transmits a |             | Paging*     |         |    |
|       | Paging      |             |             |         |    |
|       | message     |             |             |         |    |
|       | including a |             |             |         |    |
|       | matched UE  |             |             |         |    |
|       | identity.   |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 31    | Check: Does | \--\>       | *PRACH      | 3       | P  |
|       | the UE      |             | preamble*   |         |    |
|       | transmit a  |             |             |         |    |
|       | PRACH       |             |             |         |    |
|       | preamble    |             |             |         |    |
|       | belonging   |             |             |         |    |
|       | to the      |             |             |         |    |
|       | random      |             |             |         |    |
|       | access      |             |             |         |    |
|       | resource    |             |             |         |    |
|       | set for     |             |             |         |    |
|       | Msg3        |             |             |         |    |
|       | repetition? |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 32    | The SS      | \<\--       | Random      | \-      | \- |
|       | transmits   |             | Access      |         |    |
|       | Random      |             | Response    |         |    |
|       | Access      |             |             |         |    |
|       | Response    |             |             |         |    |
|       | with RAPID  |             |             |         |    |
|       | co          |             |             |         |    |
|       | rresponding |             |             |         |    |
|       | to the      |             |             |         |    |
|       | transmitted |             |             |         |    |
|       | Preamble in |             |             |         |    |
|       | step 31 and |             |             |         |    |
|       | MCS =       |             |             |         |    |
|       | "0000".     |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 33    | Check: Does | \--\>       | MAC PDU     | 3       | P  |
|       | the UE      |             | (*RRCSet    |         |    |
|       | transmit a  |             | upRequest*) |         |    |
|       | MAC PDU     |             |             |         |    |
|       | containing  |             |             |         |    |
|       | an          |             |             |         |    |
|       | *RRCSe      |             |             |         |    |
|       | tupRequest* |             |             |         |    |
|       | message and |             |             |         |    |
|       | not repeat  |             |             |         |    |
|       | t           |             |             |         |    |
|       | ransmitting |             |             |         |    |
|       | this MAC    |             |             |         |    |
|       | PDU in      |             |             |         |    |
|       | following   |             |             |         |    |
|       | slots which |             |             |         |    |
|       | is suitable |             |             |         |    |
|       | for UL      |             |             |         |    |
|       | tr          |             |             |         |    |
|       | ansmission? |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 34    | The SS      | \<\--       | DCI format  | \-      | \- |
|       | transmits a |             | 0\_0        |         |    |
|       | DCI format  |             | (TC-RNTI)   |         |    |
|       | 0\_0        |             |             |         |    |
|       | addressed   |             |             |         |    |
|       | to TC-RNTI  |             |             |         |    |
|       | with MCS =  |             |             |         |    |
|       | "01000" and |             |             |         |    |
|       | rv^ID^ = 2  |             |             |         |    |
|       | to indicate |             |             |         |    |
|       | Msg3        |             |             |         |    |
|       | retr        |             |             |         |    |
|       | ansmission. |             |             |         |    |
|       |             |             |             |         |    |
|       | NOTE: This  |             |             |         |    |
|       | message is  |             |             |         |    |
|       | scheduled   |             |             |         |    |
|       | ap          |             |             |         |    |
|       | proximately |             |             |         |    |
|       | middle of   |             |             |         |    |
|       | contention  |             |             |         |    |
|       | resolution  |             |             |         |    |
|       | window in   |             |             |         |    |
|       | UE.         |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 35    | Check: Does | \--\>       | MAC PDU     | 3       | P  |
|       | the UE      |             | (*RRCSet    |         |    |
|       | retransmit  |             | upRequest*) |         |    |
|       | the MAC PDU |             |             |         |    |
|       | containing  |             |             |         |    |
|       | *RRCSe      |             |             |         |    |
|       | tupRequest* |             |             |         |    |
|       | message and |             |             |         |    |
|       | repeat      |             |             |         |    |
|       | t           |             |             |         |    |
|       | ransmitting |             |             |         |    |
|       | this MAC    |             |             |         |    |
|       | PDU in      |             |             |         |    |
|       | every slot  |             |             |         |    |
|       | which is    |             |             |         |    |
|       | suitable    |             |             |         |    |
|       | for UL      |             |             |         |    |
|       | t           |             |             |         |    |
|       | ransmission |             |             |         |    |
|       | in the next |             |             |         |    |
|       | consecutive |             |             |         |    |
|       | 1 slot with |             |             |         |    |
|       | same        |             |             |         |    |
|       | resource    |             |             |         |    |
|       | allocation  |             |             |         |    |
|       | but         |             |             |         |    |
|       | different   |             |             |         |    |
|       | redundancy  |             |             |         |    |
|       | version?    |             |             |         |    |
|       |             |             |             |         |    |
|       | NOTE: The   |             |             |         |    |
|       | redundancy  |             |             |         |    |
|       | version for |             |             |         |    |
|       | the first   |             |             |         |    |
|       | t           |             |             |         |    |
|       | ransmission |             |             |         |    |
|       | and all     |             |             |         |    |
|       | possible    |             |             |         |    |
|       | repetitions |             |             |         |    |
|       | are set in  |             |             |         |    |
|       | the         |             |             |         |    |
|       | following   |             |             |         |    |
|       | order {0,   |             |             |         |    |
|       | 2, 3, 1}    |             |             |         |    |
|       | according   |             |             |         |    |
|       | to TS       |             |             |         |    |
|       | 38.214      |             |             |         |    |
|       | \[15\]      |             |             |         |    |
|       | Table       |             |             |         |    |
|       | 6.1.2.1-2,  |             |             |         |    |
|       | second row. |             |             |         |    |
|       | Usage of    |             |             |         |    |
|       | correct     |             |             |         |    |
|       | redundancy  |             |             |         |    |
|       | version is  |             |             |         |    |
|       | implicitly  |             |             |         |    |
|       | checked     |             |             |         |    |
|       | upon        |             |             |         |    |
|       | correct     |             |             |         |    |
|       | decoding by |             |             |         |    |
|       | the SS of   |             |             |         |    |
|       | the UE UL   |             |             |         |    |
|       | r           |             |             |         |    |
|       | epetitions. |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 36-41 | Steps 3 to  | \-          | \-          | \-      | \- |
|       | 8 of        |             |             |         |    |
|       | generic     |             |             |         |    |
|       | test        |             |             |         |    |
|       | procedure   |             |             |         |    |
|       | in TS       |             |             |         |    |
|       | 38.508-1    |             |             |         |    |
|       | \[4\] Table |             |             |         |    |
|       | 4.5.4.2-3   |             |             |         |    |
|       | are         |             |             |         |    |
|       | performed   |             |             |         |    |
|       | on NR Cell  |             |             |         |    |
|       | 1.          |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+
| 42    | The SS      | \<\--       | NR RRC*:    | \-      | \- |
|       | transmits   |             | RRCRelease* |         |    |
|       | an          |             |             |         |    |
|       | *           |             |             |         |    |
|       | RRCRelease* |             |             |         |    |
|       | message*.*  |             |             |         |    |
+-------+-------------+-------------+-------------+---------+----+

##### 7.1.1.1.18.3.3 Specific message contents {#specific-message-contents-17 .H6}

Table 7.1.1.1.18.3.3-1: *SIB1* (Cell 1, Preamble and Step 27, Table
7.1.1.1.18.3.2-3)

  --------------------------------------------------- ------------------ ------------------------ -----------
  Derivation Path: TS 38.508-1 \[4\] Table 4.6.1-28                                               
  Information Element                                 Value/remark       Comment                  Condition
  SIB1 ::= SEQUENCE {                                                                             
  servingCellConfigCommon SEQUENCE {                                                              
  uplinkConfigCommon SEQUENCE {                                                                   
  initialUplinkBWP                                    BWP-UplinkCommon   Table 7.1.1.1.18.3.3-2   
  }                                                                                               
  }                                                                                               
  }                                                                                               
  --------------------------------------------------- ------------------ ------------------------ -----------

Table 7.1.1.1.18.3.3-2: *BWP-UplinkCommon* (Table 7.1.1.1.18.3.3-1)

  ---------------------------------------------------------------------------------------- -------------------------- ------------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-14                                                                                                        
  Information Element                                                                      Value/remark               Comment                               Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                                                                                           
  rach-ConfigCommon CHOICE {                                                                                                                                
  setup                                                                                    RACH-ConfigCommon-2Group   Table 7.1.1.1.18.3.3-3                Preamble
                                                                                           RACH-ConfigCommon-1Group   Table 7.1.1.1.18.3.3-4                Step 27
  }                                                                                                                                                         
  rsrp-ThresholdMsg3-r17                                                                   71                         Actual value = 71-156 = -85 dBm/SCS   Preamble
                                                                                           Not present                                                      Step 27
  numberOfMsg3-RepetitionsList-r17                                                         Not present                                                      Step 27
  numberOfMsg3-RepetitionsList-r17 SEQUENCE (SIZE (4)) OF NumberOfMsg3-Repetitions-r17 {   4 entries                                                        Preamble
  NumberOfMsg3-Repetitions-r17\[1\]                                                        n4                         Entry 1                               
  NumberOfMsg3-Repetitions-r17\[2\]                                                        n3                         Entry 2                               
  NumberOfMsg3-Repetitions-r17\[3\]                                                        n2                         Entry 3                               
  NumberOfMsg3-Repetitions-r17\[4\]                                                        n1                         Entry 4                               
  }                                                                                                                                                         
  }                                                                                                                                                         
  ---------------------------------------------------------------------------------------- -------------------------- ------------------------------------- -----------

Table 7.1.1.1.18.3.3-3: *RACH-ConfigCommon-2Group* (Table
7.1.1.1.18.3.3-2)

+-----------------+-----------------+-----------------+-----------+
| Derivation      |                 |                 |           |
| Path: TS        |                 |                 |           |
| 38.508-1 \[4\], |                 |                 |           |
| Table 4.6.3-128 |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| Information     | Value/remark    | Comment         | Condition |
| Element         |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| RA              |                 |                 |           |
| CH-ConfigCommon |                 |                 |           |
| ::= SEQUENCE {  |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| f               | 2 entries       |                 |           |
| eatureCombinati |                 |                 |           |
| onPreambles-r17 |                 |                 |           |
| SEQUENCE        |                 |                 |           |
| (SIZE(1.        |                 |                 |           |
| .maxFeatureComb |                 |                 |           |
| PreamblesPerRAC |                 |                 |           |
| HResource-r17)) |                 |                 |           |
| OF              |                 |                 |           |
| F               |                 |                 |           |
| eatureCombinati |                 |                 |           |
| onPreambles-r17 |                 |                 |           |
| {               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| Featur          | FeatureCombin   | Entry 1         |           |
| eCombinationPre | ationPreamble-N |                 |           |
| ambles-r17\[1\] | oMsg3Repetition | Table           |           |
|                 |                 | 7               |           |
|                 |                 | .1.1.1.18.3.3-5 |           |
+-----------------+-----------------+-----------------+-----------+
| Featur          | FeatureComb     | Entry 2         |           |
| eCombinationPre | inationPreamble |                 |           |
| ambles-r17\[2\] | -Msg3Repetition | Table           |           |
|                 |                 | 7               |           |
|                 |                 | .1.1.1.18.3.3-6 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+

Table 7.1.1.1.18.3.3-4: *RACH-ConfigCommon-1Group* (Table
7.1.1.1.18.3.3-2)

+-----------------+-----------------+-----------------+-----------+
| Derivation      |                 |                 |           |
| Path: TS        |                 |                 |           |
| 38.508-1 \[4\], |                 |                 |           |
| Table 4.6.3-128 |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| Information     | Value/remark    | Comment         | Condition |
| Element         |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| RA              |                 |                 |           |
| CH-ConfigCommon |                 |                 |           |
| ::= SEQUENCE {  |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| f               | 1 entry         |                 |           |
| eatureCombinati |                 |                 |           |
| onPreambles-r17 |                 |                 |           |
| SEQUENCE        |                 |                 |           |
| (SIZE(1.        |                 |                 |           |
| .maxFeatureComb |                 |                 |           |
| PreamblesPerRAC |                 |                 |           |
| HResource-r17)) |                 |                 |           |
| OF              |                 |                 |           |
| F               |                 |                 |           |
| eatureCombinati |                 |                 |           |
| onPreambles-r17 |                 |                 |           |
| {               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| Featur          | FeatureComb     | Entry 1         |           |
| eCombinationPre | inationPreamble |                 |           |
| ambles-r17\[1\] | -Msg3Repetition | Table           |           |
|                 |                 | 7               |           |
|                 |                 | .1.1.1.18.3.3-6 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+
| }               |                 |                 |           |
+-----------------+-----------------+-----------------+-----------+

Table 7.1.1.1.18.3.3-5: *FeatureCombinationPreambles*-*NoMsg3Repetition*
(Table 7.1.1.1.18.3.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-56E                                                           
  ----------------------------------------------------- -------------- ---------------------------------------- -----------
  Information Element                                   Value/remark   Comment                                  Condition
  FeatureCombinationPreambles-r17 ::= SEQUENCE {                                                                
  numberOfPreamblesPerSSB-ForThisPartition-r17          4              RAP index 0,1,2,3 belong to this group   FR1
                                                        2              RAP index 0,1 belong to this group       FR2
  msgA-RSRP-Threshold-r17                               Not present                                             
  rsrp-ThresholdSSB-r17                                 Not present                                             
  }                                                                                                             

Table 7.1.1.1.18.3.3-6: *FeatureCombinationPreambles*-*Msg3Repetition*
(Table 7.1.1.1.18.3.3-3 and Table 7.1.1.1.18.3.3-4)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-56E                                                                                              
  ----------------------------------------------------- ------------------------------------------------- ---------------------------------------- -----------
  Information Element                                   Value/remark                                      Comment                                  Condition
  FeatureCombinationPreambles-r17 ::= SEQUENCE {                                                                                                   
  featureCombination-r17                                FeatureCombination-r17 with condition MSG3\_REP                                            
  startPreambleForThisPartition-r17                     4                                                                                          FR1
                                                        2                                                                                          FR2
  numberOfPreamblesPerSSB-ForThisPartition-r17          4                                                 RAP index 4,5,6,7 belong to this group   FR1
                                                        2                                                 RAP index 2,3 belong to this group       FR2
  msgA-RSRP-Threshold-r17                               Not present                                                                                
  rsrp-ThresholdSSB-r17                                 Not present                                                                                
  }                                                                                                                                                

##### 7.1.1.1.19 Random access procedure / Successful / Beam Failure / Unified TCI

##### 7.1.1.1.19.1 Test Purpose (TP) {#test-purpose-tp-18 .H6}

##### (1) {#section-57 .H6}

**with** { UE in RRC\_CONNECTED state with TCI-State\_r17 configured and
periodic SRS resource configured, and RACH procedure due to beam failure
is triggered }

**ensure that** {

**when** { UE initiates the Random Access Procedure, and receives the
first PDCCH in the search space provided by recoverySearchSpaceID}

**then** { UE starts to transmit SRS that associates with the indicated
unified TCI state }

}

##### 7.1.1.1.19.2 Conformance requirements {#conformance-requirements-18 .H6}

References: The conformance requirements covered in the present test
case are specified in: TS 38.213 clause 6, TS 38.321, clause 5.1.2,
5.1.3, 5.1.4 and 5.17. Unless otherwise stated these are Rel-17
requirements.

\[TS 38.213, clause 6\]

For the PCell or the PSCell, a UE can be provided a CORESET through a
link to a search space set provided by *recoverySearchSpaceId,* as
described in clause 10.1, for monitoring PDCCH in the CORESET. If the UE
is provided *recoverySearchSpaceId*, the UE does not expect to be
provided another search space set for monitoring PDCCH in the CORESET
associated with the search space set provided by
*recoverySearchSpaceId*.

For the PCell or the PSCell, the UE can be provided, by
*PRACH-ResourceDedicatedBFR*, a configuration for PRACH transmission as
described in clause 8.1. For PRACH transmission in slot $n$ and
according to antenna port quasi co-location parameters associated with
periodic CSI-RS resource configuration or with SS/PBCH block associated
with index $q_{\text{new}}$ *provided by higher layers* \[11, TS
38.321\], the UE monitors PDCCH in a search space set provided by
*recoverySearchSpaceId* for detection of a DCI format with CRC scrambled
by C-RNTI or MCS-C-RNTI starting from slot
$n + 4 + {2^{\mu} \bullet k}_{\text{mac}}$, where $\mu$ is the SCS
configuration for the PRACH transmission and $k_{\text{mac}}$ is a
number of slots provided by *kmac* \[12, TS 38.331\] or
$k_{\text{mac}} = 0$ if *kmac* is not provided, within a window
configured by *BeamFailureRecoveryConfig. For PDCCH monitoring* in a
search space set provided by *recoverySearchSpaceId* *and for
corresponding PDSCH receptions, the UE assumes the same antenna port
quasi-collocation parameters as the ones associated with* index
$q_{\text{new}}$ *until the UE receives by higher layers an activation
for a TCI state or any of the parameters tci-StatesPDCCH-ToAddList
and/or tci-StatesPDCCH-ToReleaseList.* After the UE detects a DCI format
with CRC scrambled by C-RNTI or MCS-C-RNTI in the search space set
provided by *recoverySearchSpaceId*, the UE continues to monitor PDCCH
candidates in the search space set provided by *recoverySearchSpaceId*
until the UE receives a MAC CE activation command for a TCI state or
*tci-StatesPDCCH-ToAddList and/or tci-StatesPDCCH-ToReleaseList.*

*For the PCell or the PSCell, after 28 symbols from a last symbol of* a
first PDCCH reception in a search space set provided by
*recoverySearchSpaceId* for which the UE detects a DCI format with CRC
scrambled by C-RNTI or MCS-C-RNTI *and* until the UE receives an
activation command for *PUCCH-SpatialRelationInfo* \[11, TS 38.321\] or
is provided *PUCCH-SpatialRelationInfo* for PUCCH resource(s), t*he UE
transmits a PUCCH on a same cell as the PRACH transmission using*

\- *a* same spatial filter as for the last PRACH transmission

\- *a* power determined as described in clause 7.2.1 with $q_{u} = 0$,
${q_{d} = q}_{\text{new}}$, and $l = 0$

*For the PCell or the PSCell and for sets* ${\overline{q}}_{0}$ and
${\overline{q}}_{1}$*, after 28 symbols from a last symbol of a first
PDCCH reception in a search space set provided by recoverySearchSpaceId
where a UE detects a DCI format with CRC scrambled by C-RNTI or
MCS-C-RNTI, the UE assumes same antenna port quasi-collocation
parameters as the ones associated with index* $q_{\text{new}}$ *for
PDCCH monitoring in a CORESET with index 0.*

*If a UE is provided dl-OrJointTCI-StateList or* *ul-TCI-StateList
indicating a unified TCI state for the PCell or the PSCell \[6, TS
38.214\], after 28 symbols from a last symbol of* a first PDCCH
reception in a search space set provided by *recoverySearchSpaceId*
where the UE detects a DCI format with CRC scrambled by C-RNTI or
MCS-C-RNTI, the UE

\- if *SSB-MTC-AdditionalPCI* is not provided, monitors PDCCH in all
CORESETs, and receives PDSCH and aperiodic CSI-RS resource in a CSI-RS
resource set with same indicated TCI state as for the PDCCH and PDSCH,
using the *same antenna port quasi co-location parameters as the ones
associated with the corresponding index* $q_{\text{new}}$*, if any*

\- transmits PUSCH, PUCCH and SRS that uses a same spatial domain filter
with same indicated TCI state as for the PUSCH and the PUCCH, using a
same spatial domain filter as *for the last PRACH transmission using the
following parameters for determination of a corresponding power as
described in clauses 7.1.1, 7.2.1, and 7.3.1*

\- the RS index ${q_{d} = q}_{\text{new}}$ for obtaining the downlink
pathloss estimate

\- the values of $P_{\text{O\_UE\_PUSCH},b,f,c}\left( j \right)$,
$\alpha_{b,f,c}\left( j \right)$, and the PUSCH power control adjustment
state $l$ provided by *p0AlphaSetforPUSCH* associated with the smallest
value of *ul-powercontrolId* for the PCell or the PSCell

\- the value of
$P_{\text{O\_UE\_P}\text{U}\text{C}\text{CH}}\left( q_{u} \right)$ and
the PUCCH power control adjustment state $l$ provided by
*p0AlphaSetforPUCCH* associated with the smallest value of
*ul-powercontrolId* for the PCell or the PSCell

\- the values of $P_{\text{O\_UE\_SRS},b,f,c}\left( q_{s} \right)$,
$\alpha_{\text{SRS},b,f,c}\left( q_{s} \right)$, and the SRS power
control adjustment state $l$ provided by *p0AlphaSetforSRS* associated
with the smallest value of *ul-powercontrolId* for the PCell or the
PSCell

*For the remaining of this clause,* if a PDCCH reception includes two
PDCCH candidates from two linked search space sets based on
*searchSpaceLinkingId*, as described in clause 10.1, the last symbol of
the PDCCH reception is the last symbol of the PDCCH candidate that ends
later. The PDCCH reception includes the two PDCCH candidates also when
*the UE is not required to monitor one of the two PDCCH candidates as
described in clauses 10 (except clause 10.4), 11.1, 11.1.1 and 17.2.*

\[TS 38.321, clause 5.1.2\]

The MAC entity shall:

1\> if the Random Access procedure was initiated for beam failure
recovery (as specified in subclause 5.17); and

1\> if the *beamFailureRecoveryTimer* (in subclause 5.17) is either
running or not configured; and

1\> if the contention-free Random Access Resources for beam failure
recovery request associated with any of the SSBs and/or CSI-RSs have
been explicitly provided by RRC; and

1\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
amongst the SSBs in *candidateBeamRSList* or the CSI-RSs with CSI-RSRP
above *rsrp-ThresholdCSI-RS* amongst the CSI-RSs in
*candidateBeamRSList* is available:

2\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB* amongst the
SSBs in *candidateBeamRSList* or a CSI-RS with CSI-RSRP above
*rsrp-ThresholdCSI-RS* amongst the CSI-RSs in *candidateBeamRSList*;

2\> if CSI-RS is selected, and there is no *ra-PreambleIndex* associated
with the selected CSI-RS:

3\> set the *PREAMBLE\_INDEX* to a ra-PreambleIndex corresponding to the
SSB in *candidateBeamRSList* which is quasi-collocated with the selected
CSI-RS as specified in TS 38.214 \[7\].

2\> else:

3\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB or CSI-RS from the set of Random Access Preambles for
beam failure recovery request.

1\> else if the *ra-PreambleIndex* has been explicitly provided by
PDCCH; and

1\> if the *ra-PreambleIndex* is not 0b000000:

2\> set the *PREAMBLE\_INDEX* to the signalled *ra-PreambleIndex*;

2\> select the SSB signalled by PDCCH.

1\> else if the contention-free Random Access Resources associated with
SSBs have been explicitly provided by RRC and at least one SSB with
SS-RSRP above *rsrp-ThresholdSSB* amongst the associated SSBs is
available:

2\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB* amongst the
associated SSBs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected SSB.

1\> else if the contention-free Random Access Resources associated with
CSI-RSs have been explicitly provided by RRC and at least one CSI-RS
with CSI-RSRP above *rsrp-ThresholdCSI-RS* amongst the associated
CSI-RSs is available:

2\> select a CSI-RS with CSI-RSRP above *rsrp-ThresholdCSI-RS* amongst
the associated CSI-RSs;

2\> set the *PREAMBLE\_INDEX* to a *ra-PreambleIndex* corresponding to
the selected CSI-RS.

1\> else if the Random Access procedure was initiated for SI request (as
specified in TS 38.331 \[5\]); and

1\> if the Random Access Resources for SI request have been explicitly
provided by RRC:

2\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
is available:

3\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> select a Random Access Preamble corresponding to the selected SSB,
from the Random Access Preamble(s) determined according to
*ra-PreambleStartIndex* as specified in TS 38.331 \[5\];

2\> set the *PREAMBLE\_INDEX* to selected Random Access Preamble.

1\> else (i.e. for the contention-based Random Access preamble
selection):

2\> if at least one of the SSBs with SS-RSRP above *rsrp-ThresholdSSB*
is available:

3\> select an SSB with SS-RSRP above *rsrp-ThresholdSSB*.

2\> else:

3\> select any SSB.

2\> if the *RA\_TYPE* is switched from *2-stepRA* to *4-stepRA*:

3\> if a Random Access Preambles group was selected during the current
Random Access procedure:

4\> select the same group of Random Access Preambles as was selected for
the 2-step RA type.

3\> else:

4\> if Random Access Preambles group B is configured; and

4\> if the transport block size of the MSGA payload configured in the
*rach-ConfigDedicated* corresponds to the transport block size of the
MSGA payload associated with Random Access Preambles group B:

5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

2\> else if Msg3 buffer is empty:

3\> if Random Access Preambles group B is configured:

4\> if the potential Msg3 size (UL data available for transmission plus
MAC subheader(s) and, where required, MAC CEs) is greater than
*ra-Msg3SizeGroupA* and the pathloss is less than *PCMAX* (of the
Serving Cell performing the Random Access Procedure) --
*preambleReceivedTargetPower* -- *msg3-DeltaPreamble* --
*messagePowerOffsetGroupB*; or

4\> if the Random Access procedure was initiated for the CCCH logical
channel and the CCCH SDU size plus MAC subheader is greater than
*ra-Msg3SizeGroupA*:

5\> select the Random Access Preambles group B.

4\> else:

5\> select the Random Access Preambles group A.

3\> else:

4\> select the Random Access Preambles group A.

2\> else (i.e. Msg3 is being retransmitted):

3\> select the same group of Random Access Preambles as was used for the
Random Access Preamble transmission attempt corresponding to the first
transmission of Msg3.

2\> select a Random Access Preamble randomly with equal probability from
the Random Access Preambles associated with the selected SSB and the
selected Random Access Preambles group;

2\> set the *PREAMBLE\_INDEX* to the selected Random Access Preamble.

1\> if the Random Access procedure was initiated for SI request (as
specified in TS 38.331 \[5\]); and

1\> if *ra-AssociationPeriodIndex* and *si-RequestPeriod* are
configured:

2\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB in the association period given by
*ra-AssociationPeriodIndex* in the *si-RequestPeriod* permitted by the
restrictions given by the *ra-ssb-OccasionMaskIndex* if configured (the
MAC entity shall select a PRACH occasion randomly with equal probability
amongst the consecutive PRACH occasions according to clause 8.1 of TS
38.213 \[6\] corresponding to the selected SSB).

1\> else if an SSB is selected above:

2\> determine the next available PRACH occasion from the PRACH occasions
corresponding to the selected SSB permitted by the restrictions given by
the *ra-ssb-OccasionMaskIndex* if configured, or
*ssb-SharedRO-MaskIndex* if configured, or indicated by PDCCH (the MAC
entity shall select a PRACH occasion randomly with equal probability
amongst the consecutive PRACH occasions according to clause 8.1 of TS
38.213 \[6\] regardless the FR2 UL gap, corresponding to the selected
SSB; the MAC entity may take into account the possible occurrence of
measurement gaps and MUSIM gaps when determining the next available
PRACH occasion corresponding to the selected SSB).

1\> else if a CSI-RS is selected above:

2\> if there is no contention-free Random Access Resource associated
with the selected CSI-RS:

3\> determine the next available PRACH occasion from the PRACH
occasions, permitted by the restrictions given by the
*ra-ssb-OccasionMaskIndex* if configured, corresponding to the SSB in
*candidateBeamRSList* which is quasi-colocated with the selected CSI-RS
as specified in TS 38.214 \[7\] (the MAC entity shall select a PRACH
occasion randomly with equal probability amongst the consecutive PRACH
occasions according to clause 8.1 of TS 38.213 \[6\] regardless the FR2
UL gap, corresponding to the SSB which is quasi-colocated with the
selected CSI-RS; the MAC entity may take into account the possible
occurrence of measurement gaps and MUSIM gaps when determining the next
available PRACH occasion corresponding to the SSB which is
quasi-colocated with the selected CSI-RS).

2\> else:

3\> determine the next available PRACH occasion from the PRACH occasions
in *ra-OccasionList* corresponding to the selected CSI-RS (the MAC
entity shall select a PRACH occasion randomly with equal probability
amongst the PRACH occasions occurring simultaneously but on different
subcarriers regardless the FR2 UL gap, corresponding to the selected
CSI-RS; the MAC entity may take into account the possible occurrence of
measurement gaps and MUSIM gaps when determining the next available
PRACH occasion corresponding to the selected CSI-RS).

1\> perform the Random Access Preamble transmission procedure (see
clause 5.1.3).

NOTE 1: When the UE determines if there is an SSB with SS-RSRP above
*rsrp-ThresholdSSB* or a CSI-RS with CSI-RSRP above
*rsrp-ThresholdCSI-RS*, the UE uses the latest unfiltered L1-RSRP
measurement.

NOTE 2: Void.

NOTE 3: If a RedCap UE in RRC\_IDLE or RRC\_INACTIVE mode is configured
with a BWP indicated by *initialDownlinkBWP-RedCap* which is not
associated with any SSB, SS-RSRP measurement is performed based on the
SSB associated with the BWP indicated by *initialDownlinkBWP*. If a
RedCap UE in RRC\_INACTIVE mode is configured with SDT and with a BWP
indicated by *initialDownlinkBWP-RedCap* which is associated with
NCD-SSB, SS-RSRP measurement can also be performed based on this NCD-SSB
during SDT.

NOTE 4: If a RedCap UE in RRC\_IDLE or RRC\_INACTIVE mode is configured
with a BWP indicated by *initialDownlinkBWP-RedCap* which is not
associated with any SSB for RACH, it is up to the UE implementation to
perform a new RSRP measurements before Msg1/MsgA retransmission.

\[TS 38.321, clause 5.1.4\]

Once the Random Access Preamble is transmitted and regardless of the
possible occurrence of a measurement gap, the MAC entity shall:

1\> if the contention-free Random Access Preamble for beam failure
recovery request was transmitted by the MAC entity:

2\> if the contention-free Random Access Preamble for beam failure
recovery request was transmitted on a non-terrestrial network:

3\> start the *ra-ResponseWindow* configured in
*BeamFailureRecoveryConfig* at the PDCCH occasion as specified in TS
38.213 \[6\].

2\> else:

3\> start the *ra-ResponseWindow* configured in
*BeamFailureRecoveryConfig* at the first PDCCH occasion as specified in
TS 38.213 \[6\] from the end of the Random Access Preamble transmission.

2\> monitor for a PDCCH transmission on the search space indicated by
*recoverySearchSpaceId* of the SpCell identified by the C-RNTI while
*ra-ResponseWindow* is running.

1\> else:

2\> if the Random Access Preamble was transmitted on a non-terrestrial
network:

3\> start the *ra-ResponseWindow* configured in *RACH-ConfigCommon* at
the PDCCH occasion as specified in TS 38.213 \[6\].

2\> else:

3\> start the *ra-ResponseWindow* configured in *RACH-ConfigCommon* at
the first PDCCH occasion as specified in TS 38.213 \[6\] from the end of
the Random Access Preamble transmission.

2\> monitor the PDCCH of the SpCell for Random Access Response(s)
identified by the RA-RNTI while the *ra-ResponseWindow* is running.

1\> if notification of a reception of a PDCCH transmission on the search
space indicated by *recoverySearchSpaceId* is received from lower layers
on the Serving Cell where the preamble was transmitted; and

1\> if PDCCH transmission is addressed to the C-RNTI; and

1\> if the contention-free Random Access Preamble for beam failure
recovery request was transmitted by the MAC entity:

2\> consider the Random Access procedure successfully completed.

1\> else if a valid (as specified in TS 38.213 \[6\]) downlink
assignment has been received on the PDCCH for the RA-RNTI and the
received TB is successfully decoded:

2\> if the Random Access Response contains a MAC subPDU with Backoff
Indicator:

3\> set the *PREAMBLE\_BACKOFF* to value of the BI field of the MAC
subPDU using Table 7.2-1, multiplied with *SCALING\_FACTOR\_BI*.

2\> else:

3\> set the *PREAMBLE\_BACKOFF* to 0 ms.

2\> if the Random Access Response contains a MAC subPDU with Random
Access Preamble identifier corresponding to the transmitted
*PREAMBLE\_INDEX* (see clause 5.1.3):

3\> consider this Random Access Response reception successful.

2\> if the Random Access Response reception is considered successful:

3\> if the Random Access Response includes a MAC subPDU with RAPID only:

4\> consider this Random Access procedure successfully completed;

4\> indicate the reception of an acknowledgement for SI request to upper
layers.

3\> else:

4\> apply the following actions for the Serving Cell where the Random
Access Preamble was transmitted:

5\> process the received Timing Advance Command (see clause 5.2);

5\> indicate the *preambleReceivedTargetPower* and the amount of power
ramping applied to the latest Random Access Preamble transmission to
lower layers (i.e. (*PREAMBLE\_POWER\_RAMPING\_COUNTER* -- 1) Ã—
*PREAMBLE\_POWER\_RAMPING\_STEP*);

5\> if the Random Access procedure for an SCell is performed on uplink
carrier where *pusch-Config* is not configured:

6\> ignore the received UL grant.

5\> else:

6\> process the received UL grant value and indicate it to the lower
layers.

4\> if the Random Access Preamble was not selected by the MAC entity
among the contention-based Random Access Preamble(s):

5\> consider the Random Access procedure successfully completed.

4\> else:

5\> set the *TEMPORARY\_C-RNTI* to the value received in the Random
Access Response;

5\> if this is the first successfully received Random Access Response
within this Random Access procedure:

6\> if the transmission is not being made for the CCCH logical channel:

> 7\> indicate to the Multiplexing and assembly entity to include a
> C-RNTI MAC CE in the subsequent uplink transmission.

6\> if the Random Access procedure was initiated for SpCell beam failure
recovery and *spCell-BFR-CBRA* with value *true* is configured:

> 7\> if there is at least one Serving Cell of this MAC entity
> configured with two BFD-RS sets:

8\> indicate to the Multiplexing and assembly entity to include an
Enhanced BFR MAC CE or a Truncated Enhanced BFR MAC CE in the subsequent
uplink transmission.

> 7\> else:

8\> indicate to the Multiplexing and assembly entity to include a BFR
MAC CE or a Truncated BFR MAC CE in the subsequent uplink transmission.

6\> else if the Random Access procedure was initiated for beam failure
recovery of both BFD-RS sets of SpCell:

> 7\> indicate to the Multiplexing and assembly entity to include an
> Enhanced BFR MAC CE or a Truncated Enhanced BFR MAC CE in the
> subsequent uplink transmission.

6\> obtain the MAC PDU to transmit from the Multiplexing and assembly
entity and store it in the Msg3 buffer.

NOTE: If within a Random Access procedure, an uplink grant provided in
the Random Access Response for the same group of contention-based Random
Access Preambles has a different size than the first uplink grant
allocated during that Random Access procedure, the UE behavior is not
defined.

1\> if *ra-ResponseWindow* configured in *BeamFailureRecoveryConfig*
expires and if a PDCCH transmission on the search space indicated by
*recoverySearchSpaceId* addressed to the C-RNTI has not been received on
the Serving Cell where the preamble was transmitted; or

1\> if *ra-ResponseWindow* configured in *RACH-ConfigCommon* expires,
and if the Random Access Response containing Random Access Preamble
identifiers that matches the transmitted *PREAMBLE\_INDEX* has not been
received:

2\> consider the Random Access Response reception not successful;

2\> increment *PREAMBLE\_TRANSMISSION\_COUNTER* by 1;

2\> if *PREAMBLE\_TRANSMISSION\_COUNTER* = *preambleTransMax* + 1:

3\> if the Random Access Preamble is transmitted on the SpCell:

4\> indicate a Random Access problem to upper layers;

4\> if this Random Access procedure was triggered for SI request:

5\> consider the Random Access procedure unsuccessfully completed.

3\> else if the Random Access Preamble is transmitted on an SCell:

4\> consider the Random Access procedure unsuccessfully completed.

2\> if the Random Access procedure is not completed:

3\> select a random backoff time according to a uniform distribution
between 0 and the *PREAMBLE\_BACKOFF*;

3\> if the criteria (as defined in clause 5.1.2) to select
contention-free Random Access Resources is met during the backoff time:

4\> perform the Random Access Resource selection procedure (see clause
5.1.2).

3\> else if the Random Access procedure for an SCell is performed on
uplink carrier where *pusch-Config* is not configured:

4\> delay the subsequent Random Access transmission until the Random
Access Procedure is triggered by a PDCCH order with the same
*ra-PreambleIndex*, *ra-ssb-OccasionMaskIndex*, and UL/SUL indicator TS
38.212 \[9\].

3\> else:

4\> perform the Random Access Resource selection procedure (see clause
5.1.2) after the backoff time.

The MAC entity may stop *ra-ResponseWindow* (and hence monitoring for
Random Access Response(s)) after successful reception of a Random Access
Response containing Random Access Preamble identifiers that matches the
transmitted *PREAMBLE\_INDEX*.

HARQ operation is not applicable to the Random Access Response
reception.

\[TS 38.214, clause 6.2.1\]

The UE may be configured with one or more Sounding Reference Signal
(SRS) resource sets as configured by the higher layer parameter
*SRS-ResourceSet* or *SRS-PosResourceSet*. For each SRS resource set
configured by *SRS-ResourceSet*, a UE may be configured with SRS
resources (higher layer parameter *SRS-Resource*), where the maximum
value of K is indicated by UE capability \[13, 38.306\]. When SRS
resource set is configured with the higher layer parameter
*SRS-PosResourceSet,* a UE may be configured with *K* â‰¥1 SRS resources
(higher layer parameter *SRS-PosResource*), where the maximum value of K
is 16. The SRS resource set applicability is configured by the higher
layer parameter *usage* in *SRS-ResourceSet.* When the higher layer
parameter *usage* is set to \'beamManagement\'*,* only one SRS resource
in each of multiple SRS resource sets may be transmitted at a given time
instant, but the SRS resources in different SRS resource sets with the
same time domain behaviour in the same BWP may be transmitted
simultaneously.

During non-active periods of cell DRX, the UE configured with cell DRX
is not expected to transmit the periodic SRS, or semi-persistent SRS for
channel acquisition. SRS for positioning is not impacted by cell DRX
operation.

For the SRS resource set(s) configured *in
srs-ResourceSetToAddModListDCI-0-2* with higher layer parameter *usage*
set to \'*antennaSwitching*\' or \'*beamManagement*\', the UE expects
the same SRS resource set(s) with the same *usage* being configured in
*srs-ResourceSetToAddModList.*

When the UE is configured *dl-OrJointTCI-StateList* or
*ul-TCI-StateList,* the UE can assume that SRS resource(s) in any SRS
resource set, except SRS resource set for positioning and an SRS
resource set configured with *followUnifiedTCI-StateSRS*, can be
configured with *TCI-State* or *TCI-UL-State* or updated as described in
clause 6.1.3.59 or 6.1.3.60 of \[10, TS 38.321\]. The reference RS in
the *TCI-State* can be a CSI-RS resource in a *NZP-CSI-RS-ResourceSet*
configured with higher layer parameter *repetition*, or a CSI-RS
resource in an *NZP-CSI-RS-ResourceSet* configured with higher layer
parameter *trs-Info*. The reference RS in the *TCI-UL-State(s)* can be a
CSI-RS resource in a *NZP-CSI-RS-ResourceSet* configured with higher
layer parameter *repetition*, a CSI-RS resource in an
*NZP-CSI-RS-ResourceSet* configured with higher layer parameter
*trs-Info*, an SRS resource with the higher layer parameter *usage* set
to \'beamManagement\', or SS/PBCH block associated with the same or
different PCI from the PCI of the serving cell.

If an SRS resource set, except an SRS resource set for positioning, is
configured with *followUnifiedTCI-StateSRS*, the UE shall transmit the
target SRS resource(s) within the SRS resource set according to the
spatial relation, if applicable, with a reference to the RS used for
determining UL TX spatial filter. The RS is determined based on an RS
configured with *qcl-Type* set to \'typeD\' in *QCL-Info* of the
indicated *TCI-State* or an RS in the indicated *TCI-UL-State*. The
reference RS in the indicated *TCI-State* can be a CSI-RS resource in a
*NZP-CSI-RS-ResourceSet* configured with higher layer parameter
*repetition*, or a CSI-RS resource in an *NZP-CSI-RS-ResourceSet*
configured with higher layer parameter *trs-Info.* The reference RS in
the indicated *TCI-UL-State* can be a CSI-RS resource in a
*NZP-CSI-RS-ResourceSet* configured with higher layer parameter
*repetition*, a CSI-RS resource in an *NZP-CSI-RS-ResourceSet*
configured with higher layer parameter *trs-Info,* an SRS resource with
the higher layer parameter *usage* set to \'beamManagement\', or SS/PBCH
block associated with the same or different PCI from the PCI of the
serving cell.

When the UE is configured *dl-OrJointTCI-StateList* or *TCI-UL-State*
and is having two indicated TCI-States or TCI-UL-States, and if the UE
is configured with \[\[*followUnifiedTCI-StateSRS\]\]* to*,* a periodic,
semi-persistent or aperiodic SRS resource set with higher layer
parameter *usage* in *SRS-ResourceSet* set to '*codebook*',
'*nonCodebook*' or '*antennaSwitching*' or to an aperiodic SRS resource
set with higher layer parameter *usage* in *SRS-ResourceSet* set to
'*beamManagement*'

\- The UE may be configured by higher layer parameter
*applyIndicatedTCIState* to the SRS resource set to indicate whether the
UE shall apply the first or the second indicated *TCI-State* or
*TCI-UL-State* to the SRS resource set.

\- When a UE is configured by higher layer parameter *PDCCH-Config* that
contains two different values of *coresetPoolIndex* in
*ControlResourceSet*, the first and second indicated *TCI-States* or
*TCI-UL-States* correspond to the indicated *TCI-States* or
*TCI-UL-States* specific to *coresetPoolIndex* value 0 and value 1,
respectively.

\- When a UE is configured by higher layer parameter *PDCCH-Config* that
contains two different values of *coresetPoolIndex* in
*ControlResourceSet*, and the aperiodic SRS resource set which is not
configured with higher layer parameter *applyIndicatedTCIState* and the
aperiodic SRS resource set is triggered by PDCCH on a CORESET associated
with a *coresetPoolIndex* value, the UE shall apply the indicated
*TCI-State* or *TCI-UL-State* specific to the *coresetPoolIndex* value
to the aperiodic SRS resource set.

\- When two SRS resource sets with higher layer parameter *usage* in
*SRS-ResourceSet* set to \'codebook\' or 'nonCodebook' are configured,
the UE does not expectthat the first indicated *TCI-State* or
*TCI-UL-State* is applied to the second SRS resource set and that the
second indicated *TCI-State* or *TCI-UL-State* is applied to the first
SRS resource set.

For aperiodic SRS at least one state of the DCI field is used to select
at least one out of the configured SRS resource set(s).

##### 7.1.1.1.19.3 Test description {#test-description-18 .H6}

##### 7.1.1.1.19.3.1 Pre-test conditions {#pre-test-conditions-18 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that set to return
no data in uplink.

##### 7.1.1.1.19.3.2 Test procedure sequence {#test-procedure-sequence-17 .H6}

Table 7.1.1.1.19.3.2-1 illustrates the downlink power levels and other
changing parameters to be applied for the cells at various time instants
of the test execution. Row marked \"T0\" denotes the initial conditions
after preamble, while columns marked \"T1\" is to be applied
subsequently. The exact instants on which these values shall be applied
are described in the texts in this clause.

Table 7.1.1.1.19.3.2-1: Time instances of cell power level and parameter
changes for FR2

+-------+-------+-------+-------+-------+-------+-------+-------+
|       | Para  | Unit  | E     | NR    | NR    | NR    | R     |
|       | meter |       | -UTRA | Cell  | Cell  | Cell  | emark |
|       |       |       | Cell  | 1     | 1     | 1     |       |
|       |       |       | 1     |       | Beam  |       |       |
|       |       |       |       |       | index | Beam  |       |
|       |       |       |       |       | \#1   | index |       |
|       |       |       |       |       |       | \#0   |       |
+=======+=======+=======+=======+=======+=======+=======+=======+
| T0    | Cel   | dBm/  | -96   | \-    | \-    | \-    | Be    |
|       | l-spe | 15kHz |       |       |       |       | am\#1 |
|       | cific |       |       |       |       |       | S     |
|       | RS    |       |       |       |       |       | witch |
|       | EPRE  |       |       |       |       |       | ON    |
|       |       |       |       |       |       |       | and   |
|       |       |       |       |       |       |       | Be    |
|       |       |       |       |       |       |       | am\#0 |
|       |       |       |       |       |       |       | S     |
|       |       |       |       |       |       |       | witch |
|       |       |       |       |       |       |       | OFF   |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | Refe  | dB    | \-    | -82   | \-    | \-    |       |
|       | rence | m/SCS |       |       |       |       |       |
|       | Power |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | C     | dB    | \-    | \-    | 0     | -63   |       |
|       | SI-RS |       |       |       |       |       |       |
|       | EPRE  |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SS    |       |       |       |       |       |       |
|       | /PBCH |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SSS   |       |       |       |       |       |       |
|       | EPRE  |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| T1    | Cel   | dBm/  | -96   | \-    | \-    | \-    | Be    |
|       | l-spe | 15kHz |       |       |       |       | am\#1 |
|       | cific |       |       |       |       |       | S     |
|       | RS    |       |       |       |       |       | witch |
|       | EPRE  |       |       |       |       |       | OFF   |
|       |       |       |       |       |       |       | and   |
|       |       |       |       |       |       |       | Be    |
|       |       |       |       |       |       |       | am\#0 |
|       |       |       |       |       |       |       | S     |
|       |       |       |       |       |       |       | witch |
|       |       |       |       |       |       |       | ON    |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | Refe  | dB    | \-    | -82   | \-    | \-    |       |
|       | rence | m/SCS |       |       |       |       |       |
|       | Power |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
|       | C     | dB    | \-    | \-    | -63   | 0     |       |
|       | SI-RS | m/SCS |       |       |       |       |       |
|       | EPRE  |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SS    |       |       |       |       |       |       |
|       | /PBCH |       |       |       |       |       |       |
|       |       |       |       |       |       |       |       |
|       | SSS   |       |       |       |       |       |       |
|       | EPRE  |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+
| NOTE: |       |       |       |       |       |       |       |
| \     |       |       |       |       |       |       |       |
| "Beam |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#1\" |       |       |       |       |       |       |       |
| r     |       |       |       |       |       |       |       |
| efers |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| tr    |       |       |       |       |       |       |       |
| ansmi |       |       |       |       |       |       |       |
| ssion |       |       |       |       |       |       |       |
| of    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| SS    |       |       |       |       |       |       |       |
| /PBCH |       |       |       |       |       |       |       |
| block |       |       |       |       |       |       |       |
| with  |       |       |       |       |       |       |       |
| SSB   |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#1   |       |       |       |       |       |       |       |
| (acco |       |       |       |       |       |       |       |
| rding |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| s     |       |       |       |       |       |       |       |
| sb-Po |       |       |       |       |       |       |       |
| sitio |       |       |       |       |       |       |       |
| nsInB |       |       |       |       |       |       |       |
| urst) |       |       |       |       |       |       |       |
| and   |       |       |       |       |       |       |       |
| C     |       |       |       |       |       |       |       |
| SI-RS |       |       |       |       |       |       |       |
| with  |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#1   |       |       |       |       |       |       |       |
| (acco |       |       |       |       |       |       |       |
| rding |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| CSI-  |       |       |       |       |       |       |       |
| MeasC |       |       |       |       |       |       |       |
| onfig |       |       |       |       |       |       |       |
| being |       |       |       |       |       |       |       |
| sign  |       |       |       |       |       |       |       |
| alled |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| UE at |       |       |       |       |       |       |       |
| step  |       |       |       |       |       |       |       |
| 1/8); |       |       |       |       |       |       |       |
| \     |       |       |       |       |       |       |       |
| "Beam |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#0\" |       |       |       |       |       |       |       |
| r     |       |       |       |       |       |       |       |
| efers |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| tr    |       |       |       |       |       |       |       |
| ansmi |       |       |       |       |       |       |       |
| ssion |       |       |       |       |       |       |       |
| of    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| SS    |       |       |       |       |       |       |       |
| /PBCH |       |       |       |       |       |       |       |
| block |       |       |       |       |       |       |       |
| with  |       |       |       |       |       |       |       |
| SSB   |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#0   |       |       |       |       |       |       |       |
| (acco |       |       |       |       |       |       |       |
| rding |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| s     |       |       |       |       |       |       |       |
| sb-Po |       |       |       |       |       |       |       |
| sitio |       |       |       |       |       |       |       |
| nsInB |       |       |       |       |       |       |       |
| urst) |       |       |       |       |       |       |       |
| and   |       |       |       |       |       |       |       |
| C     |       |       |       |       |       |       |       |
| SI-RS |       |       |       |       |       |       |       |
| with  |       |       |       |       |       |       |       |
| index |       |       |       |       |       |       |       |
| \#0   |       |       |       |       |       |       |       |
| (acco |       |       |       |       |       |       |       |
| rding |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| CSI-  |       |       |       |       |       |       |       |
| MeasC |       |       |       |       |       |       |       |
| onfig |       |       |       |       |       |       |       |
| being |       |       |       |       |       |       |       |
| sign  |       |       |       |       |       |       |       |
| alled |       |       |       |       |       |       |       |
| to    |       |       |       |       |       |       |       |
| the   |       |       |       |       |       |       |       |
| UE at |       |       |       |       |       |       |       |
| step  |       |       |       |       |       |       |       |
| 1/8). |       |       |       |       |       |       |       |
+-------+-------+-------+-------+-------+-------+-------+-------+

Table 7.1.1.1.19.3.2-2: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\--     | NR RRC:   | \-      | \- |
|           | transmits |           | RRCReconf |         |    |
|           | an NR     |           | iguration |         |    |
|           | *R        |           |           |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | establish |           |           |         |    |
|           | random    |           |           |         |    |
|           | access    |           |           |         |    |
|           | resources |           |           |         |    |
|           | for BFR   |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssociated |           |           |         |    |
|           | with SS   |           |           |         |    |
|           | blocks    |           |           |         |    |
|           | ex        |           |           |         |    |
|           | plicitly. |           |           |         |    |
|           | Note 1.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | UE        | \--\>     | NR RRC:   | \-      | \- |
|           | responses |           | RRCRecon  |         |    |
|           | NR        |           | figuratio |         |    |
|           | *         |           | nComplete |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message.  |           |           |         |    |
|           | Note 2.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \-        | \-        | \-      | \- |
|           | changes   |           |           |         |    |
|           | NR Cell 1 |           |           |         |    |
|           | power     |           |           |         |    |
|           | level     |           |           |         |    |
|           | according |           |           |         |    |
|           | to the    |           |           |         |    |
|           | row       |           |           |         |    |
|           | \"T1\" in |           |           |         |    |
|           | table     |           |           |         |    |
|           | 7.        |           |           |         |    |
|           | 1.1.1.19. |           |           |         |    |
|           | 3.2-1/1A. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | UE        | \--\>     | PRACH     | \-      | \- |
|           | transmit  |           | Preamble  |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH  |           |           |         |    |
|           | using a   |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | with      |           |           |         |    |
|           | PREAMB    |           |           |         |    |
|           | LE\_INDEX |           |           |         |    |
|           | to a      |           |           |         |    |
|           | ra-Prea   |           |           |         |    |
|           | mbleIndex |           |           |         |    |
|           | corr      |           |           |         |    |
|           | esponding |           |           |         |    |
|           | to the    |           |           |         |    |
|           | selected  |           |           |         |    |
|           | SS block  |           |           |         |    |
|           | provided  |           |           |         |    |
|           | by RRC on |           |           |         |    |
|           | NR Cell 1 |           |           |         |    |
|           | Beam      |           |           |         |    |
|           | index     |           |           |         |    |
|           | \#0.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | a MAC PDU |           | Response  |         |    |
|           | addressed |           |           |         |    |
|           | to UE     |           |           |         |    |
|           | C-RNTI,   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | multiple  |           |           |         |    |
|           | RAR's and |           |           |         |    |
|           | one of    |           |           |         |    |
|           | the MAC   |           |           |         |    |
|           | sub       |           |           |         |    |
|           | headers   |           |           |         |    |
|           | contains  |           |           |         |    |
|           | a         |           |           |         |    |
|           | matching  |           |           |         |    |
|           | RAPID on  |           |           |         |    |
|           | NR Cell   |           |           |         |    |
|           | 1.        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | UE        | \-        | \-        | \-      | \- |
|           | receives  |           |           |         |    |
|           | the first |           |           |         |    |
|           | PDCCH     |           |           |         |    |
|           | tra       |           |           |         |    |
|           | nsmission |           |           |         |    |
|           | on the    |           |           |         |    |
|           | search    |           |           |         |    |
|           | space     |           |           |         |    |
|           | indicated |           |           |         |    |
|           | by        |           |           |         |    |
|           | rec       |           |           |         |    |
|           | overySear |           |           |         |    |
|           | chSpaceId |           |           |         |    |
|           | of the    |           |           |         |    |
|           | SpCell    |           |           |         |    |
|           | i         |           |           |         |    |
|           | dentified |           |           |         |    |
|           | by the    |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | before    |           |           |         |    |
|           | ra-Respo  |           |           |         |    |
|           | nseWindow |           |           |         |    |
|           | expire.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | Check:    | \-        | \-        | 1       | P  |
|           | Does UE   |           |           |         |    |
|           | start to  |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | SRS that  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssociates |           |           |         |    |
|           | with the  |           |           |         |    |
|           | indicated |           |           |         |    |
|           | unified   |           |           |         |    |
|           | TCI       |           |           |         |    |
|           | state?    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | The SS    | \-        | \-        | \-      | \- |
|           | waits for |           |           |         |    |
|           | ra        |           |           |         |    |
|           | -Response |           |           |         |    |
|           | WindowBFR |           |           |         |    |
|           | expire.   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | UE not    | \-        | \-        | \-      | \- |
|           | r         |           |           |         |    |
|           | etransmit |           |           |         |    |
|           | a         |           |           |         |    |
|           | preamble  |           |           |         |    |
|           | on PRACH. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *R        |           |           |           |         |    |
| RCReconfi |           |           |           |         |    |
| guration* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RR       |           |           |           |         |    |
| CConnecti |           |           |           |         |    |
| onReconfi |           |           |           |         |    |
| guration* |           |           |           |         |    |
| 36.508    |           |           |           |         |    |
| \[7\],    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 4.6.1-8   |           |           |           |         |    |
| using     |           |           |           |         |    |
| condition |           |           |           |         |    |
| EN-DC\_   |           |           |           |         |    |
| EmbedNR\_ |           |           |           |         |    |
| RRCRecon. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| for EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| *         |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete* |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| *RR       |           |           |           |         |    |
| CConnecti |           |           |           |         |    |
| onReconfi |           |           |           |         |    |
| gurationC |           |           |           |         |    |
| omplete*. |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.1.19.3.3 Specific message contents {#specific-message-contents-18 .H6}

Table 7.1.1.1.19.3.3-1: *RRCReconfiguration* (Step 1, Table
7.1.1.1.19.3.2-2)

  ------------------------------------------------- ----------------- ------------------------------------------- -----------
  Derivation path: 38.508-1 \[4\], Table 4.6.1-13                                                                 
  Information Element                               Value/remark      Comment                                     Condition
  RRCReconfiguration::=SEQUENCE{                                                                                  
  criticalExtensions CHOICE{                                                                                      
  rrcReconfiguration SEQUENCE{                                                                                    
  secondaryCellGroup                                CellGroupConfig   OCTET STRING                                EN-DC
  nonCriticalExtension SEQUENCE {                                                                                 NR
  masterCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   
  }                                                                                                               
  }                                                                                                               
  }                                                                                                               
  }                                                                                                               
  ------------------------------------------------- ----------------- ------------------------------------------- -----------

Table 7.1.1.1.19.3.3-2: *CellGroupConfig* (Table 7.1.1.1.19.3.3-1)

  ---------------------------------------------------- ------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19                                 
  Information Element                                  Value/remark        Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                     
  spCellConfig SEQUENCE {                                                            
  spCellConfigDedicated                                ServingCellConfig             
  }                                                                                  
  }                                                                                  
  ---------------------------------------------------- ------------------- --------- -----------

Table 7.1.1.1.19.3.3-3: *ServingCellConfig* (Table 7.1.1.1.19.3.3-2)

  ----------------------------------------------------- ----------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                     
  Information Element                                   Value/remark            Comment   Condition
  ServingCellConfig ::= SEQUENCE {                                                        
  initialDownlinkBWP                                    BWP-DownlinkDedicated             
  uplinkConfig SEQUENCE {                                                                 
  initialUplinkBWP                                      BWP-UplinkDedicated               
  }                                                                                       
  }                                                                                       
  ----------------------------------------------------- ----------------------- --------- -----------

Table 7.1.1.1.19.3.3-4: *BWP-DownlinkDedicated* (Table 7.1.1.1.19.3.3-3)

  ---------------------------------------------------- --------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-11                                         
  Information Element                                  Value/remark                Comment   Condition
  BWP-DownlinkDedicated ::= SEQUENCE {                                                       
  pdcch-Config CHOICE {                                                                      Step 1
  setup                                                PDCCH-Config                          
  }                                                                                          
  pdsch-Config CHOICE {                                                                      
  setup                                                PDSCH-Config                          
  }                                                                                          
  radioLinkMonitoringConfig CHOICE {                                                         
  setup                                                RadioLinkMonitoringConfig             
  }                                                                                          
  }                                                                                          
  ---------------------------------------------------- --------------------------- --------- -----------

Table 7.1.1.1.19.3.3-5: RadioLinkMonitoringConfig (Table
7.1.1.1.19.3.3-4)

  ----------------------------------------------------------------------------------------------------------------------- -------------- -------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-133                                                                                                               
  Information Element                                                                                                     Value/remark   Comment                    Condition
  RadioLinkMonitoringConfig ::= SEQUENCE {                                                                                                                          
  failureDetectionResourcesToAddModList SEQUENCE (SIZE(1..maxNrofFailureDetectionResources)) OF RadioLinkMonitoringRS {   1 entry                                   
  RadioLinkMonitoringRS\[1\] SEQUENCE {                                                                                                                             
  radioLinkMonitoringRS-Id                                                                                                0                                         
  purpose                                                                                                                 both                                      
  detectionResource CHOICE {                                                                                                                                        
  csi-rs                                                                                                                  0              NR Cell 1 Beam index \#0   
  }                                                                                                                                                                 
  }                                                                                                                                                                 
  }                                                                                                                                                                 
  beamFailureInstanceMaxCount                                                                                             n1                                        
  beamFailureDetectionTimer                                                                                               pbfd1                                     
  }                                                                                                                                                                 
  ----------------------------------------------------------------------------------------------------------------------- -------------- -------------------------- -----------

Table 7.1.1.1.19.3.3-6: *PDSCH-Config* (Table 7.1.1.1.19.3.3-4)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-100                                        
  ----------------------------------------------------- -------------------------- --------- -----------
  Information Element                                   Value/remark               Comment   Condition
  PDSCH-Config ::= SEQUENCE {                                                                
  unifiedTCI-StateRef-r17                               ServingCellAndBWP-Id-r17             
  }                                                                                          

Table 7.1.1.1.19.3.3-7: ServingCellAndBWP-Id-r17 (Table
7.1.1.1.19.3.3-6)

  Derivation Path: TS 38.331 \[6\], clause 6.3.2                            
  ------------------------------------------------ -------------- --------- -----------
  Information Element                              Value/remark   Comment   Condition
  ServingCellAndBWP-Id-r17 ::= SEQUENCE {                                   
  servingcell-r17                                  Cell ID                  
  bwp-r17                                          BWP ID                   
  }                                                                         

Table 7.1.1.1.19.3.3-8: *PDCCH-Config* (Table 7.1.1.1.19.3.3-4)

  Derivation Path: TS 38.508-1 \[4\],Table 4.6.3-95                                                                                  
  --------------------------------------------------------------------------------------- -------------------------------- --------- -----------
  Information Element                                                                     Value/remark                     Comment   Condition
  PDCCH-Config::= SEQUENCE {                                                                                                         
  controlResourceSetToAddModList SEQUENCE(SEQUENCE(SIZE (1..3)) OF ControlResourceSet {   2 entries                                  
  ControlResourceSet\[1\]                                                                 ControlResourceSetid1            entry 1   
  ControlResourceSet\[2\]                                                                 ControlResourceSetid2            entry 2   
  }                                                                                                                                  
  searchSpacesToAddModList SEQUENCE(SIZE (1..10)) OF SearchSpace {                        2 entries                                  
  SearchSpace\[1\]                                                                        SearchSpace with condition USS   entry 1   
  SearchSpace\[2\]                                                                        SearchSpaceBFR                   entry 2   
  }                                                                                                                                  
  }                                                                                                                                  

Table 7.1.1.1.19.3.3-9: *ControlResourceSetId1* (Table 7.1.1.1.19.3.3-8)

+-------------------+--------------+----------------+-----------+
| Derivation Path:  |              |                |           |
| TS 38.508-1       |              |                |           |
| \[4\], Table      |              |                |           |
| 4.6.3-28          |              |                |           |
+-------------------+--------------+----------------+-----------+
| Information       | Value/remark | Comment        | Condition |
| Element           |              |                |           |
+-------------------+--------------+----------------+-----------+
| C                 |              |                |           |
| ontrolResourceSet |              |                |           |
| ::= SEQUENCE {    |              |                |           |
+-------------------+--------------+----------------+-----------+
| con               | 1            |                |           |
| trolResourceSetId |              |                |           |
+-------------------+--------------+----------------+-----------+
| tci-StatesPD      | 1 entry      |                | Step 1    |
| CCH-ToReleaseList |              |                |           |
| SEQUENCE (SIZE    |              |                |           |
| (1..maxNrof       |              |                |           |
| TCI-StatesPDCCH)) |              |                |           |
| OF TCI-StateId {  |              |                |           |
+-------------------+--------------+----------------+-----------+
| TCI-StateId\[1\]  | 2            | entry 1        |           |
|                   |              |                |           |
|                   |              | TCI-State Id 2 |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+

Table 7.1.1.1.19.3.3-10: *ControlResourceSetId2* (Table
7.1.1.1.19.3.3-8)

  ---------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-28                            
  Information Element                                  Value/remark   Comment   Condition
  ControlResourceSet ::= SEQUENCE {                                             
  controlResourceSetId                                 2                        
  }                                                                             
  ---------------------------------------------------- -------------- --------- -----------

Table 7.1.1.1.19.3.3-11: *SearchSpaceBFR* (Table 7.1.1.1.19.3.3-8)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-162                                  
  ----------------------------------------------------- -------------------- --------- -----------
  Information Element                                   Value/remark         Comment   Condition
  SearchSpace ::= SEQUENCE {                                                           
  searchSpaceId                                         4                              
  controlResourceSetId                                  2                              
  searchSpaceType CHOICE {                                                             
  ue-Specific SEQUENCE {                                                               
  dci-Formats                                           formats0-0-And-1-0             
  }                                                                                    
  }                                                                                    
  }                                                                                    

Table 7.1.1.1.19.3.3-12: *BWP-UplinkDedicated* (Table 7.1.1.1.19.3-3)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-15                                              
  ---------------------------------------------------- -------------------------------- --------- -----------
  Information Element                                  Value/remark                     Comment   Condition
  BWP-UplinkDedicated ::= SEQUENCE {                                                              
  pucch-Config CHOICE {                                                                           
  setup                                                PUCCH-Config                               
  }                                                                                               
  pusch-Config CHOICE {                                                                           
  setup                                                PUSCH-Config                               
  }                                                                                               
  srs-Config CHOICE {                                                                             
  setup                                                SRS-Config                                 
  }                                                                                               
  beamFailureRecoveryConfig                            BeamFailureRecoveryConfig\_SSB             
  }                                                                                               

Table 7.1.1.1.19.3.3-13: *SRS-Config* (Table 7.1.1.1.19.3-12)

  --------------------------------------------------------------------------------------------- -------------------------- --------------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-182                                                                                      
  **Information Element**                                                                       **Value/remark**           **Comment**     **Condition**
  SRS-Config ::= SEQUENCE {                                                                                                                
  srs-ResourceSetToAddModList SEQUENCE (SIZE(1..maxNrofSRS-ResourceSets)) OF SRS-ResourceSet{                                              
  SRS-ResourceSet\[1\] SEQUENCE {                                                                                          entry 1         
  followUnifiedTCI-StateSRS-r17                                                                 enabled                                    
  }                                                                                                                                        
  }                                                                                                                                        
  srs-ResourceToReleaseList                                                                     Not present                                
  srs-ResourceToAddModList SEQUENCE (SIZE(1..maxNrofSRS-Resources)) OF SRS-Resource {           1 entry                                    
  SRS-Resource\[1\] SEQUENCE {                                                                                             entry 1         
  resourceType CHOICE {                                                                                                                    
  periodic SEQUENCE {                                                                                                                      
  periodicityAndOffset-p                                                                        SRS-PeriodicityAndOffset                   
  }                                                                                                                                        
  }                                                                                                                                        
  sequenceId                                                                                    0                                          
  spatialRelationInfo SEQUENCE {                                                                SRS-SpatialRelationInfo                    
  servingCellId                                                                                 Not present                                
  referenceSignal CHOICE {                                                                                                                 
  ssb-Index                                                                                     0                          SSB index \#0   
  }                                                                                                                                        
  }                                                                                                                                        
  srs-TCI-State-r17 CHOICE {                                                                                                               
  srs-UL-TCI-State                                                                              INTEGER (0..63)                            
  }                                                                                                                                        
  }                                                                                                                                        
  tpc-Accumulation                                                                              Not present                                
  }                                                                                                                                        
  --------------------------------------------------------------------------------------------- -------------------------- --------------- ---------------

Table 7.1.1.1.19.3.3-14: *SRS-PeriodicityAndOffset* (Table
7.1.1.1.19.3.3-13)

  Derivation Path: TS 38.331 \[6\], clause 6.3.2                            
  ------------------------------------------------ -------------- --------- -----------
  Information Element                              Value/remark   Comment   Condition
  SRS-PeriodicityAndOffset ::= SEQUENCE {                                   
  slots320                                         41                       
  }                                                                         

Table 7.1.1.1.19.3.3-15: *BeamFailureRecoveryConfig\_SSB* (Table
7.1.1.1.19.3.3-12)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-6                                                                                                                              
  ----------------------------------------------------------------------------------------------------- -------------------- --------------------------------------------------- -----------
  Information Element                                                                                   Value/remark         Comment                                             Condition
  BeamFailureRecoveryConfig ::= SEQUENCE {                                                                                                                                       
  rootSequenceIndex-BFR                                                                                 0                    See TS 38.508-1 \[4\] clause 4.4.2, Table 4.4.2-2   
  rach-ConfigBFR                                                                                        RACH-ConfigGeneric   38.508-1 \[4\] Table 4.6.3-130                      
  rsrp-ThresholdSSB                                                                                     57(-99dBm)                                                               
  candidateBeamRSList SEQUENCE (SIZE(1..maxNrofCandidateBeams)) OF PRACH-ResourceDedicatedBFR CHOICE{                                                                            
  ssb SEQUENCE {                                                                                                                                                                 
  ssb                                                                                                   0                    NR Cell Beam\#0                                     
  ra-PreambleIndex                                                                                      56                   (0..63)                                             
  }                                                                                                                                                                              
  }                                                                                                                                                                              
  ssb-perRACH-Occasion                                                                                  one                                                                      
  ra-ssb-OccasionMaskIndex                                                                              0                                                                        
  recoverySearchSpaceID                                                                                 4                                                                        
  ra-Prioritization                                                                                     Not Present                                                              
  beamFailureRecoveryTimer                                                                              ms200                                                                    
  }                                                                                                                                                                              

Table 7.1.1.1.19.3.3-16: *PUCCH-Config* (Table 7.1.1.1.19.3.3-12)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-112                                                                                   
  ------------------------------------------------------------------------------------------------------------ -------------- --------- -----------
  Information Element                                                                                          Value/remark   Comment   Condition
  pucch-Config::= SEQUENCE {                                                                                                            
  pucch-PowerControl SEQUENCE {                                                                                                         
  pathlossReferenceRSs SEQUENCE (SIZE (1..maxNrofPUCCH-PathlossReferenceRSs)) OF PUCCH-PathlossReferenceRS {   1 entry                  
  PUCCH-PathlossReferenceRS\[1\] SEQUENCE {                                                                                   entry 1   
  referenceSignal CHOICE {                                                                                                              
  ssb-Index                                                                                                    0                        
  }                                                                                                                                     
  }                                                                                                                                     
  }                                                                                                                                     
  }                                                                                                                                     
  }                                                                                                                                     

Table 7.1.1.1.19.3.3-17: *PUSCH-Config* (Table 7.1.1.1.19.3.3-12)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-118                                                                                              
  ----------------------------------------------------------------------------------------------------------------------- -------------- --------- -----------
  Information Element                                                                                                     Value/remark   Comment   Condition
  pusch-Config::= SEQUENCE {                                                                                                                       
  pusch-PowerControl SEQUENCE {                                                                                                                    
  pathlossReferenceRSToAddModList SEQUENCE (SIZE (1..maxNrofPUSCH-PathlossReferenceRSs)) OF PUSCH-PathlossReferenceRS {   1 entry                  
  PUSCH-PathlossReferenceRS\[1\] SEQUENCE {                                                                                              entry 1   
  referenceSignal CHOICE{                                                                                                                          
  ssb-Index                                                                                                               0                        
  }                                                                                                                                                
  }                                                                                                                                                
  }                                                                                                                                                
  }                                                                                                                                                
  }                                                                                                                                                

#### 7.1.1.2 Downlink Data Transfer

##### 7.1.1.2.1 Correct Handling of DL MAC PDU / Assignment / HARQ process

##### 7.1.1.2.1.1 Test Purpose (TP) {#test-purpose-tp-19 .H6}

##### (1) {#section-58 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE receives downlink assignment on the PDCCH for the UE's
C-RNTI and receives data in the associated Slot and UE performs HARQ
operation }

**then** { UE sends a HARQ feedback on the HARQ process }

}

##### (2) {#section-59 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { SS transmits downlink assignment on the PDCCH with a C-RNTI
unknown by the UE and data is available in the associated Slot }

**then** { UE does not send any HARQ feedback on the HARQ process }

}

##### (3) {#section-60 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { the UE receives a MAC PDU addressed to its C-RNTI and decode
fails in the associated Slot }

**then** { the UE transmits a NACK for the corresponding HARQ process }

}

##### (4) {#section-61 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { the UE receives a MAC PDU retransmission addressed to its
C-RNTI, and results in successful decode in the associated Slot }

**then** { the UE transmits an ACK for the corresponding HARQ process
and forward to higher layer }

}

##### (5) {#section-62 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE receives a MAC PDU containing multiple MAC sub PDUs each
containing a MAC SDU that is larger than 256 bytes (16 bits L field
used) with padding MAC sub PDU at the end }

**then** { UE successfully decodes the MAC PDU and forward to higher
layer }

}

##### (6) {#section-63 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE receives a MAC PDU containing multiple MAC sub PDUs each
containing a MAC SDU that is smaller than 256 bytes (8 bits L field
used) with padding MAC sub PDU at the end }

**then** { UE successfully decodes the MAC PDU and forward to higher
layer }

}

##### (7) {#section-64 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE receives a MAC PDU containing MAC sub PDU containing a MAC
SDU and no padding MAC sub PDU }

**then** { UE successfully decodes the MAC PDU and forward to higher
layer }

}

##### (8) {#section-65 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE receives a MAC PDU containing MAC sub PDU containing a MAC
SDU that is smaller than 256 bytes (8 bits L field used) plus MAC sub
PDU containing a MAC SDU that is greater than 256 bytes (16 bits L field
used)and no padding }

**then** { UE successfully decodes the MAC PDU and forwards the AMD PDUs
to higher layer }

}

##### (9) {#section-66 .H6}

**with** { UE in RRC\_CONNECTED state and configured with a specific
*TDD-UL-DL-ConfigCommon* including configuration of *pattern2* }

**ensure that** {

**when** { UE receives downlink assignment on the PDCCH associated with
*pattern2* for the UE's C-RNTI and receives data in the associated Slot
and UE performs HARQ operation }

**then** { UE sends a HARQ feedback on the HARQ process }

}

##### 7.1.1.2.1.2 Conformance requirements {#conformance-requirements-19 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.321, clauses 5.3.1, 5.3.2.1, 5.3.2.2 and 6.1.2.
Unless otherwise stated these are Rel-15 requirements.

\[TS 38.321, clause 5.3.1\]

Downlink assignments received on the PDCCH both indicate that there is a
transmission on a DL-SCH for a particular MAC entity and provide the
relevant HARQ information.

When the MAC entity has a C-RNTI, Temporary C-RNTI, or CS-RNTI, the MAC
entity shall for each PDCCH occasion during which it monitors PDCCH and
for each Serving Cell:

1\> if a downlink assignment for this PDCCH occasion and this Serving
Cell has been received on the PDCCH for the MAC entity's C-RNTI, or
Temporary Câ€‘RNTI:

2\> if this is the first downlink assignment for this Temporary C-RNTI:

3\> consider the NDI to have been toggled.

2\> if the downlink assignment is for the MAC entity's C-RNTI, and if
the previous downlink assignment indicated to the HARQ entity of the
same HARQ process was either a downlink assignment received for the MAC
entity's CS-RNTI or a configured downlink assignment:

3\> consider the NDI to have been toggled regardless of the value of the
NDI.

2\> indicate the presence of a downlink assignment and deliver the
associated HARQ information to the HARQ entity.

1\> else if a downlink assignment for this PDCCH occasion has been
received for this Serving Cell on the PDCCH for the MAC entity's
CS-RNTI:

2\> if the NDI in the received HARQ information is 1:

3\> consider the NDI for the corresponding HARQ process not to have been
toggled;

3\> indicate the presence of a downlink assignment for this Serving Cell
and deliver the associated HARQ information to the HARQ entity.

2\> if the NDI in the received HARQ information is 0:

3\> if PDCCH contents indicate SPS deactivation:

4\> clear the configured downlink assignment for this Serving Cell (if
any);

4\> if the timeAlignmentTimer associated with the PTAG is running:

5\> indicate a positive acknowledgement for the SPS deactivation to the
physical layer.

3\> else if PDCCH content indicates SPS activation:

4\> store the downlink assignment for this Serving Cell and the
associated HARQ information as configured downlink assignment;

4\> initialise or re-initialise the configured downlink assignment for
this Serving Cell to start in the associated PDSCH duration and to recur
according to rules in subclause 5.8.1;

4\> set the HARQ Process ID to the HARQ Process ID associated with this
PDSCH duration;

4\> consider the NDI bit for the corresponding HARQ process to have been
toggled;

4\> indicate the presence of a configured downlink assignment for this
Serving Cell and deliver the stored HARQ information to the HARQ entity.

For each Serving Cell and each configured downlink assignment, if
configured and activated, the MAC entity shall:

1\> if the PDSCH duration of the configured downlink assignment does not
overlap with the PDSCH duration of a downlink assignment received on the
PDCCH for this Serving Cell:

2\> instruct the physical layer to receive, in this PDSCH duration,
transport block on the DL-SCH according to the configured downlink
assignment and to deliver it to the HARQ entity;

2\> set the HARQ Process ID to the HARQ Process ID associated with this
PDSCH duration;

2\> consider the NDI bit to have been toggled;

2\> indicate the presence of a configured downlink assignment and
deliver the stored HARQ information to the HARQ entity.

For configured downlink assignments, the HARQ Process ID associated with
the slot where the DL transmission starts is derived from the following
equation:

HARQ Process ID = \[floor (CURRENT\_slot Ã— 10 / (numberOfSlotsPerFrame Ã—
semiPersistSchedIntervalDL))\] modulo nrofHARQ-Processes

where CURRENT\_slot = \[(SFN Ã— *numberOfSlotsPerFrame*) + slot number in
the frame\] and *numberOfSlotsPerFrame* refers to the number of
consecutive slots per frame as specified in TS 38.211 \[8\].

When the MAC entity needs to read BCCH, the MAC entity may, based on the
scheduling information from RRC:

1\> if a downlink assignment for this PDCCH occasion has been received
on the PDCCH for the SI-RNTI;

2\> indicate a downlink assignment and redundancy version for the
dedicated broadcast HARQ process to the HARQ entity.

\[TS 38.321, clause 5.3.2.2\]

When a transmission takes place for the HARQ process, one or more (in
case of downlink spatial multiplexing) TBs and the associated HARQ
information are received from the HARQ entity.

For each received TB and associated HARQ information, the HARQ process
shall:

1\> if the NDI, when provided, has been toggled compared to the value of
the previous received transmission corresponding to this TB; or

1\> if the HARQ process is equal to the broadcast process, and this is
the first received transmission for the TB according to the system
information schedule indicated by RRC; or

1\> if this is the very first received transmission for this TB (i.e.
there is no previous NDI for this TB):

2\> consider this transmission to be a new transmission.

1\> else:

2\> consider this transmission to be a retransmission.

The MAC entity then shall:

1\> if this is a new transmission:

2\> attempt to decode the received data.

1\> else if this is a retransmission:

2\> if the data for this TB has not yet been successfully decoded:

3\> instruct the physical layer to combine the received data with the
data currently in the soft buffer for this TB and attempt to decode the
combined data.

1\> if the data which the MAC entity attempted to decode was
successfully decoded for this TB; or

1\> if the data for this TB was successfully decoded before:

2\> if the HARQ process is equal to the broadcast process:

3\> deliver the decoded MAC PDU to upper layers.

2\> else if this is the first successful decoding of the data for this
TB:

3\> deliver the decoded MAC PDU to the disassembly and demultiplexing
entity.

1\> else:

2\> instruct the physical layer to replace the data in the soft buffer
for this TB with the data which the MAC entity attempted to decode;

1\> if the HARQ process is associated with a transmission indicated with
a Temporary C-RNTI and the Contention Resolution is not yet successful
(see subclause 5.1.5); or

1\> if the HARQ process is equal to the broadcast process; or

1\> if the *timeAlignmentTimer*, associated with the TAG containing the
Serving Cell on which the HARQ feedback is to be transmitted, is stopped
or expired:

2\> not instruct the physical layer to generate acknowledgement(s) of
the data in this TB.

1\> else:

2\> instruct the physical layer to generate acknowledgement(s) of the
data in this TB.

The MAC entity shall ignore NDI received in all downlink assignments on
PDCCH for its Temporary C-RNTI when determining if NDI on PDCCH for its
C-RNTI has been toggled compared to the value in the previous
transmission.

\[TS 38.321, clause 6.1.2\]

A MAC PDU consists of one or more MAC subPDUs. Each MAC subPDU consists
of one of the following:

\- A MAC subheader only (including padding);

\- A MAC subheader and a MAC SDU;

\- A MAC subheader and a MAC CE;

\- A MAC subheader and padding.

The MAC SDUs are of variable sizes.

Each MAC subheader corresponds to either a MAC SDU, a MAC CE, or
padding.

A MAC subheader except for fixed sized MAC CE and padding consists of
the four header fields R/F/LCID/L. A MAC subheader for fixed sized MAC
CE and padding consists of the two header fields R/LCID.

![](./media/image11.emf)

Figure 6.1.2-1: R/F/LCID/L MAC subheader with 8-bit L field

![](./media/image12.emf)

Figure 6.1.2-2: R/F/LCID/L MAC subheader with 16-bit L field

![](./media/image13.emf)

Figure 6.1.2-3: R/LCID MAC subheader

MAC CEs are placed together. DL MAC subPDU(s) with MAC CE(s) is placed
before any MAC subPDU with MAC SDU and MAC subPDU with padding as
depicted in Figure 6.1.2-4. UL MAC subPDU(s) with MAC CE(s) is placed
after all the MAC subPDU(s) with MAC SDU and before the MAC subPDU with
padding in the MAC PDU as depicted in Figure 6.1.2-5. The size of
padding can be zero.

![](./media/image14.emf)

Figure 6.1.2-4: Example of a DL MAC PDU

![](./media/image15.emf)

Figure 6.1.2-5: Example of a UL MAC PDU

A maximum of one MAC PDU can be transmitted per TB per MAC entity.

##### 7.1.1.2.1.3 Test description {#test-description-19 .H6}

##### 7.1.1.2.1.3.1 Pre-test conditions {#pre-test-conditions-19 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that set to return
no data in uplink and parameters as in Table 7.1.1.2.1.3.1-1.

Table 7.1.1.2.1.3.1-1: MAC Parameters

  ---------------------------- -----
  nrofHARQ-ProcessesForPDSCH   n16
  ---------------------------- -----

##### 7.1.1.2.1.3.2 Test procedure sequence {#test-procedure-sequence-18 .H6}

Table 7.1.1.2.1.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | SS        | \<\--     | (PDCCH    | \-      | \- |
|           | transmits |           | (C-RNTI)) |         |    |
|           | a         |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | addressed |           |           |         |    |
|           | to the    |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | assigned  |           |           |         |    |
|           | to the UE |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | in the    |           |           |         |    |
|           | indicated |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | a RLC PDU |           |           |         |    |
|           | with poll |           |           |         |    |
|           | bit not   |           |           |         |    |
|           | set.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | Check:    | \--\>     | HARQ ACK  | 1       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | an HARQ   |           |           |         |    |
|           | ACK on    |           |           |         |    |
|           | PUCCH?    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | SS        | \<\--     | (PDCCH    | \-      | \- |
|           | transmits |           | (unknown  |         |    |
|           | a         |           | C-RNTI))  |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | to        |           |           |         |    |
|           | including |           |           |         |    |
|           | a C-RNTI  |           |           |         |    |
|           | different |           |           |         |    |
|           | from the  |           |           |         |    |
|           | assigned  |           |           |         |    |
|           | to the UE |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | in the    |           |           |         |    |
|           | indicated |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | a RLC PDU |           |           |         |    |
|           | in a MAC  |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | including |           |           |         |    |
|           | a RLC PDU |           |           |         |    |
|           | with poll |           |           |         |    |
|           | bit not   |           |           |         |    |
|           | set.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | Check:    | \--\>     | HARQ      | 2       | F  |
|           | Does the  |           | ACK/NACK  |         |    |
|           | UE send   |           |           |         |    |
|           | any HARQ  |           |           |         |    |
|           | ACK/NACK  |           |           |         |    |
|           | on PUCCH? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Steps 7   |           |           |         |    |
|           | to 10 are |           |           |         |    |
|           | run       |           |           |         |    |
|           | repeated  |           |           |         |    |
|           | using     |           |           |         |    |
|           | test      |           |           |         |    |
|           | parameter |           |           |         |    |
|           | values as |           |           |         |    |
|           | given for |           |           |         |    |
|           | each      |           |           |         |    |
|           | iteration |           |           |         |    |
|           | in table  |           |           |         |    |
|           | 7.1.1.2.  |           |           |         |    |
|           | 1.3.2.-2. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | indicates |           |           |         |    |
|           | a new     |           |           |         |    |
|           | tra       |           |           |         |    |
|           | nsmission |           |           |         |    |
|           | on PDCCH  |           |           |         |    |
|           | and       |           |           |         |    |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | a RLC PDU |           |           |         |    |
|           | with poll |           |           |         |    |
|           | bit not   |           |           |         |    |
|           | set, with |           |           |         |    |
|           | content   |           |           |         |    |
|           | set so    |           |           |         |    |
|           | that UE   |           |           |         |    |
|           | could not |           |           |         |    |
|           | suc       |           |           |         |    |
|           | cessfully |           |           |         |    |
|           | decode    |           |           |         |    |
|           | the data  |           |           |         |    |
|           | from its  |           |           |         |    |
|           | soft      |           |           |         |    |
|           | buffer.   |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | Check:    | \--\>     | HARQ NACK | 3       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a HARQ    |           |           |         |    |
|           | NACK?     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Step 9    |           |           |         |    |
|           | shall be  |           |           |         |    |
|           | repeated  |           |           |         |    |
|           | till HARQ |           |           |         |    |
|           | ACK is    |           |           |         |    |
|           | received  |           |           |         |    |
|           | at step   |           |           |         |    |
|           | 10 or     |           |           |         |    |
|           | until     |           |           |         |    |
|           | HARQ      |           |           |         |    |
|           | retra     |           |           |         |    |
|           | nsmission |           |           |         |    |
|           | count = 4 |           |           |         |    |
|           | is        |           |           |         |    |
|           | reached   |           |           |         |    |
|           | for MAC   |           |           |         |    |
|           | PDU at    |           |           |         |    |
|           | step 9    |           |           |         |    |
|           | (Note 2). |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | indicates |           |           |         |    |
|           | a         |           |           |         |    |
|           | retra     |           |           |         |    |
|           | nsmission |           |           |         |    |
|           | on PDCCH  |           |           |         |    |
|           | and       |           |           |         |    |
|           | transmits |           |           |         |    |
|           | the same  |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | like step |           |           |         |    |
|           | 7 (Note   |           |           |         |    |
|           | 1).       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | E         | \-        | \-        | \-      | \- |
|           | XCEPTION: |           |           |         |    |
|           | Up to     |           |           |         |    |
|           | \[3\]     |           |           |         |    |
|           | HARQ NACK |           |           |         |    |
|           | from the  |           |           |         |    |
|           | UE should |           |           |         |    |
|           | be        |           |           |         |    |
|           | allowed   |           |           |         |    |
|           | at step   |           |           |         |    |
|           | 10 (Note  |           |           |         |    |
|           | 2).       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | Check:    | \--\>     | HARQ ACK  | 4       | P  |
|           | Does the  |           |           |         |    |
|           | UE send a |           |           |         |    |
|           | HARQ ACK? |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | three MAC |           |           |         |    |
|           | sub PDUs  |           |           |         |    |
|           | each      |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a MAC     |           |           |         |    |
|           | SDU(RLC   |           |           |         |    |
|           | PDU) that |           |           |         |    |
|           | is of 260 |           |           |         |    |
|           | bytes (16 |           |           |         |    |
|           | bits L    |           |           |         |    |
|           | field     |           |           |         |    |
|           | used) and |           |           |         |    |
|           | a padding |           |           |         |    |
|           | MAC sub   |           |           |         |    |
|           | PDU at    |           |           |         |    |
|           | the end.  |           |           |         |    |
|           | The third |           |           |         |    |
|           | RLC PDU   |           |           |         |    |
|           | contained |           |           |         |    |
|           | will have |           |           |         |    |
|           | poll bit  |           |           |         |    |
|           | set.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | Check:    | \--\>     | MAC PDU   | 5       | P  |
|           | Does the  |           | (RLC      |         |    |
|           | UE        |           | STATUS    |         |    |
|           | transmit  |           | PDU )     |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of all    |           |           |         |    |
|           | the AMD   |           |           |         |    |
|           | PDUs in   |           |           |         |    |
|           | step 11?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 13        | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | three MAC |           |           |         |    |
|           | sub PDUs  |           |           |         |    |
|           | each      |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a MAC     |           |           |         |    |
|           | SDU(RLC   |           |           |         |    |
|           | PDU) that |           |           |         |    |
|           | is of 128 |           |           |         |    |
|           | bytes (8  |           |           |         |    |
|           | bits L    |           |           |         |    |
|           | field     |           |           |         |    |
|           | used) and |           |           |         |    |
|           | a padding |           |           |         |    |
|           | MAC sub   |           |           |         |    |
|           | PDU at    |           |           |         |    |
|           | the end.  |           |           |         |    |
|           | The third |           |           |         |    |
|           | RLC PDU   |           |           |         |    |
|           | contained |           |           |         |    |
|           | will have |           |           |         |    |
|           | poll bit  |           |           |         |    |
|           | set.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 14        | Check:    | \--\>     | MAC PDU   | 6       | P  |
|           | Does the  |           | (RLC      |         |    |
|           | UE        |           | STATUS    |         |    |
|           | transmit  |           | PDU )     |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of all    |           |           |         |    |
|           | the AMD   |           |           |         |    |
|           | PDUs in   |           |           |         |    |
|           | step 13?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 15        | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | one MAC   |           |           |         |    |
|           | sub PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a MAC     |           |           |         |    |
|           | SDU(RLC   |           |           |         |    |
|           | PDU) that |           |           |         |    |
|           | is of     |           |           |         |    |
|           | \[128\]   |           |           |         |    |
|           | bytes (8  |           |           |         |    |
|           | bits L    |           |           |         |    |
|           | field     |           |           |         |    |
|           | used) and |           |           |         |    |
|           | no        |           |           |         |    |
|           | padding   |           |           |         |    |
|           | MAC sub   |           |           |         |    |
|           | PDU at    |           |           |         |    |
|           | the end.  |           |           |         |    |
|           | The RLC   |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | contained |           |           |         |    |
|           | will have |           |           |         |    |
|           | poll bit  |           |           |         |    |
|           | set.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 16        | Check:    | \--\>     | MAC PDU   | 7       | P  |
|           | Does the  |           | (RLC      |         |    |
|           | UE        |           | STATUS    |         |    |
|           | transmit  |           | PDU )     |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of the    |           |           |         |    |
|           | AMD PDU   |           |           |         |    |
|           | in step   |           |           |         |    |
|           | 15?       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 17        | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | one MAC   |           |           |         |    |
|           | sub PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a MAC     |           |           |         |    |
|           | SDU(RLC   |           |           |         |    |
|           | PDU) that |           |           |         |    |
|           | is of     |           |           |         |    |
|           | \[128\]   |           |           |         |    |
|           | bytes (8  |           |           |         |    |
|           | bits L    |           |           |         |    |
|           | field     |           |           |         |    |
|           | used),    |           |           |         |    |
|           | one MAC   |           |           |         |    |
|           | sub PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | a MAC     |           |           |         |    |
|           | SDU(RLC   |           |           |         |    |
|           | PDU) that |           |           |         |    |
|           | is of     |           |           |         |    |
|           | \[260\]   |           |           |         |    |
|           | bytes (16 |           |           |         |    |
|           | bits L    |           |           |         |    |
|           | field     |           |           |         |    |
|           | used) and |           |           |         |    |
|           | no        |           |           |         |    |
|           | padding   |           |           |         |    |
|           | MAC sub   |           |           |         |    |
|           | PDU at    |           |           |         |    |
|           | the end.  |           |           |         |    |
|           | The       |           |           |         |    |
|           | second    |           |           |         |    |
|           | RLC PDU   |           |           |         |    |
|           | contained |           |           |         |    |
|           | will have |           |           |         |    |
|           | poll bit  |           |           |         |    |
|           | set.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 18        | Check:    | \--\>     | MAC PDU   | 8       | P  |
|           | Does the  |           | (RLC      |         |    |
|           | UE        |           | STATUS    |         |    |
|           | transmit  |           | PDU )     |         |    |
|           | a MAC PDU |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | STATUS    |           |           |         |    |
|           | PDU       |           |           |         |    |
|           | ackn      |           |           |         |    |
|           | owledging |           |           |         |    |
|           | the       |           |           |         |    |
|           | reception |           |           |         |    |
|           | of all    |           |           |         |    |
|           | the AMD   |           |           |         |    |
|           | PDUs in   |           |           |         |    |
|           | step 17?  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| \-        | EXCEPTION | \-        | *-*       | \-      | \- |
|           | : Steps   |           |           |         |    |
|           | 19a0 to   |           |           |         |    |
|           | 19a5 are  |           |           |         |    |
|           | executed  |           |           |         |    |
|           | for       |           |           |         |    |
|           | operation |           |           |         |    |
|           | on NR TDD |           |           |         |    |
|           | band only |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19a0      | The SS    | \-        | *-*       | \-      | \- |
|           | transmits |           |           |         |    |
|           | an        |           |           |         |    |
|           | updated   |           |           |         |    |
|           | system    |           |           |         |    |
|           | in        |           |           |         |    |
|           | formation |           |           |         |    |
|           | as        |           |           |         |    |
|           | specified |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.3.  |           |           |         |    |
|           | 1.3.3-14. |           |           |         |    |
|           | (Note 5)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19a1      | The SS    | \<\--     | *(RR      | \-      | \- |
|           | transmits |           | CReconfig |         |    |
|           | NR        |           | uration)* |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | message   |           |           |         |    |
|           | including |           |           |         |    |
|           | *TDD-U    |           |           |         |    |
|           | L-DL-Conf |           |           |         |    |
|           | igCommon* |           |           |         |    |
|           | with      |           |           |         |    |
|           | *pattern1 |           |           |         |    |
|           | and       |           |           |         |    |
|           | pattern2* |           |           |         |    |
|           | specified |           |           |         |    |
|           | in Table  |           |           |         |    |
|           | 7.1.1.    |           |           |         |    |
|           | 2.1.3.3-5 |           |           |         |    |
|           | (Note 3)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19a2      | The UE    | \--\>     | *(R       | \-      | \- |
|           | transmits |           | RCReconfi |         |    |
|           | a NR      |           | gurationC |         |    |
|           | *         |           | omplete)* |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message.  |           |           |         |    |
|           |           |           |           |         |    |
|           | (Note 4)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19a3      | SS        | \<\--     | (PDCCH    | \-      | \- |
|           | transmits |           | (C-RNTI)) |         |    |
|           | a         |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | addressed |           |           |         |    |
|           | to the    |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | assigned  |           |           |         |    |
|           | to the UE |           |           |         |    |
|           | i         |           |           |         |    |
|           | ndicating |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | reception |           |           |         |    |
|           | in a      |           |           |         |    |
|           | symbol in |           |           |         |    |
|           | a slot    |           |           |         |    |
|           | part of   |           |           |         |    |
|           | pattern2. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19a4      | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | in the    |           |           |         |    |
|           | indicated |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | a RLC PDU |           |           |         |    |
|           | with poll |           |           |         |    |
|           | bit not   |           |           |         |    |
|           | set.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 19a5      | Check:    | \--\>     | HARQ ACK  | 9       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | an HARQ   |           |           |         |    |
|           | ACK on    |           |           |         |    |
|           | PUCCH?    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| SS should |           |           |           |         |    |
| transmit  |           |           |           |         |    |
| this PDU  |           |           |           |         |    |
| so as to  |           |           |           |         |    |
| ensure at |           |           |           |         |    |
| least one |           |           |           |         |    |
| NACK.     |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| The value |           |           |           |         |    |
| 4 for the |           |           |           |         |    |
| maximum   |           |           |           |         |    |
| number of |           |           |           |         |    |
| HARQ      |           |           |           |         |    |
| retran    |           |           |           |         |    |
| smissions |           |           |           |         |    |
| has been  |           |           |           |         |    |
| chosen    |           |           |           |         |    |
| based on  |           |           |           |         |    |
| an        |           |           |           |         |    |
| a         |           |           |           |         |    |
| ssumption |           |           |           |         |    |
| that,     |           |           |           |         |    |
| given the |           |           |           |         |    |
| radio     |           |           |           |         |    |
| c         |           |           |           |         |    |
| onditions |           |           |           |         |    |
| used in   |           |           |           |         |    |
| this test |           |           |           |         |    |
| case, a   |           |           |           |         |    |
| UE soft   |           |           |           |         |    |
| combiner  |           |           |           |         |    |
| imple     |           |           |           |         |    |
| mentation |           |           |           |         |    |
| should    |           |           |           |         |    |
| have      |           |           |           |         |    |
| s         |           |           |           |         |    |
| ufficient |           |           |           |         |    |
| retran    |           |           |           |         |    |
| smissions |           |           |           |         |    |
| to be     |           |           |           |         |    |
| able to   |           |           |           |         |    |
| suc       |           |           |           |         |    |
| cessfully |           |           |           |         |    |
| decode    |           |           |           |         |    |
| the data  |           |           |           |         |    |
| in its    |           |           |           |         |    |
| soft      |           |           |           |         |    |
| buffer.   |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| 36.508    |           |           |           |         |    |
| \[7\],    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 4.6.1-8   |           |           |           |         |    |
| using     |           |           |           |         |    |
| condition |           |           |           |         |    |
| EN-DC\_   |           |           |           |         |    |
| EmbedNR\_ |           |           |           |         |    |
| RRCRecon. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 4:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 5:   |           |           |           |         |    |
| if        |           |           |           |         |    |
| pc\_NG    |           |           |           |         |    |
| \_RAN\_NR |           |           |           |         |    |
| only      |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

Table 7.1.1.2.1.3.2-2: Test Parameters

  ----------- ---------------------
  Iteration   DL HARQ process (X)
  K=1 to 16   X=K-1
  ----------- ---------------------

##### 7.1.1.2.1.3.3 Specific message contents {#specific-message-contents-19 .H6}

Table 7.1.1.2.1.3.3-1: *Void*

Table 7.1.1.2.1.3.3-2: *RRCReconfiguration* (step 19a1, Table
7.1.1.2.1.3.2-1)

  ---------------------------------------------------- ----------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                               
  Information Element                                  Value/remark      Comment   Condition
  RRCReconfiguration ::= SEQUENCE {                                                
  criticalExtensions CHOICE {                                                      
  rrcReconfiguration SEQUENCE {                                                    
  secondaryCellGroup                                   CellGroupConfig             EN-DC
  nonCriticalExtension SEQUENCE {                                                  NR
  masterCellGroup                                      CellGroupConfig             
  }                                                                                
  }                                                                                
  }                                                                                
  }                                                                                
  ---------------------------------------------------- ----------------- --------- -----------

Table 7.1.1.2.1.3.3-3: *CellGroupConfig (*Table 7.1.1.2.1.3.3-2)

  ---------------------------------------------------- ------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19                                       
  Information Element                                  Value/remark              Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                           
  spCellConfig SEQUENCE {                                                                  
  reconfigurationWithSync SEQUENCE {                                                       
  spCellConfigCommon                                   ServingCellConfigCommon             
  }                                                                                        
  spCellConfigDedicated                                ServingCellConfig                   
  }                                                                                        
  }                                                                                        
  ---------------------------------------------------- ------------------------- --------- -----------

Table 7.1.1.2.1.3.3-4: *ServingCellConfigCommon (*Tables 7.1.1.2.1.3.3-3
and 7.1.1.2.1.3.3-13)

  ----------------------------------------------------- ------------------------ --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                      
  Information Element                                   Value/remark             Comment   Condition
  ServingCellConfigCommon ::= SEQUENCE {                                                   
  uplinkConfigCommon SEQUENCE {                                                            
  initialUplinkBWP                                      BWP-UplinkCommon                   
  }                                                                                        
  tdd-UL-DL-ConfigurationCommon                         TDD-UL-DL-ConfigCommon             
  }                                                                                        
  ----------------------------------------------------- ------------------------ --------- -----------

Table 7.1.1.2.1.3.3-5: *TDD-UL-DL-ConfigCommon (*Table 7.1.1.2.1.3.3-4)

  ----------------------------------------------------- ------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-192                                 
  Information Element                                   Value/remark        Comment   Condition
  TDD-UL-DL-ConfigCommon ::= SEQUENCE {                                               
  referenceSubcarrierSpacing                            SubcarrierSpacing             
  pattern1 SEQUENCE {                                                                 
  dl-UL-TransmissionPeriodicity                         ms5                           FR1
                                                        ms0p625                       FR2
  nrofDownlinkSlots                                     3                             FR1
                                                        2                             FR2
  nrofDownlinkSymbols                                   6                             FR1
                                                        6                             FR2
  nrofUplinkSlots                                       2                             FR1
                                                        2                             FR2
  nrofUplinkSymbols                                     4                             FR1
                                                        2                             FR2
  dl-UL-TransmissionPeriodicity-v1530                   ms3                           FR1
  }                                                                                   
  pattern2 SEQUENCE {                                                                 
  dl-UL-TransmissionPeriodicity                         ms2                           FR1
                                                        ms0p625                       FR2
  nrofDownlinkSlots                                     4                             FR1
                                                        3                             FR2
  nrofDownlinkSymbols                                   0                             FR1
                                                        6                             FR2
  nrofUplinkSlots                                       0                             FR1
                                                        1                             FR2
  nrofUplinkSymbols                                     0                             FR1
                                                        2                             FR2
  }                                                                                   
  }                                                                                   
  ----------------------------------------------------- ------------------- --------- -----------

Table 7.1.1.2.1.3.3-6: *BWP-UplinkCommon (*Table 7.1.1.2.1.3.3-4)

  ---------------------------------------------------- ------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-14                                 
  Information Element                                  Value/remark        Comment   Condition
  BWP-UplinkCommon ::= SEQUENCE {                                                    
  rach-ConfigCommon CHOICE {                                                         
  setup                                                RACH-ConfigCommon             
  }                                                                                  
  }                                                                                  
  ---------------------------------------------------- ------------------- --------- -----------

Table 7.1.1.2.1.3.3-7: *RACH-ConfigCommon (*Table 7.1.1.2.1.3.3-6)

  ----------------------------------------------------- -------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-128                                  
  Information Element                                   Value/remark         Comment   Condition
  RACH-ConfigCommon ::= SEQUENCE {                                                     
  rach-ConfigGeneric                                    RACH-ConfigGeneric             
  }                                                                                    
  ----------------------------------------------------- -------------------- --------- -----------

Table 7.1.1.2.1.3.3-8: *RACH-ConfigGeneric (*Table 7.1.1.2.1.3.3-7)

  ----------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-130                            
  Information Element                                   Value/remark   Comment   Condition
  RACH-ConfigGeneric ::= SEQUENCE {                                              
  prach-configurationIndex                              156                      
  }                                                                              
  ----------------------------------------------------- -------------- --------- -----------

Table 7.1.1.2.1.3.3-9: ServingCellConfig (Table 7.1.1.2.1.3.3-3)

  ----------------------------------------------------- --------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-167                                   
  Information Element                                   Value/remark          Comment   Condition
  ServingCellConfig ::= SEQUENCE {                                                      
  uplinkConfig SEQUENCE {                                                               
  initialUplinkBWP                                      BWP-UplinkDedicated             
  }                                                                                     
  }                                                                                     
  ----------------------------------------------------- --------------------- --------- -----------

Table 7.1.1.2.1.3.3-10: *BWP-UplinkDedicated (*Table 7.1.1.2.1.3.3-9)

  ---------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-15                            
  Information Element                                  Value/remark   Comment   Condition
  BWP-UplinkDedicated ::= SEQUENCE {                                            
  pucch-Config CHOICE {                                                         
  setup                                                PUCCH-Config             
  }                                                                             
  }                                                                             
  ---------------------------------------------------- -------------- --------- -----------

Table 7.1.1.2.1.3.3-11: *PUCCH-Config (*Table 7.1.1.2.1.3.3-10)

  --------------------------------------------------------------------------------------------------------------------- --------------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-112                                                                                                               
  Information Element                                                                                                   Value/remark                      Comment   Condition
  PUCCH-Config ::= SEQUENCE {                                                                                                                                       
  schedulingRequestResourceToAddModList SEQUENCE (SIZE (1..maxNrofSR-Resources)) OF SchedulingRequestResourceConfig {   1 entry                                     
  SchedulingRequestResourceConfig\[1\]                                                                                  SchedulingRequestResourceConfig   entry 1   
  }                                                                                                                                                                 
  }                                                                                                                                                                 
  --------------------------------------------------------------------------------------------------------------------- --------------------------------- --------- -----------

Table 7.1.1.2.1.3.3-12: *SchedulingRequestResourceConfig (*Table
7.1.1.2.1.3.3-11)

  ----------------------------------------------------- ------------------ ----------------------------------------------------- ---------------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-112                                                                            
  **Information Element**                               **Value/remark**   **Comment**                                           **Condition**
  SchedulingRequestResourceConfig ::= SEQUENCE {                                                                                 
  periodicityAndOffset CHOICE {                                                                                                  
  sl10                                                  5                  With SCS = kHz15 results in repetition every 10 ms    SCS\_15kHz
  sl20                                                  5                  With SCS = kHz30 results in repetition every 10 ms    SCS\_30kHz
  sl80                                                  5                  With SCS = kHz120 results in repetition every 10 ms   SCS\_120kHz
  }                                                                                                                              
  }                                                                                                                              
  ----------------------------------------------------- ------------------ ----------------------------------------------------- ---------------

Table 7.1.1.2.1.3.3-13: *SIB1* (step 19a0, Table 7.1.1.2.1.3.2-1)

  --------------------------------------------------- ------------------------- ------------------------------------------- -----------
  Derivation path: TS 38.508-1 \[4\] table 4.6.1-28                                                                         
  Information Element                                 Value/Remark              Comment                                     Condition
  SIB1 ::= SEQUENCE {                                                                                                       
  servingCellConfigCommon                             ServingCellConfigCommon   Same contents as in Table 7.1.1.2.1.3.3-4   
  }                                                                                                                         
  --------------------------------------------------- ------------------------- ------------------------------------------- -----------

##### 7.1.1.2.2 Correct Handling of DL HARQ process PDSCH Aggregation

##### 7.1.1.2.2.1 Test Purpose (TP) {#test-purpose-tp-20 .H6}

##### (1) {#section-67 .H6}

**with** { UE in RRC\_CONNECTED state and pdsch-AggregationFactor \> 1 }

**ensure that** {

**when** { UE receives downlink assignment on the PDCCH for the UE's
C-RNTI and receives data in the associated slot and successive
pdsch-AggregationFactor -- 1 HARQ retransmissions within a bundle and UE
performs HARQ operation }

**then** { UE sends a HARQ feedback on the HARQ process }

}

##### 7.1.1.2.2.2 Conformance requirements {#conformance-requirements-20 .H6}

References: The conformance requirements covered in the current TC are
specified in: TS 38.321, clauses 5.3.1, 5.3.2.1 and 5.3.2.2, TS 38.214,
clause 5.1.2.1. Unless otherwise stated these are Rel-15 requirements.

\[TS 38.321, clause 5.3.1\]

Downlink assignments received on the PDCCH both indicate that there is a
transmission on a DL-SCH for a particular MAC entity and provide the
relevant HARQ information.

When the MAC entity has a C-RNTI, Temporary C-RNTI, or CS-RNTI, the MAC
entity shall for each PDCCH occasion during which it monitors PDCCH and
for each Serving Cell:

1\> if a downlink assignment for this PDCCH occasion and this Serving
Cell has been received on the PDCCH for the MAC entity\'s C-RNTI, or
Temporary Câ€‘RNTI:

2\> if this is the first downlink assignment for this Temporary C-RNTI:

3\> consider the NDI to have been toggled.

2\> if the downlink assignment is for the MAC entity\'s C-RNTI, and if
the previous downlink assignment indicated to the HARQ entity of the
same HARQ process was either a downlink assignment received for the MAC
entity\'s CS-RNTI or a configured downlink assignment:

3\> consider the NDI to have been toggled regardless of the value of the
NDI.

2\> indicate the presence of a downlink assignment and deliver the
associated HARQ information to the HARQ entity.

1\> else if a downlink assignment for this PDCCH occasion has been
received for this Serving Cell on the PDCCH for the MAC entity\'s
CS-RNTI:

2\> if the NDI in the received HARQ information is 1:

3\> consider the NDI for the corresponding HARQ process not to have been
toggled;

3\> indicate the presence of a downlink assignment for this Serving Cell
and deliver the associated HARQ information to the HARQ entity.

2\> if the NDI in the received HARQ information is 0:

3\> if PDCCH contents indicate SPS deactivation:

4\> clear the configured downlink assignment for this Serving Cell (if
any);

4\> if the timeAlignmentTimer associated with the PTAG is running:

5\> indicate a positive acknowledgement for the SPS deactivation to the
physical layer.

3\> else if PDCCH content indicates SPS activation:

4\> store the downlink assignment for this Serving Cell and the
associated HARQ information as configured downlink assignment;

4\> initialise or re-initialise the configured downlink assignment for
this Serving Cell to start in the associated PDSCH duration and to recur
according to rules in subclause 5.8.1;

4\> set the HARQ Process ID to the HARQ Process ID associated with this
PDSCH duration;

4\> consider the NDI bit for the corresponding HARQ process to have been
toggled;

4\> indicate the presence of a configured downlink assignment for this
Serving Cell and deliver the stored HARQ information to the HARQ entity.

For each Serving Cell and each configured downlink assignment, if
configured and activated, the MAC entity shall:

1\> if the PDSCH duration of the configured downlink assignment does not
overlap with the PDSCH duration of a downlink assignment received on the
PDCCH for this Serving Cell:

2\> instruct the physical layer to receive, in this PDSCH duration,
transport block on the DL-SCH according to the configured downlink
assignment and to deliver it to the HARQ entity;

2\> set the HARQ Process ID to the HARQ Process ID associated with this
PDSCH duration;

2\> consider the NDI bit to have been toggled;

2\> indicate the presence of a configured downlink assignment and
deliver the stored HARQ information to the HARQ entity.

For configured downlink assignments, the HARQ Process ID associated with
the slot where the DL transmission starts is derived from the following
equation:

HARQ Process ID = \[floor (CURRENT\_slot Ã— 10 / (*numberOfSlotsPerFrame*
Ã— *periodicity*))\] modulo *nrofHARQ-Processes*

where CURRENT\_slot = \[(SFN Ã— *numberOfSlotsPerFrame*) + slot number in
the frame\] and *numberOfSlotsPerFrame* refers to the number of
consecutive slots per frame as specified in TS 38.211 \[8\].

When the MAC entity needs to read BCCH, the MAC entity may, based on the
scheduling information from RRC:

1\> if a downlink assignment for this PDCCH occasion has been received
on the PDCCH for the SI-RNTI;

2\> indicate a downlink assignment and redundancy version for the
dedicated broadcast HARQ process to the HARQ entity.

\[TS 38.321, clause 5.3.2.1\]

The MAC entity includes a HARQ entity for each Serving Cell, which
maintains a number of parallel HARQ processes. Each HARQ process is
associated with a HARQ process identifier. The HARQ entity directs HARQ
information and associated TBs received on the DL-SCH to the
corresponding HARQ processes (see subclause 5.3.2.2).

The number of parallel DL HARQ processes per HARQ entity is specified in
TS 38.214 \[7\]. The dedicated broadcast HARQ process is used for BCCH.

The HARQ process supports one TB when the physical layer is not
configured for downlink spatial multiplexing. The HARQ process supports
one or two TBs when the physical layer is configured for downlink
spatial multiplexing.

When the MAC entity is configured with *pdsch-AggregationFactor* \> 1,
the parameter *pdsch-AggregationFactor* provides the number of
transmissions of a TB within a bundle of the dynamic downlink
assignment. Bundling operation relies on the HARQ entity for invoking
the same HARQ process for each transmission that is part of the same
bundle. After the initial transmission, *pdsch-AggregationFactor* -- 1
HARQ retransmissions follow within a bundle.

The MAC entity shall:

1\> if a downlink assignment has been indicated:

2\> allocate the TB(s) received from the physical layer and the
associated HARQ information to the HARQ process indicated by the
associated HARQ information.

1\> if a downlink assignment has been indicated for the broadcast HARQ
process:

2\> allocate the received TB to the broadcast HARQ process.

\[TS 38.321, clause 5.3.2.2\]

When a transmission takes place for the HARQ process, one or two (in
case of downlink spatial multiplexing) TBs and the associated HARQ
information are received from the HARQ entity.

For each received TB and associated HARQ information, the HARQ process
shall:

1\> if the NDI, when provided, has been toggled compared to the value of
the previous received transmission corresponding to this TB; or

1\> if the HARQ process is equal to the broadcast process, and this is
the first received transmission for the TB according to the system
information schedule indicated by RRC; or

1\> if this is the very first received transmission for this TB (i.e.
there is no previous NDI for this TB):

2\> consider this transmission to be a new transmission.

1\> else:

2\> consider this transmission to be a retransmission.

The MAC entity then shall:

1\> if this is a new transmission:

2\> attempt to decode the received data.

1\> else if this is a retransmission:

2\> if the data for this TB has not yet been successfully decoded:

3\> instruct the physical layer to combine the received data with the
data currently in the soft buffer for this TB and attempt to decode the
combined data.

1\> if the data which the MAC entity attempted to decode was
successfully decoded for this TB; or

1\> if the data for this TB was successfully decoded before:

2\> if the HARQ process is equal to the broadcast process:

3\> deliver the decoded MAC PDU to upper layers.

2\> else if this is the first successful decoding of the data for this
TB:

3\> deliver the decoded MAC PDU to the disassembly and demultiplexing
entity.

1\> else:

2\> instruct the physical layer to replace the data in the soft buffer
for this TB with the data which the MAC entity attempted to decode.

1\> if the HARQ process is associated with a transmission indicated with
a Temporary C-RNTI and the Contention Resolution is not yet successful
(see subclause 5.1.5); or

1\> if the HARQ process is equal to the broadcast process; or

1\> if the *timeAlignmentTimer*, associated with the TAG containing the
Serving Cell on which the HARQ feedback is to be transmitted, is stopped
or expired:

2\> not instruct the physical layer to generate acknowledgement(s) of
the data in this TB.

1\> else:

2\> instruct the physical layer to generate acknowledgement(s) of the
data in this TB.

The MAC entity shall ignore NDI received in all downlink assignments on
PDCCH for its Temporary C-RNTI when determining if NDI on PDCCH for its
C-RNTI has been toggled compared to the value in the previous
transmission.

\[TS 38.214, clause 5.1.2.1\]

When the UE is scheduled to receive PDSCH by a DCI, the *Time domain
resource assignment* field value *m* of the DCI provides a row index *m*
+ 1 to an allocation table. The determination of the used resource
allocation table is defined in sub-clause 5.1.2.1.1. The indexed row
defines the slot offset *K~0~*, the start and length indicator *SLIV*,
or directly the start symbol *S* and the allocation length *L*, and the
PDSCH mapping type to be assumed in the PDSCH reception.

Given the parameter values of the indexed row:

\- The slot allocated for the PDSCH is , where *n* is the slot with the
scheduling DCI, and *K~0~* is based on the numerology of PDSCH, and and
are the subcarrier spacing configurations for PDSCH and PDCCH,
respectively, and

\- The starting symbol *S* relative to the start of the slot, and the
number of consecutive symbols *L* counting from the symbol *S* allocated
for the PDSCH are determined from the start and length indicator *SLIV*:

if then

else

where, and

\- The PDSCH mapping type is set to Type A or Type B as defined in
sub-clause 7.4.1.1.2 of \[4, TS 38.211\].

The UE shall consider the *S* and *L* combinations defined in table
5.1.2.1-1 as valid PDSCH allocations:

Table 5.1.2.1-1: Valid *S* and *L* combinations

+---------+---------+---------+---------+---------+---------+---------+
| PDSCH   | Normal  | E       |         |         |         |         |
| mapping | cyclic  | xtended |         |         |         |         |
| type    | prefix  | cyclic  |         |         |         |         |
|         |         | prefix  |         |         |         |         |
+=========+=========+=========+=========+=========+=========+=========+
|         | *S*     | *L*     | *S+L*   | *S*     | *L*     | *S+L*   |
+---------+---------+---------+---------+---------+---------+---------+
| Type A  | {0      | {3,     | {3,     | {0      | {3,     | {3,     |
|         | ,1,2,3} | ...,14} | ...,14} | ,1,2,3} | ...,12} | ...,12} |
|         |         |         |         |         |         |         |
|         | (Note   |         |         | (Note   |         |         |
|         | 1)      |         |         | 1)      |         |         |
+---------+---------+---------+---------+---------+---------+---------+
| Type B  | {0,     | {2,4,7} | {2,     | {0,     | {2,4,6} | {2,     |
|         | ...,12} |         | ...,14} | ...,10} |         | ...,12} |
+---------+---------+---------+---------+---------+---------+---------+
| Note 1: |         |         |         |         |         |         |
| S = 3   |         |         |         |         |         |         |
| is      |         |         |         |         |         |         |
| app     |         |         |         |         |         |         |
| licable |         |         |         |         |         |         |
| only if |         |         |         |         |         |         |
| *dmrs-T |         |         |         |         |         |         |
| ypeA-Po |         |         |         |         |         |         |
| sition* |         |         |         |         |         |         |
| = 3     |         |         |         |         |         |         |
+---------+---------+---------+---------+---------+---------+---------+

When the UE is configured with *aggregationF*actorDL \> 1, the same
symbol allocation is applied across the *aggregationFactorDL*
consecutive slots. The UE may expect that the TB is repeated within each
symbol allocation among each of the *aggregationFactorDL* consecutive
slots and the PDSCH is limited to a single transmission layer. The
redundancy version to be applied on the *n*^th^ transmission occasion of
the TB is determined according to table 5.1.2.1-2.

Table 5.1.2.1-2: Applied redundancy version when *aggregationFactorDL*
\> 1

  *rv~id\ ~*indicated by the DCI scheduling the PDSCH   *rv~id~* to be applied to *n*^th^ transmission occasion                                   
  ----------------------------------------------------- --------------------------------------------------------- --------------- --------------- ---------------
                                                        *n* mod 4 = 0                                             *n* mod 4 = 1   *n* mod 4 = 2   *n* mod 4 = 3
  0                                                     0                                                         2               3               1
  2                                                     2                                                         3               1               0
  3                                                     3                                                         1               0               2
  1                                                     1                                                         0               2               3

If the UE procedure for determining slot configuration as defined in
Subclause 11.1 of \[6, TS 38.213\] determines symbol of a slot allocated
for PDSCH as uplink symbols, the transmission on that slot is omitted
for multi-slot PDSCH transmission.

The UE is not expected to receive a PDSCH with mapping type A in a slot,
if the PDCCH scheduling the PDSCH was received in the same slot and was
not contained within the first three symbols of the slot.

The UE is not expected to receive a PDSCH with mapping type B in a slot,
if the first symbol of the PDCCH scheduling the PDSCH was received in a
later symbol than the first symbol indicated in the PDSCH time domain
resource allocation.

##### 7.1.1.2.2.3 Test description {#test-description-20 .H6}

##### 7.1.1.2.2.3.1 Pre-test conditions {#pre-test-conditions-20 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that set to return
no data in uplink and parameters as in Table 7.1.1.2.2.3.1-1.

Table 7.1.1.2.2.3.1-1: Void

##### 7.1.1.2.2.3.2 Test procedure sequence {#test-procedure-sequence-19 .H6}

Table 7.1.1.2.2.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | SS        | \<\--     | (         | \-      | \- |
|           | transmits |           | RRCReconf |         |    |
|           | in the    |           | iguration |         |    |
|           | indicated |           | )         |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | an NR     |           |           |         |    |
|           | R         |           |           |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration. |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | UE        | \--\>     | (RRCRecon | \-      | \- |
|           | transmits |           | figuratio |         |    |
|           | NR        |           | nComplete |         |    |
|           | RRCRecon  |           | )         |         |    |
|           | figuratio |           |           |         |    |
|           | nComplete |           |           |         |    |
|           | message   |           |           |         |    |
|           | to the    |           |           |         |    |
|           | SS. (Note |           |           |         |    |
|           | 2)        |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | The SS    | \<\--     | \-        | \-      | \- |
|           | transmits |           |           |         |    |
|           | a         |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | addressed |           |           |         |    |
|           | to the    |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | assigned  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | UE, the   |           |           |         |    |
|           | rv\_idx   |           |           |         |    |
|           | is 0.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | in the    |           |           |         |    |
|           | indicated |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | a RLC PDU |           |           |         |    |
|           | with poll |           |           |         |    |
|           | bit not   |           |           |         |    |
|           | set, The  |           |           |         |    |
|           | CRC is    |           |           |         |    |
|           | c         |           |           |         |    |
|           | alculated |           |           |         |    |
|           | in such a |           |           |         |    |
|           | way, it   |           |           |         |    |
|           | will      |           |           |         |    |
|           | result in |           |           |         |    |
|           | CRC error |           |           |         |    |
|           | on UE     |           |           |         |    |
|           | side.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | In the    | \<\--     | MAC PDU   | \-      | \- |
|           | following |           |           |         |    |
|           | 3         |           |           |         |    |
|           | co        |           |           |         |    |
|           | nsecutive |           |           |         |    |
|           | slots,    |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | on the    |           |           |         |    |
|           | same      |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | the same  |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | as in     |           |           |         |    |
|           | stepÂ 4,   |           |           |         |    |
|           | The CRC   |           |           |         |    |
|           | is        |           |           |         |    |
|           | c         |           |           |         |    |
|           | alculated |           |           |         |    |
|           | in such a |           |           |         |    |
|           | way, it   |           |           |         |    |
|           | will      |           |           |         |    |
|           | result in |           |           |         |    |
|           | CRC error |           |           |         |    |
|           | on UE     |           |           |         |    |
|           | side.     |           |           |         |    |
|           | (Note3)   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5A        | Void      | \-        | \-        | \-      | \- |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | Check:    | \--\>     | HARQ NACK | 1       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a HARQ    |           |           |         |    |
|           | NACK on   |           |           |         |    |
|           | slot      |           |           |         |    |
|           | n3+k1?    |           |           |         |    |
|           | (Note 4)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The SS    | \<\--     | \-        | \-      | \- |
|           | transmits |           |           |         |    |
|           | a         |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | addressed |           |           |         |    |
|           | to the    |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | assigned  |           |           |         |    |
|           | to the    |           |           |         |    |
|           | UE, the   |           |           |         |    |
|           | rv\_idx   |           |           |         |    |
|           | is 0.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | in the    |           |           |         |    |
|           | indicated |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | a RLC PDU |           |           |         |    |
|           | with poll |           |           |         |    |
|           | bit not   |           |           |         |    |
|           | set, The  |           |           |         |    |
|           | CRC is    |           |           |         |    |
|           | c         |           |           |         |    |
|           | alculated |           |           |         |    |
|           | in such a |           |           |         |    |
|           | way, it   |           |           |         |    |
|           | will      |           |           |         |    |
|           | result in |           |           |         |    |
|           | CRC pass  |           |           |         |    |
|           | on UE     |           |           |         |    |
|           | side.     |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | In the    | \<\--     | MAC PDU   | \-      | \- |
|           | following |           |           |         |    |
|           | 3         |           |           |         |    |
|           | co        |           |           |         |    |
|           | nsecutive |           |           |         |    |
|           | slots,    |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | on the    |           |           |         |    |
|           | same      |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | the same  |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | as in     |           |           |         |    |
|           | stepÂ 8,   |           |           |         |    |
|           | The CRC   |           |           |         |    |
|           | is        |           |           |         |    |
|           | c         |           |           |         |    |
|           | alculated |           |           |         |    |
|           | in such a |           |           |         |    |
|           | way, it   |           |           |         |    |
|           | will      |           |           |         |    |
|           | result in |           |           |         |    |
|           | CRC pass  |           |           |         |    |
|           | on UE     |           |           |         |    |
|           | side.     |           |           |         |    |
|           | (Note3)   |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | Check:    | \--\>     | HARQ ACK  | 1       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a HARQ    |           |           |         |    |
|           | ACK on    |           |           |         |    |
|           | slot      |           |           |         |    |
|           | n3+k1?    |           |           |         |    |
|           | (Note 4)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| 36.508    |           |           |           |         |    |
| \[7\],    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 4.6.1-8   |           |           |           |         |    |
| using     |           |           |           |         |    |
| condition |           |           |           |         |    |
| EN-DC\_   |           |           |           |         |    |
| EmbedNR\_ |           |           |           |         |    |
| RRCRecon. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| For       |           |           |           |         |    |
| *aggre    |           |           |           |         |    |
| gationF*a |           |           |           |         |    |
| ctorDL=4, |           |           |           |         |    |
| the PDSCH |           |           |           |         |    |
| will      |           |           |           |         |    |
| repeat in |           |           |           |         |    |
| following |           |           |           |         |    |
| 4-1=3     |           |           |           |         |    |
| slots     |           |           |           |         |    |
| with same |           |           |           |         |    |
| resource  |           |           |           |         |    |
| a         |           |           |           |         |    |
| llocation |           |           |           |         |    |
| but       |           |           |           |         |    |
| different |           |           |           |         |    |
| r         |           |           |           |         |    |
| edundancy |           |           |           |         |    |
| version,  |           |           |           |         |    |
| if the    |           |           |           |         |    |
| slot can  |           |           |           |         |    |
| be used   |           |           |           |         |    |
| for       |           |           |           |         |    |
| downlink  |           |           |           |         |    |
| tran      |           |           |           |         |    |
| smission. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 4:   |           |           |           |         |    |
| n0 is the |           |           |           |         |    |
| index of  |           |           |           |         |    |
| slot when |           |           |           |         |    |
| 1^st^     |           |           |           |         |    |
| tra       |           |           |           |         |    |
| nsmission |           |           |           |         |    |
| of MAC    |           |           |           |         |    |
| PDU in    |           |           |           |         |    |
| step 4/8  |           |           |           |         |    |
| happens,  |           |           |           |         |    |
| n1, n2,   |           |           |           |         |    |
| n3 are    |           |           |           |         |    |
| indices   |           |           |           |         |    |
| of slots  |           |           |           |         |    |
| when      |           |           |           |         |    |
| 2^nd^,    |           |           |           |         |    |
| 3^rd^,    |           |           |           |         |    |
| 4^th^     |           |           |           |         |    |
| tra       |           |           |           |         |    |
| nsmission |           |           |           |         |    |
| of MAC    |           |           |           |         |    |
| PDU in    |           |           |           |         |    |
| step 5/9  |           |           |           |         |    |
| may       |           |           |           |         |    |
| happen,   |           |           |           |         |    |
| k1 is     |           |           |           |         |    |
| obtained  |           |           |           |         |    |
| from      |           |           |           |         |    |
| \"PDSCH   |           |           |           |         |    |
| -to-HARQ\ |           |           |           |         |    |
| _feedback |           |           |           |         |    |
| timing    |           |           |           |         |    |
| in        |           |           |           |         |    |
| dicator\" |           |           |           |         |    |
| of        |           |           |           |         |    |
| downlink  |           |           |           |         |    |
| a         |           |           |           |         |    |
| ssignment |           |           |           |         |    |
| in step   |           |           |           |         |    |
| 3/7.      |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.2.2.3.3 Specific message contents {#specific-message-contents-20 .H6}

Table 7.1.1.2.2.3.3-1: RRCReconfiguration (step 1, Table
7.1.1.2.2.3.2-1)

  ---------------------------------------------------- ----------------- ------------------------------------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13                                                                 
  Information Element                                  Value/remark      Comment                                     Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                  
  criticalExtensions CHOICE {                                                                                        
  rrcReconfiguration SEQUENCE {                                                                                      
  secondaryCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   EN-DC
  nonCriticalExtension SEQUENCE {                                                                                    NR
  masterCellGroup                                      CellGroupConfig                                               
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  }                                                                                                                  
  ---------------------------------------------------- ----------------- ------------------------------------------- -----------

Table 7.1.1.2.2.3.3-2: CellGroupConfig (Table 7.1.1.2.2.3.3-1)

  ---------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19                            
  Information Element                                  Value/remark   Comment   Condition
  cellGroupConfig ::= SEQUENCE {                                                
  cellGroupId                                          0                        
                                                       1                        EN-DC
  spCellConfig SEQUENCE {                                                       
  spCellConfigDedicated SEQUENCE {                                              
  servingCellConfig SEQUENCE {                                                  
  initialDownlinkBWP SEQUENCE {                                                 
  pdsch-Config SEQUENCE {                                                       
  pdsch-AggregationFactor                              n4                       
  }                                                                             
  }                                                                             
  }                                                                             
  }                                                                             
  }                                                                             
  }                                                                             
  ---------------------------------------------------- -------------- --------- -----------

Table 7.1.1.2.2.3.3-3: Physical layer parameters for DCI format 1\_1
*(Steps 3, 7*, Table 7.1.1.2.2.3.2-1*)*

  --------------------------------------------------------- ------------------------------------------------------------------------------------------ ----------------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.3.6.1.2.2-1                                                                                                                
  Parameter                                                 Value                                                                                      Value in binary   Condition
  PDSCH-to-HARQ\_feedback timing indicator                  Corresponding to K1=5 slots as per dl-DataToUL-ACK in Table 4.6.3-112 TS 38.508-1 \[4\].   "011"B            
  --------------------------------------------------------- ------------------------------------------------------------------------------------------ ----------------- -----------

##### 7.1.1.2.3 Correct HARQ process handling / CCCH

##### 7.1.1.2.3.1 Test Purpose (TP) {#test-purpose-tp-21 .H6}

##### (1) {#section-68 .H6}

**with** { UE in RRC\_IDLE state with RRC connection establishment
procedure initiated }

**ensure that** {

**when** { UE receives a MAC PDU addressed to RA-RNTI }

**then** { UE does not transmit the HARQ feedback for the corresponding
HARQ process }

}

##### (2) {#section-69 .H6}

**with** { UE in RRC\_IDLE state with RRC connection establishment
procedure initiated }

**ensure that** {

**when** { UE receives a MAC PDU addressed to T-CRNTI without UE
Contention Resolution Identity corresponding the transmitted
RRCSetupRequest message }

**then** { UE does not transmit the HARQ feedback for the corresponding
HARQ process }

}

##### (3) {#section-70 .H6}

**with** { UE in RRC\_IDLE state with RRC connection establishment
procedure initiated }

**ensure that** {

**when** { UE receives a MAC PDU addressed to T-CRNTI and cannot decode
properly }

**then** { UE does not transmit the HARQ feedback for the corresponding
HARQ process }

}

##### (4) {#section-71 .H6}

**with** { UE in RRC\_IDLE state with RRC connection establishment
procedure initiated }

**ensure that** {

**when** { UE receives a MAC PDU addressed to T-CRNTI with UE Contention
Resolution Identity corresponding the transmitted RRCSetupRequest
message }

**then** { UE transmits the HARQ ACK for the corresponding HARQ process
}

}

##### 7.1.1.2.3.2 Conformance requirements {#conformance-requirements-21 .H6}

References: The conformance requirements covered in the current TC are
specified in: TS 38.321, clauses 5.3.2.1 and 5.3.2.2.

\[TS 38.321, clause 5.3.2.1\]

The MAC entity includes a HARQ entity for each Serving Cell, which
maintains a number of parallel HARQ processes. Each HARQ process is
associated with a HARQ process identifier. The HARQ entity directs HARQ
information and associated TBs received on the DL-SCH to the
corresponding HARQ processes (see subclause 5.3.2.2).

The number of parallel DL HARQ processes per HARQ entity is specified in
TS 38.214 \[7\]. The dedicated broadcast HARQ process is used for BCCH.

The HARQ process supports one TB when the physical layer is not
configured for downlink spatial multiplexing. The HARQ process supports
one or two TBs when the physical layer is configured for downlink
spatial multiplexing.

When the MAC entity is configured with *pdsch-AggregationFactor* \> 1,
the parameter *pdsch-AggregationFactor* provides the number of
transmissions of a TB within a bundle of the dynamic downlink
assignment. Bundling operation relies on the HARQ entity for invoking
the same HARQ process for each transmission that is part of the same
bundle. After the initial transmission, *pdsch-AggregationFactor* -- 1
HARQ retransmissions follow within a bundle.

The MAC entity shall:

1\> if a downlink assignment has been indicated:

2\> allocate the TB(s) received from the physical layer and the
associated HARQ information to the HARQ process indicated by the
associated HARQ information.

1\> if a downlink assignment has been indicated for the broadcast HARQ
process:

2\> allocate the received TB to the broadcast HARQ process.

\[TS 38.321, clause 5.3.2.2\]

When a transmission takes place for the HARQ process, one or two (in
case of downlink spatial multiplexing) TBs and the associated HARQ
information are received from the HARQ entity.

For each received TB and associated HARQ information, the HARQ process
shall:

1\> if the NDI, when provided, has been toggled compared to the value of
the previous received transmission corresponding to this TB; or

1\> if the HARQ process is equal to the broadcast process, and this is
the first received transmission for the TB according to the system
information schedule indicated by RRC; or

1\> if this is the very first received transmission for this TB (i.e.
there is no previous NDI for this TB):

2\> consider this transmission to be a new transmission.

1\> else:

2\> consider this transmission to be a retransmission.

The MAC entity then shall:

1\> if this is a new transmission:

2\> attempt to decode the received data.

1\> else if this is a retransmission:

2\> if the data for this TB has not yet been successfully decoded:

3\> instruct the physical layer to combine the received data with the
data currently in the soft buffer for this TB and attempt to decode the
combined data.

1\> if the data which the MAC entity attempted to decode was
successfully decoded for this TB; or

1\> if the data for this TB was successfully decoded before:

2\> if the HARQ process is equal to the broadcast process:

3\> deliver the decoded MAC PDU to upper layers.

2\> else if this is the first successful decoding of the data for this
TB:

3\> deliver the decoded MAC PDU to the disassembly and demultiplexing
entity.

1\> else:

2\> instruct the physical layer to replace the data in the soft buffer
for this TB with the data which the MAC entity attempted to decode.

1\> if the HARQ process is associated with a transmission indicated with
a Temporary C-RNTI and the Contention Resolution is not yet successful
(see subclause 5.1.5); or

1\> if the HARQ process is equal to the broadcast process; or

1\> if the *timeAlignmentTimer*, associated with the TAG containing the
Serving Cell on which the HARQ feedback is to be transmitted, is stopped
or expired:

2\> not instruct the physical layer to generate acknowledgement(s) of
the data in this TB.

1\> else:

2\> instruct the physical layer to generate acknowledgement(s) of the
data in this TB.

The MAC entity shall ignore NDI received in all downlink assignments on
PDCCH for its Temporary C-RNTI when determining if NDI on PDCCH for its
C-RNTI has been toggled compared to the value in the previous
transmission.

NOTE: If the MAC entity receives a retransmission with a TB size
different from the last TB size signalled for this TB, the UE behavior
is left up to UE implementation.

##### 7.1.1.2.3.3 Test description {#test-description-21 .H6}

##### 7.1.1.2.3.3.1 Pre-test conditions {#pre-test-conditions-21 .H6}

##### System Simulator: {#system-simulator-6 .H6}

> \- NR Cell 1.

##### UE: {#ue-6 .H6}

> \- None

##### Preamble: {#preamble-6 .H6}

\- The UE is in 1N-A state on NR Cell 1 using generic procedure
parameter Connectivity (*NR*) according to TS 38.508-1 \[4\].

##### 7.1.1.2.3.3.2 Test procedure sequence {#test-procedure-sequence-20 .H6}

Table 7.1.1.2.3.3.2-1: Main behaviour

  St      Procedure                                                                                                                                                                                                                                                        Message Sequence   TP                       Verdict   
  ------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------------ ------------------------ --------- ----
                                                                                                                                                                                                                                                                           U - S              Message                            
  1       The SS transmits a Paging message including a matched identity.                                                                                                                                                                                                  \<\--              \-                       \-        \-
  2       The UE transmits Preamble on PRACH.                                                                                                                                                                                                                              \--\>              PRACH Preamble           \-        \-
  3       The SS transmits Random Access Response with matching RA-RNTI and including Temporary C-RNTI. The CRC is calculated in such a way, it will result in CRC error on UE side.                                                                                       \<\--              Random Access Response   \-        \-
  4       Check: does the UE transmit a HARQ ACK/NACK?                                                                                                                                                                                                                     \--\>              HARQ ACK/NACK            1         F
  5       The UE transmits Preamble on PRACH.                                                                                                                                                                                                                              \--\>              PRACH Preamble           \-        \-
  6       The SS transmits Random Access Response with matching RA-RNTI and including Temporary C-RNTI. The CRC is calculated in such a way, it will result in CRC pass on UE side.                                                                                        \<\--              Random Access Response   \-        \-
  7       Check: does the UE transmit a HARQ ACK/NACK?                                                                                                                                                                                                                     \--\>              HARQ ACK/NACK            1         F
  8       The UE transmits a MAC PDU containing an *RRCSetupRequest* message.                                                                                                                                                                                              \--\>              MAC PDU                  \-        \-
  9       The SS transmits a valid MAC PDU containing *RRCSetup*, and including 'UE Contention Resolution Identity' MAC control element with not matching 'Contention Resolution Identity'.                                                                                \<\--              MAC PDU                  \-        \-
  10      Check: does the UE transmit a HARQ ACK/NACK?                                                                                                                                                                                                                     \--\>              HARQ ACK/NACK            2         F
  11      The UE transmits Preamble on PRACH.                                                                                                                                                                                                                              \--\>              PRACH Preamble           \-        \-
  12      The SS transmits Random Access Response with matching RA-RNTI and including Temporary C-RNTI.                                                                                                                                                                    \<\--              Random Access Response   \-        \-
  13      The UE transmits a MAC PDU containing an *RRCSetupRequest* message.                                                                                                                                                                                              \--\>              MAC PDU                  \-        \-
  14      The SS transmits a valid MAC PDU containing *RRCSetup*, and including 'UE Contention Resolution Identity' MAC control element with matching 'Contention Resolution Identity'. The CRC is calculated in such a way that it will result in CRC error on UE side.   \<\--              MAC PDU                  \-        \-
  15      Check: Does UE transmit a HARQ ACK/NACK?                                                                                                                                                                                                                         \--\>              HARQ ACK/NACK            3         F
  16      The UE transmits Preamble on PRACH.                                                                                                                                                                                                                              \--\>              PRACH Preamble           \-        \-
  17      The SS transmits Random Access Response with matching RA-RNTI and including Temporary C-RNTI.                                                                                                                                                                    \<\--              Random Access Response   \-        \-
  18      The UE transmits a MAC PDU containing an *RRCSetupRequest* message.                                                                                                                                                                                              \--\>              MAC PDU                  \-        \-
  19      The SS transmits a valid MAC PDU containing *RRCSetup*, and including 'UE Contention Resolution Identity' MAC control element with matching 'Contention Resolution Identity'. The CRC is calculated in such a way that it will result in CRC pass on UE side.    \<\--              MAC PDU                  \-        \-
  20      Check: does the UE transmit a HARQ ACK?                                                                                                                                                                                                                          \--\>              HARQ ACK                 4         P
  21      The UE transmits a MAC PDU containing an *RRCSetupComplete* message including SERVICE REQUEST message indicating acceptance of *RRCSetup* message                                                                                                                \--\>              MAC PDU                  \-        \-
  22-25   Steps 5 to 8 of the generic radio bearer establishment procedure (TS 38.508 table 4.5.4.2-3) are executed to successfully complete the service request procedure.                                                                                                \-                 \-                       \-        \-

##### 7.1.1.2.3.3.3 Specific message contents {#specific-message-contents-21 .H6}

None.

##### 7.1.1.2.4 Correct HARQ process handling / BCCH

##### 7.1.1.2.4.1 Test Purpose (TP) {#test-purpose-tp-22 .H6}

##### (1) {#section-72 .H6}

**with** { UE in RRC\_CONNECTED state }

**ensure that** {

**when** { UE receives a MAC PDU addressed to SI-RNTI on the broadcast
HARQ process }

**then** { UE does not transmit the HARQ feedback for the broadcast HARQ
process }

}

##### 7.1.1.2.4.2 Conformance requirements {#conformance-requirements-22 .H6}

References: The conformance requirements covered in the current TC are
specified in: TS 38.321, clauses 5.3.2.1 and 5.3.2.2. Unless otherwise
stated these are Rel-15 requirements.

\[TS 38.321, clause 5.3.2.1\]

The MAC entity includes a HARQ entity for each Serving Cell, which
maintains a number of parallel HARQ processes. Each HARQ process is
associated with a HARQ process identifier. The HARQ entity directs HARQ
information and associated TBs received on the DL-SCH to the
corresponding HARQ processes (see subclause 5.3.2.2).

The number of parallel DL HARQ processes per HARQ entity is specified in
TS 38.214 \[7\]. The dedicated broadcast HARQ process is used for BCCH.

The HARQ process supports one TB when the physical layer is not
configured for downlink spatial multiplexing. The HARQ process supports
one or two TBs when the physical layer is configured for downlink
spatial multiplexing.

When the MAC entity is configured with *pdsch-AggregationFactor* \> 1,
the parameter *pdsch-AggregationFactor* provides the number of
transmissions of a TB within a bundle of the dynamic downlink
assignment. Bundling operation relies on the HARQ entity for invoking
the same HARQ process for each transmission that is part of the same
bundle. After the initial transmission, *pdsch-AggregationFactor* -- 1
HARQ retransmissions follow within a bundle.

The MAC entity shall:

1\> if a downlink assignment has been indicated:

2\> allocate the TB(s) received from the physical layer and the
associated HARQ information to the HARQ process indicated by the
associated HARQ information.

1\> if a downlink assignment has been indicated for the broadcast HARQ
process:

2\> allocate the received TB to the broadcast HARQ process.

\[TS 38.321, clause 5.3.2.2\]

When a transmission takes place for the HARQ process, one or two (in
case of downlink spatial multiplexing) TBs and the associated HARQ
information are received from the HARQ entity.

For each received TB and associated HARQ information, the HARQ process
shall:

1\> if the NDI, when provided, has been toggled compared to the value of
the previous received transmission corresponding to this TB; or

1\> if the HARQ process is equal to the broadcast process, and this is
the first received transmission for the TB according to the system
information schedule indicated by RRC; or

1\> if this is the very first received transmission for this TB (i.e.
there is no previous NDI for this TB):

2\> consider this transmission to be a new transmission.

1\> else:

2\> consider this transmission to be a retransmission.

The MAC entity then shall:

1\> if this is a new transmission:

2\> attempt to decode the received data.

1\> else if this is a retransmission:

2\> if the data for this TB has not yet been successfully decoded:

3\> instruct the physical layer to combine the received data with the
data currently in the soft buffer for this TB and attempt to decode the
combined data.

1\> if the data which the MAC entity attempted to decode was
successfully decoded for this TB; or

1\> if the data for this TB was successfully decoded before:

2\> if the HARQ process is equal to the broadcast process:

3\> deliver the decoded MAC PDU to upper layers.

2\> else if this is the first successful decoding of the data for this
TB:

3\> deliver the decoded MAC PDU to the disassembly and demultiplexing
entity.

1\> else:

2\> instruct the physical layer to replace the data in the soft buffer
for this TB with the data which the MAC entity attempted to decode.

1\> if the HARQ process is associated with a transmission indicated with
a Temporary C-RNTI and the Contention Resolution is not yet successful
(see subclause 5.1.5); or

1\> if the HARQ process is equal to the broadcast process; or

1\> if the *timeAlignmentTimer*, associated with the TAG containing the
Serving Cell on which the HARQ feedback is to be transmitted, is stopped
or expired:

2\> not instruct the physical layer to generate acknowledgement(s) of
the data in this TB.

1\> else:

2\> instruct the physical layer to generate acknowledgement(s) of the
data in this TB.

The MAC entity shall ignore NDI received in all downlink assignments on
PDCCH for its Temporary C-RNTI when determining if NDI on PDCCH for its
C-RNTI has been toggled compared to the value in the previous
transmission.

NOTE: If the MAC entity receives a retransmission with a TB size
different from the last TB size signalled for this TB, the UE behaviour
is left up to UE implementation.

##### 7.1.1.2.4.3 Test description {#test-description-22 .H6}

##### 7.1.1.2.4.3.1 Pre-test conditions {#pre-test-conditions-22 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that Short\_DCI
condition is applied in NR Serving cell configuration.

##### 7.1.1.2.4.3.2 Test procedure sequence {#test-procedure-sequence-21 .H6}

Table 7.1.1.2.4.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | The SS    | \<\--     | PDCCH     | \-      | \- |
|           | transmits |           | (DCI      |         |    |
|           | a Short   |           | 1\_0):    |         |    |
|           | message   |           | Short     |         |    |
|           | on PDCCH  |           | Message   |         |    |
|           | using     |           |           |         |    |
|           | P-RNTI    |           |           |         |    |
|           | i         |           |           |         |    |
|           | ndicating |           |           |         |    |
|           | a         |           |           |         |    |
|           | syste     |           |           |         |    |
|           | mInfoModi |           |           |         |    |
|           | fication. |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | At the    | \<\--     | \-        | \-      | \- |
|           | start of  |           |           |         |    |
|           | the       |           |           |         |    |
|           | mod       |           |           |         |    |
|           | ification |           |           |         |    |
|           | period,   |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | an        |           |           |         |    |
|           | updated   |           |           |         |    |
|           | system    |           |           |         |    |
|           | in        |           |           |         |    |
|           | formation |           |           |         |    |
|           | with      |           |           |         |    |
|           | SI-RNTI   |           |           |         |    |
|           | addressed |           |           |         |    |
|           | in L1/L2  |           |           |         |    |
|           | header.   |           |           |         |    |
|           | CRC is    |           |           |         |    |
|           | c         |           |           |         |    |
|           | alculated |           |           |         |    |
|           | in such a |           |           |         |    |
|           | way, it   |           |           |         |    |
|           | will      |           |           |         |    |
|           | result in |           |           |         |    |
|           | CRC fail  |           |           |         |    |
|           | on UE     |           |           |         |    |
|           | side.     |           |           |         |    |
|           | Dedicated |           |           |         |    |
|           | HARQ      |           |           |         |    |
|           | process   |           |           |         |    |
|           | for       |           |           |         |    |
|           | broadcast |           |           |         |    |
|           | is used.  |           |           |         |    |
|           | (Note 5)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | Check:    | \--\>     | HARQ      | 1       | F  |
|           | Does the  |           | ACK/NACK  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a HARQ    |           |           |         |    |
|           | ACK/NACK? |           |           |         |    |
|           | (Note 2   |           |           |         |    |
|           | and 3)    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | After     | \<\--     | \-        | \-      | \- |
|           | 400ms of  |           |           |         |    |
|           | step 2,   |           |           |         |    |
|           | the SS    |           |           |         |    |
|           | transmits |           |           |         |    |
|           | an        |           |           |         |    |
|           | updated   |           |           |         |    |
|           | system    |           |           |         |    |
|           | in        |           |           |         |    |
|           | formation |           |           |         |    |
|           | contents  |           |           |         |    |
|           | same as   |           |           |         |    |
|           | in step 2 |           |           |         |    |
|           | with      |           |           |         |    |
|           | SI-RNTI   |           |           |         |    |
|           | addressed |           |           |         |    |
|           | in L1/L2  |           |           |         |    |
|           | header.   |           |           |         |    |
|           | CRC is    |           |           |         |    |
|           | c         |           |           |         |    |
|           | alculated |           |           |         |    |
|           | in such a |           |           |         |    |
|           | way, it   |           |           |         |    |
|           | will      |           |           |         |    |
|           | result in |           |           |         |    |
|           | CRC pass  |           |           |         |    |
|           | on UE     |           |           |         |    |
|           | side.     |           |           |         |    |
|           | Dedicated |           |           |         |    |
|           | HARQ      |           |           |         |    |
|           | process   |           |           |         |    |
|           | for       |           |           |         |    |
|           | broadcast |           |           |         |    |
|           | is used.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Check:    | -\>       | HARQ      | 1       | F  |
|           | Does the  |           | ACK/NACK  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | a HARQ    |           |           |         |    |
|           | ACK/NACK? |           |           |         |    |
|           | (Note 2   |           |           |         |    |
|           | and 4)    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | After 100 | \-        | \-        | \-      | \- |
|           | ms of     |           |           |         |    |
|           | Step 4,   |           |           |         |    |
|           | SS is     |           |           |         |    |
|           | c         |           |           |         |    |
|           | onfigured |           |           |         |    |
|           | to not    |           |           |         |    |
|           | allocate  |           |           |         |    |
|           | UL Grants |           |           |         |    |
|           | on        |           |           |         |    |
|           | S         |           |           |         |    |
|           | cheduling |           |           |         |    |
|           | Request.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | The SS    | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | MAC PDU   |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | PDU.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 8         | The UE    | \--\>     | HARQ ACK  | \-      | \- |
|           | transmits |           |           |         |    |
|           | a HARQ    |           |           |         |    |
|           | ACK.      |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 9         | Check:    | \--\>     | PRACH     | 1       | P  |
|           | Does the  |           | Preamble  |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | PRACH     |           |           |         |    |
|           | Preamble, |           |           |         |    |
|           | using     |           |           |         |    |
|           | PRACH     |           |           |         |    |
|           | resources |           |           |         |    |
|           | as in new |           |           |         |    |
|           | SI?       |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 10        | The SS    | \<\--     | Random    | \-      | \- |
|           | transmits |           | Access    |         |    |
|           | Random    |           | Response  |         |    |
|           | Access    |           |           |         |    |
|           | Response  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 11        | The UE    | \--\>     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | with      |           |           |         |    |
|           | C-RNTI    |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontaining |           |           |         |    |
|           | loop      |           |           |         |    |
|           | backed    |           |           |         |    |
|           | RLC PDU.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 12        | SS sends  | \<\--     | \-        | \-      | \- |
|           | PDCCH     |           |           |         |    |
|           | tra       |           |           |         |    |
|           | nsmission |           |           |         |    |
|           | for UE    |           |           |         |    |
|           | C-RNTI to |           |           |         |    |
|           | complete  |           |           |         |    |
|           | c         |           |           |         |    |
|           | ontention |           |           |         |    |
|           | re        |           |           |         |    |
|           | solution. |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| The Short |           |           |           |         |    |
| Message   |           |           |           |         |    |
| was       |           |           |           |         |    |
| tr        |           |           |           |         |    |
| ansmitted |           |           |           |         |    |
| in        |           |           |           |         |    |
| cont      |           |           |           |         |    |
| rolResour |           |           |           |         |    |
| ceSetZero |           |           |           |         |    |
| as        |           |           |           |         |    |
| C         |           |           |           |         |    |
| onfigured |           |           |           |         |    |
| in SIB1,  |           |           |           |         |    |
| need to   |           |           |           |         |    |
| guarantee |           |           |           |         |    |
| that the  |           |           |           |         |    |
| UE will   |           |           |           |         |    |
| receive   |           |           |           |         |    |
| at least  |           |           |           |         |    |
| one       |           |           |           |         |    |
| Paging in |           |           |           |         |    |
| the       |           |           |           |         |    |
| Mod       |           |           |           |         |    |
| ification |           |           |           |         |    |
| Period    |           |           |           |         |    |
| preceding |           |           |           |         |    |
| the       |           |           |           |         |    |
| SysInfo   |           |           |           |         |    |
| change,   |           |           |           |         |    |
| SS should |           |           |           |         |    |
| send the  |           |           |           |         |    |
| Paging    |           |           |           |         |    |
| message   |           |           |           |         |    |
| in every  |           |           |           |         |    |
| eligible  |           |           |           |         |    |
| PO in     |           |           |           |         |    |
| this      |           |           |           |         |    |
| Mod       |           |           |           |         |    |
| ification |           |           |           |         |    |
| Period.   |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| When      |           |           |           |         |    |
| requested |           |           |           |         |    |
| to check  |           |           |           |         |    |
| HARQ      |           |           |           |         |    |
| feedback  |           |           |           |         |    |
| for the   |           |           |           |         |    |
| dedicated |           |           |           |         |    |
| broadcast |           |           |           |         |    |
| HARQ      |           |           |           |         |    |
| process,  |           |           |           |         |    |
| the SS    |           |           |           |         |    |
| sha       |           |           |           |         |    |
| llÂ assume |           |           |           |         |    |
| the same  |           |           |           |         |    |
| PUCCH     |           |           |           |         |    |
| reception |           |           |           |         |    |
| re        |           |           |           |         |    |
| quirement |           |           |           |         |    |
| as        |           |           |           |         |    |
| specified |           |           |           |         |    |
| in TS     |           |           |           |         |    |
| 38.213    |           |           |           |         |    |
| section 9 |           |           |           |         |    |
| for a     |           |           |           |         |    |
| normal    |           |           |           |         |    |
| HARQ      |           |           |           |         |    |
| process.  |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 3:   |           |           |           |         |    |
| For       |           |           |           |         |    |
| duration  |           |           |           |         |    |
| of 400ms, |           |           |           |         |    |
| the SS    |           |           |           |         |    |
| shall     |           |           |           |         |    |
| check     |           |           |           |         |    |
| HARQ      |           |           |           |         |    |
| ACK/NACK  |           |           |           |         |    |
| for all   |           |           |           |         |    |
| broadcast |           |           |           |         |    |
| SIBs.     |           |           |           |         |    |
| This      |           |           |           |         |    |
| duration  |           |           |           |         |    |
| is        |           |           |           |         |    |
| s         |           |           |           |         |    |
| ufficient |           |           |           |         |    |
| to ensure |           |           |           |         |    |
| that SS   |           |           |           |         |    |
| transmits |           |           |           |         |    |
| few times |           |           |           |         |    |
| SIBs with |           |           |           |         |    |
| CRC       |           |           |           |         |    |
| co        |           |           |           |         |    |
| rruption. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 4:   |           |           |           |         |    |
| For       |           |           |           |         |    |
| duration  |           |           |           |         |    |
| of 100    |           |           |           |         |    |
| ms, The   |           |           |           |         |    |
| SS shall  |           |           |           |         |    |
| check for |           |           |           |         |    |
| HARQ      |           |           |           |         |    |
| ACK/NACK  |           |           |           |         |    |
| for all   |           |           |           |         |    |
| broadcast |           |           |           |         |    |
| SIBs.     |           |           |           |         |    |
| This      |           |           |           |         |    |
| duration  |           |           |           |         |    |
| is        |           |           |           |         |    |
| s         |           |           |           |         |    |
| ufficient |           |           |           |         |    |
| to ensure |           |           |           |         |    |
| that SS   |           |           |           |         |    |
| transmits |           |           |           |         |    |
| few times |           |           |           |         |    |
| SIBs      |           |           |           |         |    |
| after CRC |           |           |           |         |    |
| c         |           |           |           |         |    |
| orruption |           |           |           |         |    |
| is        |           |           |           |         |    |
| removed.  |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 5:   |           |           |           |         |    |
| The       |           |           |           |         |    |
| mod       |           |           |           |         |    |
| ification |           |           |           |         |    |
| period    |           |           |           |         |    |
| b         |           |           |           |         |    |
| oundaries |           |           |           |         |    |
| are       |           |           |           |         |    |
| defined   |           |           |           |         |    |
| by SFN    |           |           |           |         |    |
| values    |           |           |           |         |    |
| for which |           |           |           |         |    |
| SFN mod m |           |           |           |         |    |
| = 0,      |           |           |           |         |    |
| where m   |           |           |           |         |    |
| is the    |           |           |           |         |    |
| number of |           |           |           |         |    |
| radio     |           |           |           |         |    |
| frames    |           |           |           |         |    |
| c         |           |           |           |         |    |
| omprising |           |           |           |         |    |
| the       |           |           |           |         |    |
| mod       |           |           |           |         |    |
| ification |           |           |           |         |    |
| period.   |           |           |           |         |    |
| Value of  |           |           |           |         |    |
| m is      |           |           |           |         |    |
| c         |           |           |           |         |    |
| aluclated |           |           |           |         |    |
| based on  |           |           |           |         |    |
| the       |           |           |           |         |    |
| p         |           |           |           |         |    |
| arameters |           |           |           |         |    |
| specified |           |           |           |         |    |
| in TS     |           |           |           |         |    |
| 38.508-1  |           |           |           |         |    |
| \[4\] i.e |           |           |           |         |    |
| m =       |           |           |           |         |    |
| (*        |           |           |           |         |    |
| modificat |           |           |           |         |    |
| ionPeriod |           |           |           |         |    |
| Coeff=4)* |           |           |           |         |    |
| \*        |           |           |           |         |    |
| (*defau   |           |           |           |         |    |
| ltPagingC |           |           |           |         |    |
| ycle=128* |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.2.4.3.3 Specific message contents {#specific-message-contents-22 .H6}

Table 7.1.1.2.4.3.3-1: *SIB1* (steps 2 and 4 of table 7.1.1.2.4.3.2-1)

  Derivation path: TS 38.508-1 \[4\] table 4.6.1-28                            
  --------------------------------------------------- -------------- --------- -----------
  Information Element                                 Value/Remark   Comment   Condition
  SIB1 ::= SEQUENCE {                                                          
  servingCellConfigCommon SEQUENCE {                                           
  uplinkConfigCommon SEQUENCE {                                                
  initialUplinkBWP SEQUENCE {                                                  
  rach-ConfigCommon SEQUENCE {                                                 
  prach-RootSequenceIndex CHOICE {                                             
  l139                                                20                       FDD
  l139                                                2                        TDD
  }                                                                            
  }                                                                            
  }                                                                            
  }                                                                            
  }                                                                            
  }                                                                            

##### 7.1.1.2.5 Correct HARQ process handling / DL grant prioritization

##### 7.1.1.2.5.1 Test Purpose (TP) {#test-purpose-tp-23 .H6}

##### (1) {#section-73 .H6}

**with** { UE in RRC\_CONNECTED state and is configured with two
PUCCH-config each corresponds to a PHY priority}

**ensure that** {

**when** { UE receives DL MAC PDU's with DL grant indicating different
priorities }

**then** { UE transmit the HARQ feedback using correct PUCCH resource as
per priority}

}

##### 7.1.1.2.5.2 Conformance requirements {#conformance-requirements-23 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.213 clause 9, 9.2.4. Unless otherwise stated these
are Rel-16 requirements.

\[TS 38.213, clause 9\]

A PUSCH or a PUCCH transmission, including repetitions if any, can be of
priority index 0 or of priority index 1. For a configured grant PUSCH
transmission, a UE determines a priority index from *phy-PriorityIndex*,
if provided. For a PUCCH transmission with HARQ-ACK information
corresponding to a SPS PDSCH reception or a SPS PDSCH release, a UE
determines a priority index from *harq-CodebookID*, if provided. For a
PUCCH transmission with SR, a UE determines the corresponding priority
as described in Clause 9.2.4. For a PUSCH transmission with
semi-persistent CSI report, a UE determines a priority index from a
priority indicator field, if provided, inÂ a DCI format that activates
the semi-persistent CSIÂ report. If a priority index is not provided to a
UE for a PUSCH or a PUCCH transmission, the priority index is 0.

\[TS 38.213, clause 9.1\]

If a UE is provided *pdsch-HARQ-ACK-CodebookList,* the UE can be
indicated by *pdsch-HARQ-ACK-CodebookList* to generate one or two
HARQ-ACK codebooks. If the UE is indicated to generate one HARQ-ACK
codebook, the HARQ-ACK codebook is associated with a PUCCH of priority
index 0. If a UE is provided *pdsch-HARQ-ACK-CodebookList*, the UE
multiplexes in a same HARQ-ACK codebook only HARQ-ACK information
associated with a same priority index. If the UE is indicated to
generate two HARQ-ACK codebooks

> \- a first HARQ-ACK codebook is associated with a PUCCH of priority
> index 0 and a second HARQ-ACK codebook is associated with a PUCCH of
> priority index 1

\[TS 38.213, clause 9.2.4\]

A UE can be configured by *SchedulingRequestResourceConfig* a set of
configurations for SR in a PUCCH transmission using either PUCCH format
0 or PUCCH format 1. A UE can be configured by
*schedulingRequestID-BFR-SCell* a configuration for LRR in a PUCCH
transmission using either PUCCH format 0 or PUCCH format 1. The UE can
be provided, by *phy-PriorityIndex* in
*SchedulingRequestResourceConfig*, a priority index 0 or a priority
index 1 for the SR. If the UE is not provided a priority index for SR,
the priority index is 0.

##### 7.1.1.2.5.3 Test description {#test-description-23 .H6}

##### 7.1.1.2.5.3.1 Pre-test conditions {#pre-test-conditions-23 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that set to return
no data in uplink and parameters as in Table 7.1.1.2.5.3.1-1.

Table 7.1.1.2.5.3.1-1: MAC Parameters

  --------------------------------- --------------------- -------------
  **Parameter**                     **Value**             **Comment**
  priorityIndicatorDCI-1-1-r16      enabled               
  pdsch-HARQ-ACK-CodebookList-r16   dynamic, semiStatic   2 entries
  --------------------------------- --------------------- -------------

##### 7.1.1.2.5.3.2 Test procedure sequence {#test-procedure-sequence-22 .H6}

Table 7.1.1.2.5.3.2-1: Main behaviour

+----+--------------+--------------+--------------+---------+----+
| St | Procedure    | Message      | TP           | Verdict |    |
|    |              | Sequence     |              |         |    |
+====+==============+==============+==============+=========+====+
|    |              | U - S        | Message      |         |    |
+----+--------------+--------------+--------------+---------+----+
| 1  | SS transmits | \<\--        | (PDCCH       | \-      | \- |
|    | a downlink   |              | (C-RNTI)     |         |    |
|    | assignment   |              | priority Ind |         |    |
|    | addressed to |              | =0)          |         |    |
|    | the C-RNTI   |              |              |         |    |
|    | assigned to  |              | (PDCCH       |         |    |
|    | the UE with  |              | (C-RNTI))    |         |    |
|    | priority     |              |              |         |    |
|    | indicator =0 |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 2  | SS transmits | \<\--        | MAC PDU      | \-      | \- |
|    | in the       |              |              |         |    |
|    | indicated    |              |              |         |    |
|    | downlink     |              |              |         |    |
|    | assignment a |              |              |         |    |
|    | MAC PDU      |              |              |         |    |
|    | including a  |              |              |         |    |
|    | RLC PDU with |              |              |         |    |
|    | poll bit not |              |              |         |    |
|    | set.         |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 3  | Check: Does  | \--\>        | HARQ ACK     | 1       | P  |
|    | the UE       |              |              |         |    |
|    | transmit an  |              |              |         |    |
|    | HARQ ACK on  |              |              |         |    |
|    | PUCCH        |              |              |         |    |
|    | associated   |              |              |         |    |
|    | with         |              |              |         |    |
|    | priority     |              |              |         |    |
|    | indicator 0? |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 4  | SS transmits | \<\--        | (PDCCH       | \-      | \- |
|    | a downlink   |              | (C-RNTI)     |         |    |
|    | assignment   |              | priority Ind |         |    |
|    | addressed to |              | =1)          |         |    |
|    | the C-RNTI   |              |              |         |    |
|    | assigned to  |              | (PDCCH       |         |    |
|    | the UE with  |              | (C-RNTI))    |         |    |
|    | priority     |              |              |         |    |
|    | indicator =1 |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 5  | SS transmits | \<\--        | MAC PDU      | \-      | \- |
|    | in the       |              |              |         |    |
|    | indicated    |              |              |         |    |
|    | downlink     |              |              |         |    |
|    | assignment a |              |              |         |    |
|    | MAC PDU      |              |              |         |    |
|    | including a  |              |              |         |    |
|    | RLC PDU with |              |              |         |    |
|    | poll bit not |              |              |         |    |
|    | set.         |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 6  | Check: Does  | \--\>        | HARQ ACK     | 1       | P  |
|    | the UE       |              |              |         |    |
|    | transmit an  |              |              |         |    |
|    | HARQ ACK on  |              |              |         |    |
|    | PUCCH        |              |              |         |    |
|    | associated   |              |              |         |    |
|    | with         |              |              |         |    |
|    | priority     |              |              |         |    |
|    | indicator 1? |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+

##### 7.1.1.2.5.3.3 Specific message contents {#specific-message-contents-23 .H6}

None

##### 7.1.1.2.6 Correct Handling of DL MAC PDU / Assignment / HARQ process

##### 7.1.1.2.6.1 Test Purpose (TP) {#test-purpose-tp-24 .H6}

##### (1) {#section-74 .H6}

**with** { UE in RRC\_CONNECTED state and supporting dynamic PUCCH
repetition indication. UE is configured with a set of PUCCH resources
and resource-specific PUCCH repetition numbers }

**ensure that** {

**when** { UE receives a DCI scheduling PDSCH reception }

**then** { UE transmits HARQ feedback on PUCCH with the repetition
number associated with the PUCCH resource indicated by DCI scheduling
PDSCH }

}

##### 7.1.1.2.6.2 Conformance requirements {#conformance-requirements-24 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.213 clause 9.2.6, TS 38.321, clauses 5.3.1, 5.3.2.1,
5.3.2.2 and 6.1.2. Unless otherwise stated these are Rel-17
requirements.

\[TS 38.213 clause 9.2.6\]

A UE can be indicated to transmit a PUCCH over
![](./media/image23.png)![](./media/image23.png) slots using a PUCCH
resource, where

\- if the PUCCH resource is indicated by a DCI format and includes
*pucch-RepetitionNrofSlots*,
![](./media/image24.png)![](./media/image24.png) is provided by
*pucch-RepetitionNrofSlots*

\- otherwise, ![](./media/image24.png)![](./media/image24.png) is
provided by *nrofSlots*

...

For ![](./media/image25.png)![](./media/image25.png),

\- the UE repeats the PUCCH transmission with the UCI over
![](./media/image24.png)![](./media/image24.png) slots

\- a repetition of the PUCCH transmission in each of the
![](./media/image24.png)![](./media/image24.png) slots has a same number
of consecutive symbols, as provided by *nrofSymbols*

\- a repetition of the PUCCH transmission in each of the
![](./media/image24.png)![](./media/image24.png) slots has a same first
symbol, as provided by *startingSymbolIndex* *if subslotLengthForPUCCH
is not provided; otherwise mod(startingSymbolIndex,
subslotLengthForPUCCH)*

\- the UE is configured by *interslotFrequencyHopping* whether or not to
perform frequency hopping for repetitions of the PUCCH transmission in
different slots

\- if the UE is configured to perform frequency hopping for repetitions
of a PUCCH transmission across slots and the UE is not provided
*PUCCH-DMRS-Bundling* = \'enabled\'

\- the UE performs frequency hopping per slot

\- the UE transmits the PUCCH starting from a first PRB, provided by
*startingPRB*, in slots with even number and starting from a second PRB,
provided by *secondHopPRB*, in slots with odd number. The slot indicated
to the UE for the first repetition of the PUCCH transmission has number
0 and each subsequent slot until the UE transmits the PUCCH in
![](./media/image24.png)![](./media/image24.png) slots is counted
regardless of whether or not the UE transmits the PUCCH in the slot

\- the UE does not expect to be configured to perform frequency hopping
for a repetition of the PUCCH transmission within a slot

...

\- if the UE is not configured to perform frequency hopping for
repetitions of a PUCCH transmission across slots and the UE is
configured to perform frequency hopping for a repetition of the PUCCH
transmission within a slot, the frequency hopping pattern between the
first PRB and the second PRB is same within each slot

If the UE determines that, for a repetition of a PUCCH transmission in a
slot, the number of symbols available for the PUCCH transmission is
smaller than the value provided by *nrofSymbols* for the corresponding
PUCCH format, the UE does not transmit the PUCCH repetition in the slot.

A SS/PBCH block symbol is a symbol of an SS/PBCH block with candidate
SS/PBCH block index corresponding to the SS/PBCH block index indicated
to a UE by *ssb-PositionsInBurst* in *SIB1* or *ssb-PositionsInBurst* in
*ServingCellConfigCommon* or by *NonCellDefiningSSB if* provided or, if
the UE is not provided *dl-OrJointTCI-StateList*, by
*ssb-PositionsInBurst* in *SSB-MTCAdditionalPCI* associated to physical
cell ID with active TCI states for PDCCH or PDSCH, or for a set of
symbols of a slot corresponding to SS/PBCH blocks configured for L1 beam
measurement/reporting.

For unpaired spectrum, the UE determines the
![](./media/image24.png)![](./media/image24.png) slots for a PUCCH
transmission starting from a slot indicated to the UE as described in
clause 9.2.3 for HARQ-ACK reporting, or a slot determined as described
in clause 9.2.4 for SR reporting or in clause 5.2.1.4 of \[6, TS
38.214\] for CSI reporting and having

\- an UL symbol, as described in clause 11.1, or flexible symbol that is
not SS/PBCH block symbol provided by *startingSymbolIndex* as a first
symbol, and

\- consecutive UL symbols, as described in clause 11.1, or flexible
symbols that are not SS/PBCH block symbols, starting from the first
symbol, equal to or larger than a number of symbols provided by
*nrofsymbols*

For paired spectrum or supplementary uplink band, the UE determines the
![](./media/image24.png)![](./media/image24.png) slots for a PUCCH
transmission as the ![](./media/image24.png)![](./media/image24.png)
consecutive slots starting from a slot indicated to the UE as described
in clause 9.2.3 for HARQ-ACK reporting, or a slot determined as
described in clause 9.2.4 for SR reporting or in clause 5.2.1.4 of \[6,
TS 38.214\] for CSI reporting.

...

\[TS 38.321, clause 5.3.1\]

Downlink assignments received on the PDCCH both indicate that there is a
transmission on a DL-SCH for a particular MAC entity and provide the
relevant HARQ information.

When the MAC entity has a C-RNTI, Temporary C-RNTI, CS-RNTI, G-RNTI or
G-CS-RNTI, the MAC entity shall for each PDCCH occasion during which it
monitors PDCCH and for each Serving Cell:

> 1\> if a downlink assignment for this PDCCH occasion and this Serving
> Cell has been received on the PDCCH for the MAC entity\'s C-RNTI, or
> Temporary Câ€‘RNTI, or G-RNTI configured for multicast MTCH:
>
> ...
>
> 2\> indicate the presence of a downlink assignment and deliver the
> associated HARQ information to the HARQ entity.
>
> ...

\[TS 38.321, clause 5.3.2.2\]

...

The MAC entity then shall:

1\> if this is a new transmission:

2\> attempt to decode the received data.

1\> else if this is a retransmission:

2\> if the data for this TB has not yet been successfully decoded:

3\> instruct the physical layer to combine the received data with the
data currently in the soft buffer for this TB and attempt to decode the
combined data.

...

1\> else:

2\> instruct the physical layer to generate acknowledgement(s) of the
data in this TB.

##### 7.1.1.2.6.3 Test description {#test-description-24 .H6}

##### 7.1.1.2.6.3.1 Pre-test conditions {#pre-test-conditions-24 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that set to return
no data in uplink.

##### 7.1.1.2.6.3.2 Test procedure sequence {#test-procedure-sequence-23 .H6}

Table 7.1.1.2.6.3.2-1: Main behaviour

+----+--------------+--------------+--------------+---------+----+
| St | Procedure    | Message      | TP           | Verdict |    |
|    |              | Sequence     |              |         |    |
+====+==============+==============+==============+=========+====+
|    |              | U - S        | Message      |         |    |
+----+--------------+--------------+--------------+---------+----+
| 1  | SS transmits | \<\--        | NR RRC:      | \-      | \- |
|    | an           |              | RRCRec       |         |    |
|    | *RRCReco     |              | onfiguration |         |    |
|    | nfiguration* |              |              |         |    |
|    | message to   |              |              |         |    |
|    | configure 2  |              |              |         |    |
|    | PUCCH        |              |              |         |    |
|    | resources    |              |              |         |    |
|    | associated   |              |              |         |    |
|    | with         |              |              |         |    |
|    | resource     |              |              |         |    |
|    | specific     |              |              |         |    |
|    | repetition   |              |              |         |    |
|    | factors.     |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 2  | UE transmits | \--\>        | NR RRC:      | \-      | \- |
|    | an           |              | RR           |         |    |
|    | *RRC         |              | CReconfigura |         |    |
|    | Reconfigurat |              | tionComplete |         |    |
|    | ionComplete* |              |              |         |    |
|    | message.     |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 3  | SS transmits | \<\--        | DCI format   | \-      | \- |
|    | a downlink   |              | 1\_1(UE      |         |    |
|    | assignment   |              | C-RNTI,      |         |    |
|    | addressed to |              | PUCCH        |         |    |
|    | the C-RNTI   |              | resource     |         |    |
|    | assigned to  |              | indicator =  |         |    |
|    | the UE,      |              | "000")       |         |    |
|    | which        |              |              |         |    |
|    | indicates    |              |              |         |    |
|    | [UE]         |              |              |         |    |
|    | {.underline} |              |              |         |    |
|    | to use PUCCH |              |              |         |    |
|    | resource \#0 |              |              |         |    |
|    | for HARQ     |              |              |         |    |
|    | feedback.    |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 4  | SS transmits | \<\--        | MAC PDU      | \-      | \- |
|    | in the       |              |              |         |    |
|    | indicated    |              |              |         |    |
|    | downlink     |              |              |         |    |
|    | assignment a |              |              |         |    |
|    | MAC PDU      |              |              |         |    |
|    | including an |              |              |         |    |
|    | RLC PDU with |              |              |         |    |
|    | poll bit not |              |              |         |    |
|    | set.         |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 5  | Check: Does  | \--\>        | HARQ         | 1       | P  |
|    | the UE       |              | ACK/NACK     |         |    |
|    | transmit     |              |              |         |    |
|    | HARQ ACK     |              |              |         |    |
|    | N~0~ times   |              |              |         |    |
|    | using PUCCH  |              |              |         |    |
|    | resource     |              |              |         |    |
|    | \#0?         |              |              |         |    |
|    |              |              |              |         |    |
|    | NOTE: Value  |              |              |         |    |
|    | of N~0~ is   |              |              |         |    |
|    | given by the |              |              |         |    |
|    | pucch        |              |              |         |    |
|    | -RepetitionN |              |              |         |    |
|    | rofSlots-r17 |              |              |         |    |
|    | associated   |              |              |         |    |
|    | to PUCCH     |              |              |         |    |
|    | resource     |              |              |         |    |
|    | \#0.         |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 6  | SS transmits | \<\--        | DCI format   | \-      | \- |
|    | a downlink   |              | 1\_1(UE      |         |    |
|    | assignment   |              | C-RNTI,      |         |    |
|    | addressed to |              | PUCCH        |         |    |
|    | the C-RNTI   |              | resource     |         |    |
|    | assigned to  |              | indicator =  |         |    |
|    | the UE,      |              | "001")       |         |    |
|    | which        |              |              |         |    |
|    | indicates    |              |              |         |    |
|    | [UE]         |              |              |         |    |
|    | {.underline} |              |              |         |    |
|    | to use PUCCH |              |              |         |    |
|    | resource \#1 |              |              |         |    |
|    | for HARQ     |              |              |         |    |
|    | feedback.    |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 7  | SS transmits | \<\--        | MAC PDU      | \-      | \- |
|    | in the       |              |              |         |    |
|    | indicated    |              |              |         |    |
|    | downlink     |              |              |         |    |
|    | assignment a |              |              |         |    |
|    | MAC PDU      |              |              |         |    |
|    | including an |              |              |         |    |
|    | RLC PDU with |              |              |         |    |
|    | poll bit not |              |              |         |    |
|    | set.         |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 8  | Check: Does  | \--\>        | HARQ         | 1       | P  |
|    | the UE       |              | ACK/NACK     |         |    |
|    | transmit     |              |              |         |    |
|    | HARQ ACK     |              |              |         |    |
|    | N~1~ times   |              |              |         |    |
|    | using PUCCH  |              |              |         |    |
|    | resource     |              |              |         |    |
|    | \#1?         |              |              |         |    |
|    |              |              |              |         |    |
|    | NOTE: Value  |              |              |         |    |
|    | of N~1~ is   |              |              |         |    |
|    | given by the |              |              |         |    |
|    | pucch        |              |              |         |    |
|    | -RepetitionN |              |              |         |    |
|    | rofSlots-r17 |              |              |         |    |
|    | associated   |              |              |         |    |
|    | to PUCCH     |              |              |         |    |
|    | resource     |              |              |         |    |
|    | \#1.         |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 9  | SS transmits | \<\--        | NR RRC:      | \-      | \- |
|    | an           |              | RRCRec       |         |    |
|    | *RRCReco     |              | onfiguration |         |    |
|    | nfiguration* |              |              |         |    |
|    | message to   |              |              |         |    |
|    | release      |              |              |         |    |
|    | resource     |              |              |         |    |
|    | specific     |              |              |         |    |
|    | repetition   |              |              |         |    |
|    | factors and  |              |              |         |    |
|    | configure    |              |              |         |    |
|    | PUCCH format |              |              |         |    |
|    | specific     |              |              |         |    |
|    | repetition   |              |              |         |    |
|    | factor.      |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 10 | UE transmits | \--\>        | NR RRC:      | \-      | \- |
|    | an           |              | RR           |         |    |
|    | *RRC         |              | CReconfigura |         |    |
|    | Reconfigurat |              | tionComplete |         |    |
|    | ionComplete* |              |              |         |    |
|    | message.     |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 11 | SS transmits | \<\--        | DCI format   | \-      | \- |
|    | a downlink   |              | 1\_1(UE      |         |    |
|    | assignment   |              | C-RNTI,      |         |    |
|    | addressed to |              | PUCCH        |         |    |
|    | the C-RNTI   |              | resource     |         |    |
|    | assigned to  |              | indicator =  |         |    |
|    | the UE,      |              | "000")       |         |    |
|    | which        |              |              |         |    |
|    | indicates    |              |              |         |    |
|    | [UE]         |              |              |         |    |
|    | {.underline} |              |              |         |    |
|    | to use PUCCH |              |              |         |    |
|    | resource \#0 |              |              |         |    |
|    | for HARQ     |              |              |         |    |
|    | feedback.    |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 12 | SS transmits | \<\--        | MAC PDU      | \-      | \- |
|    | in the       |              |              |         |    |
|    | indicated    |              |              |         |    |
|    | downlink     |              |              |         |    |
|    | assignment a |              |              |         |    |
|    | MAC PDU      |              |              |         |    |
|    | including an |              |              |         |    |
|    | RLC PDU with |              |              |         |    |
|    | poll bit not |              |              |         |    |
|    | set.         |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+
| 13 | Check: Does  | \--\>        | HARQ         | 1       | P  |
|    | the UE       |              | ACK/NACK     |         |    |
|    | transmit     |              |              |         |    |
|    | HARQ ACK N   |              |              |         |    |
|    | times using  |              |              |         |    |
|    | PUCCH        |              |              |         |    |
|    | resource     |              |              |         |    |
|    | \#0?         |              |              |         |    |
|    |              |              |              |         |    |
|    | NOTE: Value  |              |              |         |    |
|    | of N is      |              |              |         |    |
|    | given by the |              |              |         |    |
|    | nrofSlots    |              |              |         |    |
|    | associated   |              |              |         |    |
|    | to the       |              |              |         |    |
|    | format of    |              |              |         |    |
|    | PUCCH        |              |              |         |    |
|    | resource     |              |              |         |    |
|    | \#0.         |              |              |         |    |
+----+--------------+--------------+--------------+---------+----+

##### 7.1.1.2.6.3.3 Specific message contents {#specific-message-contents-24 .H6}

Table 7.1.1.2.6.3.3-1: *RRCReconfiguration* (Step 1 & 9, Table
7.1.1.2.6.3.2-1)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.1-13 with condition NR                                             
  ---------------------------------------------------------------------- ----------------- ----------------------- -----------
  Information Element                                                    Value/remark      Comment                 Condition
  RRCReconfiguration ::= SEQUENCE {                                                                                
  criticalExtensions CHOICE {                                                                                      
  rrcReconfiguration SEQUENCE {                                                                                    
  radioBearerConfig                                                      Not present                               
  nonCriticalExtension SEQUENCE {                                                                                  
  masterCellGroup                                                        CellGroupConfig   Table 7.1.1.2.6.3.3-2   
  dedicatedNAS-MessageList                                               Not present                               
  }                                                                                                                
  }                                                                                                                
  }                                                                                                                
  }                                                                                                                

Table 7.1.1.2.6.3.3-2: *CellGroupConfig* (Table 7.1.1.2.6.3.3-1)

  Derivation Path: TS 38.508-1 \[4\] Table 4.6.3-19                                 
  --------------------------------------------------- ------------------- --------- -----------
  Information Element                                 Value/remark        Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                    
  spCellConfig SEQUENCE {                                                           
  spCellConfigDedicated                               ServingCellConfig             
  }                                                                                 
  }                                                                                 

Table 7.1.1.2.6.3.3-3: *ServingCellConfig* (Table 7.1.1.2.6.3.3-2)

  Derivation Path: TS 38.508-1 \[4\] Table 4.6.3-167                                                 
  ---------------------------------------------------- --------------------- ----------------------- -----------
  Information Element                                  Value/remark          Comment                 Condition
  ServingCellConfig ::= SEQUENCE {                                                                   
  uplinkConfig SEQUENCE {                                                                            
  initialUplinkBWP SEQUENCE {                          BWP-UplinkDedicated                           
  pucch-Config CHOICE {                                                                              
  setup                                                PUCCH-Config-1        Table 7.1.1.2.6.3.3-4   Step 1
                                                       PUCCH-Config-2        Table 7.1.1.2.6.3.3-5   Step 9
  }                                                                                                  
  }                                                                                                  
  }                                                                                                  
  }                                                                                                  

Table 7.1.1.2.6.3.3-4: *PUCCH-Config (*Table 7.1.1.2.6.3.3-3*)*

+-------------------+--------------+----------------+-----------+
| Derivation Path:  |              |                |           |
| TS 38.508-1       |              |                |           |
| \[4\], Table      |              |                |           |
| 4.6.3-112         |              |                |           |
+===================+==============+================+===========+
| Information       | Value/remark | Comment        | Condition |
| Element           |              |                |           |
+-------------------+--------------+----------------+-----------+
| PUCCH-Config ::=  |              |                |           |
| SEQUENCE {        |              |                |           |
+-------------------+--------------+----------------+-----------+
| res               | 16 entries   |                |           |
| ourceToAddModList |              |                |           |
| SEQUENCE (SIZE    |              |                |           |
| (1..maxNrof       |              |                |           |
| PUCCH-Resources)) |              |                |           |
| OF PUCCH-Resource |              |                |           |
| {                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| PU                |              | entry 1        |           |
| CCH-Resource\[1\] |              |                |           |
| SEQUENCE {        |              | resource \#0   |           |
+-------------------+--------------+----------------+-----------+
| intraSlo          | Not present  |                |           |
| tFrequencyHopping |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| PU                |              | entry 2        |           |
| CCH-Resource\[2\] |              |                |           |
| SEQUENCE {        |              | resource \#1   |           |
+-------------------+--------------+----------------+-----------+
| intraSlo          | Not present  |                |           |
| tFrequencyHopping |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| resourceTo        | 16 entries   |                |           |
| AddModListExt-r16 |              |                |           |
| SEQUENCE (SIZE    |              |                |           |
| (1..maxNrof       |              |                |           |
| PUCCH-Resources)) |              |                |           |
| OF                |              |                |           |
| PUCCH-            |              |                |           |
| ResourceExt-v1610 |              |                |           |
| {                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| PUCCH-Resou       |              | entry 1        |           |
| rceExt-v1610\[1\] |              |                |           |
| SEQUENCE {        |              | resource \#0   |           |
+-------------------+--------------+----------------+-----------+
| interl            | Not present  |                |           |
| aceAllocation-r16 |              |                |           |
+-------------------+--------------+----------------+-----------+
| format-v1610      | Not present  |                |           |
+-------------------+--------------+----------------+-----------+
| format-v1700      | Not present  |                |           |
+-------------------+--------------+----------------+-----------+
| pucch-Repeti      | n2           |                |           |
| tionNrofSlots-r17 |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| PUCCH-Resou       |              | entry 2        |           |
| rceExt-v1610\[2\] |              |                |           |
| SEQUENCE {        |              | resource \#1   |           |
+-------------------+--------------+----------------+-----------+
| interl            | Not present  |                |           |
| aceAllocation-r16 |              |                |           |
+-------------------+--------------+----------------+-----------+
| format-v1610      | Not present  |                |           |
+-------------------+--------------+----------------+-----------+
| format-v1700      | Not present  |                |           |
+-------------------+--------------+----------------+-----------+
| pucch-Repeti      | n4           |                |           |
| tionNrofSlots-r17 |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| PUCCH-Reso        |              | entry k        |           |
| urceExt-v1610\[k, |              |                |           |
| k=3..16\]         |              | resource \#k+1 |           |
| SEQUENCE {        |              |                |           |
+-------------------+--------------+----------------+-----------+
| interl            | Not present  |                |           |
| aceAllocation-r16 |              |                |           |
+-------------------+--------------+----------------+-----------+
| format-v1610      | Not present  |                |           |
+-------------------+--------------+----------------+-----------+
| format-v1700      | Not present  |                |           |
+-------------------+--------------+----------------+-----------+
| pucch-Repeti      | Not present  |                |           |
| tionNrofSlots-r17 |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+

Table 7.1.1.2.6.3.3-5: *PUCCH-Config (*Table 7.1.1.2.6.3.3-3*)*

+-------------------+--------------+----------------+-----------+
| Derivation Path:  |              |                |           |
| TS 38.508-1       |              |                |           |
| \[4\], Table      |              |                |           |
| 4.6.3-112         |              |                |           |
+===================+==============+================+===========+
| Information       | Value/remark | Comment        | Condition |
| Element           |              |                |           |
+-------------------+--------------+----------------+-----------+
| PUCCH-Config ::=  |              |                |           |
| SEQUENCE {        |              |                |           |
+-------------------+--------------+----------------+-----------+
| resourceTo        | 16 entries   |                |           |
| AddModListExt-r16 |              |                |           |
| SEQUENCE (SIZE    |              |                |           |
| (1..maxNrof       |              |                |           |
| PUCCH-Resources)) |              |                |           |
| OF                |              |                |           |
| PUCCH-            |              |                |           |
| ResourceExt-v1610 |              |                |           |
| {                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| PUCCH-Reso        |              | entry k        |           |
| urceExt-v1610\[k, |              |                |           |
| k=1..16\]         |              | resource \#k+1 |           |
| SEQUENCE {        |              |                |           |
+-------------------+--------------+----------------+-----------+
| interl            | Not present  |                |           |
| aceAllocation-r16 |              |                |           |
+-------------------+--------------+----------------+-----------+
| format-v1610      | Not present  |                |           |
+-------------------+--------------+----------------+-----------+
| format-v1700      | Not present  |                |           |
+-------------------+--------------+----------------+-----------+
| pucch-Repeti      | Not present  |                |           |
| tionNrofSlots-r17 |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| format0-r17       |              |                |           |
| CHOICE {          |              |                |           |
+-------------------+--------------+----------------+-----------+
| setup SEQUENCE {  |              |                |           |
+-------------------+--------------+----------------+-----------+
| interslo          | Not present  |                |           |
| tFrequencyHopping |              |                |           |
+-------------------+--------------+----------------+-----------+
| additionalDMRS    | Not present  |                |           |
+-------------------+--------------+----------------+-----------+
| maxCodeRate       | Not present  |                |           |
+-------------------+--------------+----------------+-----------+
| nrofSlots         | n8           |                |           |
+-------------------+--------------+----------------+-----------+
| pi2BPSK           | Not present  |                |           |
+-------------------+--------------+----------------+-----------+
| simulta           | Not present  |                |           |
| neousHARQ-ACK-CSI |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+
| }                 |              |                |           |
+-------------------+--------------+----------------+-----------+

Table 7.1.1.2.6.3.3-6: Physical layer parameters for DCI format 1\_1
(step 3, 6 & 11, Table 7.1.1.2.6.3.2-1)

  Derivation path: 38.508-1 \[4\] Table 4.3.6.1.2.2-1                                                                               
  ----------------------------------------------------- --------------------------------------------------------- ----------------- -----------------
  Parameter                                             Value                                                     Value in binary   Condition
  PUCCH resource indicator                              *PUCCH-ResourceId\[1\]* = 0 in pucch-ResourceSetID\[1\]   "000"             Step 3, Step 11
                                                        *PUCCH-ResourceId\[2\]* = 1 in pucch-ResourceSetID\[1\]   "001"             Step 6

##### 7.1.1.2.7 Correct HARQ process handling / Unified TCI Activation

##### 7.1.1.2.7.1 Test Purpose (TP) {#test-purpose-tp-25 .H6}

##### (1) {#section-75 .H6}

**with** { UE in RRC\_CONNECTED state with TCI-State\_r17 configured and
2 unified TCI states are activated by MAC-CE }

**ensure that** {

**when** { UE receives PDSCH scheduling by DCI\_1\_1 carring the 1st
activated unified TCI state}

**then** { UE sends a HARQ feedback on the HARQ process }

}

##### (2) {#section-76 .H6}

**with** { UE in RRC\_CONNECTED state with TCI-State\_r17 configured and
2 unified TCI states are activated by MAC-CE }

**ensure that** {

**when** { UE receives DCI\_1\_1 carring the 2nd activated unified TCI
state without DL assignment }

**then** { UE sends a HARQ feedback on the HARQ process }

}

##### 7.1.1.2.7.2 Conformance requirements {#conformance-requirements-25 .H6}

References: The conformance requirements covered in the present TC are
specified in: TS 38.214 clause 5.1.5, TS 38.321, clauses 5.3.1, 5.3.2.1,
5.3.2.2 and 6.1.3.47. Unless otherwise stated these are Rel-17
requirements.

\[TS 38.214 clause 5.1.5\]

The UE can be configured with a list of up to *M* *TCI-State*
configurations within the higher layer parameter *PDSCH-Config* to
decode PDSCH according to a detected PDCCH with DCI intended for the UE
and the given serving cell, where M depends on the UE capability
*maxNumberConfiguredTCIstatesPerCC*. Each *TCI-State* contains
parameters for configuring a quasi co-location relationship between one
or two downlink reference signals and the DM-RS ports of the PDSCH, the
DM-RS port of PDCCH or the CSI-RS port(s) of a CSI-RS resource. The
quasi co-location relationship is configured by the higher layer
parameter *qcl-Type1* for the first DL RS, and *qcl-Type2* for the
second DL RS (if configured). For the case of two DL RSs, the QCL types
shall not be the same, regardless of whether the references are to the
same DL RS or different DL RSs. The quasi co-location types
corresponding to each DL RS are given by the higher layer parameter
*qcl-Type* in *QCL-Info* and may take one of the following values:

\- \'typeA\': {Doppler shift, Doppler spread, average delay, delay
spread}

\- \'typeB\': {Doppler shift, Doppler spread}

\- \'typeC\': {Doppler shift, average delay}

\- \'typeD\': {Spatial Rx parameter}

The UE can be configured with a list of up to *128* *TCI-State*
configurations, within the higher layer parameter
*dl-OrJointTCI-StateList* in *PDSCH-Config* for providing a reference
signal for the quasi co-location for DM-RS of PDSCH and DM-RS of PDCCH
in a BWP/CC, for CSI-RS, and to provide a reference, if applicable, for
determining UL TX spatial filter for dynamic-grant and configured-grant
based PUSCH and PUCCH resource in a BWP/CC, and SRS.

If the *TCI-State* or *TCI-UL-State* configurations are absent in a BWP
of the CC, the UE can apply the *TCI-State* or *TCI-UL-State*
configurations from a reference BWP of a reference CC. The UE is not
expected to be configured with *tci-StatesToAddModList*,
*SpatialRelationInfo* or *PUCCH-SpatialRelationInfo*, **except
*SpatialRelationInfoPos in a CC in a band*,** if the UE is configured
with *dl-OrJointTCI-StateList* or *ul-TCI-StateList* in any CC in the
same band. The UE can assume that when the UE is configured with
*tci-StatesToAddModList* in any CC in the CC list configured by
*simultaneousTCI-UpdateList1-r16, simultaneousTCI-UpdateList2-r16,*
*simultaneousSpatial-UpdatedList1-r16, or
simultaneousSpatial-UpdatedList2-r16,* the UE is not configured with
*dl-OrJointTCI-StateList* or *ul-TCI-StateList* in any CC within the
same band in the CC list.

The UE receives an activation command, as described in clause 6.1.3.xx
of \[10, TS 38.321\], 6.1.3.47 of \[10, TS 38.321\] or 6.1.4.xx of \[10,
TS 38.321\], used to map up to 8 TCI states and/or pairs of TCI states,
with one TCI state for DL channels/signals and/or one TCI state for UL
channels/signals to the codepoints of the DCI field *\'Transmission
Configuration Indication\'* for one or for a set of CCs/DL BWPs,
\[and/\] or up to 8 sets of TCI states, where each set is comprised of
up to two TCI state(s) for DL and UL signals/channels, or up to two TCI
state(s) for DL channels/signals and up to two TCI state(s) for UL
channels/signals to the codepoints of the DCI field *\'Transmission
Configuration Indication\'* for one or for a set of CCs/DL BWPs, and if
applicable, for one or for a set of CCs/UL BWPs. When a set of TCI state
IDs are activated for a set of CCs/DL BWPs and if applicable, for a set
of CCs/UL BWPs, where the applicable list of CCs is determined by the
indicated CC in the activation command, the same set of TCI state IDs
are applied for all DL and/or UL BWPs in the indicated CCs. If the
activation command maps *TCI-State(s)* and/or *TCI-UL-State(s)* to only
one TCI codepoint, the UE shall apply the indicated *TCI-State(s)*
and/or *TCI-UL-State(s)* to one or to a set of CCs /DL BWPs, and if
applicable, to one or to a set of CCs /UL BWPs once the indicated
mapping for the one single TCI codepoint is applied as described in
\[11, TS 38.133\].

When the *bwp-id* or *cell* for QCL-TypeA/D source RS in a QCL-Info of
the TCI state is not configured, the UE assumes that QCL-TypeA/D source
RS is configured in the CC/DL BWP where TCI state applies.

When *tci-PresentInDCI* is set as \'enabled\' or *tci-PresentDCI-1-2* is
configured for the CORESET, a UE configured with
*dl-OrJointTCI-StateList* with activated *TCI-State* or
*ul-TCI-StateList* with activated *TCI-UL-State* receives DCI format
1\_1/1\_2/1\_3 providing indicated *TCI-State(s)* and/or
*TCI-UL-State(s)* for a CC or all CCs in the same CC list configured by
*simultaneousU-TCI-UpdateList1-r17, simultaneousU-TCI-UpdateList2-r17,
simultaneousU-TCI-UpdateList3-r17, simultaneousU-TCI-UpdateList4-r17*.
The DCI format 1\_1/1\_2 can be with or without, if applicable, DL
assignment. If the DCI format 1\_1/1\_2/ is without DL assignment, the
UE can assume the following:

\- CS-RNTI is used to scramble the CRC for the DCI

\- The values of the following DCI fields are set as follows:

\- RV = all \'1\'s

\- MCS = all \'1\'s

\- NDI = 0

\- Set to all \'0\'s for FDRA Type 0, or all \'1\'s for FDRA Type 1, or
all \'0\'s for dynamicSwitch (same as in Table 10.2-4 of \[6, TS
38.213\]).

After a UE receives an initial higher layer configuration of
*dl-OrJointTCI-StateList* with more than one *TCI-State* and before
application of an indicated TCI state from the configured TCI states:

\- The UE assumes that DM-RS of PDSCH and DM-RS of PDCCH and the CSI-RS
applying the indicated TCI state are quasi co-located with the SS/PBCH
block the UE identified during the initial access procedure

After a UE receives an initial higher layer configuration of
*dl-OrJointTCI-StateList* with more than one *TCI-State* or
*ul-TCI-StateList* with more than one *TCI-UL-State* and before
application of an indicated TCI state from the configured TCI states:

\- The UE assumes that the UL TX spatial filter, if applicable, for
dynamic-grant and configured-grant based PUSCH and PUCCH, and for SRS
applying the indicated TCI state, is the same as that for a PUSCH
transmission scheduled by a RAR UL grant during the initial access
procedure

After a UE receives a higher layer configuration of
*dl-OrJointTCI-StateList* with more than one *TCI-State* as part of a
Reconfiguration with sync procedure as described in \[12, TS 38.331\]
and before applying an indicated TCI state from the configured TCI
states:

\- The UE assumes that DM-RS of PDSCH and DM-RS of PDCCH, and the CSI-RS
applying the indicated TCI state are quasi co-located with the SS/PBCH
block or the CSI-RS resource the UE identified during the random access
procedure initiated by the Reconfiguration with sync procedure as
described in \[12, TS 38.331\].

After a UE receives a higher layer configuration of
*dl-OrJointTCI-StateList* with more than one *TCI-State* or more than
one *TCI-UL-State* as part of a Reconfiguration with sync procedure as
described in \[12, TS 38.331\] and before applying an indicated TCI
state from the configured TCI states:

\- The UE assumes that the UL TX spatial filter, if applicable, for
dynamic-grant and configured-grant based PUSCH and PUCCH, and for SRS
applying the indicated TCI state, is the same as that for a PUSCH
transmission scheduled by a RAR UL grant during random access procedure
initiated by the Reconfiguration with sync procedure as described in
\[12, TS 38.331\].

If a UE receives a higher layer configuration of
*dl-OrJointTCI-StateList* with a single *TCI-State*, that can be used as
an indicated TCI state*,* the UE obtains the QCL assumptions from the
configured TCI state for DM-RS of PDSCH and DM-RS of PDCCH, and the CSI
-RS applying the indicated TCI state.

If a UE receives a higher layer configuration of
*dl-OrJointTCI-StateList* with a single *TCI-State or ul-TCI-StateList*
with *a single TCI-UL-State*, that can be used as an indicated TCI
state, the UE determines an UL TX spatial filter, if applicable, from
the configured TCI state for dynamic-grant and configured-grant based
PUSCH and PUCCH, and SRS applying the indicated TCI state.

When a UE configured with *dl-OrJointTCI-StateList* would transmit a
PUCCH with positive HARQ-ACK or a PUSCH with positive HARQ-ACK
corresponding to the DCI carrying the TCI State indication and without
DL assignment, or corresponding to the PDSCH scheduled by the DCI
carrying the TCI State indication, and if the indicated TCI State(s)
is/are different from the previously indicated one*(s)*, the indicated
*TCI-State(s)* and/or *TCI-UL-State(s)* should be applied starting from
the first slot that is at least $\text{beamAppTime}$ symbols after the
last symbol of the PUCCH or the PUSCH. The first slot and the
$\text{beamAppTime}$ symbols are both determined on the active BWP with
the smallest SCS among the BWP(s) from the CCs applying the indicated
*TCI-State(s)* or *TCI-UL-State(s)* that are active at the end of the
PUCCH or the PUSCH carrying the positive HARQ-ACK.

If a UE is configured with *pdsch-TimeDomainAllocationListForMultiPDSCH*
in which one or more rows contain multiple *SLIV*s for PDSCH on a DL BWP
of a serving cell, and the UE is receiving a DCI carrying the
*TCI-State* indication and without DL assignment, the UE does not expect
that the number of indicated *SLIV*s in the row of **the**
*pdsch-TimeDomainAllocationListForMultiPDSCH* by the DCI **is** more
than one.

\[TS 38.321, clause 5.3.2.1\]

The MAC entity includes a HARQ entity for each Serving Cell, which
maintains a number of parallel HARQ processes. Each HARQ process is
associated with a HARQ process identifier. The HARQ entity directs HARQ
information and associated TBs received on the DL-SCH to the
corresponding HARQ processes (see clause 5.3.2.2).

The number of parallel DL HARQ processes per HARQ entity is specified in
TS 38.214 \[7\]. The dedicated broadcast HARQ process is used for BCCH.

The HARQ process supports one TB when the physical layer is not
configured for downlink spatial multiplexing. The HARQ process supports
one or two TBs when the physical layer is configured for downlink
spatial multiplexing.

When the MAC entity is configured with *pdsch-AggregationFactor* \> 1,
the parameter *pdsch-AggregationFactor* provides the number of
transmissions of a TB within a bundle of the downlink assignment.
Bundling operation relies on the HARQ entity for invoking the same HARQ
process for each transmission that is part of the same bundle. After the
initial transmission, *pdsch-AggregationFactor* -- 1 HARQ
retransmissions follow within a bundle.

The MAC entity shall:

1\> if a downlink assignment has been indicated:

2\> allocate the TB(s) received from the physical layer and the
associated HARQ information to the HARQ process indicated by the
associated HARQ information.

1\> if a downlink assignment has been indicated for the broadcast HARQ
process:

2\> allocate the received TB to the broadcast HARQ process.

NOTE: It is up to UE implementation to allocate the received TB for MCCH
or broadcast MTCH to one HARQ process.

\[TS 38.321, clause 5.3.2.2\]

When a transmission takes place for the HARQ process, one or two (in
case of downlink spatial multiplexing) TBs and the associated HARQ
information are received from the HARQ entity.

For each received TB and associated HARQ information, the HARQ process
shall:

1\> if the NDI, when provided, has been toggled compared to the value of
the previous received transmission corresponding to this TB; or

1\> if the HARQ process is equal to the broadcast process, and this is
the first received transmission for the TB according to the system
information schedule indicated by RRC; or

1\> if the HARQ process is associated with a transmission indicated with
a MCCH-RNTI for MBS broadcast, and this is the first received
transmission for the TB according to the MCCH schedule indicated by RRC;
or

1\> if the HARQ process is associated with a transmission indicated with
a G-RNTI for MBS broadcast, and this is the first received transmission
for the TB according to the MTCH schedule indicated by RRC or according
to the scheduling indicated by DCI as specified in TS 38.214 \[7\]; or

1\> if this is the very first received transmission for this TB (i.e.
there is no previous NDI for this TB):

2\> consider this transmission to be a new transmission.

1\> else:

2\> consider this transmission to be a retransmission.

The MAC entity then shall:

1\> if this is a new transmission:

2\> attempt to decode the received data.

1\> else if this is a retransmission:

2\> if the data for this TB has not yet been successfully decoded:

3\> instruct the physical layer to combine the received data with the
data currently in the soft buffer for this TB and attempt to decode the
combined data.

1\> if the data which the MAC entity attempted to decode was
successfully decoded for this TB; or

1\> if the data for this TB was successfully decoded before:

2\> if the HARQ process is equal to the broadcast process:

3\> deliver the decoded MAC PDU to upper layers.

2\> else if this is the first successful decoding of the data for this
TB:

3\> deliver the decoded MAC PDU to the disassembly and demultiplexing
entity.

1\> else:

2\> instruct the physical layer to replace the data in the soft buffer
for this TB with the data which the MAC entity attempted to decode.

1\> if the HARQ process is associated with a transmission indicated with
a Temporary C-RNTI and the Contention Resolution is not yet successful
(see clause 5.1.5); or

1\> if the HARQ process is associated with a transmission indicated with
a MSGB-RNTI and the Random Access procedure is not yet successfully
completed (see clause 5.1.4a); or

1\> if the HARQ process is equal to the broadcast process; or

1\> if the HARQ process is associated with a transmission indicated with
a MCCH-RNTI or a G-RNTI for MBS broadcast; or

1\> if the HARQ process is associated with a transmission indicated with
a G-RNTI or a G-CS-RNTI or a configured downlink assignment for MBS
multicast and HARQ feedback is disabled for this G-RNTI or G-CS-RNTI, as
specified in clause 18 of TS 38.213 \[6\]; or

1\> if the HARQ process is associated with a transmission indicated with
a G-RNTI or a G-CS-RNTI or a configured downlink assignment for MBS
multicast and NACK only HARQ feedback is configured for this G-RNTI or
G-CS-RNTI and the data for this TB is successfully decoded and the
transmission is not the first transmission of PDSCH where the configured
downlink assignment was (re-)initialised; or

1\> if the *timeAlignmentTimer*, associated with the TAG containing the
Serving Cell on which the HARQ feedback is to be transmitted, is stopped
or expired and if the *cg-SDT-TimeAlignmentTimer*, if configured, is not
running; or

1\> if the HARQ process is configured with disabled HARQ feedback:

2\> if *harq-FeedbackEnablingforSPSactive* is configured with value
*true* and the transmission is the first transmission on the configured
downlink assignment after activation of the configured downlink
assignment:

3\> instruct the physical layer to generate acknowledgement(s) of the
data in this TB.

2\> else:

3\> not instruct the physical layer to generate acknowledgement(s) of
the data in this TB.

1\> else:

2\> instruct the physical layer to generate acknowledgement(s) of the
data in this TB.

The MAC entity shall ignore NDI received in all downlink assignments on
PDCCH for its Temporary C-RNTI when determining if NDI on PDCCH for its
C-RNTI has been toggled compared to the value in the previous
transmission.

NOTE: If the MAC entity receives a retransmission with a TB size
different from the last TB size signalled for this TB, the UE behavior
is left up to UE implementation.

\[TS 38.321, clause 6.1.3.47\]

The Unified TCI States Activation/Deactivation MAC CE is identified by a
MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a
variable size consisting of following fields:

\- Serving Cell ID: This field indicates the identity of the Serving
Cell for which the MAC CE applies. The length of the field is 5 bits. If
the indicated Serving Cell is configured as part of a
*simultaneousU-TCI-UpdateList1*, *simultaneousU-TCI-UpdateList2*,
*simultaneousU-TCI-UpdateList3* or *simultaneousU-TCI-UpdateList4* as
specified in TS 38.331 \[5\], this MAC CE applies to all theServing
Cells in the set *simultaneousU-TCI-UpdateList1*,
*simultaneousU-TCI-UpdateList2*, *simultaneousU-TCI-UpdateList3* or
*simultaneousU-TCI-UpdateList4*, respectively;

\- DL BWP ID: This field indicates a DL BWP for which the MAC CE applies
as the codepoint of the DCI *bandwidth part indicator* field as
specified in TS 38.212 \[9\]. The length of the BWP ID field is 2 bits;

\- UL BWP ID: This field indicates a UL BWP for which the MAC CE applies
as the codepoint of the DCI *bandwidth part indicator* field as
specified in TS 38.212 \[9\]. If value of *unifiedTCI-StateType* in the
Serving Cell indicated by Serving Cell ID is *joint*, this field is
considered as the reserved bits. The length of the BWP ID field is 2
bits;

\- P~i~: This field indicates whether each TCI codepoint has multiple
TCI states or single TCI state. If P~i~ field is set to 1, it indicates
that i^th^ TCI codepoint includes the DL TCI state and the UL TCI state.
If P~i~ field is set to 0, it indicates that i^th^ TCI codepoint
includes only the DL/joint TCI state or the UL TCI state. The codepoint
to which a TCI state is mapped is determined by its ordinal position
among all the TCI state ID fields;

\- D/U: This field indicate whether the TCI state ID in the same octet
is for joint/downlink or uplink TCI state. If this field is set to 1,
the TCI state ID in the same octet is for joint/downlink. If this field
is set to 0, the TCI state ID in the same octet is for uplink;

\- TCI state ID: This field indicates the TCI state identified by
*TCI-StateId* as specified in TS 38.331 \[5\]. If D/U is set to 1,
7-bits length TCI state ID i.e. *TCI-StateId* as specified in TS 38.331
\[5\] is used. If D/U is set to 0, the most significant bit of TCI state
ID is considered as the reserved bit and remainder 6 bits indicate the
*TCI-UL-State-Id* as specified in TS 38.331 \[5\]. The maximum number of
activated TCI states is 16;

\- R: Reserved bit, set to 0.

Figure 6.1.3.47-1: Unified TCI state activation/deactivation MAC CE

##### 7.1.1.2.7.3 Test description {#test-description-25 .H6}

##### 7.1.1.2.7.3.1 Pre-test conditions {#pre-test-conditions-25 .H6}

Same Pre-test conditions as in clause 7.1.1.0 except that set to return
no data in uplink.

##### 7.1.1.2.7.3.2 Test procedure sequence {#test-procedure-sequence-24 .H6}

Table 7.1.1.2.7.3.2-1: Main behaviour

+-----------+-----------+-----------+-----------+---------+----+
| St        | Procedure | Message   | TP        | Verdict |    |
|           |           | Sequence  |           |         |    |
+===========+===========+===========+===========+=========+====+
|           |           | U - S     | Message   |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 1         | SS        | \<\--     | NR RRC:   | \-      | \- |
|           | transmits |           | RRCReconf |         |    |
|           | an        |           | iguration |         |    |
|           | *R        |           |           |         |    |
|           | RCReconfi |           |           |         |    |
|           | guration* |           |           |         |    |
|           | message   |           |           |         |    |
|           | to        |           |           |         |    |
|           | configure |           |           |         |    |
|           | 2 unified |           |           |         |    |
|           | TCI       |           |           |         |    |
|           | states    |           |           |         |    |
|           | activated |           |           |         |    |
|           | by        |           |           |         |    |
|           | MAC-CE.   |           |           |         |    |
|           | (Note 1)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 2         | UE        | \--\>     | NR RRC:   | \-      | \- |
|           | transmits |           | RRCRecon  |         |    |
|           | an        |           | figuratio |         |    |
|           | *         |           | nComplete |         |    |
|           | RRCReconf |           |           |         |    |
|           | iguration |           |           |         |    |
|           | Complete* |           |           |         |    |
|           | message.  |           |           |         |    |
|           | (Note 2)  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 3         | SS        | \<\--     | DCI       | \-      | \- |
|           | transmits |           | format    |         |    |
|           | a         |           | 1\_1(UE   |         |    |
|           | downlink  |           | C-RNTI,   |         |    |
|           | a         |           | Tra       |         |    |
|           | ssignment |           | nsmission |         |    |
|           | addressed |           | conf      |         |    |
|           | to the    |           | iguration |         |    |
|           | C-RNTI    |           | i         |         |    |
|           | assigned  |           | ndication |         |    |
|           | to the    |           | = "000")  |         |    |
|           | UE, which |           |           |         |    |
|           | carries   |           |           |         |    |
|           | the 1st   |           |           |         |    |
|           | activated |           |           |         |    |
|           | unified   |           |           |         |    |
|           | TCI       |           |           |         |    |
|           | state.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 4         | SS        | \<\--     | MAC PDU   | \-      | \- |
|           | transmits |           |           |         |    |
|           | in the    |           |           |         |    |
|           | indicated |           |           |         |    |
|           | downlink  |           |           |         |    |
|           | a         |           |           |         |    |
|           | ssignment |           |           |         |    |
|           | a MAC PDU |           |           |         |    |
|           | including |           |           |         |    |
|           | an RLC    |           |           |         |    |
|           | PDU with  |           |           |         |    |
|           | poll bit  |           |           |         |    |
|           | not set.  |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 5         | Check:    | \--\>     | HARQ ACK  | 1       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | an HARQ   |           |           |         |    |
|           | ACK on    |           |           |         |    |
|           | PUCCH?    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 6         | SS        | \<\--     | DCI       | \-      | \- |
|           | transmits |           | format    |         |    |
|           | a         |           | 1\_1(UE   |         |    |
|           | DCI\_1\_1 |           | C-RNTI,   |         |    |
|           | addressed |           | Tra       |         |    |
|           | to the    |           | nsmission |         |    |
|           | C-RNTI    |           | conf      |         |    |
|           | assigned  |           | iguration |         |    |
|           | to the UE |           | i         |         |    |
|           | without   |           | ndication |         |    |
|           | DL        |           | = "001")  |         |    |
|           | as        |           |           |         |    |
|           | signment, |           |           |         |    |
|           | which     |           |           |         |    |
|           | carries   |           |           |         |    |
|           | the 2nd   |           |           |         |    |
|           | activated |           |           |         |    |
|           | unified   |           |           |         |    |
|           | TCI       |           |           |         |    |
|           | state.    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| 7         | Check:    | \--\>     | HARQ ACK  | 2       | P  |
|           | Does the  |           |           |         |    |
|           | UE        |           |           |         |    |
|           | transmit  |           |           |         |    |
|           | an HARQ   |           |           |         |    |
|           | ACK on    |           |           |         |    |
|           | PUCCH?    |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+
| Note 1:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| 36.508    |           |           |           |         |    |
| \[7\],    |           |           |           |         |    |
| Table     |           |           |           |         |    |
| 4.6.1-8   |           |           |           |         |    |
| using     |           |           |           |         |    |
| condition |           |           |           |         |    |
| EN-DC\_   |           |           |           |         |    |
| EmbedNR\_ |           |           |           |         |    |
| RRCRecon. |           |           |           |         |    |
|           |           |           |           |         |    |
| Note 2:   |           |           |           |         |    |
| For EN-DC |           |           |           |         |    |
| the NR    |           |           |           |         |    |
| RRCRecon  |           |           |           |         |    |
| figuratio |           |           |           |         |    |
| nComplete |           |           |           |         |    |
| message   |           |           |           |         |    |
| is        |           |           |           |         |    |
| contained |           |           |           |         |    |
| in        |           |           |           |         |    |
| R         |           |           |           |         |    |
| RCConnect |           |           |           |         |    |
| ionReconf |           |           |           |         |    |
| iguration |           |           |           |         |    |
| Complete. |           |           |           |         |    |
+-----------+-----------+-----------+-----------+---------+----+

##### 7.1.1.2.7.3.3 Specific message contents {#specific-message-contents-25 .H6}

Table 7.1.1.2.7.3.3-1: *RRCReconfiguration* (Step 1, Table
7.1.1.2.7.3.2-1)

  ------------------------------------------------- ----------------- ------------------------------------------- -----------
  Derivation path: 38.508-1 \[4\], Table 4.6.1-13                                                                 
  Information Element                               Value/remark      Comment                                     Condition
  RRCReconfiguration::=SEQUENCE{                                                                                  
  criticalExtensions CHOICE{                                                                                      
  rrcReconfiguration SEQUENCE{                                                                                    
  secondaryCellGroup                                CellGroupConfig   OCTET STRING                                EN-DC
  nonCriticalExtension c                                                                                          NR
  masterCellGroup                                   CellGroupConfig   OCTET STRING (CONTAINING CellGroupConfig)   
  }                                                                                                               
  }                                                                                                               
  }                                                                                                               
  }                                                                                                               
  ------------------------------------------------- ----------------- ------------------------------------------- -----------

Table 7.1.1.2.7.3.3-2: *CellGroupConfig* (Table 7.1.1.2.7.3.3-1)

  ---------------------------------------------------- ---------------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-19                                          
  Information Element                                  Value/remark                 Comment   Condition
  CellGroupConfig ::= SEQUENCE {                                                              
  spCellConfig SEQUENCE {                                                                     
  spCellConfigDedicated                                ServingCellConfig                      
  }                                                                                           
  simultaneousU-TCI-UpdateList1-r17 SEQUENCE{                                                 
  ServCellIndex\[1\]                                   ServCellIndex of NR SpCell   Cell ID   
  }                                                                                           
  }                                                                                           
  ---------------------------------------------------- ---------------------------- --------- -----------

Table 7.1.1.2.7.3.3-3: *ServingCellConfig* (Table 7.1.1.2.7.3.3-2)

  ----------------------------------------------------- ----------------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-168                                     
  Information Element                                   Value/remark            Comment   Condition
  ServingCellConfig ::= SEQUENCE {                                                        
  initialDownlinkBWP                                    BWP-DownlinkDedicated             
  uplinkConfig SEQUENCE {                                                                 
  initialUplinkBWP                                      BWP-UplinkDedicated               
  MIMOParam-r17 SEQUENCE {                                                                
  unifiedTCI-StateType-r17                              separate                          
  }                                                                                       
  }                                                                                       
  }                                                                                       
  ----------------------------------------------------- ----------------------- --------- -----------

Table 7.1.1.2.7.3.3-4: *BWP-DownlinkDedicated* (Table 7.1.1.2.7.3.3-3)

  ---------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-11                            
  Information Element                                  Value/remark   Comment   Condition
  BWP-DownlinkDedicated ::= SEQUENCE {                                          
  pdcch-Config CHOICE {                                                         
  setup                                                PDCCH-Config             
  }                                                                             
  pdsch-Config CHOICE {                                                         
  setup                                                PDSCH-Config             
  }                                                                             
  }                                                                             
  ---------------------------------------------------- -------------- --------- -----------

Table 7.1.1.2.7.3.3-5: *PDSCH-Config* (Table 7.1.1.2.7.3.3-4)

  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-100                                        
  ----------------------------------------------------- -------------------------- --------- -----------
  Information Element                                   Value/remark               Comment   Condition
  PDSCH-Config ::= SEQUENCE {                                                                
  unifiedTCI-StateRef-r17                               ServingCellAndBWP-Id-r17             
  }                                                                                          

Table 7.1.1.2.7.3.3-6: ServingCellAndBWP-Id-r17 (Table 7.1.1.2.7.3.3-5)

  Derivation Path: TS 38.331 \[6\], clause 6.3.2                            
  ------------------------------------------------ -------------- --------- -----------
  Information Element                              Value/remark   Comment   Condition
  ServingCellAndBWP-Id-r17 ::= SEQUENCE {                                   
  servingcell-r17                                  Cell ID                  
  bwp-r17                                          BWP ID                   
  }                                                                         

Table 7.1.1.2.7.3.3-7: *PDCCH-Config* (Table 7.1.1.2.7.3.3-4)

  Derivation Path: TS 38.508-1 \[4\],Table 4.6.3-95                                                                                  
  --------------------------------------------------------------------------------------- -------------------------------- --------- -----------
  Information Element                                                                     Value/remark                     Comment   Condition
  PDCCH-Config::= SEQUENCE {                                                                                                         
  controlResourceSetToAddModList SEQUENCE(SEQUENCE(SIZE (1..3)) OF ControlResourceSet {   1 entry                                    
  ControlResourceSet\[1\]                                                                 ControlResourceSetid1            entry 1   
  }                                                                                                                                  
  searchSpacesToAddModList SEQUENCE(SIZE (1..10)) OF SearchSpace {                        1 entry                                    
  SearchSpace\[1\]                                                                        SearchSpace with condition USS   entry 1   
  }                                                                                                                                  
  }                                                                                                                                  

Table 7.1.1.2.7.3.3-8: *ControlResourceSetId1* (Table 7.1.1.2.7.3.3-7)

  ---------------------------------------------------- -------------- --------- -----------
  Derivation Path: TS 38.508-1 \[4\], Table 4.6.3-28                            
  Information Element                                  Value/remark   Comment   Condition
  ControlResourceSet ::= SEQUENCE {                                             
  controlResourceSetId                                 1                        
  tci-PresentInDCI                                     enabled                  
  }                                                                             
  }                                                                             
  ---------------------------------------------------- -------------- --------- -----------

Table 7.1.1.2.7.3.3-9: Physical layer parameters for DCI format 1\_1
(Steps 3 and 6, Table 7.1.1.2.7.3.2-1)

  Derivation path: TS 38.508-1 \[4\] Table 4.3.6.1.2.2-1                             
  -------------------------------------------------------- ------- ----------------- -----------
  Parameter                                                Value   Value in binary   Condition
  Transmission configuration indication                    0       "000"             Step 3
                                                           *1*     "001"             Step 6
